BLEU SCORE: 0.41211837513230265

TEST MSG: fix ( server : session ) : clear resends for responses and NewSession on stream end
GENERATED MSG: fix ( server : session ) : cancel resend on stream finish

TEST DIFF (one line): diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > index c7a7b95 . . 83c283f 100644 < nl > - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > @ @ - 417 , 8 + 417 , 13 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L < nl > onError ( new RuntimeException ( msg ) with NoStackTrace ) < nl > } < nl > < nl > + private def pushBufferSize = responseBuffer . size + pushBuffer . size + newSessionBuffer . map ( _ = > 1 ) . getOrElse ( 0 ) < nl > + < nl > override def postStop ( ) : Unit = { < nl > super . postStop ( ) < nl > + log . debug ( " Clearing resend buffers ( { } items ) " , pushBufferSize ) < nl > + responseBuffer . values foreach ( _ . _ 2 . cancel ( ) ) < nl > pushBuffer . values foreach ( _ . _ 2 . cancel ( ) ) < nl > + newSessionBuffer foreach ( _ . _ 3 . cancel ( ) ) < nl > } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > index 6c2c827 . . 7f0485c 100644 < nl > - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > @ @ - 410 , 4 + 410 , 9 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L < nl > log . warning ( msg ) < nl > onError ( new RuntimeException ( msg ) with NoStackTrace ) < nl > } < nl > + < nl > + override def postStop ( ) : Unit = { < nl > + super . postStop ( ) < nl > + pushBuffer . values foreach ( _ . _ 2 . cancel ( ) ) < nl > + } < nl > }

TEST DIFF:
diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 index c7a7b95 . . 83c283f 100644 
 - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 @ @ - 417 , 8 + 417 , 13 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L 
 onError ( new RuntimeException ( msg ) with NoStackTrace ) 
 } 
 
 + private def pushBufferSize = responseBuffer . size + pushBuffer . size + newSessionBuffer . map ( _ = > 1 ) . getOrElse ( 0 ) 
 + 
 override def postStop ( ) : Unit = { 
 super . postStop ( ) 
 + log . debug ( " Clearing resend buffers ( { } items ) " , pushBufferSize ) 
 + responseBuffer . values foreach ( _ . _ 2 . cancel ( ) ) 
 pushBuffer . values foreach ( _ . _ 2 . cancel ( ) ) 
 + newSessionBuffer foreach ( _ . _ 3 . cancel ( ) ) 
 } 
 }

NEAREST DIFF:
diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 index 6c2c827 . . 7f0485c 100644 
 - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 @ @ - 410 , 4 + 410 , 9 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L 
 log . warning ( msg ) 
 onError ( new RuntimeException ( msg ) with NoStackTrace ) 
 } 
 + 
 + override def postStop ( ) : Unit = { 
 + super . postStop ( ) 
 + pushBuffer . values foreach ( _ . _ 2 . cancel ( ) ) 
 + } 
 }
