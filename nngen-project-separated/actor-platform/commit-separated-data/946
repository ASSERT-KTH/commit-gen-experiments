BLEU SCORE: 0.09287528999566796

TEST MSG: fix ( android ) : image helper unable to scale
GENERATED MSG: feat ( core ) : Adding encrypted peers

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java < nl > index 40b42bd . . 05c04c9 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java < nl > @ @ - 120 , 12 + 120 , 14 @ @ public class ImageHelper { < nl > < nl > private static int getScaleFactor ( BitmapSize size , int maxPixels ) { < nl > int scale = 1 ; < nl > - int scaledW = size . getWidth ( ) ; < nl > - int scaledH = size . getHeight ( ) ; < nl > - while ( scaledW * scaledH > maxPixels ) { < nl > - scale * = 2 ; < nl > - scaledH / = 2 ; < nl > - scaledW / = 2 ; < nl > + if ( size ! = null ) { < nl > + int scaledW = size . getWidth ( ) ; < nl > + int scaledH = size . getHeight ( ) ; < nl > + while ( scaledW * scaledH > maxPixels ) { < nl > + scale * = 2 ; < nl > + scaledH / = 2 ; < nl > + scaledW / = 2 ; < nl > + } < nl > } < nl > return scale ; < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java < nl > index 07a38e8 . . ee160ce 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java < nl > @ @ - 115 , 6 + 115 , 9 @ @ public class Peer extends BserObject { < nl > case 3 : < nl > peerType = PeerType . GROUP ; < nl > break ; < nl > + case 4 : < nl > + peerType = PeerType . PRIVATE _ ENCRYPTED ; < nl > + break ; < nl > } < nl > } < nl > < nl > @ @ - 129 , 6 + 132 , 9 @ @ public class Peer extends BserObject { < nl > case GROUP : < nl > writer . writeInt ( 2 , 3 ) ; < nl > break ; < nl > + case PRIVATE _ ENCRYPTED : < nl > + writer . writeInt ( 2 , 4 ) ; < nl > + break ; < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java < nl > index 4e5072a . . fa61e8c 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java < nl > @ @ - 5 , 5 + 5 , 5 @ @ < nl > package im . actor . core . entity ; < nl > < nl > public enum PeerType { < nl > - PRIVATE , GROUP < nl > + PRIVATE , GROUP , PRIVATE _ ENCRYPTED < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java < nl > new file mode 100644 < nl > index 0000000 . . 762fa1b < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java < nl > @ @ - 0 , 0 + 1 , 38 @ @ < nl > + package im . actor . core . modules . updates ; < nl > + < nl > + import im . actor . core . api . updates . UpdateEncryptedPackage ; < nl > + import im . actor . core . api . updates . UpdatePublicKeyGroupAdded ; < nl > + import im . actor . core . api . updates . UpdatePublicKeyGroupChanged ; < nl > + import im . actor . core . api . updates . UpdatePublicKeyGroupRemoved ; < nl > + import im . actor . core . modules . AbsModule ; < nl > + import im . actor . core . modules . ModuleContext ; < nl > + import im . actor . core . modules . encryption . EncryptedMsgActor ; < nl > + import im . actor . core . modules . encryption . KeyManagerActor ; < nl > + import im . actor . core . modules . sequence . Processor ; < nl > + < nl > + public class EncryptedProcessor extends AbsModule implements Processor { < nl > + < nl > + public EncryptedProcessor ( ModuleContext context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean process ( Object update ) { < nl > + if ( update instanceof UpdatePublicKeyGroupAdded ) { < nl > + context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupAdded ( < nl > + ( ( UpdatePublicKeyGroupAdded ) update ) . getUid ( ) , < nl > + ( ( UpdatePublicKeyGroupAdded ) update ) . getKeyGroup ( ) < nl > + ) ) ; < nl > + return true ; < nl > + } else if ( update instanceof UpdatePublicKeyGroupRemoved ) { < nl > + context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupRemoved ( < nl > + ( ( UpdatePublicKeyGroupRemoved ) update ) . getUid ( ) , < nl > + ( ( UpdatePublicKeyGroupRemoved ) update ) . getKeyGroupId ( ) < nl > + ) ) ; < nl > + return true ; < nl > + } else if ( update instanceof UpdateEncryptedPackage ) { < nl > + < nl > + } < nl > + return false ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > index e543022 . . 15b78e9 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > @ @ - 89 , 6 + 89 , 7 @ @ public class UpdateProcessor extends AbsModule { < nl > private ContactsProcessor contactsProcessor ; < nl > private StickersProcessor stickersProcessor ; < nl > private CallsProcessor callsProcessor ; < nl > + private EncryptedProcessor encryptedProcessor ; < nl > < nl > public UpdateProcessor ( ModuleContext context ) { < nl > super ( context ) ; < nl > @ @ - 101 , 6 + 102 , 7 @ @ public class UpdateProcessor extends AbsModule { < nl > this . typingProcessor = new TypingProcessor ( context ) ; < nl > this . stickersProcessor = new StickersProcessor ( context ) ; < nl > this . callsProcessor = new CallsProcessor ( context ) ; < nl > + this . encryptedProcessor = new EncryptedProcessor ( context ) ; < nl > } < nl > < nl > public void applyRelated ( List < ApiUser > users , < nl > @ @ - 239 , 6 + 241 , 9 @ @ public class UpdateProcessor extends AbsModule { < nl > if ( usersProcessor . process ( update ) ) { < nl > return ; < nl > } < nl > + if ( encryptedProcessor . process ( update ) ) { < nl > + return ; < nl > + } < nl > if ( update instanceof UpdateMessage ) { < nl > UpdateMessage message = ( UpdateMessage ) update ; < nl > messagesProcessor . onMessage ( message . getPeer ( ) , message . getSenderUid ( ) , message . getDate ( ) , message . getRid ( ) , < nl > @ @ - 349 , 16 + 354 , 6 @ @ public class UpdateProcessor extends AbsModule { < nl > callsProcessor . onSignal ( ( UpdateCallSignal ) update ) ; < nl > } else if ( update instanceof UpdateCallEnded ) { < nl > callsProcessor . onCallEnd ( ( UpdateCallEnded ) update ) ; < nl > - } else if ( update instanceof UpdatePublicKeyGroupAdded ) { < nl > - context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupAdded ( < nl > - ( ( UpdatePublicKeyGroupAdded ) update ) . getUid ( ) , < nl > - ( ( UpdatePublicKeyGroupAdded ) update ) . getKeyGroup ( ) < nl > - ) ) ; < nl > - } else if ( update instanceof UpdatePublicKeyGroupRemoved ) { < nl > - context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupRemoved ( < nl > - ( ( UpdatePublicKeyGroupRemoved ) update ) . getUid ( ) , < nl > - ( ( UpdatePublicKeyGroupRemoved ) update ) . getKeyGroupId ( ) < nl > - ) ) ; < nl > } < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java 
 index 40b42bd . . 05c04c9 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / ImageHelper . java 
 @ @ - 120 , 12 + 120 , 14 @ @ public class ImageHelper { 
 
 private static int getScaleFactor ( BitmapSize size , int maxPixels ) { 
 int scale = 1 ; 
 - int scaledW = size . getWidth ( ) ; 
 - int scaledH = size . getHeight ( ) ; 
 - while ( scaledW * scaledH > maxPixels ) { 
 - scale * = 2 ; 
 - scaledH / = 2 ; 
 - scaledW / = 2 ; 
 + if ( size ! = null ) { 
 + int scaledW = size . getWidth ( ) ; 
 + int scaledH = size . getHeight ( ) ; 
 + while ( scaledW * scaledH > maxPixels ) { 
 + scale * = 2 ; 
 + scaledH / = 2 ; 
 + scaledW / = 2 ; 
 + } 
 } 
 return scale ; 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java 
 index 07a38e8 . . ee160ce 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Peer . java 
 @ @ - 115 , 6 + 115 , 9 @ @ public class Peer extends BserObject { 
 case 3 : 
 peerType = PeerType . GROUP ; 
 break ; 
 + case 4 : 
 + peerType = PeerType . PRIVATE _ ENCRYPTED ; 
 + break ; 
 } 
 } 
 
 @ @ - 129 , 6 + 132 , 9 @ @ public class Peer extends BserObject { 
 case GROUP : 
 writer . writeInt ( 2 , 3 ) ; 
 break ; 
 + case PRIVATE _ ENCRYPTED : 
 + writer . writeInt ( 2 , 4 ) ; 
 + break ; 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java 
 index 4e5072a . . fa61e8c 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / PeerType . java 
 @ @ - 5 , 5 + 5 , 5 @ @ 
 package im . actor . core . entity ; 
 
 public enum PeerType { 
 - PRIVATE , GROUP 
 + PRIVATE , GROUP , PRIVATE _ ENCRYPTED 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java 
 new file mode 100644 
 index 0000000 . . 762fa1b 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / EncryptedProcessor . java 
 @ @ - 0 , 0 + 1 , 38 @ @ 
 + package im . actor . core . modules . updates ; 
 + 
 + import im . actor . core . api . updates . UpdateEncryptedPackage ; 
 + import im . actor . core . api . updates . UpdatePublicKeyGroupAdded ; 
 + import im . actor . core . api . updates . UpdatePublicKeyGroupChanged ; 
 + import im . actor . core . api . updates . UpdatePublicKeyGroupRemoved ; 
 + import im . actor . core . modules . AbsModule ; 
 + import im . actor . core . modules . ModuleContext ; 
 + import im . actor . core . modules . encryption . EncryptedMsgActor ; 
 + import im . actor . core . modules . encryption . KeyManagerActor ; 
 + import im . actor . core . modules . sequence . Processor ; 
 + 
 + public class EncryptedProcessor extends AbsModule implements Processor { 
 + 
 + public EncryptedProcessor ( ModuleContext context ) { 
 + super ( context ) ; 
 + } 
 + 
 + @ Override 
 + public boolean process ( Object update ) { 
 + if ( update instanceof UpdatePublicKeyGroupAdded ) { 
 + context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupAdded ( 
 + ( ( UpdatePublicKeyGroupAdded ) update ) . getUid ( ) , 
 + ( ( UpdatePublicKeyGroupAdded ) update ) . getKeyGroup ( ) 
 + ) ) ; 
 + return true ; 
 + } else if ( update instanceof UpdatePublicKeyGroupRemoved ) { 
 + context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupRemoved ( 
 + ( ( UpdatePublicKeyGroupRemoved ) update ) . getUid ( ) , 
 + ( ( UpdatePublicKeyGroupRemoved ) update ) . getKeyGroupId ( ) 
 + ) ) ; 
 + return true ; 
 + } else if ( update instanceof UpdateEncryptedPackage ) { 
 + 
 + } 
 + return false ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 index e543022 . . 15b78e9 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 @ @ - 89 , 6 + 89 , 7 @ @ public class UpdateProcessor extends AbsModule { 
 private ContactsProcessor contactsProcessor ; 
 private StickersProcessor stickersProcessor ; 
 private CallsProcessor callsProcessor ; 
 + private EncryptedProcessor encryptedProcessor ; 
 
 public UpdateProcessor ( ModuleContext context ) { 
 super ( context ) ; 
 @ @ - 101 , 6 + 102 , 7 @ @ public class UpdateProcessor extends AbsModule { 
 this . typingProcessor = new TypingProcessor ( context ) ; 
 this . stickersProcessor = new StickersProcessor ( context ) ; 
 this . callsProcessor = new CallsProcessor ( context ) ; 
 + this . encryptedProcessor = new EncryptedProcessor ( context ) ; 
 } 
 
 public void applyRelated ( List < ApiUser > users , 
 @ @ - 239 , 6 + 241 , 9 @ @ public class UpdateProcessor extends AbsModule { 
 if ( usersProcessor . process ( update ) ) { 
 return ; 
 } 
 + if ( encryptedProcessor . process ( update ) ) { 
 + return ; 
 + } 
 if ( update instanceof UpdateMessage ) { 
 UpdateMessage message = ( UpdateMessage ) update ; 
 messagesProcessor . onMessage ( message . getPeer ( ) , message . getSenderUid ( ) , message . getDate ( ) , message . getRid ( ) , 
 @ @ - 349 , 16 + 354 , 6 @ @ public class UpdateProcessor extends AbsModule { 
 callsProcessor . onSignal ( ( UpdateCallSignal ) update ) ; 
 } else if ( update instanceof UpdateCallEnded ) { 
 callsProcessor . onCallEnd ( ( UpdateCallEnded ) update ) ; 
 - } else if ( update instanceof UpdatePublicKeyGroupAdded ) { 
 - context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupAdded ( 
 - ( ( UpdatePublicKeyGroupAdded ) update ) . getUid ( ) , 
 - ( ( UpdatePublicKeyGroupAdded ) update ) . getKeyGroup ( ) 
 - ) ) ; 
 - } else if ( update instanceof UpdatePublicKeyGroupRemoved ) { 
 - context ( ) . getEncryption ( ) . getKeyManager ( ) . send ( new KeyManagerActor . PublicKeysGroupRemoved ( 
 - ( ( UpdatePublicKeyGroupRemoved ) update ) . getUid ( ) , 
 - ( ( UpdatePublicKeyGroupRemoved ) update ) . getKeyGroupId ( ) 
 - ) ) ; 
 } 
 }
