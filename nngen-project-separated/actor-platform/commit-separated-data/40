BLEU SCORE: 0.21200626759025185

TEST MSG: feat ( android ) : attach menu fast share as bottom sheet
GENERATED MSG: feat ( android ) call members list

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > index eb2015c . . 75694e9 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > @ @ - 14 , 6 + 14 , 7 @ @ import android . os . Bundle ; < nl > import android . support . annotation . NonNull ; < nl > import android . support . annotation . Nullable ; < nl > import android . support . v4 . content . ContextCompat ; < nl > + import android . support . v7 . widget . GridLayoutManager ; < nl > import android . support . v7 . widget . LinearLayoutManager ; < nl > import android . support . v7 . widget . RecyclerView ; < nl > import android . util . Base64 ; < nl > @ @ - 42 , 12 + 43 , 14 @ @ import im . actor . sdk . controllers . tools . MediaPickerFragment ; < nl > import im . actor . sdk . util . SDKFeatures ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . view . ShareMenuButtonFactory ; < nl > + import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; < nl > < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public class AttachFragment extends AbsAttachFragment implements MediaPickerCallback { < nl > < nl > private static final int PERMISSION _ REQ _ MEDIA = 11 ; < nl > + public static final int SPAN _ COUNT = 4 ; < nl > < nl > private FrameLayout root ; < nl > private View container ; < nl > @ @ - 56 , 6 + 59 , 7 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > private TextView menuTitleToChange ; < nl > < nl > private boolean isLoaded = false ; < nl > + private RecyclerView fastShare ; < nl > < nl > public AttachFragment ( Peer peer ) { < nl > super ( peer ) ; < nl > @ @ - 90 , 7 + 94 , 8 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > isLoaded = true ; < nl > < nl > container = getLayoutInflater ( null ) . inflate ( R . layout . share _ menu , root , false ) ; < nl > - container . setVisibility ( View . INVISIBLE ) ; < nl > + fastShare = new RecyclerView ( getActivity ( ) ) ; < nl > + fastShare . setVisibility ( View . INVISIBLE ) ; < nl > < nl > container . findViewById ( R . id . menu _ bg ) . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > container . findViewById ( R . id . cancelField ) . setOnClickListener ( view - > hide ( ) ) ; < nl > @ @ - 192 , 11 + 197 , 19 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > hide ( ) ; < nl > } ; < nl > < nl > - RecyclerView fastShare = ( RecyclerView ) container . findViewById ( R . id . fast _ share ) ; < nl > + / / RecyclerView fastShare = ( RecyclerView ) container . findViewById ( R . id . fast _ share ) ; < nl > fastAttachAdapter = new FastAttachAdapter ( getActivity ( ) ) ; < nl > - LinearLayoutManager layoutManager = new LinearLayoutManager ( getActivity ( ) , LinearLayoutManager . HORIZONTAL , false ) ; < nl > - fastShare . setAdapter ( fastAttachAdapter ) ; < nl > + HeaderViewRecyclerAdapter adapter = new HeaderViewRecyclerAdapter ( fastAttachAdapter ) ; < nl > + adapter . addHeaderView ( container ) ; < nl > + GridLayoutManager layoutManager = new GridLayoutManager ( getActivity ( ) , SPAN _ COUNT ) ; < nl > + fastShare . setAdapter ( adapter ) ; < nl > fastShare . setLayoutManager ( layoutManager ) ; < nl > + layoutManager . setSpanSizeLookup ( new GridLayoutManager . SpanSizeLookup ( ) { < nl > + @ Override < nl > + public int getSpanSize ( int position ) { < nl > + return position = = 0 ? 4 : 1 ; < nl > + } < nl > + } ) ; < nl > StateListDrawable background = ShareMenuButtonFactory . get ( style . getMainColor ( ) , getActivity ( ) ) ; < nl > < nl > final View . OnClickListener finalDefaultSendOcl = defaultSendOcl ; < nl > @ @ - 218 , 14 + 231 , 20 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > menuIconToChange . setPadding ( 0 , 0 , 0 , 0 ) ; < nl > } < nl > } ) ; < nl > - < nl > - root . addView ( container ) ; < nl > + root . post ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + container . getLayoutParams ( ) . height = root . getHeight ( ) - Screen . dp ( 135 ) ; < nl > + container . requestLayout ( ) ; < nl > + } < nl > + } ) ; < nl > + root . addView ( fastShare ) ; < nl > } < nl > < nl > @ Override < nl > public void show ( ) { < nl > prepareView ( ) ; < nl > - if ( container . getVisibility ( ) = = View . INVISIBLE ) { < nl > + if ( fastShare . getVisibility ( ) = = View . INVISIBLE ) { < nl > if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . M ) { < nl > Activity activity = getActivity ( ) ; < nl > if ( activity = = null ) { < nl > @ @ - 240 , 58 + 259 , 58 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > } < nl > onShown ( ) ; < nl > messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Show ( ) ) ; < nl > - showView ( container ) ; < nl > - if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { < nl > - View internal = container . findViewById ( R . id . menu _ bg ) ; < nl > - int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; < nl > - int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; < nl > - float finalRadius = ( float ) Math . hypot ( cx , cy ) ; < nl > - Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , 0 , finalRadius ) ; < nl > - anim . setDuration ( 200 ) ; < nl > - anim . start ( ) ; < nl > - internal . setAlpha ( 1 ) ; < nl > - } < nl > + showView ( fastShare ) ; < nl > + / / if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { < nl > + / / View internal = container . findViewById ( R . id . menu _ bg ) ; < nl > + / / int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; < nl > + / / int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; < nl > + / / float finalRadius = ( float ) Math . hypot ( cx , cy ) ; < nl > + / / Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , 0 , finalRadius ) ; < nl > + / / anim . setDuration ( 200 ) ; < nl > + / / anim . start ( ) ; < nl > + / / internal . setAlpha ( 1 ) ; < nl > + / / } < nl > } < nl > } < nl > < nl > @ Override < nl > public void hide ( ) { < nl > - if ( container ! = null & & container . getVisibility ( ) = = View . VISIBLE ) { < nl > + if ( fastShare ! = null & & fastShare . getVisibility ( ) = = View . VISIBLE ) { < nl > onHidden ( ) ; < nl > fastAttachAdapter . clearSelected ( ) ; < nl > messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Hide ( ) ) ; < nl > - hideView ( container ) ; < nl > - if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { < nl > - View internal = container . findViewById ( R . id . menu _ bg ) ; < nl > - int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; < nl > - int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; < nl > - float finalRadius = ( float ) Math . hypot ( cx , cy ) ; < nl > - Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , finalRadius , 0 ) ; < nl > - anim . addListener ( new Animator . AnimatorListener ( ) { < nl > - @ Override < nl > - public void onAnimationStart ( Animator animator ) { < nl > - internal . setAlpha ( 1 ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onAnimationEnd ( Animator animator ) { < nl > - internal . setAlpha ( 0 ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onAnimationCancel ( Animator animator ) { < nl > - < nl > - } < nl > - < nl > - @ Override < nl > - public void onAnimationRepeat ( Animator animator ) { < nl > - < nl > - } < nl > - } ) ; < nl > - < nl > - anim . setDuration ( 200 ) ; < nl > - anim . start ( ) ; < nl > - } < nl > + hideView ( fastShare ) ; < nl > + / / if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { < nl > + / / View internal = container . findViewById ( R . id . menu _ bg ) ; < nl > + / / int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; < nl > + / / int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; < nl > + / / float finalRadius = ( float ) Math . hypot ( cx , cy ) ; < nl > + / / Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , finalRadius , 0 ) ; < nl > + / / anim . addListener ( new Animator . AnimatorListener ( ) { < nl > + / / @ Override < nl > + / / public void onAnimationStart ( Animator animator ) { < nl > + / / internal . setAlpha ( 1 ) ; < nl > + / / } < nl > + / / < nl > + / / @ Override < nl > + / / public void onAnimationEnd ( Animator animator ) { < nl > + / / internal . setAlpha ( 0 ) ; < nl > + / / } < nl > + / / < nl > + / / @ Override < nl > + / / public void onAnimationCancel ( Animator animator ) { < nl > + / / < nl > + / / } < nl > + / / < nl > + / / @ Override < nl > + / / public void onAnimationRepeat ( Animator animator ) { < nl > + / / < nl > + / / } < nl > + / / } ) ; < nl > + / / < nl > + / / anim . setDuration ( 200 ) ; < nl > + / / anim . start ( ) ; < nl > + / / } < nl > } < nl > } < nl > < nl > @ @ - 411 , 6 + 430 , 7 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > fastAttachAdapter = null ; < nl > } < nl > container = null ; < nl > + fastShare = null ; < nl > root = null ; < nl > menuIconToChange = null ; < nl > menuTitleToChange = null ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java < nl > index 9e75d4b . . 41b8db5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java < nl > @ @ - 23 , 6 + 23 , 7 @ @ import java . util . HashSet ; < nl > import java . util . Set ; < nl > < nl > import im . actor . runtime . mvvm . ValueModel ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . ActorBinder ; < nl > import im . actor . sdk . util . Screen ; < nl > @ @ - 82 , 6 + 83 , 7 @ @ public class FastAttachAdapter extends RecyclerView . Adapter < FastAttachAdapter . Fa < nl > < nl > public FastShareVH ( View itemView ) { < nl > super ( itemView ) ; < nl > + itemView . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > v = ( SimpleDraweeView ) itemView . findViewById ( R . id . image ) ; < nl > chb = ( CheckBox ) itemView . findViewById ( R . id . check ) ; < nl > int size = Screen . dp ( 80 ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > index 2daec0f . . b3bde0f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > @ @ - 13 , 14 + 13 , 14 @ @ < nl > < LinearLayout < nl > android : id = " @ + id / menu _ bg " < nl > android : layout _ width = " match _ parent " < nl > - android : layout _ height = " 286dp " < nl > + android : layout _ height = " 196dp " < nl > android : layout _ gravity = " bottom " < nl > android : orientation = " vertical " > < nl > < nl > - < android . support . v7 . widget . RecyclerView < nl > - android : id = " @ + id / fast _ share " < nl > - android : layout _ width = " match _ parent " < nl > - android : layout _ height = " 90dp " / > < nl > + < ! - - < android . support . v7 . widget . RecyclerView - - > < nl > + < ! - - android : id = " @ + id / fast _ share " - - > < nl > + < ! - - android : layout _ width = " match _ parent " - - > < nl > + < ! - - android : layout _ height = " 90dp " / > - - > < nl > < nl > < FrameLayout < nl > android : id = " @ + id / share _ row _ one " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > index c75bcb5 . . 7817577 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > @ @ - 1 , 7 + 1 , 7 @ @ < nl > < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > android : padding = " 5dp " > < nl > < nl > < com . facebook . drawee . view . SimpleDraweeView
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index fa9298f . . 5bb61e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . Manifest ; < nl > + import android . app . Activity ; < nl > import android . app . Notification ; < nl > import android . app . NotificationManager ; < nl > import android . app . PendingIntent ; < nl > @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; < nl > import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > - import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > - import android . widget . Toast ; < nl > < nl > import java . text . DateFormat ; < nl > import java . text . SimpleDateFormat ; < nl > + import java . util . ArrayList ; < nl > import java . util . Date ; < nl > import java . util . TimeZone ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . core . viewmodel . CallMember ; < nl > import im . actor . core . viewmodel . CallState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . viewmodel . CallVM ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; < nl > import im . actor . runtime . actors . messages . PoisonPill ; < nl > import im . actor . runtime . mvvm . Value ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > - import im . actor . sdk . core . audio . AndroidPlayerActor ; < nl > - import im . actor . sdk . core . audio . AudioPlayerActor ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . adapters . HolderAdapter ; < nl > + import im . actor . sdk . view . adapters . ViewHolder ; < nl > + import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { < nl > / / < nl > CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - < nl > - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > - < nl > TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > - bind ( nameTV , user . getName ( ) ) ; < nl > + < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + < nl > + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , user . getAvatar ( ) ) ; < nl > + bind ( nameTV , user . getName ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , g . getAvatar ( ) ) ; < nl > + bind ( nameTV , g . getName ( ) ) ; < nl > + } < nl > + < nl > + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > + membersList . setAdapter ( membersAdapter ) ; < nl > < nl > timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > } < nl > < nl > - private void toastInCenter ( String s ) { < nl > - Toast t = Toast . makeText ( getActivity ( ) , < nl > - s , Toast . LENGTH _ SHORT ) ; < nl > - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; < nl > - t . show ( ) ; < nl > - } < nl > - < nl > @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { < nl > super . onResume ( ) ; < nl > manager . cancel ( NOTIFICATION _ ID ) ; < nl > } < nl > + < nl > + class CallMembersAdapter extends HolderAdapter < CallMember > { < nl > + < nl > + < nl > + private ArrayList < CallMember > members ; < nl > + < nl > + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { < nl > + super ( context ) ; < nl > + this . members = members . get ( ) ; < nl > + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { < nl > + @ Override < nl > + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { < nl > + CallMembersAdapter . this . members = val ; < nl > + notifyDataSetChanged ( ) ; < nl > + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getCount ( ) { < nl > + return members . size ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public CallMember getItem ( int position ) { < nl > + return members . get ( position ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public long getItemId ( int position ) { < nl > + return members . get ( position ) . getUid ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { < nl > + return new MemberHolder ( ) ; < nl > + } < nl > + < nl > + private class MemberHolder extends ViewHolder < CallMember > { < nl > + < nl > + CallMember data ; < nl > + private TextView userName ; < nl > + private TextView status ; < nl > + private AvatarView avatarView ; < nl > + < nl > + @ Override < nl > + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { < nl > + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; < nl > + < nl > + userName = ( TextView ) res . findViewById ( R . id . name ) ; < nl > + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + status = ( TextView ) res . findViewById ( R . id . status ) ; < nl > + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; < nl > + this . data = data ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( CallMember data , int position , Context context ) { < nl > + UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + this . data = data ; < nl > + avatarView . bind ( user ) ; < nl > + userName . setText ( user . getName ( ) . get ( ) ) ; < nl > + status . setText ( data . getState ( ) . name ( ) ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 50aecee . . fe5738b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > menu . findItem ( R . id . call ) . setVisible ( false ) ; < nl > } < nl > < nl > @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > if ( item . getItemId ( ) = = R . id . call ) { < nl > if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > private void startCall ( ) { < nl > - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + Command < Long > cmd ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + < nl > + } else { < nl > + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; < nl > + } < nl > execute ( cmd , R . string . progress _ common ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 47ab3ad . . 6ce5969 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 37 , 6 + 37 , 11 @ @ < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > android : textSize = " @ dimen / text _ secondary " / > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > < / LinearLayout > < nl > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . fa1ed22 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > @ @ - 0 , 0 + 1 , 62 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : orientation = " horizontal " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 59dp " < nl > + android : layout _ height = " 48dp " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 35dp " < nl > + android : layout _ height = " 35dp " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / divider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ marginLeft = " 59dp " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > index 922d837 . . 09b3e47 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { < nl > public CallMemberState getState ( ) { < nl > return state ; < nl > } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + return uid + " | " + state . name ( ) ; < nl > + } < nl > } < nl > \ No newline at end of file

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 index eb2015c . . 75694e9 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 @ @ - 14 , 6 + 14 , 7 @ @ import android . os . Bundle ; 
 import android . support . annotation . NonNull ; 
 import android . support . annotation . Nullable ; 
 import android . support . v4 . content . ContextCompat ; 
 + import android . support . v7 . widget . GridLayoutManager ; 
 import android . support . v7 . widget . LinearLayoutManager ; 
 import android . support . v7 . widget . RecyclerView ; 
 import android . util . Base64 ; 
 @ @ - 42 , 12 + 43 , 14 @ @ import im . actor . sdk . controllers . tools . MediaPickerFragment ; 
 import im . actor . sdk . util . SDKFeatures ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . view . ShareMenuButtonFactory ; 
 + import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; 
 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public class AttachFragment extends AbsAttachFragment implements MediaPickerCallback { 
 
 private static final int PERMISSION _ REQ _ MEDIA = 11 ; 
 + public static final int SPAN _ COUNT = 4 ; 
 
 private FrameLayout root ; 
 private View container ; 
 @ @ - 56 , 6 + 59 , 7 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 private TextView menuTitleToChange ; 
 
 private boolean isLoaded = false ; 
 + private RecyclerView fastShare ; 
 
 public AttachFragment ( Peer peer ) { 
 super ( peer ) ; 
 @ @ - 90 , 7 + 94 , 8 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 isLoaded = true ; 
 
 container = getLayoutInflater ( null ) . inflate ( R . layout . share _ menu , root , false ) ; 
 - container . setVisibility ( View . INVISIBLE ) ; 
 + fastShare = new RecyclerView ( getActivity ( ) ) ; 
 + fastShare . setVisibility ( View . INVISIBLE ) ; 
 
 container . findViewById ( R . id . menu _ bg ) . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 container . findViewById ( R . id . cancelField ) . setOnClickListener ( view - > hide ( ) ) ; 
 @ @ - 192 , 11 + 197 , 19 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 hide ( ) ; 
 } ; 
 
 - RecyclerView fastShare = ( RecyclerView ) container . findViewById ( R . id . fast _ share ) ; 
 + / / RecyclerView fastShare = ( RecyclerView ) container . findViewById ( R . id . fast _ share ) ; 
 fastAttachAdapter = new FastAttachAdapter ( getActivity ( ) ) ; 
 - LinearLayoutManager layoutManager = new LinearLayoutManager ( getActivity ( ) , LinearLayoutManager . HORIZONTAL , false ) ; 
 - fastShare . setAdapter ( fastAttachAdapter ) ; 
 + HeaderViewRecyclerAdapter adapter = new HeaderViewRecyclerAdapter ( fastAttachAdapter ) ; 
 + adapter . addHeaderView ( container ) ; 
 + GridLayoutManager layoutManager = new GridLayoutManager ( getActivity ( ) , SPAN _ COUNT ) ; 
 + fastShare . setAdapter ( adapter ) ; 
 fastShare . setLayoutManager ( layoutManager ) ; 
 + layoutManager . setSpanSizeLookup ( new GridLayoutManager . SpanSizeLookup ( ) { 
 + @ Override 
 + public int getSpanSize ( int position ) { 
 + return position = = 0 ? 4 : 1 ; 
 + } 
 + } ) ; 
 StateListDrawable background = ShareMenuButtonFactory . get ( style . getMainColor ( ) , getActivity ( ) ) ; 
 
 final View . OnClickListener finalDefaultSendOcl = defaultSendOcl ; 
 @ @ - 218 , 14 + 231 , 20 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 menuIconToChange . setPadding ( 0 , 0 , 0 , 0 ) ; 
 } 
 } ) ; 
 - 
 - root . addView ( container ) ; 
 + root . post ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + container . getLayoutParams ( ) . height = root . getHeight ( ) - Screen . dp ( 135 ) ; 
 + container . requestLayout ( ) ; 
 + } 
 + } ) ; 
 + root . addView ( fastShare ) ; 
 } 
 
 @ Override 
 public void show ( ) { 
 prepareView ( ) ; 
 - if ( container . getVisibility ( ) = = View . INVISIBLE ) { 
 + if ( fastShare . getVisibility ( ) = = View . INVISIBLE ) { 
 if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . M ) { 
 Activity activity = getActivity ( ) ; 
 if ( activity = = null ) { 
 @ @ - 240 , 58 + 259 , 58 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 } 
 onShown ( ) ; 
 messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Show ( ) ) ; 
 - showView ( container ) ; 
 - if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { 
 - View internal = container . findViewById ( R . id . menu _ bg ) ; 
 - int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; 
 - int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; 
 - float finalRadius = ( float ) Math . hypot ( cx , cy ) ; 
 - Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , 0 , finalRadius ) ; 
 - anim . setDuration ( 200 ) ; 
 - anim . start ( ) ; 
 - internal . setAlpha ( 1 ) ; 
 - } 
 + showView ( fastShare ) ; 
 + / / if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { 
 + / / View internal = container . findViewById ( R . id . menu _ bg ) ; 
 + / / int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; 
 + / / int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; 
 + / / float finalRadius = ( float ) Math . hypot ( cx , cy ) ; 
 + / / Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , 0 , finalRadius ) ; 
 + / / anim . setDuration ( 200 ) ; 
 + / / anim . start ( ) ; 
 + / / internal . setAlpha ( 1 ) ; 
 + / / } 
 } 
 } 
 
 @ Override 
 public void hide ( ) { 
 - if ( container ! = null & & container . getVisibility ( ) = = View . VISIBLE ) { 
 + if ( fastShare ! = null & & fastShare . getVisibility ( ) = = View . VISIBLE ) { 
 onHidden ( ) ; 
 fastAttachAdapter . clearSelected ( ) ; 
 messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Hide ( ) ) ; 
 - hideView ( container ) ; 
 - if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { 
 - View internal = container . findViewById ( R . id . menu _ bg ) ; 
 - int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; 
 - int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; 
 - float finalRadius = ( float ) Math . hypot ( cx , cy ) ; 
 - Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , finalRadius , 0 ) ; 
 - anim . addListener ( new Animator . AnimatorListener ( ) { 
 - @ Override 
 - public void onAnimationStart ( Animator animator ) { 
 - internal . setAlpha ( 1 ) ; 
 - } 
 - 
 - @ Override 
 - public void onAnimationEnd ( Animator animator ) { 
 - internal . setAlpha ( 0 ) ; 
 - } 
 - 
 - @ Override 
 - public void onAnimationCancel ( Animator animator ) { 
 - 
 - } 
 - 
 - @ Override 
 - public void onAnimationRepeat ( Animator animator ) { 
 - 
 - } 
 - } ) ; 
 - 
 - anim . setDuration ( 200 ) ; 
 - anim . start ( ) ; 
 - } 
 + hideView ( fastShare ) ; 
 + / / if ( android . os . Build . VERSION . SDK _ INT > = android . os . Build . VERSION _ CODES . LOLLIPOP ) { 
 + / / View internal = container . findViewById ( R . id . menu _ bg ) ; 
 + / / int cx = internal . getWidth ( ) - Screen . dp ( 56 + 56 ) ; 
 + / / int cy = internal . getHeight ( ) - Screen . dp ( 56 / 2 ) ; 
 + / / float finalRadius = ( float ) Math . hypot ( cx , cy ) ; 
 + / / Animator anim = ViewAnimationUtils . createCircularReveal ( internal , cx , cy , finalRadius , 0 ) ; 
 + / / anim . addListener ( new Animator . AnimatorListener ( ) { 
 + / / @ Override 
 + / / public void onAnimationStart ( Animator animator ) { 
 + / / internal . setAlpha ( 1 ) ; 
 + / / } 
 + / / 
 + / / @ Override 
 + / / public void onAnimationEnd ( Animator animator ) { 
 + / / internal . setAlpha ( 0 ) ; 
 + / / } 
 + / / 
 + / / @ Override 
 + / / public void onAnimationCancel ( Animator animator ) { 
 + / / 
 + / / } 
 + / / 
 + / / @ Override 
 + / / public void onAnimationRepeat ( Animator animator ) { 
 + / / 
 + / / } 
 + / / } ) ; 
 + / / 
 + / / anim . setDuration ( 200 ) ; 
 + / / anim . start ( ) ; 
 + / / } 
 } 
 } 
 
 @ @ - 411 , 6 + 430 , 7 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 fastAttachAdapter = null ; 
 } 
 container = null ; 
 + fastShare = null ; 
 root = null ; 
 menuIconToChange = null ; 
 menuTitleToChange = null ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java 
 index 9e75d4b . . 41b8db5 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / FastAttachAdapter . java 
 @ @ - 23 , 6 + 23 , 7 @ @ import java . util . HashSet ; 
 import java . util . Set ; 
 
 import im . actor . runtime . mvvm . ValueModel ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . ActorBinder ; 
 import im . actor . sdk . util . Screen ; 
 @ @ - 82 , 6 + 83 , 7 @ @ public class FastAttachAdapter extends RecyclerView . Adapter < FastAttachAdapter . Fa 
 
 public FastShareVH ( View itemView ) { 
 super ( itemView ) ; 
 + itemView . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 v = ( SimpleDraweeView ) itemView . findViewById ( R . id . image ) ; 
 chb = ( CheckBox ) itemView . findViewById ( R . id . check ) ; 
 int size = Screen . dp ( 80 ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 index 2daec0f . . b3bde0f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 @ @ - 13 , 14 + 13 , 14 @ @ 
 < LinearLayout 
 android : id = " @ + id / menu _ bg " 
 android : layout _ width = " match _ parent " 
 - android : layout _ height = " 286dp " 
 + android : layout _ height = " 196dp " 
 android : layout _ gravity = " bottom " 
 android : orientation = " vertical " > 
 
 - < android . support . v7 . widget . RecyclerView 
 - android : id = " @ + id / fast _ share " 
 - android : layout _ width = " match _ parent " 
 - android : layout _ height = " 90dp " / > 
 + < ! - - < android . support . v7 . widget . RecyclerView - - > 
 + < ! - - android : id = " @ + id / fast _ share " - - > 
 + < ! - - android : layout _ width = " match _ parent " - - > 
 + < ! - - android : layout _ height = " 90dp " / > - - > 
 
 < FrameLayout 
 android : id = " @ + id / share _ row _ one " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 index c75bcb5 . . 7817577 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 @ @ - 1 , 7 + 1 , 7 @ @ 
 < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 android : layout _ width = " wrap _ content " 
 - android : layout _ height = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 android : padding = " 5dp " > 
 
 < com . facebook . drawee . view . SimpleDraweeView

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index fa9298f . . 5bb61e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . Manifest ; 
 + import android . app . Activity ; 
 import android . app . Notification ; 
 import android . app . NotificationManager ; 
 import android . app . PendingIntent ; 
 @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; 
 import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 - import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . ListView ; 
 import android . widget . TextView ; 
 - import android . widget . Toast ; 
 
 import java . text . DateFormat ; 
 import java . text . SimpleDateFormat ; 
 + import java . util . ArrayList ; 
 import java . util . Date ; 
 import java . util . TimeZone ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . core . viewmodel . CallMember ; 
 import im . actor . core . viewmodel . CallState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . viewmodel . CallVM ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; 
 import im . actor . runtime . actors . messages . PoisonPill ; 
 import im . actor . runtime . mvvm . Value ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 - import im . actor . sdk . core . audio . AndroidPlayerActor ; 
 - import im . actor . sdk . core . audio . AudioPlayerActor ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . adapters . HolderAdapter ; 
 + import im . actor . sdk . view . adapters . ViewHolder ; 
 + import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { 
 / / 
 CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - 
 - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 - 
 TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 - bind ( nameTV , user . getName ( ) ) ; 
 + 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + 
 + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , user . getAvatar ( ) ) ; 
 + bind ( nameTV , user . getName ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , g . getAvatar ( ) ) ; 
 + bind ( nameTV , g . getName ( ) ) ; 
 + } 
 + 
 + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 + membersList . setAdapter ( membersAdapter ) ; 
 
 timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 } 
 
 - private void toastInCenter ( String s ) { 
 - Toast t = Toast . makeText ( getActivity ( ) , 
 - s , Toast . LENGTH _ SHORT ) ; 
 - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; 
 - t . show ( ) ; 
 - } 
 - 
 @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { 
 super . onResume ( ) ; 
 manager . cancel ( NOTIFICATION _ ID ) ; 
 } 
 + 
 + class CallMembersAdapter extends HolderAdapter < CallMember > { 
 + 
 + 
 + private ArrayList < CallMember > members ; 
 + 
 + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { 
 + super ( context ) ; 
 + this . members = members . get ( ) ; 
 + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { 
 + @ Override 
 + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { 
 + CallMembersAdapter . this . members = val ; 
 + notifyDataSetChanged ( ) ; 
 + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public int getCount ( ) { 
 + return members . size ( ) ; 
 + } 
 + 
 + @ Override 
 + public CallMember getItem ( int position ) { 
 + return members . get ( position ) ; 
 + } 
 + 
 + @ Override 
 + public long getItemId ( int position ) { 
 + return members . get ( position ) . getUid ( ) ; 
 + } 
 + 
 + @ Override 
 + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { 
 + return new MemberHolder ( ) ; 
 + } 
 + 
 + private class MemberHolder extends ViewHolder < CallMember > { 
 + 
 + CallMember data ; 
 + private TextView userName ; 
 + private TextView status ; 
 + private AvatarView avatarView ; 
 + 
 + @ Override 
 + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { 
 + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; 
 + 
 + userName = ( TextView ) res . findViewById ( R . id . name ) ; 
 + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + status = ( TextView ) res . findViewById ( R . id . status ) ; 
 + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; 
 + this . data = data ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void bind ( CallMember data , int position , Context context ) { 
 + UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + this . data = data ; 
 + avatarView . bind ( user ) ; 
 + userName . setText ( user . getName ( ) . get ( ) ) ; 
 + status . setText ( data . getState ( ) . name ( ) ) ; 
 + } 
 + 
 + 
 + @ Override 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 50aecee . . fe5738b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 menu . findItem ( R . id . call ) . setVisible ( false ) ; 
 } 
 
 @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 if ( item . getItemId ( ) = = R . id . call ) { 
 if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 private void startCall ( ) { 
 - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + Command < Long > cmd ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + 
 + } else { 
 + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; 
 + } 
 execute ( cmd , R . string . progress _ common ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 47ab3ad . . 6ce5969 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 37 , 6 + 37 , 11 @ @ 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 android : textSize = " @ dimen / text _ secondary " / > 
 + 
 + < ListView 
 + android : id = " @ + id / members _ list " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 < / LinearLayout > 
 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 new file mode 100644 
 index 0000000 . . fa1ed22 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 @ @ - 0 , 0 + 1 , 62 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : orientation = " horizontal " 
 + android : paddingRight = " 8dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 59dp " 
 + android : layout _ height = " 48dp " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 35dp " 
 + android : layout _ height = " 35dp " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / status " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / divider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ marginLeft = " 59dp " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 index 922d837 . . 09b3e47 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { 
 public CallMemberState getState ( ) { 
 return state ; 
 } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + return uid + " | " + state . name ( ) ; 
 + } 
 } 
 \ No newline at end of file
