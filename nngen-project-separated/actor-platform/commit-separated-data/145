BLEU SCORE: 0.04767707020457096

TEST MSG: Merge branch ' master ' into core / groups
GENERATED MSG: ref ( core ) : Improve initial state handling

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index fd6e8b0 . . 8c4f2fe 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 28 , 6 + 28 , 8 @ @ import im . actor . sdk . view . ActorToolbar ; < nl > public class ChatActivity extends BaseActivity { < nl > < nl > public static final String EXTRA _ CHAT _ PEER = " chat _ peer " ; < nl > + private String quote ; < nl > + private ChatFragment chatFragment ; < nl > < nl > private Toolbar toolbar ; < nl > < nl > @ @ - 94 , 14 + 96 , 11 @ @ public class ChatActivity extends BaseActivity { < nl > < nl > if ( saveInstance = = null ) { < nl > Peer peer = Peer . fromUniqueId ( getIntent ( ) . getExtras ( ) . getLong ( EXTRA _ CHAT _ PEER ) ) ; < nl > - ChatFragment chatFragment = ChatFragment . create ( peer ) ; < nl > + chatFragment = ChatFragment . create ( peer ) ; < nl > getSupportFragmentManager ( ) . beginTransaction ( ) < nl > . add ( R . id . chatFragment , chatFragment ) < nl > . commitNow ( ) ; < nl > - String quote = getIntent ( ) . getStringExtra ( " forward _ text _ raw " ) ; < nl > - if ( quote ! = null ) { < nl > - chatFragment . onMessageQuote ( quote ) ; < nl > - } < nl > + quote = getIntent ( ) . getStringExtra ( " forward _ text _ raw " ) ; < nl > } < nl > } < nl > < nl > @ @ - 129 , 6 + 128 , 15 @ @ public class ChatActivity extends BaseActivity { < nl > } < nl > < nl > @ Override < nl > + protected void onResume ( ) { < nl > + super . onResume ( ) ; < nl > + if ( quote ! = null ) { < nl > + chatFragment . onMessageQuote ( quote ) ; < nl > + quote = null ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > public ActionMode startSupportActionMode ( @ NonNull final ActionMode . Callback callback ) { < nl > / / Fix for bug https : / / code . google . com / p / android / issues / detail ? id = 159527 < nl > final ActionMode mode = super . startSupportActionMode ( callback ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > index 64c4262 . . af3804d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java < nl > @ @ - 368 , 8 + 368 , 8 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall < nl > } < nl > < nl > @ Override < nl > - public void onLocationPicked ( double latitude , double longitude , String street , String place ) { < nl > - messenger ( ) . sendLocation ( getPeer ( ) , longitude , longitude , street , place ) ; < nl > + public void onLocationPicked ( double longitude , double latitude , String street , String place ) { < nl > + messenger ( ) . sendLocation ( getPeer ( ) , longitude , latitude , street , place ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > index a2e00f0 . . 4f845ba 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > @ @ - 490 , 7 + 490 , 7 @ @ < nl > < nl > " Placeholder _ Empty _ Title " = " Invita a tus amigos " ; < nl > < nl > - " Placeholder _ Empty _ Message " = " Ninguno de tus contactos usar { appname } . Utiliza el bot 贸 n de abajo para invitarlos . " ; < nl > + " Placeholder _ Empty _ Message " = " Ninguno de tus contactos usan { appname } . Utiliza el bot 贸 n de abajo para invitarlos . " ; < nl > < nl > " Placeholder _ Empty _ Action " = " CONTAR A UN AMIGO " ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift < nl > index 3665e74 . . dd2c6c6 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift < nl > @ @ - 90 , 9 + 90 , 10 @ @ public class AARootTabViewController : UITabBarController , MFMessageComposeViewC < nl > } < nl > messageComposeController . body = AALocalized ( " InviteText " ) < nl > . replace ( " { link } " , dest : ActorSDK . sharedActor ( ) . inviteUrl ) < nl > + . replace ( " { appname } " , dest : ActorSDK . sharedActor ( ) . appName ) < nl > messageComposeController . navigationBar . tintColor = ActorSDK . sharedActor ( ) . style . navigationTitleColor < nl > presentViewController ( messageComposeController , animated : true , completion : { ( ) - > Void in < nl > - / / ActorSDK . sharedActor ( ) . style . appl < nl > + < nl > } ) < nl > } else { < nl > UIAlertView ( title : " Error " , message : " Cannot send SMS " , delegate : nil , cancelButtonTitle : " OK " ) . show ( ) < nl > diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > index a78aae7 . . 6ddf47c 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > @ @ - 324 , 9 + 324 , 6 @ @ public class AndroidMessenger extends im . actor . core . Messenger { < nl > picturePath = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 0 ] ) ) ; < nl > mimeType = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 1 ] ) ) ; < nl > fileName = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 2 ] ) ) ; < nl > - if ( mimeType = = null ) { < nl > - mimeType = " ? / ? " ; < nl > - } < nl > cursor . close ( ) ; < nl > } else { < nl > picturePath = uri . getPath ( ) ; < nl > @ @ - 339 , 6 + 336 , 10 @ @ public class AndroidMessenger extends im . actor . core . Messenger { < nl > } < nl > } < nl > < nl > + if ( mimeType = = null ) { < nl > + mimeType = " ? / ? " ; < nl > + } < nl > + < nl > if ( picturePath = = null | | ! uri . getScheme ( ) . equals ( " file " ) ) { < nl > File externalFile = context . getExternalFilesDir ( null ) ; < nl > if ( externalFile = = null ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > index 2618f6b . . c541833 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > @ @ - 78 , 6 + 78 , 8 @ @ public class BookImportActor extends ModuleActor { < nl > private void performSync ( ) { < nl > / / Ignoring syncing if not enabled < nl > if ( ! config ( ) . isEnablePhoneBookImport ( ) ) { < nl > + / / Marking as everything is imported < nl > + context ( ) . getAppStateModule ( ) . onBookImported ( ) ; < nl > return ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > index 6f69430 . . 384bc97 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > @ @ - 302 , 7 + 302 , 6 @ @ public class DialogsActor extends ModuleActor { < nl > } < nl > addOrUpdateItems ( updated ) ; < nl > updateSearch ( updated ) ; < nl > - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > notifyState ( true ) ; < nl > return Promise . success ( null ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java < nl > index 1226b01 . . 555a81c 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java < nl > @ @ - 44 , 6 + 44 , 8 @ @ public class DialogsHistoryActor extends ModuleActor { < nl > historyLoaded = preferences ( ) . getBool ( KEY _ LOADED , false ) ; < nl > if ( ! preferences ( ) . getBool ( KEY _ LOADED _ INIT , false ) ) { < nl > self ( ) . send ( new LoadMore ( ) ) ; < nl > + } else { < nl > + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > } < nl > } < nl > < nl > @ @ - 88 , 7 + 90 , 6 @ @ public class DialogsHistoryActor extends ModuleActor { < nl > } < nl > } ) ; < nl > } else { < nl > - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > markAsLoaded ( ) ; < nl > } < nl > } < nl > @ @ - 98 , 6 + 99 , 7 @ @ public class DialogsHistoryActor extends ModuleActor { < nl > historyLoaded = true ; < nl > preferences ( ) . putBool ( KEY _ LOADED , true ) ; < nl > preferences ( ) . putBool ( KEY _ LOADED _ INIT , true ) ; < nl > + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > } < nl > < nl > private void markAsSliceLoaded ( long date ) { < nl > @ @ - 107 , 6 + 109 , 7 @ @ public class DialogsHistoryActor extends ModuleActor { < nl > preferences ( ) . putBool ( KEY _ LOADED , false ) ; < nl > preferences ( ) . putBool ( KEY _ LOADED _ INIT , true ) ; < nl > preferences ( ) . putLong ( KEY _ LOADED _ DATE , date ) ; < nl > + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > } < nl > < nl > / / < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > index eba6428 . . fdc14ed 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > @ @ - 4 , 21 + 4 , 15 @ @ < nl > < nl > package im . actor . core . modules . misc ; < nl > < nl > - import im . actor . core . api . ApiAppCounters ; < nl > import im . actor . core . modules . AbsModule ; < nl > import im . actor . core . modules . ModuleContext ; < nl > import im . actor . core . viewmodel . AppStateVM ; < nl > import im . actor . core . viewmodel . GlobalStateVM ; < nl > - import im . actor . runtime . actors . ActorCreator ; < nl > - import im . actor . runtime . actors . ActorRef ; < nl > - < nl > - import static im . actor . runtime . actors . ActorSystem . system ; < nl > < nl > public class AppStateModule extends AbsModule { < nl > < nl > private AppStateVM appStateVM ; < nl > private GlobalStateVM globalStateVM ; < nl > - private ActorRef listStatesActor ; < nl > < nl > public AppStateModule ( ModuleContext context ) { < nl > super ( context ) ; < nl > @ @ - 28 , 27 + 22 , 26 @ @ public class AppStateModule extends AbsModule { < nl > < nl > public void run ( ) { < nl > this . appStateVM = new AppStateVM ( context ( ) ) ; < nl > - listStatesActor = system ( ) . actorOf ( " actor / app / state " , ( ) - > new ListsStatesActor ( context ( ) ) ) ; < nl > } < nl > < nl > public void onDialogsUpdate ( boolean isEmpty ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnDialogsChanged ( isEmpty ) ) ; < nl > + appStateVM . onDialogsChanged ( isEmpty ) ; < nl > } < nl > < nl > public void onContactsUpdate ( boolean isEmpty ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnContactsChanged ( isEmpty ) ) ; < nl > + appStateVM . onContactsChanged ( isEmpty ) ; < nl > } < nl > < nl > public void onBookImported ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnBookImported ( ) ) ; < nl > + appStateVM . onPhoneImported ( ) ; < nl > } < nl > < nl > public void onContactsLoaded ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnContactsLoaded ( ) ) ; < nl > + appStateVM . onContactsLoaded ( ) ; < nl > } < nl > < nl > public void onDialogsLoaded ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnDialogsLoaded ( ) ) ; < nl > + appStateVM . onDialogsLoaded ( ) ; < nl > } < nl > < nl > public AppStateVM getAppStateVM ( ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java < nl > deleted file mode 100644 < nl > index 7992638 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java < nl > + + + / dev / null < nl > @ @ - 1 , 88 + 0 , 0 @ @ < nl > - / * < nl > - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > - * / < nl > - < nl > - package im . actor . core . modules . misc ; < nl > - < nl > - import im . actor . core . modules . ModuleContext ; < nl > - import im . actor . core . modules . ModuleActor ; < nl > - < nl > - public class ListsStatesActor extends ModuleActor { < nl > - < nl > - public ListsStatesActor ( ModuleContext context ) { < nl > - super ( context ) ; < nl > - } < nl > - < nl > - public void onDialogsChanged ( boolean isEmpty ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsChanged ( isEmpty ) ; < nl > - } < nl > - < nl > - public void onContactsChanged ( boolean isEmpty ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsChanged ( isEmpty ) ; < nl > - } < nl > - < nl > - public void onBookImported ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onPhoneImported ( ) ; < nl > - } < nl > - < nl > - public void onContactsLoaded ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsLoaded ( ) ; < nl > - } < nl > - < nl > - public void onDialogsLoaded ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsLoaded ( ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onReceive ( Object message ) { < nl > - if ( message instanceof OnContactsChanged ) { < nl > - onContactsChanged ( ( ( OnContactsChanged ) message ) . isEmpty ( ) ) ; < nl > - } else if ( message instanceof OnDialogsChanged ) { < nl > - onDialogsChanged ( ( ( OnDialogsChanged ) message ) . isEmpty ( ) ) ; < nl > - } else if ( message instanceof OnBookImported ) { < nl > - onBookImported ( ) ; < nl > - } else if ( message instanceof OnContactsLoaded ) { < nl > - onContactsLoaded ( ) ; < nl > - } else if ( message instanceof OnDialogsLoaded ) { < nl > - onDialogsLoaded ( ) ; < nl > - } else { < nl > - super . onReceive ( message ) ; < nl > - } < nl > - } < nl > - < nl > - public static class OnBookImported { < nl > - < nl > - } < nl > - < nl > - public static class OnContactsLoaded { < nl > - < nl > - } < nl > - < nl > - public static class OnDialogsLoaded { < nl > - < nl > - } < nl > - < nl > - public static class OnContactsChanged { < nl > - private boolean isEmpty ; < nl > - < nl > - public OnContactsChanged ( boolean isEmpty ) { < nl > - this . isEmpty = isEmpty ; < nl > - } < nl > - < nl > - public boolean isEmpty ( ) { < nl > - return isEmpty ; < nl > - } < nl > - } < nl > - < nl > - public static class OnDialogsChanged { < nl > - private boolean isEmpty ; < nl > - < nl > - public OnDialogsChanged ( boolean isEmpty ) { < nl > - this . isEmpty = isEmpty ; < nl > - } < nl > - < nl > - public boolean isEmpty ( ) { < nl > - return isEmpty ; < nl > - } < nl > - } < nl > - }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > index 2618f6b . . c541833 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java < nl > @ @ - 78 , 6 + 78 , 8 @ @ public class BookImportActor extends ModuleActor { < nl > private void performSync ( ) { < nl > / / Ignoring syncing if not enabled < nl > if ( ! config ( ) . isEnablePhoneBookImport ( ) ) { < nl > + / / Marking as everything is imported < nl > + context ( ) . getAppStateModule ( ) . onBookImported ( ) ; < nl > return ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > index bde055b . . 994c545 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java < nl > @ @ - 301 , 7 + 301 , 6 @ @ public class DialogsActor extends ModuleActor { < nl > } < nl > addOrUpdateItems ( updated ) ; < nl > updateSearch ( updated ) ; < nl > - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; < nl > notifyState ( true ) ; < nl > return Promise . success ( null ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > index eba6428 . . fdc14ed 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java < nl > @ @ - 4 , 21 + 4 , 15 @ @ < nl > < nl > package im . actor . core . modules . misc ; < nl > < nl > - import im . actor . core . api . ApiAppCounters ; < nl > import im . actor . core . modules . AbsModule ; < nl > import im . actor . core . modules . ModuleContext ; < nl > import im . actor . core . viewmodel . AppStateVM ; < nl > import im . actor . core . viewmodel . GlobalStateVM ; < nl > - import im . actor . runtime . actors . ActorCreator ; < nl > - import im . actor . runtime . actors . ActorRef ; < nl > - < nl > - import static im . actor . runtime . actors . ActorSystem . system ; < nl > < nl > public class AppStateModule extends AbsModule { < nl > < nl > private AppStateVM appStateVM ; < nl > private GlobalStateVM globalStateVM ; < nl > - private ActorRef listStatesActor ; < nl > < nl > public AppStateModule ( ModuleContext context ) { < nl > super ( context ) ; < nl > @ @ - 28 , 27 + 22 , 26 @ @ public class AppStateModule extends AbsModule { < nl > < nl > public void run ( ) { < nl > this . appStateVM = new AppStateVM ( context ( ) ) ; < nl > - listStatesActor = system ( ) . actorOf ( " actor / app / state " , ( ) - > new ListsStatesActor ( context ( ) ) ) ; < nl > } < nl > < nl > public void onDialogsUpdate ( boolean isEmpty ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnDialogsChanged ( isEmpty ) ) ; < nl > + appStateVM . onDialogsChanged ( isEmpty ) ; < nl > } < nl > < nl > public void onContactsUpdate ( boolean isEmpty ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnContactsChanged ( isEmpty ) ) ; < nl > + appStateVM . onContactsChanged ( isEmpty ) ; < nl > } < nl > < nl > public void onBookImported ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnBookImported ( ) ) ; < nl > + appStateVM . onPhoneImported ( ) ; < nl > } < nl > < nl > public void onContactsLoaded ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnContactsLoaded ( ) ) ; < nl > + appStateVM . onContactsLoaded ( ) ; < nl > } < nl > < nl > public void onDialogsLoaded ( ) { < nl > - listStatesActor . send ( new ListsStatesActor . OnDialogsLoaded ( ) ) ; < nl > + appStateVM . onDialogsLoaded ( ) ; < nl > } < nl > < nl > public AppStateVM getAppStateVM ( ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java < nl > deleted file mode 100644 < nl > index 7992638 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java < nl > + + + / dev / null < nl > @ @ - 1 , 88 + 0 , 0 @ @ < nl > - / * < nl > - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > - * / < nl > - < nl > - package im . actor . core . modules . misc ; < nl > - < nl > - import im . actor . core . modules . ModuleContext ; < nl > - import im . actor . core . modules . ModuleActor ; < nl > - < nl > - public class ListsStatesActor extends ModuleActor { < nl > - < nl > - public ListsStatesActor ( ModuleContext context ) { < nl > - super ( context ) ; < nl > - } < nl > - < nl > - public void onDialogsChanged ( boolean isEmpty ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsChanged ( isEmpty ) ; < nl > - } < nl > - < nl > - public void onContactsChanged ( boolean isEmpty ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsChanged ( isEmpty ) ; < nl > - } < nl > - < nl > - public void onBookImported ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onPhoneImported ( ) ; < nl > - } < nl > - < nl > - public void onContactsLoaded ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsLoaded ( ) ; < nl > - } < nl > - < nl > - public void onDialogsLoaded ( ) { < nl > - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsLoaded ( ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onReceive ( Object message ) { < nl > - if ( message instanceof OnContactsChanged ) { < nl > - onContactsChanged ( ( ( OnContactsChanged ) message ) . isEmpty ( ) ) ; < nl > - } else if ( message instanceof OnDialogsChanged ) { < nl > - onDialogsChanged ( ( ( OnDialogsChanged ) message ) . isEmpty ( ) ) ; < nl > - } else if ( message instanceof OnBookImported ) { < nl > - onBookImported ( ) ; < nl > - } else if ( message instanceof OnContactsLoaded ) { < nl > - onContactsLoaded ( ) ; < nl > - } else if ( message instanceof OnDialogsLoaded ) { < nl > - onDialogsLoaded ( ) ; < nl > - } else { < nl > - super . onReceive ( message ) ; < nl > - } < nl > - } < nl > - < nl > - public static class OnBookImported { < nl > - < nl > - } < nl > - < nl > - public static class OnContactsLoaded { < nl > - < nl > - } < nl > - < nl > - public static class OnDialogsLoaded { < nl > - < nl > - } < nl > - < nl > - public static class OnContactsChanged { < nl > - private boolean isEmpty ; < nl > - < nl > - public OnContactsChanged ( boolean isEmpty ) { < nl > - this . isEmpty = isEmpty ; < nl > - } < nl > - < nl > - public boolean isEmpty ( ) { < nl > - return isEmpty ; < nl > - } < nl > - } < nl > - < nl > - public static class OnDialogsChanged { < nl > - private boolean isEmpty ; < nl > - < nl > - public OnDialogsChanged ( boolean isEmpty ) { < nl > - this . isEmpty = isEmpty ; < nl > - } < nl > - < nl > - public boolean isEmpty ( ) { < nl > - return isEmpty ; < nl > - } < nl > - } < nl > - }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index fd6e8b0 . . 8c4f2fe 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 28 , 6 + 28 , 8 @ @ import im . actor . sdk . view . ActorToolbar ; 
 public class ChatActivity extends BaseActivity { 
 
 public static final String EXTRA _ CHAT _ PEER = " chat _ peer " ; 
 + private String quote ; 
 + private ChatFragment chatFragment ; 
 
 private Toolbar toolbar ; 
 
 @ @ - 94 , 14 + 96 , 11 @ @ public class ChatActivity extends BaseActivity { 
 
 if ( saveInstance = = null ) { 
 Peer peer = Peer . fromUniqueId ( getIntent ( ) . getExtras ( ) . getLong ( EXTRA _ CHAT _ PEER ) ) ; 
 - ChatFragment chatFragment = ChatFragment . create ( peer ) ; 
 + chatFragment = ChatFragment . create ( peer ) ; 
 getSupportFragmentManager ( ) . beginTransaction ( ) 
 . add ( R . id . chatFragment , chatFragment ) 
 . commitNow ( ) ; 
 - String quote = getIntent ( ) . getStringExtra ( " forward _ text _ raw " ) ; 
 - if ( quote ! = null ) { 
 - chatFragment . onMessageQuote ( quote ) ; 
 - } 
 + quote = getIntent ( ) . getStringExtra ( " forward _ text _ raw " ) ; 
 } 
 } 
 
 @ @ - 129 , 6 + 128 , 15 @ @ public class ChatActivity extends BaseActivity { 
 } 
 
 @ Override 
 + protected void onResume ( ) { 
 + super . onResume ( ) ; 
 + if ( quote ! = null ) { 
 + chatFragment . onMessageQuote ( quote ) ; 
 + quote = null ; 
 + } 
 + } 
 + 
 + @ Override 
 public ActionMode startSupportActionMode ( @ NonNull final ActionMode . Callback callback ) { 
 / / Fix for bug https : / / code . google . com / p / android / issues / detail ? id = 159527 
 final ActionMode mode = super . startSupportActionMode ( callback ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 index 64c4262 . . af3804d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / attach / AttachFragment . java 
 @ @ - 368 , 8 + 368 , 8 @ @ public class AttachFragment extends AbsAttachFragment implements MediaPickerCall 
 } 
 
 @ Override 
 - public void onLocationPicked ( double latitude , double longitude , String street , String place ) { 
 - messenger ( ) . sendLocation ( getPeer ( ) , longitude , longitude , street , place ) ; 
 + public void onLocationPicked ( double longitude , double latitude , String street , String place ) { 
 + messenger ( ) . sendLocation ( getPeer ( ) , longitude , latitude , street , place ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 index a2e00f0 . . 4f845ba 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 @ @ - 490 , 7 + 490 , 7 @ @ 
 
 " Placeholder _ Empty _ Title " = " Invita a tus amigos " ; 
 
 - " Placeholder _ Empty _ Message " = " Ninguno de tus contactos usar { appname } . Utiliza el bot 贸 n de abajo para invitarlos . " ; 
 + " Placeholder _ Empty _ Message " = " Ninguno de tus contactos usan { appname } . Utiliza el bot 贸 n de abajo para invitarlos . " ; 
 
 " Placeholder _ Empty _ Action " = " CONTAR A UN AMIGO " ; 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift 
 index 3665e74 . . dd2c6c6 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Root / AARootTabViewController . swift 
 @ @ - 90 , 9 + 90 , 10 @ @ public class AARootTabViewController : UITabBarController , MFMessageComposeViewC 
 } 
 messageComposeController . body = AALocalized ( " InviteText " ) 
 . replace ( " { link } " , dest : ActorSDK . sharedActor ( ) . inviteUrl ) 
 + . replace ( " { appname } " , dest : ActorSDK . sharedActor ( ) . appName ) 
 messageComposeController . navigationBar . tintColor = ActorSDK . sharedActor ( ) . style . navigationTitleColor 
 presentViewController ( messageComposeController , animated : true , completion : { ( ) - > Void in 
 - / / ActorSDK . sharedActor ( ) . style . appl 
 + 
 } ) 
 } else { 
 UIAlertView ( title : " Error " , message : " Cannot send SMS " , delegate : nil , cancelButtonTitle : " OK " ) . show ( ) 
 diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 index a78aae7 . . 6ddf47c 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 @ @ - 324 , 9 + 324 , 6 @ @ public class AndroidMessenger extends im . actor . core . Messenger { 
 picturePath = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 0 ] ) ) ; 
 mimeType = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 1 ] ) ) ; 
 fileName = cursor . getString ( cursor . getColumnIndex ( filePathColumn [ 2 ] ) ) ; 
 - if ( mimeType = = null ) { 
 - mimeType = " ? / ? " ; 
 - } 
 cursor . close ( ) ; 
 } else { 
 picturePath = uri . getPath ( ) ; 
 @ @ - 339 , 6 + 336 , 10 @ @ public class AndroidMessenger extends im . actor . core . Messenger { 
 } 
 } 
 
 + if ( mimeType = = null ) { 
 + mimeType = " ? / ? " ; 
 + } 
 + 
 if ( picturePath = = null | | ! uri . getScheme ( ) . equals ( " file " ) ) { 
 File externalFile = context . getExternalFilesDir ( null ) ; 
 if ( externalFile = = null ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 index 2618f6b . . c541833 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 @ @ - 78 , 6 + 78 , 8 @ @ public class BookImportActor extends ModuleActor { 
 private void performSync ( ) { 
 / / Ignoring syncing if not enabled 
 if ( ! config ( ) . isEnablePhoneBookImport ( ) ) { 
 + / / Marking as everything is imported 
 + context ( ) . getAppStateModule ( ) . onBookImported ( ) ; 
 return ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 index 6f69430 . . 384bc97 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 @ @ - 302 , 7 + 302 , 6 @ @ public class DialogsActor extends ModuleActor { 
 } 
 addOrUpdateItems ( updated ) ; 
 updateSearch ( updated ) ; 
 - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 notifyState ( true ) ; 
 return Promise . success ( null ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java 
 index 1226b01 . . 555a81c 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / history / DialogsHistoryActor . java 
 @ @ - 44 , 6 + 44 , 8 @ @ public class DialogsHistoryActor extends ModuleActor { 
 historyLoaded = preferences ( ) . getBool ( KEY _ LOADED , false ) ; 
 if ( ! preferences ( ) . getBool ( KEY _ LOADED _ INIT , false ) ) { 
 self ( ) . send ( new LoadMore ( ) ) ; 
 + } else { 
 + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 } 
 } 
 
 @ @ - 88 , 7 + 90 , 6 @ @ public class DialogsHistoryActor extends ModuleActor { 
 } 
 } ) ; 
 } else { 
 - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 markAsLoaded ( ) ; 
 } 
 } 
 @ @ - 98 , 6 + 99 , 7 @ @ public class DialogsHistoryActor extends ModuleActor { 
 historyLoaded = true ; 
 preferences ( ) . putBool ( KEY _ LOADED , true ) ; 
 preferences ( ) . putBool ( KEY _ LOADED _ INIT , true ) ; 
 + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 } 
 
 private void markAsSliceLoaded ( long date ) { 
 @ @ - 107 , 6 + 109 , 7 @ @ public class DialogsHistoryActor extends ModuleActor { 
 preferences ( ) . putBool ( KEY _ LOADED , false ) ; 
 preferences ( ) . putBool ( KEY _ LOADED _ INIT , true ) ; 
 preferences ( ) . putLong ( KEY _ LOADED _ DATE , date ) ; 
 + context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 } 
 
 / / 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 index eba6428 . . fdc14ed 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 @ @ - 4 , 21 + 4 , 15 @ @ 
 
 package im . actor . core . modules . misc ; 
 
 - import im . actor . core . api . ApiAppCounters ; 
 import im . actor . core . modules . AbsModule ; 
 import im . actor . core . modules . ModuleContext ; 
 import im . actor . core . viewmodel . AppStateVM ; 
 import im . actor . core . viewmodel . GlobalStateVM ; 
 - import im . actor . runtime . actors . ActorCreator ; 
 - import im . actor . runtime . actors . ActorRef ; 
 - 
 - import static im . actor . runtime . actors . ActorSystem . system ; 
 
 public class AppStateModule extends AbsModule { 
 
 private AppStateVM appStateVM ; 
 private GlobalStateVM globalStateVM ; 
 - private ActorRef listStatesActor ; 
 
 public AppStateModule ( ModuleContext context ) { 
 super ( context ) ; 
 @ @ - 28 , 27 + 22 , 26 @ @ public class AppStateModule extends AbsModule { 
 
 public void run ( ) { 
 this . appStateVM = new AppStateVM ( context ( ) ) ; 
 - listStatesActor = system ( ) . actorOf ( " actor / app / state " , ( ) - > new ListsStatesActor ( context ( ) ) ) ; 
 } 
 
 public void onDialogsUpdate ( boolean isEmpty ) { 
 - listStatesActor . send ( new ListsStatesActor . OnDialogsChanged ( isEmpty ) ) ; 
 + appStateVM . onDialogsChanged ( isEmpty ) ; 
 } 
 
 public void onContactsUpdate ( boolean isEmpty ) { 
 - listStatesActor . send ( new ListsStatesActor . OnContactsChanged ( isEmpty ) ) ; 
 + appStateVM . onContactsChanged ( isEmpty ) ; 
 } 
 
 public void onBookImported ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnBookImported ( ) ) ; 
 + appStateVM . onPhoneImported ( ) ; 
 } 
 
 public void onContactsLoaded ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnContactsLoaded ( ) ) ; 
 + appStateVM . onContactsLoaded ( ) ; 
 } 
 
 public void onDialogsLoaded ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnDialogsLoaded ( ) ) ; 
 + appStateVM . onDialogsLoaded ( ) ; 
 } 
 
 public AppStateVM getAppStateVM ( ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java 
 deleted file mode 100644 
 index 7992638 . . 0000000 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java 
 + + + / dev / null 
 @ @ - 1 , 88 + 0 , 0 @ @ 
 - / * 
 - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 - * / 
 - 
 - package im . actor . core . modules . misc ; 
 - 
 - import im . actor . core . modules . ModuleContext ; 
 - import im . actor . core . modules . ModuleActor ; 
 - 
 - public class ListsStatesActor extends ModuleActor { 
 - 
 - public ListsStatesActor ( ModuleContext context ) { 
 - super ( context ) ; 
 - } 
 - 
 - public void onDialogsChanged ( boolean isEmpty ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsChanged ( isEmpty ) ; 
 - } 
 - 
 - public void onContactsChanged ( boolean isEmpty ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsChanged ( isEmpty ) ; 
 - } 
 - 
 - public void onBookImported ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onPhoneImported ( ) ; 
 - } 
 - 
 - public void onContactsLoaded ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsLoaded ( ) ; 
 - } 
 - 
 - public void onDialogsLoaded ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsLoaded ( ) ; 
 - } 
 - 
 - @ Override 
 - public void onReceive ( Object message ) { 
 - if ( message instanceof OnContactsChanged ) { 
 - onContactsChanged ( ( ( OnContactsChanged ) message ) . isEmpty ( ) ) ; 
 - } else if ( message instanceof OnDialogsChanged ) { 
 - onDialogsChanged ( ( ( OnDialogsChanged ) message ) . isEmpty ( ) ) ; 
 - } else if ( message instanceof OnBookImported ) { 
 - onBookImported ( ) ; 
 - } else if ( message instanceof OnContactsLoaded ) { 
 - onContactsLoaded ( ) ; 
 - } else if ( message instanceof OnDialogsLoaded ) { 
 - onDialogsLoaded ( ) ; 
 - } else { 
 - super . onReceive ( message ) ; 
 - } 
 - } 
 - 
 - public static class OnBookImported { 
 - 
 - } 
 - 
 - public static class OnContactsLoaded { 
 - 
 - } 
 - 
 - public static class OnDialogsLoaded { 
 - 
 - } 
 - 
 - public static class OnContactsChanged { 
 - private boolean isEmpty ; 
 - 
 - public OnContactsChanged ( boolean isEmpty ) { 
 - this . isEmpty = isEmpty ; 
 - } 
 - 
 - public boolean isEmpty ( ) { 
 - return isEmpty ; 
 - } 
 - } 
 - 
 - public static class OnDialogsChanged { 
 - private boolean isEmpty ; 
 - 
 - public OnDialogsChanged ( boolean isEmpty ) { 
 - this . isEmpty = isEmpty ; 
 - } 
 - 
 - public boolean isEmpty ( ) { 
 - return isEmpty ; 
 - } 
 - } 
 - }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 index 2618f6b . . c541833 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / contacts / BookImportActor . java 
 @ @ - 78 , 6 + 78 , 8 @ @ public class BookImportActor extends ModuleActor { 
 private void performSync ( ) { 
 / / Ignoring syncing if not enabled 
 if ( ! config ( ) . isEnablePhoneBookImport ( ) ) { 
 + / / Marking as everything is imported 
 + context ( ) . getAppStateModule ( ) . onBookImported ( ) ; 
 return ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 index bde055b . . 994c545 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / dialogs / DialogsActor . java 
 @ @ - 301 , 7 + 301 , 6 @ @ public class DialogsActor extends ModuleActor { 
 } 
 addOrUpdateItems ( updated ) ; 
 updateSearch ( updated ) ; 
 - context ( ) . getAppStateModule ( ) . onDialogsLoaded ( ) ; 
 notifyState ( true ) ; 
 return Promise . success ( null ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 index eba6428 . . fdc14ed 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / AppStateModule . java 
 @ @ - 4 , 21 + 4 , 15 @ @ 
 
 package im . actor . core . modules . misc ; 
 
 - import im . actor . core . api . ApiAppCounters ; 
 import im . actor . core . modules . AbsModule ; 
 import im . actor . core . modules . ModuleContext ; 
 import im . actor . core . viewmodel . AppStateVM ; 
 import im . actor . core . viewmodel . GlobalStateVM ; 
 - import im . actor . runtime . actors . ActorCreator ; 
 - import im . actor . runtime . actors . ActorRef ; 
 - 
 - import static im . actor . runtime . actors . ActorSystem . system ; 
 
 public class AppStateModule extends AbsModule { 
 
 private AppStateVM appStateVM ; 
 private GlobalStateVM globalStateVM ; 
 - private ActorRef listStatesActor ; 
 
 public AppStateModule ( ModuleContext context ) { 
 super ( context ) ; 
 @ @ - 28 , 27 + 22 , 26 @ @ public class AppStateModule extends AbsModule { 
 
 public void run ( ) { 
 this . appStateVM = new AppStateVM ( context ( ) ) ; 
 - listStatesActor = system ( ) . actorOf ( " actor / app / state " , ( ) - > new ListsStatesActor ( context ( ) ) ) ; 
 } 
 
 public void onDialogsUpdate ( boolean isEmpty ) { 
 - listStatesActor . send ( new ListsStatesActor . OnDialogsChanged ( isEmpty ) ) ; 
 + appStateVM . onDialogsChanged ( isEmpty ) ; 
 } 
 
 public void onContactsUpdate ( boolean isEmpty ) { 
 - listStatesActor . send ( new ListsStatesActor . OnContactsChanged ( isEmpty ) ) ; 
 + appStateVM . onContactsChanged ( isEmpty ) ; 
 } 
 
 public void onBookImported ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnBookImported ( ) ) ; 
 + appStateVM . onPhoneImported ( ) ; 
 } 
 
 public void onContactsLoaded ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnContactsLoaded ( ) ) ; 
 + appStateVM . onContactsLoaded ( ) ; 
 } 
 
 public void onDialogsLoaded ( ) { 
 - listStatesActor . send ( new ListsStatesActor . OnDialogsLoaded ( ) ) ; 
 + appStateVM . onDialogsLoaded ( ) ; 
 } 
 
 public AppStateVM getAppStateVM ( ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java 
 deleted file mode 100644 
 index 7992638 . . 0000000 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / misc / ListsStatesActor . java 
 + + + / dev / null 
 @ @ - 1 , 88 + 0 , 0 @ @ 
 - / * 
 - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 - * / 
 - 
 - package im . actor . core . modules . misc ; 
 - 
 - import im . actor . core . modules . ModuleContext ; 
 - import im . actor . core . modules . ModuleActor ; 
 - 
 - public class ListsStatesActor extends ModuleActor { 
 - 
 - public ListsStatesActor ( ModuleContext context ) { 
 - super ( context ) ; 
 - } 
 - 
 - public void onDialogsChanged ( boolean isEmpty ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsChanged ( isEmpty ) ; 
 - } 
 - 
 - public void onContactsChanged ( boolean isEmpty ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsChanged ( isEmpty ) ; 
 - } 
 - 
 - public void onBookImported ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onPhoneImported ( ) ; 
 - } 
 - 
 - public void onContactsLoaded ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onContactsLoaded ( ) ; 
 - } 
 - 
 - public void onDialogsLoaded ( ) { 
 - context ( ) . getAppStateModule ( ) . getAppStateVM ( ) . onDialogsLoaded ( ) ; 
 - } 
 - 
 - @ Override 
 - public void onReceive ( Object message ) { 
 - if ( message instanceof OnContactsChanged ) { 
 - onContactsChanged ( ( ( OnContactsChanged ) message ) . isEmpty ( ) ) ; 
 - } else if ( message instanceof OnDialogsChanged ) { 
 - onDialogsChanged ( ( ( OnDialogsChanged ) message ) . isEmpty ( ) ) ; 
 - } else if ( message instanceof OnBookImported ) { 
 - onBookImported ( ) ; 
 - } else if ( message instanceof OnContactsLoaded ) { 
 - onContactsLoaded ( ) ; 
 - } else if ( message instanceof OnDialogsLoaded ) { 
 - onDialogsLoaded ( ) ; 
 - } else { 
 - super . onReceive ( message ) ; 
 - } 
 - } 
 - 
 - public static class OnBookImported { 
 - 
 - } 
 - 
 - public static class OnContactsLoaded { 
 - 
 - } 
 - 
 - public static class OnDialogsLoaded { 
 - 
 - } 
 - 
 - public static class OnContactsChanged { 
 - private boolean isEmpty ; 
 - 
 - public OnContactsChanged ( boolean isEmpty ) { 
 - this . isEmpty = isEmpty ; 
 - } 
 - 
 - public boolean isEmpty ( ) { 
 - return isEmpty ; 
 - } 
 - } 
 - 
 - public static class OnDialogsChanged { 
 - private boolean isEmpty ; 
 - 
 - public OnDialogsChanged ( boolean isEmpty ) { 
 - this . isEmpty = isEmpty ; 
 - } 
 - 
 - public boolean isEmpty ( ) { 
 - return isEmpty ; 
 - } 
 - } 
 - }
