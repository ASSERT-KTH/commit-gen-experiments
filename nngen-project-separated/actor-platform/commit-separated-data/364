BLEU SCORE: 0.45622720708659226

TEST MSG: fix ( android ) : AndroidMarkdown extract AppCompatContext
GENERATED MSG: fix ( android ) : phoneBook permission on M

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java < nl > index ea4662c . . 1cd91ab 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java < nl > @ @ - 1 , 8 + 1 , 10 @ @ < nl > package im . actor . sdk . view . markdown ; < nl > < nl > + import android . app . Activity ; < nl > import android . app . ActivityOptions ; < nl > import android . app . PendingIntent ; < nl > import android . content . Context ; < nl > + import android . content . ContextWrapper ; < nl > import android . content . Intent ; < nl > import android . graphics . Bitmap ; < nl > import android . graphics . BitmapFactory ; < nl > @ @ - 11 , 6 + 13 , 7 @ @ import android . graphics . Typeface ; < nl > import android . net . Uri ; < nl > import android . os . Build ; < nl > import android . os . Bundle ; < nl > + import android . support . v7 . app . AppCompatActivity ; < nl > import android . text . Spannable ; < nl > import android . text . SpannableStringBuilder ; < nl > import android . text . Spanned ; < nl > @ @ - 117 , 6 + 120 , 7 @ @ public class AndroidMarkdown { < nl > public void onClick ( View view ) { < nl > Context ctx = view . getContext ( ) ; < nl > if ( url . getUrl ( ) . startsWith ( " send : " ) ) { < nl > + ctx = extractContext ( ctx ) ; < nl > if ( ctx instanceof ChatActivity ) { < nl > ActorSDK . sharedActor ( ) . getMessenger ( ) . sendMessage ( ( ( ChatActivity ) ctx ) . getPeer ( ) , url . getUrl ( ) . replace ( " send : " , " " ) ) ; < nl > } < nl > @ @ - 145 , 6 + 149 , 16 @ @ public class AndroidMarkdown { < nl > } < nl > } < nl > < nl > + private static Context extractContext ( Context ctx ) { < nl > + if ( ctx instanceof AppCompatActivity ) { < nl > + return ctx ; < nl > + } else if ( ctx instanceof ContextWrapper ) { < nl > + return extractContext ( ( ( ContextWrapper ) ctx ) . getBaseContext ( ) ) ; < nl > + } < nl > + < nl > + return ctx ; < nl > + } < nl > + < nl > public static CustomTabsIntent buildChromeIntent ( ) { < nl > CustomTabsIntent . Builder customTabsIntent = new CustomTabsIntent . Builder ( ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java < nl > index 838f9a0 . . 442ef35 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java < nl > @ @ - 1 , 6 + 1 , 9 @ @ < nl > package im . actor . sdk . controllers . conversation ; < nl > < nl > + import android . content . Intent ; < nl > + import android . os . Build ; < nl > import android . os . Bundle ; < nl > + import android . provider . Settings ; < nl > import android . support . v4 . app . Fragment ; < nl > import android . view . KeyEvent ; < nl > import android . view . View ; < nl > @ @ - 9 , 12 + 12 , 14 @ @ import android . widget . EditText ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > import android . widget . TextView ; < nl > + import android . widget . Toast ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . activity . BaseActivity ; < nl > import im . actor . sdk . util . KeyboardHelper ; < nl > import im . actor . sdk . view . TintImageView ; < nl > + import im . actor . sdk . view . emoji . keyboard . BaseKeyboard ; < nl > import im . actor . sdk . view . emoji . keyboard . KeyboardStatusListener ; < nl > import im . actor . sdk . view . emoji . keyboard . emoji . EmojiKeyboard ; < nl > < nl > @ @ - 188 , 4 + 193 , 18 @ @ public abstract class ActorEditTextActivity extends BaseActivity { < nl > / / Destroy emoji keyboard < nl > emojiKeyboard . destroy ( ) ; < nl > } < nl > + < nl > + @ Override < nl > + protected void onActivityResult ( int requestCode , int resultCode , Intent data ) { < nl > + if ( requestCode = = BaseKeyboard . OVERLAY _ PERMISSION _ REQ _ CODE ) { < nl > + if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . M ) { < nl > + if ( ! Settings . canDrawOverlays ( this ) ) { < nl > + Toast . makeText ( this , " Ooops , emoji Keyboard needs overlay permission " , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + } else { < nl > + emojiKeyboard . showChecked ( ) ; < nl > + } < nl > + } < nl > + } < nl > + super . onActivityResult ( requestCode , resultCode , data ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java < nl > index 473f804 . . cda9cfd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java < nl > @ @ - 1 , 10 + 1 , 13 @ @ < nl > package im . actor . sdk . core ; < nl > < nl > + import android . Manifest ; < nl > import android . content . ContentResolver ; < nl > import android . content . Context ; < nl > + import android . content . pm . PackageManager ; < nl > import android . database . Cursor ; < nl > import android . os . SystemClock ; < nl > import android . provider . ContactsContract ; < nl > + import android . support . v4 . content . ContextCompat ; < nl > < nl > import com . google . i18n . phonenumbers . NumberParseException ; < nl > import com . google . i18n . phonenumbers . PhoneNumberUtil ; < nl > @ @ - 68 , 6 + 71 , 12 @ @ public class AndroidPhoneBook implements PhoneBookProvider { < nl > < nl > / / Loading records < nl > / / TODO : Better logic for duplicate phones < nl > + / / Check have permission for this < nl > + if ( ContextCompat . checkSelfPermission ( context , Manifest . permission . WRITE _ CONTACTS ) ! = PackageManager . PERMISSION _ GRANTED & & < nl > + ContextCompat . checkSelfPermission ( context , Manifest . permission . READ _ CONTACTS ) ! = PackageManager . PERMISSION _ GRANTED ) { < nl > + Log . d ( " Permissions " , " contacts - no permission : c " ) ; < nl > + return new ArrayList < PhoneBookContact > ( ) ; < nl > + } < nl > Cursor cur = cr . query ( ContactsContract . Contacts . CONTENT _ URI , < nl > new String [ ] < nl > {

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java 
 index ea4662c . . 1cd91ab 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / markdown / AndroidMarkdown . java 
 @ @ - 1 , 8 + 1 , 10 @ @ 
 package im . actor . sdk . view . markdown ; 
 
 + import android . app . Activity ; 
 import android . app . ActivityOptions ; 
 import android . app . PendingIntent ; 
 import android . content . Context ; 
 + import android . content . ContextWrapper ; 
 import android . content . Intent ; 
 import android . graphics . Bitmap ; 
 import android . graphics . BitmapFactory ; 
 @ @ - 11 , 6 + 13 , 7 @ @ import android . graphics . Typeface ; 
 import android . net . Uri ; 
 import android . os . Build ; 
 import android . os . Bundle ; 
 + import android . support . v7 . app . AppCompatActivity ; 
 import android . text . Spannable ; 
 import android . text . SpannableStringBuilder ; 
 import android . text . Spanned ; 
 @ @ - 117 , 6 + 120 , 7 @ @ public class AndroidMarkdown { 
 public void onClick ( View view ) { 
 Context ctx = view . getContext ( ) ; 
 if ( url . getUrl ( ) . startsWith ( " send : " ) ) { 
 + ctx = extractContext ( ctx ) ; 
 if ( ctx instanceof ChatActivity ) { 
 ActorSDK . sharedActor ( ) . getMessenger ( ) . sendMessage ( ( ( ChatActivity ) ctx ) . getPeer ( ) , url . getUrl ( ) . replace ( " send : " , " " ) ) ; 
 } 
 @ @ - 145 , 6 + 149 , 16 @ @ public class AndroidMarkdown { 
 } 
 } 
 
 + private static Context extractContext ( Context ctx ) { 
 + if ( ctx instanceof AppCompatActivity ) { 
 + return ctx ; 
 + } else if ( ctx instanceof ContextWrapper ) { 
 + return extractContext ( ( ( ContextWrapper ) ctx ) . getBaseContext ( ) ) ; 
 + } 
 + 
 + return ctx ; 
 + } 
 + 
 public static CustomTabsIntent buildChromeIntent ( ) { 
 CustomTabsIntent . Builder customTabsIntent = new CustomTabsIntent . Builder ( ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java 
 index 838f9a0 . . 442ef35 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ActorEditTextActivity . java 
 @ @ - 1 , 6 + 1 , 9 @ @ 
 package im . actor . sdk . controllers . conversation ; 
 
 + import android . content . Intent ; 
 + import android . os . Build ; 
 import android . os . Bundle ; 
 + import android . provider . Settings ; 
 import android . support . v4 . app . Fragment ; 
 import android . view . KeyEvent ; 
 import android . view . View ; 
 @ @ - 9 , 12 + 12 , 14 @ @ import android . widget . EditText ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 import android . widget . TextView ; 
 + import android . widget . Toast ; 
 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . activity . BaseActivity ; 
 import im . actor . sdk . util . KeyboardHelper ; 
 import im . actor . sdk . view . TintImageView ; 
 + import im . actor . sdk . view . emoji . keyboard . BaseKeyboard ; 
 import im . actor . sdk . view . emoji . keyboard . KeyboardStatusListener ; 
 import im . actor . sdk . view . emoji . keyboard . emoji . EmojiKeyboard ; 
 
 @ @ - 188 , 4 + 193 , 18 @ @ public abstract class ActorEditTextActivity extends BaseActivity { 
 / / Destroy emoji keyboard 
 emojiKeyboard . destroy ( ) ; 
 } 
 + 
 + @ Override 
 + protected void onActivityResult ( int requestCode , int resultCode , Intent data ) { 
 + if ( requestCode = = BaseKeyboard . OVERLAY _ PERMISSION _ REQ _ CODE ) { 
 + if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . M ) { 
 + if ( ! Settings . canDrawOverlays ( this ) ) { 
 + Toast . makeText ( this , " Ooops , emoji Keyboard needs overlay permission " , Toast . LENGTH _ LONG ) . show ( ) ; 
 + } else { 
 + emojiKeyboard . showChecked ( ) ; 
 + } 
 + } 
 + } 
 + super . onActivityResult ( requestCode , resultCode , data ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java 
 index 473f804 . . cda9cfd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / core / AndroidPhoneBook . java 
 @ @ - 1 , 10 + 1 , 13 @ @ 
 package im . actor . sdk . core ; 
 
 + import android . Manifest ; 
 import android . content . ContentResolver ; 
 import android . content . Context ; 
 + import android . content . pm . PackageManager ; 
 import android . database . Cursor ; 
 import android . os . SystemClock ; 
 import android . provider . ContactsContract ; 
 + import android . support . v4 . content . ContextCompat ; 
 
 import com . google . i18n . phonenumbers . NumberParseException ; 
 import com . google . i18n . phonenumbers . PhoneNumberUtil ; 
 @ @ - 68 , 6 + 71 , 12 @ @ public class AndroidPhoneBook implements PhoneBookProvider { 
 
 / / Loading records 
 / / TODO : Better logic for duplicate phones 
 + / / Check have permission for this 
 + if ( ContextCompat . checkSelfPermission ( context , Manifest . permission . WRITE _ CONTACTS ) ! = PackageManager . PERMISSION _ GRANTED & & 
 + ContextCompat . checkSelfPermission ( context , Manifest . permission . READ _ CONTACTS ) ! = PackageManager . PERMISSION _ GRANTED ) { 
 + Log . d ( " Permissions " , " contacts - no permission : c " ) ; 
 + return new ArrayList < PhoneBookContact > ( ) ; 
 + } 
 Cursor cur = cr . query ( ContactsContract . Contacts . CONTENT _ URI , 
 new String [ ] 
 {
