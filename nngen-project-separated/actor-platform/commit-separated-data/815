BLEU SCORE: 0.35084396956386854

TEST MSG: feat ( iOS ) : Update App UI for calls support
GENERATED MSG: feat ( iOS ) : Implemented analytics and fixed autocomplete

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index ca87820 . . db07441 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 693 , 7 + 693 , 6 @ @ < nl > 	 	 	 children = ( < nl > 	 	 	 	 069CF4151BCA5DB500C66E12 / * Sources * / , < nl > 	 	 	 	 065975081BC7C4F300B8C7DF / * Resources * / , < nl > - 	 	 	 	 06E323091C693A4E00D66F53 / * Libs * / , < nl > 	 	 	 ) ; < nl > 	 	 	 path = ActorSDK ; < nl > 	 	 	 sourceTree = " < group > " ; < nl > @ @ - 1175 , 13 + 1174 , 6 @ @ < nl > 	 	 	 name = Libs ; < nl > 	 	 	 sourceTree = " < group > " ; < nl > 	 	 } ; < nl > - 	 	 06E323091C693A4E00D66F53 / * Libs * / = { < nl > - 	 	 	 isa = PBXGroup ; < nl > - 	 	 	 children = ( < nl > - 	 	 	 ) ; < nl > - 	 	 	 name = Libs ; < nl > - 	 	 	 sourceTree = " < group > " ; < nl > - 	 	 } ; < nl > 	 	 06E323131C6A7AA300D66F53 / * Calls * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json < nl > index 5c85eda . . c11275a 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json < nl > @ @ - 2 , 17 + 2 , 16 @ @ < nl > " images " : [ < nl > { < nl > " idiom " : " universal " , < nl > - " filename " : " callIcon _ 22 @ 1x . png " , < nl > " scale " : " 1x " < nl > } , < nl > { < nl > " idiom " : " universal " , < nl > - " filename " : " callIcon _ 22 @ 2x . png " , < nl > + " filename " : " Phone - 44 . png " , < nl > " scale " : " 2x " < nl > } , < nl > { < nl > " idiom " : " universal " , < nl > - " filename " : " callIcon _ 22 @ 3x . png " , < nl > + " filename " : " Phone - 66 . png " , < nl > " scale " : " 3x " < nl > } < nl > ] , < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png < nl > new file mode 100644 < nl > index 0000000 . . a7a0444 < nl > Binary files / dev / null and b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png differ < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png < nl > new file mode 100644 < nl > index 0000000 . . 1d8d253 < nl > Binary files / dev / null and b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png differ < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png < nl > deleted file mode 100644 < nl > index 773148c . . 0000000 < nl > Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png and / dev / null differ < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png < nl > deleted file mode 100644 < nl > index 7084ae0 . . 0000000 < nl > Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png and / dev / null differ < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png < nl > deleted file mode 100644 < nl > index e624931 . . 0000000 < nl > Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png and / dev / null differ < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index f878910 . . 7c00a77 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 175 , 17 + 175 , 22 @ @ public class ConversationViewController : AAConversationContentController , UIDocu < nl > / / Navigation Avatar < nl > < nl > avatarView . frame = CGRectMake ( 0 , 0 , 36 , 36 ) < nl > - let avatarTapGesture = UITapGestureRecognizer ( target : self , action : " onAvatarTap " ) < nl > - avatarTapGesture . numberOfTapsRequired = 1 < nl > - avatarTapGesture . numberOfTouchesRequired = 1 < nl > - avatarView . addGestureRecognizer ( avatarTapGesture ) < nl > + avatarView . viewDidTap = onAvatarTap < nl > < nl > let barItem = UIBarButtonItem ( customView : avatarView ) < nl > - if ( ActorSDK . sharedActor ( ) . enableCalls ) { < nl > - let callButton = UIBarButtonItem ( image : UIImage . bundled ( " ic _ call _ outline _ 22 " ) , style : UIBarButtonItemStyle . Plain , target : self , action : " onCallTap " ) < nl > - self . navigationItem . rightBarButtonItems = [ barItem , callButton ] < nl > + let isBot : Bool < nl > + if ( peer . isPrivate ) { < nl > + isBot = Bool ( Actor . getUserWithUid ( peer . peerId ) . isBot ( ) ) < nl > } else { < nl > - self . navigationItem . rightBarButtonItem = barItem < nl > + isBot = false < nl > + } < nl > + if ( ActorSDK . sharedActor ( ) . enableCalls & & ! isBot & & peer . isPrivate ) { < nl > + let callButtonView = AACallButton ( image : UIImage . bundled ( " ic _ call _ outline _ 22 " ) ? . tintImage ( ActorSDK . sharedActor ( ) . style . navigationTintColor ) ) < nl > + callButtonView . viewDidTap = onCallTap < nl > + let callButtonItem = UIBarButtonItem ( customView : callButtonView ) < nl > + self . navigationItem . rightBarButtonItems = [ barItem , callButtonItem ] < nl > + } else { < nl > + self . navigationItem . rightBarButtonItems = [ barItem ] < nl > } < nl > } < nl > < nl > @ @ - 960 , 3 + 965 , 32 @ @ public class ConversationViewController : AAConversationContentController , UIDocu < nl > < nl > < nl > } < nl > + < nl > + class AABarAvatarView : AAAvatarView { < nl > + < nl > + override init ( frameSize : Int , type : AAAvatarType ) { < nl > + super . init ( frameSize : frameSize , type : type ) < nl > + } < nl > + < nl > + required init ( coder aDecoder : NSCoder ) { < nl > + fatalError ( " init ( coder : ) has not been implemented " ) < nl > + } < nl > + < nl > + override func alignmentRectInsets ( ) - > UIEdgeInsets { < nl > + return UIEdgeInsets ( top : 0 , left : 0 , bottom : 0 , right : 8 ) < nl > + } < nl > + } < nl > + < nl > + class AACallButton : UIImageView { < nl > + override init ( image : UIImage ? ) { < nl > + super . init ( image : image ) < nl > + } < nl > + < nl > + required init ? ( coder aDecoder : NSCoder ) { < nl > + fatalError ( " init ( coder : ) has not been implemented " ) < nl > + } < nl > + < nl > + override func alignmentRectInsets ( ) - > UIEdgeInsets { < nl > + return UIEdgeInsets ( top : 0 , left : - 2 , bottom : 0 , right : 0 ) < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift < nl > index 20df7b0 . . c9977a6 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift < nl > @ @ - 121 , 11 + 121 , 14 @ @ public class AAGroupViewController : AAContentTableController { < nl > < nl > / / Calls < nl > if ( ActorSDK . sharedActor ( ) . enableCalls ) { < nl > - section { ( s ) - > ( ) in < nl > - s . action ( " CallsStartGroupAudio " ) { ( r ) - > ( ) in < nl > - r . selectAction = { ( ) - > Bool in < nl > - self . execute ( Actor . doCallWithGid ( jint ( self . gid ) ) ) < nl > - return true < nl > + let members = ( group . members . get ( ) as ! JavaUtilArrayList ) . size ( ) < nl > + if ( members < = 20 ) { / / Temporary limitation < nl > + section { ( s ) - > ( ) in < nl > + s . action ( " CallsStartGroupAudio " ) { ( r ) - > ( ) in < nl > + r . selectAction = { ( ) - > Bool in < nl > + self . execute ( Actor . doCallWithGid ( jint ( self . gid ) ) ) < nl > + return true < nl > + } < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift < nl > index d9b15c5 . . c4ef8b9 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift < nl > @ @ - 301 , 18 + 301 , 3 @ @ class Placeholders { < nl > return image ; < nl > } < nl > } < nl > - < nl > - class AABarAvatarView : AAAvatarView { < nl > - < nl > - override init ( frameSize : Int , type : AAAvatarType ) { < nl > - super . init ( frameSize : frameSize , type : type ) < nl > - } < nl > - < nl > - required init ( coder aDecoder : NSCoder ) { < nl > - fatalError ( " init ( coder : ) has not been implemented " ) < nl > - } < nl > - < nl > - override func alignmentRectInsets ( ) - > UIEdgeInsets { < nl > - return UIEdgeInsets ( top : 0 , left : - 16 , bottom : 0 , right : 8 ) < nl > - } < nl > - } < nl > \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index 6606a24 . . f6dbf3d 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 173 , 6 + 173 , 7 @ @ < nl > 	 	 069CF4D31BCB909A00C66E12 / * CLTokenView . m in Sources * / = { isa = PBXBuildFile ; fileRef = 069CF4CB1BCB909A00C66E12 / * CLTokenView . m * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; < nl > 	 	 06CE898A1BD8401C005A5530 / * Reachability . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06CE89891BD8401C005A5530 / * Reachability . swift * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; < nl > 	 	 06CE898C1BD841C9005A5530 / * SystemConfiguration . framework in Frameworks * / = { isa = PBXBuildFile ; fileRef = 06CE898B1BD841C9005A5530 / * SystemConfiguration . framework * / ; } ; < nl > + 	 	 06CE89901BD84DF5005A5530 / * ActorSDKAnalytics . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; < nl > / * End PBXBuildFile section * / < nl > < nl > / * Begin PBXFileReference section * / < nl > @ @ - 353 , 6 + 354 , 7 @ @ < nl > 	 	 069CF4CB1BCB909A00C66E12 / * CLTokenView . m * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . objc ; name = CLTokenView . m ; path = CLTokenInputView / CLTokenView . m ; sourceTree = " < group > " ; } ; < nl > 	 	 06CE89891BD8401C005A5530 / * Reachability . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = Reachability . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 06CE898B1BD841C9005A5530 / * SystemConfiguration . framework * / = { isa = PBXFileReference ; lastKnownFileType = wrapper . framework ; name = SystemConfiguration . framework ; path = System / Library / Frameworks / SystemConfiguration . framework ; sourceTree = SDKROOT ; } ; < nl > + 	 	 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = ActorSDKAnalytics . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 22BAEA363892E475F59B7E9F / * Pods - ActorSDK . debug . xcconfig * / = { isa = PBXFileReference ; includeInIndex = 1 ; lastKnownFileType = text . xcconfig ; name = " Pods - ActorSDK . debug . xcconfig " ; path = " Pods / Target Support Files / Pods - ActorSDK / Pods - ActorSDK . debug . xcconfig " ; sourceTree = " < group > " ; } ; < nl > 	 	 333F91AE5263DD450666CC87 / * Pods - ActorSDK . release . xcconfig * / = { isa = PBXFileReference ; includeInIndex = 1 ; lastKnownFileType = text . xcconfig ; name = " Pods - ActorSDK . release . xcconfig " ; path = " Pods / Target Support Files / Pods - ActorSDK / Pods - ActorSDK . release . xcconfig " ; sourceTree = " < group > " ; } ; < nl > 	 	 9A22DF21664BBB34087283F6 / * Pods _ ActorSDK . framework * / = { isa = PBXFileReference ; explicitFileType = wrapper . framework ; includeInIndex = 0 ; path = Pods _ ActorSDK . framework ; sourceTree = BUILT _ PRODUCTS _ DIR ; } ; < nl > @ @ - 860 , 6 + 862 , 7 @ @ < nl > 	 	 	 	 066A51201BC4B53C000E606E / * SwiftExtensions * / , < nl > 	 	 	 	 066A51571BC4C112000E606E / * Utils * / , < nl > 	 	 	 	 066A50E11BC4AF9F000E606E / * ActorSDK . swift * / , < nl > + 	 	 	 	 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / , < nl > 	 	 	 	 066A525B1BC502EB000E606E / * ActorSDKDelegate . swift * / , < nl > 	 	 	 	 066A53381BC5456B000E606E / * ActorStyle . swift * / , < nl > 	 	 	 	 066A525D1BC503BB000E606E / * ActorApplicationDelegate . swift * / , < nl > @ @ - 1122 , 6 + 1125 , 7 @ @ < nl > 	 	 	 	 066A53231BC533F5000E606E / * Caches . swift in Sources * / , < nl > 	 	 	 	 066A52691BC50E7B000E606E / * AAAuthRegisterViewController . swift in Sources * / , < nl > 	 	 	 	 066A51501BC4BE06000E606E / * AARegex . swift in Sources * / , < nl > + 	 	 	 	 06CE89901BD84DF5005A5530 / * ActorSDKAnalytics . swift in Sources * / , < nl > 	 	 	 	 069CF4D31BCB909A00C66E12 / * CLTokenView . m in Sources * / , < nl > 	 	 	 	 066A52F71BC52B13000E606E / * AAWallpapperPreviewCell . swift in Sources * / , < nl > 	 	 	 	 066A51541BC4BE95000E606E / * Images . swift in Sources * / , < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > index e9b66f6 . . e761de9 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > @ @ - 30 , 6 + 30 , 9 @ @ public class ActorSDK { < nl > / / / SDK Delegate < nl > public var delegate : ActorSDKDelegate = ActorSDKDelegateDefault ( ) < nl > < nl > + / / / SDK Analytics < nl > + public var analyticsDelegate : ActorSDKAnalytics ? < nl > + < nl > / / < nl > / / Configuration < nl > / / < nl > @ @ - 410 , 6 + 413 , 21 @ @ public class ActorSDK { < nl > } < nl > } < nl > < nl > + / / / Tracking page visible < nl > + func trackPageVisible ( page : ACPage ) { < nl > + analyticsDelegate ? . analyticsPageVisible ( page ) < nl > + } < nl > + < nl > + / / / Tracking page hidden < nl > + func trackPageHidden ( page : ACPage ) { < nl > + analyticsDelegate ? . analyticsPageHidden ( page ) < nl > + } < nl > + < nl > + / / / Tracking event < nl > + func trackEvent ( event : ACEvent ) { < nl > + analyticsDelegate ? . analyticsEvent ( event ) < nl > + } < nl > + < nl > / / < nl > / / File System < nl > / / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift < nl > new file mode 100644 < nl > index 0000000 . . 3751467 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift < nl > @ @ - 0 , 0 + 1 , 17 @ @ < nl > + / / < nl > + / / Copyright ( c ) 2014 - 2015 Actor LLC . < https : / / actor . im > < nl > + / / < nl > + < nl > + import Foundation < nl > + < nl > + public protocol ActorSDKAnalytics { < nl > + < nl > + / / / Called when page visible < nl > + func analyticsPageVisible ( page : ACPage ) < nl > + < nl > + / / / Called when page hidden < nl > + func analyticsPageHidden ( page : ACPage ) < nl > + < nl > + / / / Called when event occurs < nl > + func analyticsEvent ( event : ACEvent ) < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index 03ce9dc . . be20271 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 193 , 7 + 193 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > } < nl > < nl > Actor . onConversationOpenWithPeer ( peer ) < nl > - / / Analytics . trackPageVisible ( content ) < nl > + ActorSDK . sharedActor ( ) . trackPageVisible ( content ) < nl > } < nl > < nl > override func viewWillLayoutSubviews ( ) { < nl > @ @ - 222 , 7 + 222 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > super . viewWillDisappear ( animated ) < nl > < nl > Actor . onConversationClosedWithPeer ( peer ) < nl > - / / Analytics . trackPageHidden ( content ) < nl > + ActorSDK . sharedActor ( ) . trackPageHidden ( content ) < nl > < nl > if ! AADevice . isiPad { < nl > AANavigationBadge . hideBadge ( ) < nl > @ @ - 308 , 14 + 308 , 14 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > < nl > / / Completition < nl > < nl > - override func canShowAutoCompletion ( ) - > Bool { < nl > + override func didChangeAutoCompletionPrefix ( prefix : String ! , andWord word : String ! ) { < nl > if UInt ( self . peer . peerType . ordinal ( ) ) = = ACPeerType . GROUP . rawValue { < nl > - if self . foundPrefix = = " @ " { < nl > - < nl > + if prefix = = " @ " { < nl > + < nl > let oldCount = filteredMembers . count < nl > filteredMembers . removeAll ( keepCapacity : true ) < nl > < nl > - let res = Actor . findMentionsWithGid ( self . peer . peerId , withQuery : self . foundWord ) < nl > + let res = Actor . findMentionsWithGid ( self . peer . peerId , withQuery : word ) < nl > for index in 0 . . < res . size ( ) { < nl > filteredMembers . append ( res . getWithInt ( index ) as ! ACMentionFilterResult ) < nl > } < nl > @ @ - 324 , 13 + 324 , 16 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > self . autoCompletionView . reloadData ( ) < nl > } < nl > < nl > - return filteredMembers . count > 0 < nl > + dispatchOnUi { ( ) - > Void in < nl > + self . showAutoCompletionView ( self . filteredMembers . count > 0 ) < nl > + } < nl > + return < nl > } < nl > - < nl > - return false < nl > } < nl > < nl > - return false < nl > + dispatchOnUi { ( ) - > Void in < nl > + self . showAutoCompletionView ( false ) < nl > + } < nl > } < nl > < nl > override func tableView ( tableView : UITableView , numberOfRowsInSection section : Int ) - > Int { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift < nl > index 16cc802 . . 60b7cf9 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift 	 < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift 	 < nl > @ @ - 148 , 7 + 148 , 7 @ @ public class AAViewController : UIViewController , UINavigationControllerDelegate , < nl > super . viewWillAppear ( animated ) < nl > < nl > if let c = content { < nl > - / / Analytics . trackPageVisible ( c ) < nl > + ActorSDK . sharedActor ( ) . trackPageVisible ( c ) < nl > } < nl > if let u = uid { < nl > Actor . onProfileOpenWithUid ( jint ( u ) ) < nl > @ @ - 159 , 7 + 159 , 7 @ @ public class AAViewController : UIViewController , UINavigationControllerDelegate , < nl > super . viewWillDisappear ( animated ) < nl > < nl > if let c = content { < nl > - / / Analytics . trackPageHidden ( c ) < nl > + ActorSDK . sharedActor ( ) . trackPageHidden ( c ) < nl > } < nl > if let u = uid { < nl > Actor . onProfileClosedWithUid ( jint ( u ) ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > index af64e43 . . f26c644 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > @ @ - 355 , 12 + 355 , 6 @ @ public class AASettingsViewController : AAContentTableController { < nl > ActorSDK . sharedActor ( ) . delegate . actorSettingsSupportDidCreated ( self , section : s ) < nl > } < nl > } < nl > - < nl > - public override func viewWillAppear ( animated : Bool ) { < nl > - super . viewWillAppear ( animated ) < nl > - < nl > - Actor . onProfileOpenWithUid ( jint ( uid ) ) < nl > - } < nl > < nl > public override func tableWillBind ( binder : AABinder ) { < nl > < nl > @ @ - 408 , 10 + 402 , 4 @ @ public class AASettingsViewController : AAContentTableController { < nl > self . emailCells . reload ( ) < nl > } ) < nl > } < nl > - < nl > - public override func viewWillDisappear ( animated : Bool ) { < nl > - super . viewWillDisappear ( animated ) < nl > - < nl > - Actor . onProfileClosedWithUid ( jint ( uid ) ) < nl > - } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > index 15bcab8 . . 584a829 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > @ @ - 226 , 12 + 226 , 6 @ @ class AAUserViewController : AAContentTableController { < nl > < nl > } < nl > < nl > - override func viewWillAppear ( animated : Bool ) { < nl > - super . viewWillAppear ( animated ) < nl > - < nl > - Actor . onProfileOpenWithUid ( jint ( uid ) ) < nl > - } < nl > - < nl > override func tableWillBind ( binder : AABinder ) { < nl > binder . bind ( user . getAvatarModel ( ) , closure : { ( value : ACAvatar ? ) - > ( ) in < nl > self . headerRow . reload ( ) < nl > @ @ - 251 , 10 + 245 , 4 @ @ class AAUserViewController : AAContentTableController { < nl > } ) < nl > } < nl > } < nl > - < nl > - override func viewWillDisappear ( animated : Bool ) { < nl > - super . viewWillDisappear ( animated ) < nl > - < nl > - Actor . onProfileOpenWithUid ( jint ( uid ) ) < nl > - } < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index ca87820 . . db07441 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 693 , 7 + 693 , 6 @ @ 
 	 	 	 children = ( 
 	 	 	 	 069CF4151BCA5DB500C66E12 / * Sources * / , 
 	 	 	 	 065975081BC7C4F300B8C7DF / * Resources * / , 
 - 	 	 	 	 06E323091C693A4E00D66F53 / * Libs * / , 
 	 	 	 ) ; 
 	 	 	 path = ActorSDK ; 
 	 	 	 sourceTree = " < group > " ; 
 @ @ - 1175 , 13 + 1174 , 6 @ @ 
 	 	 	 name = Libs ; 
 	 	 	 sourceTree = " < group > " ; 
 	 	 } ; 
 - 	 	 06E323091C693A4E00D66F53 / * Libs * / = { 
 - 	 	 	 isa = PBXGroup ; 
 - 	 	 	 children = ( 
 - 	 	 	 ) ; 
 - 	 	 	 name = Libs ; 
 - 	 	 	 sourceTree = " < group > " ; 
 - 	 	 } ; 
 	 	 06E323131C6A7AA300D66F53 / * Calls * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json 
 index 5c85eda . . c11275a 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Contents . json 
 @ @ - 2 , 17 + 2 , 16 @ @ 
 " images " : [ 
 { 
 " idiom " : " universal " , 
 - " filename " : " callIcon _ 22 @ 1x . png " , 
 " scale " : " 1x " 
 } , 
 { 
 " idiom " : " universal " , 
 - " filename " : " callIcon _ 22 @ 2x . png " , 
 + " filename " : " Phone - 44 . png " , 
 " scale " : " 2x " 
 } , 
 { 
 " idiom " : " universal " , 
 - " filename " : " callIcon _ 22 @ 3x . png " , 
 + " filename " : " Phone - 66 . png " , 
 " scale " : " 3x " 
 } 
 ] , 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png 
 new file mode 100644 
 index 0000000 . . a7a0444 
 Binary files / dev / null and b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 44 . png differ 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png 
 new file mode 100644 
 index 0000000 . . 1d8d253 
 Binary files / dev / null and b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / Phone - 66 . png differ 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png 
 deleted file mode 100644 
 index 773148c . . 0000000 
 Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 1x . png and / dev / null differ 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png 
 deleted file mode 100644 
 index 7084ae0 . . 0000000 
 Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 2x . png and / dev / null differ 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png 
 deleted file mode 100644 
 index e624931 . . 0000000 
 Binary files a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Images . xcassets / ic _ call _ outline _ 22 . imageset / callIcon _ 22 @ 3x . png and / dev / null differ 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index f878910 . . 7c00a77 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 175 , 17 + 175 , 22 @ @ public class ConversationViewController : AAConversationContentController , UIDocu 
 / / Navigation Avatar 
 
 avatarView . frame = CGRectMake ( 0 , 0 , 36 , 36 ) 
 - let avatarTapGesture = UITapGestureRecognizer ( target : self , action : " onAvatarTap " ) 
 - avatarTapGesture . numberOfTapsRequired = 1 
 - avatarTapGesture . numberOfTouchesRequired = 1 
 - avatarView . addGestureRecognizer ( avatarTapGesture ) 
 + avatarView . viewDidTap = onAvatarTap 
 
 let barItem = UIBarButtonItem ( customView : avatarView ) 
 - if ( ActorSDK . sharedActor ( ) . enableCalls ) { 
 - let callButton = UIBarButtonItem ( image : UIImage . bundled ( " ic _ call _ outline _ 22 " ) , style : UIBarButtonItemStyle . Plain , target : self , action : " onCallTap " ) 
 - self . navigationItem . rightBarButtonItems = [ barItem , callButton ] 
 + let isBot : Bool 
 + if ( peer . isPrivate ) { 
 + isBot = Bool ( Actor . getUserWithUid ( peer . peerId ) . isBot ( ) ) 
 } else { 
 - self . navigationItem . rightBarButtonItem = barItem 
 + isBot = false 
 + } 
 + if ( ActorSDK . sharedActor ( ) . enableCalls & & ! isBot & & peer . isPrivate ) { 
 + let callButtonView = AACallButton ( image : UIImage . bundled ( " ic _ call _ outline _ 22 " ) ? . tintImage ( ActorSDK . sharedActor ( ) . style . navigationTintColor ) ) 
 + callButtonView . viewDidTap = onCallTap 
 + let callButtonItem = UIBarButtonItem ( customView : callButtonView ) 
 + self . navigationItem . rightBarButtonItems = [ barItem , callButtonItem ] 
 + } else { 
 + self . navigationItem . rightBarButtonItems = [ barItem ] 
 } 
 } 
 
 @ @ - 960 , 3 + 965 , 32 @ @ public class ConversationViewController : AAConversationContentController , UIDocu 
 
 
 } 
 + 
 + class AABarAvatarView : AAAvatarView { 
 + 
 + override init ( frameSize : Int , type : AAAvatarType ) { 
 + super . init ( frameSize : frameSize , type : type ) 
 + } 
 + 
 + required init ( coder aDecoder : NSCoder ) { 
 + fatalError ( " init ( coder : ) has not been implemented " ) 
 + } 
 + 
 + override func alignmentRectInsets ( ) - > UIEdgeInsets { 
 + return UIEdgeInsets ( top : 0 , left : 0 , bottom : 0 , right : 8 ) 
 + } 
 + } 
 + 
 + class AACallButton : UIImageView { 
 + override init ( image : UIImage ? ) { 
 + super . init ( image : image ) 
 + } 
 + 
 + required init ? ( coder aDecoder : NSCoder ) { 
 + fatalError ( " init ( coder : ) has not been implemented " ) 
 + } 
 + 
 + override func alignmentRectInsets ( ) - > UIEdgeInsets { 
 + return UIEdgeInsets ( top : 0 , left : - 2 , bottom : 0 , right : 0 ) 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift 
 index 20df7b0 . . c9977a6 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Group / AAGroupViewController . swift 
 @ @ - 121 , 11 + 121 , 14 @ @ public class AAGroupViewController : AAContentTableController { 
 
 / / Calls 
 if ( ActorSDK . sharedActor ( ) . enableCalls ) { 
 - section { ( s ) - > ( ) in 
 - s . action ( " CallsStartGroupAudio " ) { ( r ) - > ( ) in 
 - r . selectAction = { ( ) - > Bool in 
 - self . execute ( Actor . doCallWithGid ( jint ( self . gid ) ) ) 
 - return true 
 + let members = ( group . members . get ( ) as ! JavaUtilArrayList ) . size ( ) 
 + if ( members < = 20 ) { / / Temporary limitation 
 + section { ( s ) - > ( ) in 
 + s . action ( " CallsStartGroupAudio " ) { ( r ) - > ( ) in 
 + r . selectAction = { ( ) - > Bool in 
 + self . execute ( Actor . doCallWithGid ( jint ( self . gid ) ) ) 
 + return true 
 + } 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift 
 index d9b15c5 . . c4ef8b9 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / AAAvatarView . swift 
 @ @ - 301 , 18 + 301 , 3 @ @ class Placeholders { 
 return image ; 
 } 
 } 
 - 
 - class AABarAvatarView : AAAvatarView { 
 - 
 - override init ( frameSize : Int , type : AAAvatarType ) { 
 - super . init ( frameSize : frameSize , type : type ) 
 - } 
 - 
 - required init ( coder aDecoder : NSCoder ) { 
 - fatalError ( " init ( coder : ) has not been implemented " ) 
 - } 
 - 
 - override func alignmentRectInsets ( ) - > UIEdgeInsets { 
 - return UIEdgeInsets ( top : 0 , left : - 16 , bottom : 0 , right : 8 ) 
 - } 
 - } 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index 6606a24 . . f6dbf3d 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 173 , 6 + 173 , 7 @ @ 
 	 	 069CF4D31BCB909A00C66E12 / * CLTokenView . m in Sources * / = { isa = PBXBuildFile ; fileRef = 069CF4CB1BCB909A00C66E12 / * CLTokenView . m * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; 
 	 	 06CE898A1BD8401C005A5530 / * Reachability . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06CE89891BD8401C005A5530 / * Reachability . swift * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; 
 	 	 06CE898C1BD841C9005A5530 / * SystemConfiguration . framework in Frameworks * / = { isa = PBXBuildFile ; fileRef = 06CE898B1BD841C9005A5530 / * SystemConfiguration . framework * / ; } ; 
 + 	 	 06CE89901BD84DF5005A5530 / * ActorSDKAnalytics . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / ; settings = { ASSET _ TAGS = ( ) ; } ; } ; 
 / * End PBXBuildFile section * / 
 
 / * Begin PBXFileReference section * / 
 @ @ - 353 , 6 + 354 , 7 @ @ 
 	 	 069CF4CB1BCB909A00C66E12 / * CLTokenView . m * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . objc ; name = CLTokenView . m ; path = CLTokenInputView / CLTokenView . m ; sourceTree = " < group > " ; } ; 
 	 	 06CE89891BD8401C005A5530 / * Reachability . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = Reachability . swift ; sourceTree = " < group > " ; } ; 
 	 	 06CE898B1BD841C9005A5530 / * SystemConfiguration . framework * / = { isa = PBXFileReference ; lastKnownFileType = wrapper . framework ; name = SystemConfiguration . framework ; path = System / Library / Frameworks / SystemConfiguration . framework ; sourceTree = SDKROOT ; } ; 
 + 	 	 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = ActorSDKAnalytics . swift ; sourceTree = " < group > " ; } ; 
 	 	 22BAEA363892E475F59B7E9F / * Pods - ActorSDK . debug . xcconfig * / = { isa = PBXFileReference ; includeInIndex = 1 ; lastKnownFileType = text . xcconfig ; name = " Pods - ActorSDK . debug . xcconfig " ; path = " Pods / Target Support Files / Pods - ActorSDK / Pods - ActorSDK . debug . xcconfig " ; sourceTree = " < group > " ; } ; 
 	 	 333F91AE5263DD450666CC87 / * Pods - ActorSDK . release . xcconfig * / = { isa = PBXFileReference ; includeInIndex = 1 ; lastKnownFileType = text . xcconfig ; name = " Pods - ActorSDK . release . xcconfig " ; path = " Pods / Target Support Files / Pods - ActorSDK / Pods - ActorSDK . release . xcconfig " ; sourceTree = " < group > " ; } ; 
 	 	 9A22DF21664BBB34087283F6 / * Pods _ ActorSDK . framework * / = { isa = PBXFileReference ; explicitFileType = wrapper . framework ; includeInIndex = 0 ; path = Pods _ ActorSDK . framework ; sourceTree = BUILT _ PRODUCTS _ DIR ; } ; 
 @ @ - 860 , 6 + 862 , 7 @ @ 
 	 	 	 	 066A51201BC4B53C000E606E / * SwiftExtensions * / , 
 	 	 	 	 066A51571BC4C112000E606E / * Utils * / , 
 	 	 	 	 066A50E11BC4AF9F000E606E / * ActorSDK . swift * / , 
 + 	 	 	 	 06CE898F1BD84DF5005A5530 / * ActorSDKAnalytics . swift * / , 
 	 	 	 	 066A525B1BC502EB000E606E / * ActorSDKDelegate . swift * / , 
 	 	 	 	 066A53381BC5456B000E606E / * ActorStyle . swift * / , 
 	 	 	 	 066A525D1BC503BB000E606E / * ActorApplicationDelegate . swift * / , 
 @ @ - 1122 , 6 + 1125 , 7 @ @ 
 	 	 	 	 066A53231BC533F5000E606E / * Caches . swift in Sources * / , 
 	 	 	 	 066A52691BC50E7B000E606E / * AAAuthRegisterViewController . swift in Sources * / , 
 	 	 	 	 066A51501BC4BE06000E606E / * AARegex . swift in Sources * / , 
 + 	 	 	 	 06CE89901BD84DF5005A5530 / * ActorSDKAnalytics . swift in Sources * / , 
 	 	 	 	 069CF4D31BCB909A00C66E12 / * CLTokenView . m in Sources * / , 
 	 	 	 	 066A52F71BC52B13000E606E / * AAWallpapperPreviewCell . swift in Sources * / , 
 	 	 	 	 066A51541BC4BE95000E606E / * Images . swift in Sources * / , 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 index e9b66f6 . . e761de9 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 @ @ - 30 , 6 + 30 , 9 @ @ public class ActorSDK { 
 / / / SDK Delegate 
 public var delegate : ActorSDKDelegate = ActorSDKDelegateDefault ( ) 
 
 + / / / SDK Analytics 
 + public var analyticsDelegate : ActorSDKAnalytics ? 
 + 
 / / 
 / / Configuration 
 / / 
 @ @ - 410 , 6 + 413 , 21 @ @ public class ActorSDK { 
 } 
 } 
 
 + / / / Tracking page visible 
 + func trackPageVisible ( page : ACPage ) { 
 + analyticsDelegate ? . analyticsPageVisible ( page ) 
 + } 
 + 
 + / / / Tracking page hidden 
 + func trackPageHidden ( page : ACPage ) { 
 + analyticsDelegate ? . analyticsPageHidden ( page ) 
 + } 
 + 
 + / / / Tracking event 
 + func trackEvent ( event : ACEvent ) { 
 + analyticsDelegate ? . analyticsEvent ( event ) 
 + } 
 + 
 / / 
 / / File System 
 / / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift 
 new file mode 100644 
 index 0000000 . . 3751467 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDKAnalytics . swift 
 @ @ - 0 , 0 + 1 , 17 @ @ 
 + / / 
 + / / Copyright ( c ) 2014 - 2015 Actor LLC . < https : / / actor . im > 
 + / / 
 + 
 + import Foundation 
 + 
 + public protocol ActorSDKAnalytics { 
 + 
 + / / / Called when page visible 
 + func analyticsPageVisible ( page : ACPage ) 
 + 
 + / / / Called when page hidden 
 + func analyticsPageHidden ( page : ACPage ) 
 + 
 + / / / Called when event occurs 
 + func analyticsEvent ( event : ACEvent ) 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index 03ce9dc . . be20271 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 193 , 7 + 193 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 } 
 
 Actor . onConversationOpenWithPeer ( peer ) 
 - / / Analytics . trackPageVisible ( content ) 
 + ActorSDK . sharedActor ( ) . trackPageVisible ( content ) 
 } 
 
 override func viewWillLayoutSubviews ( ) { 
 @ @ - 222 , 7 + 222 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 super . viewWillDisappear ( animated ) 
 
 Actor . onConversationClosedWithPeer ( peer ) 
 - / / Analytics . trackPageHidden ( content ) 
 + ActorSDK . sharedActor ( ) . trackPageHidden ( content ) 
 
 if ! AADevice . isiPad { 
 AANavigationBadge . hideBadge ( ) 
 @ @ - 308 , 14 + 308 , 14 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 
 / / Completition 
 
 - override func canShowAutoCompletion ( ) - > Bool { 
 + override func didChangeAutoCompletionPrefix ( prefix : String ! , andWord word : String ! ) { 
 if UInt ( self . peer . peerType . ordinal ( ) ) = = ACPeerType . GROUP . rawValue { 
 - if self . foundPrefix = = " @ " { 
 - 
 + if prefix = = " @ " { 
 + 
 let oldCount = filteredMembers . count 
 filteredMembers . removeAll ( keepCapacity : true ) 
 
 - let res = Actor . findMentionsWithGid ( self . peer . peerId , withQuery : self . foundWord ) 
 + let res = Actor . findMentionsWithGid ( self . peer . peerId , withQuery : word ) 
 for index in 0 . . < res . size ( ) { 
 filteredMembers . append ( res . getWithInt ( index ) as ! ACMentionFilterResult ) 
 } 
 @ @ - 324 , 13 + 324 , 16 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 self . autoCompletionView . reloadData ( ) 
 } 
 
 - return filteredMembers . count > 0 
 + dispatchOnUi { ( ) - > Void in 
 + self . showAutoCompletionView ( self . filteredMembers . count > 0 ) 
 + } 
 + return 
 } 
 - 
 - return false 
 } 
 
 - return false 
 + dispatchOnUi { ( ) - > Void in 
 + self . showAutoCompletionView ( false ) 
 + } 
 } 
 
 override func tableView ( tableView : UITableView , numberOfRowsInSection section : Int ) - > Int { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift 
 index 16cc802 . . 60b7cf9 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift 	 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAViewController . swift 	 
 @ @ - 148 , 7 + 148 , 7 @ @ public class AAViewController : UIViewController , UINavigationControllerDelegate , 
 super . viewWillAppear ( animated ) 
 
 if let c = content { 
 - / / Analytics . trackPageVisible ( c ) 
 + ActorSDK . sharedActor ( ) . trackPageVisible ( c ) 
 } 
 if let u = uid { 
 Actor . onProfileOpenWithUid ( jint ( u ) ) 
 @ @ - 159 , 7 + 159 , 7 @ @ public class AAViewController : UIViewController , UINavigationControllerDelegate , 
 super . viewWillDisappear ( animated ) 
 
 if let c = content { 
 - / / Analytics . trackPageHidden ( c ) 
 + ActorSDK . sharedActor ( ) . trackPageHidden ( c ) 
 } 
 if let u = uid { 
 Actor . onProfileClosedWithUid ( jint ( u ) ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 index af64e43 . . f26c644 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 @ @ - 355 , 12 + 355 , 6 @ @ public class AASettingsViewController : AAContentTableController { 
 ActorSDK . sharedActor ( ) . delegate . actorSettingsSupportDidCreated ( self , section : s ) 
 } 
 } 
 - 
 - public override func viewWillAppear ( animated : Bool ) { 
 - super . viewWillAppear ( animated ) 
 - 
 - Actor . onProfileOpenWithUid ( jint ( uid ) ) 
 - } 
 
 public override func tableWillBind ( binder : AABinder ) { 
 
 @ @ - 408 , 10 + 402 , 4 @ @ public class AASettingsViewController : AAContentTableController { 
 self . emailCells . reload ( ) 
 } ) 
 } 
 - 
 - public override func viewWillDisappear ( animated : Bool ) { 
 - super . viewWillDisappear ( animated ) 
 - 
 - Actor . onProfileClosedWithUid ( jint ( uid ) ) 
 - } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 index 15bcab8 . . 584a829 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 @ @ - 226 , 12 + 226 , 6 @ @ class AAUserViewController : AAContentTableController { 
 
 } 
 
 - override func viewWillAppear ( animated : Bool ) { 
 - super . viewWillAppear ( animated ) 
 - 
 - Actor . onProfileOpenWithUid ( jint ( uid ) ) 
 - } 
 - 
 override func tableWillBind ( binder : AABinder ) { 
 binder . bind ( user . getAvatarModel ( ) , closure : { ( value : ACAvatar ? ) - > ( ) in 
 self . headerRow . reload ( ) 
 @ @ - 251 , 10 + 245 , 4 @ @ class AAUserViewController : AAContentTableController { 
 } ) 
 } 
 } 
 - 
 - override func viewWillDisappear ( animated : Bool ) { 
 - super . viewWillDisappear ( animated ) 
 - 
 - Actor . onProfileOpenWithUid ( jint ( uid ) ) 
 - } 
 }
