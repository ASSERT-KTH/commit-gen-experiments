BLEU SCORE: 0.35065941041239285

TEST MSG: fix ( server : session ) : fixed messages priorities
GENERATED MSG: fix ( server : session ) : use akka - streams internal api for pulling decisions

TEST DIFF (one line): diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > index 47a56ac . . a898213 100644 < nl > - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala < nl > @ @ - 86 , 19 + 86 , 19 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L < nl > } < nl > object Priority { < nl > object NewSession extends Priority { < nl > - override val id = - 2 < nl > + override val id = 2 < nl > } < nl > object Ack extends Priority { < nl > - override val id = - 1 < nl > + override val id = 1 < nl > } < nl > object RPC extends Priority { < nl > override val id = 0 < nl > } < nl > object SeqPush extends Priority { < nl > - override val id = 1 < nl > + override val id = - 1 < nl > } < nl > object WeakPush extends Priority { < nl > - override val id = 2 < nl > + override val id = - 2 < nl > } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala < nl > index 7f942b7 . . 0471cc4 100644 < nl > - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala < nl > + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala < nl > @ @ - 29 , 17 + 29 , 14 @ @ private [ session ] final class SessionMessageDiscriminator extends GraphStage [ Sess < nl > ) < nl > < nl > override def createLogic ( inheritedAttributes : Attributes ) : GraphStageLogic = new GraphStageLogic ( shape ) { < nl > - private var inPulled = false < nl > - < nl > val pullIn = ( ) ⇒ { < nl > - inPulled = true < nl > - pull ( in ) < nl > + if ( ! hasBeenPulled ( in ) ) < nl > + pull ( in ) < nl > } < nl > < nl > setHandler ( in , new InHandler { < nl > override def onPush ( ) : Unit = { < nl > val msg = grab ( in ) < nl > - inPulled = false < nl > < nl > msg match { < nl > case SessionStreamMessage . HandleMessageBox ( MessageBox ( messageId , RpcRequestBox ( bodyBytes ) ) , clientData ) ⇒ < nl > @ @ - 62 , 8 + 59 , 7 @ @ private [ session ] final class SessionMessageDiscriminator extends GraphStage [ Sess < nl > < nl > val pullIt = new OutHandler { < nl > override def onPull ( ) : Unit = { < nl > - if ( ! inPulled ) < nl > - pullIn ( ) < nl > + pullIn ( ) < nl > } < nl > }

TEST DIFF:
diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 index 47a56ac . . a898213 100644 
 - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / Resender . scala 
 @ @ - 86 , 19 + 86 , 19 @ @ private [ session ] class ReSender ( authId : Long , sessionId : Long , firstMessageId : L 
 } 
 object Priority { 
 object NewSession extends Priority { 
 - override val id = - 2 
 + override val id = 2 
 } 
 object Ack extends Priority { 
 - override val id = - 1 
 + override val id = 1 
 } 
 object RPC extends Priority { 
 override val id = 0 
 } 
 object SeqPush extends Priority { 
 - override val id = 1 
 + override val id = - 1 
 } 
 object WeakPush extends Priority { 
 - override val id = 2 
 + override val id = - 2 
 } 
 }

NEAREST DIFF:
diff - - git a / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala b / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala 
 index 7f942b7 . . 0471cc4 100644 
 - - - a / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala 
 + + + b / actor - server / actor - session / src / main / scala / im / actor / server / session / SessionMessageDiscriminator . scala 
 @ @ - 29 , 17 + 29 , 14 @ @ private [ session ] final class SessionMessageDiscriminator extends GraphStage [ Sess 
 ) 
 
 override def createLogic ( inheritedAttributes : Attributes ) : GraphStageLogic = new GraphStageLogic ( shape ) { 
 - private var inPulled = false 
 - 
 val pullIn = ( ) ⇒ { 
 - inPulled = true 
 - pull ( in ) 
 + if ( ! hasBeenPulled ( in ) ) 
 + pull ( in ) 
 } 
 
 setHandler ( in , new InHandler { 
 override def onPush ( ) : Unit = { 
 val msg = grab ( in ) 
 - inPulled = false 
 
 msg match { 
 case SessionStreamMessage . HandleMessageBox ( MessageBox ( messageId , RpcRequestBox ( bodyBytes ) ) , clientData ) ⇒ 
 @ @ - 62 , 8 + 59 , 7 @ @ private [ session ] final class SessionMessageDiscriminator extends GraphStage [ Sess 
 
 val pullIt = new OutHandler { 
 override def onPull ( ) : Unit = { 
 - if ( ! inPulled ) 
 - pullIn ( ) 
 + pullIn ( ) 
 } 
 }
