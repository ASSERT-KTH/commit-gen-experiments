BLEU SCORE: 0.026279617104084448

TEST MSG: Merge branch ' master ' of github . com : actorapp / actor - platform
GENERATED MSG: wip ( sdk ) : Fix compilation errors

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml < nl > index 9bd6c06 . . 27b45bd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml < nl > @ @ - 10 , 7 + 10 , 6 @ @ < nl > < nl > < application < nl > android : allowBackup = " true " < nl > - android : label = " @ string / app _ name " < nl > android : supportsRtl = " true " > < nl > < receiver < nl > android : name = " im . actor . push . PushReceiver " < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index 3b63c61 . . 4fa03d0 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 803 , 15 + 803 , 15 @ @ < nl > 	 	 066A52601BC50E6B000E606E / * Auth * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > - 	 	 	 	 153F6B8C1C2D83B200C0B960 / * Views * / , < nl > - 	 	 	 	 153F6B601C2BF8EC00C0B960 / * AAAuthWelcomeController . swift * / , < nl > 	 	 	 	 066A526E1BC51007000E606E / * Views * / , < nl > 	 	 	 	 066A526B1BC50E83000E606E / * Cells * / , < nl > + 	 	 	 	 153F6B8D1C2D868100C0B960 / * AATermsController . swift * / , < nl > 	 	 	 	 066A52611BC50E7B000E606E / * AAAuthCountriesViewController . swift * / , < nl > 	 	 	 	 066A52621BC50E7B000E606E / * AAAuthPhoneViewController . swift * / , < nl > 	 	 	 	 066A52631BC50E7B000E606E / * AAAuthCodeViewController . swift * / , < nl > 	 	 	 	 066A52641BC50E7B000E606E / * AAAuthRegisterViewController . swift * / , < nl > 	 	 	 	 066A52651BC50E7B000E606E / * AAAuthViewController . swift * / , < nl > + 	 	 	 	 153F6B601C2BF8EC00C0B960 / * AAAuthWelcomeController . swift * / , < nl > 	 	 	 	 065974A41BC621F100B8C7DF / * AAAuthNavigationController . swift * / , < nl > 	 	 	 ) ; < nl > 	 	 	 path = Auth ; < nl > @ @ - 1162 , 14 + 1162 , 6 @ @ < nl > 	 	 	 name = TapedLabel ; < nl > 	 	 	 sourceTree = " < group > " ; < nl > 	 	 } ; < nl > - 	 	 153F6B8C1C2D83B200C0B960 / * Views * / = { < nl > - 	 	 	 isa = PBXGroup ; < nl > - 	 	 	 children = ( < nl > - 	 	 	 	 153F6B8D1C2D868100C0B960 / * AATermsController . swift * / , < nl > - 	 	 	 ) ; < nl > - 	 	 	 name = Views ; < nl > - 	 	 	 sourceTree = " < group > " ; < nl > - 	 	 } ; < nl > 	 	 15D35F0A1C20182900E3717A / * AudioRecorder * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings < nl > index f5e00b2 . . 9cbacb4 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings < nl > @ @ - 2 , 16 + 2 , 6 @ @ < nl > / / Copyright ( C ) 2014 - 2015 Actor LLC . < https : / / actor . im > < nl > / / < nl > < nl > - < nl > - / * < nl > - * Auth Screen < nl > - * / < nl > - < nl > - " AuthMoreInfo " = " Free , fast and secure messaging . " ; < nl > - < nl > - " AuthStarButton " = " Start Messaging " ; < nl > - < nl > - < nl > / * < nl > * Main Screen < nl > * / < nl > @ @ - 257 , 6 + 247 , 12 @ @ < nl > " CreateGroupMembersPlaceholders " = " Enter Names " ; < nl > < nl > / * < nl > + * Location < nl > + * / < nl > + < nl > + " LocationTitle " = " Location " ; < nl > + < nl > + / * < nl > * Notifications < nl > * / < nl > < nl > @ @ - 376 , 6 + 372 , 10 @ @ < nl > * Auth < nl > * / < nl > < nl > + " AuthMoreInfo " = " Free , fast and secure messaging . " ; < nl > + < nl > + " AuthStarButton " = " Start Messaging " ; < nl > + < nl > " AuthPhoneTitle " = " Your Phone " ; < nl > < nl > " AuthPhoneNumberHint " = " Your phone number " ; < nl > @ @ - 408 , 6 + 408 , 8 @ @ < nl > < nl > " AuthProfileHint " = " Enter your name and add a pofile picture " ; < nl > < nl > + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; < nl > + < nl > / * < nl > * Common Elements < nl > * / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > index af53776 . . bd67bfe 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings < nl > @ @ - 336 , 6 + 336 , 8 @ @ < nl > < nl > " AuthProfileHint " = " Escribe tu nombre y a ñ ade una imagen de perfil " ; < nl > < nl > + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; < nl > + < nl > " CurrentLocale " = " En " ; < nl > < nl > " InviteText " = " ¡ Hola ! , ¡ prueba { appname } mensajer í a ! { link } " ; < nl > @ @ - 399 , 3 + 401 , 9 @ @ < nl > " ErrorAlreadyJoined " = " Ya eres miembro del grupo " ; < nl > < nl > " ErrorUnableToJoin " = " Unable to join to group " ; < nl > + < nl > + / * < nl > + * Location < nl > + * / < nl > + < nl > + " LocationTitle " = " Ubicati ó n " ; < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings < nl > index 7b6ce21 . . 65537ad 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings < nl > @ @ - 376 , 6 + 376 , 8 @ @ < nl > < nl > " AuthProfileHint " = " Insira seu nome e adicione uma foto para o perfil " ; < nl > < nl > + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; < nl > + < nl > / * < nl > * Common Elements < nl > * / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings < nl > index 52b34d2 . . ed98fec 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings < nl > @ @ - 235 , 6 + 235 , 12 @ @ < nl > " CreateGroupMembersPlaceholders " = " В в е д и т е и м е н а " ; < nl > < nl > / * < nl > + * Location < nl > + * / < nl > + < nl > + " LocationTitle " = " М е с т о п о л о ж е н и е " ; < nl > + < nl > + / * < nl > * Notifications < nl > * / < nl > < nl > @ @ - 380 , 6 + 386 , 8 @ @ < nl > < nl > " AuthProfileHint " = " В в е д и т е с в о е и м я и ф о т о " ; < nl > < nl > + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; < nl > + < nl > / * < nl > * Common Elements < nl > * / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings < nl > index 8370d23 . . 4a00124 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings < nl > @ @ - 378 , 6 + 378 , 14 @ @ < nl > < nl > " AuthProfileHint " = " 请 输 入 你 的 名 字 并 上 传 头 像 " ; < nl > < nl > + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; < nl > + < nl > + / * < nl > + * Location < nl > + * / < nl > + < nl > + " LocationTitle " = " Location " ; < nl > + < nl > / * < nl > * Common Elements < nl > * / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift < nl > index cb82d60 . . 19ab669 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift < nl > @ @ - 91 , 7 + 91 , 7 @ @ class AATermsController : UIViewController , UIViewControllerTransitioningDelegate < nl > self . alertTextView . scrollEnabled = false < nl > self . alertTextView . backgroundColor = UIColor . clearColor ( ) < nl > self . alertTextView . editable = false < nl > - self . alertTextView . text = " By signing up to \ ( ActorSDK . sharedActor ( ) . appNameInLocStrings ) , you agree not to : \ n \ n - use our service to send spam and scam users . \ n " + " - use our service to send spam and scam users . \ n " + " - use our service to send spam and scam users . \ n " + " - promote violence on publicly viewable \ ( ActorSDK . sharedActor ( ) . appNameInLocStrings ) bots or channels . \ n \ n " + " We reserve the right to update these Terms of Service later . " < nl > + self . alertTextView . text = AALocalized ( " AuthTerms " ) . replace ( " { app _ name } " , dest : ActorSDK . sharedActor ( ) . appNameInLocStrings ) < nl > self . alertTextView . frame = CGRectMake ( 10 , 45 , 220 , 270 ) ; < nl > self . alertView . addSubview ( self . alertTextView ) < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift < nl > index 5046c3b . . b717cf4 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift < nl > @ @ - 17 , 7 + 17 , 7 @ @ public class AALocationPickerController : AAViewController , CLLocationManagerDele < nl > override init ( ) { < nl > super . init ( ) < nl > < nl > - navigationItem . title = " Location " < nl > + navigationItem . title = AALocalized ( " LocationTitle " ) < nl > navigationItem . leftBarButtonItem = UIBarButtonItem ( title : AALocalized ( " NavigationCancel " ) , style : . Plain , target : self , action : " cancellDidTap " ) < nl > < nl > updateAuthStatus ( CLLocationManager . authorizationStatus ( ) ) < nl > diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java < nl > index 44a5ab0 . . 9f706d9 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java < nl > + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java < nl > @ @ - 40 , 13 + 40 , 13 @ @ public class JsMessage extends JavaScriptObject { < nl > < nl > @ Override < nl > public JavaScriptObject buildOverlay ( Message prev , Message current , Message next ) { < nl > - Date prevDate = prev ! = null ? new Date ( prev . getDate ( ) ) : null ; < nl > + Date nextDate = next ! = null ? new Date ( next . getDate ( ) ) : null ; < nl > Date currentDate = new Date ( current . getDate ( ) ) ; < nl > < nl > boolean showDate ; < nl > String dateDiv = null ; < nl > - if ( prev ! = null ) { < nl > - showDate = ! CalendarUtil . isSameDate ( prevDate , currentDate ) ; < nl > + if ( next ! = null ) { < nl > + showDate = ! CalendarUtil . isSameDate ( nextDate , currentDate ) ; < nl > } else { < nl > showDate = true ; < nl > } < nl > @ @ - 55 , 9 + 55 , 9 @ @ public class JsMessage extends JavaScriptObject { < nl > } < nl > < nl > boolean useCompact = false ; < nl > - if ( prev ! = null & & ! showDate ) { < nl > - if ( prev . getSenderId ( ) = = current . getSenderId ( ) ) { < nl > - if ( prev . getDate ( ) - current . getDate ( ) < 10 * 60 * 1000 ) { < nl > + if ( next ! = null & & ! showDate ) { < nl > + if ( next . getSenderId ( ) = = current . getSenderId ( ) ) { < nl > + if ( next . getDate ( ) - current . getDate ( ) < 10 * 60 * 1000 ) { < nl > useCompact = true ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > index bd83c77 . . e8e50c4 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > @ @ - 100 , 7 + 100 , 6 @ @ public class StickersModule extends AbsModule { < nl > < nl > vms . removeAll ( remove ) ; < nl > } catch ( Exception e ) { < nl > - e . printStackTrace ( ) ; < nl > } < nl > return vms ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java < nl > index b77ac37 . . fdeca48 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java < nl > @ @ - 298 , 9 + 298 , 15 @ @ public class DialogsActor extends ModuleActor { < nl > switch ( peer . getPeerType ( ) ) { < nl > case PRIVATE : < nl > User u = getUser ( peer . getPeerId ( ) ) ; < nl > + if ( u = = null ) { < nl > + return null ; < nl > + } < nl > return new PeerDesc ( u . getName ( ) , u . getAvatar ( ) ) ; < nl > case GROUP : < nl > Group g = getGroup ( peer . getPeerId ( ) ) ; < nl > + if ( g = = null ) { < nl > + return null ; < nl > + } < nl > return new PeerDesc ( g . getTitle ( ) , g . getAvatar ( ) ) ; < nl > default : < nl > return null ; < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java < nl > index 2350be1 . . b92cf4d 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java < nl > @ @ - 127 , 10 + 127 , 16 @ @ public class GroupedDialogsActor extends ModuleActor { < nl > Avatar avatar ; < nl > if ( p . getPeerType ( ) = = PeerType . GROUP ) { < nl > Group group = getGroup ( p . getPeerId ( ) ) ; < nl > + if ( group = = null ) { < nl > + continue ; < nl > + } < nl > title = group . getTitle ( ) ; < nl > avatar = group . getAvatar ( ) ; < nl > } else if ( p . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > User user = getUser ( p . getPeerId ( ) ) ; < nl > + if ( user = = null ) { < nl > + continue ; < nl > + } < nl > title = user . getName ( ) ; < nl > avatar = user . getAvatar ( ) ; < nl > } else { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java < nl > index 1afd14b . . 2b7a6cf 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java < nl > @ @ - 47 , 6 + 47 , 7 @ @ public class ActorTrace implements TraceInterface { < nl > @ Override < nl > public void onActorDie ( ActorRef ref , Envelope envelope , Exception e ) { < nl > Log . w ( TAG , " Die ( " + ref . getPath ( ) + " ) by " + envelope . getMessage ( ) ) ; < nl > - Log . e ( TAG , e ) ; < nl > + / / Log . e ( TAG , e ) ; < nl > + e . printStackTrace ( ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java < nl > index 1b5c03d . . 24eb586 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java < nl > @ @ - 21 , 6 + 21 , 8 @ @ import im . actor . runtime . storage . ListEngineItem ; < nl > public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & ListEngineItem > implements JsListEngineCallback < V > , < nl > PlatformDisplayList < V > { < nl > < nl > + private static final String TAG = " JsDisplayList " ; < nl > + < nl > private final JsListEngine < V > listEngine ; < nl > private final JsEntityConverter < V , T > entityConverter ; < nl > < nl > @ @ - 109 , 6 + 111 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li < nl > if ( isOverlaysSupported ) { < nl > markAsDirty ( i ) ; < nl > jsOverlays . remove ( i ) ; < nl > + isOverlayDirty . remove ( i ) ; < nl > } < nl > break ; < nl > } < nl > @ @ - 120 , 6 + 123 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li < nl > jsValues . insert ( i , entityConverter . convert ( item ) ) ; < nl > if ( isOverlaysSupported ) { < nl > jsOverlays . insert ( i , null ) ; < nl > + isOverlayDirty . add ( i , true ) ; < nl > markAsDirty ( i ) ; < nl > } < nl > return ; < nl > @ @ - 130 , 6 + 134 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li < nl > jsValues . push ( entityConverter . convert ( item ) ) ; < nl > if ( isOverlaysSupported ) { < nl > jsOverlays . push ( null ) ; < nl > + isOverlayDirty . add ( true ) ; < nl > markAsDirty ( values . size ( ) - 1 ) ; < nl > } < nl > } < nl > @ @ - 158 , 6 + 163 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li < nl > if ( isOverlaysSupported ) { < nl > markAsDirty ( i ) ; < nl > jsOverlays . remove ( i ) ; < nl > + isOverlayDirty . add ( true ) ; < nl > } < nl > break ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java < nl > index 47b2fde . . fe4de7f 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java < nl > @ @ - 19 , 6 + 19 , 8 @ @ import im . actor . runtime . storage . ListEngineRecord ; < nl > < nl > public class JsListEngine < T extends BserObject & ListEngineItem > implements ListEngine < T > { < nl > < nl > + private static final String TAG = " JsListEngine " ; < nl > + < nl > private JsListStorage storage ; < nl > private BserCreator < T > creator ; < nl > private HashMap < Long , T > cache = new HashMap < Long , T > ( ) ; < nl > @ @ - 40 , 6 + 42 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onItemAddedOrUpdated ( item ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( addOrUpdateItem ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > @ @ - 61 , 6 + 64 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onItemsAddedOrUpdated ( items ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( addOrUpdateItems ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > @ @ - 82 , 6 + 86 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onItemsReplaced ( items ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( replaceItems ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > @ @ - 96 , 6 + 101 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onItemRemoved ( key ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( removeItem ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > @ @ - 111 , 6 + 117 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onItemsRemoved ( keys ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( removeItems ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > @ @ - 124 , 6 + 131 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List < nl > try { < nl > callback . onClear ( ) ; < nl > } catch ( Exception e ) { < nl > + Log . d ( TAG , " Exception during update ( clear ) " ) ; < nl > e . printStackTrace ( ) ; < nl > } < nl > } < nl > diff - - git a / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala b / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala < nl > index ddbd6ce . . a29c7ea 100644 < nl > - - - a / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala < nl > + + + b / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala < nl > @ @ - 5 , 6 + 5 , 7 @ @ import java . time . { LocalDateTime , ZoneOffset } < nl > < nl > import akka . actor . _ < nl > import akka . pattern . ask < nl > + import akka . pattern . pipe < nl > import akka . stream . Materializer < nl > import akka . util . Timeout < nl > import im . actor . server . activation . Activation . { CallCode , Code , EmailCode , SmsCode } < nl > @ @ - 112 , 8 + 113 , 7 @ @ class Activation ( repeatLimit : Duration , smsEngine : AuthSmsEngine , callEngine : Au < nl > < nl > override def receive : Receive = { < nl > case Send ( code ) ⇒ < nl > - val replyTo = sender ( ) < nl > - sendCode ( code ) foreach { resp ⇒ replyTo ! SendAck ( resp ) } < nl > + ( sendCode ( code ) map SendAck ) pipeTo sender ( ) < nl > case ForgetSentCode ( code ) ⇒ forgetSentCode ( code ) < nl > } < nl > < nl > @ @ - 131 , 7 + 131 , 10 @ @ class Activation ( repeatLimit : Duration , smsEngine : AuthSmsEngine , callEngine : Au < nl > } ) map { _ ⇒ < nl > forgetSentCodeAfterDelay ( code ) < nl > \ / - ( ( ) ) < nl > - } recover { case e ⇒ - \ / ( SendFailure ( " Unable to send code " ) ) } < nl > + } recover { case e ⇒ < nl > + log . error ( e , " Failed to send code : { } " , code ) < nl > + - \ / ( SendFailure ( " Unable to send code " ) ) < nl > + } < nl > } else { < nl > log . debug ( s " Ignoring send $ code " ) < nl > Future . successful ( - \ / ( BadRequest ( " Try to request code later " ) ) ) < nl > diff - - git a / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala b / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala < nl > index 8c18852 . . 6002d1e 100644 < nl > - - - a / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala < nl > + + + b / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala < nl > @ @ - 1 , 5 + 1 , 6 @ @ < nl > package im . actor . server . email < nl > < nl > + import im . actor . config . ActorConfig < nl > import org . apache . commons . mail . { DefaultAuthenticator , HtmlEmail } < nl > < nl > import scala . concurrent . { ExecutionContext , Future } < nl > @ @ - 30 , 8 + 31 , 11 @ @ final class DummyEmailSender extends EmailSender { < nl > } < nl > < nl > final class SmtpEmailSender ( config : EmailConfig ) ( implicit ec : ExecutionContext ) extends EmailSender { < nl > + val timeout = ( ActorConfig . defaultTimeout . toMillis / 2 ) . toInt < nl > override def send ( message : Message ) = Future { < nl > val email = new HtmlEmail ( ) < nl > + email . setSocketTimeout ( timeout ) < nl > + email . setSocketConnectionTimeout ( timeout ) < nl > email . setCharset ( " UTF - 8 " ) < nl > email . setHostName ( config . host ) < nl > email . setSmtpPort ( config . port ) < nl > diff - - git a / actor - server / src / universal / conf / server . conf . example b / actor - server / src / universal / conf / server . conf . example < nl > index ab14b65 . . fa52121 100644 < nl > - - - a / actor - server / src / universal / conf / server . conf . example < nl > + + + b / actor - server / src / universal / conf / server . conf . example < nl > @ @ - 71 , 7 + 71 , 7 @ @ services { < nl > < nl > # PostgreSQL storage for data < nl > # The only required service to start server < nl > - # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / Database . md < nl > + # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / configure - database . md < nl > postgresql { < nl > # Host of PostgreSQL instance < nl > host : localhost < nl > @ @ - 90 , 7 + 90 , 7 @ @ services { < nl > # enabling file sharing in apps < nl > aws { < nl > # S3 Storage , used for file sharing < nl > - # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / AWS . md < nl > + # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / configure - s3 . md < nl > s3 { < nl > # S3 Api Key < nl > access - key : < put _ your _ aws _ key _ here > < nl > diff - - git a / actor - server / src / universal / conf / server . conf . example - minimal b / actor - server / src / universal / conf / server . conf . example - minimal < nl > index 6e01530 . . 749dc3f 100644 < nl > - - - a / actor - server / src / universal / conf / server . conf . example - minimal < nl > + + + b / actor - server / src / universal / conf / server . conf . example - minimal < nl > @ @ - 16 , 19 + 16 , 6 @ @ services { < nl > actor - activation { < nl > auth - token : < token > < nl > } < nl > - < nl > - aws { < nl > - s3 { < nl > - # S3 Api Key < nl > - access - key : < YOUR AWS KEY ID > < nl > - < nl > - # S3 Api Secret < nl > - secret - key : < YOUR AWS SECRET KEY > < nl > - < nl > - # File bucket < nl > - default - bucket : < bucket for storing files > < nl > - } < nl > - } < nl > } < nl > < nl > secret : < put a long random string here >
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / android / build . gradle b / actor - sdk / sdk - core / core / android / build . gradle < nl > index 56f94bc . . f864e0e 100644 < nl > - - - a / actor - sdk / sdk - core / core / android / build . gradle < nl > + + + b / actor - sdk / sdk - core / core / android / build . gradle < nl > @ @ - 26 , 11 + 26 , 11 @ @ android { < nl > main { < nl > java { < nl > srcDirs = [ ' src / main / java ' , < nl > - ' . . / main / src / main / java ' , < nl > - ' . . / main / src / ext / java ' ] < nl > + ' . . / shared / src / main / java ' , < nl > + ' . . / shared / src / ext / java ' ] < nl > } < nl > resources { < nl > - srcDirs = [ ' . . / main / src / main / resources ' ] < nl > + srcDirs = [ ' . . / shared / src / main / resources ' ] < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / cocoa / build . gradle b / actor - sdk / sdk - core / core / cocoa / build . gradle < nl > index 8a861ed . . 111e8b1 100644 < nl > - - - a / actor - sdk / sdk - core / core / cocoa / build . gradle < nl > + + + b / actor - sdk / sdk - core / core / cocoa / build . gradle < nl > @ @ - 9 , 47 + 9 , 11 @ @ sourceSets { < nl > main { < nl > java { < nl > srcDirs = [ ' src / main / java ' , < nl > - ' . . / main / src / main / java ' ] < nl > + ' . . / shared / src / main / java ' ] < nl > } < nl > } < nl > } < nl > < nl > dependencies { < nl > compile project ( ' : runtime : cocoa ' ) < nl > - } < nl > - < nl > - task cycleFinder ( ) { < nl > - doFirst { < nl > - < nl > - Properties properties = new Properties ( ) < nl > - properties . load ( project . rootProject . file ( ' local . properties ' ) . newDataInputStream ( ) ) < nl > - < nl > - delete " $ { projectDir } / src / gen / objc / " < nl > - < nl > - exec { < nl > - < nl > - executable " $ { properties . get ( " j2objcDir " ) } / cycle _ finder " < nl > - < nl > - def srcFiles = fileTree ( " $ { projectDir } / src / main / java / " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - < nl > - srcFiles = fileTree ( " $ { projectDir } / . . / core / src / ext / java / " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - < nl > - srcFiles = fileTree ( " $ { projectDir } / . . / core / src / main / java / " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - } < nl > - } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / js / build . gradle b / actor - sdk / sdk - core / core / js / build . gradle < nl > index 7c2bfbd . . 65707fe 100644 < nl > - - - a / actor - sdk / sdk - core / core / js / build . gradle < nl > + + + b / actor - sdk / sdk - core / core / js / build . gradle < nl > @ @ - 27 , 10 + 27 , 10 @ @ gwt { < nl > sourceSets { < nl > main { < nl > java { < nl > - srcDirs = [ ' src / main / java ' , ' . . / main / src / main / java ' , ' . . / main / src / ext / java ' , ' . . / . . / runtime / main / src / main / java ' , ' . . / . . / runtime / js / src / main / java ' ] < nl > + srcDirs = [ ' src / main / java ' , ' . . / shared / src / main / java ' , ' . . / shared / src / ext / java ' , ' . . / . . / runtime / shared / src / main / java ' , ' . . / . . / runtime / js / src / main / java ' ] < nl > } < nl > resources { < nl > - srcDirs = [ ' . . / main / src / main / resources ' ] < nl > + srcDirs = [ ' . . / shared / src / main / resources ' ] < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / shared / build . gradle b / actor - sdk / sdk - core / core / shared / build . gradle < nl > index 2f221bd . . 452c982 100644 < nl > - - - a / actor - sdk / sdk - core / core / shared / build . gradle < nl > + + + b / actor - sdk / sdk - core / core / shared / build . gradle < nl > @ @ - 9 , 9 + 9 , 8 @ @ sourceSets { < nl > main { < nl > java { < nl > srcDirs = [ ' src / main / java ' , < nl > - ' src / ext / java ' , < nl > - ' . . / . . / runtime / main / src / main / java ' , < nl > - ' . . / . . / runtime / main / src / template / java ' ] < nl > + ' . . / . . / runtime / shared / src / main / java ' , < nl > + ' . . / . . / runtime / shared / src / template / java ' ] < nl > } < nl > resources { < nl > srcDir ' src / main / resources ' < nl > diff - - git a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java b / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java < nl > deleted file mode 100644 < nl > index 8e2aa9f . . 0000000 < nl > - - - a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java < nl > + + + / dev / null < nl > @ @ - 1 , 59 + 0 , 0 @ @ < nl > - package im . actor . core ; < nl > - < nl > - import im . actor . core . modules . ModuleContext ; < nl > - import im . actor . runtime . util . ClassCreator ; < nl > - < nl > - class ExampleExtension implements Extension { < nl > - < nl > - / * * < nl > - * Define public extension key for easier accessing < nl > - * to extensions from other ones or outside of core < nl > - * / < nl > - public static final String KEY = " example " ; < nl > - < nl > - / * * < nl > - * For registering extension implement creator and add it to Extensions class < nl > - * / < nl > - public static ClassCreator < ExampleExtension > CREATOR = new ClassCreator < ExampleExtension > ( ) { < nl > - @ Override < nl > - public ExampleExtension newInstance ( ) { < nl > - return new ExampleExtension ( ) ; < nl > - } < nl > - } ; < nl > - < nl > - / * * < nl > - * Keep reference to context < nl > - * / < nl > - private ModuleContext context ; < nl > - < nl > - / * * < nl > - * Get unique extension key < nl > - * < nl > - * @ return extension key < nl > - * / < nl > - @ Override < nl > - public String getExtensionKey ( ) { < nl > - return KEY ; < nl > - } < nl > - < nl > - / * * < nl > - * Performing registration of extension before Messenger run < nl > - * < nl > - * @ param context Module context < nl > - * / < nl > - @ Override < nl > - public void registerExtension ( ModuleContext context ) { < nl > - this . context = context ; < nl > - < nl > - / / TODO : Register extension . For example register new content types or update handlers < nl > - } < nl > - < nl > - / * * < nl > - * Running extension < nl > - * / < nl > - @ Override < nl > - public void runExtension ( ) { < nl > - < nl > - / / TODO : Start extension actors < nl > - } < nl > - } < nl > diff - - git a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java b / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java < nl > deleted file mode 100644 < nl > index 5a2d3a9 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java < nl > + + + / dev / null < nl > @ @ - 1 , 75 + 0 , 0 @ @ < nl > - package im . actor . core ; < nl > - < nl > - import java . util . HashMap ; < nl > - < nl > - import im . actor . core . modules . ModuleContext ; < nl > - import im . actor . runtime . util . ClassCreator ; < nl > - < nl > - / * * < nl > - * Extensions index < nl > - * / < nl > - public class Extensions { < nl > - < nl > - / / Add here Your extensions < nl > - private static final ClassCreator < Extension > [ ] APP _ EXTENSIONS = new ClassCreator [ ] { < nl > - ExampleExtension . CREATOR < nl > - } ; < nl > - < nl > - / * * < nl > - * Context for extensions < nl > - * / < nl > - private ModuleContext context ; < nl > - < nl > - / * * < nl > - * Created extensions < nl > - * / < nl > - private Extension [ ] extensions ; < nl > - < nl > - / * * < nl > - * Map of extension from key to extension < nl > - * / < nl > - private HashMap < String , Extension > extensionsMap ; < nl > - < nl > - / * * < nl > - * Create extensions module < nl > - * < nl > - * @ param context module context < nl > - * / < nl > - public Extensions ( ModuleContext context ) { < nl > - this . context = context ; < nl > - } < nl > - < nl > - / * * < nl > - * Creating and registering extensions < nl > - * / < nl > - public void registerExtensions ( ) { < nl > - extensionsMap = new HashMap < String , Extension > ( ) ; < nl > - extensions = new Extension [ APP _ EXTENSIONS . length ] ; < nl > - for ( int i = 0 ; i < extensions . length ; i + + ) { < nl > - extensions [ i ] = APP _ EXTENSIONS [ i ] . newInstance ( ) ; < nl > - extensionsMap . put ( extensions [ i ] . getExtensionKey ( ) , extensions [ i ] ) ; < nl > - } < nl > - for ( int i = 0 ; i < extensions . length ; i + + ) { < nl > - extensions [ i ] . registerExtension ( context ) ; < nl > - } < nl > - } < nl > - < nl > - / * * < nl > - * Running extensions < nl > - * / < nl > - public void runExtensions ( ) { < nl > - for ( int i = 0 ; i < extensions . length ; i + + ) { < nl > - extensions [ i ] . runExtension ( ) ; < nl > - } < nl > - } < nl > - < nl > - / * * < nl > - * Finding extension < nl > - * < nl > - * @ param key key of extension < nl > - * @ return founded extension , null if not found < nl > - * / < nl > - public Extension findExtension ( String key ) { < nl > - return extensionsMap . get ( key ) ; < nl > - } < nl > - } < nl > diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java < nl > index efa24da . . 77b90cc 100644 < nl > - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 1648 , 17 + 1648 , 6 @ @ public class Messenger { < nl > } < nl > < nl > / * * < nl > - * Find core extension by key < nl > - * < nl > - * @ param key extension key < nl > - * @ return founded extension , null if not found < nl > - * / < nl > - @ ObjectiveCName ( " findExtension : " ) < nl > - public Extension findExtension ( String key ) { < nl > - return modules . findExtension ( key ) ; < nl > - } < nl > - < nl > - / * * < nl > * Get modules of messenger for extensions < nl > * < nl > * @ return Module Contexts < nl > diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > index cb391f6 . . 36a6d73 100644 < nl > - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > @ @ - 83 , 6 + 83 , 4 @ @ public interface ModuleContext { < nl > Messenger getMessenger ( ) ; < nl > < nl > MentionsModule getMentions ( ) ; < nl > - < nl > - Extension findExtension ( String key ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java < nl > index 4e1aab8 . . a82d6b9 100644 < nl > - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java < nl > + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java < nl > @ @ - 6 , 7 + 6 , 6 @ @ package im . actor . core . modules ; < nl > < nl > import im . actor . core . Configuration ; < nl > import im . actor . core . Extension ; < nl > - import im . actor . core . Extensions ; < nl > import im . actor . core . Messenger ; < nl > import im . actor . core . i18n . I18nEngine ; < nl > import im . actor . core . modules . internal . AppStateModule ; < nl > @ @ - 68 , 7 + 67 , 6 @ @ public class Modules implements ModuleContext { < nl > private volatile SecurityModule security ; < nl > private volatile DisplayLists displayLists ; < nl > private volatile MentionsModule mentions ; < nl > - private volatile Extensions extensions ; < nl > < nl > public Modules ( Messenger messenger , Configuration configuration ) { < nl > this . messenger = messenger ; < nl > @ @ - 135 , 9 + 133 , 6 @ @ public class Modules implements ModuleContext { < nl > mentions = new MentionsModule ( this ) ; < nl > timing . section ( " DisplayLists " ) ; < nl > displayLists = new DisplayLists ( this ) ; < nl > - timing . section ( " Extension " ) ; < nl > - extensions = new Extensions ( this ) ; < nl > - extensions . registerExtensions ( ) ; < nl > timing . end ( ) ; < nl > < nl > < nl > @ @ - 158 , 8 + 153 , 6 @ @ public class Modules implements ModuleContext { < nl > messages . run ( ) ; < nl > timing . section ( " Updates " ) ; < nl > updates . run ( ) ; < nl > - timing . section ( " Extension " ) ; < nl > - extensions . runExtensions ( ) ; < nl > timing . end ( ) ; < nl > < nl > messenger . onLoggedIn ( ) ; < nl > @ @ - 278 , 11 + 271 , 6 @ @ public class Modules implements ModuleContext { < nl > return mentions ; < nl > } < nl > < nl > - @ Override < nl > - public Extension findExtension ( String key ) { < nl > - return extensions . findExtension ( key ) ; < nl > - } < nl > - < nl > public EventBus getEvents ( ) { < nl > return events ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / android / build . gradle b / actor - sdk / sdk - core / runtime / android / build . gradle < nl > index 2720e20 . . 198af14 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / android / build . gradle < nl > + + + b / actor - sdk / sdk - core / runtime / android / build . gradle < nl > @ @ - 25 , 8 + 25 , 8 @ @ android { < nl > main { < nl > java { < nl > srcDirs = [ ' src / main / java ' , < nl > - ' . . / main / src / main / java ' , < nl > - ' . . / main / src / generic / java ' ] < nl > + ' . . / shared / src / main / java ' , < nl > + ' . . / shared / src / generic / java ' ] < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / cocoa / build . gradle b / actor - sdk / sdk - core / runtime / cocoa / build . gradle < nl > index b515a8d . . 1296a11 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / cocoa / build . gradle < nl > + + + b / actor - sdk / sdk - core / runtime / cocoa / build . gradle < nl > @ @ - 9 , 46 + 9 , 8 @ @ sourceSets { < nl > main { < nl > java { < nl > srcDirs = [ ' src / main / java ' , < nl > - ' . . / main / src / main / java ' , < nl > - ' . . / main / src / generic / java ' ] < nl > + ' . . / shared / src / main / java ' , < nl > + ' . . / shared / src / generic / java ' ] < nl > } < nl > } < nl > - } < nl > - < nl > - task cycleFinder ( ) { < nl > - < nl > - doFirst { < nl > - < nl > - Properties properties = new Properties ( ) < nl > - properties . load ( project . rootProject . file ( ' local . properties ' ) . newDataInputStream ( ) ) < nl > - < nl > - exec { < nl > - < nl > - executable " $ { properties . get ( " j2objcDir " ) } / cycle _ finder " < nl > - < nl > - def srcFiles = fileTree ( " $ { projectDir } / src / main / java / " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - < nl > - srcFiles = fileTree ( " $ { projectDir } / . . / runtime / src / main / java / " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - < nl > - srcFiles = fileTree ( " $ { projectDir } / . . / runtime / src / generic / java " ) . matching { < nl > - exclude " * * / ObjectiveCName . java " < nl > - } < nl > - srcFiles . each { file - > < nl > - args file . path < nl > - } < nl > - } < nl > - } < nl > - } < nl > - < nl > - cycleFinder . dependsOn compileJava < nl > - build . dependsOn cycleFinder < nl > \ No newline at end of file < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / runtime / js / build . gradle b / actor - sdk / sdk - core / runtime / js / build . gradle < nl > index 27c8350 . . 4dca44c 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / js / build . gradle < nl > + + + b / actor - sdk / sdk - core / runtime / js / build . gradle < nl > @ @ - 26 , 7 + 26 , 7 @ @ gwt { < nl > sourceSets { < nl > main { < nl > java { < nl > - srcDirs = [ ' src / main / java ' , ' . . / main / src / main / java ' ] < nl > + srcDirs = [ ' src / main / java ' , ' . . / shared / src / main / java ' ] < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java < nl > index 8a3b34b . . 1003f2e 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java < nl > @ @ - 5 , 14 + 5 , 8 @ @ < nl > package im . actor . runtime . js ; < nl > < nl > < nl > - import im . actor . runtime . crypto . CryptoKeyPair ; < nl > import im . actor . runtime . crypto . bouncycastle . BouncyCastleRuntime ; < nl > - import im . actor . runtime . js . crypto . Rsa ; < nl > < nl > public class JsCryptoProvider extends BouncyCastleRuntime { < nl > < nl > - @ Override < nl > - public CryptoKeyPair generateRSA1024KeyPair ( ) { < nl > - return Rsa . generate1024RsaKey ( ) ; < nl > - } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java < nl > deleted file mode 100644 < nl > index 11cb173 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java < nl > + + + / dev / null < nl > @ @ - 1 , 22 + 0 , 0 @ @ < nl > - / * < nl > - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > - * / < nl > - < nl > - package im . actor . runtime . js . crypto ; < nl > - < nl > - import im . actor . runtime . crypto . Base64Utils ; < nl > - import im . actor . runtime . crypto . CryptoKeyPair ; < nl > - < nl > - public class Rsa { < nl > - < nl > - public static CryptoKeyPair generate1024RsaKey ( ) { < nl > - RsaKey rsaKey = generate1024RsaKeyJs ( ) ; < nl > - return new CryptoKeyPair ( Base64Utils . fromBase64 ( rsaKey . getPublicKey ( ) ) , < nl > - Base64Utils . fromBase64 ( rsaKey . getPrivateKey ( ) ) ) ; < nl > - } < nl > - < nl > - private static native RsaKey generate1024RsaKeyJs ( ) / * - { < nl > - var crypt = new $ wnd . JSEncrypt ( { default _ key _ size : 1024 } ) ; < nl > - return { publicKey : crypt . getKey ( ) . getPublicBaseKeyB64 ( ) , privateKey : crypt . getKey ( ) . getPrivateBaseKeyB64 ( ) } ; < nl > - } - * / ; < nl > - } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java < nl > deleted file mode 100644 < nl > index 9773fa4 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java < nl > + + + / dev / null < nl > @ @ - 1 , 17 + 0 , 0 @ @ < nl > - / * < nl > - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > - * / < nl > - < nl > - package im . actor . runtime . js . crypto ; < nl > - < nl > - import com . google . gwt . core . client . JavaScriptObject ; < nl > - < nl > - public class RsaKey extends JavaScriptObject { < nl > - protected RsaKey ( ) { < nl > - < nl > - } < nl > - < nl > - public final native String getPrivateKey ( ) / * - { return this . privateKey ; } - * / ; < nl > - < nl > - public final native String getPublicKey ( ) / * - { return this . publicKey ; } - * / ; < nl > - } < nl > diff - - git a / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar b / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar < nl > new file mode 100644 < nl > index 0000000 . . 5470617 < nl > Binary files / dev / null and b / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar differ < nl > diff - - git a / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java b / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java < nl > index 97b9ead . . f5b9643 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java < nl > @ @ - 1 , 33 + 1 , 6 @ @ < nl > package im . actor . runtime ; < nl > < nl > - import im . actor . runtime . crypto . AesCipher ; < nl > - import im . actor . runtime . crypto . CryptoKeyPair ; < nl > - import im . actor . runtime . crypto . RsaCipher ; < nl > - import im . actor . runtime . crypto . RsaEncryptCipher ; < nl > - < nl > - / * * < nl > - * Created by ex3ndr on 07 . 08 . 15 . < nl > - * / < nl > public class CryptoRuntimeProvider implements CryptoRuntime { < nl > - @ Override < nl > - public CryptoKeyPair generateRSA1024KeyPair ( ) { < nl > - throw new RuntimeException ( " Dumb " ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public RsaEncryptCipher createRSAOAEPSHA1Cipher ( byte [ ] publicKey ) { < nl > - throw new RuntimeException ( " Dumb " ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public RsaCipher createRSAOAEPSHA1Cipher ( byte [ ] publicKey , byte [ ] privateKey ) { < nl > - throw new RuntimeException ( " Dumb " ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public AesCipher createAESCBCPKS7Cipher ( byte [ ] key , byte [ ] iv ) { < nl > - throw new RuntimeException ( " Dumb " ) ; < nl > - } < nl > < nl > @ Override < nl > public byte [ ] MD5 ( byte [ ] data ) {

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml 
 index 9bd6c06 . . 27b45bd 100644 
 - - - a / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - google - push / src / main / AndroidManifest . xml 
 @ @ - 10 , 7 + 10 , 6 @ @ 
 
 < application 
 android : allowBackup = " true " 
 - android : label = " @ string / app _ name " 
 android : supportsRtl = " true " > 
 < receiver 
 android : name = " im . actor . push . PushReceiver " 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index 3b63c61 . . 4fa03d0 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 803 , 15 + 803 , 15 @ @ 
 	 	 066A52601BC50E6B000E606E / * Auth * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 - 	 	 	 	 153F6B8C1C2D83B200C0B960 / * Views * / , 
 - 	 	 	 	 153F6B601C2BF8EC00C0B960 / * AAAuthWelcomeController . swift * / , 
 	 	 	 	 066A526E1BC51007000E606E / * Views * / , 
 	 	 	 	 066A526B1BC50E83000E606E / * Cells * / , 
 + 	 	 	 	 153F6B8D1C2D868100C0B960 / * AATermsController . swift * / , 
 	 	 	 	 066A52611BC50E7B000E606E / * AAAuthCountriesViewController . swift * / , 
 	 	 	 	 066A52621BC50E7B000E606E / * AAAuthPhoneViewController . swift * / , 
 	 	 	 	 066A52631BC50E7B000E606E / * AAAuthCodeViewController . swift * / , 
 	 	 	 	 066A52641BC50E7B000E606E / * AAAuthRegisterViewController . swift * / , 
 	 	 	 	 066A52651BC50E7B000E606E / * AAAuthViewController . swift * / , 
 + 	 	 	 	 153F6B601C2BF8EC00C0B960 / * AAAuthWelcomeController . swift * / , 
 	 	 	 	 065974A41BC621F100B8C7DF / * AAAuthNavigationController . swift * / , 
 	 	 	 ) ; 
 	 	 	 path = Auth ; 
 @ @ - 1162 , 14 + 1162 , 6 @ @ 
 	 	 	 name = TapedLabel ; 
 	 	 	 sourceTree = " < group > " ; 
 	 	 } ; 
 - 	 	 153F6B8C1C2D83B200C0B960 / * Views * / = { 
 - 	 	 	 isa = PBXGroup ; 
 - 	 	 	 children = ( 
 - 	 	 	 	 153F6B8D1C2D868100C0B960 / * AATermsController . swift * / , 
 - 	 	 	 ) ; 
 - 	 	 	 name = Views ; 
 - 	 	 	 sourceTree = " < group > " ; 
 - 	 	 } ; 
 	 	 15D35F0A1C20182900E3717A / * AudioRecorder * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings 
 index f5e00b2 . . 9cbacb4 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / Base . lproj / Localizable . strings 
 @ @ - 2 , 16 + 2 , 6 @ @ 
 / / Copyright ( C ) 2014 - 2015 Actor LLC . < https : / / actor . im > 
 / / 
 
 - 
 - / * 
 - * Auth Screen 
 - * / 
 - 
 - " AuthMoreInfo " = " Free , fast and secure messaging . " ; 
 - 
 - " AuthStarButton " = " Start Messaging " ; 
 - 
 - 
 / * 
 * Main Screen 
 * / 
 @ @ - 257 , 6 + 247 , 12 @ @ 
 " CreateGroupMembersPlaceholders " = " Enter Names " ; 
 
 / * 
 + * Location 
 + * / 
 + 
 + " LocationTitle " = " Location " ; 
 + 
 + / * 
 * Notifications 
 * / 
 
 @ @ - 376 , 6 + 372 , 10 @ @ 
 * Auth 
 * / 
 
 + " AuthMoreInfo " = " Free , fast and secure messaging . " ; 
 + 
 + " AuthStarButton " = " Start Messaging " ; 
 + 
 " AuthPhoneTitle " = " Your Phone " ; 
 
 " AuthPhoneNumberHint " = " Your phone number " ; 
 @ @ - 408 , 6 + 408 , 8 @ @ 
 
 " AuthProfileHint " = " Enter your name and add a pofile picture " ; 
 
 + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; 
 + 
 / * 
 * Common Elements 
 * / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 index af53776 . . bd67bfe 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / es . lproj / Localizable . strings 
 @ @ - 336 , 6 + 336 , 8 @ @ 
 
 " AuthProfileHint " = " Escribe tu nombre y a ñ ade una imagen de perfil " ; 
 
 + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; 
 + 
 " CurrentLocale " = " En " ; 
 
 " InviteText " = " ¡ Hola ! , ¡ prueba { appname } mensajer í a ! { link } " ; 
 @ @ - 399 , 3 + 401 , 9 @ @ 
 " ErrorAlreadyJoined " = " Ya eres miembro del grupo " ; 
 
 " ErrorUnableToJoin " = " Unable to join to group " ; 
 + 
 + / * 
 + * Location 
 + * / 
 + 
 + " LocationTitle " = " Ubicati ó n " ; 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings 
 index 7b6ce21 . . 65537ad 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / pt . lproj / Localizable . strings 
 @ @ - 376 , 6 + 376 , 8 @ @ 
 
 " AuthProfileHint " = " Insira seu nome e adicione uma foto para o perfil " ; 
 
 + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; 
 + 
 / * 
 * Common Elements 
 * / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings 
 index 52b34d2 . . ed98fec 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / ru . lproj / Localizable . strings 
 @ @ - 235 , 6 + 235 , 12 @ @ 
 " CreateGroupMembersPlaceholders " = " В в е д и т е и м е н а " ; 
 
 / * 
 + * Location 
 + * / 
 + 
 + " LocationTitle " = " М е с т о п о л о ж е н и е " ; 
 + 
 + / * 
 * Notifications 
 * / 
 
 @ @ - 380 , 6 + 386 , 8 @ @ 
 
 " AuthProfileHint " = " В в е д и т е с в о е и м я и ф о т о " ; 
 
 + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; 
 + 
 / * 
 * Common Elements 
 * / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings b / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings 
 index 8370d23 . . 4a00124 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Resources / zh - Hans . lproj / Localizable . strings 
 @ @ - 378 , 6 + 378 , 14 @ @ 
 
 " AuthProfileHint " = " 请 输 入 你 的 名 字 并 上 传 头 像 " ; 
 
 + " AuthTerms " = " By signing up to { app _ name } , you agree not to : \ n \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - use our service to send spam and scam users . \ n - promote violence on publicly viewable { app _ name } bots or channels . \ n \ nWe reserve the right to update these Terms of Service later . " ; 
 + 
 + / * 
 + * Location 
 + * / 
 + 
 + " LocationTitle " = " Location " ; 
 + 
 / * 
 * Common Elements 
 * / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift 
 index cb82d60 . . 19ab669 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Auth / AATermsController . swift 
 @ @ - 91 , 7 + 91 , 7 @ @ class AATermsController : UIViewController , UIViewControllerTransitioningDelegate 
 self . alertTextView . scrollEnabled = false 
 self . alertTextView . backgroundColor = UIColor . clearColor ( ) 
 self . alertTextView . editable = false 
 - self . alertTextView . text = " By signing up to \ ( ActorSDK . sharedActor ( ) . appNameInLocStrings ) , you agree not to : \ n \ n - use our service to send spam and scam users . \ n " + " - use our service to send spam and scam users . \ n " + " - use our service to send spam and scam users . \ n " + " - promote violence on publicly viewable \ ( ActorSDK . sharedActor ( ) . appNameInLocStrings ) bots or channels . \ n \ n " + " We reserve the right to update these Terms of Service later . " 
 + self . alertTextView . text = AALocalized ( " AuthTerms " ) . replace ( " { app _ name } " , dest : ActorSDK . sharedActor ( ) . appNameInLocStrings ) 
 self . alertTextView . frame = CGRectMake ( 10 , 45 , 220 , 270 ) ; 
 self . alertView . addSubview ( self . alertTextView ) 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift 
 index 5046c3b . . b717cf4 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Location / AALocationPickerController . swift 
 @ @ - 17 , 7 + 17 , 7 @ @ public class AALocationPickerController : AAViewController , CLLocationManagerDele 
 override init ( ) { 
 super . init ( ) 
 
 - navigationItem . title = " Location " 
 + navigationItem . title = AALocalized ( " LocationTitle " ) 
 navigationItem . leftBarButtonItem = UIBarButtonItem ( title : AALocalized ( " NavigationCancel " ) , style : . Plain , target : self , action : " cancellDidTap " ) 
 
 updateAuthStatus ( CLLocationManager . authorizationStatus ( ) ) 
 diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java 
 index 44a5ab0 . . 9f706d9 100644 
 - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java 
 + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / entity / JsMessage . java 
 @ @ - 40 , 13 + 40 , 13 @ @ public class JsMessage extends JavaScriptObject { 
 
 @ Override 
 public JavaScriptObject buildOverlay ( Message prev , Message current , Message next ) { 
 - Date prevDate = prev ! = null ? new Date ( prev . getDate ( ) ) : null ; 
 + Date nextDate = next ! = null ? new Date ( next . getDate ( ) ) : null ; 
 Date currentDate = new Date ( current . getDate ( ) ) ; 
 
 boolean showDate ; 
 String dateDiv = null ; 
 - if ( prev ! = null ) { 
 - showDate = ! CalendarUtil . isSameDate ( prevDate , currentDate ) ; 
 + if ( next ! = null ) { 
 + showDate = ! CalendarUtil . isSameDate ( nextDate , currentDate ) ; 
 } else { 
 showDate = true ; 
 } 
 @ @ - 55 , 9 + 55 , 9 @ @ public class JsMessage extends JavaScriptObject { 
 } 
 
 boolean useCompact = false ; 
 - if ( prev ! = null & & ! showDate ) { 
 - if ( prev . getSenderId ( ) = = current . getSenderId ( ) ) { 
 - if ( prev . getDate ( ) - current . getDate ( ) < 10 * 60 * 1000 ) { 
 + if ( next ! = null & & ! showDate ) { 
 + if ( next . getSenderId ( ) = = current . getSenderId ( ) ) { 
 + if ( next . getDate ( ) - current . getDate ( ) < 10 * 60 * 1000 ) { 
 useCompact = true ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 index bd83c77 . . e8e50c4 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 @ @ - 100 , 7 + 100 , 6 @ @ public class StickersModule extends AbsModule { 
 
 vms . removeAll ( remove ) ; 
 } catch ( Exception e ) { 
 - e . printStackTrace ( ) ; 
 } 
 return vms ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java 
 index b77ac37 . . fdeca48 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / DialogsActor . java 
 @ @ - 298 , 9 + 298 , 15 @ @ public class DialogsActor extends ModuleActor { 
 switch ( peer . getPeerType ( ) ) { 
 case PRIVATE : 
 User u = getUser ( peer . getPeerId ( ) ) ; 
 + if ( u = = null ) { 
 + return null ; 
 + } 
 return new PeerDesc ( u . getName ( ) , u . getAvatar ( ) ) ; 
 case GROUP : 
 Group g = getGroup ( peer . getPeerId ( ) ) ; 
 + if ( g = = null ) { 
 + return null ; 
 + } 
 return new PeerDesc ( g . getTitle ( ) , g . getAvatar ( ) ) ; 
 default : 
 return null ; 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java 
 index 2350be1 . . b92cf4d 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / messages / GroupedDialogsActor . java 
 @ @ - 127 , 10 + 127 , 16 @ @ public class GroupedDialogsActor extends ModuleActor { 
 Avatar avatar ; 
 if ( p . getPeerType ( ) = = PeerType . GROUP ) { 
 Group group = getGroup ( p . getPeerId ( ) ) ; 
 + if ( group = = null ) { 
 + continue ; 
 + } 
 title = group . getTitle ( ) ; 
 avatar = group . getAvatar ( ) ; 
 } else if ( p . getPeerType ( ) = = PeerType . PRIVATE ) { 
 User user = getUser ( p . getPeerId ( ) ) ; 
 + if ( user = = null ) { 
 + continue ; 
 + } 
 title = user . getName ( ) ; 
 avatar = user . getAvatar ( ) ; 
 } else { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java 
 index 1afd14b . . 2b7a6cf 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / util / ActorTrace . java 
 @ @ - 47 , 6 + 47 , 7 @ @ public class ActorTrace implements TraceInterface { 
 @ Override 
 public void onActorDie ( ActorRef ref , Envelope envelope , Exception e ) { 
 Log . w ( TAG , " Die ( " + ref . getPath ( ) + " ) by " + envelope . getMessage ( ) ) ; 
 - Log . e ( TAG , e ) ; 
 + / / Log . e ( TAG , e ) ; 
 + e . printStackTrace ( ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java 
 index 1b5c03d . . 24eb586 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / mvvm / JsDisplayList . java 
 @ @ - 21 , 6 + 21 , 8 @ @ import im . actor . runtime . storage . ListEngineItem ; 
 public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & ListEngineItem > implements JsListEngineCallback < V > , 
 PlatformDisplayList < V > { 
 
 + private static final String TAG = " JsDisplayList " ; 
 + 
 private final JsListEngine < V > listEngine ; 
 private final JsEntityConverter < V , T > entityConverter ; 
 
 @ @ - 109 , 6 + 111 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li 
 if ( isOverlaysSupported ) { 
 markAsDirty ( i ) ; 
 jsOverlays . remove ( i ) ; 
 + isOverlayDirty . remove ( i ) ; 
 } 
 break ; 
 } 
 @ @ - 120 , 6 + 123 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li 
 jsValues . insert ( i , entityConverter . convert ( item ) ) ; 
 if ( isOverlaysSupported ) { 
 jsOverlays . insert ( i , null ) ; 
 + isOverlayDirty . add ( i , true ) ; 
 markAsDirty ( i ) ; 
 } 
 return ; 
 @ @ - 130 , 6 + 134 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li 
 jsValues . push ( entityConverter . convert ( item ) ) ; 
 if ( isOverlaysSupported ) { 
 jsOverlays . push ( null ) ; 
 + isOverlayDirty . add ( true ) ; 
 markAsDirty ( values . size ( ) - 1 ) ; 
 } 
 } 
 @ @ - 158 , 6 + 163 , 7 @ @ public class JsDisplayList < T extends JavaScriptObject , V extends BserObject & Li 
 if ( isOverlaysSupported ) { 
 markAsDirty ( i ) ; 
 jsOverlays . remove ( i ) ; 
 + isOverlayDirty . add ( true ) ; 
 } 
 break ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java 
 index 47b2fde . . fe4de7f 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / storage / JsListEngine . java 
 @ @ - 19 , 6 + 19 , 8 @ @ import im . actor . runtime . storage . ListEngineRecord ; 
 
 public class JsListEngine < T extends BserObject & ListEngineItem > implements ListEngine < T > { 
 
 + private static final String TAG = " JsListEngine " ; 
 + 
 private JsListStorage storage ; 
 private BserCreator < T > creator ; 
 private HashMap < Long , T > cache = new HashMap < Long , T > ( ) ; 
 @ @ - 40 , 6 + 42 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onItemAddedOrUpdated ( item ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( addOrUpdateItem ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 @ @ - 61 , 6 + 64 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onItemsAddedOrUpdated ( items ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( addOrUpdateItems ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 @ @ - 82 , 6 + 86 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onItemsReplaced ( items ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( replaceItems ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 @ @ - 96 , 6 + 101 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onItemRemoved ( key ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( removeItem ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 @ @ - 111 , 6 + 117 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onItemsRemoved ( keys ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( removeItems ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 @ @ - 124 , 6 + 131 , 7 @ @ public class JsListEngine < T extends BserObject & ListEngineItem > implements List 
 try { 
 callback . onClear ( ) ; 
 } catch ( Exception e ) { 
 + Log . d ( TAG , " Exception during update ( clear ) " ) ; 
 e . printStackTrace ( ) ; 
 } 
 } 
 diff - - git a / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala b / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala 
 index ddbd6ce . . a29c7ea 100644 
 - - - a / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala 
 + + + b / actor - server / actor - activation / src / main / scala / im / actor / server / activation / internal / InternalCodeActivation . scala 
 @ @ - 5 , 6 + 5 , 7 @ @ import java . time . { LocalDateTime , ZoneOffset } 
 
 import akka . actor . _ 
 import akka . pattern . ask 
 + import akka . pattern . pipe 
 import akka . stream . Materializer 
 import akka . util . Timeout 
 import im . actor . server . activation . Activation . { CallCode , Code , EmailCode , SmsCode } 
 @ @ - 112 , 8 + 113 , 7 @ @ class Activation ( repeatLimit : Duration , smsEngine : AuthSmsEngine , callEngine : Au 
 
 override def receive : Receive = { 
 case Send ( code ) ⇒ 
 - val replyTo = sender ( ) 
 - sendCode ( code ) foreach { resp ⇒ replyTo ! SendAck ( resp ) } 
 + ( sendCode ( code ) map SendAck ) pipeTo sender ( ) 
 case ForgetSentCode ( code ) ⇒ forgetSentCode ( code ) 
 } 
 
 @ @ - 131 , 7 + 131 , 10 @ @ class Activation ( repeatLimit : Duration , smsEngine : AuthSmsEngine , callEngine : Au 
 } ) map { _ ⇒ 
 forgetSentCodeAfterDelay ( code ) 
 \ / - ( ( ) ) 
 - } recover { case e ⇒ - \ / ( SendFailure ( " Unable to send code " ) ) } 
 + } recover { case e ⇒ 
 + log . error ( e , " Failed to send code : { } " , code ) 
 + - \ / ( SendFailure ( " Unable to send code " ) ) 
 + } 
 } else { 
 log . debug ( s " Ignoring send $ code " ) 
 Future . successful ( - \ / ( BadRequest ( " Try to request code later " ) ) ) 
 diff - - git a / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala b / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala 
 index 8c18852 . . 6002d1e 100644 
 - - - a / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala 
 + + + b / actor - server / actor - email / src / main / scala / im / actor / server / email / EmailSender . scala 
 @ @ - 1 , 5 + 1 , 6 @ @ 
 package im . actor . server . email 
 
 + import im . actor . config . ActorConfig 
 import org . apache . commons . mail . { DefaultAuthenticator , HtmlEmail } 
 
 import scala . concurrent . { ExecutionContext , Future } 
 @ @ - 30 , 8 + 31 , 11 @ @ final class DummyEmailSender extends EmailSender { 
 } 
 
 final class SmtpEmailSender ( config : EmailConfig ) ( implicit ec : ExecutionContext ) extends EmailSender { 
 + val timeout = ( ActorConfig . defaultTimeout . toMillis / 2 ) . toInt 
 override def send ( message : Message ) = Future { 
 val email = new HtmlEmail ( ) 
 + email . setSocketTimeout ( timeout ) 
 + email . setSocketConnectionTimeout ( timeout ) 
 email . setCharset ( " UTF - 8 " ) 
 email . setHostName ( config . host ) 
 email . setSmtpPort ( config . port ) 
 diff - - git a / actor - server / src / universal / conf / server . conf . example b / actor - server / src / universal / conf / server . conf . example 
 index ab14b65 . . fa52121 100644 
 - - - a / actor - server / src / universal / conf / server . conf . example 
 + + + b / actor - server / src / universal / conf / server . conf . example 
 @ @ - 71 , 7 + 71 , 7 @ @ services { 
 
 # PostgreSQL storage for data 
 # The only required service to start server 
 - # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / Database . md 
 + # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / configure - database . md 
 postgresql { 
 # Host of PostgreSQL instance 
 host : localhost 
 @ @ - 90 , 7 + 90 , 7 @ @ services { 
 # enabling file sharing in apps 
 aws { 
 # S3 Storage , used for file sharing 
 - # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / AWS . md 
 + # For more information see https : / / github . com / actorapp / actor - bootstrap / blob / master / docs / server / configure - s3 . md 
 s3 { 
 # S3 Api Key 
 access - key : < put _ your _ aws _ key _ here > 
 diff - - git a / actor - server / src / universal / conf / server . conf . example - minimal b / actor - server / src / universal / conf / server . conf . example - minimal 
 index 6e01530 . . 749dc3f 100644 
 - - - a / actor - server / src / universal / conf / server . conf . example - minimal 
 + + + b / actor - server / src / universal / conf / server . conf . example - minimal 
 @ @ - 16 , 19 + 16 , 6 @ @ services { 
 actor - activation { 
 auth - token : < token > 
 } 
 - 
 - aws { 
 - s3 { 
 - # S3 Api Key 
 - access - key : < YOUR AWS KEY ID > 
 - 
 - # S3 Api Secret 
 - secret - key : < YOUR AWS SECRET KEY > 
 - 
 - # File bucket 
 - default - bucket : < bucket for storing files > 
 - } 
 - } 
 } 
 
 secret : < put a long random string here >

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / android / build . gradle b / actor - sdk / sdk - core / core / android / build . gradle 
 index 56f94bc . . f864e0e 100644 
 - - - a / actor - sdk / sdk - core / core / android / build . gradle 
 + + + b / actor - sdk / sdk - core / core / android / build . gradle 
 @ @ - 26 , 11 + 26 , 11 @ @ android { 
 main { 
 java { 
 srcDirs = [ ' src / main / java ' , 
 - ' . . / main / src / main / java ' , 
 - ' . . / main / src / ext / java ' ] 
 + ' . . / shared / src / main / java ' , 
 + ' . . / shared / src / ext / java ' ] 
 } 
 resources { 
 - srcDirs = [ ' . . / main / src / main / resources ' ] 
 + srcDirs = [ ' . . / shared / src / main / resources ' ] 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / cocoa / build . gradle b / actor - sdk / sdk - core / core / cocoa / build . gradle 
 index 8a861ed . . 111e8b1 100644 
 - - - a / actor - sdk / sdk - core / core / cocoa / build . gradle 
 + + + b / actor - sdk / sdk - core / core / cocoa / build . gradle 
 @ @ - 9 , 47 + 9 , 11 @ @ sourceSets { 
 main { 
 java { 
 srcDirs = [ ' src / main / java ' , 
 - ' . . / main / src / main / java ' ] 
 + ' . . / shared / src / main / java ' ] 
 } 
 } 
 } 
 
 dependencies { 
 compile project ( ' : runtime : cocoa ' ) 
 - } 
 - 
 - task cycleFinder ( ) { 
 - doFirst { 
 - 
 - Properties properties = new Properties ( ) 
 - properties . load ( project . rootProject . file ( ' local . properties ' ) . newDataInputStream ( ) ) 
 - 
 - delete " $ { projectDir } / src / gen / objc / " 
 - 
 - exec { 
 - 
 - executable " $ { properties . get ( " j2objcDir " ) } / cycle _ finder " 
 - 
 - def srcFiles = fileTree ( " $ { projectDir } / src / main / java / " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - 
 - srcFiles = fileTree ( " $ { projectDir } / . . / core / src / ext / java / " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - 
 - srcFiles = fileTree ( " $ { projectDir } / . . / core / src / main / java / " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - } 
 - } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / js / build . gradle b / actor - sdk / sdk - core / core / js / build . gradle 
 index 7c2bfbd . . 65707fe 100644 
 - - - a / actor - sdk / sdk - core / core / js / build . gradle 
 + + + b / actor - sdk / sdk - core / core / js / build . gradle 
 @ @ - 27 , 10 + 27 , 10 @ @ gwt { 
 sourceSets { 
 main { 
 java { 
 - srcDirs = [ ' src / main / java ' , ' . . / main / src / main / java ' , ' . . / main / src / ext / java ' , ' . . / . . / runtime / main / src / main / java ' , ' . . / . . / runtime / js / src / main / java ' ] 
 + srcDirs = [ ' src / main / java ' , ' . . / shared / src / main / java ' , ' . . / shared / src / ext / java ' , ' . . / . . / runtime / shared / src / main / java ' , ' . . / . . / runtime / js / src / main / java ' ] 
 } 
 resources { 
 - srcDirs = [ ' . . / main / src / main / resources ' ] 
 + srcDirs = [ ' . . / shared / src / main / resources ' ] 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / core / shared / build . gradle b / actor - sdk / sdk - core / core / shared / build . gradle 
 index 2f221bd . . 452c982 100644 
 - - - a / actor - sdk / sdk - core / core / shared / build . gradle 
 + + + b / actor - sdk / sdk - core / core / shared / build . gradle 
 @ @ - 9 , 9 + 9 , 8 @ @ sourceSets { 
 main { 
 java { 
 srcDirs = [ ' src / main / java ' , 
 - ' src / ext / java ' , 
 - ' . . / . . / runtime / main / src / main / java ' , 
 - ' . . / . . / runtime / main / src / template / java ' ] 
 + ' . . / . . / runtime / shared / src / main / java ' , 
 + ' . . / . . / runtime / shared / src / template / java ' ] 
 } 
 resources { 
 srcDir ' src / main / resources ' 
 diff - - git a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java b / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java 
 deleted file mode 100644 
 index 8e2aa9f . . 0000000 
 - - - a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / ExampleExtension . java 
 + + + / dev / null 
 @ @ - 1 , 59 + 0 , 0 @ @ 
 - package im . actor . core ; 
 - 
 - import im . actor . core . modules . ModuleContext ; 
 - import im . actor . runtime . util . ClassCreator ; 
 - 
 - class ExampleExtension implements Extension { 
 - 
 - / * * 
 - * Define public extension key for easier accessing 
 - * to extensions from other ones or outside of core 
 - * / 
 - public static final String KEY = " example " ; 
 - 
 - / * * 
 - * For registering extension implement creator and add it to Extensions class 
 - * / 
 - public static ClassCreator < ExampleExtension > CREATOR = new ClassCreator < ExampleExtension > ( ) { 
 - @ Override 
 - public ExampleExtension newInstance ( ) { 
 - return new ExampleExtension ( ) ; 
 - } 
 - } ; 
 - 
 - / * * 
 - * Keep reference to context 
 - * / 
 - private ModuleContext context ; 
 - 
 - / * * 
 - * Get unique extension key 
 - * 
 - * @ return extension key 
 - * / 
 - @ Override 
 - public String getExtensionKey ( ) { 
 - return KEY ; 
 - } 
 - 
 - / * * 
 - * Performing registration of extension before Messenger run 
 - * 
 - * @ param context Module context 
 - * / 
 - @ Override 
 - public void registerExtension ( ModuleContext context ) { 
 - this . context = context ; 
 - 
 - / / TODO : Register extension . For example register new content types or update handlers 
 - } 
 - 
 - / * * 
 - * Running extension 
 - * / 
 - @ Override 
 - public void runExtension ( ) { 
 - 
 - / / TODO : Start extension actors 
 - } 
 - } 
 diff - - git a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java b / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java 
 deleted file mode 100644 
 index 5a2d3a9 . . 0000000 
 - - - a / actor - sdk / sdk - core / core / shared / src / ext / java / im / actor / core / Extensions . java 
 + + + / dev / null 
 @ @ - 1 , 75 + 0 , 0 @ @ 
 - package im . actor . core ; 
 - 
 - import java . util . HashMap ; 
 - 
 - import im . actor . core . modules . ModuleContext ; 
 - import im . actor . runtime . util . ClassCreator ; 
 - 
 - / * * 
 - * Extensions index 
 - * / 
 - public class Extensions { 
 - 
 - / / Add here Your extensions 
 - private static final ClassCreator < Extension > [ ] APP _ EXTENSIONS = new ClassCreator [ ] { 
 - ExampleExtension . CREATOR 
 - } ; 
 - 
 - / * * 
 - * Context for extensions 
 - * / 
 - private ModuleContext context ; 
 - 
 - / * * 
 - * Created extensions 
 - * / 
 - private Extension [ ] extensions ; 
 - 
 - / * * 
 - * Map of extension from key to extension 
 - * / 
 - private HashMap < String , Extension > extensionsMap ; 
 - 
 - / * * 
 - * Create extensions module 
 - * 
 - * @ param context module context 
 - * / 
 - public Extensions ( ModuleContext context ) { 
 - this . context = context ; 
 - } 
 - 
 - / * * 
 - * Creating and registering extensions 
 - * / 
 - public void registerExtensions ( ) { 
 - extensionsMap = new HashMap < String , Extension > ( ) ; 
 - extensions = new Extension [ APP _ EXTENSIONS . length ] ; 
 - for ( int i = 0 ; i < extensions . length ; i + + ) { 
 - extensions [ i ] = APP _ EXTENSIONS [ i ] . newInstance ( ) ; 
 - extensionsMap . put ( extensions [ i ] . getExtensionKey ( ) , extensions [ i ] ) ; 
 - } 
 - for ( int i = 0 ; i < extensions . length ; i + + ) { 
 - extensions [ i ] . registerExtension ( context ) ; 
 - } 
 - } 
 - 
 - / * * 
 - * Running extensions 
 - * / 
 - public void runExtensions ( ) { 
 - for ( int i = 0 ; i < extensions . length ; i + + ) { 
 - extensions [ i ] . runExtension ( ) ; 
 - } 
 - } 
 - 
 - / * * 
 - * Finding extension 
 - * 
 - * @ param key key of extension 
 - * @ return founded extension , null if not found 
 - * / 
 - public Extension findExtension ( String key ) { 
 - return extensionsMap . get ( key ) ; 
 - } 
 - } 
 diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java 
 index efa24da . . 77b90cc 100644 
 - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 1648 , 17 + 1648 , 6 @ @ public class Messenger { 
 } 
 
 / * * 
 - * Find core extension by key 
 - * 
 - * @ param key extension key 
 - * @ return founded extension , null if not found 
 - * / 
 - @ ObjectiveCName ( " findExtension : " ) 
 - public Extension findExtension ( String key ) { 
 - return modules . findExtension ( key ) ; 
 - } 
 - 
 - / * * 
 * Get modules of messenger for extensions 
 * 
 * @ return Module Contexts 
 diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 index cb391f6 . . 36a6d73 100644 
 - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 @ @ - 83 , 6 + 83 , 4 @ @ public interface ModuleContext { 
 Messenger getMessenger ( ) ; 
 
 MentionsModule getMentions ( ) ; 
 - 
 - Extension findExtension ( String key ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java 
 index 4e1aab8 . . a82d6b9 100644 
 - - - a / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java 
 + + + b / actor - sdk / sdk - core / core / shared / src / main / java / im / actor / core / modules / Modules . java 
 @ @ - 6 , 7 + 6 , 6 @ @ package im . actor . core . modules ; 
 
 import im . actor . core . Configuration ; 
 import im . actor . core . Extension ; 
 - import im . actor . core . Extensions ; 
 import im . actor . core . Messenger ; 
 import im . actor . core . i18n . I18nEngine ; 
 import im . actor . core . modules . internal . AppStateModule ; 
 @ @ - 68 , 7 + 67 , 6 @ @ public class Modules implements ModuleContext { 
 private volatile SecurityModule security ; 
 private volatile DisplayLists displayLists ; 
 private volatile MentionsModule mentions ; 
 - private volatile Extensions extensions ; 
 
 public Modules ( Messenger messenger , Configuration configuration ) { 
 this . messenger = messenger ; 
 @ @ - 135 , 9 + 133 , 6 @ @ public class Modules implements ModuleContext { 
 mentions = new MentionsModule ( this ) ; 
 timing . section ( " DisplayLists " ) ; 
 displayLists = new DisplayLists ( this ) ; 
 - timing . section ( " Extension " ) ; 
 - extensions = new Extensions ( this ) ; 
 - extensions . registerExtensions ( ) ; 
 timing . end ( ) ; 
 
 
 @ @ - 158 , 8 + 153 , 6 @ @ public class Modules implements ModuleContext { 
 messages . run ( ) ; 
 timing . section ( " Updates " ) ; 
 updates . run ( ) ; 
 - timing . section ( " Extension " ) ; 
 - extensions . runExtensions ( ) ; 
 timing . end ( ) ; 
 
 messenger . onLoggedIn ( ) ; 
 @ @ - 278 , 11 + 271 , 6 @ @ public class Modules implements ModuleContext { 
 return mentions ; 
 } 
 
 - @ Override 
 - public Extension findExtension ( String key ) { 
 - return extensions . findExtension ( key ) ; 
 - } 
 - 
 public EventBus getEvents ( ) { 
 return events ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / android / build . gradle b / actor - sdk / sdk - core / runtime / android / build . gradle 
 index 2720e20 . . 198af14 100644 
 - - - a / actor - sdk / sdk - core / runtime / android / build . gradle 
 + + + b / actor - sdk / sdk - core / runtime / android / build . gradle 
 @ @ - 25 , 8 + 25 , 8 @ @ android { 
 main { 
 java { 
 srcDirs = [ ' src / main / java ' , 
 - ' . . / main / src / main / java ' , 
 - ' . . / main / src / generic / java ' ] 
 + ' . . / shared / src / main / java ' , 
 + ' . . / shared / src / generic / java ' ] 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / cocoa / build . gradle b / actor - sdk / sdk - core / runtime / cocoa / build . gradle 
 index b515a8d . . 1296a11 100644 
 - - - a / actor - sdk / sdk - core / runtime / cocoa / build . gradle 
 + + + b / actor - sdk / sdk - core / runtime / cocoa / build . gradle 
 @ @ - 9 , 46 + 9 , 8 @ @ sourceSets { 
 main { 
 java { 
 srcDirs = [ ' src / main / java ' , 
 - ' . . / main / src / main / java ' , 
 - ' . . / main / src / generic / java ' ] 
 + ' . . / shared / src / main / java ' , 
 + ' . . / shared / src / generic / java ' ] 
 } 
 } 
 - } 
 - 
 - task cycleFinder ( ) { 
 - 
 - doFirst { 
 - 
 - Properties properties = new Properties ( ) 
 - properties . load ( project . rootProject . file ( ' local . properties ' ) . newDataInputStream ( ) ) 
 - 
 - exec { 
 - 
 - executable " $ { properties . get ( " j2objcDir " ) } / cycle _ finder " 
 - 
 - def srcFiles = fileTree ( " $ { projectDir } / src / main / java / " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - 
 - srcFiles = fileTree ( " $ { projectDir } / . . / runtime / src / main / java / " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - 
 - srcFiles = fileTree ( " $ { projectDir } / . . / runtime / src / generic / java " ) . matching { 
 - exclude " * * / ObjectiveCName . java " 
 - } 
 - srcFiles . each { file - > 
 - args file . path 
 - } 
 - } 
 - } 
 - } 
 - 
 - cycleFinder . dependsOn compileJava 
 - build . dependsOn cycleFinder 
 \ No newline at end of file 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / runtime / js / build . gradle b / actor - sdk / sdk - core / runtime / js / build . gradle 
 index 27c8350 . . 4dca44c 100644 
 - - - a / actor - sdk / sdk - core / runtime / js / build . gradle 
 + + + b / actor - sdk / sdk - core / runtime / js / build . gradle 
 @ @ - 26 , 7 + 26 , 7 @ @ gwt { 
 sourceSets { 
 main { 
 java { 
 - srcDirs = [ ' src / main / java ' , ' . . / main / src / main / java ' ] 
 + srcDirs = [ ' src / main / java ' , ' . . / shared / src / main / java ' ] 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java 
 index 8a3b34b . . 1003f2e 100644 
 - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / JsCryptoProvider . java 
 @ @ - 5 , 14 + 5 , 8 @ @ 
 package im . actor . runtime . js ; 
 
 
 - import im . actor . runtime . crypto . CryptoKeyPair ; 
 import im . actor . runtime . crypto . bouncycastle . BouncyCastleRuntime ; 
 - import im . actor . runtime . js . crypto . Rsa ; 
 
 public class JsCryptoProvider extends BouncyCastleRuntime { 
 
 - @ Override 
 - public CryptoKeyPair generateRSA1024KeyPair ( ) { 
 - return Rsa . generate1024RsaKey ( ) ; 
 - } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java 
 deleted file mode 100644 
 index 11cb173 . . 0000000 
 - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / Rsa . java 
 + + + / dev / null 
 @ @ - 1 , 22 + 0 , 0 @ @ 
 - / * 
 - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 - * / 
 - 
 - package im . actor . runtime . js . crypto ; 
 - 
 - import im . actor . runtime . crypto . Base64Utils ; 
 - import im . actor . runtime . crypto . CryptoKeyPair ; 
 - 
 - public class Rsa { 
 - 
 - public static CryptoKeyPair generate1024RsaKey ( ) { 
 - RsaKey rsaKey = generate1024RsaKeyJs ( ) ; 
 - return new CryptoKeyPair ( Base64Utils . fromBase64 ( rsaKey . getPublicKey ( ) ) , 
 - Base64Utils . fromBase64 ( rsaKey . getPrivateKey ( ) ) ) ; 
 - } 
 - 
 - private static native RsaKey generate1024RsaKeyJs ( ) / * - { 
 - var crypt = new $ wnd . JSEncrypt ( { default _ key _ size : 1024 } ) ; 
 - return { publicKey : crypt . getKey ( ) . getPublicBaseKeyB64 ( ) , privateKey : crypt . getKey ( ) . getPrivateBaseKeyB64 ( ) } ; 
 - } - * / ; 
 - } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java b / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java 
 deleted file mode 100644 
 index 9773fa4 . . 0000000 
 - - - a / actor - sdk / sdk - core / runtime / js / src / main / java / im / actor / runtime / js / crypto / RsaKey . java 
 + + + / dev / null 
 @ @ - 1 , 17 + 0 , 0 @ @ 
 - / * 
 - * Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 - * / 
 - 
 - package im . actor . runtime . js . crypto ; 
 - 
 - import com . google . gwt . core . client . JavaScriptObject ; 
 - 
 - public class RsaKey extends JavaScriptObject { 
 - protected RsaKey ( ) { 
 - 
 - } 
 - 
 - public final native String getPrivateKey ( ) / * - { return this . privateKey ; } - * / ; 
 - 
 - public final native String getPublicKey ( ) / * - { return this . publicKey ; } - * / ; 
 - } 
 diff - - git a / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar b / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar 
 new file mode 100644 
 index 0000000 . . 5470617 
 Binary files / dev / null and b / actor - sdk / sdk - core / runtime / js / war / WEB - INF / lib / gwt - servlet - 2 . 7 . 0 . jar differ 
 diff - - git a / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java b / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java 
 index 97b9ead . . f5b9643 100644 
 - - - a / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / shared / src / template / java / im / actor / runtime / CryptoRuntimeProvider . java 
 @ @ - 1 , 33 + 1 , 6 @ @ 
 package im . actor . runtime ; 
 
 - import im . actor . runtime . crypto . AesCipher ; 
 - import im . actor . runtime . crypto . CryptoKeyPair ; 
 - import im . actor . runtime . crypto . RsaCipher ; 
 - import im . actor . runtime . crypto . RsaEncryptCipher ; 
 - 
 - / * * 
 - * Created by ex3ndr on 07 . 08 . 15 . 
 - * / 
 public class CryptoRuntimeProvider implements CryptoRuntime { 
 - @ Override 
 - public CryptoKeyPair generateRSA1024KeyPair ( ) { 
 - throw new RuntimeException ( " Dumb " ) ; 
 - } 
 - 
 - @ Override 
 - public RsaEncryptCipher createRSAOAEPSHA1Cipher ( byte [ ] publicKey ) { 
 - throw new RuntimeException ( " Dumb " ) ; 
 - } 
 - 
 - @ Override 
 - public RsaCipher createRSAOAEPSHA1Cipher ( byte [ ] publicKey , byte [ ] privateKey ) { 
 - throw new RuntimeException ( " Dumb " ) ; 
 - } 
 - 
 - @ Override 
 - public AesCipher createAESCBCPKS7Cipher ( byte [ ] key , byte [ ] iv ) { 
 - throw new RuntimeException ( " Dumb " ) ; 
 - } 
 
 @ Override 
 public byte [ ] MD5 ( byte [ ] data ) {
