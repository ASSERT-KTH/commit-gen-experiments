BLEU SCORE: 0.345720784641941

TEST MSG: perf ( iOS ) : Various performance optimizations
GENERATED MSG: fix ( iOS ) : Fixing iPad compatibility

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > index 5769ee8 . . 8dda34f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > @ @ - 22 , 5 + 22 , 6 @ @ class AAActorRuntime { < nl > ARCocoaWebRTCProxyProvider . setWebRTCRuntime ( CocoaWebRTCRuntime ( ) ) < nl > ARCocoaLifecycleProxyProvider . setLifecycleRuntime ( CocoaLifecycleRuntime ( ) ) < nl > ARCocoaDispatcher . setDispatcherProxy ( CocoaDispatcher ( ) ) < nl > + ARRuntimeEnvironment . setIsProductionWithBoolean ( true ) < nl > } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift < nl > index 24a10a6 . . daaa1cf 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift < nl > @ @ - 4 , 16 + 4 , 12 @ @ < nl > < nl > import Foundation < nl > < nl > + private let documentsFolder = NSSearchPathForDirectoriesInDomains ( NSSearchPathDirectory . DocumentDirectory , NSSearchPathDomainMask . UserDomainMask , true ) [ 0 ] . asNS . stringByDeletingLastPathComponent < nl > + < nl > / / Public methods for working with files < nl > class CocoaFiles { < nl > class func pathFromDescriptor ( path : String ) - > String { < nl > - var documentsFolders = NSSearchPathForDirectoriesInDomains ( NSSearchPathDirectory . DocumentDirectory , NSSearchPathDomainMask . UserDomainMask , true ) < nl > - if ( documentsFolders . count > 0 ) { < nl > - let appPath = documentsFolders [ 0 ] . asNS . stringByDeletingLastPathComponent < nl > - return appPath + path < nl > - } else { < nl > - fatalError ( " Unable to load Application path " ) < nl > - } < nl > + return documentsFolder + path < nl > } < nl > } < nl > < nl > @ @ - 141 , 15 + 137 , 18 @ @ class CocoaOutputFile : NSObject , AROutputFile { < nl > srcBuffer + + ; < nl > } < nl > < nl > + NSLog ( " Write to file \ ( fileOffset ) " ) < nl > fileHandle . seekToFileOffset ( UInt64 ( fileOffset ) ) ; < nl > fileHandle . writeData ( toWrite ) < nl > - < nl > + NSLog ( " Write to file \ ( fileOffset ) : end " ) < nl > return true ; < nl > } < nl > < nl > func close ( ) - > Bool { < nl > + NSLog ( " Close file " ) < nl > self . fileHandle . synchronizeFile ( ) < nl > self . fileHandle . closeFile ( ) < nl > + NSLog ( " Close file end " ) < nl > return true ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift < nl > index e257212 . . 2ddc4a4 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift < nl > @ @ - 24 , 7 + 24 , 7 @ @ class CocoaTcpConnectionFactory : NSObject , ARAsyncConnectionFactory { < nl > < nl > class CocoaTcpConnection : ARAsyncConnection , GCDAsyncSocketDelegate { < nl > < nl > - static let queue = dispatch _ queue _ create ( " im . actor . queue . TCP " , nil ) ; < nl > + static let queue = YYDispatchQueueGetForQOS ( NSQualityOfService . Background ) < nl > < nl > let READ _ HEADER = 1 < nl > let READ _ BODY = 2 < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > index 592ffc8 . . c852ff6 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > @ @ - 201 , 6 + 201 , 7 @ @ import DZNWebViewController < nl > builder . setPhoneBookImportEnabled ( jboolean ( enablePhoneBookImport ) ) < nl > builder . setVoiceCallsEnabled ( jboolean ( enableCalls ) ) < nl > builder . setIsEnabledGroupedChatList ( false ) < nl > + builder . setEnableFilesLogging ( true ) < nl > < nl > / / Creating messenger < nl > messenger = ACCocoaMessenger ( configuration : builder . build ( ) ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift < nl > index bb3e77a . . 78a2ae3 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift 	 < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift 	 < nl > @ @ - 72 , 13 + 72 , 14 @ @ public class AADialogCell : AATableViewCell , AABindedCell { < nl > dateView . fadeOnAsynchronouslyDisplay = false < nl > dateView . clearContentsBeforeAsynchronouslyDisplay = false < nl > < nl > - statusView . contentMode = . Center < nl > + counterView . displaysAsynchronously = true < nl > + counterView . ignoreCommonProperties = true < nl > + counterView . fadeOnAsynchronouslyDisplay = false < nl > + counterView . clearContentsBeforeAsynchronouslyDisplay = false < nl > < nl > counterViewBg . image = AADialogCell . counterBgImage < nl > < nl > - counterView . font = UIFont . systemFontOfSize ( 14 ) < nl > - counterView . textColor = appStyle . dialogCounterColor < nl > - counterView . textAlignment = . Center < nl > + statusView . contentMode = . Center < nl > < nl > self . contentView . addSubview ( avatarView ) < nl > self . contentView . addSubview ( titleView ) < nl > @ @ - 118 , 12 + 119 , 10 @ @ public class AADialogCell : AATableViewCell , AABindedCell { < nl > if ! titleView . displaysAsynchronously { < nl > titleView . displaysAsynchronously = true < nl > } < nl > + < nl > if ! messageView . displaysAsynchronously { < nl > messageView . displaysAsynchronously = true < nl > } < nl > - if ! dateView . displaysAsynchronously { < nl > - dateView . displaysAsynchronously = true < nl > - } < nl > < nl > < nl > / / Reseting Text Layout on new peer binding < nl > @ @ - 143 , 26 + 142 , 6 @ @ public class AADialogCell : AATableViewCell , AABindedCell { < nl > self . counterViewBg . hidden = true < nl > } < nl > < nl > - < nl > - / / / / < nl > - / / / / Counter View < nl > - / / / / < nl > - / / if ( item . unreadCount ! = 0 ) { < nl > - / / self . counterView . text = " \ ( item . unreadCount ) " < nl > - / / if counterView . hidden { < nl > - / / setNeedsLayout ( ) < nl > - / / } < nl > - / / self . counterView . hidden = false < nl > - / / self . counterViewBg . hidden = false < nl > - / / } else { < nl > - / / if ! counterView . hidden { < nl > - / / setNeedsLayout ( ) < nl > - / / } < nl > - / / self . counterView . hidden = true < nl > - / / self . counterViewBg . hidden = true < nl > - / / } < nl > - < nl > - < nl > / / < nl > / / Message State < nl > / / < nl > @ @ - 248 , 8 + 227 , 6 @ @ public class AADialogCell : AATableViewCell , AABindedCell { < nl > titleView . clearContentsBeforeAsynchronouslyDisplay = false < nl > messageView . displaysAsynchronously = false < nl > messageView . clearContentsBeforeAsynchronouslyDisplay = false < nl > - dateView . displaysAsynchronously = false < nl > - dateView . clearContentsBeforeAsynchronouslyDisplay = false < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m < nl > index d2e86cc . . b5cf857 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m < nl > @ @ - 977 , 6 + 977 , 14 @ @ static dispatch _ queue _ t YYLabelGetReleaseQueue ( ) { < nl > } < nl > < nl > - ( void ) setTextLayout : ( YYTextLayout * ) textLayout { < nl > + < nl > + if ( _ innerLayout ! = nil ) { < nl > + YYTextLayout * oldLayout = _ innerLayout ; < nl > + dispatch _ async ( YYLabelGetReleaseQueue ( ) , ^ { < nl > + YYTextLayout * released = oldLayout ; < nl > + } ) ; < nl > + } < nl > + < nl > _ innerLayout = textLayout ; < nl > _ shrinkInnerLayout = nil ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift < nl > index 91bc00d . . 9e6128a 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift < nl > @ @ - 23 , 7 + 23 , 15 @ @ public class AABackgroundCellRenderer < P , T where T : AnyObject , P : AnyObject , P : < nl > if requestedConfig = = config { < nl > return false < nl > } < nl > - let wasConfig = requestedConfig ! = nil < nl > + let oldConfig = requestedConfig < nl > + let wasConfig = oldConfig ! = nil < nl > + < nl > + / / Releasing in background < nl > + if wasConfig { < nl > + dispatchBackground { < nl > + let _ = oldConfig < nl > + } < nl > + } < nl > < nl > if wasPresented { < nl > / / Do Sync rendering when is just resized < nl > @ @ - 66 , 7 + 74 , 15 @ @ public class AABackgroundCellRenderer < P , T where T : AnyObject , P : AnyObject , P : < nl > < nl > func cancelRender ( wasPresented : Bool = false ) { < nl > generation + + < nl > + let oldConfig = requestedConfig < nl > requestedConfig = nil < nl > + < nl > + / / Releasing in background < nl > + if oldConfig ! = nil { < nl > + dispatchBackground { < nl > + let _ = oldConfig < nl > + } < nl > + } < nl > self . wasPresented = wasPresented < nl > } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java < nl > index 4845b47 . . 678084a 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java < nl > @ @ - 54 , 8 + 54 , 8 @ @ public class DownloadManager extends ModuleActor { < nl > if ( downloaded1 ! = null ) { < nl > / / FileSystemProvider provider = modules ( ) . getConfiguration ( ) . getFileSystemProvider ( ) ; < nl > FileSystemReference reference = Storage . fileFromDescriptor ( downloaded1 . getDescriptor ( ) ) ; < nl > - boolean isExist = reference . isExist ( ) ; < nl > - int fileSize = reference . getSize ( ) ; < nl > + boolean isExist = true ; / / reference . isExist ( ) ; < nl > + int fileSize = downloaded1 . getFileSize ( ) ; / / reference . getSize ( ) ; < nl > if ( isExist & & fileSize = = downloaded1 . getFileSize ( ) ) { < nl > if ( LOG ) { < nl > Log . d ( TAG , " - Downloaded " ) ; < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java < nl > index 7e624bd . . 697691c 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java < nl > @ @ - 61 , 6 + 61 , 10 @ @ public class Runtime { < nl > } < nl > < nl > public static void checkMainThread ( ) { < nl > + if ( RuntimeEnvironment . isProduction ( ) ) { < nl > + / / Do Nothing in production mode < nl > + return ; < nl > + } < nl > if ( mainThreadRuntime . isSingleThread ( ) ) { < nl > return ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java < nl > new file mode 100644 < nl > index 0000000 . . d9e3f53 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java < nl > @ @ - 0 , 0 + 1 , 14 @ @ < nl > + package im . actor . runtime ; < nl > + < nl > + public abstract class RuntimeEnvironment { < nl > + < nl > + private static boolean isProduction ; < nl > + < nl > + public static boolean isProduction ( ) { < nl > + return isProduction ; < nl > + } < nl > + < nl > + public static void setIsProduction ( boolean isProduction ) { < nl > + RuntimeEnvironment . isProduction = isProduction ; < nl > + } < nl > + }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > index 6ef6244 . . 3f4c2da 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > @ @ - 426 , 7 + 426 , 7 @ @ < nl > 	 	 	 	 	 " - framework " , < nl > 	 	 	 	 	 " \ " WebKit \ " " , < nl > 	 	 	 	 ) ; < nl > - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk ; < nl > + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; < nl > 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; < nl > 	 	 	 	 PROVISIONING _ PROFILE = " " ; < nl > 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; < nl > @ @ - 544 , 7 + 544 , 7 @ @ < nl > 	 	 	 	 	 " - framework " , < nl > 	 	 	 	 	 " \ " WebKit \ " " , < nl > 	 	 	 	 ) ; < nl > - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk ; < nl > + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; < nl > 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; < nl > 	 	 	 	 PROVISIONING _ PROFILE = " " ; < nl > 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift < nl > index af58779 . . ad4af58 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift < nl > @ @ - 36 , 7 + 36 , 7 @ @ public class AAComposeController : AAContactsListContentController , AAContactsLis < nl > } < nl > < nl > public func contactDidTap ( controller : AAContactsListContentController , contact : ACContact ) - > Bool { < nl > - navigateNext ( ConversationViewController ( peer : ACPeer . userWithInt ( contact . uid ) ) , removeCurrent : true ) < nl > + navigateDetail ( ConversationViewController ( peer : ACPeer . userWithInt ( contact . uid ) ) ) < nl > return false < nl > } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift < nl > index dc0852f . . b51d791 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift < nl > @ @ - 92 , 14 + 92 , 12 @ @ public class AAGroupCreateViewController : AAViewController , UITextFieldDelegate < nl > public override func viewDidLayoutSubviews ( ) { < nl > super . viewDidLayoutSubviews ( ) < nl > < nl > - let screenSize = UIScreen . mainScreen ( ) . bounds . size < nl > - < nl > avatarImageView . frame = CGRectMake ( 20 , 20 + 66 , 80 , 80 ) < nl > addPhotoButton . frame = avatarImageView . frame < nl > - hint . frame = CGRectMake ( 120 , 20 + 66 , screenSize . width - 140 , 80 ) < nl > + hint . frame = CGRectMake ( 120 , 20 + 66 , view . width - 140 , 80 ) < nl > < nl > - groupName . frame = CGRectMake ( 20 , 106 + 66 , screenSize . width - 20 , 56 . 0 ) < nl > - groupNameFieldSeparator . frame = CGRectMake ( 20 , 156 + 66 , screenSize . width - 20 , 0 . 5 ) < nl > + groupName . frame = CGRectMake ( 20 , 106 + 66 , view . width - 20 , 56 . 0 ) < nl > + groupNameFieldSeparator . frame = CGRectMake ( 20 , 156 + 66 , view . width - 20 , 0 . 5 ) < nl > } < nl > < nl > public func photoTap ( ) { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift < nl > index 0828011 . . 1b87a4f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift < nl > @ @ - 81 , 7 + 81 , 7 @ @ public class GroupMembersController : AAContactsListContentController , AAContacts < nl > if self . groupImage ! = nil { < nl > Actor . changeGroupAvatar ( gid , image : self . groupImage ! ) < nl > } < nl > - self . navigateNext ( ConversationViewController ( peer : ACPeer . groupWithInt ( gid ) ) , removeCurrent : true ) < nl > + self . navigateDetail ( ConversationViewController ( peer : ACPeer . groupWithInt ( gid ) ) ) < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift < nl > index 6832daf . . 273f87f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift < nl > @ @ - 56 , 7 + 56 , 7 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC < nl > < nl > r . selectAction = { ( ) - > Bool in < nl > self . findContact ( ) < nl > - return false < nl > + return AADevice . isiPad < nl > } < nl > } < nl > < nl > @ @ - 116 , 7 + 116 , 9 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC < nl > } < nl > } < nl > < nl > - self . showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : UIView ( ) , sourceRect : CGRectZero , tapClosure : builder . tapClosure ) < nl > + let view = self . tableView . cellForRowAtIndexPath ( NSIndexPath ( forRow : 1 , inSection : 0 ) ) ! . contentView < nl > + < nl > + self . showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : view , sourceRect : view . bounds , tapClosure : builder . tapClosure ) < nl > < nl > return true < nl > } < nl > @ @ - 156 , 10 + 158 , 10 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC < nl > < nl > if user ! = nil { < nl > c . execute ( Actor . addContactCommandWithUid ( user ! . getId ( ) ) , successBlock : { ( val ) - > Void in < nl > - self . navigateNext ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) < nl > + self . navigateDetail ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) < nl > c . dismiss ( ) < nl > } , failureBlock : { ( val ) - > Void in < nl > - self . navigateNext ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) < nl > + self . navigateDetail ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) < nl > c . dismiss ( ) < nl > } ) < nl > } else { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift < nl > index da5a968 . . e33d2af 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift < nl > @ @ - 341 , 11 + 341 , 12 @ @ public class AAConversationContentController : SLKTextViewController , ARDisplayLi < nl > } < nl > } < nl > < nl > - public override func willRotateToInterfaceOrientation ( toInterfaceOrientation : UIInterfaceOrientation , duration : NSTimeInterval ) { < nl > - super . willRotateToInterfaceOrientation ( toInterfaceOrientation , duration : duration ) < nl > + public override func viewWillTransitionToSize ( size : CGSize , withTransitionCoordinator coordinator : UIViewControllerTransitionCoordinator ) { < nl > + super . viewWillTransitionToSize ( size , withTransitionCoordinator : coordinator ) < nl > < nl > dispatch _ async ( dispatch _ get _ main _ queue ( ) , { ( ) - > Void in < nl > - self . collectionView . collectionViewLayout . invalidateLayout ( ) < nl > + / / self . collectionView . collectionViewLayout . invalidateLayout ( ) < nl > + self . collectionView . performBatchUpdates ( nil , completion : nil ) < nl > } ) < nl > } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift < nl > index 5a07bf3 . . f846338 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift < nl > @ @ - 57 , 6 + 57 , 9 @ @ class AANavigationBadge { < nl > } < nl > < nl > class func showBadge ( ) { < nl > + if ( AADevice . isiPad ) { < nl > + return < nl > + } < nl > start ( ) < nl > isBadgeVisible = true < nl > if badgeCount > 0 { < nl > @ @ - 65 , 6 + 68 , 9 @ @ class AANavigationBadge { < nl > } < nl > < nl > class func hideBadge ( ) { < nl > + if ( AADevice . isiPad ) { < nl > + return < nl > + } < nl > start ( ) < nl > isBadgeVisible = false < nl > self . badgeView . hideView ( ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift < nl > index 957bcc3 . . 8d47288 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift 	 < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift 	 < nl > @ @ - 131 , 6 + 131 , 12 @ @ public class AAManagedTableController : AAViewController { < nl > m . controllerViewDidDisappear ( animated ) < nl > } < nl > } < nl > + < nl > + public override func viewWillLayoutSubviews ( ) { < nl > + super . viewWillLayoutSubviews ( ) < nl > + < nl > + tableView . frame = view . bounds < nl > + } < nl > } < nl > < nl > public protocol AAManagedTableControllerDelegate { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift < nl > index 23ef765 . . d798a63 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift 	 < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift 	 < nl > @ @ - 121 , 14 + 121 , 22 @ @ public extension UIViewController { < nl > let config = AAEditTextControllerConfig ( ) < nl > closure ( config ) < nl > config . check ( ) < nl > - self . presentViewController ( AANavigationController ( rootViewController : AAEditTextController ( config : config ) ) , animated : true , completion : nil ) < nl > + let controller = AANavigationController ( rootViewController : AAEditTextController ( config : config ) ) < nl > + if ( AADevice . isiPad ) { < nl > + controller . modalPresentationStyle = . FormSheet < nl > + } < nl > + self . presentViewController ( controller , animated : true , completion : nil ) < nl > } < nl > < nl > func startEditField ( @ noescape closure : ( c : AAEditFieldControllerConfig ) - > ( ) ) { < nl > let config = AAEditFieldControllerConfig ( ) < nl > closure ( c : config ) < nl > config . check ( ) < nl > - self . presentViewController ( AANavigationController ( rootViewController : AAEditFieldController ( config : config ) ) , animated : true , completion : nil ) < nl > + let controller = AANavigationController ( rootViewController : AAEditFieldController ( config : config ) ) < nl > + if ( AADevice . isiPad ) { < nl > + controller . modalPresentationStyle = . FormSheet < nl > + } < nl > + self . presentViewController ( controller , animated : true , completion : nil ) < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > index f26c644 . . 1312413 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift < nl > @ @ - 88 , 11 + 88 , 12 @ @ public class AASettingsViewController : AAContentTableController { < nl > s . action ( " SettingsSetPhoto " ) { [ unowned self ] ( r ) - > ( ) in < nl > r . selectAction = { [ unowned self ] ( ) - > Bool in < nl > let hasCamera = UIImagePickerController . isSourceTypeAvailable ( UIImagePickerControllerSourceType . Camera ) < nl > + let view = self . tableView . cellForRowAtIndexPath ( NSIndexPath ( forRow : 1 , inSection : 0 ) ) ! . contentView < nl > self . showActionSheet ( hasCamera ? [ " PhotoCamera " , " PhotoLibrary " ] : [ " PhotoLibrary " ] , < nl > cancelButton : " AlertCancel " , < nl > destructButton : self . user . getAvatarModel ( ) . get ( ) ! = nil ? " PhotoRemove " : nil , < nl > - sourceView : self . view , < nl > - sourceRect : self . view . bounds , < nl > + sourceView : view , < nl > + sourceRect : view . bounds , < nl > tapClosure : { [ unowned self ] ( index ) - > ( ) in < nl > if index = = - 2 { < nl > self . confirmUser ( " PhotoRemoveGroupMessage " , < nl > @ @ - 217 , 7 + 218 , 7 @ @ public class AASettingsViewController : AAContentTableController { < nl > } < nl > } < nl > < nl > - return false < nl > + return AADevice . isiPad < nl > } < nl > } < nl > < nl > @ @ - 258 , 7 + 259 , 7 @ @ public class AASettingsViewController : AAContentTableController { < nl > } < nl > } < nl > < nl > - return false < nl > + return AADevice . isiPad < nl > } < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 index 5769ee8 . . 8dda34f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 @ @ - 22 , 5 + 22 , 6 @ @ class AAActorRuntime { 
 ARCocoaWebRTCProxyProvider . setWebRTCRuntime ( CocoaWebRTCRuntime ( ) ) 
 ARCocoaLifecycleProxyProvider . setLifecycleRuntime ( CocoaLifecycleRuntime ( ) ) 
 ARCocoaDispatcher . setDispatcherProxy ( CocoaDispatcher ( ) ) 
 + ARRuntimeEnvironment . setIsProductionWithBoolean ( true ) 
 } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift 
 index 24a10a6 . . daaa1cf 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaFileSystemRuntime . swift 
 @ @ - 4 , 16 + 4 , 12 @ @ 
 
 import Foundation 
 
 + private let documentsFolder = NSSearchPathForDirectoriesInDomains ( NSSearchPathDirectory . DocumentDirectory , NSSearchPathDomainMask . UserDomainMask , true ) [ 0 ] . asNS . stringByDeletingLastPathComponent 
 + 
 / / Public methods for working with files 
 class CocoaFiles { 
 class func pathFromDescriptor ( path : String ) - > String { 
 - var documentsFolders = NSSearchPathForDirectoriesInDomains ( NSSearchPathDirectory . DocumentDirectory , NSSearchPathDomainMask . UserDomainMask , true ) 
 - if ( documentsFolders . count > 0 ) { 
 - let appPath = documentsFolders [ 0 ] . asNS . stringByDeletingLastPathComponent 
 - return appPath + path 
 - } else { 
 - fatalError ( " Unable to load Application path " ) 
 - } 
 + return documentsFolder + path 
 } 
 } 
 
 @ @ - 141 , 15 + 137 , 18 @ @ class CocoaOutputFile : NSObject , AROutputFile { 
 srcBuffer + + ; 
 } 
 
 + NSLog ( " Write to file \ ( fileOffset ) " ) 
 fileHandle . seekToFileOffset ( UInt64 ( fileOffset ) ) ; 
 fileHandle . writeData ( toWrite ) 
 - 
 + NSLog ( " Write to file \ ( fileOffset ) : end " ) 
 return true ; 
 } 
 
 func close ( ) - > Bool { 
 + NSLog ( " Close file " ) 
 self . fileHandle . synchronizeFile ( ) 
 self . fileHandle . closeFile ( ) 
 + NSLog ( " Close file end " ) 
 return true ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift 
 index e257212 . . 2ddc4a4 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaNetworkRuntime . swift 
 @ @ - 24 , 7 + 24 , 7 @ @ class CocoaTcpConnectionFactory : NSObject , ARAsyncConnectionFactory { 
 
 class CocoaTcpConnection : ARAsyncConnection , GCDAsyncSocketDelegate { 
 
 - static let queue = dispatch _ queue _ create ( " im . actor . queue . TCP " , nil ) ; 
 + static let queue = YYDispatchQueueGetForQOS ( NSQualityOfService . Background ) 
 
 let READ _ HEADER = 1 
 let READ _ BODY = 2 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 index 592ffc8 . . c852ff6 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 @ @ - 201 , 6 + 201 , 7 @ @ import DZNWebViewController 
 builder . setPhoneBookImportEnabled ( jboolean ( enablePhoneBookImport ) ) 
 builder . setVoiceCallsEnabled ( jboolean ( enableCalls ) ) 
 builder . setIsEnabledGroupedChatList ( false ) 
 + builder . setEnableFilesLogging ( true ) 
 
 / / Creating messenger 
 messenger = ACCocoaMessenger ( configuration : builder . build ( ) ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift 
 index bb3e77a . . 78a2ae3 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift 	 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Dialogs List / Cells / AADialogCell . swift 	 
 @ @ - 72 , 13 + 72 , 14 @ @ public class AADialogCell : AATableViewCell , AABindedCell { 
 dateView . fadeOnAsynchronouslyDisplay = false 
 dateView . clearContentsBeforeAsynchronouslyDisplay = false 
 
 - statusView . contentMode = . Center 
 + counterView . displaysAsynchronously = true 
 + counterView . ignoreCommonProperties = true 
 + counterView . fadeOnAsynchronouslyDisplay = false 
 + counterView . clearContentsBeforeAsynchronouslyDisplay = false 
 
 counterViewBg . image = AADialogCell . counterBgImage 
 
 - counterView . font = UIFont . systemFontOfSize ( 14 ) 
 - counterView . textColor = appStyle . dialogCounterColor 
 - counterView . textAlignment = . Center 
 + statusView . contentMode = . Center 
 
 self . contentView . addSubview ( avatarView ) 
 self . contentView . addSubview ( titleView ) 
 @ @ - 118 , 12 + 119 , 10 @ @ public class AADialogCell : AATableViewCell , AABindedCell { 
 if ! titleView . displaysAsynchronously { 
 titleView . displaysAsynchronously = true 
 } 
 + 
 if ! messageView . displaysAsynchronously { 
 messageView . displaysAsynchronously = true 
 } 
 - if ! dateView . displaysAsynchronously { 
 - dateView . displaysAsynchronously = true 
 - } 
 
 
 / / Reseting Text Layout on new peer binding 
 @ @ - 143 , 26 + 142 , 6 @ @ public class AADialogCell : AATableViewCell , AABindedCell { 
 self . counterViewBg . hidden = true 
 } 
 
 - 
 - / / / / 
 - / / / / Counter View 
 - / / / / 
 - / / if ( item . unreadCount ! = 0 ) { 
 - / / self . counterView . text = " \ ( item . unreadCount ) " 
 - / / if counterView . hidden { 
 - / / setNeedsLayout ( ) 
 - / / } 
 - / / self . counterView . hidden = false 
 - / / self . counterViewBg . hidden = false 
 - / / } else { 
 - / / if ! counterView . hidden { 
 - / / setNeedsLayout ( ) 
 - / / } 
 - / / self . counterView . hidden = true 
 - / / self . counterViewBg . hidden = true 
 - / / } 
 - 
 - 
 / / 
 / / Message State 
 / / 
 @ @ - 248 , 8 + 227 , 6 @ @ public class AADialogCell : AATableViewCell , AABindedCell { 
 titleView . clearContentsBeforeAsynchronouslyDisplay = false 
 messageView . displaysAsynchronously = false 
 messageView . clearContentsBeforeAsynchronouslyDisplay = false 
 - dateView . displaysAsynchronously = false 
 - dateView . clearContentsBeforeAsynchronouslyDisplay = false 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m 
 index d2e86cc . . b5cf857 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Libs / YYKit / YYLabel . m 
 @ @ - 977 , 6 + 977 , 14 @ @ static dispatch _ queue _ t YYLabelGetReleaseQueue ( ) { 
 } 
 
 - ( void ) setTextLayout : ( YYTextLayout * ) textLayout { 
 + 
 + if ( _ innerLayout ! = nil ) { 
 + YYTextLayout * oldLayout = _ innerLayout ; 
 + dispatch _ async ( YYLabelGetReleaseQueue ( ) , ^ { 
 + YYTextLayout * released = oldLayout ; 
 + } ) ; 
 + } 
 + 
 _ innerLayout = textLayout ; 
 _ shrinkInnerLayout = nil ; 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift 
 index 91bc00d . . 9e6128a 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Views / Cells / AABackgroundCellRenderer . swift 
 @ @ - 23 , 7 + 23 , 15 @ @ public class AABackgroundCellRenderer < P , T where T : AnyObject , P : AnyObject , P : 
 if requestedConfig = = config { 
 return false 
 } 
 - let wasConfig = requestedConfig ! = nil 
 + let oldConfig = requestedConfig 
 + let wasConfig = oldConfig ! = nil 
 + 
 + / / Releasing in background 
 + if wasConfig { 
 + dispatchBackground { 
 + let _ = oldConfig 
 + } 
 + } 
 
 if wasPresented { 
 / / Do Sync rendering when is just resized 
 @ @ - 66 , 7 + 74 , 15 @ @ public class AABackgroundCellRenderer < P , T where T : AnyObject , P : AnyObject , P : 
 
 func cancelRender ( wasPresented : Bool = false ) { 
 generation + + 
 + let oldConfig = requestedConfig 
 requestedConfig = nil 
 + 
 + / / Releasing in background 
 + if oldConfig ! = nil { 
 + dispatchBackground { 
 + let _ = oldConfig 
 + } 
 + } 
 self . wasPresented = wasPresented 
 } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java 
 index 4845b47 . . 678084a 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / file / DownloadManager . java 
 @ @ - 54 , 8 + 54 , 8 @ @ public class DownloadManager extends ModuleActor { 
 if ( downloaded1 ! = null ) { 
 / / FileSystemProvider provider = modules ( ) . getConfiguration ( ) . getFileSystemProvider ( ) ; 
 FileSystemReference reference = Storage . fileFromDescriptor ( downloaded1 . getDescriptor ( ) ) ; 
 - boolean isExist = reference . isExist ( ) ; 
 - int fileSize = reference . getSize ( ) ; 
 + boolean isExist = true ; / / reference . isExist ( ) ; 
 + int fileSize = downloaded1 . getFileSize ( ) ; / / reference . getSize ( ) ; 
 if ( isExist & & fileSize = = downloaded1 . getFileSize ( ) ) { 
 if ( LOG ) { 
 Log . d ( TAG , " - Downloaded " ) ; 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java 
 index 7e624bd . . 697691c 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / Runtime . java 
 @ @ - 61 , 6 + 61 , 10 @ @ public class Runtime { 
 } 
 
 public static void checkMainThread ( ) { 
 + if ( RuntimeEnvironment . isProduction ( ) ) { 
 + / / Do Nothing in production mode 
 + return ; 
 + } 
 if ( mainThreadRuntime . isSingleThread ( ) ) { 
 return ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java 
 new file mode 100644 
 index 0000000 . . d9e3f53 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / RuntimeEnvironment . java 
 @ @ - 0 , 0 + 1 , 14 @ @ 
 + package im . actor . runtime ; 
 + 
 + public abstract class RuntimeEnvironment { 
 + 
 + private static boolean isProduction ; 
 + 
 + public static boolean isProduction ( ) { 
 + return isProduction ; 
 + } 
 + 
 + public static void setIsProduction ( boolean isProduction ) { 
 + RuntimeEnvironment . isProduction = isProduction ; 
 + } 
 + }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 index 6ef6244 . . 3f4c2da 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 @ @ - 426 , 7 + 426 , 7 @ @ 
 	 	 	 	 	 " - framework " , 
 	 	 	 	 	 " \ " WebKit \ " " , 
 	 	 	 	 ) ; 
 - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk ; 
 + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; 
 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; 
 	 	 	 	 PROVISIONING _ PROFILE = " " ; 
 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; 
 @ @ - 544 , 7 + 544 , 7 @ @ 
 	 	 	 	 	 " - framework " , 
 	 	 	 	 	 " \ " WebKit \ " " , 
 	 	 	 	 ) ; 
 - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk ; 
 + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; 
 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; 
 	 	 	 	 PROVISIONING _ PROFILE = " " ; 
 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift 
 index af58779 . . ad4af58 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAComposeController . swift 
 @ @ - 36 , 7 + 36 , 7 @ @ public class AAComposeController : AAContactsListContentController , AAContactsLis 
 } 
 
 public func contactDidTap ( controller : AAContactsListContentController , contact : ACContact ) - > Bool { 
 - navigateNext ( ConversationViewController ( peer : ACPeer . userWithInt ( contact . uid ) ) , removeCurrent : true ) 
 + navigateDetail ( ConversationViewController ( peer : ACPeer . userWithInt ( contact . uid ) ) ) 
 return false 
 } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift 
 index dc0852f . . b51d791 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupCreateViewController . swift 
 @ @ - 92 , 14 + 92 , 12 @ @ public class AAGroupCreateViewController : AAViewController , UITextFieldDelegate 
 public override func viewDidLayoutSubviews ( ) { 
 super . viewDidLayoutSubviews ( ) 
 
 - let screenSize = UIScreen . mainScreen ( ) . bounds . size 
 - 
 avatarImageView . frame = CGRectMake ( 20 , 20 + 66 , 80 , 80 ) 
 addPhotoButton . frame = avatarImageView . frame 
 - hint . frame = CGRectMake ( 120 , 20 + 66 , screenSize . width - 140 , 80 ) 
 + hint . frame = CGRectMake ( 120 , 20 + 66 , view . width - 140 , 80 ) 
 
 - groupName . frame = CGRectMake ( 20 , 106 + 66 , screenSize . width - 20 , 56 . 0 ) 
 - groupNameFieldSeparator . frame = CGRectMake ( 20 , 156 + 66 , screenSize . width - 20 , 0 . 5 ) 
 + groupName . frame = CGRectMake ( 20 , 106 + 66 , view . width - 20 , 56 . 0 ) 
 + groupNameFieldSeparator . frame = CGRectMake ( 20 , 156 + 66 , view . width - 20 , 0 . 5 ) 
 } 
 
 public func photoTap ( ) { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift 
 index 0828011 . . 1b87a4f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Compose / AAGroupMembersController . swift 
 @ @ - 81 , 7 + 81 , 7 @ @ public class GroupMembersController : AAContactsListContentController , AAContacts 
 if self . groupImage ! = nil { 
 Actor . changeGroupAvatar ( gid , image : self . groupImage ! ) 
 } 
 - self . navigateNext ( ConversationViewController ( peer : ACPeer . groupWithInt ( gid ) ) , removeCurrent : true ) 
 + self . navigateDetail ( ConversationViewController ( peer : ACPeer . groupWithInt ( gid ) ) ) 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift 
 index 6832daf . . 273f87f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Contacts / AAContactsViewController . swift 
 @ @ - 56 , 7 + 56 , 7 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC 
 
 r . selectAction = { ( ) - > Bool in 
 self . findContact ( ) 
 - return false 
 + return AADevice . isiPad 
 } 
 } 
 
 @ @ - 116 , 7 + 116 , 9 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC 
 } 
 } 
 
 - self . showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : UIView ( ) , sourceRect : CGRectZero , tapClosure : builder . tapClosure ) 
 + let view = self . tableView . cellForRowAtIndexPath ( NSIndexPath ( forRow : 1 , inSection : 0 ) ) ! . contentView 
 + 
 + self . showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : view , sourceRect : view . bounds , tapClosure : builder . tapClosure ) 
 
 return true 
 } 
 @ @ - 156 , 10 + 158 , 10 @ @ class AAContactsViewController : AAContactsListContentController , AAContactsListC 
 
 if user ! = nil { 
 c . execute ( Actor . addContactCommandWithUid ( user ! . getId ( ) ) , successBlock : { ( val ) - > Void in 
 - self . navigateNext ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) 
 + self . navigateDetail ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) 
 c . dismiss ( ) 
 } , failureBlock : { ( val ) - > Void in 
 - self . navigateNext ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) 
 + self . navigateDetail ( ConversationViewController ( peer : ACPeer _ userWithInt _ ( user ! . getId ( ) ) ) ) 
 c . dismiss ( ) 
 } ) 
 } else { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift 
 index da5a968 . . e33d2af 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AAConversationContentController . swift 
 @ @ - 341 , 11 + 341 , 12 @ @ public class AAConversationContentController : SLKTextViewController , ARDisplayLi 
 } 
 } 
 
 - public override func willRotateToInterfaceOrientation ( toInterfaceOrientation : UIInterfaceOrientation , duration : NSTimeInterval ) { 
 - super . willRotateToInterfaceOrientation ( toInterfaceOrientation , duration : duration ) 
 + public override func viewWillTransitionToSize ( size : CGSize , withTransitionCoordinator coordinator : UIViewControllerTransitionCoordinator ) { 
 + super . viewWillTransitionToSize ( size , withTransitionCoordinator : coordinator ) 
 
 dispatch _ async ( dispatch _ get _ main _ queue ( ) , { ( ) - > Void in 
 - self . collectionView . collectionViewLayout . invalidateLayout ( ) 
 + / / self . collectionView . collectionViewLayout . invalidateLayout ( ) 
 + self . collectionView . performBatchUpdates ( nil , completion : nil ) 
 } ) 
 } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift 
 index 5a07bf3 . . f846338 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / AANavigationBadge . swift 
 @ @ - 57 , 6 + 57 , 9 @ @ class AANavigationBadge { 
 } 
 
 class func showBadge ( ) { 
 + if ( AADevice . isiPad ) { 
 + return 
 + } 
 start ( ) 
 isBadgeVisible = true 
 if badgeCount > 0 { 
 @ @ - 65 , 6 + 68 , 9 @ @ class AANavigationBadge { 
 } 
 
 class func hideBadge ( ) { 
 + if ( AADevice . isiPad ) { 
 + return 
 + } 
 start ( ) 
 isBadgeVisible = false 
 self . badgeView . hideView ( ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift 
 index 957bcc3 . . 8d47288 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift 	 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / AAManagedTableController . swift 	 
 @ @ - 131 , 6 + 131 , 12 @ @ public class AAManagedTableController : AAViewController { 
 m . controllerViewDidDisappear ( animated ) 
 } 
 } 
 + 
 + public override func viewWillLayoutSubviews ( ) { 
 + super . viewWillLayoutSubviews ( ) 
 + 
 + tableView . frame = view . bounds 
 + } 
 } 
 
 public protocol AAManagedTableControllerDelegate { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift 
 index 23ef765 . . d798a63 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift 	 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Managed Runtime / Alerts . swift 	 
 @ @ - 121 , 14 + 121 , 22 @ @ public extension UIViewController { 
 let config = AAEditTextControllerConfig ( ) 
 closure ( config ) 
 config . check ( ) 
 - self . presentViewController ( AANavigationController ( rootViewController : AAEditTextController ( config : config ) ) , animated : true , completion : nil ) 
 + let controller = AANavigationController ( rootViewController : AAEditTextController ( config : config ) ) 
 + if ( AADevice . isiPad ) { 
 + controller . modalPresentationStyle = . FormSheet 
 + } 
 + self . presentViewController ( controller , animated : true , completion : nil ) 
 } 
 
 func startEditField ( @ noescape closure : ( c : AAEditFieldControllerConfig ) - > ( ) ) { 
 let config = AAEditFieldControllerConfig ( ) 
 closure ( c : config ) 
 config . check ( ) 
 - self . presentViewController ( AANavigationController ( rootViewController : AAEditFieldController ( config : config ) ) , animated : true , completion : nil ) 
 + let controller = AANavigationController ( rootViewController : AAEditFieldController ( config : config ) ) 
 + if ( AADevice . isiPad ) { 
 + controller . modalPresentationStyle = . FormSheet 
 + } 
 + self . presentViewController ( controller , animated : true , completion : nil ) 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 index f26c644 . . 1312413 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Settings / AASettingsViewController . swift 
 @ @ - 88 , 11 + 88 , 12 @ @ public class AASettingsViewController : AAContentTableController { 
 s . action ( " SettingsSetPhoto " ) { [ unowned self ] ( r ) - > ( ) in 
 r . selectAction = { [ unowned self ] ( ) - > Bool in 
 let hasCamera = UIImagePickerController . isSourceTypeAvailable ( UIImagePickerControllerSourceType . Camera ) 
 + let view = self . tableView . cellForRowAtIndexPath ( NSIndexPath ( forRow : 1 , inSection : 0 ) ) ! . contentView 
 self . showActionSheet ( hasCamera ? [ " PhotoCamera " , " PhotoLibrary " ] : [ " PhotoLibrary " ] , 
 cancelButton : " AlertCancel " , 
 destructButton : self . user . getAvatarModel ( ) . get ( ) ! = nil ? " PhotoRemove " : nil , 
 - sourceView : self . view , 
 - sourceRect : self . view . bounds , 
 + sourceView : view , 
 + sourceRect : view . bounds , 
 tapClosure : { [ unowned self ] ( index ) - > ( ) in 
 if index = = - 2 { 
 self . confirmUser ( " PhotoRemoveGroupMessage " , 
 @ @ - 217 , 7 + 218 , 7 @ @ public class AASettingsViewController : AAContentTableController { 
 } 
 } 
 
 - return false 
 + return AADevice . isiPad 
 } 
 } 
 
 @ @ - 258 , 7 + 259 , 7 @ @ public class AASettingsViewController : AAContentTableController { 
 } 
 } 
 
 - return false 
 + return AADevice . isiPad 
 } 
 }
