BLEU SCORE: 0.13912311644176567

TEST MSG: fix ( server : dialog ) : update grouped dialog list after message received
GENERATED MSG: fix ( server ) : send update counters changed in parallel

TEST DIFF (one line): diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > index 5dc25f5 . . bd06349 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > @ @ - 101 , 7 + 101 , 6 @ @ trait DialogCommandHandlers extends PeersImplicits with UserAcl { < nl > } < nl > < nl > ( for { < nl > - _ ← dialogExt . bump ( userId , peer ) < nl > _ ← deliveryExt . receiverDelivery ( < nl > receiverUserId = userId , < nl > senderUserId = sm . getOrigin . id , < nl > @ @ - 112 , 6 + 111 , 7 @ @ trait DialogCommandHandlers extends PeersImplicits with UserAcl { < nl > isFat = sm . isFat , < nl > deliveryTag = sm . deliveryTag < nl > ) < nl > + _ ← dialogExt . bump ( userId , peer ) < nl > } yield SendMessageAck ( ) ) pipeTo sender ( ) < nl > < nl > deliveryExt . sendCountersUpdate ( userId )
NEAREST DIFF (one line): diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > index 784006e . . 57412ec 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala < nl > @ @ - 54 , 7 + 54 , 7 @ @ trait DialogCommandHandlers extends UpdateCounters with PeersImplicits { < nl > for { < nl > _ ← dialogExt . ackSendMessage ( peer , sm . copy ( date = Some ( sendDate ) ) ) < nl > _ ← db . run ( writeHistoryMessage ( selfPeer , peer , new DateTime ( sendDate ) , sm . randomId , message . header , message . toByteArray ) ) < nl > - _ ← dialogExt . updateCounters ( peer , userId ) < nl > + _ = dialogExt . updateCounters ( peer , userId ) < nl > SeqState ( seq , state ) ← deliveryExt . senderDelivery ( userId , sm . senderAuthSid , peer , sm . randomId , sendDate , message , sm . isFat ) < nl > } yield SeqStateDate ( seq , state , sendDate ) < nl > } pipeTo self

TEST DIFF:
diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 index 5dc25f5 . . bd06349 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 @ @ - 101 , 7 + 101 , 6 @ @ trait DialogCommandHandlers extends PeersImplicits with UserAcl { 
 } 
 
 ( for { 
 - _ ← dialogExt . bump ( userId , peer ) 
 _ ← deliveryExt . receiverDelivery ( 
 receiverUserId = userId , 
 senderUserId = sm . getOrigin . id , 
 @ @ - 112 , 6 + 111 , 7 @ @ trait DialogCommandHandlers extends PeersImplicits with UserAcl { 
 isFat = sm . isFat , 
 deliveryTag = sm . deliveryTag 
 ) 
 + _ ← dialogExt . bump ( userId , peer ) 
 } yield SendMessageAck ( ) ) pipeTo sender ( ) 
 
 deliveryExt . sendCountersUpdate ( userId )

NEAREST DIFF:
diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 index 784006e . . 57412ec 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogCommandHandlers . scala 
 @ @ - 54 , 7 + 54 , 7 @ @ trait DialogCommandHandlers extends UpdateCounters with PeersImplicits { 
 for { 
 _ ← dialogExt . ackSendMessage ( peer , sm . copy ( date = Some ( sendDate ) ) ) 
 _ ← db . run ( writeHistoryMessage ( selfPeer , peer , new DateTime ( sendDate ) , sm . randomId , message . header , message . toByteArray ) ) 
 - _ ← dialogExt . updateCounters ( peer , userId ) 
 + _ = dialogExt . updateCounters ( peer , userId ) 
 SeqState ( seq , state ) ← deliveryExt . senderDelivery ( userId , sm . senderAuthSid , peer , sm . randomId , sendDate , message , sm . isFat ) 
 } yield SeqStateDate ( seq , state , sendDate ) 
 } pipeTo self
