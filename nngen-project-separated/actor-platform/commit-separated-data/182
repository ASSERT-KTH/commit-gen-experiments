BLEU SCORE: 0.19640732545025652

TEST MSG: feat ( android + core ) : Loading async members
GENERATED MSG: feat ( android ) : group users online status

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > index 799a9be . . dffc160 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > @ @ - 146 , 6 + 146 , 12 @ @ < nl > android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > < nl > < activity < nl > + android : name = " . controllers . group . MembersActivity " < nl > + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > + android : theme = " @ style / CommonActivityTheme " < nl > + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > + < nl > + < activity < nl > android : name = " . controllers . settings . MyProfileActivity " < nl > android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > android : theme = " @ style / ProfileActivityTheme " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index 4e8ca9c . . 3ba0c44 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 865 , 9 + 865 , 7 @ @ public class ActorSDK { < nl > public void startGroupInfoActivity ( Context context , int gid ) { < nl > Bundle b = new Bundle ( ) ; < nl > b . putInt ( Intents . EXTRA _ GROUP _ ID , gid ) ; < nl > - if ( ! startDelegateActivity ( context , delegate . getGroupInfoIntent ( gid ) , b ) ) { < nl > - startActivity ( context , b , GroupInfoActivity . class ) ; < nl > - } < nl > + startActivity ( context , b , GroupInfoActivity . class ) ; < nl > } < nl > < nl > / * * < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index 7df3d6d . . 2f964b7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 58 , 6 + 58 , 13 @ @ public interface ActorSDKDelegate { < nl > @ Nullable < nl > Fragment fragmentForProfile ( int uid ) ; < nl > < nl > + / * * < nl > + * If not null returned , overrides group info fragment < nl > + * < nl > + * @ return Actor Intent < nl > + * / < nl > + Fragment fragmentForGroupInfo ( int gid ) ; < nl > + < nl > < nl > / / < nl > / / Chat < nl > @ @ - 115 , 12 + 122 , 6 @ @ public interface ActorSDKDelegate { < nl > * / < nl > ActorIntentFragmentActivity getSettingsIntent ( ) ; < nl > < nl > - / * * < nl > - * If not null returned , overrides group info activity intent < nl > - * < nl > - * @ return Actor Intent < nl > - * / < nl > - BaseGroupInfoActivity getGroupInfoIntent ( int gid ) ; < nl > < nl > / * * < nl > * If not null returned , overrides settings activity intent < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index f5a9d3d . . 076aa50 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 49 , 28 + 49 , 28 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > return null ; < nl > } < nl > < nl > - @ Nullable < nl > @ Override < nl > - public AbsAttachFragment fragmentForAttachMenu ( Peer peer ) { < nl > + public Fragment fragmentForGroupInfo ( int gid ) { < nl > return null ; < nl > } < nl > < nl > @ Nullable < nl > @ Override < nl > - public Fragment fragmentForToolbar ( Peer peer ) { < nl > + public AbsAttachFragment fragmentForAttachMenu ( Peer peer ) { < nl > return null ; < nl > } < nl > < nl > + @ Nullable < nl > @ Override < nl > - public ActorIntentFragmentActivity getSettingsIntent ( ) { < nl > + public Fragment fragmentForToolbar ( Peer peer ) { < nl > return null ; < nl > } < nl > < nl > @ Override < nl > - public BaseGroupInfoActivity getGroupInfoIntent ( int gid ) { < nl > + public ActorIntentFragmentActivity getSettingsIntent ( ) { < nl > return null ; < nl > } < nl > - < nl > + < nl > @ Override < nl > public ActorIntentFragmentActivity getChatSettingsIntent ( ) { < nl > return null ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java < nl > index 7eff038 . . 4f82c34 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java < nl > @ @ - 14 , 10 + 14 , 17 @ @ import android . view . ViewGroup ; < nl > import android . widget . ImageView ; < nl > import android . widget . TextView ; < nl > < nl > + import org . jetbrains . annotations . NotNull ; < nl > + < nl > + import java . util . ArrayList ; < nl > + < nl > import im . actor . core . viewmodel . Command ; < nl > import im . actor . core . viewmodel . CommandCallback ; < nl > import im . actor . runtime . function . Consumer ; < nl > + import im . actor . runtime . function . Function ; < nl > import im . actor . runtime . promise . Promise ; < nl > + import im . actor . runtime . promise . PromiseFunc ; < nl > + import im . actor . runtime . promise . PromiseResolver ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorStyle ; < nl > import im . actor . sdk . R ; < nl > @ @ - 36 , 6 + 43 , 8 @ @ public class BaseFragment extends BinderCompatFragment { < nl > private boolean showHome = false ; < nl > private boolean showCustom = false ; < nl > < nl > + private ArrayList < WrappedPromise > pending = new ArrayList < > ( ) ; < nl > + < nl > public boolean isRootFragment ( ) { < nl > return isRootFragment ; < nl > } < nl > @ @ - 403 , 4 + 412 , 42 @ @ public class BaseFragment extends BinderCompatFragment { < nl > } < nl > return null ; < nl > } < nl > + < nl > + protected < T > Promise < T > wrap ( Promise < T > p ) { < nl > + WrappedPromise < T > res = new WrappedPromise < > ( ( PromiseFunc < T > ) resolver - > p . pipeTo ( resolver ) ) ; < nl > + pending . add ( res ) ; < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onPause ( ) { < nl > + super . onPause ( ) ; < nl > + < nl > + for ( WrappedPromise w : pending ) { < nl > + w . kill ( ) ; < nl > + } < nl > + pending . clear ( ) ; < nl > + } < nl > + < nl > + < nl > + private class WrappedPromise < T > extends Promise < T > { < nl > + < nl > + private boolean isKilled ; < nl > + < nl > + public WrappedPromise ( PromiseFunc < T > executor ) { < nl > + super ( executor ) ; < nl > + } < nl > + < nl > + public void kill ( ) { < nl > + isKilled = true ; < nl > + } < nl > + < nl > + @ Override < nl > + protected void invokeDeliver ( ) { < nl > + if ( isKilled ) { < nl > + return ; < nl > + } < nl > + super . invokeDeliver ( ) ; < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > index 5764a2a . . 643b213 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > @ @ - 1 , 33 + 1 , 25 @ @ < nl > package im . actor . sdk . controllers . group ; < nl > < nl > - import android . graphics . Color ; < nl > - import android . graphics . drawable . ColorDrawable ; < nl > import android . os . Bundle ; < nl > + import android . support . v4 . app . Fragment ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > - import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; < nl > < nl > public class GroupInfoActivity extends BaseFragmentActivity { < nl > < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > - < nl > - < nl > - < nl > + < nl > if ( savedInstanceState = = null ) { < nl > - GroupInfoFragment fragment ; < nl > - BaseGroupInfoActivity profileIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . getGroupInfoIntent ( chatId ) ; < nl > - if ( profileIntent ! = null ) { < nl > - fragment = profileIntent . getGroupInfoFragment ( chatId ) ; < nl > - } else { < nl > - fragment = GroupInfoFragment . create ( chatId ) ; < nl > + int groupId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > + Fragment profileIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForGroupInfo ( groupId ) ; < nl > + if ( profileIntent = = null ) { < nl > + profileIntent = GroupInfoFragment . create ( groupId ) ; < nl > } < nl > - < nl > - showFragment ( fragment , false , false ) ; < nl > + showFragment ( profileIntent , false , false ) ; < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > index efd92dc . . a43568d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > @ @ - 24 , 6 + 24 , 7 @ @ import com . google . i18n . phonenumbers . PhoneNumberUtil ; < nl > import com . google . i18n . phonenumbers . Phonenumber ; < nl > < nl > import java . util . ArrayList ; < nl > + import java . util . HashSet ; < nl > < nl > import im . actor . core . entity . GroupMember ; < nl > import im . actor . core . entity . GroupType ; < nl > @ @ - 33 , 6 + 34 , 8 @ @ import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserPhone ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . actors . messages . Void ; < nl > + import im . actor . runtime . mvvm . Value ; < nl > + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; < nl > import im . actor . runtime . mvvm . ValueListener ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKLauncher ; < nl > @ @ - 115 , 6 + 118 , 7 @ @ public class GroupInfoFragment extends BaseFragment { < nl > TextView aboutTV = ( TextView ) header . findViewById ( R . id . about ) ; < nl > View aboutCont = header . findViewById ( R . id . aboutContainer ) ; < nl > View addMemberCont = header . findViewById ( R . id . addMemberCont ) ; < nl > + View membersCont = header . findViewById ( R . id . membersCont ) ; < nl > View leaveCont = header . findViewById ( R . id . leaveChannelCont ) ; < nl > < nl > TextView title = ( TextView ) header . findViewById ( R . id . title ) ; < nl > @ @ - 142 , 6 + 146 , 8 @ @ public class GroupInfoFragment extends BaseFragment { < nl > . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > ( ( TextView ) header . findViewById ( R . id . add _ member _ title ) ) < nl > . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > + ( ( TextView ) header . findViewById ( R . id . members _ tite ) ) < nl > + . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > ( ( TextView ) header . findViewById ( R . id . leave _ channel _ title ) ) < nl > . setTextColor ( style . getTextDangerColor ( ) ) ; < nl > < nl > @ @ - 242 , 19 + 248 , 26 @ @ public class GroupInfoFragment extends BaseFragment { < nl > < nl > / / Members < nl > < nl > - bind ( groupVM . getIsCanViewMembers ( ) , canViewMembers - > { < nl > + bind ( groupVM . getIsCanViewMembers ( ) , groupVM . getIsAsyncMembers ( ) , ( canViewMembers , vm1 , isAsync , vm2 ) - > { < nl > if ( canViewMembers ) { < nl > - header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . VISIBLE ) ; < nl > - / / header . findViewById ( R . id . membersHeader ) . setVisibility ( View . VISIBLE ) ; < nl > + if ( isAsync ) { < nl > + membersCont . setVisibility ( View . VISIBLE ) ; < nl > + header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . GONE ) ; < nl > + } else { < nl > + membersCont . setVisibility ( View . GONE ) ; < nl > + header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . VISIBLE ) ; < nl > + } < nl > } else { < nl > header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . GONE ) ; < nl > - / / header . findViewById ( R . id . membersHeader ) . setVisibility ( View . GONE ) ; < nl > } < nl > } ) ; < nl > + membersCont . setOnClickListener ( view - > { < nl > + startActivity ( new Intent ( getContext ( ) , MembersActivity . class ) < nl > + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; < nl > + } ) ; < nl > < nl > listView . addHeaderView ( header , null , false ) ; < nl > < nl > - < nl > / / < nl > / / Footer < nl > / / < nl > @ @ - 284 , 8 + 297 , 12 @ @ public class GroupInfoFragment extends BaseFragment { < nl > / / < nl > < nl > groupUserAdapter = new MembersAdapter ( getActivity ( ) ) ; < nl > - bind ( groupVM . getMembers ( ) , members - > { < nl > - groupUserAdapter . setMembers ( members ) ; < nl > + bind ( groupVM . getIsAsyncMembers ( ) , groupVM . getMembers ( ) , ( isAsyncMembers , valueModel , members , valueModel2 ) - > { < nl > + if ( isAsyncMembers ) { < nl > + groupUserAdapter . setMembers ( new ArrayList < > ( ) ) ; < nl > + } else { < nl > + groupUserAdapter . setMembers ( members ) ; < nl > + } < nl > } ) ; < nl > listView . setAdapter ( groupUserAdapter ) ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java < nl > new file mode 100644 < nl > index 0000000 . . b5d1278 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java < nl > @ @ - 0 , 0 + 1 , 18 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . os . Bundle ; < nl > + < nl > + import im . actor . sdk . controllers . Intents ; < nl > + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + < nl > + public class MembersActivity extends BaseFragmentActivity { < nl > + @ Override < nl > + protected void onCreate ( Bundle savedInstanceState ) { < nl > + super . onCreate ( savedInstanceState ) ; < nl > + < nl > + if ( savedInstanceState = = null ) { < nl > + int groupId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > + showFragment ( MembersFragment . create ( groupId ) , false , false ) ; < nl > + } < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java < nl > new file mode 100644 < nl > index 0000000 . . 8e47223 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java < nl > @ @ - 0 , 0 + 1 , 78 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . os . Bundle ; < nl > + import android . support . annotation . Nullable ; < nl > + import android . view . LayoutInflater ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . widget . ListView ; < nl > + < nl > + import java . util . ArrayList ; < nl > + < nl > + import im . actor . core . entity . GroupMember ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . BaseFragment ; < nl > + import im . actor . sdk . controllers . group . view . MembersAdapter ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > + public class MembersFragment extends BaseFragment { < nl > + < nl > + public static MembersFragment create ( int groupId ) { < nl > + MembersFragment res = new MembersFragment ( ) ; < nl > + Bundle args = new Bundle ( ) ; < nl > + args . putInt ( " groupId " , groupId ) ; < nl > + res . setArguments ( args ) ; < nl > + return res ; < nl > + } < nl > + < nl > + private static final int LIMIT = 20 ; < nl > + < nl > + private int groupId ; < nl > + private boolean isInitiallyLoaded ; < nl > + private byte [ ] nextMembers ; < nl > + private ArrayList < Integer > members = new ArrayList < > ( ) ; < nl > + private MembersAdapter adapter ; < nl > + < nl > + public MembersFragment ( ) { < nl > + setRootFragment ( true ) ; < nl > + setTitle ( R . string . group _ members _ header ) ; < nl > + setHomeAsUp ( true ) ; < nl > + setShowHome ( true ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onCreate ( Bundle saveInstance ) { < nl > + super . onCreate ( saveInstance ) ; < nl > + < nl > + groupId = getArguments ( ) . getInt ( " groupId " ) ; < nl > + } < nl > + < nl > + @ Nullable < nl > + @ Override < nl > + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { < nl > + View res = inflater . inflate ( R . layout . fragment _ members , container , false ) ; < nl > + adapter = new MembersAdapter ( getContext ( ) ) ; < nl > + < nl > + ( ( ListView ) res . findViewById ( R . id . items ) ) . setAdapter ( adapter ) ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onResume ( ) { < nl > + super . onResume ( ) ; < nl > + if ( ! isInitiallyLoaded ) { < nl > + wrap ( messenger ( ) . loadMembers ( groupId , LIMIT , nextMembers ) ) . then ( groupMembersSlice - > { < nl > + isInitiallyLoaded = true ; < nl > + members . addAll ( groupMembersSlice . getUids ( ) ) ; < nl > + nextMembers = groupMembersSlice . getNext ( ) ; < nl > + ArrayList < GroupMember > nMembers = new ArrayList < > ( ) ; < nl > + for ( Integer uid : members ) { < nl > + nMembers . add ( new GroupMember ( uid , 0 , 0 , false ) ) ; < nl > + } < nl > + adapter . setMembers ( nMembers , false ) ; < nl > + } ) ; < nl > + } < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > index a118032 . . 6697651 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > @ @ - 32 , 19 + 32 , 25 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > } < nl > < nl > public void setMembers ( Collection < GroupMember > members ) { < nl > + setMembers ( members , true ) ; < nl > + } < nl > + < nl > + public void setMembers ( Collection < GroupMember > members , boolean sort ) { < nl > this . members = members . toArray ( new GroupMember [ members . size ( ) ] ) ; < nl > - Arrays . sort ( this . members , ( a , b ) - > { < nl > - if ( a . isAdministrator ( ) & & ! b . isAdministrator ( ) ) { < nl > - return - 1 ; < nl > - } < nl > - if ( b . isAdministrator ( ) & & ! a . isAdministrator ( ) ) { < nl > - return 1 ; < nl > - } < nl > - String an = users ( ) . get ( a . getInviterUid ( ) ) . getName ( ) . get ( ) ; < nl > - String bn = users ( ) . get ( b . getInviterUid ( ) ) . getName ( ) . get ( ) ; < nl > - return an . compareTo ( bn ) ; < nl > - } ) ; < nl > - notifyDataSetChanged ( ) ; < nl > + if ( sort ) { < nl > + Arrays . sort ( this . members , ( a , b ) - > { < nl > + if ( a . isAdministrator ( ) & & ! b . isAdministrator ( ) ) { < nl > + return - 1 ; < nl > + } < nl > + if ( b . isAdministrator ( ) & & ! a . isAdministrator ( ) ) { < nl > + return 1 ; < nl > + } < nl > + String an = users ( ) . get ( a . getInviterUid ( ) ) . getName ( ) . get ( ) ; < nl > + String bn = users ( ) . get ( b . getInviterUid ( ) ) . getName ( ) . get ( ) ; < nl > + return an . compareTo ( bn ) ; < nl > + } ) ; < nl > + } < nl > + notifyDataSetInvalidated ( ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > index b3e31eb . . c8890a4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > @ @ - 149 , 6 + 149 , 24 @ @ < nl > < / LinearLayout > < nl > < nl > < LinearLayout < nl > + android : id = " @ + id / membersCont " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : background = " @ drawable / selector " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / members _ tite " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ marginLeft = " 72dp " < nl > + android : gravity = " center _ vertical " < nl > + android : text = " @ string / group _ members _ header " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < LinearLayout < nl > android : id = " @ + id / addMemberCont " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " 48dp " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml < nl > new file mode 100644 < nl > index 0000000 . . 745d3b0 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml < nl > @ @ - 0 , 0 + 1 , 10 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / items " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " / > < nl > + < / FrameLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index f793432 . . 341d922 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 21 , 6 + 21 , 7 @ @ import im . actor . core . entity . AuthRes ; < nl > import im . actor . core . entity . AuthStartRes ; < nl > import im . actor . core . entity . FileReference ; < nl > import im . actor . core . entity . Group ; < nl > + import im . actor . core . entity . GroupMembersSlice ; < nl > import im . actor . core . entity . MentionFilterResult ; < nl > import im . actor . core . entity . MessageSearchEntity ; < nl > import im . actor . core . entity . Peer ; < nl > @ @ - 1524 , 6 + 1525 , 19 @ @ public class Messenger { < nl > } < nl > < nl > / * * < nl > + * Load async members < nl > + * < nl > + * @ param gid group id < nl > + * @ param limit limit of loading < nl > + * @ param next optional cursor of next < nl > + * @ return promise of members slice < nl > + * / < nl > + @ ObjectiveCName ( " loadMembersWithGid : withLimit : withNext : " ) < nl > + public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { < nl > + return modules . getGroupsModule ( ) . loadMembers ( gid , limit , next ) ; < nl > + } < nl > + < nl > + / * * < nl > * Make member admin of group < nl > * < nl > * @ param gid group ' s id < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java < nl > new file mode 100644 < nl > index 0000000 . . b8e0571 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java < nl > @ @ - 0 , 0 + 1 , 22 @ @ < nl > + package im . actor . core . entity ; < nl > + < nl > + import java . util . ArrayList ; < nl > + < nl > + public class GroupMembersSlice { < nl > + < nl > + private ArrayList < Integer > uids ; < nl > + private byte [ ] next ; < nl > + < nl > + public GroupMembersSlice ( ArrayList < Integer > uids , byte [ ] next ) { < nl > + this . uids = uids ; < nl > + this . next = next ; < nl > + } < nl > + < nl > + public ArrayList < Integer > getUids ( ) { < nl > + return uids ; < nl > + } < nl > + < nl > + public byte [ ] getNext ( ) { < nl > + return next ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > index 5fe68cc . . 2b5309f 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > @ @ - 23 , 6 + 23 , 7 @ @ import im . actor . core . api . rpc . RequestInviteUser ; < nl > import im . actor . core . api . rpc . RequestJoinGroup ; < nl > import im . actor . core . api . rpc . RequestKickUser ; < nl > import im . actor . core . api . rpc . RequestLeaveGroup ; < nl > + import im . actor . core . api . rpc . RequestLoadMembers ; < nl > import im . actor . core . api . rpc . RequestMakeUserAdminObsolete ; < nl > import im . actor . core . api . rpc . RequestRevokeIntegrationToken ; < nl > import im . actor . core . api . rpc . RequestRevokeInviteUrl ; < nl > @ @ - 30 , 6 + 31 , 7 @ @ import im . actor . core . api . rpc . RequestTransferOwnership ; < nl > import im . actor . core . api . rpc . ResponseIntegrationToken ; < nl > import im . actor . core . api . rpc . ResponseInviteUrl ; < nl > import im . actor . core . entity . Group ; < nl > + import im . actor . core . entity . GroupMembersSlice ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . PeerType ; < nl > import im . actor . core . entity . User ; < nl > @ @ - 228 , 6 + 230 , 22 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { < nl > . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; < nl > } < nl > < nl > + public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { < nl > + return getGroups ( ) . getValueAsync ( gid ) < nl > + . flatMap ( group - > < nl > + api ( new RequestLoadMembers ( < nl > + new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , < nl > + limit , next ) ) ) < nl > + . chain ( r - > updates ( ) . loadRequiredPeers ( r . getMembers ( ) , new ArrayList < > ( ) ) ) < nl > + . map ( r - > { < nl > + ArrayList < Integer > members = new ArrayList < > ( ) ; < nl > + for ( ApiUserOutPeer p : r . getMembers ( ) ) { < nl > + members . add ( p . getUid ( ) ) ; < nl > + } < nl > + return new GroupMembersSlice ( members , r . getNext ( ) ) ; < nl > + } ) ; < nl > + } < nl > + < nl > public void changeAvatar ( int gid , String descriptor ) { < nl > avatarChangeActor . send ( new GroupAvatarChangeActor . ChangeAvatar ( gid , descriptor ) ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java < nl > index 260cd1e . . 88cf371 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java < nl > @ @ - 223 , 31 + 223 , 34 @ @ public class Promise < T > { < nl > / * * < nl > * Delivering result < nl > * / < nl > - private void deliverResult ( ) { < nl > + protected void deliverResult ( ) { < nl > if ( callbacks . size ( ) > 0 ) { < nl > dispatcher . dispatch ( ( ) - > { < nl > - if ( exception ! = null ) { < nl > - for ( PromiseCallback < T > callback : callbacks ) { < nl > - try { < nl > - callback . onError ( exception ) ; < nl > - } catch ( Exception e ) { < nl > - e . printStackTrace ( ) ; < nl > - } < nl > - } < nl > - } else { < nl > - for ( PromiseCallback < T > callback : callbacks ) { < nl > - try { < nl > - callback . onResult ( result ) ; < nl > - } catch ( Exception e ) { < nl > - e . printStackTrace ( ) ; < nl > - } < nl > - } < nl > - } < nl > - callbacks . clear ( ) ; < nl > + invokeDeliver ( ) ; < nl > } ) ; < nl > } < nl > } < nl > - < nl > + < nl > + protected void invokeDeliver ( ) { < nl > + if ( exception ! = null ) { < nl > + for ( PromiseCallback < T > callback : callbacks ) { < nl > + try { < nl > + callback . onError ( exception ) ; < nl > + } catch ( Exception e ) { < nl > + e . printStackTrace ( ) ; < nl > + } < nl > + } < nl > + } else { < nl > + for ( PromiseCallback < T > callback : callbacks ) { < nl > + try { < nl > + callback . onResult ( result ) ; < nl > + } catch ( Exception e ) { < nl > + e . printStackTrace ( ) ; < nl > + } < nl > + } < nl > + } < nl > + callbacks . clear ( ) ; < nl > + } < nl > < nl > / / < nl > / / Conversions
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java < nl > index 300f863 . . 0c81c46 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java < nl > @ @ - 83 , 6 + 83 , 7 @ @ public class ActorStyle { < nl > private int groupAdminColor = 0 ; < nl > private int groupActionAddIconColor = 0 ; < nl > private int groupActionAddTextColor = 0 ; < nl > + private int groupOnlineColor = Color . parseColor ( " # ff7ea8ef " ) ; < nl > < nl > / / Conversation < nl > private int convSendEnabledColor = 0 ; < nl > @ @ - 847 , 4 + 848 , 12 @ @ public class ActorStyle { < nl > public static int getDarkenArgb ( int color , double percent ) { < nl > return Color . argb ( Color . alpha ( color ) , ( int ) Math . round ( Color . red ( color ) * percent ) , ( int ) Math . round ( Color . green ( color ) * percent ) , ( int ) Math . round ( Color . blue ( color ) * percent ) ) ; < nl > } < nl > + < nl > + public int getGroupOnlineColor ( ) { < nl > + return groupOnlineColor ; < nl > + } < nl > + < nl > + public void setGroupOnlineColor ( int groupOnlineColor ) { < nl > + this . groupOnlineColor = groupOnlineColor ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java < nl > index 8f33068 . . 8ce84b5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java < nl > @ @ - 2 , 7 + 2 , 11 @ @ package im . actor . sdk . controllers . conversation . messages ; < nl > < nl > import android . view . View ; < nl > < nl > + import im . actor . core . viewmodel . UserPresence ; < nl > + import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . controllers . conversation . view . BubbleContainer ; < nl > + import im . actor . sdk . controllers . fragment . ActorBinder ; < nl > import im . actor . sdk . util . Strings ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . core . entity . Message ; < nl > @ @ - 19 , 6 + 23 , 7 @ @ public abstract class MessageHolder extends BindedViewHolder < nl > protected BubbleContainer container ; < nl > private boolean isFullSize ; < nl > protected Message currentMessage ; < nl > + protected ActorBinder . Binding onlineBinding ; < nl > < nl > public MessageHolder ( MessagesAdapter adapter , View itemView , boolean isFullSize ) { < nl > super ( itemView ) ; < nl > @ @ - 36 , 6 + 41 , 10 @ @ public abstract class MessageHolder extends BindedViewHolder < nl > } < nl > } < nl > < nl > + public void setOnline ( boolean online , boolean isBot ) { < nl > + container . setOnline ( online , isBot ) ; < nl > + } < nl > + < nl > public MessagesAdapter getAdapter ( ) { < nl > return adapter ; < nl > } < nl > @ @ - 81 , 8 + 90 , 24 @ @ public abstract class MessageHolder extends BindedViewHolder < nl > / / Updating selection state < nl > container . setBubbleSelected ( adapter . isSelected ( currentMessage ) ) ; < nl > < nl > + / / online < nl > + if ( onlineBinding ! = null ) { < nl > + getAdapter ( ) . getBinder ( ) . unbind ( onlineBinding ) ; < nl > + } < nl > + final UserVM user = users ( ) . get ( message . getSenderId ( ) ) ; < nl > + onlineBinding = getAdapter ( ) . getBinder ( ) . bind ( new ActorBinder . OnChangedListener < Boolean > ( ) { < nl > + @ Override < nl > + public void onChanged ( Boolean online ) { < nl > + setOnline ( online , user . isBot ( ) ) ; < nl > + } < nl > + < nl > + } , user . getPresence ( ) ) ; < nl > + setOnline ( user . getPresence ( ) . get ( ) . getState ( ) . equals ( UserPresence . State . ONLINE ) , user . isBot ( ) ) ; < nl > + < nl > + < nl > / / Bind content < nl > bindData ( message , isUpdated , preprocessedData ) ; < nl > + ActorSDK . sharedActor ( ) . getMessenger ( ) . onUserVisible ( message . getSenderId ( ) ) ; < nl > } < nl > < nl > protected abstract void bindData ( Message message , boolean isUpdated , PreprocessedData preprocessedData ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > index 55880f5 . . b845549 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > @ @ - 18 , 6 + 18 , 7 @ @ import im . actor . core . entity . content . VoiceContent ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > import im . actor . sdk . R ; < nl > import im . actor . runtime . android . view . BindedListAdapter ; < nl > + import im . actor . sdk . controllers . fragment . ActorBinder ; < nl > < nl > public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > < nl > @ @ - 25 , 6 + 26 , 7 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > private Context context ; < nl > private long firstUnread = - 1 ; < nl > protected HashMap < Long , Message > selected = new HashMap < Long , Message > ( ) ; < nl > + private ActorBinder BINDER = new ActorBinder ( ) ; < nl > < nl > public MessagesAdapter ( BindedDisplayList < Message > displayList , < nl > MessagesFragment messagesFragment , Context context ) { < nl > @ @ - 134 , 4 + 136 , 8 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > public void onViewRecycled ( MessageHolder holder ) { < nl > holder . unbind ( ) ; < nl > } < nl > + < nl > + public ActorBinder getBinder ( ) { < nl > + return BINDER ; < nl > + } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java < nl > index 4a59883 . . 766062c 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java < nl > @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . sdk . util . Strings ; < nl > import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . util . Fonts ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . sdk . view . avatar . AvatarViewWithOnline ; < nl > < nl > import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > @ @ - 31 , 7 + 32 , 7 @ @ public class BubbleContainer extends ViewGroup { < nl > private boolean showAvatar ; < nl > private TextView dateDiv ; < nl > private TextView unreadDiv ; < nl > - private AvatarView avatarView ; < nl > + private AvatarViewWithOnline avatarView ; < nl > private int mode = MODE _ FULL ; < nl > private boolean isSelected ; < nl > private OnAvatarClickListener onClickListener ; < nl > @ @ - 101 , 7 + 102 , 7 @ @ public class BubbleContainer extends ViewGroup { < nl > addView ( unreadDiv , new MarginLayoutParams ( LayoutParams . MATCH _ PARENT , LayoutParams . WRAP _ CONTENT ) ) ; < nl > < nl > / / AVATAR < nl > - avatarView = new AvatarView ( getContext ( ) ) ; < nl > + avatarView = new AvatarViewWithOnline ( getContext ( ) ) ; < nl > avatarView . init ( Screen . dp ( 42 ) , 12 ) ; < nl > addView ( avatarView , new MarginLayoutParams ( Screen . dp ( 42 ) , Screen . dp ( 42 ) ) ) ; < nl > } < nl > @ @ - 327 , 4 + 328 , 8 @ @ public class BubbleContainer extends ViewGroup { < nl > public interface OnAvatarLongClickListener { < nl > void onAvatarLongClick ( int uid ) ; < nl > } < nl > + < nl > + public void setOnline ( boolean online , boolean isBot ) { < nl > + avatarView . setOnline ( online , isBot ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java < nl > index a01207e . . de76ed5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java < nl > @ @ - 14 , 6 + 14 , 9 @ @ import im . actor . core . entity . GroupMember ; < nl > import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserPresence ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > + import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > import im . actor . runtime . mvvm . Value ; < nl > @ @ - 119 , 6 + 122 , 51 @ @ public class ActorBinder { < nl > } ) ; < nl > } < nl > < nl > + public Binding bind ( final TextView textView , final UserVM user ) { < nl > + return bind ( user . getPresence ( ) , new ValueChangedListener < UserPresence > ( ) { < nl > + @ Override < nl > + public void onChanged ( UserPresence val , Value < UserPresence > Value ) { < nl > + String s = messenger ( ) . getFormatter ( ) . formatPresence ( val , user . getSex ( ) ) ; < nl > + if ( s = = null ) { < nl > + s = " " ; < nl > + } < nl > + < nl > + if ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { < nl > + textView . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupOnlineColor ( ) ) ; < nl > + s = " \ u25CF " . concat ( s ) ; < nl > + } else { < nl > + textView . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + } < nl > + textView . setText ( s ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + < nl > + public Binding bind ( final View v , ValueModel < UserPresence > up ) { < nl > + return bind ( up , new ValueChangedListener < UserPresence > ( ) { < nl > + < nl > + @ Override < nl > + public void onChanged ( UserPresence val , Value < UserPresence > valueModel ) { < nl > + if ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { < nl > + v . setVisibility ( View . VISIBLE ) ; < nl > + } else { < nl > + v . setVisibility ( View . GONE ) ; < nl > + } < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + public Binding bind ( final OnChangedListener < Boolean > callback , ValueModel < UserPresence > up ) { < nl > + return bind ( up , new ValueChangedListener < UserPresence > ( ) { < nl > + < nl > + @ Override < nl > + public void onChanged ( UserPresence val , Value < UserPresence > valueModel ) { < nl > + callback . onChanged ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > public void bind ( final TextView textView , final View titleContainer , final GroupVM value ) { < nl > bind ( value . getPresence ( ) , value . getMembers ( ) , value . isMember ( ) , new ValueTripleChangedListener < Integer , HashSet < GroupMember > , Boolean > ( ) { < nl > @ Override < nl > @ @ - 171 , 9 + 219 , 11 @ @ public class ActorBinder { < nl > } ) ; < nl > } < nl > < nl > - public < T > void bind ( Value < T > value , ValueChangedListener < T > listener ) { < nl > + public < T > Binding bind ( Value < T > value , ValueChangedListener < T > listener ) { < nl > value . subscribe ( listener ) ; < nl > - bindings . add ( new Binding ( value , listener ) ) ; < nl > + Binding b = new Binding ( value , listener ) ; < nl > + bindings . add ( b ) ; < nl > + return b ; < nl > } < nl > < nl > public < T > void bind ( Value < T > value , boolean notify , ValueChangedListener < T > listener ) { < nl > @ @ - 229 , 11 + 279 , 16 @ @ public class ActorBinder { < nl > bindings . clear ( ) ; < nl > } < nl > < nl > - public interface OnChangedListener { < nl > - void onChanged ( String s ) ; < nl > + public interface OnChangedListener < T > { < nl > + void onChanged ( T val ) ; < nl > + } < nl > + < nl > + public void unbind ( Binding b ) { < nl > + b . unbind ( ) ; < nl > + bindings . remove ( b ) ; < nl > } < nl > < nl > - private class Binding { < nl > + public class Binding { < nl > private Value model ; < nl > private ValueChangedListener listener ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java < nl > index e8f4990 . . 83c474e 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java < nl > @ @ - 152 , 7 + 152 , 7 @ @ public class GroupInfoFragment extends BaseFragment { < nl > themeHeader . setTextColor ( style . getProfileSubtitleColor ( ) ) ; < nl > < nl > final boolean finalIsAdmin = isAdmin ; < nl > - bind ( themeTV , header . findViewById ( R . id . themeContainer ) , groupInfo . getTheme ( ) , new ActorBinder . OnChangedListener ( ) { < nl > + bind ( themeTV , header . findViewById ( R . id . themeContainer ) , groupInfo . getTheme ( ) , new ActorBinder . OnChangedListener < String > ( ) { < nl > @ Override < nl > public void onChanged ( String s ) { < nl > theme [ 0 ] = s ; < nl > @ @ - 162 , 7 + 162 , 7 @ @ public class GroupInfoFragment extends BaseFragment { < nl > < nl > / / bind ( themeHeader , themeHeader , groupInfo . getTheme ( ) ) ; < nl > < nl > - bind ( aboutTV , header . findViewById ( R . id . aboutContainer ) , groupInfo . getAbout ( ) , new ActorBinder . OnChangedListener ( ) { < nl > + bind ( aboutTV , header . findViewById ( R . id . aboutContainer ) , groupInfo . getAbout ( ) , new ActorBinder . OnChangedListener < String > ( ) { < nl > @ Override < nl > public void onChanged ( String s ) { < nl > about [ 0 ] = s ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java < nl > index b217a81 . . a91f3d6 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java < nl > @ @ - 8 , 8 + 8 , 10 @ @ import android . widget . TextView ; < nl > < nl > import java . util . Collection ; < nl > < nl > + import im . actor . core . viewmodel . UserPresence ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . fragment . ActorBinder ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . adapters . HolderAdapter ; < nl > @ @ - 21 , 7 + 23 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > private GroupMember [ ] members ; < nl > - < nl > + private final ActorBinder BINDER = new ActorBinder ( ) ; < nl > public MembersAdapter ( Collection < GroupMember > members , Context context ) { < nl > super ( context ) ; < nl > this . members = members . toArray ( new GroupMember [ 0 ] ) ; < nl > @ @ - 57 , 6 + 59 , 10 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > private TextView userName ; < nl > private View admin ; < nl > private AvatarView avatarView ; < nl > + private TextView online ; < nl > + private TextView lastSeen ; < nl > + private ActorBinder . Binding onlineBinding ; < nl > + private Context context ; < nl > < nl > @ Override < nl > public View init ( GroupMember data , ViewGroup viewGroup , Context context ) { < nl > @ @ - 65 , 20 + 71 , 42 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > avatarView . init ( Screen . dp ( 42 ) , 24 ) ; < nl > admin = res . findViewById ( R . id . adminFlag ) ; < nl > + online = ( TextView ) res . findViewById ( R . id . online ) ; < nl > + lastSeen = ( TextView ) res . findViewById ( R . id . lastSeen ) ; < nl > ( ( TextView ) admin ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupAdminColor ( ) ) ; < nl > ( ( TextView ) res . findViewById ( R . id . name ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > res . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; < nl > + this . context = context ; < nl > return res ; < nl > } < nl > < nl > @ Override < nl > public void bind ( GroupMember data , int position , Context context ) { < nl > + if ( onlineBinding ! = null ) { < nl > + onlineBinding . unbind ( ) ; < nl > + } < nl > + < nl > UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + onlineBinding = BINDER . bind ( online , user ) ; < nl > + ActorSDK . sharedActor ( ) . getMessenger ( ) . onUserVisible ( data . getUid ( ) ) ; < nl > < nl > avatarView . bind ( user ) ; < nl > < nl > userName . setText ( user . getName ( ) . get ( ) ) ; < nl > < nl > + UserPresence presence = user . getPresence ( ) . get ( ) ; < nl > + String s = ActorSDK . sharedActor ( ) . getMessenger ( ) . getFormatter ( ) . formatPresence ( presence , user . getSex ( ) ) ; < nl > + if ( s = = null ) { < nl > + s = " " ; < nl > + } < nl > + if ( presence . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { < nl > + online . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupOnlineColor ( ) ) ; < nl > + s = " \ u25CF " . concat ( s ) ; < nl > + } else { < nl > + online . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + } < nl > + online . setText ( s ) ; < nl > + < nl > if ( data . isAdministrator ( ) ) { < nl > admin . setVisibility ( View . VISIBLE ) ; < nl > } else { < nl > @ @ - 89 , 6 + 117 , 9 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > @ Override < nl > public void unbind ( ) { < nl > avatarView . unbind ( ) ; < nl > + if ( onlineBinding ! = null ) { < nl > + onlineBinding . unbind ( ) ; < nl > + } < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java < nl > new file mode 100644 < nl > index 0000000 . . f211e8f < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java < nl > @ @ - 0 , 0 + 1 , 36 @ @ < nl > + package im . actor . sdk . view ; < nl > + < nl > + import android . graphics . Color ; < nl > + import android . text . TextPaint ; < nl > + import android . text . style . ForegroundColorSpan ; < nl > + < nl > + / * * < nl > + * Created by badgr on 29 . 09 . 2015 . < nl > + * / < nl > + public class OnlineSpan extends ForegroundColorSpan { < nl > + private boolean online = false ; < nl > + private static final int COLOR _ ONLINE = Color . parseColor ( " # 7b95b6 " ) ; < nl > + private static final int COLOR _ OFFLINE = Color . parseColor ( " # 00000000 " ) ; < nl > + < nl > + public OnlineSpan ( int color ) { < nl > + super ( color ) ; < nl > + } < nl > + < nl > + public OnlineSpan ( ) { < nl > + super ( COLOR _ OFFLINE ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getForegroundColor ( ) { < nl > + return online ? COLOR _ ONLINE : COLOR _ OFFLINE ; < nl > + } < nl > + < nl > + @ Override < nl > + public void updateDrawState ( TextPaint ds ) { < nl > + ds . setColor ( getForegroundColor ( ) ) ; < nl > + } < nl > + < nl > + public void setOnline ( boolean online ) { < nl > + this . online = online ; < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java < nl > new file mode 100644 < nl > index 0000000 . . 6844310 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java < nl > @ @ - 0 , 0 + 1 , 68 @ @ < nl > + package im . actor . sdk . view . avatar ; < nl > + < nl > + import android . content . Context ; < nl > + import android . util . AttributeSet ; < nl > + import android . view . Gravity ; < nl > + import android . widget . FrameLayout ; < nl > + import android . widget . ImageView ; < nl > + < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > + import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . util . Screen ; < nl > + < nl > + public class AvatarViewWithOnline extends FrameLayout { < nl > + public static final boolean DRAW _ ONLINES = false ; < nl > + AvatarView avatarView ; < nl > + ImageView online ; < nl > + private boolean isOnline = false ; < nl > + < nl > + public AvatarViewWithOnline ( Context context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + public AvatarViewWithOnline ( Context context , AttributeSet attrs ) { < nl > + super ( context , attrs ) ; < nl > + } < nl > + < nl > + public AvatarViewWithOnline ( Context context , AttributeSet attrs , int defStyleAttr ) { < nl > + super ( context , attrs , defStyleAttr ) ; < nl > + } < nl > + < nl > + < nl > + public void init ( int size , float text ) { < nl > + avatarView = new AvatarView ( getContext ( ) ) ; < nl > + < nl > + avatarView . init ( size , text ) ; < nl > + addView ( avatarView ) ; < nl > + < nl > + online = new ImageView ( getContext ( ) ) ; < nl > + online . setImageResource ( R . drawable . indicator _ offline ) ; < nl > + addView ( online , new LayoutParams ( Screen . dp ( 11 ) , Screen . dp ( 11 ) , Gravity . RIGHT | Gravity . BOTTOM ) ) ; < nl > + } < nl > + < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + < nl > + public void bind ( UserVM u ) { < nl > + avatarView . bind ( u ) ; < nl > + } < nl > + < nl > + public void bind ( GroupVM g ) { < nl > + avatarView . bind ( g ) ; < nl > + } < nl > + < nl > + public void setOnline ( boolean online , boolean isBot ) { < nl > + if ( ! isBot & & DRAW _ ONLINES ) { < nl > + this . online . setVisibility ( VISIBLE ) ; < nl > + if ( isOnline ! = online ) { < nl > + isOnline = online ; < nl > + this . online . setImageResource ( isOnline ? R . drawable . indicator _ online : R . drawable . indicator _ offline ) ; < nl > + } < nl > + } else { < nl > + this . online . setVisibility ( INVISIBLE ) ; < nl > + } < nl > + < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml < nl > new file mode 100644 < nl > index 0000000 . . 4c6a88d < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml < nl > @ @ - 0 , 0 + 1 , 8 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ color / conv _ offline " / > < nl > + < stroke < nl > + android : width = " 2dp " < nl > + android : color = " @ android : color / white " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml < nl > new file mode 100644 < nl > index 0000000 . . a273657 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml < nl > @ @ - 0 , 0 + 1 , 8 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ color / conv _ online " / > < nl > + < stroke < nl > + android : width = " 2dp " < nl > + android : color = " @ android : color / white " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml < nl > index 9ac19c4 . . d9b18e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml < nl > @ @ - 27 , 18 + 27 , 33 @ @ < nl > android : layout _ gravity = " center " / > < nl > < / FrameLayout > < nl > < nl > - < TextView < nl > - android : id = " @ + id / name " < nl > + < LinearLayout < nl > android : layout _ width = " 0dp " < nl > - android : layout _ height = " match _ parent " < nl > android : layout _ weight = " 1 " < nl > - android : ellipsize = " end " < nl > + android : orientation = " vertical " < nl > android : gravity = " center _ vertical " < nl > - android : lines = " 1 " < nl > - android : paddingRight = " 8dp " < nl > - android : singleLine = " true " < nl > - android : textSize = " 16sp " / > < nl > + android : layout _ height = " match _ parent " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > < nl > + < TextView < nl > + android : id = " @ + id / online " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : ellipsize = " end " < nl > + android : text = " @ string / online " < nl > + android : gravity = " center _ vertical " < nl > + android : textColor = " @ color / conv _ online " / > < nl > + < / LinearLayout > < nl > < TextView < nl > android : id = " @ + id / adminFlag " < nl > android : layout _ width = " wrap _ content " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 1222ffe . . 3c3350b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 248 , 7 + 248 , 7 @ @ < nl > < string name = " group _ members _ header " >          < / string > < nl > < string name = " group _ members _ count " > { 0 }   { 1 } < / string > < nl > < nl > - < string name = " group _ admin " >      .       < / string > < nl > + < string name = " group _ admin " >      . < / string > < nl > < nl > < string name = " group _ created _ by " >       { 0 } < / string > < nl > < string name = " group _ created _ by _ you " >           < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml < nl > index 7ae9517 . . b98ac94 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml < nl > @ @ - 151 , 5 + 151 , 7 @ @ < nl > < color name = " default _ circle _ indicator _ stroke _ color " > # FFDDDDDD < / color > < nl > < dimen name = " default _ circle _ indicator _ stroke _ width " > 1dp < / dimen > < nl > < nl > + < color name = " conv _ offline " > @ android : color / darker _ gray < / color > < nl > + < color name = " conv _ online " > # ff7ea8ef < / color > < nl > < nl > < / resources > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 8366189 . . 2270a93 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 225 , 6 + 225 , 7 @ @ < nl > < string name = " chat _ not _ member " > You is not member of this group < / string > < nl > < nl > < string name = " chat _ unsupported " > Message is unsupported in this version . Please , wait for application update to see message . < / string > < nl > + < string name = " online " > \ u25CF online < / string > < nl > < nl > < ! - - Profile - - > < nl > < string name = " profile _ title " > Profile < / string >

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 index 799a9be . . dffc160 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 @ @ - 146 , 6 + 146 , 12 @ @ 
 android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 
 < activity 
 + android : name = " . controllers . group . MembersActivity " 
 + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 + android : theme = " @ style / CommonActivityTheme " 
 + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 + 
 + < activity 
 android : name = " . controllers . settings . MyProfileActivity " 
 android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 android : theme = " @ style / ProfileActivityTheme " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index 4e8ca9c . . 3ba0c44 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 865 , 9 + 865 , 7 @ @ public class ActorSDK { 
 public void startGroupInfoActivity ( Context context , int gid ) { 
 Bundle b = new Bundle ( ) ; 
 b . putInt ( Intents . EXTRA _ GROUP _ ID , gid ) ; 
 - if ( ! startDelegateActivity ( context , delegate . getGroupInfoIntent ( gid ) , b ) ) { 
 - startActivity ( context , b , GroupInfoActivity . class ) ; 
 - } 
 + startActivity ( context , b , GroupInfoActivity . class ) ; 
 } 
 
 / * * 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index 7df3d6d . . 2f964b7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 58 , 6 + 58 , 13 @ @ public interface ActorSDKDelegate { 
 @ Nullable 
 Fragment fragmentForProfile ( int uid ) ; 
 
 + / * * 
 + * If not null returned , overrides group info fragment 
 + * 
 + * @ return Actor Intent 
 + * / 
 + Fragment fragmentForGroupInfo ( int gid ) ; 
 + 
 
 / / 
 / / Chat 
 @ @ - 115 , 12 + 122 , 6 @ @ public interface ActorSDKDelegate { 
 * / 
 ActorIntentFragmentActivity getSettingsIntent ( ) ; 
 
 - / * * 
 - * If not null returned , overrides group info activity intent 
 - * 
 - * @ return Actor Intent 
 - * / 
 - BaseGroupInfoActivity getGroupInfoIntent ( int gid ) ; 
 
 / * * 
 * If not null returned , overrides settings activity intent 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index f5a9d3d . . 076aa50 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 49 , 28 + 49 , 28 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 return null ; 
 } 
 
 - @ Nullable 
 @ Override 
 - public AbsAttachFragment fragmentForAttachMenu ( Peer peer ) { 
 + public Fragment fragmentForGroupInfo ( int gid ) { 
 return null ; 
 } 
 
 @ Nullable 
 @ Override 
 - public Fragment fragmentForToolbar ( Peer peer ) { 
 + public AbsAttachFragment fragmentForAttachMenu ( Peer peer ) { 
 return null ; 
 } 
 
 + @ Nullable 
 @ Override 
 - public ActorIntentFragmentActivity getSettingsIntent ( ) { 
 + public Fragment fragmentForToolbar ( Peer peer ) { 
 return null ; 
 } 
 
 @ Override 
 - public BaseGroupInfoActivity getGroupInfoIntent ( int gid ) { 
 + public ActorIntentFragmentActivity getSettingsIntent ( ) { 
 return null ; 
 } 
 - 
 + 
 @ Override 
 public ActorIntentFragmentActivity getChatSettingsIntent ( ) { 
 return null ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java 
 index 7eff038 . . 4f82c34 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / BaseFragment . java 
 @ @ - 14 , 10 + 14 , 17 @ @ import android . view . ViewGroup ; 
 import android . widget . ImageView ; 
 import android . widget . TextView ; 
 
 + import org . jetbrains . annotations . NotNull ; 
 + 
 + import java . util . ArrayList ; 
 + 
 import im . actor . core . viewmodel . Command ; 
 import im . actor . core . viewmodel . CommandCallback ; 
 import im . actor . runtime . function . Consumer ; 
 + import im . actor . runtime . function . Function ; 
 import im . actor . runtime . promise . Promise ; 
 + import im . actor . runtime . promise . PromiseFunc ; 
 + import im . actor . runtime . promise . PromiseResolver ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorStyle ; 
 import im . actor . sdk . R ; 
 @ @ - 36 , 6 + 43 , 8 @ @ public class BaseFragment extends BinderCompatFragment { 
 private boolean showHome = false ; 
 private boolean showCustom = false ; 
 
 + private ArrayList < WrappedPromise > pending = new ArrayList < > ( ) ; 
 + 
 public boolean isRootFragment ( ) { 
 return isRootFragment ; 
 } 
 @ @ - 403 , 4 + 412 , 42 @ @ public class BaseFragment extends BinderCompatFragment { 
 } 
 return null ; 
 } 
 + 
 + protected < T > Promise < T > wrap ( Promise < T > p ) { 
 + WrappedPromise < T > res = new WrappedPromise < > ( ( PromiseFunc < T > ) resolver - > p . pipeTo ( resolver ) ) ; 
 + pending . add ( res ) ; 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void onPause ( ) { 
 + super . onPause ( ) ; 
 + 
 + for ( WrappedPromise w : pending ) { 
 + w . kill ( ) ; 
 + } 
 + pending . clear ( ) ; 
 + } 
 + 
 + 
 + private class WrappedPromise < T > extends Promise < T > { 
 + 
 + private boolean isKilled ; 
 + 
 + public WrappedPromise ( PromiseFunc < T > executor ) { 
 + super ( executor ) ; 
 + } 
 + 
 + public void kill ( ) { 
 + isKilled = true ; 
 + } 
 + 
 + @ Override 
 + protected void invokeDeliver ( ) { 
 + if ( isKilled ) { 
 + return ; 
 + } 
 + super . invokeDeliver ( ) ; 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 index 5764a2a . . 643b213 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 @ @ - 1 , 33 + 1 , 25 @ @ 
 package im . actor . sdk . controllers . group ; 
 
 - import android . graphics . Color ; 
 - import android . graphics . drawable . ColorDrawable ; 
 import android . os . Bundle ; 
 + import android . support . v4 . app . Fragment ; 
 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 - import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; 
 
 public class GroupInfoActivity extends BaseFragmentActivity { 
 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 - 
 - 
 - 
 + 
 if ( savedInstanceState = = null ) { 
 - GroupInfoFragment fragment ; 
 - BaseGroupInfoActivity profileIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . getGroupInfoIntent ( chatId ) ; 
 - if ( profileIntent ! = null ) { 
 - fragment = profileIntent . getGroupInfoFragment ( chatId ) ; 
 - } else { 
 - fragment = GroupInfoFragment . create ( chatId ) ; 
 + int groupId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 + Fragment profileIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForGroupInfo ( groupId ) ; 
 + if ( profileIntent = = null ) { 
 + profileIntent = GroupInfoFragment . create ( groupId ) ; 
 } 
 - 
 - showFragment ( fragment , false , false ) ; 
 + showFragment ( profileIntent , false , false ) ; 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 index efd92dc . . a43568d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 @ @ - 24 , 6 + 24 , 7 @ @ import com . google . i18n . phonenumbers . PhoneNumberUtil ; 
 import com . google . i18n . phonenumbers . Phonenumber ; 
 
 import java . util . ArrayList ; 
 + import java . util . HashSet ; 
 
 import im . actor . core . entity . GroupMember ; 
 import im . actor . core . entity . GroupType ; 
 @ @ - 33 , 6 + 34 , 8 @ @ import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserPhone ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . actors . messages . Void ; 
 + import im . actor . runtime . mvvm . Value ; 
 + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; 
 import im . actor . runtime . mvvm . ValueListener ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKLauncher ; 
 @ @ - 115 , 6 + 118 , 7 @ @ public class GroupInfoFragment extends BaseFragment { 
 TextView aboutTV = ( TextView ) header . findViewById ( R . id . about ) ; 
 View aboutCont = header . findViewById ( R . id . aboutContainer ) ; 
 View addMemberCont = header . findViewById ( R . id . addMemberCont ) ; 
 + View membersCont = header . findViewById ( R . id . membersCont ) ; 
 View leaveCont = header . findViewById ( R . id . leaveChannelCont ) ; 
 
 TextView title = ( TextView ) header . findViewById ( R . id . title ) ; 
 @ @ - 142 , 6 + 146 , 8 @ @ public class GroupInfoFragment extends BaseFragment { 
 . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 ( ( TextView ) header . findViewById ( R . id . add _ member _ title ) ) 
 . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 + ( ( TextView ) header . findViewById ( R . id . members _ tite ) ) 
 + . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 ( ( TextView ) header . findViewById ( R . id . leave _ channel _ title ) ) 
 . setTextColor ( style . getTextDangerColor ( ) ) ; 
 
 @ @ - 242 , 19 + 248 , 26 @ @ public class GroupInfoFragment extends BaseFragment { 
 
 / / Members 
 
 - bind ( groupVM . getIsCanViewMembers ( ) , canViewMembers - > { 
 + bind ( groupVM . getIsCanViewMembers ( ) , groupVM . getIsAsyncMembers ( ) , ( canViewMembers , vm1 , isAsync , vm2 ) - > { 
 if ( canViewMembers ) { 
 - header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . VISIBLE ) ; 
 - / / header . findViewById ( R . id . membersHeader ) . setVisibility ( View . VISIBLE ) ; 
 + if ( isAsync ) { 
 + membersCont . setVisibility ( View . VISIBLE ) ; 
 + header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . GONE ) ; 
 + } else { 
 + membersCont . setVisibility ( View . GONE ) ; 
 + header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . VISIBLE ) ; 
 + } 
 } else { 
 header . findViewById ( R . id . after _ settings _ divider ) . setVisibility ( View . GONE ) ; 
 - / / header . findViewById ( R . id . membersHeader ) . setVisibility ( View . GONE ) ; 
 } 
 } ) ; 
 + membersCont . setOnClickListener ( view - > { 
 + startActivity ( new Intent ( getContext ( ) , MembersActivity . class ) 
 + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; 
 + } ) ; 
 
 listView . addHeaderView ( header , null , false ) ; 
 
 - 
 / / 
 / / Footer 
 / / 
 @ @ - 284 , 8 + 297 , 12 @ @ public class GroupInfoFragment extends BaseFragment { 
 / / 
 
 groupUserAdapter = new MembersAdapter ( getActivity ( ) ) ; 
 - bind ( groupVM . getMembers ( ) , members - > { 
 - groupUserAdapter . setMembers ( members ) ; 
 + bind ( groupVM . getIsAsyncMembers ( ) , groupVM . getMembers ( ) , ( isAsyncMembers , valueModel , members , valueModel2 ) - > { 
 + if ( isAsyncMembers ) { 
 + groupUserAdapter . setMembers ( new ArrayList < > ( ) ) ; 
 + } else { 
 + groupUserAdapter . setMembers ( members ) ; 
 + } 
 } ) ; 
 listView . setAdapter ( groupUserAdapter ) ; 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java 
 new file mode 100644 
 index 0000000 . . b5d1278 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersActivity . java 
 @ @ - 0 , 0 + 1 , 18 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . os . Bundle ; 
 + 
 + import im . actor . sdk . controllers . Intents ; 
 + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + 
 + public class MembersActivity extends BaseFragmentActivity { 
 + @ Override 
 + protected void onCreate ( Bundle savedInstanceState ) { 
 + super . onCreate ( savedInstanceState ) ; 
 + 
 + if ( savedInstanceState = = null ) { 
 + int groupId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 + showFragment ( MembersFragment . create ( groupId ) , false , false ) ; 
 + } 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java 
 new file mode 100644 
 index 0000000 . . 8e47223 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java 
 @ @ - 0 , 0 + 1 , 78 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . os . Bundle ; 
 + import android . support . annotation . Nullable ; 
 + import android . view . LayoutInflater ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . widget . ListView ; 
 + 
 + import java . util . ArrayList ; 
 + 
 + import im . actor . core . entity . GroupMember ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . BaseFragment ; 
 + import im . actor . sdk . controllers . group . view . MembersAdapter ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 + public class MembersFragment extends BaseFragment { 
 + 
 + public static MembersFragment create ( int groupId ) { 
 + MembersFragment res = new MembersFragment ( ) ; 
 + Bundle args = new Bundle ( ) ; 
 + args . putInt ( " groupId " , groupId ) ; 
 + res . setArguments ( args ) ; 
 + return res ; 
 + } 
 + 
 + private static final int LIMIT = 20 ; 
 + 
 + private int groupId ; 
 + private boolean isInitiallyLoaded ; 
 + private byte [ ] nextMembers ; 
 + private ArrayList < Integer > members = new ArrayList < > ( ) ; 
 + private MembersAdapter adapter ; 
 + 
 + public MembersFragment ( ) { 
 + setRootFragment ( true ) ; 
 + setTitle ( R . string . group _ members _ header ) ; 
 + setHomeAsUp ( true ) ; 
 + setShowHome ( true ) ; 
 + } 
 + 
 + @ Override 
 + public void onCreate ( Bundle saveInstance ) { 
 + super . onCreate ( saveInstance ) ; 
 + 
 + groupId = getArguments ( ) . getInt ( " groupId " ) ; 
 + } 
 + 
 + @ Nullable 
 + @ Override 
 + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { 
 + View res = inflater . inflate ( R . layout . fragment _ members , container , false ) ; 
 + adapter = new MembersAdapter ( getContext ( ) ) ; 
 + 
 + ( ( ListView ) res . findViewById ( R . id . items ) ) . setAdapter ( adapter ) ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void onResume ( ) { 
 + super . onResume ( ) ; 
 + if ( ! isInitiallyLoaded ) { 
 + wrap ( messenger ( ) . loadMembers ( groupId , LIMIT , nextMembers ) ) . then ( groupMembersSlice - > { 
 + isInitiallyLoaded = true ; 
 + members . addAll ( groupMembersSlice . getUids ( ) ) ; 
 + nextMembers = groupMembersSlice . getNext ( ) ; 
 + ArrayList < GroupMember > nMembers = new ArrayList < > ( ) ; 
 + for ( Integer uid : members ) { 
 + nMembers . add ( new GroupMember ( uid , 0 , 0 , false ) ) ; 
 + } 
 + adapter . setMembers ( nMembers , false ) ; 
 + } ) ; 
 + } 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 index a118032 . . 6697651 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 @ @ - 32 , 19 + 32 , 25 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 } 
 
 public void setMembers ( Collection < GroupMember > members ) { 
 + setMembers ( members , true ) ; 
 + } 
 + 
 + public void setMembers ( Collection < GroupMember > members , boolean sort ) { 
 this . members = members . toArray ( new GroupMember [ members . size ( ) ] ) ; 
 - Arrays . sort ( this . members , ( a , b ) - > { 
 - if ( a . isAdministrator ( ) & & ! b . isAdministrator ( ) ) { 
 - return - 1 ; 
 - } 
 - if ( b . isAdministrator ( ) & & ! a . isAdministrator ( ) ) { 
 - return 1 ; 
 - } 
 - String an = users ( ) . get ( a . getInviterUid ( ) ) . getName ( ) . get ( ) ; 
 - String bn = users ( ) . get ( b . getInviterUid ( ) ) . getName ( ) . get ( ) ; 
 - return an . compareTo ( bn ) ; 
 - } ) ; 
 - notifyDataSetChanged ( ) ; 
 + if ( sort ) { 
 + Arrays . sort ( this . members , ( a , b ) - > { 
 + if ( a . isAdministrator ( ) & & ! b . isAdministrator ( ) ) { 
 + return - 1 ; 
 + } 
 + if ( b . isAdministrator ( ) & & ! a . isAdministrator ( ) ) { 
 + return 1 ; 
 + } 
 + String an = users ( ) . get ( a . getInviterUid ( ) ) . getName ( ) . get ( ) ; 
 + String bn = users ( ) . get ( b . getInviterUid ( ) ) . getName ( ) . get ( ) ; 
 + return an . compareTo ( bn ) ; 
 + } ) ; 
 + } 
 + notifyDataSetInvalidated ( ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 index b3e31eb . . c8890a4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 @ @ - 149 , 6 + 149 , 24 @ @ 
 < / LinearLayout > 
 
 < LinearLayout 
 + android : id = " @ + id / membersCont " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : background = " @ drawable / selector " 
 + android : paddingRight = " 8dp " > 
 + 
 + < TextView 
 + android : id = " @ + id / members _ tite " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ marginLeft = " 72dp " 
 + android : gravity = " center _ vertical " 
 + android : text = " @ string / group _ members _ header " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < LinearLayout 
 android : id = " @ + id / addMemberCont " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " 48dp " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml 
 new file mode 100644 
 index 0000000 . . 745d3b0 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml 
 @ @ - 0 , 0 + 1 , 10 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " > 
 + 
 + < ListView 
 + android : id = " @ + id / items " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " / > 
 + < / FrameLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index f793432 . . 341d922 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 21 , 6 + 21 , 7 @ @ import im . actor . core . entity . AuthRes ; 
 import im . actor . core . entity . AuthStartRes ; 
 import im . actor . core . entity . FileReference ; 
 import im . actor . core . entity . Group ; 
 + import im . actor . core . entity . GroupMembersSlice ; 
 import im . actor . core . entity . MentionFilterResult ; 
 import im . actor . core . entity . MessageSearchEntity ; 
 import im . actor . core . entity . Peer ; 
 @ @ - 1524 , 6 + 1525 , 19 @ @ public class Messenger { 
 } 
 
 / * * 
 + * Load async members 
 + * 
 + * @ param gid group id 
 + * @ param limit limit of loading 
 + * @ param next optional cursor of next 
 + * @ return promise of members slice 
 + * / 
 + @ ObjectiveCName ( " loadMembersWithGid : withLimit : withNext : " ) 
 + public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { 
 + return modules . getGroupsModule ( ) . loadMembers ( gid , limit , next ) ; 
 + } 
 + 
 + / * * 
 * Make member admin of group 
 * 
 * @ param gid group ' s id 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java 
 new file mode 100644 
 index 0000000 . . b8e0571 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupMembersSlice . java 
 @ @ - 0 , 0 + 1 , 22 @ @ 
 + package im . actor . core . entity ; 
 + 
 + import java . util . ArrayList ; 
 + 
 + public class GroupMembersSlice { 
 + 
 + private ArrayList < Integer > uids ; 
 + private byte [ ] next ; 
 + 
 + public GroupMembersSlice ( ArrayList < Integer > uids , byte [ ] next ) { 
 + this . uids = uids ; 
 + this . next = next ; 
 + } 
 + 
 + public ArrayList < Integer > getUids ( ) { 
 + return uids ; 
 + } 
 + 
 + public byte [ ] getNext ( ) { 
 + return next ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 index 5fe68cc . . 2b5309f 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 @ @ - 23 , 6 + 23 , 7 @ @ import im . actor . core . api . rpc . RequestInviteUser ; 
 import im . actor . core . api . rpc . RequestJoinGroup ; 
 import im . actor . core . api . rpc . RequestKickUser ; 
 import im . actor . core . api . rpc . RequestLeaveGroup ; 
 + import im . actor . core . api . rpc . RequestLoadMembers ; 
 import im . actor . core . api . rpc . RequestMakeUserAdminObsolete ; 
 import im . actor . core . api . rpc . RequestRevokeIntegrationToken ; 
 import im . actor . core . api . rpc . RequestRevokeInviteUrl ; 
 @ @ - 30 , 6 + 31 , 7 @ @ import im . actor . core . api . rpc . RequestTransferOwnership ; 
 import im . actor . core . api . rpc . ResponseIntegrationToken ; 
 import im . actor . core . api . rpc . ResponseInviteUrl ; 
 import im . actor . core . entity . Group ; 
 + import im . actor . core . entity . GroupMembersSlice ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . PeerType ; 
 import im . actor . core . entity . User ; 
 @ @ - 228 , 6 + 230 , 22 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { 
 . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; 
 } 
 
 + public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { 
 + return getGroups ( ) . getValueAsync ( gid ) 
 + . flatMap ( group - > 
 + api ( new RequestLoadMembers ( 
 + new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , 
 + limit , next ) ) ) 
 + . chain ( r - > updates ( ) . loadRequiredPeers ( r . getMembers ( ) , new ArrayList < > ( ) ) ) 
 + . map ( r - > { 
 + ArrayList < Integer > members = new ArrayList < > ( ) ; 
 + for ( ApiUserOutPeer p : r . getMembers ( ) ) { 
 + members . add ( p . getUid ( ) ) ; 
 + } 
 + return new GroupMembersSlice ( members , r . getNext ( ) ) ; 
 + } ) ; 
 + } 
 + 
 public void changeAvatar ( int gid , String descriptor ) { 
 avatarChangeActor . send ( new GroupAvatarChangeActor . ChangeAvatar ( gid , descriptor ) ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java 
 index 260cd1e . . 88cf371 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / promise / Promise . java 
 @ @ - 223 , 31 + 223 , 34 @ @ public class Promise < T > { 
 / * * 
 * Delivering result 
 * / 
 - private void deliverResult ( ) { 
 + protected void deliverResult ( ) { 
 if ( callbacks . size ( ) > 0 ) { 
 dispatcher . dispatch ( ( ) - > { 
 - if ( exception ! = null ) { 
 - for ( PromiseCallback < T > callback : callbacks ) { 
 - try { 
 - callback . onError ( exception ) ; 
 - } catch ( Exception e ) { 
 - e . printStackTrace ( ) ; 
 - } 
 - } 
 - } else { 
 - for ( PromiseCallback < T > callback : callbacks ) { 
 - try { 
 - callback . onResult ( result ) ; 
 - } catch ( Exception e ) { 
 - e . printStackTrace ( ) ; 
 - } 
 - } 
 - } 
 - callbacks . clear ( ) ; 
 + invokeDeliver ( ) ; 
 } ) ; 
 } 
 } 
 - 
 + 
 + protected void invokeDeliver ( ) { 
 + if ( exception ! = null ) { 
 + for ( PromiseCallback < T > callback : callbacks ) { 
 + try { 
 + callback . onError ( exception ) ; 
 + } catch ( Exception e ) { 
 + e . printStackTrace ( ) ; 
 + } 
 + } 
 + } else { 
 + for ( PromiseCallback < T > callback : callbacks ) { 
 + try { 
 + callback . onResult ( result ) ; 
 + } catch ( Exception e ) { 
 + e . printStackTrace ( ) ; 
 + } 
 + } 
 + } 
 + callbacks . clear ( ) ; 
 + } 
 
 / / 
 / / Conversions

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java 
 index 300f863 . . 0c81c46 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorStyle . java 
 @ @ - 83 , 6 + 83 , 7 @ @ public class ActorStyle { 
 private int groupAdminColor = 0 ; 
 private int groupActionAddIconColor = 0 ; 
 private int groupActionAddTextColor = 0 ; 
 + private int groupOnlineColor = Color . parseColor ( " # ff7ea8ef " ) ; 
 
 / / Conversation 
 private int convSendEnabledColor = 0 ; 
 @ @ - 847 , 4 + 848 , 12 @ @ public class ActorStyle { 
 public static int getDarkenArgb ( int color , double percent ) { 
 return Color . argb ( Color . alpha ( color ) , ( int ) Math . round ( Color . red ( color ) * percent ) , ( int ) Math . round ( Color . green ( color ) * percent ) , ( int ) Math . round ( Color . blue ( color ) * percent ) ) ; 
 } 
 + 
 + public int getGroupOnlineColor ( ) { 
 + return groupOnlineColor ; 
 + } 
 + 
 + public void setGroupOnlineColor ( int groupOnlineColor ) { 
 + this . groupOnlineColor = groupOnlineColor ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java 
 index 8f33068 . . 8ce84b5 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessageHolder . java 
 @ @ - 2 , 7 + 2 , 11 @ @ package im . actor . sdk . controllers . conversation . messages ; 
 
 import android . view . View ; 
 
 + import im . actor . core . viewmodel . UserPresence ; 
 + import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . controllers . conversation . view . BubbleContainer ; 
 + import im . actor . sdk . controllers . fragment . ActorBinder ; 
 import im . actor . sdk . util . Strings ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . core . entity . Message ; 
 @ @ - 19 , 6 + 23 , 7 @ @ public abstract class MessageHolder extends BindedViewHolder 
 protected BubbleContainer container ; 
 private boolean isFullSize ; 
 protected Message currentMessage ; 
 + protected ActorBinder . Binding onlineBinding ; 
 
 public MessageHolder ( MessagesAdapter adapter , View itemView , boolean isFullSize ) { 
 super ( itemView ) ; 
 @ @ - 36 , 6 + 41 , 10 @ @ public abstract class MessageHolder extends BindedViewHolder 
 } 
 } 
 
 + public void setOnline ( boolean online , boolean isBot ) { 
 + container . setOnline ( online , isBot ) ; 
 + } 
 + 
 public MessagesAdapter getAdapter ( ) { 
 return adapter ; 
 } 
 @ @ - 81 , 8 + 90 , 24 @ @ public abstract class MessageHolder extends BindedViewHolder 
 / / Updating selection state 
 container . setBubbleSelected ( adapter . isSelected ( currentMessage ) ) ; 
 
 + / / online 
 + if ( onlineBinding ! = null ) { 
 + getAdapter ( ) . getBinder ( ) . unbind ( onlineBinding ) ; 
 + } 
 + final UserVM user = users ( ) . get ( message . getSenderId ( ) ) ; 
 + onlineBinding = getAdapter ( ) . getBinder ( ) . bind ( new ActorBinder . OnChangedListener < Boolean > ( ) { 
 + @ Override 
 + public void onChanged ( Boolean online ) { 
 + setOnline ( online , user . isBot ( ) ) ; 
 + } 
 + 
 + } , user . getPresence ( ) ) ; 
 + setOnline ( user . getPresence ( ) . get ( ) . getState ( ) . equals ( UserPresence . State . ONLINE ) , user . isBot ( ) ) ; 
 + 
 + 
 / / Bind content 
 bindData ( message , isUpdated , preprocessedData ) ; 
 + ActorSDK . sharedActor ( ) . getMessenger ( ) . onUserVisible ( message . getSenderId ( ) ) ; 
 } 
 
 protected abstract void bindData ( Message message , boolean isUpdated , PreprocessedData preprocessedData ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 index 55880f5 . . b845549 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 @ @ - 18 , 6 + 18 , 7 @ @ import im . actor . core . entity . content . VoiceContent ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 import im . actor . sdk . R ; 
 import im . actor . runtime . android . view . BindedListAdapter ; 
 + import im . actor . sdk . controllers . fragment . ActorBinder ; 
 
 public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 
 @ @ - 25 , 6 + 26 , 7 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 private Context context ; 
 private long firstUnread = - 1 ; 
 protected HashMap < Long , Message > selected = new HashMap < Long , Message > ( ) ; 
 + private ActorBinder BINDER = new ActorBinder ( ) ; 
 
 public MessagesAdapter ( BindedDisplayList < Message > displayList , 
 MessagesFragment messagesFragment , Context context ) { 
 @ @ - 134 , 4 + 136 , 8 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 public void onViewRecycled ( MessageHolder holder ) { 
 holder . unbind ( ) ; 
 } 
 + 
 + public ActorBinder getBinder ( ) { 
 + return BINDER ; 
 + } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java 
 index 4a59883 . . 766062c 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / BubbleContainer . java 
 @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . sdk . util . Strings ; 
 import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . util . Fonts ; 
 import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . sdk . view . avatar . AvatarViewWithOnline ; 
 
 import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 @ @ - 31 , 7 + 32 , 7 @ @ public class BubbleContainer extends ViewGroup { 
 private boolean showAvatar ; 
 private TextView dateDiv ; 
 private TextView unreadDiv ; 
 - private AvatarView avatarView ; 
 + private AvatarViewWithOnline avatarView ; 
 private int mode = MODE _ FULL ; 
 private boolean isSelected ; 
 private OnAvatarClickListener onClickListener ; 
 @ @ - 101 , 7 + 102 , 7 @ @ public class BubbleContainer extends ViewGroup { 
 addView ( unreadDiv , new MarginLayoutParams ( LayoutParams . MATCH _ PARENT , LayoutParams . WRAP _ CONTENT ) ) ; 
 
 / / AVATAR 
 - avatarView = new AvatarView ( getContext ( ) ) ; 
 + avatarView = new AvatarViewWithOnline ( getContext ( ) ) ; 
 avatarView . init ( Screen . dp ( 42 ) , 12 ) ; 
 addView ( avatarView , new MarginLayoutParams ( Screen . dp ( 42 ) , Screen . dp ( 42 ) ) ) ; 
 } 
 @ @ - 327 , 4 + 328 , 8 @ @ public class BubbleContainer extends ViewGroup { 
 public interface OnAvatarLongClickListener { 
 void onAvatarLongClick ( int uid ) ; 
 } 
 + 
 + public void setOnline ( boolean online , boolean isBot ) { 
 + avatarView . setOnline ( online , isBot ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java 
 index a01207e . . de76ed5 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / ActorBinder . java 
 @ @ - 14 , 6 + 14 , 9 @ @ import im . actor . core . entity . GroupMember ; 
 import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserPresence ; 
 import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 + import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 import im . actor . runtime . mvvm . Value ; 
 @ @ - 119 , 6 + 122 , 51 @ @ public class ActorBinder { 
 } ) ; 
 } 
 
 + public Binding bind ( final TextView textView , final UserVM user ) { 
 + return bind ( user . getPresence ( ) , new ValueChangedListener < UserPresence > ( ) { 
 + @ Override 
 + public void onChanged ( UserPresence val , Value < UserPresence > Value ) { 
 + String s = messenger ( ) . getFormatter ( ) . formatPresence ( val , user . getSex ( ) ) ; 
 + if ( s = = null ) { 
 + s = " " ; 
 + } 
 + 
 + if ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { 
 + textView . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupOnlineColor ( ) ) ; 
 + s = " \ u25CF " . concat ( s ) ; 
 + } else { 
 + textView . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + } 
 + textView . setText ( s ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + 
 + public Binding bind ( final View v , ValueModel < UserPresence > up ) { 
 + return bind ( up , new ValueChangedListener < UserPresence > ( ) { 
 + 
 + @ Override 
 + public void onChanged ( UserPresence val , Value < UserPresence > valueModel ) { 
 + if ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { 
 + v . setVisibility ( View . VISIBLE ) ; 
 + } else { 
 + v . setVisibility ( View . GONE ) ; 
 + } 
 + } 
 + } ) ; 
 + } 
 + 
 + public Binding bind ( final OnChangedListener < Boolean > callback , ValueModel < UserPresence > up ) { 
 + return bind ( up , new ValueChangedListener < UserPresence > ( ) { 
 + 
 + @ Override 
 + public void onChanged ( UserPresence val , Value < UserPresence > valueModel ) { 
 + callback . onChanged ( val . getState ( ) . equals ( UserPresence . State . ONLINE ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 public void bind ( final TextView textView , final View titleContainer , final GroupVM value ) { 
 bind ( value . getPresence ( ) , value . getMembers ( ) , value . isMember ( ) , new ValueTripleChangedListener < Integer , HashSet < GroupMember > , Boolean > ( ) { 
 @ Override 
 @ @ - 171 , 9 + 219 , 11 @ @ public class ActorBinder { 
 } ) ; 
 } 
 
 - public < T > void bind ( Value < T > value , ValueChangedListener < T > listener ) { 
 + public < T > Binding bind ( Value < T > value , ValueChangedListener < T > listener ) { 
 value . subscribe ( listener ) ; 
 - bindings . add ( new Binding ( value , listener ) ) ; 
 + Binding b = new Binding ( value , listener ) ; 
 + bindings . add ( b ) ; 
 + return b ; 
 } 
 
 public < T > void bind ( Value < T > value , boolean notify , ValueChangedListener < T > listener ) { 
 @ @ - 229 , 11 + 279 , 16 @ @ public class ActorBinder { 
 bindings . clear ( ) ; 
 } 
 
 - public interface OnChangedListener { 
 - void onChanged ( String s ) ; 
 + public interface OnChangedListener < T > { 
 + void onChanged ( T val ) ; 
 + } 
 + 
 + public void unbind ( Binding b ) { 
 + b . unbind ( ) ; 
 + bindings . remove ( b ) ; 
 } 
 
 - private class Binding { 
 + public class Binding { 
 private Value model ; 
 private ValueChangedListener listener ; 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java 
 index e8f4990 . . 83c474e 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / GroupInfoFragment . java 
 @ @ - 152 , 7 + 152 , 7 @ @ public class GroupInfoFragment extends BaseFragment { 
 themeHeader . setTextColor ( style . getProfileSubtitleColor ( ) ) ; 
 
 final boolean finalIsAdmin = isAdmin ; 
 - bind ( themeTV , header . findViewById ( R . id . themeContainer ) , groupInfo . getTheme ( ) , new ActorBinder . OnChangedListener ( ) { 
 + bind ( themeTV , header . findViewById ( R . id . themeContainer ) , groupInfo . getTheme ( ) , new ActorBinder . OnChangedListener < String > ( ) { 
 @ Override 
 public void onChanged ( String s ) { 
 theme [ 0 ] = s ; 
 @ @ - 162 , 7 + 162 , 7 @ @ public class GroupInfoFragment extends BaseFragment { 
 
 / / bind ( themeHeader , themeHeader , groupInfo . getTheme ( ) ) ; 
 
 - bind ( aboutTV , header . findViewById ( R . id . aboutContainer ) , groupInfo . getAbout ( ) , new ActorBinder . OnChangedListener ( ) { 
 + bind ( aboutTV , header . findViewById ( R . id . aboutContainer ) , groupInfo . getAbout ( ) , new ActorBinder . OnChangedListener < String > ( ) { 
 @ Override 
 public void onChanged ( String s ) { 
 about [ 0 ] = s ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java 
 index b217a81 . . a91f3d6 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / group / view / MembersAdapter . java 
 @ @ - 8 , 8 + 8 , 10 @ @ import android . widget . TextView ; 
 
 import java . util . Collection ; 
 
 + import im . actor . core . viewmodel . UserPresence ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . fragment . ActorBinder ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . adapters . HolderAdapter ; 
 @ @ - 21 , 7 + 23 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 public class MembersAdapter extends HolderAdapter < GroupMember > { 
 private GroupMember [ ] members ; 
 - 
 + private final ActorBinder BINDER = new ActorBinder ( ) ; 
 public MembersAdapter ( Collection < GroupMember > members , Context context ) { 
 super ( context ) ; 
 this . members = members . toArray ( new GroupMember [ 0 ] ) ; 
 @ @ - 57 , 6 + 59 , 10 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 private TextView userName ; 
 private View admin ; 
 private AvatarView avatarView ; 
 + private TextView online ; 
 + private TextView lastSeen ; 
 + private ActorBinder . Binding onlineBinding ; 
 + private Context context ; 
 
 @ Override 
 public View init ( GroupMember data , ViewGroup viewGroup , Context context ) { 
 @ @ - 65 , 20 + 71 , 42 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 avatarView . init ( Screen . dp ( 42 ) , 24 ) ; 
 admin = res . findViewById ( R . id . adminFlag ) ; 
 + online = ( TextView ) res . findViewById ( R . id . online ) ; 
 + lastSeen = ( TextView ) res . findViewById ( R . id . lastSeen ) ; 
 ( ( TextView ) admin ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupAdminColor ( ) ) ; 
 ( ( TextView ) res . findViewById ( R . id . name ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 res . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; 
 + this . context = context ; 
 return res ; 
 } 
 
 @ Override 
 public void bind ( GroupMember data , int position , Context context ) { 
 + if ( onlineBinding ! = null ) { 
 + onlineBinding . unbind ( ) ; 
 + } 
 + 
 UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + onlineBinding = BINDER . bind ( online , user ) ; 
 + ActorSDK . sharedActor ( ) . getMessenger ( ) . onUserVisible ( data . getUid ( ) ) ; 
 
 avatarView . bind ( user ) ; 
 
 userName . setText ( user . getName ( ) . get ( ) ) ; 
 
 + UserPresence presence = user . getPresence ( ) . get ( ) ; 
 + String s = ActorSDK . sharedActor ( ) . getMessenger ( ) . getFormatter ( ) . formatPresence ( presence , user . getSex ( ) ) ; 
 + if ( s = = null ) { 
 + s = " " ; 
 + } 
 + if ( presence . getState ( ) . equals ( UserPresence . State . ONLINE ) ) { 
 + online . setTextColor ( ActorSDK . sharedActor ( ) . style . getGroupOnlineColor ( ) ) ; 
 + s = " \ u25CF " . concat ( s ) ; 
 + } else { 
 + online . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + } 
 + online . setText ( s ) ; 
 + 
 if ( data . isAdministrator ( ) ) { 
 admin . setVisibility ( View . VISIBLE ) ; 
 } else { 
 @ @ - 89 , 6 + 117 , 9 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 @ Override 
 public void unbind ( ) { 
 avatarView . unbind ( ) ; 
 + if ( onlineBinding ! = null ) { 
 + onlineBinding . unbind ( ) ; 
 + } 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java 
 new file mode 100644 
 index 0000000 . . f211e8f 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / OnlineSpan . java 
 @ @ - 0 , 0 + 1 , 36 @ @ 
 + package im . actor . sdk . view ; 
 + 
 + import android . graphics . Color ; 
 + import android . text . TextPaint ; 
 + import android . text . style . ForegroundColorSpan ; 
 + 
 + / * * 
 + * Created by badgr on 29 . 09 . 2015 . 
 + * / 
 + public class OnlineSpan extends ForegroundColorSpan { 
 + private boolean online = false ; 
 + private static final int COLOR _ ONLINE = Color . parseColor ( " # 7b95b6 " ) ; 
 + private static final int COLOR _ OFFLINE = Color . parseColor ( " # 00000000 " ) ; 
 + 
 + public OnlineSpan ( int color ) { 
 + super ( color ) ; 
 + } 
 + 
 + public OnlineSpan ( ) { 
 + super ( COLOR _ OFFLINE ) ; 
 + } 
 + 
 + @ Override 
 + public int getForegroundColor ( ) { 
 + return online ? COLOR _ ONLINE : COLOR _ OFFLINE ; 
 + } 
 + 
 + @ Override 
 + public void updateDrawState ( TextPaint ds ) { 
 + ds . setColor ( getForegroundColor ( ) ) ; 
 + } 
 + 
 + public void setOnline ( boolean online ) { 
 + this . online = online ; 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java 
 new file mode 100644 
 index 0000000 . . 6844310 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java 
 @ @ - 0 , 0 + 1 , 68 @ @ 
 + package im . actor . sdk . view . avatar ; 
 + 
 + import android . content . Context ; 
 + import android . util . AttributeSet ; 
 + import android . view . Gravity ; 
 + import android . widget . FrameLayout ; 
 + import android . widget . ImageView ; 
 + 
 + import im . actor . core . viewmodel . GroupVM ; 
 + import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . util . Screen ; 
 + 
 + public class AvatarViewWithOnline extends FrameLayout { 
 + public static final boolean DRAW _ ONLINES = false ; 
 + AvatarView avatarView ; 
 + ImageView online ; 
 + private boolean isOnline = false ; 
 + 
 + public AvatarViewWithOnline ( Context context ) { 
 + super ( context ) ; 
 + } 
 + 
 + public AvatarViewWithOnline ( Context context , AttributeSet attrs ) { 
 + super ( context , attrs ) ; 
 + } 
 + 
 + public AvatarViewWithOnline ( Context context , AttributeSet attrs , int defStyleAttr ) { 
 + super ( context , attrs , defStyleAttr ) ; 
 + } 
 + 
 + 
 + public void init ( int size , float text ) { 
 + avatarView = new AvatarView ( getContext ( ) ) ; 
 + 
 + avatarView . init ( size , text ) ; 
 + addView ( avatarView ) ; 
 + 
 + online = new ImageView ( getContext ( ) ) ; 
 + online . setImageResource ( R . drawable . indicator _ offline ) ; 
 + addView ( online , new LayoutParams ( Screen . dp ( 11 ) , Screen . dp ( 11 ) , Gravity . RIGHT | Gravity . BOTTOM ) ) ; 
 + } 
 + 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + 
 + public void bind ( UserVM u ) { 
 + avatarView . bind ( u ) ; 
 + } 
 + 
 + public void bind ( GroupVM g ) { 
 + avatarView . bind ( g ) ; 
 + } 
 + 
 + public void setOnline ( boolean online , boolean isBot ) { 
 + if ( ! isBot & & DRAW _ ONLINES ) { 
 + this . online . setVisibility ( VISIBLE ) ; 
 + if ( isOnline ! = online ) { 
 + isOnline = online ; 
 + this . online . setImageResource ( isOnline ? R . drawable . indicator _ online : R . drawable . indicator _ offline ) ; 
 + } 
 + } else { 
 + this . online . setVisibility ( INVISIBLE ) ; 
 + } 
 + 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml 
 new file mode 100644 
 index 0000000 . . 4c6a88d 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ offline . xml 
 @ @ - 0 , 0 + 1 , 8 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ color / conv _ offline " / > 
 + < stroke 
 + android : width = " 2dp " 
 + android : color = " @ android : color / white " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml 
 new file mode 100644 
 index 0000000 . . a273657 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / indicator _ online . xml 
 @ @ - 0 , 0 + 1 , 8 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ color / conv _ online " / > 
 + < stroke 
 + android : width = " 2dp " 
 + android : color = " @ android : color / white " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml 
 index 9ac19c4 . . d9b18e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ item . xml 
 @ @ - 27 , 18 + 27 , 33 @ @ 
 android : layout _ gravity = " center " / > 
 < / FrameLayout > 
 
 - < TextView 
 - android : id = " @ + id / name " 
 + < LinearLayout 
 android : layout _ width = " 0dp " 
 - android : layout _ height = " match _ parent " 
 android : layout _ weight = " 1 " 
 - android : ellipsize = " end " 
 + android : orientation = " vertical " 
 android : gravity = " center _ vertical " 
 - android : lines = " 1 " 
 - android : paddingRight = " 8dp " 
 - android : singleLine = " true " 
 - android : textSize = " 16sp " / > 
 + android : layout _ height = " match _ parent " > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 
 + < TextView 
 + android : id = " @ + id / online " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : ellipsize = " end " 
 + android : text = " @ string / online " 
 + android : gravity = " center _ vertical " 
 + android : textColor = " @ color / conv _ online " / > 
 + < / LinearLayout > 
 < TextView 
 android : id = " @ + id / adminFlag " 
 android : layout _ width = " wrap _ content " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 1222ffe . . 3c3350b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 248 , 7 + 248 , 7 @ @ 
 < string name = " group _ members _ header " >          < / string > 
 < string name = " group _ members _ count " > { 0 }   { 1 } < / string > 
 
 - < string name = " group _ admin " >      .       < / string > 
 + < string name = " group _ admin " >      . < / string > 
 
 < string name = " group _ created _ by " >       { 0 } < / string > 
 < string name = " group _ created _ by _ you " >           < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml 
 index 7ae9517 . . b98ac94 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / colors . xml 
 @ @ - 151 , 5 + 151 , 7 @ @ 
 < color name = " default _ circle _ indicator _ stroke _ color " > # FFDDDDDD < / color > 
 < dimen name = " default _ circle _ indicator _ stroke _ width " > 1dp < / dimen > 
 
 + < color name = " conv _ offline " > @ android : color / darker _ gray < / color > 
 + < color name = " conv _ online " > # ff7ea8ef < / color > 
 
 < / resources > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 8366189 . . 2270a93 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 225 , 6 + 225 , 7 @ @ 
 < string name = " chat _ not _ member " > You is not member of this group < / string > 
 
 < string name = " chat _ unsupported " > Message is unsupported in this version . Please , wait for application update to see message . < / string > 
 + < string name = " online " > \ u25CF online < / string > 
 
 < ! - - Profile - - > 
 < string name = " profile _ title " > Profile < / string >
