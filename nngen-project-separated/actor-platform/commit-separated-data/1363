BLEU SCORE: 0.14458924666162856

TEST MSG: feat ( android - sdk ) : ViewHolders , ChatActivity , MainPhoneController customizations
GENERATED MSG: feat ( android ) : custom auth

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index 65170da . . 92d8ac7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 63 , 6 + 63 , 11 @ @ public class Application extends ActorSDKApplication { < nl > } < nl > < nl > @ Override < nl > + public boolean showWallpaperCategory ( ) { < nl > + return true ; < nl > + } < nl > + < nl > + @ Override < nl > public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { < nl > return new ActorSettingsCategory [ ] { < nl > new ActorSettingsCategory ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index 817cdf2 . . a2a54c2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 3 , 7 + 3 , 6 @ @ package im . actor . sdk ; < nl > import android . app . Activity ; < nl > import android . app . AlarmManager ; < nl > import android . app . Application ; < nl > - import android . app . Fragment ; < nl > import android . app . PendingIntent ; < nl > import android . content . Context ; < nl > import android . content . Intent ; < nl > @ @ - 13 , 7 + 12 , 6 @ @ import android . os . Bundle ; < nl > import com . facebook . drawee . backends . pipeline . Fresco ; < nl > < nl > import org . jetbrains . annotations . NotNull ; < nl > - import org . jetbrains . annotations . Nullable ; < nl > < nl > import java . util . ArrayList ; < nl > import java . util . List ; < nl > @ @ - 26 , 11 + 24 , 10 @ @ import im . actor . core . ConfigurationBuilder ; < nl > import im . actor . core . DeviceCategory ; < nl > import im . actor . core . PlatformType ; < nl > import im . actor . runtime . Log ; < nl > + import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > - import im . actor . sdk . controllers . fragment . auth . BaseAuthActivity ; < nl > - import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > - import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; < nl > + import im . actor . sdk . controllers . fragment . dialogs . DialogHolder ; < nl > import im . actor . sdk . controllers . fragment . settings . MyProfileActivity ; < nl > import im . actor . sdk . core . AndroidNotifications ; < nl > import im . actor . sdk . core . AndroidPhoneBook ; < nl > @ @ - 442 , 4 + 439 , 18 @ @ public class ActorSDK { < nl > < nl > } < nl > < nl > + public < T extends BindedViewHolder > T getDelegatedViewHolder ( Class < T > base , OnDelegateViewHolder < T > callback , Object . . . args ) { < nl > + T delegated = delegate . getViewHolder ( base , args ) ; < nl > + if ( delegated ! = null ) { < nl > + return delegated ; < nl > + } else { < nl > + return callback . onNotDelegated ( ) ; < nl > + } < nl > + } < nl > + < nl > + public interface OnDelegateViewHolder < T > { < nl > + T onNotDelegated ( ) ; < nl > + < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index ab9a17a . . e46565d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 4 , 6 + 4 , 9 @ @ import android . content . Context ; < nl > import android . view . View ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . runtime . android . view . BindedViewHolder ; < nl > + import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; < nl > import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > @ @ - 41 , 6 + 44 , 19 @ @ public interface ActorSDKDelegate { < nl > * / < nl > ActorIntent getSettingsIntent ( ) ; < nl > < nl > + / * * < nl > + * If not null returned , overrides chat activity intent < nl > + * < nl > + * @ return Actor Intent < nl > + * / < nl > + ActorIntent getChatIntent ( ) ; < nl > + < nl > + String getHelpPhone ( ) ; < nl > + < nl > + < T extends BindedViewHolder , J extends T > J getViewHolder ( Class < T > base , Object . . . args ) ; < nl > + < nl > + MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) ; < nl > + < nl > @ Deprecated < nl > AuthState getAuthStartState ( ) ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 9741d06 . . e46b42a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 4 , 6 + 4 , 9 @ @ import android . content . Context ; < nl > import android . view . View ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . runtime . android . view . BindedViewHolder ; < nl > + import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; < nl > import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; < nl > @ @ - 66 , 35 + 69 , 61 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > return null ; < nl > } < nl > < nl > + @ Override < nl > + public ActorIntent getChatIntent ( ) { < nl > + return null ; < nl > + } < nl > + < nl > + @ Override < nl > + public String getHelpPhone ( ) { < nl > + return " 75551234567 " ; < nl > + } < nl > + < nl > + @ Override < nl > + public < T extends BindedViewHolder , J extends T > J getViewHolder ( Class < T > base , Object [ ] args ) { < nl > + return null ; < nl > + } < nl > + < nl > + @ Override < nl > + public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { < nl > + return null ; < nl > + } < nl > + < nl > / / < nl > / / Hacking settings activity < nl > / / < nl > < nl > + @ Deprecated < nl > @ Override < nl > public View getBeforeNickSettingsView ( Context context ) { < nl > return null ; < nl > } < nl > < nl > + @ Deprecated < nl > @ Override < nl > public View getAfterPhoneSettingsView ( Context context ) { < nl > return null ; < nl > } < nl > < nl > + @ Deprecated < nl > @ Override < nl > public View getSettingsTopView ( Context context ) { < nl > return null ; < nl > } < nl > < nl > + @ Deprecated < nl > @ Override < nl > public View getSettingsBottomView ( Context context ) { < nl > return null ; < nl > } < nl > < nl > + @ Deprecated < nl > @ Override < nl > public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { < nl > return null ; < nl > } < nl > < nl > + @ Deprecated < nl > @ Override < nl > public ActorSettingsCategory [ ] getAfterSettingsCategories ( ) { < nl > return null ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java < nl > index 4666522 . . b746d44 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java < nl > @ @ - 4 , 6 + 4 , 7 @ @ import android . content . Intent ; < nl > import android . os . Bundle ; < nl > < nl > < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . controllers . activity . base . ControllerActivity ; < nl > import im . actor . sdk . controllers . activity . controllers . MainBaseController ; < nl > import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; < nl > @ @ - 15 , 7 + 16 , 8 @ @ public class ActorMainActivity extends ControllerActivity < MainBaseController > { < nl > < nl > @ Override < nl > public MainBaseController onCreateController ( ) { < nl > - return new MainPhoneController ( this ) ; < nl > + MainPhoneController mainPhoneController = ActorSDK . sharedActor ( ) . getDelegate ( ) . getMainPhoneController ( this ) ; < nl > + return mainPhoneController ! = null ? mainPhoneController : new MainPhoneController ( this ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > index 132d0a9 . . 2fb7ff9 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > @ @ - 57 , 7 + 57 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public class MainPhoneController extends MainBaseController { < nl > < nl > - private ViewPager pager ; < nl > + protected ViewPager pager ; < nl > < nl > private HomePagerAdapter homePagerAdapter ; < nl > < nl > @ @ - 78 , 7 + 78 , 7 @ @ public class MainPhoneController extends MainBaseController { < nl > private SearchView searchView ; < nl > private MenuItem searchMenu ; < nl > < nl > - private PagerSlidingTabStrip barTabs ; < nl > + protected PagerSlidingTabStrip barTabs ; < nl > < nl > private View syncInProgressView ; < nl > private View emptyContactsView ; < nl > @ @ - 343 , 27 + 343 , 7 @ @ public class MainPhoneController extends MainBaseController { < nl > ab . setBackgroundDrawable ( new ColorDrawable ( ActorSDK . sharedActor ( ) . style . getToolBarColor ( ) ) ) ; < nl > } < nl > < nl > - FrameLayout tabsContainer = new FrameLayout ( getActivity ( ) ) ; < nl > - barTabs = new PagerSlidingTabStrip ( getActivity ( ) ) ; < nl > - barTabs . setTabBackground ( R . drawable . selector _ bar ) ; < nl > - / / barTabs . setIndicatorColorResource ( R . color . main _ tab _ selected ) ; < nl > - barTabs . setIndicatorHeight ( Screen . dp ( 2 ) ) ; < nl > - < nl > - barTabs . setDividerColorResource ( android . R . color . transparent ) ; < nl > - / / barTabs . setTextColorResource ( R . color . main _ tab _ text ) ; < nl > - barTabs . setTextSize ( Screen . dp ( 14 ) ) ; < nl > - barTabs . setUnderlineHeight ( 0 ) ; < nl > - < nl > - barTabs . setViewPager ( pager ) ; < nl > - < nl > - / / Icons < nl > - / / int width = Screen . dp ( 72 * 2 ) ; < nl > - int width = Screen . dp ( 120 * 2 + 72 ) ; < nl > - < nl > - tabsContainer . addView ( barTabs , new FrameLayout . LayoutParams ( width , Screen . dp ( 56 ) ) ) ; < nl > - Toolbar . LayoutParams lp = new Toolbar . LayoutParams ( width , Screen . dp ( 56 ) ) ; < nl > - tabsContainer . setLayoutParams ( lp ) ; < nl > - ab . setCustomView ( tabsContainer ) ; < nl > + onConfigireToolbarCustomView ( ab ) ; < nl > < nl > barTabs . setVisibility ( View . VISIBLE ) ; < nl > emptyContactsView . setVisibility ( View . GONE ) ; < nl > @ @ - 397 , 6 + 377 , 30 @ @ public class MainPhoneController extends MainBaseController { < nl > } ) ; < nl > } < nl > < nl > + protected void onConfigireToolbarCustomView ( ActionBar ab ) { < nl > + FrameLayout tabsContainer = new FrameLayout ( getActivity ( ) ) ; < nl > + barTabs = new PagerSlidingTabStrip ( getActivity ( ) ) ; < nl > + barTabs . setTabBackground ( R . drawable . selector _ bar ) ; < nl > + / / barTabs . setIndicatorColorResource ( R . color . main _ tab _ selected ) ; < nl > + barTabs . setIndicatorHeight ( Screen . dp ( 2 ) ) ; < nl > + < nl > + barTabs . setDividerColorResource ( android . R . color . transparent ) ; < nl > + / / barTabs . setTextColorResource ( R . color . main _ tab _ text ) ; < nl > + barTabs . setTextSize ( Screen . dp ( 14 ) ) ; < nl > + barTabs . setUnderlineHeight ( 0 ) ; < nl > + < nl > + barTabs . setViewPager ( pager ) ; < nl > + < nl > + / / Icons < nl > + / / int width = Screen . dp ( 72 * 2 ) ; < nl > + int width = Screen . dp ( 120 * 2 + 72 ) ; < nl > + < nl > + tabsContainer . addView ( barTabs , new FrameLayout . LayoutParams ( width , Screen . dp ( 56 ) ) ) ; < nl > + Toolbar . LayoutParams lp = new Toolbar . LayoutParams ( width , Screen . dp ( 56 ) ) ; < nl > + tabsContainer . setLayoutParams ( lp ) ; < nl > + ab . setCustomView ( tabsContainer ) ; < nl > + } < nl > + < nl > < nl > @ Override < nl > public boolean onCreateOptionsMenu ( Menu menu ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 24a0792 . . daef4dd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 67 , 7 + 67 , 12 @ @ import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . conversation . mentions . MentionsAdapter ; < nl > import im . actor . sdk . controllers . conversation . messages . AudioHolder ; < nl > import im . actor . sdk . controllers . conversation . messages . MessagesFragment ; < nl > + import im . actor . sdk . controllers . fragment . settings . ActorSettingsFragment ; < nl > + import im . actor . sdk . controllers . fragment . settings . BaseActorChatActivity ; < nl > + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsActivity ; < nl > + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; < nl > import im . actor . sdk . core . audio . VoiceCaptureActor ; < nl > + import im . actor . sdk . intents . ActorIntent ; < nl > import im . actor . sdk . util . Randoms ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . util . ViewUtils ; < nl > @ @ - 430 , 7 + 435 , 17 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > @ Override < nl > protected Fragment onCreateFragment ( ) { < nl > - return MessagesFragment . create ( peer ) ; < nl > + MessagesFragment fragment ; < nl > + if ( ActorSDK . sharedActor ( ) . getDelegate ( ) . getChatIntent ( ) ! = null ) { < nl > + ActorIntent chatIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . getChatIntent ( ) ; < nl > + if ( chatIntent instanceof BaseActorChatActivity ) { < nl > + return ( ( BaseActorChatActivity ) chatIntent ) . getChatFragment ( peer ) ; < nl > + } else { < nl > + return MessagesFragment . create ( peer ) ; < nl > + } < nl > + } else { < nl > + return MessagesFragment . create ( peer ) ; < nl > + } < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > index b3c644a . . d2f6ead 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > @ @ - 7 , 7 + 7 , 9 @ @ import android . graphics . drawable . Drawable ; < nl > import android . util . AttributeSet ; < nl > import android . view . View ; < nl > < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; < nl > import im . actor . sdk . view . BackgroundPreviewView ; < nl > < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > @ @ - 39 , 7 + 41 , 11 @ @ public class ChatBackgroundView extends View { < nl > public void bind ( ) { < nl > if ( background = = null ) { < nl > shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > - background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( BackgroundPreviewView . getBackgroundIdByUri ( messenger ( ) . getSelectedWallpaper ( ) , getContext ( ) , shp . getInt ( " wallpaper " , 0 ) ) ) ) ; < nl > + if ( shp . getInt ( " wallpaper " , 0 ) = = ActorSDK . sharedActor ( ) . style . getDefaultBackgrouds ( ) . length ) { < nl > + background = Drawable . createFromPath ( BaseActorSettingsFragment . getWallpaperFile ( ) ) ; < nl > + } else { < nl > + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( BackgroundPreviewView . getBackgroundIdByUri ( messenger ( ) . getSelectedWallpaper ( ) , getContext ( ) , shp . getInt ( " wallpaper " , 0 ) ) ) ) ; < nl > + } < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java < nl > index 6aeb6a3 . . 5eef2ae 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java < nl > @ @ - 40 , 7 + 40 , 7 @ @ public class DialogHolder extends BindedViewHolder { < nl > private TextView text ; < nl > private TextView time ; < nl > private TintImageView state ; < nl > - private TextView counter ; < nl > + protected TextView counter ; < nl > private View separator ; < nl > private CharSequence bindedText ; < nl > private int bindedUid ; < nl > @ @ - 158 , 17 + 158 , 9 @ @ public class DialogHolder extends BindedViewHolder { < nl > fl . addView ( state ) ; < nl > } < nl > < nl > - counter = new TextView ( context ) ; < nl > - counter . setTextColor ( style . getDialogsCounterTextColor ( ) ) ; < nl > - counter . setBackgroundColor ( style . getDialogsCounterBackgroundColor ( ) ) ; < nl > - counter . setPadding ( Screen . dp ( 4 ) , 0 , Screen . dp ( 4 ) , 0 ) ; < nl > - counter . setTextSize ( 10 ) ; < nl > - counter . setTypeface ( Fonts . regular ( ) ) ; < nl > - counter . setGravity ( Gravity . CENTER ) ; < nl > - counter . setIncludeFontPadding ( false ) ; < nl > - counter . setMinWidth ( Screen . dp ( 14 ) ) ; < nl > + onCreateCounter ( context , style ) ; < nl > { < nl > - FrameLayout . LayoutParams params = new FrameLayout . LayoutParams ( ViewGroup . LayoutParams . WRAP _ CONTENT , Screen . dp ( 14 ) , Gravity . BOTTOM | Gravity . RIGHT ) ; < nl > + FrameLayout . LayoutParams params = new FrameLayout . LayoutParams ( ViewGroup . LayoutParams . WRAP _ CONTENT , ViewGroup . LayoutParams . WRAP _ CONTENT , Gravity . BOTTOM | Gravity . RIGHT ) ; < nl > params . bottomMargin = Screen . dp ( 12 ) ; < nl > params . rightMargin = Screen . dp ( 10 ) ; < nl > counter . setLayoutParams ( params ) ; < nl > @ @ - 194 , 6 + 186 , 19 @ @ public class DialogHolder extends BindedViewHolder { < nl > } ) ; < nl > } < nl > < nl > + protected void onCreateCounter ( Context context , ActorStyle style ) { < nl > + counter = new TextView ( context ) ; < nl > + counter . setTextColor ( style . getDialogsCounterTextColor ( ) ) ; < nl > + counter . setBackgroundColor ( style . getDialogsCounterBackgroundColor ( ) ) ; < nl > + counter . setPadding ( Screen . dp ( 4 ) , 0 , Screen . dp ( 4 ) , 0 ) ; < nl > + counter . setTextSize ( 10 ) ; < nl > + counter . setTypeface ( Fonts . regular ( ) ) ; < nl > + counter . setGravity ( Gravity . CENTER ) ; < nl > + counter . setIncludeFontPadding ( false ) ; < nl > + counter . setMinWidth ( Screen . dp ( 14 ) ) ; < nl > + counter . setMinHeight ( Screen . dp ( 14 ) ) ; < nl > + } < nl > + < nl > public void bind ( Dialog data , boolean isLast ) { < nl > this . binded = data . getPeer ( ) . getUnuqueId ( ) ; < nl > this . bindedItem = data ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java < nl > index 634b32e . . 3f6e70b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java < nl > @ @ - 6 , 6 + 6 , 7 @ @ import android . widget . FrameLayout ; < nl > < nl > import im . actor . core . entity . Dialog ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . view . adapters . OnItemClickedListener ; < nl > import im . actor . runtime . android . view . BindedListAdapter ; < nl > < nl > @ @ - 23 , 7 + 24 , 12 @ @ public class DialogsAdapter extends BindedListAdapter < Dialog , DialogHolder > { < nl > < nl > @ Override < nl > public DialogHolder onCreateViewHolder ( ViewGroup viewGroup , int viewType ) { < nl > - return new DialogHolder ( context , new FrameLayout ( context ) , onItemClicked ) ; < nl > + return ActorSDK . sharedActor ( ) . getDelegatedViewHolder ( DialogHolder . class , new ActorSDK . OnDelegateViewHolder < DialogHolder > ( ) { < nl > + @ Override < nl > + public DialogHolder onNotDelegated ( ) { < nl > + return new DialogHolder ( context , new FrameLayout ( context ) , onItemClicked ) ; < nl > + } < nl > + } , context , new FrameLayout ( context ) , onItemClicked ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java < nl > index deadf1a . . 7bfd48b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java < nl > @ @ - 28 , 6 + 28 , 11 @ @ public class ActorSettingsFragment extends BaseActorSettingsFragment { < nl > } < nl > < nl > @ Override < nl > + public boolean showWallpaperCategory ( ) { < nl > + return true ; < nl > + } < nl > + < nl > + @ Override < nl > public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { < nl > return null ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java < nl > new file mode 100644 < nl > index 0000000 . . f3e07e8 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java < nl > @ @ - 0 , 0 + 1 , 25 @ @ < nl > + package im . actor . sdk . controllers . fragment . settings ; < nl > + < nl > + import android . content . Intent ; < nl > + < nl > + import im . actor . core . entity . Peer ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesFragment ; < nl > + import im . actor . sdk . intents . ActorIntentFragmentActivity ; < nl > + < nl > + public abstract class BaseActorChatActivity extends ActorIntentFragmentActivity { < nl > + public BaseActorChatActivity ( Intent intent ) { < nl > + super ( intent ) ; < nl > + } < nl > + < nl > + public BaseActorChatActivity ( Intent intent , MessagesFragment fragment ) { < nl > + super ( intent , fragment ) ; < nl > + } < nl > + < nl > + public BaseActorChatActivity ( ) { < nl > + super ( ) ; < nl > + } < nl > + < nl > + public MessagesFragment getChatFragment ( Peer peer ) { < nl > + return null ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > index 8b58e0f . . f07a325 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > @ @ - 31 , 6 + 31 , 8 @ @ import com . google . i18n . phonenumbers . NumberParseException ; < nl > import com . google . i18n . phonenumbers . PhoneNumberUtil ; < nl > import com . google . i18n . phonenumbers . Phonenumber ; < nl > < nl > + import java . io . File ; < nl > + < nl > import im . actor . core . viewmodel . CommandCallback ; < nl > import im . actor . core . viewmodel . UserEmail ; < nl > import im . actor . core . viewmodel . UserPhone ; < nl > @ @ - 60 , 8 + 62 , 8 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > private int baseColor ; < nl > private CoverAvatarView avatarView ; < nl > - SharedPreferences shp ; < nl > - SharedPreferences . Editor ed ; < nl > + protected SharedPreferences shp ; < nl > + protected SharedPreferences . Editor ed ; < nl > private boolean noPhones = false ; < nl > private boolean noEmails = false ; < nl > < nl > @ @ - 361 , 7 + 363 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > view . findViewById ( R . id . askQuestion ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View view ) { < nl > - execute ( messenger ( ) . findUsers ( " 75551234567 " ) , R . string . progress _ common , new CommandCallback < UserVM [ ] > ( ) { < nl > + execute ( messenger ( ) . findUsers ( ActorSDK . sharedActor ( ) . getDelegate ( ) . getHelpPhone ( ) ) , R . string . progress _ common , new CommandCallback < UserVM [ ] > ( ) { < nl > @ Override < nl > public void onResult ( UserVM [ ] res ) { < nl > if ( res . length > = 1 ) { < nl > @ @ - 453 , 44 + 455 , 51 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; < nl > < nl > / / Wallpaper < nl > - LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; < nl > - wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > - ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; < nl > - view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > - View . OnClickListener ocl = new View . OnClickListener ( ) { < nl > - < nl > - @ Override < nl > - public void onClick ( final View v ) { < nl > - Intent i = new Intent ( getActivity ( ) , PickWallpaperActivity . class ) ; < nl > - int j = 0 ; < nl > - Object tag = v . getTag ( ) ; < nl > - if ( tag ! = null & & tag instanceof Integer ) { < nl > - j = ( int ) tag ; < nl > + if ( showWallpaperCategory ( ) ) { < nl > + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; < nl > + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; < nl > + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + View . OnClickListener ocl = new View . OnClickListener ( ) { < nl > + < nl > + @ Override < nl > + public void onClick ( final View v ) { < nl > + Intent i = new Intent ( getActivity ( ) , PickWallpaperActivity . class ) ; < nl > + int j = 0 ; < nl > + Object tag = v . getTag ( ) ; < nl > + if ( tag ! = null & & tag instanceof Integer ) { < nl > + j = ( int ) tag ; < nl > + } < nl > + i . putExtra ( " EXTRA _ ID " , j ) ; < nl > + startActivity ( i ) ; < nl > } < nl > - i . putExtra ( " EXTRA _ ID " , j ) ; < nl > - startActivity ( i ) ; < nl > + } ; < nl > + int previewSize = 80 ; < nl > + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; < nl > + for ( int i = 0 ; i < 3 ; i + + ) { < nl > + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; < nl > + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; < nl > + bckgrnd . init ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; < nl > + bckgrnd . bind ( i ) ; < nl > + / / bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; < nl > + frame . setTag ( i ) ; < nl > + frame . setOnClickListener ( ocl ) ; < nl > + frame . addView ( bckgrnd ) ; < nl > + wallpaperContainer . addView ( frame , params ) ; < nl > + < nl > } < nl > - } ; < nl > - int previewSize = 80 ; < nl > - LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; < nl > - for ( int i = 0 ; i < 3 ; i + + ) { < nl > - FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; < nl > - BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; < nl > - bckgrnd . init ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; < nl > - bckgrnd . bind ( i ) ; < nl > - / / bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; < nl > - frame . setTag ( i ) ; < nl > - frame . setOnClickListener ( ocl ) ; < nl > - frame . addView ( bckgrnd ) ; < nl > - wallpaperContainer . addView ( frame , params ) ; < nl > + TintImageView next = new TintImageView ( getActivity ( ) ) ; < nl > + next . setResource ( R . drawable . ic _ keyboard _ arrow _ right _ white _ 36dp ) ; < nl > + next . setTint ( style . getSettingsIconColor ( ) ) ; < nl > + next . setOnClickListener ( ocl ) ; < nl > + next . setTag ( - 1 ) ; < nl > + wallpaperContainer . addView ( next , new LinearLayout . LayoutParams ( Screen . dp ( 40 ) , Screen . dp ( previewSize ) ) ) ; < nl > < nl > + } else { < nl > + view . findViewById ( R . id . background _ container ) . setVisibility ( View . GONE ) ; < nl > + view . findViewById ( R . id . wallpaperDivider ) . setVisibility ( View . GONE ) ; < nl > + view . findViewById ( R . id . settings _ wallpaper _ title ) . setVisibility ( View . GONE ) ; < nl > } < nl > - TintImageView next = new TintImageView ( getActivity ( ) ) ; < nl > - next . setResource ( R . drawable . ic _ keyboard _ arrow _ right _ white _ 36dp ) ; < nl > - next . setTint ( style . getSettingsIconColor ( ) ) ; < nl > - next . setOnClickListener ( ocl ) ; < nl > - next . setTag ( - 1 ) ; < nl > - wallpaperContainer . addView ( next , new LinearLayout . LayoutParams ( Screen . dp ( 40 ) , Screen . dp ( previewSize ) ) ) ; < nl > < nl > view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > @ @ - 615 , 6 + 624 , 20 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } < nl > < nl > + public static String getWallpaperFile ( ) { < nl > + File externalFile = messenger ( ) . getContext ( ) . getExternalFilesDir ( null ) ; < nl > + if ( externalFile = = null ) { < nl > + return null ; < nl > + } < nl > + String externalPath = externalFile . getAbsolutePath ( ) ; < nl > + < nl > + File dest = new File ( externalPath + " / actor / wallpapers / " ) ; < nl > + dest . mkdirs ( ) ; < nl > + < nl > + File outputFile = new File ( dest , " customWallpaper " + " . jpg " ) ; < nl > + return outputFile . getAbsolutePath ( ) ; < nl > + } < nl > + < nl > @ Override < nl > public void onResume ( ) { < nl > super . onResume ( ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java < nl > index b80f512 . . f2fd839 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java < nl > @ @ - 15 , 6 + 15 , 8 @ @ public interface IActorSettingsFragment { < nl > < nl > View getSettingsBottomView ( ) ; < nl > < nl > + boolean showWallpaperCategory ( ) ; < nl > + < nl > ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) ; < nl > < nl > ActorSettingsCategory [ ] getAfterSettingsCategories ( ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > index 9822568 . . 7ee5ec4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > @ @ - 14 , 8 + 14 , 11 @ @ import com . facebook . imagepipeline . common . ResizeOptions ; < nl > import com . facebook . imagepipeline . request . ImageRequest ; < nl > import com . facebook . imagepipeline . request . ImageRequestBuilder ; < nl > < nl > + import java . io . File ; < nl > + < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; < nl > < nl > public class BackgroundPreviewView extends SimpleDraweeView { < nl > < nl > @ @ - 53 , 19 + 56 , 38 @ @ public class BackgroundPreviewView extends SimpleDraweeView { < nl > } < nl > < nl > public void bind ( int i ) { < nl > - int bkgrnd = getBackground ( i ) ; < nl > - Uri uri = new Uri . Builder ( ) < nl > - . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) < nl > - . path ( String . valueOf ( bkgrnd ) ) < nl > - . build ( ) ; < nl > - ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > - . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > - . build ( ) ; < nl > - PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > - . setOldController ( getController ( ) ) < nl > - . setImageRequest ( request ) < nl > - . build ( ) ; < nl > - setController ( controller ) ; < nl > + if ( i ! = BACKGROUNDS . length ) { < nl > + int bkgrnd = getBackground ( i ) ; < nl > + Uri uri = new Uri . Builder ( ) < nl > + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) < nl > + . path ( String . valueOf ( bkgrnd ) ) < nl > + . build ( ) ; < nl > + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > + . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > + . build ( ) ; < nl > + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > + . setOldController ( getController ( ) ) < nl > + . setImageRequest ( request ) < nl > + . build ( ) ; < nl > + setController ( controller ) ; < nl > + } else { < nl > + if ( BaseActorSettingsFragment . getWallpaperFile ( ) ! = null ) { < nl > + File customWallpaper = new File ( BaseActorSettingsFragment . getWallpaperFile ( ) ) ; < nl > + if ( ! customWallpaper . exists ( ) ) { < nl > + return ; < nl > + } < nl > + Uri uri = Uri . fromFile ( customWallpaper ) ; < nl > + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > + . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > + . build ( ) ; < nl > + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > + . setOldController ( getController ( ) ) < nl > + . setImageRequest ( request ) < nl > + . build ( ) ; < nl > + setController ( controller ) ; < nl > + } < nl > + } < nl > + < nl > < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java < nl > index 5e4b958 . . 6cda9a1 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java < nl > @ @ - 107 , 7 + 107 , 7 @ @ public class PagerSlidingTabStrip extends FrameLayout { < nl > < nl > tabsContainer = new LinearLayout ( context ) ; < nl > tabsContainer . setOrientation ( LinearLayout . HORIZONTAL ) ; < nl > - tabsContainer . setLayoutParams ( new LayoutParams ( LayoutParams . WRAP _ CONTENT , LayoutParams . MATCH _ PARENT ) ) ; < nl > + tabsContainer . setLayoutParams ( new LayoutParams ( LayoutParams . MATCH _ PARENT , LayoutParams . MATCH _ PARENT ) ) ; < nl > tabsContainer . setPadding ( tabsContainerPaddingLeft , tabsContainerPaddingTop , tabsContainerPaddingRight , tabsContainerPaddingBottom ) ; < nl > addView ( tabsContainer ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index 9d36309 . . 35f78b5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 1 , 5 + 1 , 7 @ @ < nl > package im . actor ; < nl > < nl > + import java . util . ArrayList ; < nl > + < nl > import im . actor . core . AuthState ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . BaseActorSDKDelegate ; < nl > @ @ - 11 , 7 + 13 , 11 @ @ public class Application extends android . app . Application { < nl > @ Override < nl > public void onCreate ( ) { < nl > super . onCreate ( ) ; < nl > - ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > + / / ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > + ArrayList < String > endpoints = new ArrayList < String > ( ) ; < nl > + endpoints . add ( " tls : / / front1 - tcp . llectro . com " ) ; < nl > + endpoints . add ( " tls : / / front1 - tcp . llectro . com " ) ; < nl > + ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; < nl > ActorSDK . sharedActor ( ) . createActor ( this ) ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java < nl > new file mode 100644 < nl > index 0000000 . . 12d46dc < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java < nl > @ @ - 0 , 0 + 1 , 130 @ @ < nl > + package im . actor . auth ; < nl > + < nl > + import android . app . AlertDialog ; < nl > + import android . os . Bundle ; < nl > + import android . telephony . PhoneNumberFormattingTextWatcher ; < nl > + import android . text . Editable ; < nl > + import android . text . TextWatcher ; < nl > + import android . view . KeyEvent ; < nl > + import android . view . LayoutInflater ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . view . inputmethod . EditorInfo ; < nl > + import android . widget . EditText ; < nl > + import android . widget . TextView ; < nl > + < nl > + import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > + import im . actor . sdk . util . Fonts ; < nl > + import im . actor . sdk . util . KeyboardHelper ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > + public class SignEmailFragment extends BaseAuthFragment { < nl > + < nl > + private EditText emailEditText ; < nl > + private KeyboardHelper keyboardHelper ; < nl > + < nl > + @ Override < nl > + public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > + View v = inflater . inflate ( R . layout . fragment _ sign _ email , container , false ) ; < nl > + < nl > + ( ( TextView ) v . findViewById ( R . id . button _ continue _ text ) ) . setTypeface ( Fonts . medium ( ) ) ; < nl > + < nl > + keyboardHelper = new KeyboardHelper ( getActivity ( ) ) ; < nl > + < nl > + initView ( v ) ; < nl > + < nl > + return v ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onResume ( ) { < nl > + super . onResume ( ) ; < nl > + < nl > + / / TODO track email auth open < nl > + / / messenger ( ) . trackAuthPhoneOpen ( ) ; < nl > + < nl > + setTitle ( R . string . auth _ email _ title ) ; < nl > + < nl > + focusEmail ( ) ; < nl > + < nl > + keyboardHelper . setImeVisibility ( emailEditText , true ) ; < nl > + } < nl > + < nl > + private void initView ( View v ) { < nl > + < nl > + emailEditText = ( EditText ) v . findViewById ( R . id . tv _ email ) ; < nl > + emailEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; < nl > + String email = messenger ( ) . getAuthEmail ( ) ; < nl > + if ( email ! = null & & ! email . isEmpty ( ) ) { < nl > + emailEditText . setText ( email ) ; < nl > + } < nl > + emailEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { < nl > + @ Override < nl > + public boolean onEditorAction ( TextView textView , int id , KeyEvent keyEvent ) { < nl > + if ( id = = EditorInfo . IME _ ACTION _ GO ) { < nl > + requestCode ( ) ; < nl > + return true ; < nl > + } < nl > + return false ; < nl > + } < nl > + } ) ; < nl > + emailEditText . addTextChangedListener ( new TextWatcher ( ) { < nl > + @ Override < nl > + public void beforeTextChanged ( CharSequence s , int start , int count , int after ) { < nl > + < nl > + } < nl > + < nl > + @ Override < nl > + public void onTextChanged ( CharSequence s , int start , int before , int count ) { < nl > + < nl > + } < nl > + < nl > + @ Override < nl > + public void afterTextChanged ( Editable s ) { < nl > + / / TODO trackAuthEmailType < nl > + / / messenger ( ) . trackAuthPhoneType ( emailEditText . getText ( ) . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + < nl > + onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View view ) { < nl > + requestCode ( ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + private void requestCode ( ) { < nl > + final String ACTION = " Request code email " ; < nl > + < nl > + < nl > + if ( emailEditText . getText ( ) . toString ( ) . trim ( ) . length ( ) = = 0 ) { < nl > + String message = getString ( R . string . auth _ error _ empty _ email ) ; < nl > + new AlertDialog . Builder ( getActivity ( ) ) < nl > + . setMessage ( R . string . auth _ error _ empty _ email ) < nl > + . setPositiveButton ( R . string . dialog _ ok , null ) < nl > + . show ( ) ; < nl > + return ; < nl > + } < nl > + < nl > + String rawEmail = emailEditText . getText ( ) . toString ( ) ; < nl > + < nl > + if ( rawEmail . length ( ) = = 0 ) { < nl > + String message = getString ( R . string . auth _ error _ empty _ email ) ; < nl > + new AlertDialog . Builder ( getActivity ( ) ) < nl > + . setMessage ( R . string . auth _ error _ empty _ email ) < nl > + . setPositiveButton ( R . string . dialog _ ok , null ) < nl > + . show ( ) ; < nl > + return ; < nl > + } < nl > + executeAuth ( ActorSDK . sharedActor ( ) . getMessenger ( ) . requestStartEmailAuth ( rawEmail ) , ACTION ) ; < nl > + } < nl > + < nl > + private void focusEmail ( ) { < nl > + focus ( emailEditText ) ; < nl > + } < nl > + < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index e89067c . . 1492015 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 246 , 7 + 246 , 6 @ @ public class ActorSDK { < nl > < nl > public void setDelegate ( ActorSDKDelegate delegate ) { < nl > this . delegate = delegate ; < nl > - activityManager . setSdkDelegate ( delegate ) ; < nl > } < nl > < nl > public ActivityManager getActivityManager ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index cdf9495 . . fc7de4f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > public interface ActorSDKDelegate { < nl > @ @ - 27 , 4 + 28 , 6 @ @ public interface ActorSDKDelegate { < nl > ActorIntent getStartIntent ( ) ; < nl > < nl > AuthState getAuthStartState ( ) ; < nl > + < nl > + BaseAuthFragment getSignFragment ( ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 6a2eb02 . . 7a783a8 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 1 , 6 + 1 , 9 @ @ < nl > package im . actor . sdk ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > + import im . actor . sdk . controllers . fragment . auth . BaseCustomAuthFragment ; < nl > + import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > @ @ - 24 , 4 + 27 , 9 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > public AuthState getAuthStartState ( ) { < nl > return AuthState . AUTH _ PHONE ; < nl > } < nl > + < nl > + @ Override < nl > + public BaseCustomAuthFragment getSignFragment ( ) { < nl > + return new SignPhoneFragment ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > index d958ac5 . . b470921 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > @ @ - 14 , 6 + 14 , 7 @ @ import im . actor . core . network . RpcInternalException ; < nl > import im . actor . core . network . RpcTimeoutException ; < nl > import im . actor . core . viewmodel . Command ; < nl > import im . actor . core . viewmodel . CommandCallback ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > @ @ - 26 , 6 + 27 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > public static final String SIGN _ TYPE _ KEY = " sign _ type " ; < nl > public static final int AUTH _ TYPE _ PHONE = 1 ; < nl > public static final int AUTH _ TYPE _ EMAIL = 2 ; < nl > + public static final int AUTH _ TYPE _ CUSTOM = 3 ; < nl > public static final int SIGN _ TYPE _ IN = 3 ; < nl > public static final int SIGN _ TYPE _ UP = 4 ; < nl > private static final int OAUTH _ DIALOG = 1 ; < nl > @ @ - 34 , 6 + 36 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > private AuthState state ; < nl > private int authType = AUTH _ TYPE _ PHONE ; < nl > private int signType ; < nl > + private BaseAuthFragment signFragment ; < nl > < nl > < nl > @ Override < nl > @ @ - 76 , 13 + 79 , 18 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > this . state = state ; < nl > < nl > switch ( state ) { < nl > - / / case AUTH _ START : < nl > - / / Fragment chooseAuthFr = new ChooseAuthTypeFragment ( ) ; < nl > - / / Bundle b = new Bundle ( ) ; < nl > - / / b . putInt ( SIGN _ TYPE _ KEY , signType ) ; < nl > - / / chooseAuthFr . setArguments ( b ) ; < nl > - / / showFragment ( chooseAuthFr , false , false ) ; < nl > - / / break ; < nl > + case AUTH _ START : < nl > + signFragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . getSignFragment ( ) ; < nl > + showFragment ( signFragment , false , false ) ; < nl > + if ( signFragment instanceof SignEmailFragment ) { < nl > + authType = AUTH _ TYPE _ EMAIL ; < nl > + } else if ( signFragment instanceof SignPhoneFragment ) { < nl > + authType = AUTH _ TYPE _ PHONE ; < nl > + } else { < nl > + authType = AUTH _ TYPE _ CUSTOM ; < nl > + } < nl > + < nl > + break ; < nl > case AUTH _ EMAIL : < nl > showFragment ( new SignEmailFragment ( ) , false , false ) ; < nl > authType = AUTH _ TYPE _ EMAIL ; < nl > @ @ - 91 , 6 + 99 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > showFragment ( new SignPhoneFragment ( ) , false , false ) ; < nl > authType = AUTH _ TYPE _ PHONE ; < nl > break ; < nl > + case CODE _ VALIDATION _ CUSTOM : < nl > case CODE _ VALIDATION _ PHONE : < nl > case CODE _ VALIDATION _ EMAIL : < nl > if ( ( state = = AuthState . CODE _ VALIDATION _ EMAIL & & authType = = AUTH _ TYPE _ PHONE ) | | ( state = = AuthState . CODE _ VALIDATION _ PHONE & & authType = = AUTH _ TYPE _ EMAIL ) ) { < nl > @ @ - 100 , 6 + 109 , 10 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > Fragment signInFragment = new SignInFragment ( ) ; < nl > Bundle args = new Bundle ( ) ; < nl > args . putString ( " authType " , state = = AuthState . CODE _ VALIDATION _ EMAIL ? SignInFragment . AUTH _ TYPE _ EMAIL : SignInFragment . AUTH _ TYPE _ PHONE ) ; < nl > + if ( state = = AuthState . CODE _ VALIDATION _ CUSTOM ) { < nl > + BaseCustomAuthFragment customSignFragment = ( BaseCustomAuthFragment ) signFragment ; < nl > + args . putString ( " authId " , customSignFragment . getAuthId ( ) ) ; < nl > + } < nl > signInFragment . setArguments ( args ) ; < nl > showFragment ( signInFragment , false , false ) ; < nl > break ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java < nl > new file mode 100644 < nl > index 0000000 . . d0675fb < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java < nl > @ @ - 0 , 0 + 1 , 19 @ @ < nl > + package im . actor . sdk . controllers . fragment . auth ; < nl > + < nl > + / * * < nl > + * Created by root on 10 / 20 / 15 . < nl > + * / < nl > + public class BaseCustomAuthFragment extends BaseAuthFragment { < nl > + < nl > + private String authId ; < nl > + < nl > + public String getAuthId ( ) { < nl > + return authId ; < nl > + } < nl > + < nl > + public void setAuthId ( String authId ) { < nl > + this . authId = authId ; < nl > + } < nl > + < nl > + < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java < nl > index faa42d8 . . 4d7a328 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java < nl > @ @ - 28 , 12 + 28 , 11 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public class SignInFragment extends BaseAuthFragment { < nl > < nl > - private EditText codeEnterEditText ; < nl > - private KeyboardHelper keyboardHelper ; < nl > public static final String AUTH _ TYPE _ EMAIL = " auth _ type _ email " ; < nl > public static final String AUTH _ TYPE _ PHONE = " auth _ type _ phone " ; < nl > - < nl > String authType ; < nl > + private EditText codeEnterEditText ; < nl > + private KeyboardHelper keyboardHelper ; < nl > < nl > @ Override < nl > public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > @ @ - 56 , 12 + 55 , 18 @ @ public class SignInFragment extends BaseAuthFragment { < nl > ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( < nl > Html . fromHtml ( getString ( R . string . auth _ code _ phone _ hint ) . replace ( " { 0 } " , " < b > " + phoneNumber + " < / b > " ) ) < nl > ) ; < nl > - } else { < nl > + } else if ( authType . equals ( AUTH _ TYPE _ EMAIL ) ) { < nl > String email = messenger ( ) . getAuthEmail ( ) ; < nl > ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( < nl > Html . fromHtml ( getString ( R . string . auth _ code _ email _ hint ) . replace ( " { 0 } " , " < b > " + email + " < / b > " ) ) < nl > ) ; < nl > } < nl > + / / else { < nl > + / / String authId = getArguments ( ) . getString ( " authId " ) ; < nl > + / / ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( < nl > + / / Html . fromHtml ( getString ( R . string . auth _ code _ email _ hint ) . replace ( " { 0 } " , " < b > " + email + " < / b > " ) ) < nl > + / / ) ; < nl > + / / } < nl > < nl > codeEnterEditText = ( EditText ) v . findViewById ( R . id . et _ sms _ code _ enter ) ; < nl > codeEnterEditText . addTextChangedListener ( new TextWatcher ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java < nl > index f17b04d . . ed60801 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java < nl > @ @ - 26 , 7 + 26 , 7 @ @ import im . actor . sdk . util . KeyboardHelper ; < nl > < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > - public class SignPhoneFragment extends BaseAuthFragment { < nl > + public class SignPhoneFragment extends BaseCustomAuthFragment { < nl > < nl > private static final int REQUEST _ COUNTRY = 0 ; < nl > < nl > @ @ - 291 , 4 + 291 , 14 @ @ public class SignPhoneFragment extends BaseAuthFragment { < nl > data . getIntExtra ( " country _ id " , 0 ) ) ) ; < nl > } < nl > } < nl > + < nl > + @ Override < nl > + public String getAuthId ( ) { < nl > + return super . getAuthId ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void setAuthId ( String authId ) { < nl > + super . setAuthId ( authId ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java < nl > index 30c8f44 . . dd19ba4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java < nl > @ @ - 4 , 6 + 4 , 7 @ @ import android . content . Context ; < nl > import android . content . Intent ; < nl > import android . os . Bundle ; < nl > < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKDelegate ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > @ @ - 12 , 14 + 13 , 14 @ @ import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > * Created by root on 10 / 20 / 15 . < nl > * / < nl > public class ActivityManager { < nl > - private ActorSDKDelegate sdkDelegate ; < nl > + < nl > < nl > public void startAuthActivity ( Context context ) { < nl > startAuthActivity ( context , null ) ; < nl > } < nl > < nl > public void startAuthActivity ( Context context , Bundle extras ) { < nl > - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { < nl > startActivity ( context , extras , AuthActivity . class ) ; < nl > } < nl > } < nl > @ @ - 29 , 7 + 30 , 7 @ @ public class ActivityManager { < nl > } < nl > < nl > public void startAfterLoginActivity ( Context context , Bundle extras ) { < nl > - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { < nl > startActivity ( context , extras , ActorMainActivity . class ) ; < nl > } < nl > } < nl > @ @ - 39 , 14 + 40 , 14 @ @ public class ActivityManager { < nl > } < nl > < nl > public void startMessagingActivity ( Context context , Bundle extras ) { < nl > - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { < nl > startActivity ( context , extras , ActorMainActivity . class ) ; < nl > } < nl > } < nl > < nl > private boolean startDelegateActivity ( Context context , ActorIntent intent , Bundle extras ) { < nl > if ( intent ! = null & & intent instanceof ActorIntentActivity ) { < nl > - Intent startIntent = ( ( ActorIntentActivity ) sdkDelegate . getAuthStartIntent ( ) ) . getIntent ( ) ; < nl > + Intent startIntent = ( ( ActorIntentActivity ) ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) ) . getIntent ( ) ; < nl > if ( extras ! = null ) { < nl > startIntent . putExtras ( extras ) ; < nl > } < nl > @ @ - 67 , 7 + 68 , 4 @ @ public class ActivityManager { < nl > } < nl > < nl > < nl > - public void setSdkDelegate ( ActorSDKDelegate sdkDelegate ) { < nl > - this . sdkDelegate = sdkDelegate ; < nl > - } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java < nl > index 515c06a . . 5ac498d 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java < nl > @ @ - 13 , 6 + 13 , 7 @ @ public enum AuthState { < nl > AUTH _ PHONE , < nl > CODE _ VALIDATION _ PHONE , < nl > CODE _ VALIDATION _ EMAIL , < nl > + CODE _ VALIDATION _ CUSTOM , < nl > GET _ OAUTH _ PARAMS , < nl > COMPLETE _ OAUTH , < nl > SIGN _ UP ,

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index 65170da . . 92d8ac7 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 63 , 6 + 63 , 11 @ @ public class Application extends ActorSDKApplication { 
 } 
 
 @ Override 
 + public boolean showWallpaperCategory ( ) { 
 + return true ; 
 + } 
 + 
 + @ Override 
 public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { 
 return new ActorSettingsCategory [ ] { 
 new ActorSettingsCategory ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index 817cdf2 . . a2a54c2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 3 , 7 + 3 , 6 @ @ package im . actor . sdk ; 
 import android . app . Activity ; 
 import android . app . AlarmManager ; 
 import android . app . Application ; 
 - import android . app . Fragment ; 
 import android . app . PendingIntent ; 
 import android . content . Context ; 
 import android . content . Intent ; 
 @ @ - 13 , 7 + 12 , 6 @ @ import android . os . Bundle ; 
 import com . facebook . drawee . backends . pipeline . Fresco ; 
 
 import org . jetbrains . annotations . NotNull ; 
 - import org . jetbrains . annotations . Nullable ; 
 
 import java . util . ArrayList ; 
 import java . util . List ; 
 @ @ - 26 , 11 + 24 , 10 @ @ import im . actor . core . ConfigurationBuilder ; 
 import im . actor . core . DeviceCategory ; 
 import im . actor . core . PlatformType ; 
 import im . actor . runtime . Log ; 
 + import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 - import im . actor . sdk . controllers . fragment . auth . BaseAuthActivity ; 
 - import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 - import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; 
 + import im . actor . sdk . controllers . fragment . dialogs . DialogHolder ; 
 import im . actor . sdk . controllers . fragment . settings . MyProfileActivity ; 
 import im . actor . sdk . core . AndroidNotifications ; 
 import im . actor . sdk . core . AndroidPhoneBook ; 
 @ @ - 442 , 4 + 439 , 18 @ @ public class ActorSDK { 
 
 } 
 
 + public < T extends BindedViewHolder > T getDelegatedViewHolder ( Class < T > base , OnDelegateViewHolder < T > callback , Object . . . args ) { 
 + T delegated = delegate . getViewHolder ( base , args ) ; 
 + if ( delegated ! = null ) { 
 + return delegated ; 
 + } else { 
 + return callback . onNotDelegated ( ) ; 
 + } 
 + } 
 + 
 + public interface OnDelegateViewHolder < T > { 
 + T onNotDelegated ( ) ; 
 + 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index ab9a17a . . e46565d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 4 , 6 + 4 , 9 @ @ import android . content . Context ; 
 import android . view . View ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . runtime . android . view . BindedViewHolder ; 
 + import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; 
 import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; 
 import im . actor . sdk . intents . ActorIntent ; 
 @ @ - 41 , 6 + 44 , 19 @ @ public interface ActorSDKDelegate { 
 * / 
 ActorIntent getSettingsIntent ( ) ; 
 
 + / * * 
 + * If not null returned , overrides chat activity intent 
 + * 
 + * @ return Actor Intent 
 + * / 
 + ActorIntent getChatIntent ( ) ; 
 + 
 + String getHelpPhone ( ) ; 
 + 
 + < T extends BindedViewHolder , J extends T > J getViewHolder ( Class < T > base , Object . . . args ) ; 
 + 
 + MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) ; 
 + 
 @ Deprecated 
 AuthState getAuthStartState ( ) ; 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 9741d06 . . e46b42a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 4 , 6 + 4 , 9 @ @ import android . content . Context ; 
 import android . view . View ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . runtime . android . view . BindedViewHolder ; 
 + import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; 
 import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; 
 @ @ - 66 , 35 + 69 , 61 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 return null ; 
 } 
 
 + @ Override 
 + public ActorIntent getChatIntent ( ) { 
 + return null ; 
 + } 
 + 
 + @ Override 
 + public String getHelpPhone ( ) { 
 + return " 75551234567 " ; 
 + } 
 + 
 + @ Override 
 + public < T extends BindedViewHolder , J extends T > J getViewHolder ( Class < T > base , Object [ ] args ) { 
 + return null ; 
 + } 
 + 
 + @ Override 
 + public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { 
 + return null ; 
 + } 
 + 
 / / 
 / / Hacking settings activity 
 / / 
 
 + @ Deprecated 
 @ Override 
 public View getBeforeNickSettingsView ( Context context ) { 
 return null ; 
 } 
 
 + @ Deprecated 
 @ Override 
 public View getAfterPhoneSettingsView ( Context context ) { 
 return null ; 
 } 
 
 + @ Deprecated 
 @ Override 
 public View getSettingsTopView ( Context context ) { 
 return null ; 
 } 
 
 + @ Deprecated 
 @ Override 
 public View getSettingsBottomView ( Context context ) { 
 return null ; 
 } 
 
 + @ Deprecated 
 @ Override 
 public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { 
 return null ; 
 } 
 
 + @ Deprecated 
 @ Override 
 public ActorSettingsCategory [ ] getAfterSettingsCategories ( ) { 
 return null ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java 
 index 4666522 . . b746d44 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / ActorMainActivity . java 
 @ @ - 4 , 6 + 4 , 7 @ @ import android . content . Intent ; 
 import android . os . Bundle ; 
 
 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . controllers . activity . base . ControllerActivity ; 
 import im . actor . sdk . controllers . activity . controllers . MainBaseController ; 
 import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; 
 @ @ - 15 , 7 + 16 , 8 @ @ public class ActorMainActivity extends ControllerActivity < MainBaseController > { 
 
 @ Override 
 public MainBaseController onCreateController ( ) { 
 - return new MainPhoneController ( this ) ; 
 + MainPhoneController mainPhoneController = ActorSDK . sharedActor ( ) . getDelegate ( ) . getMainPhoneController ( this ) ; 
 + return mainPhoneController ! = null ? mainPhoneController : new MainPhoneController ( this ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 index 132d0a9 . . 2fb7ff9 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 @ @ - 57 , 7 + 57 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public class MainPhoneController extends MainBaseController { 
 
 - private ViewPager pager ; 
 + protected ViewPager pager ; 
 
 private HomePagerAdapter homePagerAdapter ; 
 
 @ @ - 78 , 7 + 78 , 7 @ @ public class MainPhoneController extends MainBaseController { 
 private SearchView searchView ; 
 private MenuItem searchMenu ; 
 
 - private PagerSlidingTabStrip barTabs ; 
 + protected PagerSlidingTabStrip barTabs ; 
 
 private View syncInProgressView ; 
 private View emptyContactsView ; 
 @ @ - 343 , 27 + 343 , 7 @ @ public class MainPhoneController extends MainBaseController { 
 ab . setBackgroundDrawable ( new ColorDrawable ( ActorSDK . sharedActor ( ) . style . getToolBarColor ( ) ) ) ; 
 } 
 
 - FrameLayout tabsContainer = new FrameLayout ( getActivity ( ) ) ; 
 - barTabs = new PagerSlidingTabStrip ( getActivity ( ) ) ; 
 - barTabs . setTabBackground ( R . drawable . selector _ bar ) ; 
 - / / barTabs . setIndicatorColorResource ( R . color . main _ tab _ selected ) ; 
 - barTabs . setIndicatorHeight ( Screen . dp ( 2 ) ) ; 
 - 
 - barTabs . setDividerColorResource ( android . R . color . transparent ) ; 
 - / / barTabs . setTextColorResource ( R . color . main _ tab _ text ) ; 
 - barTabs . setTextSize ( Screen . dp ( 14 ) ) ; 
 - barTabs . setUnderlineHeight ( 0 ) ; 
 - 
 - barTabs . setViewPager ( pager ) ; 
 - 
 - / / Icons 
 - / / int width = Screen . dp ( 72 * 2 ) ; 
 - int width = Screen . dp ( 120 * 2 + 72 ) ; 
 - 
 - tabsContainer . addView ( barTabs , new FrameLayout . LayoutParams ( width , Screen . dp ( 56 ) ) ) ; 
 - Toolbar . LayoutParams lp = new Toolbar . LayoutParams ( width , Screen . dp ( 56 ) ) ; 
 - tabsContainer . setLayoutParams ( lp ) ; 
 - ab . setCustomView ( tabsContainer ) ; 
 + onConfigireToolbarCustomView ( ab ) ; 
 
 barTabs . setVisibility ( View . VISIBLE ) ; 
 emptyContactsView . setVisibility ( View . GONE ) ; 
 @ @ - 397 , 6 + 377 , 30 @ @ public class MainPhoneController extends MainBaseController { 
 } ) ; 
 } 
 
 + protected void onConfigireToolbarCustomView ( ActionBar ab ) { 
 + FrameLayout tabsContainer = new FrameLayout ( getActivity ( ) ) ; 
 + barTabs = new PagerSlidingTabStrip ( getActivity ( ) ) ; 
 + barTabs . setTabBackground ( R . drawable . selector _ bar ) ; 
 + / / barTabs . setIndicatorColorResource ( R . color . main _ tab _ selected ) ; 
 + barTabs . setIndicatorHeight ( Screen . dp ( 2 ) ) ; 
 + 
 + barTabs . setDividerColorResource ( android . R . color . transparent ) ; 
 + / / barTabs . setTextColorResource ( R . color . main _ tab _ text ) ; 
 + barTabs . setTextSize ( Screen . dp ( 14 ) ) ; 
 + barTabs . setUnderlineHeight ( 0 ) ; 
 + 
 + barTabs . setViewPager ( pager ) ; 
 + 
 + / / Icons 
 + / / int width = Screen . dp ( 72 * 2 ) ; 
 + int width = Screen . dp ( 120 * 2 + 72 ) ; 
 + 
 + tabsContainer . addView ( barTabs , new FrameLayout . LayoutParams ( width , Screen . dp ( 56 ) ) ) ; 
 + Toolbar . LayoutParams lp = new Toolbar . LayoutParams ( width , Screen . dp ( 56 ) ) ; 
 + tabsContainer . setLayoutParams ( lp ) ; 
 + ab . setCustomView ( tabsContainer ) ; 
 + } 
 + 
 
 @ Override 
 public boolean onCreateOptionsMenu ( Menu menu ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 24a0792 . . daef4dd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 67 , 7 + 67 , 12 @ @ import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . conversation . mentions . MentionsAdapter ; 
 import im . actor . sdk . controllers . conversation . messages . AudioHolder ; 
 import im . actor . sdk . controllers . conversation . messages . MessagesFragment ; 
 + import im . actor . sdk . controllers . fragment . settings . ActorSettingsFragment ; 
 + import im . actor . sdk . controllers . fragment . settings . BaseActorChatActivity ; 
 + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsActivity ; 
 + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; 
 import im . actor . sdk . core . audio . VoiceCaptureActor ; 
 + import im . actor . sdk . intents . ActorIntent ; 
 import im . actor . sdk . util . Randoms ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . util . ViewUtils ; 
 @ @ - 430 , 7 + 435 , 17 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 @ Override 
 protected Fragment onCreateFragment ( ) { 
 - return MessagesFragment . create ( peer ) ; 
 + MessagesFragment fragment ; 
 + if ( ActorSDK . sharedActor ( ) . getDelegate ( ) . getChatIntent ( ) ! = null ) { 
 + ActorIntent chatIntent = ActorSDK . sharedActor ( ) . getDelegate ( ) . getChatIntent ( ) ; 
 + if ( chatIntent instanceof BaseActorChatActivity ) { 
 + return ( ( BaseActorChatActivity ) chatIntent ) . getChatFragment ( peer ) ; 
 + } else { 
 + return MessagesFragment . create ( peer ) ; 
 + } 
 + } else { 
 + return MessagesFragment . create ( peer ) ; 
 + } 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 index b3c644a . . d2f6ead 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 @ @ - 7 , 7 + 7 , 9 @ @ import android . graphics . drawable . Drawable ; 
 import android . util . AttributeSet ; 
 import android . view . View ; 
 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; 
 import im . actor . sdk . view . BackgroundPreviewView ; 
 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 @ @ - 39 , 7 + 41 , 11 @ @ public class ChatBackgroundView extends View { 
 public void bind ( ) { 
 if ( background = = null ) { 
 shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 - background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( BackgroundPreviewView . getBackgroundIdByUri ( messenger ( ) . getSelectedWallpaper ( ) , getContext ( ) , shp . getInt ( " wallpaper " , 0 ) ) ) ) ; 
 + if ( shp . getInt ( " wallpaper " , 0 ) = = ActorSDK . sharedActor ( ) . style . getDefaultBackgrouds ( ) . length ) { 
 + background = Drawable . createFromPath ( BaseActorSettingsFragment . getWallpaperFile ( ) ) ; 
 + } else { 
 + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( BackgroundPreviewView . getBackgroundIdByUri ( messenger ( ) . getSelectedWallpaper ( ) , getContext ( ) , shp . getInt ( " wallpaper " , 0 ) ) ) ) ; 
 + } 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java 
 index 6aeb6a3 . . 5eef2ae 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogHolder . java 
 @ @ - 40 , 7 + 40 , 7 @ @ public class DialogHolder extends BindedViewHolder { 
 private TextView text ; 
 private TextView time ; 
 private TintImageView state ; 
 - private TextView counter ; 
 + protected TextView counter ; 
 private View separator ; 
 private CharSequence bindedText ; 
 private int bindedUid ; 
 @ @ - 158 , 17 + 158 , 9 @ @ public class DialogHolder extends BindedViewHolder { 
 fl . addView ( state ) ; 
 } 
 
 - counter = new TextView ( context ) ; 
 - counter . setTextColor ( style . getDialogsCounterTextColor ( ) ) ; 
 - counter . setBackgroundColor ( style . getDialogsCounterBackgroundColor ( ) ) ; 
 - counter . setPadding ( Screen . dp ( 4 ) , 0 , Screen . dp ( 4 ) , 0 ) ; 
 - counter . setTextSize ( 10 ) ; 
 - counter . setTypeface ( Fonts . regular ( ) ) ; 
 - counter . setGravity ( Gravity . CENTER ) ; 
 - counter . setIncludeFontPadding ( false ) ; 
 - counter . setMinWidth ( Screen . dp ( 14 ) ) ; 
 + onCreateCounter ( context , style ) ; 
 { 
 - FrameLayout . LayoutParams params = new FrameLayout . LayoutParams ( ViewGroup . LayoutParams . WRAP _ CONTENT , Screen . dp ( 14 ) , Gravity . BOTTOM | Gravity . RIGHT ) ; 
 + FrameLayout . LayoutParams params = new FrameLayout . LayoutParams ( ViewGroup . LayoutParams . WRAP _ CONTENT , ViewGroup . LayoutParams . WRAP _ CONTENT , Gravity . BOTTOM | Gravity . RIGHT ) ; 
 params . bottomMargin = Screen . dp ( 12 ) ; 
 params . rightMargin = Screen . dp ( 10 ) ; 
 counter . setLayoutParams ( params ) ; 
 @ @ - 194 , 6 + 186 , 19 @ @ public class DialogHolder extends BindedViewHolder { 
 } ) ; 
 } 
 
 + protected void onCreateCounter ( Context context , ActorStyle style ) { 
 + counter = new TextView ( context ) ; 
 + counter . setTextColor ( style . getDialogsCounterTextColor ( ) ) ; 
 + counter . setBackgroundColor ( style . getDialogsCounterBackgroundColor ( ) ) ; 
 + counter . setPadding ( Screen . dp ( 4 ) , 0 , Screen . dp ( 4 ) , 0 ) ; 
 + counter . setTextSize ( 10 ) ; 
 + counter . setTypeface ( Fonts . regular ( ) ) ; 
 + counter . setGravity ( Gravity . CENTER ) ; 
 + counter . setIncludeFontPadding ( false ) ; 
 + counter . setMinWidth ( Screen . dp ( 14 ) ) ; 
 + counter . setMinHeight ( Screen . dp ( 14 ) ) ; 
 + } 
 + 
 public void bind ( Dialog data , boolean isLast ) { 
 this . binded = data . getPeer ( ) . getUnuqueId ( ) ; 
 this . bindedItem = data ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java 
 index 634b32e . . 3f6e70b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / dialogs / DialogsAdapter . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import android . widget . FrameLayout ; 
 
 import im . actor . core . entity . Dialog ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . view . adapters . OnItemClickedListener ; 
 import im . actor . runtime . android . view . BindedListAdapter ; 
 
 @ @ - 23 , 7 + 24 , 12 @ @ public class DialogsAdapter extends BindedListAdapter < Dialog , DialogHolder > { 
 
 @ Override 
 public DialogHolder onCreateViewHolder ( ViewGroup viewGroup , int viewType ) { 
 - return new DialogHolder ( context , new FrameLayout ( context ) , onItemClicked ) ; 
 + return ActorSDK . sharedActor ( ) . getDelegatedViewHolder ( DialogHolder . class , new ActorSDK . OnDelegateViewHolder < DialogHolder > ( ) { 
 + @ Override 
 + public DialogHolder onNotDelegated ( ) { 
 + return new DialogHolder ( context , new FrameLayout ( context ) , onItemClicked ) ; 
 + } 
 + } , context , new FrameLayout ( context ) , onItemClicked ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java 
 index deadf1a . . 7bfd48b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / ActorSettingsFragment . java 
 @ @ - 28 , 6 + 28 , 11 @ @ public class ActorSettingsFragment extends BaseActorSettingsFragment { 
 } 
 
 @ Override 
 + public boolean showWallpaperCategory ( ) { 
 + return true ; 
 + } 
 + 
 + @ Override 
 public ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) { 
 return null ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java 
 new file mode 100644 
 index 0000000 . . f3e07e8 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorChatActivity . java 
 @ @ - 0 , 0 + 1 , 25 @ @ 
 + package im . actor . sdk . controllers . fragment . settings ; 
 + 
 + import android . content . Intent ; 
 + 
 + import im . actor . core . entity . Peer ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesFragment ; 
 + import im . actor . sdk . intents . ActorIntentFragmentActivity ; 
 + 
 + public abstract class BaseActorChatActivity extends ActorIntentFragmentActivity { 
 + public BaseActorChatActivity ( Intent intent ) { 
 + super ( intent ) ; 
 + } 
 + 
 + public BaseActorChatActivity ( Intent intent , MessagesFragment fragment ) { 
 + super ( intent , fragment ) ; 
 + } 
 + 
 + public BaseActorChatActivity ( ) { 
 + super ( ) ; 
 + } 
 + 
 + public MessagesFragment getChatFragment ( Peer peer ) { 
 + return null ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 index 8b58e0f . . f07a325 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 @ @ - 31 , 6 + 31 , 8 @ @ import com . google . i18n . phonenumbers . NumberParseException ; 
 import com . google . i18n . phonenumbers . PhoneNumberUtil ; 
 import com . google . i18n . phonenumbers . Phonenumber ; 
 
 + import java . io . File ; 
 + 
 import im . actor . core . viewmodel . CommandCallback ; 
 import im . actor . core . viewmodel . UserEmail ; 
 import im . actor . core . viewmodel . UserPhone ; 
 @ @ - 60 , 8 + 62 , 8 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 private int baseColor ; 
 private CoverAvatarView avatarView ; 
 - SharedPreferences shp ; 
 - SharedPreferences . Editor ed ; 
 + protected SharedPreferences shp ; 
 + protected SharedPreferences . Editor ed ; 
 private boolean noPhones = false ; 
 private boolean noEmails = false ; 
 
 @ @ - 361 , 7 + 363 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 view . findViewById ( R . id . askQuestion ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View view ) { 
 - execute ( messenger ( ) . findUsers ( " 75551234567 " ) , R . string . progress _ common , new CommandCallback < UserVM [ ] > ( ) { 
 + execute ( messenger ( ) . findUsers ( ActorSDK . sharedActor ( ) . getDelegate ( ) . getHelpPhone ( ) ) , R . string . progress _ common , new CommandCallback < UserVM [ ] > ( ) { 
 @ Override 
 public void onResult ( UserVM [ ] res ) { 
 if ( res . length > = 1 ) { 
 @ @ - 453 , 44 + 455 , 51 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; 
 
 / / Wallpaper 
 - LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; 
 - wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 - ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; 
 - view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 - View . OnClickListener ocl = new View . OnClickListener ( ) { 
 - 
 - @ Override 
 - public void onClick ( final View v ) { 
 - Intent i = new Intent ( getActivity ( ) , PickWallpaperActivity . class ) ; 
 - int j = 0 ; 
 - Object tag = v . getTag ( ) ; 
 - if ( tag ! = null & & tag instanceof Integer ) { 
 - j = ( int ) tag ; 
 + if ( showWallpaperCategory ( ) ) { 
 + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; 
 + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; 
 + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + View . OnClickListener ocl = new View . OnClickListener ( ) { 
 + 
 + @ Override 
 + public void onClick ( final View v ) { 
 + Intent i = new Intent ( getActivity ( ) , PickWallpaperActivity . class ) ; 
 + int j = 0 ; 
 + Object tag = v . getTag ( ) ; 
 + if ( tag ! = null & & tag instanceof Integer ) { 
 + j = ( int ) tag ; 
 + } 
 + i . putExtra ( " EXTRA _ ID " , j ) ; 
 + startActivity ( i ) ; 
 } 
 - i . putExtra ( " EXTRA _ ID " , j ) ; 
 - startActivity ( i ) ; 
 + } ; 
 + int previewSize = 80 ; 
 + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; 
 + for ( int i = 0 ; i < 3 ; i + + ) { 
 + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; 
 + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; 
 + bckgrnd . init ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; 
 + bckgrnd . bind ( i ) ; 
 + / / bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; 
 + frame . setTag ( i ) ; 
 + frame . setOnClickListener ( ocl ) ; 
 + frame . addView ( bckgrnd ) ; 
 + wallpaperContainer . addView ( frame , params ) ; 
 + 
 } 
 - } ; 
 - int previewSize = 80 ; 
 - LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; 
 - for ( int i = 0 ; i < 3 ; i + + ) { 
 - FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; 
 - BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; 
 - bckgrnd . init ( Screen . dp ( previewSize ) , Screen . dp ( previewSize ) ) ; 
 - bckgrnd . bind ( i ) ; 
 - / / bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; 
 - frame . setTag ( i ) ; 
 - frame . setOnClickListener ( ocl ) ; 
 - frame . addView ( bckgrnd ) ; 
 - wallpaperContainer . addView ( frame , params ) ; 
 + TintImageView next = new TintImageView ( getActivity ( ) ) ; 
 + next . setResource ( R . drawable . ic _ keyboard _ arrow _ right _ white _ 36dp ) ; 
 + next . setTint ( style . getSettingsIconColor ( ) ) ; 
 + next . setOnClickListener ( ocl ) ; 
 + next . setTag ( - 1 ) ; 
 + wallpaperContainer . addView ( next , new LinearLayout . LayoutParams ( Screen . dp ( 40 ) , Screen . dp ( previewSize ) ) ) ; 
 
 + } else { 
 + view . findViewById ( R . id . background _ container ) . setVisibility ( View . GONE ) ; 
 + view . findViewById ( R . id . wallpaperDivider ) . setVisibility ( View . GONE ) ; 
 + view . findViewById ( R . id . settings _ wallpaper _ title ) . setVisibility ( View . GONE ) ; 
 } 
 - TintImageView next = new TintImageView ( getActivity ( ) ) ; 
 - next . setResource ( R . drawable . ic _ keyboard _ arrow _ right _ white _ 36dp ) ; 
 - next . setTint ( style . getSettingsIconColor ( ) ) ; 
 - next . setOnClickListener ( ocl ) ; 
 - next . setTag ( - 1 ) ; 
 - wallpaperContainer . addView ( next , new LinearLayout . LayoutParams ( Screen . dp ( 40 ) , Screen . dp ( previewSize ) ) ) ; 
 
 view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 @ @ - 615 , 6 + 624 , 20 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } 
 
 + public static String getWallpaperFile ( ) { 
 + File externalFile = messenger ( ) . getContext ( ) . getExternalFilesDir ( null ) ; 
 + if ( externalFile = = null ) { 
 + return null ; 
 + } 
 + String externalPath = externalFile . getAbsolutePath ( ) ; 
 + 
 + File dest = new File ( externalPath + " / actor / wallpapers / " ) ; 
 + dest . mkdirs ( ) ; 
 + 
 + File outputFile = new File ( dest , " customWallpaper " + " . jpg " ) ; 
 + return outputFile . getAbsolutePath ( ) ; 
 + } 
 + 
 @ Override 
 public void onResume ( ) { 
 super . onResume ( ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java 
 index b80f512 . . f2fd839 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / IActorSettingsFragment . java 
 @ @ - 15 , 6 + 15 , 8 @ @ public interface IActorSettingsFragment { 
 
 View getSettingsBottomView ( ) ; 
 
 + boolean showWallpaperCategory ( ) ; 
 + 
 ActorSettingsCategory [ ] getBeforeSettingsCategories ( ) ; 
 
 ActorSettingsCategory [ ] getAfterSettingsCategories ( ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 index 9822568 . . 7ee5ec4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 @ @ - 14 , 8 + 14 , 11 @ @ import com . facebook . imagepipeline . common . ResizeOptions ; 
 import com . facebook . imagepipeline . request . ImageRequest ; 
 import com . facebook . imagepipeline . request . ImageRequestBuilder ; 
 
 + import java . io . File ; 
 + 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsFragment ; 
 
 public class BackgroundPreviewView extends SimpleDraweeView { 
 
 @ @ - 53 , 19 + 56 , 38 @ @ public class BackgroundPreviewView extends SimpleDraweeView { 
 } 
 
 public void bind ( int i ) { 
 - int bkgrnd = getBackground ( i ) ; 
 - Uri uri = new Uri . Builder ( ) 
 - . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) 
 - . path ( String . valueOf ( bkgrnd ) ) 
 - . build ( ) ; 
 - ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 - . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 - . build ( ) ; 
 - PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 - . setOldController ( getController ( ) ) 
 - . setImageRequest ( request ) 
 - . build ( ) ; 
 - setController ( controller ) ; 
 + if ( i ! = BACKGROUNDS . length ) { 
 + int bkgrnd = getBackground ( i ) ; 
 + Uri uri = new Uri . Builder ( ) 
 + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) 
 + . path ( String . valueOf ( bkgrnd ) ) 
 + . build ( ) ; 
 + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 + . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 + . build ( ) ; 
 + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 + . setOldController ( getController ( ) ) 
 + . setImageRequest ( request ) 
 + . build ( ) ; 
 + setController ( controller ) ; 
 + } else { 
 + if ( BaseActorSettingsFragment . getWallpaperFile ( ) ! = null ) { 
 + File customWallpaper = new File ( BaseActorSettingsFragment . getWallpaperFile ( ) ) ; 
 + if ( ! customWallpaper . exists ( ) ) { 
 + return ; 
 + } 
 + Uri uri = Uri . fromFile ( customWallpaper ) ; 
 + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 + . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 + . build ( ) ; 
 + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 + . setOldController ( getController ( ) ) 
 + . setImageRequest ( request ) 
 + . build ( ) ; 
 + setController ( controller ) ; 
 + } 
 + } 
 + 
 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java 
 index 5e4b958 . . 6cda9a1 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / PagerSlidingTabStrip . java 
 @ @ - 107 , 7 + 107 , 7 @ @ public class PagerSlidingTabStrip extends FrameLayout { 
 
 tabsContainer = new LinearLayout ( context ) ; 
 tabsContainer . setOrientation ( LinearLayout . HORIZONTAL ) ; 
 - tabsContainer . setLayoutParams ( new LayoutParams ( LayoutParams . WRAP _ CONTENT , LayoutParams . MATCH _ PARENT ) ) ; 
 + tabsContainer . setLayoutParams ( new LayoutParams ( LayoutParams . MATCH _ PARENT , LayoutParams . MATCH _ PARENT ) ) ; 
 tabsContainer . setPadding ( tabsContainerPaddingLeft , tabsContainerPaddingTop , tabsContainerPaddingRight , tabsContainerPaddingBottom ) ; 
 addView ( tabsContainer ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index 9d36309 . . 35f78b5 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 1 , 5 + 1 , 7 @ @ 
 package im . actor ; 
 
 + import java . util . ArrayList ; 
 + 
 import im . actor . core . AuthState ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . BaseActorSDKDelegate ; 
 @ @ - 11 , 7 + 13 , 11 @ @ public class Application extends android . app . Application { 
 @ Override 
 public void onCreate ( ) { 
 super . onCreate ( ) ; 
 - ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 + / / ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 + ArrayList < String > endpoints = new ArrayList < String > ( ) ; 
 + endpoints . add ( " tls : / / front1 - tcp . llectro . com " ) ; 
 + endpoints . add ( " tls : / / front1 - tcp . llectro . com " ) ; 
 + ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; 
 ActorSDK . sharedActor ( ) . createActor ( this ) ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java 
 new file mode 100644 
 index 0000000 . . 12d46dc 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / auth / SignEmailFragment . java 
 @ @ - 0 , 0 + 1 , 130 @ @ 
 + package im . actor . auth ; 
 + 
 + import android . app . AlertDialog ; 
 + import android . os . Bundle ; 
 + import android . telephony . PhoneNumberFormattingTextWatcher ; 
 + import android . text . Editable ; 
 + import android . text . TextWatcher ; 
 + import android . view . KeyEvent ; 
 + import android . view . LayoutInflater ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . view . inputmethod . EditorInfo ; 
 + import android . widget . EditText ; 
 + import android . widget . TextView ; 
 + 
 + import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 + import im . actor . sdk . util . Fonts ; 
 + import im . actor . sdk . util . KeyboardHelper ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 + public class SignEmailFragment extends BaseAuthFragment { 
 + 
 + private EditText emailEditText ; 
 + private KeyboardHelper keyboardHelper ; 
 + 
 + @ Override 
 + public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 + View v = inflater . inflate ( R . layout . fragment _ sign _ email , container , false ) ; 
 + 
 + ( ( TextView ) v . findViewById ( R . id . button _ continue _ text ) ) . setTypeface ( Fonts . medium ( ) ) ; 
 + 
 + keyboardHelper = new KeyboardHelper ( getActivity ( ) ) ; 
 + 
 + initView ( v ) ; 
 + 
 + return v ; 
 + } 
 + 
 + @ Override 
 + public void onResume ( ) { 
 + super . onResume ( ) ; 
 + 
 + / / TODO track email auth open 
 + / / messenger ( ) . trackAuthPhoneOpen ( ) ; 
 + 
 + setTitle ( R . string . auth _ email _ title ) ; 
 + 
 + focusEmail ( ) ; 
 + 
 + keyboardHelper . setImeVisibility ( emailEditText , true ) ; 
 + } 
 + 
 + private void initView ( View v ) { 
 + 
 + emailEditText = ( EditText ) v . findViewById ( R . id . tv _ email ) ; 
 + emailEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; 
 + String email = messenger ( ) . getAuthEmail ( ) ; 
 + if ( email ! = null & & ! email . isEmpty ( ) ) { 
 + emailEditText . setText ( email ) ; 
 + } 
 + emailEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { 
 + @ Override 
 + public boolean onEditorAction ( TextView textView , int id , KeyEvent keyEvent ) { 
 + if ( id = = EditorInfo . IME _ ACTION _ GO ) { 
 + requestCode ( ) ; 
 + return true ; 
 + } 
 + return false ; 
 + } 
 + } ) ; 
 + emailEditText . addTextChangedListener ( new TextWatcher ( ) { 
 + @ Override 
 + public void beforeTextChanged ( CharSequence s , int start , int count , int after ) { 
 + 
 + } 
 + 
 + @ Override 
 + public void onTextChanged ( CharSequence s , int start , int before , int count ) { 
 + 
 + } 
 + 
 + @ Override 
 + public void afterTextChanged ( Editable s ) { 
 + / / TODO trackAuthEmailType 
 + / / messenger ( ) . trackAuthPhoneType ( emailEditText . getText ( ) . toString ( ) ) ; 
 + } 
 + } ) ; 
 + 
 + onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View view ) { 
 + requestCode ( ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + private void requestCode ( ) { 
 + final String ACTION = " Request code email " ; 
 + 
 + 
 + if ( emailEditText . getText ( ) . toString ( ) . trim ( ) . length ( ) = = 0 ) { 
 + String message = getString ( R . string . auth _ error _ empty _ email ) ; 
 + new AlertDialog . Builder ( getActivity ( ) ) 
 + . setMessage ( R . string . auth _ error _ empty _ email ) 
 + . setPositiveButton ( R . string . dialog _ ok , null ) 
 + . show ( ) ; 
 + return ; 
 + } 
 + 
 + String rawEmail = emailEditText . getText ( ) . toString ( ) ; 
 + 
 + if ( rawEmail . length ( ) = = 0 ) { 
 + String message = getString ( R . string . auth _ error _ empty _ email ) ; 
 + new AlertDialog . Builder ( getActivity ( ) ) 
 + . setMessage ( R . string . auth _ error _ empty _ email ) 
 + . setPositiveButton ( R . string . dialog _ ok , null ) 
 + . show ( ) ; 
 + return ; 
 + } 
 + executeAuth ( ActorSDK . sharedActor ( ) . getMessenger ( ) . requestStartEmailAuth ( rawEmail ) , ACTION ) ; 
 + } 
 + 
 + private void focusEmail ( ) { 
 + focus ( emailEditText ) ; 
 + } 
 + 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index e89067c . . 1492015 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 246 , 7 + 246 , 6 @ @ public class ActorSDK { 
 
 public void setDelegate ( ActorSDKDelegate delegate ) { 
 this . delegate = delegate ; 
 - activityManager . setSdkDelegate ( delegate ) ; 
 } 
 
 public ActivityManager getActivityManager ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index cdf9495 . . fc7de4f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 public interface ActorSDKDelegate { 
 @ @ - 27 , 4 + 28 , 6 @ @ public interface ActorSDKDelegate { 
 ActorIntent getStartIntent ( ) ; 
 
 AuthState getAuthStartState ( ) ; 
 + 
 + BaseAuthFragment getSignFragment ( ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 6a2eb02 . . 7a783a8 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 1 , 6 + 1 , 9 @ @ 
 package im . actor . sdk ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 + import im . actor . sdk . controllers . fragment . auth . BaseCustomAuthFragment ; 
 + import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 @ @ - 24 , 4 + 27 , 9 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 public AuthState getAuthStartState ( ) { 
 return AuthState . AUTH _ PHONE ; 
 } 
 + 
 + @ Override 
 + public BaseCustomAuthFragment getSignFragment ( ) { 
 + return new SignPhoneFragment ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 index d958ac5 . . b470921 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 @ @ - 14 , 6 + 14 , 7 @ @ import im . actor . core . network . RpcInternalException ; 
 import im . actor . core . network . RpcTimeoutException ; 
 import im . actor . core . viewmodel . Command ; 
 import im . actor . core . viewmodel . CommandCallback ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 @ @ - 26 , 6 + 27 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { 
 public static final String SIGN _ TYPE _ KEY = " sign _ type " ; 
 public static final int AUTH _ TYPE _ PHONE = 1 ; 
 public static final int AUTH _ TYPE _ EMAIL = 2 ; 
 + public static final int AUTH _ TYPE _ CUSTOM = 3 ; 
 public static final int SIGN _ TYPE _ IN = 3 ; 
 public static final int SIGN _ TYPE _ UP = 4 ; 
 private static final int OAUTH _ DIALOG = 1 ; 
 @ @ - 34 , 6 + 36 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { 
 private AuthState state ; 
 private int authType = AUTH _ TYPE _ PHONE ; 
 private int signType ; 
 + private BaseAuthFragment signFragment ; 
 
 
 @ Override 
 @ @ - 76 , 13 + 79 , 18 @ @ public class AuthActivity extends BaseFragmentActivity { 
 this . state = state ; 
 
 switch ( state ) { 
 - / / case AUTH _ START : 
 - / / Fragment chooseAuthFr = new ChooseAuthTypeFragment ( ) ; 
 - / / Bundle b = new Bundle ( ) ; 
 - / / b . putInt ( SIGN _ TYPE _ KEY , signType ) ; 
 - / / chooseAuthFr . setArguments ( b ) ; 
 - / / showFragment ( chooseAuthFr , false , false ) ; 
 - / / break ; 
 + case AUTH _ START : 
 + signFragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . getSignFragment ( ) ; 
 + showFragment ( signFragment , false , false ) ; 
 + if ( signFragment instanceof SignEmailFragment ) { 
 + authType = AUTH _ TYPE _ EMAIL ; 
 + } else if ( signFragment instanceof SignPhoneFragment ) { 
 + authType = AUTH _ TYPE _ PHONE ; 
 + } else { 
 + authType = AUTH _ TYPE _ CUSTOM ; 
 + } 
 + 
 + break ; 
 case AUTH _ EMAIL : 
 showFragment ( new SignEmailFragment ( ) , false , false ) ; 
 authType = AUTH _ TYPE _ EMAIL ; 
 @ @ - 91 , 6 + 99 , 7 @ @ public class AuthActivity extends BaseFragmentActivity { 
 showFragment ( new SignPhoneFragment ( ) , false , false ) ; 
 authType = AUTH _ TYPE _ PHONE ; 
 break ; 
 + case CODE _ VALIDATION _ CUSTOM : 
 case CODE _ VALIDATION _ PHONE : 
 case CODE _ VALIDATION _ EMAIL : 
 if ( ( state = = AuthState . CODE _ VALIDATION _ EMAIL & & authType = = AUTH _ TYPE _ PHONE ) | | ( state = = AuthState . CODE _ VALIDATION _ PHONE & & authType = = AUTH _ TYPE _ EMAIL ) ) { 
 @ @ - 100 , 6 + 109 , 10 @ @ public class AuthActivity extends BaseFragmentActivity { 
 Fragment signInFragment = new SignInFragment ( ) ; 
 Bundle args = new Bundle ( ) ; 
 args . putString ( " authType " , state = = AuthState . CODE _ VALIDATION _ EMAIL ? SignInFragment . AUTH _ TYPE _ EMAIL : SignInFragment . AUTH _ TYPE _ PHONE ) ; 
 + if ( state = = AuthState . CODE _ VALIDATION _ CUSTOM ) { 
 + BaseCustomAuthFragment customSignFragment = ( BaseCustomAuthFragment ) signFragment ; 
 + args . putString ( " authId " , customSignFragment . getAuthId ( ) ) ; 
 + } 
 signInFragment . setArguments ( args ) ; 
 showFragment ( signInFragment , false , false ) ; 
 break ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java 
 new file mode 100644 
 index 0000000 . . d0675fb 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / BaseCustomAuthFragment . java 
 @ @ - 0 , 0 + 1 , 19 @ @ 
 + package im . actor . sdk . controllers . fragment . auth ; 
 + 
 + / * * 
 + * Created by root on 10 / 20 / 15 . 
 + * / 
 + public class BaseCustomAuthFragment extends BaseAuthFragment { 
 + 
 + private String authId ; 
 + 
 + public String getAuthId ( ) { 
 + return authId ; 
 + } 
 + 
 + public void setAuthId ( String authId ) { 
 + this . authId = authId ; 
 + } 
 + 
 + 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java 
 index faa42d8 . . 4d7a328 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignInFragment . java 
 @ @ - 28 , 12 + 28 , 11 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public class SignInFragment extends BaseAuthFragment { 
 
 - private EditText codeEnterEditText ; 
 - private KeyboardHelper keyboardHelper ; 
 public static final String AUTH _ TYPE _ EMAIL = " auth _ type _ email " ; 
 public static final String AUTH _ TYPE _ PHONE = " auth _ type _ phone " ; 
 - 
 String authType ; 
 + private EditText codeEnterEditText ; 
 + private KeyboardHelper keyboardHelper ; 
 
 @ Override 
 public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 @ @ - 56 , 12 + 55 , 18 @ @ public class SignInFragment extends BaseAuthFragment { 
 ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( 
 Html . fromHtml ( getString ( R . string . auth _ code _ phone _ hint ) . replace ( " { 0 } " , " < b > " + phoneNumber + " < / b > " ) ) 
 ) ; 
 - } else { 
 + } else if ( authType . equals ( AUTH _ TYPE _ EMAIL ) ) { 
 String email = messenger ( ) . getAuthEmail ( ) ; 
 ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( 
 Html . fromHtml ( getString ( R . string . auth _ code _ email _ hint ) . replace ( " { 0 } " , " < b > " + email + " < / b > " ) ) 
 ) ; 
 } 
 + / / else { 
 + / / String authId = getArguments ( ) . getString ( " authId " ) ; 
 + / / ( ( TextView ) v . findViewById ( R . id . sendHint ) ) . setText ( 
 + / / Html . fromHtml ( getString ( R . string . auth _ code _ email _ hint ) . replace ( " { 0 } " , " < b > " + email + " < / b > " ) ) 
 + / / ) ; 
 + / / } 
 
 codeEnterEditText = ( EditText ) v . findViewById ( R . id . et _ sms _ code _ enter ) ; 
 codeEnterEditText . addTextChangedListener ( new TextWatcher ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java 
 index f17b04d . . ed60801 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / SignPhoneFragment . java 
 @ @ - 26 , 7 + 26 , 7 @ @ import im . actor . sdk . util . KeyboardHelper ; 
 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 - public class SignPhoneFragment extends BaseAuthFragment { 
 + public class SignPhoneFragment extends BaseCustomAuthFragment { 
 
 private static final int REQUEST _ COUNTRY = 0 ; 
 
 @ @ - 291 , 4 + 291 , 14 @ @ public class SignPhoneFragment extends BaseAuthFragment { 
 data . getIntExtra ( " country _ id " , 0 ) ) ) ; 
 } 
 } 
 + 
 + @ Override 
 + public String getAuthId ( ) { 
 + return super . getAuthId ( ) ; 
 + } 
 + 
 + @ Override 
 + public void setAuthId ( String authId ) { 
 + super . setAuthId ( authId ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java 
 index 30c8f44 . . dd19ba4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java 
 @ @ - 4 , 6 + 4 , 7 @ @ import android . content . Context ; 
 import android . content . Intent ; 
 import android . os . Bundle ; 
 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKDelegate ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 @ @ - 12 , 14 + 13 , 14 @ @ import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 * Created by root on 10 / 20 / 15 . 
 * / 
 public class ActivityManager { 
 - private ActorSDKDelegate sdkDelegate ; 
 + 
 
 public void startAuthActivity ( Context context ) { 
 startAuthActivity ( context , null ) ; 
 } 
 
 public void startAuthActivity ( Context context , Bundle extras ) { 
 - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { 
 startActivity ( context , extras , AuthActivity . class ) ; 
 } 
 } 
 @ @ - 29 , 7 + 30 , 7 @ @ public class ActivityManager { 
 } 
 
 public void startAfterLoginActivity ( Context context , Bundle extras ) { 
 - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { 
 startActivity ( context , extras , ActorMainActivity . class ) ; 
 } 
 } 
 @ @ - 39 , 14 + 40 , 14 @ @ public class ActivityManager { 
 } 
 
 public void startMessagingActivity ( Context context , Bundle extras ) { 
 - if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + if ( ! startDelegateActivity ( context , ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) , extras ) ) { 
 startActivity ( context , extras , ActorMainActivity . class ) ; 
 } 
 } 
 
 private boolean startDelegateActivity ( Context context , ActorIntent intent , Bundle extras ) { 
 if ( intent ! = null & & intent instanceof ActorIntentActivity ) { 
 - Intent startIntent = ( ( ActorIntentActivity ) sdkDelegate . getAuthStartIntent ( ) ) . getIntent ( ) ; 
 + Intent startIntent = ( ( ActorIntentActivity ) ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartIntent ( ) ) . getIntent ( ) ; 
 if ( extras ! = null ) { 
 startIntent . putExtras ( extras ) ; 
 } 
 @ @ - 67 , 7 + 68 , 4 @ @ public class ActivityManager { 
 } 
 
 
 - public void setSdkDelegate ( ActorSDKDelegate sdkDelegate ) { 
 - this . sdkDelegate = sdkDelegate ; 
 - } 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java 
 index 515c06a . . 5ac498d 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / AuthState . java 
 @ @ - 13 , 6 + 13 , 7 @ @ public enum AuthState { 
 AUTH _ PHONE , 
 CODE _ VALIDATION _ PHONE , 
 CODE _ VALIDATION _ EMAIL , 
 + CODE _ VALIDATION _ CUSTOM , 
 GET _ OAUTH _ PARAMS , 
 COMPLETE _ OAUTH , 
 SIGN _ UP ,
