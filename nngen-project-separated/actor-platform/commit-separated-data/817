BLEU SCORE: 0.33180774028439425

TEST MSG: fix ( core ) : Fixing outgoing call non - answering state
GENERATED MSG: fix ( core ) : end call if already on call

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java < nl > index b60d213 . . 59a2d11 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java < nl > @ @ - 104 , 6 + 104 , 9 @ @ public class CallActor extends AbsCallActor { < nl > callVM . getState ( ) . change ( CallState . IN _ PROGRESS ) ; < nl > callVM . setCallStart ( im . actor . runtime . Runtime . getCurrentTime ( ) ) ; < nl > } < nl > + if ( isMaster ) { < nl > + callManager . send ( new CallManagerActor . OnCallAnswered ( callId ) , self ( ) ) ; < nl > + } < nl > } < nl > < nl > @ Override < nl > @ @ - 121 , 6 + 124 , 7 @ @ public class CallActor extends AbsCallActor { < nl > public void onAnswerCall ( ) { < nl > if ( ! isAnswered & & ! isRejected ) { < nl > isAnswered = true ; < nl > + callBus . startOwn ( ) ; < nl > request ( new RequestJoinCall ( callId ) ) ; < nl > < nl > if ( isActive ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java < nl > index 025cf33 . . a561e18 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java < nl > @ @ - 124 , 6 + 124 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { < nl > peerCall . onMuteChanged ( isMuted ) ; < nl > } < nl > < nl > + public void onOwnAnswered ( ) { < nl > + peerCall . onOwnStarted ( ) ; < nl > + } < nl > + < nl > / / < nl > / / Event Bus handler < nl > / / < nl > @ @ - 223 , 11 + 227 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { < nl > joinBus ( ( ( JoinBus ) message ) . getBusId ( ) ) ; < nl > } else if ( message instanceof CreateBus ) { < nl > createBus ( ) ; < nl > - } else if ( message instanceof SendSignal ) { < nl > - SendSignal signal = ( SendSignal ) message ; < nl > - sendSignal ( signal . getDeviceId ( ) , signal . getSignal ( ) ) ; < nl > } else if ( message instanceof Mute ) { < nl > onChangeMute ( ( ( Mute ) message ) . isMuted ( ) ) ; < nl > + } else if ( message instanceof OnAnswered ) { < nl > + onOwnAnswered ( ) ; < nl > } else { < nl > super . onReceive ( message ) ; < nl > } < nl > @ @ - 250 , 25 + 253 , 6 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { < nl > < nl > } < nl > < nl > - public static class SendSignal { < nl > - < nl > - private long deviceId ; < nl > - private ApiWebRTCSignaling signal ; < nl > - < nl > - public SendSignal ( long deviceId , ApiWebRTCSignaling signal ) { < nl > - this . deviceId = deviceId ; < nl > - this . signal = signal ; < nl > - } < nl > - < nl > - public long getDeviceId ( ) { < nl > - return deviceId ; < nl > - } < nl > - < nl > - public ApiWebRTCSignaling getSignal ( ) { < nl > - return signal ; < nl > - } < nl > - } < nl > - < nl > public static class Mute { < nl > private boolean isMuted ; < nl > < nl > @ @ - 281 , 6 + 265 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { < nl > } < nl > } < nl > < nl > + public static class OnAnswered { < nl > + < nl > + } < nl > + < nl > public class CallbackWrapper implements PeerCallCallback { < nl > < nl > private final PeerCallCallback callCallback ; < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java < nl > index e2468b5 . . 7685c89 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java < nl > @ @ - 17 , 7 + 17 , 11 @ @ public class CallBusInt extends ActorInterface { < nl > send ( new CallBusActor . CreateBus ( ) ) ; < nl > } < nl > < nl > - public void changeMute ( boolean isMuted ) { < nl > + public void changeMute ( boolean isMuted ) { < nl > send ( new CallBusActor . Mute ( isMuted ) ) ; < nl > } < nl > + < nl > + public void startOwn ( ) { < nl > + send ( new CallBusActor . OnAnswered ( ) ) ; < nl > + } < nl > } < nl > \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index 47680b6 . . 65dbbff 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . DeviceCategory ; < nl > import im . actor . core . PlatformType ; < nl > import im . actor . core . entity . content . AbsContent ; < nl > import im . actor . core . modules . events . IncomingCall ; < nl > + import im . actor . core . modules . internal . CallsModule ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . ActorContext ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > @ @ - 145 , 6 + 146 , 11 @ @ public class ActorSDK { < nl > * / < nl > private ActivityManager activityManager = new ActivityManager ( ) ; < nl > < nl > + / * * < nl > + * Call enabled < nl > + * / < nl > + private boolean callsEnabled = false ; < nl > + < nl > private ActorSDK ( ) { < nl > endpoints = new String [ ] { < nl > " tls : / / front1 - mtproto - api - rev2 . actor . im " , < nl > @ @ - 503 , 6 + 509 , 15 @ @ public class ActorSDK { < nl > this . twitter = twitter ; < nl > } < nl > < nl > + public void setCallsEnabled ( boolean callsEnabled ) { < nl > + this . callsEnabled = callsEnabled ; < nl > + CallsModule . CALLS _ ENABLED = callsEnabled ; < nl > + } < nl > + < nl > + public boolean isCallsEnabled ( ) { < nl > + return callsEnabled ; < nl > + } < nl > + < nl > / * * < nl > * Getting Application Delegate . < nl > * < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index ae0b10b . . 23f1b50 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 1009 , 6 + 1009 , 14 @ @ public class Messenger { < nl > / / Calls < nl > / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > < nl > + / * * < nl > + * Command for doing call < nl > + * < nl > + * @ param uid user you want to call < nl > + * @ param callCallback ui callback < nl > + * @ return command to execute < nl > + * / < nl > + @ ObjectiveCName ( " doCallWithUid : withCallback " ) < nl > public Command < ResponseDoCall > doCall ( int uid , CallsModule . CallCallback callCallback ) { < nl > return modules . getCallsModule ( ) . makeCall ( uid , callCallback ) ; < nl > } < nl > @ @ - 1017 , 10 + 1025 , 23 @ @ public class Messenger { < nl > modules . getCallsModule ( ) . endCall ( callId ) ; < nl > } < nl > < nl > - public void answerCall ( long callId , CallsModule . CallCallback callback ) { < nl > + / * * < nl > + * Handle call in ui - < b > should < b / > be called , when receiving IncomingCallEvent < nl > + * @ param callId < nl > + * @ param callback < nl > + * / < nl > + @ ObjectiveCName ( " handleCallWithCallId : withCallback : " ) < nl > + public void handleCall ( long callId , CallsModule . CallCallback callback ) { < nl > modules . getCallsModule ( ) . handleCall ( callId , callback ) ; < nl > } < nl > < nl > + / * * < nl > + * Send call signaling < nl > + * < nl > + * @ param callId call id < nl > + * @ param data signal object to send < nl > + * / < nl > + @ ObjectiveCName ( " sendCallSignalWithCallId : withData : " ) < nl > public void sendCallSignal ( long callId , AbsSignal data ) { < nl > modules . getCallsModule ( ) . sendSignal ( callId , data ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java < nl > index 7f5e078 . . aed8460 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java < nl > @ @ - 32 , 11 + 32 , 12 @ @ public class CallsModule extends AbsModule { < nl > < nl > < nl > public static final int CALL _ TIMEOUT = 10 ; < nl > - public boolean callsEnabled = true ; < nl > + public static boolean CALLS _ ENABLED = false ; < nl > + public static boolean MULTIPLE _ CALLS _ ENABLED = false ; < nl > HashMap < Long , ActorRef > calls = new HashMap < Long , ActorRef > ( ) ; < nl > < nl > public void run ( ) { < nl > - if ( callsEnabled ) { < nl > + if ( CALLS _ ENABLED ) { < nl > request ( new RequestSubscribeToCalls ( ) ) ; < nl > } < nl > } < nl > @ @ - 79 , 6 + 80 , 9 @ @ public class CallsModule extends AbsModule { < nl > ActorRef call = calls . get ( callId ) ; < nl > if ( call ! = null ) { < nl > call . send ( new CallActor . HandleCall ( callback ) ) ; < nl > + } else { < nl > + / / can ' t find call - close fragment < nl > + callback . onCallEnd ( ) ; < nl > } < nl > } < nl > < nl > @ @ - 92 , 6 + 96 , 7 @ @ public class CallsModule extends AbsModule { < nl > } < nl > < nl > public void onIncomingCall ( final long callId , int uid ) { < nl > + < nl > if ( ! calls . keySet ( ) . contains ( callId ) ) { < nl > calls . put ( callId , < nl > ActorSystem . system ( ) . actorOf ( Props . create ( CallActor . class , new ActorCreator < CallActor > ( ) { < nl > @ @ - 100 , 8 + 105 , 13 @ @ public class CallsModule extends AbsModule { < nl > return new CallActor ( callId , context ( ) ) ; < nl > } < nl > } ) , " actor / call " ) ) ; < nl > - context ( ) . getEvents ( ) . post ( new IncomingCall ( callId , uid ) ) ; < nl > + if ( ! MULTIPLE _ CALLS _ ENABLED & calls . keySet ( ) . size ( ) > 0 ) { < nl > + calls . get ( callId ) . send ( new CallActor . EndCall ( ) ) ; < nl > + } else { < nl > + context ( ) . getEvents ( ) . post ( new IncomingCall ( callId , uid ) ) ; < nl > + } < nl > } < nl > + < nl > } < nl > < nl > / / on end call update < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > index 123e199 . . f95c43e 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > @ @ - 33 , 6 + 33 , 7 @ @ public class CallActor extends ModuleActor { < nl > public void preStart ( ) { < nl > super . preStart ( ) ; < nl > self ( ) . send ( new SendCallInProgress ( ) ) ; < nl > + self ( ) . send ( new CheckCallIsHandled ( ) , 1500 ) ; < nl > } < nl > < nl > @ Override < nl > @ @ - 49 , 6 + 50 , 25 @ @ public class CallActor extends ModuleActor { < nl > onSignal ( ( ( Signal ) message ) . getData ( ) ) ; < nl > } else if ( message instanceof HandleCall ) { < nl > onHandleCall ( ( ( HandleCall ) message ) . getCallback ( ) ) ; < nl > + } else if ( message instanceof CheckCallIsHandled ) { < nl > + checkCallHandled ( ) ; < nl > + } < nl > + } < nl > + < nl > + private void checkCallHandled ( ) { < nl > + if ( callback = = null ) { < nl > + / / don ' t want to wait for fragment forever < nl > + callback = new CallsModule . CallCallback ( ) { < nl > + @ Override < nl > + public void onCallEnd ( ) { < nl > + < nl > + } < nl > + < nl > + @ Override < nl > + public void onSignal ( byte [ ] data ) { < nl > + < nl > + } < nl > + } ; < nl > } < nl > } < nl > < nl > @ @ - 62 , 6 + 82 , 7 @ @ public class CallActor extends ModuleActor { < nl > < nl > public void onEndCall ( ) { < nl > if ( callback = = null ) { < nl > + / / fragment not yet created ? < nl > self ( ) . send ( new EndCall ( ) , 500 ) ; < nl > return ; < nl > } < nl > @ @ - 153 , 4 + 174 , 8 @ @ public class CallActor extends ModuleActor { < nl > private static class SendCallInProgress { < nl > < nl > } < nl > + < nl > + private static class CheckCallIsHandled { < nl > + < nl > + } < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java 
 index b60d213 . . 59a2d11 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallActor . java 
 @ @ - 104 , 6 + 104 , 9 @ @ public class CallActor extends AbsCallActor { 
 callVM . getState ( ) . change ( CallState . IN _ PROGRESS ) ; 
 callVM . setCallStart ( im . actor . runtime . Runtime . getCurrentTime ( ) ) ; 
 } 
 + if ( isMaster ) { 
 + callManager . send ( new CallManagerActor . OnCallAnswered ( callId ) , self ( ) ) ; 
 + } 
 } 
 
 @ Override 
 @ @ - 121 , 6 + 124 , 7 @ @ public class CallActor extends AbsCallActor { 
 public void onAnswerCall ( ) { 
 if ( ! isAnswered & & ! isRejected ) { 
 isAnswered = true ; 
 + callBus . startOwn ( ) ; 
 request ( new RequestJoinCall ( callId ) ) ; 
 
 if ( isActive ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java 
 index 025cf33 . . a561e18 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusActor . java 
 @ @ - 124 , 6 + 124 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { 
 peerCall . onMuteChanged ( isMuted ) ; 
 } 
 
 + public void onOwnAnswered ( ) { 
 + peerCall . onOwnStarted ( ) ; 
 + } 
 + 
 / / 
 / / Event Bus handler 
 / / 
 @ @ - 223 , 11 + 227 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { 
 joinBus ( ( ( JoinBus ) message ) . getBusId ( ) ) ; 
 } else if ( message instanceof CreateBus ) { 
 createBus ( ) ; 
 - } else if ( message instanceof SendSignal ) { 
 - SendSignal signal = ( SendSignal ) message ; 
 - sendSignal ( signal . getDeviceId ( ) , signal . getSignal ( ) ) ; 
 } else if ( message instanceof Mute ) { 
 onChangeMute ( ( ( Mute ) message ) . isMuted ( ) ) ; 
 + } else if ( message instanceof OnAnswered ) { 
 + onOwnAnswered ( ) ; 
 } else { 
 super . onReceive ( message ) ; 
 } 
 @ @ - 250 , 25 + 253 , 6 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { 
 
 } 
 
 - public static class SendSignal { 
 - 
 - private long deviceId ; 
 - private ApiWebRTCSignaling signal ; 
 - 
 - public SendSignal ( long deviceId , ApiWebRTCSignaling signal ) { 
 - this . deviceId = deviceId ; 
 - this . signal = signal ; 
 - } 
 - 
 - public long getDeviceId ( ) { 
 - return deviceId ; 
 - } 
 - 
 - public ApiWebRTCSignaling getSignal ( ) { 
 - return signal ; 
 - } 
 - } 
 - 
 public static class Mute { 
 private boolean isMuted ; 
 
 @ @ - 281 , 6 + 265 , 10 @ @ public class CallBusActor extends EventBusActor implements PeerCallCallback { 
 } 
 } 
 
 + public static class OnAnswered { 
 + 
 + } 
 + 
 public class CallbackWrapper implements PeerCallCallback { 
 
 private final PeerCallCallback callCallback ; 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java 
 index e2468b5 . . 7685c89 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / CallBusInt . java 
 @ @ - 17 , 7 + 17 , 11 @ @ public class CallBusInt extends ActorInterface { 
 send ( new CallBusActor . CreateBus ( ) ) ; 
 } 
 
 - public void changeMute ( boolean isMuted ) { 
 + public void changeMute ( boolean isMuted ) { 
 send ( new CallBusActor . Mute ( isMuted ) ) ; 
 } 
 + 
 + public void startOwn ( ) { 
 + send ( new CallBusActor . OnAnswered ( ) ) ; 
 + } 
 } 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index 47680b6 . . 65dbbff 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . DeviceCategory ; 
 import im . actor . core . PlatformType ; 
 import im . actor . core . entity . content . AbsContent ; 
 import im . actor . core . modules . events . IncomingCall ; 
 + import im . actor . core . modules . internal . CallsModule ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . ActorContext ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 @ @ - 145 , 6 + 146 , 11 @ @ public class ActorSDK { 
 * / 
 private ActivityManager activityManager = new ActivityManager ( ) ; 
 
 + / * * 
 + * Call enabled 
 + * / 
 + private boolean callsEnabled = false ; 
 + 
 private ActorSDK ( ) { 
 endpoints = new String [ ] { 
 " tls : / / front1 - mtproto - api - rev2 . actor . im " , 
 @ @ - 503 , 6 + 509 , 15 @ @ public class ActorSDK { 
 this . twitter = twitter ; 
 } 
 
 + public void setCallsEnabled ( boolean callsEnabled ) { 
 + this . callsEnabled = callsEnabled ; 
 + CallsModule . CALLS _ ENABLED = callsEnabled ; 
 + } 
 + 
 + public boolean isCallsEnabled ( ) { 
 + return callsEnabled ; 
 + } 
 + 
 / * * 
 * Getting Application Delegate . 
 * 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index ae0b10b . . 23f1b50 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 1009 , 6 + 1009 , 14 @ @ public class Messenger { 
 / / Calls 
 / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 
 + / * * 
 + * Command for doing call 
 + * 
 + * @ param uid user you want to call 
 + * @ param callCallback ui callback 
 + * @ return command to execute 
 + * / 
 + @ ObjectiveCName ( " doCallWithUid : withCallback " ) 
 public Command < ResponseDoCall > doCall ( int uid , CallsModule . CallCallback callCallback ) { 
 return modules . getCallsModule ( ) . makeCall ( uid , callCallback ) ; 
 } 
 @ @ - 1017 , 10 + 1025 , 23 @ @ public class Messenger { 
 modules . getCallsModule ( ) . endCall ( callId ) ; 
 } 
 
 - public void answerCall ( long callId , CallsModule . CallCallback callback ) { 
 + / * * 
 + * Handle call in ui - < b > should < b / > be called , when receiving IncomingCallEvent 
 + * @ param callId 
 + * @ param callback 
 + * / 
 + @ ObjectiveCName ( " handleCallWithCallId : withCallback : " ) 
 + public void handleCall ( long callId , CallsModule . CallCallback callback ) { 
 modules . getCallsModule ( ) . handleCall ( callId , callback ) ; 
 } 
 
 + / * * 
 + * Send call signaling 
 + * 
 + * @ param callId call id 
 + * @ param data signal object to send 
 + * / 
 + @ ObjectiveCName ( " sendCallSignalWithCallId : withData : " ) 
 public void sendCallSignal ( long callId , AbsSignal data ) { 
 modules . getCallsModule ( ) . sendSignal ( callId , data ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java 
 index 7f5e078 . . aed8460 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / CallsModule . java 
 @ @ - 32 , 11 + 32 , 12 @ @ public class CallsModule extends AbsModule { 
 
 
 public static final int CALL _ TIMEOUT = 10 ; 
 - public boolean callsEnabled = true ; 
 + public static boolean CALLS _ ENABLED = false ; 
 + public static boolean MULTIPLE _ CALLS _ ENABLED = false ; 
 HashMap < Long , ActorRef > calls = new HashMap < Long , ActorRef > ( ) ; 
 
 public void run ( ) { 
 - if ( callsEnabled ) { 
 + if ( CALLS _ ENABLED ) { 
 request ( new RequestSubscribeToCalls ( ) ) ; 
 } 
 } 
 @ @ - 79 , 6 + 80 , 9 @ @ public class CallsModule extends AbsModule { 
 ActorRef call = calls . get ( callId ) ; 
 if ( call ! = null ) { 
 call . send ( new CallActor . HandleCall ( callback ) ) ; 
 + } else { 
 + / / can ' t find call - close fragment 
 + callback . onCallEnd ( ) ; 
 } 
 } 
 
 @ @ - 92 , 6 + 96 , 7 @ @ public class CallsModule extends AbsModule { 
 } 
 
 public void onIncomingCall ( final long callId , int uid ) { 
 + 
 if ( ! calls . keySet ( ) . contains ( callId ) ) { 
 calls . put ( callId , 
 ActorSystem . system ( ) . actorOf ( Props . create ( CallActor . class , new ActorCreator < CallActor > ( ) { 
 @ @ - 100 , 8 + 105 , 13 @ @ public class CallsModule extends AbsModule { 
 return new CallActor ( callId , context ( ) ) ; 
 } 
 } ) , " actor / call " ) ) ; 
 - context ( ) . getEvents ( ) . post ( new IncomingCall ( callId , uid ) ) ; 
 + if ( ! MULTIPLE _ CALLS _ ENABLED & calls . keySet ( ) . size ( ) > 0 ) { 
 + calls . get ( callId ) . send ( new CallActor . EndCall ( ) ) ; 
 + } else { 
 + context ( ) . getEvents ( ) . post ( new IncomingCall ( callId , uid ) ) ; 
 + } 
 } 
 + 
 } 
 
 / / on end call update 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 index 123e199 . . f95c43e 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 @ @ - 33 , 6 + 33 , 7 @ @ public class CallActor extends ModuleActor { 
 public void preStart ( ) { 
 super . preStart ( ) ; 
 self ( ) . send ( new SendCallInProgress ( ) ) ; 
 + self ( ) . send ( new CheckCallIsHandled ( ) , 1500 ) ; 
 } 
 
 @ Override 
 @ @ - 49 , 6 + 50 , 25 @ @ public class CallActor extends ModuleActor { 
 onSignal ( ( ( Signal ) message ) . getData ( ) ) ; 
 } else if ( message instanceof HandleCall ) { 
 onHandleCall ( ( ( HandleCall ) message ) . getCallback ( ) ) ; 
 + } else if ( message instanceof CheckCallIsHandled ) { 
 + checkCallHandled ( ) ; 
 + } 
 + } 
 + 
 + private void checkCallHandled ( ) { 
 + if ( callback = = null ) { 
 + / / don ' t want to wait for fragment forever 
 + callback = new CallsModule . CallCallback ( ) { 
 + @ Override 
 + public void onCallEnd ( ) { 
 + 
 + } 
 + 
 + @ Override 
 + public void onSignal ( byte [ ] data ) { 
 + 
 + } 
 + } ; 
 } 
 } 
 
 @ @ - 62 , 6 + 82 , 7 @ @ public class CallActor extends ModuleActor { 
 
 public void onEndCall ( ) { 
 if ( callback = = null ) { 
 + / / fragment not yet created ? 
 self ( ) . send ( new EndCall ( ) , 500 ) ; 
 return ; 
 } 
 @ @ - 153 , 4 + 174 , 8 @ @ public class CallActor extends ModuleActor { 
 private static class SendCallInProgress { 
 
 } 
 + 
 + private static class CheckCallIsHandled { 
 + 
 + } 
 }
