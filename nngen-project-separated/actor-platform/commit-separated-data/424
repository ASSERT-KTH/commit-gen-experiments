BLEU SCORE: 0.08032276872815308

TEST MSG: ref ( core ) : request - > api in Push and Security modules
GENERATED MSG: feat ( core + js ) : Adding chat hiding

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java < nl > index 895db56 . . 3ed6405 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java < nl > @ @ - 62 , 23 + 62 , 13 @ @ public class PushRegisterActor extends ModuleActor { < nl > return ; < nl > } < nl > < nl > - < nl > preferences ( ) . putBool ( " push . google " , true ) ; < nl > preferences ( ) . putBool ( " push . google . registered " , false ) ; < nl > preferences ( ) . putLong ( " push . google . id " , projectId ) ; < nl > preferences ( ) . putString ( " push . google . token " , token ) ; < nl > < nl > - request ( new RequestRegisterGooglePush ( projectId , token ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - preferences ( ) . putBool ( " push . google . registered " , true ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( RpcException e ) { < nl > - e . printStackTrace ( ) ; < nl > - } < nl > - } ) ; < nl > + api ( new RequestRegisterGooglePush ( projectId , token ) ) < nl > + . then ( r - > preferences ( ) . putBool ( " push . google . registered " , true ) ) ; < nl > } < nl > < nl > private void registerApplePush ( int apnsId , String token ) { < nl > @ @ - 95 , 17 + 85 , 8 @ @ public class PushRegisterActor extends ModuleActor { < nl > preferences ( ) . putInt ( " push . apple . id " , apnsId ) ; < nl > preferences ( ) . putString ( " push . apple . token " , token ) ; < nl > < nl > - request ( new RequestRegisterApplePush ( apnsId , token ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - preferences ( ) . putBool ( " push . apple . registered " , true ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( RpcException e ) { < nl > - < nl > - } < nl > - } ) ; < nl > + api ( new RequestRegisterApplePush ( apnsId , token ) ) < nl > + . then ( r - > preferences ( ) . putBool ( " push . apple . registered " , true ) ) ; < nl > } < nl > < nl > private void registerApplePushKit ( int apnsId , String token ) { < nl > @ @ - 122 , 17 + 103 , 8 @ @ public class PushRegisterActor extends ModuleActor { < nl > preferences ( ) . putInt ( " push . apple _ puskkit . id " , apnsId ) ; < nl > preferences ( ) . putString ( " push . apple _ puskkit . token " , token ) ; < nl > < nl > - request ( new RequestRegisterApplePushKit ( apnsId , token ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - preferences ( ) . putBool ( " push . apple _ puskkit . registered " , true ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( RpcException e ) { < nl > - < nl > - } < nl > - } ) ; < nl > + api ( new RequestRegisterApplePushKit ( apnsId , token ) ) < nl > + . then ( r - > preferences ( ) . putBool ( " push . apple _ puskkit . registered " , true ) ) ; < nl > } < nl > < nl > private void registerActorPush ( String endpoint ) { < nl > @ @ - 147 , 17 + 119 , 8 @ @ public class PushRegisterActor extends ModuleActor { < nl > preferences ( ) . putBool ( " push . actor . registered " , false ) ; < nl > preferences ( ) . putString ( " push . actor . endpoint " , endpoint ) ; < nl > < nl > - request ( new RequestRegisterActorPush ( endpoint , new ArrayList < > ( ) ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - preferences ( ) . putBool ( " push . actor . registered " , true ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( RpcException e ) { < nl > - < nl > - } < nl > - } ) ; < nl > + api ( new RequestRegisterActorPush ( endpoint , new ArrayList < > ( ) ) ) < nl > + . then ( r - > preferences ( ) . putBool ( " push . actor . registered " , true ) ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java < nl > index 2f9851a . . bbc2b00 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java < nl > @ @ - 11 , 13 + 11 , 10 @ @ import im . actor . core . api . rpc . RequestGetAuthSessions ; < nl > import im . actor . core . api . rpc . RequestTerminateAllSessions ; < nl > import im . actor . core . api . rpc . RequestTerminateSession ; < nl > import im . actor . core . api . rpc . ResponseGetAuthSessions ; < nl > - import im . actor . core . api . rpc . ResponseVoid ; < nl > import im . actor . core . modules . AbsModule ; < nl > import im . actor . core . modules . ModuleContext ; < nl > - import im . actor . core . network . RpcCallback ; < nl > - import im . actor . core . network . RpcException ; < nl > - import im . actor . core . viewmodel . Command ; < nl > - import im . actor . core . viewmodel . CommandCallback ; < nl > + import im . actor . runtime . actors . messages . Void ; < nl > + import im . actor . runtime . promise . Promise ; < nl > < nl > public class SecurityModule extends AbsModule { < nl > < nl > @ @ - 25 , 45 + 22 , 18 @ @ public class SecurityModule extends AbsModule { < nl > super ( context ) ; < nl > } < nl > < nl > - public Command < List < ApiAuthSession > > loadSessions ( ) { < nl > - return callback - > request ( new RequestGetAuthSessions ( ) , new RpcCallback < ResponseGetAuthSessions > ( ) { < nl > - @ Override < nl > - public void onResult ( final ResponseGetAuthSessions response ) { < nl > - runOnUiThread ( ( ) - > callback . onResult ( response . getUserAuths ( ) ) ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( final RpcException e ) { < nl > - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; < nl > - } < nl > - } ) ; < nl > + public Promise < List < ApiAuthSession > > loadSessions ( ) { < nl > + return api ( new RequestGetAuthSessions ( ) ) < nl > + . map ( ResponseGetAuthSessions : : getUserAuths ) ; < nl > } < nl > < nl > - public Command < Boolean > terminateAllSessions ( ) { < nl > - return callback - > request ( new RequestTerminateAllSessions ( ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - runOnUiThread ( ( ) - > callback . onResult ( true ) ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( final RpcException e ) { < nl > - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; < nl > - } < nl > - } ) ; < nl > + public Promise < Void > terminateAllSessions ( ) { < nl > + return api ( new RequestTerminateAllSessions ( ) ) < nl > + . map ( r - > null ) ; < nl > } < nl > < nl > - public Command < Boolean > terminateSession ( final int id ) { < nl > - return callback - > request ( new RequestTerminateSession ( id ) , new RpcCallback < ResponseVoid > ( ) { < nl > - @ Override < nl > - public void onResult ( ResponseVoid response ) { < nl > - runOnUiThread ( ( ) - > callback . onResult ( true ) ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public void onError ( final RpcException e ) { < nl > - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; < nl > - } < nl > - } ) ; < nl > + public Promise < Void > terminateSession ( int id ) { < nl > + return api ( new RequestTerminateSession ( id ) ) < nl > + . map ( r - > null ) ; < nl > } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > index 11f85fc . . f431f95 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > @ @ - 462 , 6 + 462 , 27 @ @ public class JsFacade implements Exportable { < nl > } ) ; < nl > } < nl > < nl > + public JsPromise hideChat ( final JsPeer peer ) { < nl > + return JsPromise . create ( new JsPromiseExecutor ( ) { < nl > + @ Override < nl > + public void execute ( ) { < nl > + messenger . hideChat ( peer . convert ( ) ) . start ( new CommandCallback < Boolean > ( ) { < nl > + @ Override < nl > + public void onResult ( Boolean res ) { < nl > + Log . d ( TAG , " hideChat : result " ) ; < nl > + resolve ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + Log . d ( TAG , " hideChat : error " ) ; < nl > + reject ( e . getMessage ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > / / Peers < nl > < nl > public JsPeer getUserPeer ( int uid ) { < nl > @ @ - 858 , 7 + 879 , 7 @ @ public class JsFacade implements Exportable { < nl > return JsPromise . create ( new JsPromiseExecutor ( ) { < nl > @ Override < nl > public void execute ( ) { < nl > - String avatarDescriptor = provider . registerUploadFile ( file ) ; < nl > + String avatarDescriptor = file ! = null ? provider . registerUploadFile ( file ) : null ; < nl > / / noinspection ConstantConditions < nl > messenger . createGroup ( title , avatarDescriptor , uids ) . start ( new CommandCallback < Integer > ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index b59506e . . 0202f68 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 703 , 6 + 703 , 17 @ @ public class Messenger { < nl > } < nl > < nl > / * * < nl > + * Hide chat < nl > + * < nl > + * @ param peer destination peer < nl > + * @ return Command for execution < nl > + * / < nl > + @ ObjectiveCName ( " hideChatCommandWithPeer : " ) < nl > + public Command < Boolean > hideChat ( Peer peer ) { < nl > + return modules . getMessagesModule ( ) . hideChat ( peer ) ; < nl > + } < nl > + < nl > + / * * < nl > * Save message draft < nl > * < nl > * @ param peer destination peer < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > index bfbd171 . . a883a25 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . core . api . ApiPeerType ; < nl > import im . actor . core . api . base . SeqUpdate ; < nl > import im . actor . core . api . rpc . RequestClearChat ; < nl > import im . actor . core . api . rpc . RequestDeleteChat ; < nl > + import im . actor . core . api . rpc . RequestHideDialog ; < nl > import im . actor . core . api . rpc . ResponseSeq ; < nl > import im . actor . core . api . updates . UpdateChatClear ; < nl > import im . actor . core . api . updates . UpdateChatDelete ; < nl > @ @ - 366 , 7 + 367 , 7 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > @ Override < nl > public void start ( final CommandCallback < Boolean > callback ) { < nl > ApiOutPeer outPeer ; < nl > - final ApiPeer apiPeer ; < nl > + final ApiPeer apiPeer = buildApiPeer ( peer ) ; < nl > if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > if ( user = = null ) { < nl > @ @ - 380 , 8 + 381 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } < nl > outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , < nl > user . getAccessHash ( ) ) ; < nl > - apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , < nl > - user . getUid ( ) ) ; < nl > } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > if ( group = = null ) { < nl > @ @ - 395 , 8 + 394 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } < nl > outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , < nl > group . getAccessHash ( ) ) ; < nl > - apiPeer = new ApiPeer ( ApiPeerType . GROUP , < nl > - group . getGroupId ( ) ) ; < nl > } else { < nl > runOnUiThread ( new Runnable ( ) { < nl > @ Override < nl > @ @ - 509 , 6 + 506 , 87 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } ; < nl > } < nl > < nl > + public Command < Boolean > hideChat ( final Peer peer ) { < nl > + return new Command < Boolean > ( ) { < nl > + @ Override < nl > + public void start ( final CommandCallback < Boolean > callback ) { < nl > + ApiOutPeer outPeer ; < nl > + final ApiPeer apiPeer ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > + if ( user = = null ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , < nl > + user . getAccessHash ( ) ) ; < nl > + apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , < nl > + user . getUid ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > + if ( group = = null ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , < nl > + group . getAccessHash ( ) ) ; < nl > + apiPeer = new ApiPeer ( ApiPeerType . GROUP , < nl > + group . getGroupId ( ) ) ; < nl > + } else { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + request ( new RequestHideDialog ( outPeer ) , new RpcCallback < ResponseSeq > ( ) { < nl > + @ Override < nl > + public void onResult ( ResponseSeq response ) { < nl > + / / TODO : Implement ? < nl > + / / updates ( ) . onUpdateReceived ( new SeqUpdate ( response . getSeq ( ) , < nl > + / / response . getState ( ) , < nl > + / / UpdateChatClear . HEADER , < nl > + / / new UpdateChatClear ( apiPeer ) . toByteArray ( ) ) ) ; < nl > + updates ( ) . executeAfter ( response . getSeq ( ) , < nl > + new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onResult ( true ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( final RpcException e ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( e ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ; < nl > + } < nl > + < nl > public void resetModule ( ) { < nl > / / TODO : Implement < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java 
 index 895db56 . . 3ed6405 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / push / PushRegisterActor . java 
 @ @ - 62 , 23 + 62 , 13 @ @ public class PushRegisterActor extends ModuleActor { 
 return ; 
 } 
 
 - 
 preferences ( ) . putBool ( " push . google " , true ) ; 
 preferences ( ) . putBool ( " push . google . registered " , false ) ; 
 preferences ( ) . putLong ( " push . google . id " , projectId ) ; 
 preferences ( ) . putString ( " push . google . token " , token ) ; 
 
 - request ( new RequestRegisterGooglePush ( projectId , token ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - preferences ( ) . putBool ( " push . google . registered " , true ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( RpcException e ) { 
 - e . printStackTrace ( ) ; 
 - } 
 - } ) ; 
 + api ( new RequestRegisterGooglePush ( projectId , token ) ) 
 + . then ( r - > preferences ( ) . putBool ( " push . google . registered " , true ) ) ; 
 } 
 
 private void registerApplePush ( int apnsId , String token ) { 
 @ @ - 95 , 17 + 85 , 8 @ @ public class PushRegisterActor extends ModuleActor { 
 preferences ( ) . putInt ( " push . apple . id " , apnsId ) ; 
 preferences ( ) . putString ( " push . apple . token " , token ) ; 
 
 - request ( new RequestRegisterApplePush ( apnsId , token ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - preferences ( ) . putBool ( " push . apple . registered " , true ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( RpcException e ) { 
 - 
 - } 
 - } ) ; 
 + api ( new RequestRegisterApplePush ( apnsId , token ) ) 
 + . then ( r - > preferences ( ) . putBool ( " push . apple . registered " , true ) ) ; 
 } 
 
 private void registerApplePushKit ( int apnsId , String token ) { 
 @ @ - 122 , 17 + 103 , 8 @ @ public class PushRegisterActor extends ModuleActor { 
 preferences ( ) . putInt ( " push . apple _ puskkit . id " , apnsId ) ; 
 preferences ( ) . putString ( " push . apple _ puskkit . token " , token ) ; 
 
 - request ( new RequestRegisterApplePushKit ( apnsId , token ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - preferences ( ) . putBool ( " push . apple _ puskkit . registered " , true ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( RpcException e ) { 
 - 
 - } 
 - } ) ; 
 + api ( new RequestRegisterApplePushKit ( apnsId , token ) ) 
 + . then ( r - > preferences ( ) . putBool ( " push . apple _ puskkit . registered " , true ) ) ; 
 } 
 
 private void registerActorPush ( String endpoint ) { 
 @ @ - 147 , 17 + 119 , 8 @ @ public class PushRegisterActor extends ModuleActor { 
 preferences ( ) . putBool ( " push . actor . registered " , false ) ; 
 preferences ( ) . putString ( " push . actor . endpoint " , endpoint ) ; 
 
 - request ( new RequestRegisterActorPush ( endpoint , new ArrayList < > ( ) ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - preferences ( ) . putBool ( " push . actor . registered " , true ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( RpcException e ) { 
 - 
 - } 
 - } ) ; 
 + api ( new RequestRegisterActorPush ( endpoint , new ArrayList < > ( ) ) ) 
 + . then ( r - > preferences ( ) . putBool ( " push . actor . registered " , true ) ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java 
 index 2f9851a . . bbc2b00 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / security / SecurityModule . java 
 @ @ - 11 , 13 + 11 , 10 @ @ import im . actor . core . api . rpc . RequestGetAuthSessions ; 
 import im . actor . core . api . rpc . RequestTerminateAllSessions ; 
 import im . actor . core . api . rpc . RequestTerminateSession ; 
 import im . actor . core . api . rpc . ResponseGetAuthSessions ; 
 - import im . actor . core . api . rpc . ResponseVoid ; 
 import im . actor . core . modules . AbsModule ; 
 import im . actor . core . modules . ModuleContext ; 
 - import im . actor . core . network . RpcCallback ; 
 - import im . actor . core . network . RpcException ; 
 - import im . actor . core . viewmodel . Command ; 
 - import im . actor . core . viewmodel . CommandCallback ; 
 + import im . actor . runtime . actors . messages . Void ; 
 + import im . actor . runtime . promise . Promise ; 
 
 public class SecurityModule extends AbsModule { 
 
 @ @ - 25 , 45 + 22 , 18 @ @ public class SecurityModule extends AbsModule { 
 super ( context ) ; 
 } 
 
 - public Command < List < ApiAuthSession > > loadSessions ( ) { 
 - return callback - > request ( new RequestGetAuthSessions ( ) , new RpcCallback < ResponseGetAuthSessions > ( ) { 
 - @ Override 
 - public void onResult ( final ResponseGetAuthSessions response ) { 
 - runOnUiThread ( ( ) - > callback . onResult ( response . getUserAuths ( ) ) ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( final RpcException e ) { 
 - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; 
 - } 
 - } ) ; 
 + public Promise < List < ApiAuthSession > > loadSessions ( ) { 
 + return api ( new RequestGetAuthSessions ( ) ) 
 + . map ( ResponseGetAuthSessions : : getUserAuths ) ; 
 } 
 
 - public Command < Boolean > terminateAllSessions ( ) { 
 - return callback - > request ( new RequestTerminateAllSessions ( ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - runOnUiThread ( ( ) - > callback . onResult ( true ) ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( final RpcException e ) { 
 - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; 
 - } 
 - } ) ; 
 + public Promise < Void > terminateAllSessions ( ) { 
 + return api ( new RequestTerminateAllSessions ( ) ) 
 + . map ( r - > null ) ; 
 } 
 
 - public Command < Boolean > terminateSession ( final int id ) { 
 - return callback - > request ( new RequestTerminateSession ( id ) , new RpcCallback < ResponseVoid > ( ) { 
 - @ Override 
 - public void onResult ( ResponseVoid response ) { 
 - runOnUiThread ( ( ) - > callback . onResult ( true ) ) ; 
 - } 
 - 
 - @ Override 
 - public void onError ( final RpcException e ) { 
 - runOnUiThread ( ( ) - > callback . onError ( e ) ) ; 
 - } 
 - } ) ; 
 + public Promise < Void > terminateSession ( int id ) { 
 + return api ( new RequestTerminateSession ( id ) ) 
 + . map ( r - > null ) ; 
 } 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 index 11f85fc . . f431f95 100644 
 - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 @ @ - 462 , 6 + 462 , 27 @ @ public class JsFacade implements Exportable { 
 } ) ; 
 } 
 
 + public JsPromise hideChat ( final JsPeer peer ) { 
 + return JsPromise . create ( new JsPromiseExecutor ( ) { 
 + @ Override 
 + public void execute ( ) { 
 + messenger . hideChat ( peer . convert ( ) ) . start ( new CommandCallback < Boolean > ( ) { 
 + @ Override 
 + public void onResult ( Boolean res ) { 
 + Log . d ( TAG , " hideChat : result " ) ; 
 + resolve ( ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + Log . d ( TAG , " hideChat : error " ) ; 
 + reject ( e . getMessage ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 / / Peers 
 
 public JsPeer getUserPeer ( int uid ) { 
 @ @ - 858 , 7 + 879 , 7 @ @ public class JsFacade implements Exportable { 
 return JsPromise . create ( new JsPromiseExecutor ( ) { 
 @ Override 
 public void execute ( ) { 
 - String avatarDescriptor = provider . registerUploadFile ( file ) ; 
 + String avatarDescriptor = file ! = null ? provider . registerUploadFile ( file ) : null ; 
 / / noinspection ConstantConditions 
 messenger . createGroup ( title , avatarDescriptor , uids ) . start ( new CommandCallback < Integer > ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index b59506e . . 0202f68 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 703 , 6 + 703 , 17 @ @ public class Messenger { 
 } 
 
 / * * 
 + * Hide chat 
 + * 
 + * @ param peer destination peer 
 + * @ return Command for execution 
 + * / 
 + @ ObjectiveCName ( " hideChatCommandWithPeer : " ) 
 + public Command < Boolean > hideChat ( Peer peer ) { 
 + return modules . getMessagesModule ( ) . hideChat ( peer ) ; 
 + } 
 + 
 + / * * 
 * Save message draft 
 * 
 * @ param peer destination peer 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 index bfbd171 . . a883a25 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . core . api . ApiPeerType ; 
 import im . actor . core . api . base . SeqUpdate ; 
 import im . actor . core . api . rpc . RequestClearChat ; 
 import im . actor . core . api . rpc . RequestDeleteChat ; 
 + import im . actor . core . api . rpc . RequestHideDialog ; 
 import im . actor . core . api . rpc . ResponseSeq ; 
 import im . actor . core . api . updates . UpdateChatClear ; 
 import im . actor . core . api . updates . UpdateChatDelete ; 
 @ @ - 366 , 7 + 367 , 7 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 @ Override 
 public void start ( final CommandCallback < Boolean > callback ) { 
 ApiOutPeer outPeer ; 
 - final ApiPeer apiPeer ; 
 + final ApiPeer apiPeer = buildApiPeer ( peer ) ; 
 if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; 
 if ( user = = null ) { 
 @ @ - 380 , 8 + 381 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } 
 outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , 
 user . getAccessHash ( ) ) ; 
 - apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , 
 - user . getUid ( ) ) ; 
 } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; 
 if ( group = = null ) { 
 @ @ - 395 , 8 + 394 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } 
 outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , 
 group . getAccessHash ( ) ) ; 
 - apiPeer = new ApiPeer ( ApiPeerType . GROUP , 
 - group . getGroupId ( ) ) ; 
 } else { 
 runOnUiThread ( new Runnable ( ) { 
 @ Override 
 @ @ - 509 , 6 + 506 , 87 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } ; 
 } 
 
 + public Command < Boolean > hideChat ( final Peer peer ) { 
 + return new Command < Boolean > ( ) { 
 + @ Override 
 + public void start ( final CommandCallback < Boolean > callback ) { 
 + ApiOutPeer outPeer ; 
 + final ApiPeer apiPeer ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; 
 + if ( user = = null ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , 
 + user . getAccessHash ( ) ) ; 
 + apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , 
 + user . getUid ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; 
 + if ( group = = null ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , 
 + group . getAccessHash ( ) ) ; 
 + apiPeer = new ApiPeer ( ApiPeerType . GROUP , 
 + group . getGroupId ( ) ) ; 
 + } else { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + request ( new RequestHideDialog ( outPeer ) , new RpcCallback < ResponseSeq > ( ) { 
 + @ Override 
 + public void onResult ( ResponseSeq response ) { 
 + / / TODO : Implement ? 
 + / / updates ( ) . onUpdateReceived ( new SeqUpdate ( response . getSeq ( ) , 
 + / / response . getState ( ) , 
 + / / UpdateChatClear . HEADER , 
 + / / new UpdateChatClear ( apiPeer ) . toByteArray ( ) ) ) ; 
 + updates ( ) . executeAfter ( response . getSeq ( ) , 
 + new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onResult ( true ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( final RpcException e ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( e ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + } ; 
 + } 
 + 
 public void resetModule ( ) { 
 / / TODO : Implement 
 }
