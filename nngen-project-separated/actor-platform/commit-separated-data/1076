BLEU SCORE: 0.10600313379512592

TEST MSG: fix ( core ) : Fixing encryption key usage on decryption
GENERATED MSG: feat ( core + js ) : Adding chat hiding

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java < nl > index 7e5257e . . 50a0cc1 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java < nl > @ @ - 226 , 26 + 226 , 32 @ @ public class EncryptedSessionActor extends ModuleActor { < nl > Log . d ( TAG , " onDecrypt : theirEphermalKey0Id : " + theirEphermalKey0Id ) ; < nl > Log . d ( TAG , " onDecrypt : messageIndex : " + messageIndex ) ; < nl > < nl > - ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKey ( ownEphermalKey ) , new AskCallback ( ) { < nl > + ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKey ( theirEphermalKey ) , new AskCallback ( ) { < nl > @ Override < nl > public void onResult ( Object obj ) { < nl > < nl > + Log . d ( TAG , " onDecrypt : onResultEphermal " ) ; < nl > + < nl > final KeyManagerActor . FetchEphemeralPrivateKeyRes ownEphermalKey < nl > = ( KeyManagerActor . FetchEphemeralPrivateKeyRes ) obj ; < nl > < nl > - ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKeyById ( ownEphermalKey0Id ) , < nl > + ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKeyById ( theirEphermalKey0Id ) , < nl > new AskCallback ( ) { < nl > @ Override < nl > public void onResult ( Object obj ) { < nl > + < nl > + Log . d ( TAG , " onDecrypt : onResultPrivate " ) ; < nl > + < nl > final KeyManagerActor . FetchEphemeralPrivateKeyRes ownEphermalKey0 < nl > = ( KeyManagerActor . FetchEphemeralPrivateKeyRes ) obj ; < nl > < nl > ArrayList < Long > keys = new ArrayList < Long > ( ) ; < nl > - keys . add ( theirEphermalKey0Id ) ; < nl > + keys . add ( ownEphermalKey0Id ) ; < nl > < nl > request ( new RequestLoadPublicKey ( new ApiUserOutPeer ( uid , getUser ( uid ) . getAccessHash ( ) ) , keyGroupId , keys ) , new RpcCallback < ResponsePublicKeys > ( ) { < nl > @ Override < nl > public void onResult ( ResponsePublicKeys response ) { < nl > + Log . d ( TAG , " onDecrypt : RequestLoadPublicKey " ) ; < nl > onDecrypt ( data , ownEphermalKey0 . getPrivateKey ( ) , < nl > ownEphermalKey . getPrivateKey ( ) , < nl > theirEphermalKey , < nl > @ @ - 256 , 6 + 262 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { < nl > < nl > @ Override < nl > public void onError ( RpcException e ) { < nl > + Log . d ( TAG , " onDecrypt : RequestLoadPublicKey : onError " ) ; < nl > future . onError ( e ) ; < nl > } < nl > } ) ; < nl > @ @ - 264 , 6 + 271 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { < nl > < nl > @ Override < nl > public void onError ( Exception e ) { < nl > + Log . d ( TAG , " onDecrypt : onResultPrivate : onError " ) ; < nl > future . onError ( e ) ; < nl > } < nl > } ) ; < nl > @ @ - 271 , 6 + 279 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { < nl > < nl > @ Override < nl > public void onError ( Exception e ) { < nl > + Log . d ( TAG , " onDecrypt : onResultEphermal : onError " ) ; < nl > future . onError ( e ) ; < nl > } < nl > } ) ; < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java < nl > index a08e3ff . . fbd44b6 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java < nl > @ @ - 252 , 22 + 252 , 22 @ @ public class KeyManagerActor extends ModuleActor { < nl > < nl > private void fetchUserGroups ( final int uid , final Future future ) { < nl > Log . d ( TAG , " fetchUserGroups " ) ; < nl > - UserKeys userKeys = cachedUserKeys . get ( uid ) ; < nl > - if ( userKeys = = null ) { < nl > - byte [ ] cached = encryptionKeysStorage . loadItem ( uid ) ; < nl > - if ( cached ! = null ) { < nl > - try { < nl > - userKeys = new UserKeys ( cached ) ; < nl > - } catch ( IOException e ) { < nl > - e . printStackTrace ( ) ; < nl > - } < nl > - } < nl > - } < nl > - if ( userKeys ! = null ) { < nl > - Log . d ( TAG , " onResult : fast " ) ; < nl > - future . onResult ( new FetchUserKeyGroupsResponse ( userKeys ) ) ; < nl > - return ; < nl > - } < nl > + UserKeys userKeys = null ; / / cachedUserKeys . get ( uid ) ; < nl > + / / if ( userKeys = = null ) { < nl > + / / byte [ ] cached = encryptionKeysStorage . loadItem ( uid ) ; < nl > + / / if ( cached ! = null ) { < nl > + / / try { < nl > + / / userKeys = new UserKeys ( cached ) ; < nl > + / / } catch ( IOException e ) { < nl > + / / e . printStackTrace ( ) ; < nl > + / / } < nl > + / / } < nl > + / / } < nl > + / / if ( userKeys ! = null ) { < nl > + / / Log . d ( TAG , " onResult : fast " ) ; < nl > + / / future . onResult ( new FetchUserKeyGroupsResponse ( userKeys ) ) ; < nl > + / / return ; < nl > + / / } < nl > < nl > Log . d ( TAG , " Requesting " ) ; < nl > User user = users ( ) . getValue ( uid ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > index 11f85fc . . f431f95 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java < nl > @ @ - 462 , 6 + 462 , 27 @ @ public class JsFacade implements Exportable { < nl > } ) ; < nl > } < nl > < nl > + public JsPromise hideChat ( final JsPeer peer ) { < nl > + return JsPromise . create ( new JsPromiseExecutor ( ) { < nl > + @ Override < nl > + public void execute ( ) { < nl > + messenger . hideChat ( peer . convert ( ) ) . start ( new CommandCallback < Boolean > ( ) { < nl > + @ Override < nl > + public void onResult ( Boolean res ) { < nl > + Log . d ( TAG , " hideChat : result " ) ; < nl > + resolve ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + Log . d ( TAG , " hideChat : error " ) ; < nl > + reject ( e . getMessage ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > / / Peers < nl > < nl > public JsPeer getUserPeer ( int uid ) { < nl > @ @ - 858 , 7 + 879 , 7 @ @ public class JsFacade implements Exportable { < nl > return JsPromise . create ( new JsPromiseExecutor ( ) { < nl > @ Override < nl > public void execute ( ) { < nl > - String avatarDescriptor = provider . registerUploadFile ( file ) ; < nl > + String avatarDescriptor = file ! = null ? provider . registerUploadFile ( file ) : null ; < nl > / / noinspection ConstantConditions < nl > messenger . createGroup ( title , avatarDescriptor , uids ) . start ( new CommandCallback < Integer > ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index b59506e . . 0202f68 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 703 , 6 + 703 , 17 @ @ public class Messenger { < nl > } < nl > < nl > / * * < nl > + * Hide chat < nl > + * < nl > + * @ param peer destination peer < nl > + * @ return Command for execution < nl > + * / < nl > + @ ObjectiveCName ( " hideChatCommandWithPeer : " ) < nl > + public Command < Boolean > hideChat ( Peer peer ) { < nl > + return modules . getMessagesModule ( ) . hideChat ( peer ) ; < nl > + } < nl > + < nl > + / * * < nl > * Save message draft < nl > * < nl > * @ param peer destination peer < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > index bfbd171 . . a883a25 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java < nl > @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . core . api . ApiPeerType ; < nl > import im . actor . core . api . base . SeqUpdate ; < nl > import im . actor . core . api . rpc . RequestClearChat ; < nl > import im . actor . core . api . rpc . RequestDeleteChat ; < nl > + import im . actor . core . api . rpc . RequestHideDialog ; < nl > import im . actor . core . api . rpc . ResponseSeq ; < nl > import im . actor . core . api . updates . UpdateChatClear ; < nl > import im . actor . core . api . updates . UpdateChatDelete ; < nl > @ @ - 366 , 7 + 367 , 7 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > @ Override < nl > public void start ( final CommandCallback < Boolean > callback ) { < nl > ApiOutPeer outPeer ; < nl > - final ApiPeer apiPeer ; < nl > + final ApiPeer apiPeer = buildApiPeer ( peer ) ; < nl > if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > if ( user = = null ) { < nl > @ @ - 380 , 8 + 381 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } < nl > outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , < nl > user . getAccessHash ( ) ) ; < nl > - apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , < nl > - user . getUid ( ) ) ; < nl > } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > if ( group = = null ) { < nl > @ @ - 395 , 8 + 394 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } < nl > outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , < nl > group . getAccessHash ( ) ) ; < nl > - apiPeer = new ApiPeer ( ApiPeerType . GROUP , < nl > - group . getGroupId ( ) ) ; < nl > } else { < nl > runOnUiThread ( new Runnable ( ) { < nl > @ Override < nl > @ @ - 509 , 6 + 506 , 87 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { < nl > } ; < nl > } < nl > < nl > + public Command < Boolean > hideChat ( final Peer peer ) { < nl > + return new Command < Boolean > ( ) { < nl > + @ Override < nl > + public void start ( final CommandCallback < Boolean > callback ) { < nl > + ApiOutPeer outPeer ; < nl > + final ApiPeer apiPeer ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > + if ( user = = null ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , < nl > + user . getAccessHash ( ) ) ; < nl > + apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , < nl > + user . getUid ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; < nl > + if ( group = = null ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , < nl > + group . getAccessHash ( ) ) ; < nl > + apiPeer = new ApiPeer ( ApiPeerType . GROUP , < nl > + group . getGroupId ( ) ) ; < nl > + } else { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( new RpcInternalException ( ) ) ; < nl > + } < nl > + } ) ; < nl > + return ; < nl > + } < nl > + request ( new RequestHideDialog ( outPeer ) , new RpcCallback < ResponseSeq > ( ) { < nl > + @ Override < nl > + public void onResult ( ResponseSeq response ) { < nl > + / / TODO : Implement ? < nl > + / / updates ( ) . onUpdateReceived ( new SeqUpdate ( response . getSeq ( ) , < nl > + / / response . getState ( ) , < nl > + / / UpdateChatClear . HEADER , < nl > + / / new UpdateChatClear ( apiPeer ) . toByteArray ( ) ) ) ; < nl > + updates ( ) . executeAfter ( response . getSeq ( ) , < nl > + new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onResult ( true ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( final RpcException e ) { < nl > + runOnUiThread ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + callback . onError ( e ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + } ; < nl > + } < nl > + < nl > public void resetModule ( ) { < nl > / / TODO : Implement < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java 
 index 7e5257e . . 50a0cc1 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / EncryptedSessionActor . java 
 @ @ - 226 , 26 + 226 , 32 @ @ public class EncryptedSessionActor extends ModuleActor { 
 Log . d ( TAG , " onDecrypt : theirEphermalKey0Id : " + theirEphermalKey0Id ) ; 
 Log . d ( TAG , " onDecrypt : messageIndex : " + messageIndex ) ; 
 
 - ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKey ( ownEphermalKey ) , new AskCallback ( ) { 
 + ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKey ( theirEphermalKey ) , new AskCallback ( ) { 
 @ Override 
 public void onResult ( Object obj ) { 
 
 + Log . d ( TAG , " onDecrypt : onResultEphermal " ) ; 
 + 
 final KeyManagerActor . FetchEphemeralPrivateKeyRes ownEphermalKey 
 = ( KeyManagerActor . FetchEphemeralPrivateKeyRes ) obj ; 
 
 - ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKeyById ( ownEphermalKey0Id ) , 
 + ask ( context ( ) . getEncryption ( ) . getKeyManager ( ) , new KeyManagerActor . FetchEphemeralPrivateKeyById ( theirEphermalKey0Id ) , 
 new AskCallback ( ) { 
 @ Override 
 public void onResult ( Object obj ) { 
 + 
 + Log . d ( TAG , " onDecrypt : onResultPrivate " ) ; 
 + 
 final KeyManagerActor . FetchEphemeralPrivateKeyRes ownEphermalKey0 
 = ( KeyManagerActor . FetchEphemeralPrivateKeyRes ) obj ; 
 
 ArrayList < Long > keys = new ArrayList < Long > ( ) ; 
 - keys . add ( theirEphermalKey0Id ) ; 
 + keys . add ( ownEphermalKey0Id ) ; 
 
 request ( new RequestLoadPublicKey ( new ApiUserOutPeer ( uid , getUser ( uid ) . getAccessHash ( ) ) , keyGroupId , keys ) , new RpcCallback < ResponsePublicKeys > ( ) { 
 @ Override 
 public void onResult ( ResponsePublicKeys response ) { 
 + Log . d ( TAG , " onDecrypt : RequestLoadPublicKey " ) ; 
 onDecrypt ( data , ownEphermalKey0 . getPrivateKey ( ) , 
 ownEphermalKey . getPrivateKey ( ) , 
 theirEphermalKey , 
 @ @ - 256 , 6 + 262 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { 
 
 @ Override 
 public void onError ( RpcException e ) { 
 + Log . d ( TAG , " onDecrypt : RequestLoadPublicKey : onError " ) ; 
 future . onError ( e ) ; 
 } 
 } ) ; 
 @ @ - 264 , 6 + 271 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { 
 
 @ Override 
 public void onError ( Exception e ) { 
 + Log . d ( TAG , " onDecrypt : onResultPrivate : onError " ) ; 
 future . onError ( e ) ; 
 } 
 } ) ; 
 @ @ - 271 , 6 + 279 , 7 @ @ public class EncryptedSessionActor extends ModuleActor { 
 
 @ Override 
 public void onError ( Exception e ) { 
 + Log . d ( TAG , " onDecrypt : onResultEphermal : onError " ) ; 
 future . onError ( e ) ; 
 } 
 } ) ; 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java 
 index a08e3ff . . fbd44b6 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / encryption / KeyManagerActor . java 
 @ @ - 252 , 22 + 252 , 22 @ @ public class KeyManagerActor extends ModuleActor { 
 
 private void fetchUserGroups ( final int uid , final Future future ) { 
 Log . d ( TAG , " fetchUserGroups " ) ; 
 - UserKeys userKeys = cachedUserKeys . get ( uid ) ; 
 - if ( userKeys = = null ) { 
 - byte [ ] cached = encryptionKeysStorage . loadItem ( uid ) ; 
 - if ( cached ! = null ) { 
 - try { 
 - userKeys = new UserKeys ( cached ) ; 
 - } catch ( IOException e ) { 
 - e . printStackTrace ( ) ; 
 - } 
 - } 
 - } 
 - if ( userKeys ! = null ) { 
 - Log . d ( TAG , " onResult : fast " ) ; 
 - future . onResult ( new FetchUserKeyGroupsResponse ( userKeys ) ) ; 
 - return ; 
 - } 
 + UserKeys userKeys = null ; / / cachedUserKeys . get ( uid ) ; 
 + / / if ( userKeys = = null ) { 
 + / / byte [ ] cached = encryptionKeysStorage . loadItem ( uid ) ; 
 + / / if ( cached ! = null ) { 
 + / / try { 
 + / / userKeys = new UserKeys ( cached ) ; 
 + / / } catch ( IOException e ) { 
 + / / e . printStackTrace ( ) ; 
 + / / } 
 + / / } 
 + / / } 
 + / / if ( userKeys ! = null ) { 
 + / / Log . d ( TAG , " onResult : fast " ) ; 
 + / / future . onResult ( new FetchUserKeyGroupsResponse ( userKeys ) ) ; 
 + / / return ; 
 + / / } 
 
 Log . d ( TAG , " Requesting " ) ; 
 User user = users ( ) . getValue ( uid ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 index 11f85fc . . f431f95 100644 
 - - - a / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 + + + b / actor - sdk / sdk - core / core / core - js / src / main / java / im / actor / core / js / JsFacade . java 
 @ @ - 462 , 6 + 462 , 27 @ @ public class JsFacade implements Exportable { 
 } ) ; 
 } 
 
 + public JsPromise hideChat ( final JsPeer peer ) { 
 + return JsPromise . create ( new JsPromiseExecutor ( ) { 
 + @ Override 
 + public void execute ( ) { 
 + messenger . hideChat ( peer . convert ( ) ) . start ( new CommandCallback < Boolean > ( ) { 
 + @ Override 
 + public void onResult ( Boolean res ) { 
 + Log . d ( TAG , " hideChat : result " ) ; 
 + resolve ( ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + Log . d ( TAG , " hideChat : error " ) ; 
 + reject ( e . getMessage ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 / / Peers 
 
 public JsPeer getUserPeer ( int uid ) { 
 @ @ - 858 , 7 + 879 , 7 @ @ public class JsFacade implements Exportable { 
 return JsPromise . create ( new JsPromiseExecutor ( ) { 
 @ Override 
 public void execute ( ) { 
 - String avatarDescriptor = provider . registerUploadFile ( file ) ; 
 + String avatarDescriptor = file ! = null ? provider . registerUploadFile ( file ) : null ; 
 / / noinspection ConstantConditions 
 messenger . createGroup ( title , avatarDescriptor , uids ) . start ( new CommandCallback < Integer > ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index b59506e . . 0202f68 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 703 , 6 + 703 , 17 @ @ public class Messenger { 
 } 
 
 / * * 
 + * Hide chat 
 + * 
 + * @ param peer destination peer 
 + * @ return Command for execution 
 + * / 
 + @ ObjectiveCName ( " hideChatCommandWithPeer : " ) 
 + public Command < Boolean > hideChat ( Peer peer ) { 
 + return modules . getMessagesModule ( ) . hideChat ( peer ) ; 
 + } 
 + 
 + / * * 
 * Save message draft 
 * 
 * @ param peer destination peer 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 index bfbd171 . . a883a25 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / MessagesModule . java 
 @ @ - 16 , 6 + 16 , 7 @ @ import im . actor . core . api . ApiPeerType ; 
 import im . actor . core . api . base . SeqUpdate ; 
 import im . actor . core . api . rpc . RequestClearChat ; 
 import im . actor . core . api . rpc . RequestDeleteChat ; 
 + import im . actor . core . api . rpc . RequestHideDialog ; 
 import im . actor . core . api . rpc . ResponseSeq ; 
 import im . actor . core . api . updates . UpdateChatClear ; 
 import im . actor . core . api . updates . UpdateChatDelete ; 
 @ @ - 366 , 7 + 367 , 7 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 @ Override 
 public void start ( final CommandCallback < Boolean > callback ) { 
 ApiOutPeer outPeer ; 
 - final ApiPeer apiPeer ; 
 + final ApiPeer apiPeer = buildApiPeer ( peer ) ; 
 if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; 
 if ( user = = null ) { 
 @ @ - 380 , 8 + 381 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } 
 outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , 
 user . getAccessHash ( ) ) ; 
 - apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , 
 - user . getUid ( ) ) ; 
 } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; 
 if ( group = = null ) { 
 @ @ - 395 , 8 + 394 , 6 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } 
 outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , 
 group . getAccessHash ( ) ) ; 
 - apiPeer = new ApiPeer ( ApiPeerType . GROUP , 
 - group . getGroupId ( ) ) ; 
 } else { 
 runOnUiThread ( new Runnable ( ) { 
 @ Override 
 @ @ - 509 , 6 + 506 , 87 @ @ public class MessagesModule extends AbsModule implements BusSubscriber { 
 } ; 
 } 
 
 + public Command < Boolean > hideChat ( final Peer peer ) { 
 + return new Command < Boolean > ( ) { 
 + @ Override 
 + public void start ( final CommandCallback < Boolean > callback ) { 
 + ApiOutPeer outPeer ; 
 + final ApiPeer apiPeer ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + User user = users ( ) . getValue ( peer . getPeerId ( ) ) ; 
 + if ( user = = null ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + outPeer = new ApiOutPeer ( ApiPeerType . PRIVATE , user . getUid ( ) , 
 + user . getAccessHash ( ) ) ; 
 + apiPeer = new ApiPeer ( ApiPeerType . PRIVATE , 
 + user . getUid ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + Group group = groups ( ) . getValue ( peer . getPeerId ( ) ) ; 
 + if ( group = = null ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + outPeer = new ApiOutPeer ( ApiPeerType . GROUP , group . getGroupId ( ) , 
 + group . getAccessHash ( ) ) ; 
 + apiPeer = new ApiPeer ( ApiPeerType . GROUP , 
 + group . getGroupId ( ) ) ; 
 + } else { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( new RpcInternalException ( ) ) ; 
 + } 
 + } ) ; 
 + return ; 
 + } 
 + request ( new RequestHideDialog ( outPeer ) , new RpcCallback < ResponseSeq > ( ) { 
 + @ Override 
 + public void onResult ( ResponseSeq response ) { 
 + / / TODO : Implement ? 
 + / / updates ( ) . onUpdateReceived ( new SeqUpdate ( response . getSeq ( ) , 
 + / / response . getState ( ) , 
 + / / UpdateChatClear . HEADER , 
 + / / new UpdateChatClear ( apiPeer ) . toByteArray ( ) ) ) ; 
 + updates ( ) . executeAfter ( response . getSeq ( ) , 
 + new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onResult ( true ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( final RpcException e ) { 
 + runOnUiThread ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + callback . onError ( e ) ; 
 + } 
 + } ) ; 
 + } 
 + } ) ; 
 + } 
 + } ; 
 + } 
 + 
 public void resetModule ( ) { 
 / / TODO : Implement 
 }
