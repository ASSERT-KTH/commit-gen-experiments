BLEU SCORE: 0.21200626759025185

TEST MSG: feat ( android ) : Adding group ' s short name edition
GENERATED MSG: feat ( android ) calls mute / speaker , new design

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > index 8582179 . . 84dc7a8 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > @ @ - 152 , 6 + 152 , 12 @ @ < nl > android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > < nl > < activity < nl > + android : name = " . controllers . group . GroupAdminActivity " < nl > + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > + android : theme = " @ style / CommonActivityTheme " < nl > + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > + < nl > + < activity < nl > android : name = " . controllers . group . MembersActivity " < nl > android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > android : theme = " @ style / CommonActivityTheme " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java < nl > index cd4defd . . 57bb60e 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java < nl > @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . controllers . group ; < nl > import android . os . Bundle ; < nl > < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > < nl > public class AddMemberActivity extends BaseFragmentActivity { < nl > @ @ - 12 , 7 + 13 , 7 @ @ public class AddMemberActivity extends BaseFragmentActivity { < nl > super . onCreate ( savedInstanceState ) ; < nl > < nl > if ( savedInstanceState = = null ) { < nl > - showFragment ( AddMemberFragment . create ( getIntent ( ) . getIntExtra ( " GROUP _ ID " , 0 ) ) , false ) ; < nl > + showFragment ( AddMemberFragment . create ( getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java < nl > new file mode 100644 < nl > index 0000000 . . 3aab5e0 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java < nl > @ @ - 0 , 0 + 1 , 19 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . os . Bundle ; < nl > + < nl > + import im . actor . sdk . controllers . Intents ; < nl > + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + < nl > + public class GroupAdminActivity extends BaseFragmentActivity { < nl > + < nl > + @ Override < nl > + protected void onCreate ( Bundle savedInstanceState ) { < nl > + super . onCreate ( savedInstanceState ) ; < nl > + < nl > + if ( savedInstanceState = = null ) { < nl > + showFragment ( GroupAdminFragment . create ( < nl > + getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; < nl > + } < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > new file mode 100644 < nl > index 0000000 . . 770783d < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > @ @ - 0 , 0 + 1 , 158 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . os . Bundle ; < nl > + import android . support . annotation . Nullable ; < nl > + import android . view . LayoutInflater ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . widget . EditText ; < nl > + import android . widget . RadioButton ; < nl > + import android . widget . TextView ; < nl > + import android . widget . Toast ; < nl > + < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . BaseFragment ; < nl > + import im . actor . sdk . util . Fonts ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > + public class GroupAdminFragment extends BaseFragment { < nl > + < nl > + public static GroupAdminFragment create ( int groupId ) { < nl > + Bundle bundle = new Bundle ( ) ; < nl > + bundle . putInt ( " groupId " , groupId ) ; < nl > + GroupAdminFragment editFragment = new GroupAdminFragment ( ) ; < nl > + editFragment . setArguments ( bundle ) ; < nl > + return editFragment ; < nl > + } < nl > + < nl > + private EditText publicShortName ; < nl > + private GroupVM groupVM ; < nl > + private boolean isPublic ; < nl > + < nl > + public GroupAdminFragment ( ) { < nl > + setTitle ( R . string . group _ title ) ; < nl > + setRootFragment ( true ) ; < nl > + setHomeAsUp ( true ) ; < nl > + setShowHome ( true ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onCreate ( Bundle saveInstance ) { < nl > + super . onCreate ( saveInstance ) ; < nl > + < nl > + groupVM = messenger ( ) . getGroup ( getArguments ( ) . getInt ( " groupId " ) ) ; < nl > + } < nl > + < nl > + @ Nullable < nl > + @ Override < nl > + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { < nl > + View res = inflater . inflate ( R . layout . fragment _ administration , container , false ) ; < nl > + res . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + TextView publicTitle = ( TextView ) res . findViewById ( R . id . publicTitle ) ; < nl > + publicTitle . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > + TextView publicDescription = ( TextView ) res . findViewById ( R . id . publicDescription ) ; < nl > + publicDescription . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > + TextView privateTitle = ( TextView ) res . findViewById ( R . id . privateTitle ) ; < nl > + privateTitle . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > + TextView privateDescription = ( TextView ) res . findViewById ( R . id . privateDescription ) ; < nl > + privateDescription . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > + TextView publicLinkPrefix = ( TextView ) res . findViewById ( R . id . publicLinkPrefix ) ; < nl > + publicLinkPrefix . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > + publicLinkPrefix . setTypeface ( Fonts . medium ( ) ) ; < nl > + RadioButton publicRadio = ( RadioButton ) res . findViewById ( R . id . publicRadio ) ; < nl > + RadioButton privateRadio = ( RadioButton ) res . findViewById ( R . id . privateRadio ) ; < nl > + publicShortName = ( EditText ) res . findViewById ( R . id . publicLink ) ; < nl > + View publicLinkContainer = res . findViewById ( R . id . publicContainer ) ; < nl > + View publicShadowTop = res . findViewById ( R . id . shadowTop ) ; < nl > + View publicShadowBottom = res . findViewById ( R . id . shadowBottom ) ; < nl > + < nl > + if ( groupVM . getShortName ( ) . get ( ) ! = null ) { < nl > + publicRadio . setChecked ( true ) ; < nl > + privateRadio . setChecked ( false ) ; < nl > + publicLinkContainer . setVisibility ( View . VISIBLE ) ; < nl > + publicShadowTop . setVisibility ( View . VISIBLE ) ; < nl > + publicShadowBottom . setVisibility ( View . VISIBLE ) ; < nl > + publicShortName . setText ( groupVM . getShortName ( ) . get ( ) ) ; < nl > + isPublic = true ; < nl > + } else { < nl > + publicRadio . setChecked ( false ) ; < nl > + privateRadio . setChecked ( true ) ; < nl > + publicLinkContainer . setVisibility ( View . GONE ) ; < nl > + publicShadowTop . setVisibility ( View . GONE ) ; < nl > + publicShadowBottom . setVisibility ( View . GONE ) ; < nl > + publicShortName . setText ( null ) ; < nl > + isPublic = false ; < nl > + } < nl > + View . OnClickListener publicClick = view - > { < nl > + if ( ! isPublic ) { < nl > + isPublic = true ; < nl > + publicRadio . setChecked ( true ) ; < nl > + privateRadio . setChecked ( false ) ; < nl > + publicLinkContainer . setVisibility ( View . VISIBLE ) ; < nl > + publicShadowTop . setVisibility ( View . VISIBLE ) ; < nl > + publicShadowBottom . setVisibility ( View . VISIBLE ) ; < nl > + publicShortName . setText ( groupVM . getShortName ( ) . get ( ) ) ; < nl > + } < nl > + } ; < nl > + View . OnClickListener privateClick = view - > { < nl > + if ( isPublic ) { < nl > + isPublic = false ; < nl > + publicRadio . setChecked ( false ) ; < nl > + privateRadio . setChecked ( true ) ; < nl > + publicLinkContainer . setVisibility ( View . GONE ) ; < nl > + publicShadowTop . setVisibility ( View . GONE ) ; < nl > + publicShadowBottom . setVisibility ( View . GONE ) ; < nl > + publicShortName . setText ( null ) ; < nl > + } < nl > + } ; < nl > + publicRadio . setOnClickListener ( publicClick ) ; < nl > + privateRadio . setOnClickListener ( privateClick ) ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > + super . onCreateOptionsMenu ( menu , inflater ) ; < nl > + inflater . inflate ( R . menu . next , menu ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . next ) { < nl > + if ( isPublic ) { < nl > + String nShortName = publicShortName . getText ( ) . toString ( ) . trim ( ) ; < nl > + if ( nShortName . length ( ) = = 0 ) { < nl > + finishActivity ( ) ; < nl > + return true ; < nl > + } < nl > + if ( nShortName . equals ( groupVM . getShortName ( ) . get ( ) ) ) { < nl > + return true ; < nl > + } < nl > + execute ( messenger ( ) . editGroupShortName ( groupVM . getId ( ) , nShortName ) . then ( r - > { < nl > + finishActivity ( ) ; < nl > + } ) . failure ( e - > { < nl > + Toast . makeText ( getActivity ( ) , " Unable to change group short name " , Toast . LENGTH _ SHORT ) . show ( ) ; < nl > + } ) ) ; < nl > + } else { < nl > + if ( groupVM . getShortName ( ) . get ( ) = = null ) { < nl > + finishActivity ( ) ; < nl > + return true ; < nl > + } else { < nl > + execute ( messenger ( ) . editGroupShortName ( groupVM . getId ( ) , null ) . then ( r - > { < nl > + finishActivity ( ) ; < nl > + } ) . failure ( e - > { < nl > + Toast . makeText ( getActivity ( ) , " Unable to change group short name " , Toast . LENGTH _ SHORT ) . show ( ) ; < nl > + } ) ) ; < nl > + } < nl > + } < nl > + return true ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > index 0de7b45 . . fd7e43b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > @ @ - 31 , 6 + 31 , 8 @ @ import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserPhone ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . actors . messages . Void ; < nl > + import im . actor . runtime . mvvm . Value ; < nl > + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKLauncher ; < nl > import im . actor . sdk . ActorStyle ; < nl > @ @ - 111 , 9 + 113 , 11 @ @ public class GroupInfoFragment extends BaseFragment { < nl > < nl > TextView aboutTV = ( TextView ) header . findViewById ( R . id . about ) ; < nl > View aboutCont = header . findViewById ( R . id . aboutContainer ) ; < nl > + < nl > TextView addMember = ( TextView ) header . findViewById ( R . id . addMemberAction ) ; < nl > TextView members = ( TextView ) header . findViewById ( R . id . viewMembersAction ) ; < nl > TextView leaveAction = ( TextView ) header . findViewById ( R . id . leaveAction ) ; < nl > + TextView administrationAction = ( TextView ) header . findViewById ( R . id . administrationAction ) ; < nl > < nl > View descriptionContainer = header . findViewById ( R . id . descriptionContainer ) ; < nl > SwitchCompat isNotificationsEnabled = ( SwitchCompat ) header . findViewById ( R . id . enableNotifications ) ; < nl > @ @ - 137 , 8 + 141 , 10 @ @ public class GroupInfoFragment extends BaseFragment { < nl > ( ( TextView ) header . findViewById ( R . id . addMemberAction ) ) < nl > . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > members . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > + administrationAction . setTextColor ( style . getTextPrimaryColor ( ) ) ; < nl > leaveAction . setTextColor ( style . getTextDangerColor ( ) ) ; < nl > < nl > + < nl > if ( groupVM . getGroupType ( ) = = GroupType . CHANNEL ) { < nl > leaveAction . setText ( R . string . group _ leave _ channel ) ; < nl > } else { < nl > @ @ - 188 , 23 + 194 , 23 @ @ public class GroupInfoFragment extends BaseFragment { < nl > } ) ; < nl > addMember . setOnClickListener ( view - > { < nl > startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) < nl > - . putExtra ( " GROUP _ ID " , chatId ) ) ; < nl > + . putExtra ( Intents . EXTRA _ GROUP _ ID , chatId ) ) ; < nl > } ) ; < nl > < nl > - / / Leave < nl > - leaveAction . setOnClickListener ( view1 - > { < nl > - new AlertDialog . Builder ( getActivity ( ) ) < nl > - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > - groupVM . getName ( ) . get ( ) ) ) < nl > - . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( dialog2 , which ) - > { < nl > - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > - } ) < nl > - . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > - . show ( ) < nl > - . setCanceledOnTouchOutside ( true ) ; < nl > + / / Administration < nl > + bind ( groupVM . getIsCanEditAdministration ( ) , groupVM . getIsCanEditShortName ( ) , ( canEditAdministration , valueModel , canEditShortName , valueModel2 ) - > { < nl > + if ( canEditAdministration | | canEditShortName ) { < nl > + administrationAction . setVisibility ( View . VISIBLE ) ; < nl > + } else { < nl > + administrationAction . setVisibility ( View . GONE ) ; < nl > + } < nl > + } ) ; < nl > + administrationAction . setOnClickListener ( view - > { < nl > + startActivity ( new Intent ( getActivity ( ) , GroupAdminActivity . class ) < nl > + . putExtra ( Intents . EXTRA _ GROUP _ ID , chatId ) ) ; < nl > } ) ; < nl > < nl > - / / Members < nl > + / / Async Members < nl > / / Showing member only when members available and async members is enabled < nl > bind ( groupVM . getIsCanViewMembers ( ) , groupVM . getIsAsyncMembers ( ) , ( canViewMembers , vm1 , isAsync , vm2 ) - > { < nl > if ( canViewMembers ) { < nl > @ @ - 224 , 6 + 230 , 19 @ @ public class GroupInfoFragment extends BaseFragment { < nl > . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; < nl > } ) ; < nl > < nl > + / / Leave < nl > + leaveAction . setOnClickListener ( view1 - > { < nl > + new AlertDialog . Builder ( getActivity ( ) ) < nl > + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > + groupVM . getName ( ) . get ( ) ) ) < nl > + . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( dialog2 , which ) - > { < nl > + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > + } ) < nl > + . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > + . show ( ) < nl > + . setCanceledOnTouchOutside ( true ) ; < nl > + } ) ; < nl > + < nl > listView . addHeaderView ( header , null , false ) ; < nl > < nl > / / < nl > @ @ - 300 , 6 + 319 , 11 @ @ public class GroupInfoFragment extends BaseFragment { < nl > getActivity ( ) . invalidateOptionsMenu ( ) ; < nl > } ) ; < nl > < nl > + / / Menu < nl > + bind ( groupVM . getIsCanEditInfo ( ) , canEditInfo - > { < nl > + getActivity ( ) . invalidateOptionsMenu ( ) ; < nl > + } ) ; < nl > + < nl > return res ; < nl > } < nl > < nl > @ @ - 368 , 7 + 392 , 7 @ @ public class GroupInfoFragment extends BaseFragment { < nl > @ Override < nl > public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { < nl > super . onCreateOptionsMenu ( menu , menuInflater ) ; < nl > - if ( groupVM . isMember ( ) . get ( ) ) { < nl > + if ( groupVM . getIsCanEditInfo ( ) . get ( ) ) { < nl > MenuItem menuItem = menu . add ( Menu . NONE , R . id . edit , Menu . NONE , R . string . actor _ menu _ edit ) ; < nl > menuItem . setIcon ( R . drawable . ic _ edit _ white _ 24dp ) ; < nl > menuItem . setShowAsAction ( MenuItem . SHOW _ AS _ ACTION _ ALWAYS ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml < nl > new file mode 100644 < nl > index 0000000 . . aa83f0b < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml < nl > @ @ - 0 , 0 + 1 , 156 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : focusable = " true " < nl > + android : focusableInTouchMode = " true " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : background = " @ android : color / white " < nl > + android : orientation = " vertical " < nl > + android : paddingBottom = " 8dp " < nl > + android : paddingTop = " 8dp " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / publicSelector " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ marginBottom = " 8dp " < nl > + android : background = " @ drawable / selector " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 48dp " < nl > + android : layout _ height = " 48dp " < nl > + android : layout _ gravity = " top " > < nl > + < nl > + < RadioButton < nl > + android : id = " @ + id / publicRadio " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " vertical " < nl > + android : paddingRight = " 16dp " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / publicTitle " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ marginTop = " 4dp " < nl > + android : background = " @ android : color / white " < nl > + android : gravity = " center _ vertical " < nl > + android : text = " @ string / group _ public _ group _ title " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / publicDescription " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : text = " @ string / group _ public _ group _ text " < nl > + android : textSize = " 14sp " / > < nl > + < / LinearLayout > < nl > + < / LinearLayout > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / privateSelector " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : background = " @ drawable / selector " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 48dp " < nl > + android : layout _ height = " 48dp " < nl > + android : layout _ gravity = " top " > < nl > + < nl > + < RadioButton < nl > + android : id = " @ + id / privateRadio " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " vertical " < nl > + android : paddingRight = " 16dp " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / privateTitle " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ marginTop = " 4dp " < nl > + android : background = " @ android : color / white " < nl > + android : gravity = " center _ vertical " < nl > + android : text = " @ string / group _ private _ group _ title " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / privateDescription " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : background = " @ android : color / white " < nl > + android : text = " @ string / group _ private _ group _ text " < nl > + android : textSize = " 14sp " / > < nl > + < / LinearLayout > < nl > + < / LinearLayout > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : background = " @ drawable / card _ shadow _ bottom " / > < nl > + < nl > + < View < nl > + android : id = " @ + id / shadowTop " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : layout _ marginTop = " 8dp " < nl > + android : background = " @ drawable / card _ shadow _ top " / > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / publicContainer " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : background = " @ android : color / white " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / publicLinkPrefix " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : paddingLeft = " 48dp " < nl > + android : paddingRight = " 1dp " < nl > + android : text = " \ @ " < nl > + android : textSize = " 18sp " / > < nl > + < nl > + < EditText < nl > + android : id = " @ + id / publicLink " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : background = " @ android : color / transparent " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 16dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 18sp " / > < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / shadowBottom " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : background = " @ drawable / card _ shadow _ bottom " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > index 42b2585 . . ca8893c 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml < nl > @ @ - 161 , 6 + 161 , 17 @ @ < nl > android : textSize = " 16sp " / > < nl > < nl > < TextView < nl > + android : id = " @ + id / administrationAction " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : background = " @ drawable / selector " < nl > + android : gravity = " center _ vertical " < nl > + android : paddingLeft = " 72dp " < nl > + android : paddingRight = " 8dp " < nl > + android : text = " @ string / group _ administration " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > android : id = " @ + id / leaveAction " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " 48dp " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 49ec6e0 . . e7518c0 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 359 , 6 + 359 , 12 @ @ < nl > < string name = " group _ add _ member " > Add a member < / string > < nl > < string name = " group _ leave " > Leave group < / string > < nl > < string name = " group _ leave _ channel " > Leave channel < / string > < nl > + < string name = " group _ administration " > Administration < / string > < nl > + < nl > + < string name = " group _ public _ group _ title " > Public Group < / string > < nl > + < string name = " group _ public _ group _ text " > Public groups can be found in search , anyone can join them . < / string > < nl > + < string name = " group _ private _ group _ title " > Private Group < / string > < nl > + < string name = " group _ private _ group _ text " > Private Group can only be joined via personal invitation . < / string > < nl > < nl > < string name = " group _ not _ member " > You are not a member of this group < / string > < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index fcf1682 . . 928a183 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 1419 , 11 + 1419 , 24 @ @ public class Messenger { < nl > * / < nl > @ NotNull < nl > @ ObjectiveCName ( " editGroupAboutWithGid : withAbout : " ) < nl > - public Promise < Void > editGroupAbout ( final int gid , final String about ) { < nl > + public Promise < Void > editGroupAbout ( int gid , String about ) { < nl > return modules . getGroupsModule ( ) . editAbout ( gid , about ) ; < nl > } < nl > < nl > / * * < nl > + * Edit group ' s short name < nl > + * < nl > + * @ param gid group ' s id < nl > + * @ param shortName new group short name < nl > + * @ return Promise for void < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " editGroupShortNameWithGid : withAbout : " ) < nl > + public Promise < Void > editGroupShortName ( int gid , String shortName ) { < nl > + return modules . getGroupsModule ( ) . editShortName ( gid , shortName ) ; < nl > + } < nl > + < nl > + / * * < nl > * Change group avatar < nl > * < nl > * @ param gid group ' s id < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java < nl > index 84f5c7f . . 84919da 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java < nl > @ @ - 87 , 6 + 87 , 14 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K < nl > private boolean isSharedHistory ; < nl > @ Property ( " readonly , nonatomic " ) < nl > private boolean isCanEditInfo ; < nl > + @ Property ( " readonly , nonatomic " ) < nl > + private boolean isCanEditAdministration ; < nl > + @ Property ( " readonly , nonatomic " ) < nl > + private boolean isCanEditShortName ; < nl > + @ Property ( " readonly , nonatomic " ) < nl > + private boolean isCanViewAdmins ; < nl > + @ Property ( " readonly , nonatomic " ) < nl > + private boolean isCanEditAdmins ; < nl > < nl > @ Property ( " readonly , nonatomic " ) < nl > private boolean haveExtension ; < nl > @ @ - 203 , 6 + 211 , 22 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K < nl > return haveExtension ; < nl > } < nl > < nl > + public boolean isCanEditShortName ( ) { < nl > + return isCanEditShortName ; < nl > + } < nl > + < nl > + public boolean isCanEditAdministration ( ) { < nl > + return isCanEditAdministration ; < nl > + } < nl > + < nl > + public boolean isCanViewAdmins ( ) { < nl > + return isCanViewAdmins ; < nl > + } < nl > + < nl > + public boolean isCanEditAdmins ( ) { < nl > + return isCanEditAdmins ; < nl > + } < nl > + < nl > public Group updateExt ( @ Nullable ApiGroupFull ext ) { < nl > return new Group ( getWrapped ( ) , ext ) ; < nl > } < nl > @ @ - 895 , 6 + 919 , 11 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K < nl > this . isCanInviteMembers = ext . canViewMembers ( ) ! = null ? ext . canViewMembers ( ) : true ; < nl > this . isSharedHistory = ext . isSharedHistory ( ) ! = null ? ext . isSharedHistory ( ) : false ; < nl > this . isCanEditInfo = ext . canEditGroupInfo ( ) ! = null ? ext . canEditGroupInfo ( ) : false ; < nl > + this . isCanEditShortName = ext . canEditShortName ( ) ! = null ? ext . canEditShortName ( ) : false ; < nl > + this . isCanEditAdministration = ext . canEditAdminSettings ( ) ! = null ? ext . canEditAdminSettings ( ) : false ; < nl > + this . isCanViewAdmins = ext . canViewAdminList ( ) ! = null ? ext . canViewAdminList ( ) : false ; < nl > + this . isCanEditAdmins = ext . canEditAdminList ( ) ! = null ? ext . canEditAdminList ( ) : false ; < nl > + < nl > this . members = new ArrayList < > ( ) ; < nl > for ( ApiMember m : ext . getMembers ( ) ) { < nl > this . members . add ( new GroupMember ( m . getUid ( ) , m . getInviterUid ( ) , m . getDate ( ) , < nl > @ @ - 905 , 13 + 934 , 17 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K < nl > this . ownerId = 0 ; < nl > this . about = null ; < nl > this . topic = null ; < nl > + this . shortName = null ; < nl > + this . members = new ArrayList < > ( ) ; < nl > this . isAsyncMembers = false ; < nl > this . isCanViewMembers = false ; < nl > this . isCanInviteMembers = false ; < nl > this . isSharedHistory = false ; < nl > - this . members = new ArrayList < > ( ) ; < nl > this . isCanEditInfo = false ; < nl > - this . shortName = null ; < nl > + this . isCanEditShortName = false ; < nl > + this . isCanEditAdministration = false ; < nl > + this . isCanViewAdmins = false ; < nl > + this . isCanEditAdmins = false ; < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > index 2b5309f . . 57627ed 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > @ @ - 15 , 6 + 15 , 7 @ @ import im . actor . core . api . ApiPeerType ; < nl > import im . actor . core . api . ApiUserOutPeer ; < nl > import im . actor . core . api . rpc . RequestCreateGroup ; < nl > import im . actor . core . api . rpc . RequestEditGroupAbout ; < nl > + import im . actor . core . api . rpc . RequestEditGroupShortName ; < nl > import im . actor . core . api . rpc . RequestEditGroupTitle ; < nl > import im . actor . core . api . rpc . RequestEditGroupTopic ; < nl > import im . actor . core . api . rpc . RequestGetGroupInviteUrl ; < nl > @ @ - 230 , 6 + 231 , 14 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { < nl > . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; < nl > } < nl > < nl > + public Promise < Void > editShortName ( final int gid , final String shortName ) { < nl > + return getGroups ( ) . getValueAsync ( gid ) < nl > + . flatMap ( group - > < nl > + api ( new RequestEditGroupShortName ( new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , < nl > + shortName ) ) ) < nl > + . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; < nl > + } < nl > + < nl > public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { < nl > return getGroups ( ) . getValueAsync ( gid ) < nl > . flatMap ( group - > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java < nl > index 0e8013f . . d9bc3b9 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java < nl > @ @ - 69 , 6 + 69 , 21 @ @ public class GroupVM extends BaseValueModel < Group > { < nl > @ NotNull < nl > @ Property ( " nonatomic , readonly " ) < nl > private BooleanValueModel isCanEditInfo ; < nl > + @ NotNull < nl > + @ Property ( " nonatomic , readonly " ) < nl > + private BooleanValueModel isHistoryShared ; < nl > + @ NotNull < nl > + @ Property ( " nonatomic , readonly " ) < nl > + private BooleanValueModel isCanEditAdministration ; < nl > + @ NotNull < nl > + @ Property ( " nonatomic , readonly " ) < nl > + private BooleanValueModel isCanEditShortName ; < nl > + @ NotNull < nl > + @ Property ( " nonatomic , readonly " ) < nl > + private BooleanValueModel isCanEditAdmins ; < nl > + @ NotNull < nl > + @ Property ( " nonatomic , readonly " ) < nl > + private BooleanValueModel isCanViewAdmins ; < nl > < nl > < nl > @ NotNull < nl > @ @ - 109 , 6 + 124 , 12 @ @ public class GroupVM extends BaseValueModel < Group > { < nl > this . isCanInviteMembers = new BooleanValueModel ( " group . " + groupId + " . can _ invite _ members " , rawObj . isCanInviteMembers ( ) ) ; < nl > this . isCanEditInfo = new BooleanValueModel ( " group . " + groupId + " . can _ edit _ info " , rawObj . isCanEditInfo ( ) ) ; < nl > this . isAsyncMembers = new BooleanValueModel ( " group . " + groupId + " . isAsyncMembers " , rawObj . isAsyncMembers ( ) ) ; < nl > + this . isCanEditAdministration = new BooleanValueModel ( " group . " + groupId + " . isCanEditAdministration " , rawObj . isCanEditAdministration ( ) ) ; < nl > + this . isCanEditShortName = new BooleanValueModel ( " group . " + groupId + " . isCanEditShortName " , rawObj . isCanEditShortName ( ) ) ; < nl > + this . isHistoryShared = new BooleanValueModel ( " group . " + groupId + " . isHistoryShared " , rawObj . isSharedHistory ( ) ) ; < nl > + this . isCanEditAdmins = new BooleanValueModel ( " group . " + groupId + " . isCanEditAdmins " , rawObj . isCanEditAdmins ( ) ) ; < nl > + this . isCanViewAdmins = new BooleanValueModel ( " group . " + groupId + " . isCanViewAdmins " , rawObj . isCanViewAdmins ( ) ) ; < nl > + < nl > this . ownerId = new IntValueModel ( " group . " + groupId + " . membersCount " , rawObj . getOwnerId ( ) ) ; < nl > this . members = new ValueModel < > ( " group . " + groupId + " . members " , new HashSet < > ( rawObj . getMembers ( ) ) ) ; < nl > this . presence = new ValueModel < > ( " group . " + groupId + " . presence " , 0 ) ; < nl > @ @ - 183 , 6 + 204 , 17 @ @ public class GroupVM extends BaseValueModel < Group > { < nl > } < nl > < nl > / * * < nl > + * Get Short Name Model < nl > + * < nl > + * @ return Value Model of String < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " getShortNameModel " ) < nl > + public StringValueModel getShortName ( ) { < nl > + return shortName ; < nl > + } < nl > + < nl > + / * * < nl > * Get membership Value Model < nl > * < nl > * @ return Value Model of Boolean < nl > @ @ - 261 , 6 + 293 , 39 @ @ public class GroupVM extends BaseValueModel < Group > { < nl > } < nl > < nl > / * * < nl > + * Is history shared in this group < nl > + * < nl > + * @ return is history shared model < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " getIsHistorySharedModel " ) < nl > + public BooleanValueModel getIsHistoryShared ( ) { < nl > + return isHistoryShared ; < nl > + } < nl > + < nl > + / * * < nl > + * Is current user can edit administration settings < nl > + * < nl > + * @ return is can edit administration model < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " getIsCanEditAdministrationModel " ) < nl > + public BooleanValueModel getIsCanEditAdministration ( ) { < nl > + return isCanEditAdministration ; < nl > + } < nl > + < nl > + / * * < nl > + * Is current user can edit short name of a group < nl > + * < nl > + * @ return is current user can edit short name < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " getIsCanEditShortNameModel " ) < nl > + public BooleanValueModel getIsCanEditShortName ( ) { < nl > + return isCanEditShortName ; < nl > + } < nl > + < nl > + / * * < nl > * Get Group owner user id model < nl > * < nl > * @ return creator owner id model < nl > @ @ - 358 , 6 + 423 , 10 @ @ public class GroupVM extends BaseValueModel < Group > { < nl > isChanged | = isCanEditInfo . change ( rawObj . isCanEditInfo ( ) ) ; < nl > isChanged | = shortName . change ( rawObj . getShortName ( ) ) ; < nl > isChanged | = isAsyncMembers . change ( rawObj . isAsyncMembers ( ) ) ; < nl > + isChanged | = isHistoryShared . change ( rawObj . isSharedHistory ( ) ) ; < nl > + isChanged | = isCanEditAdministration . change ( rawObj . isCanEditAdministration ( ) ) ; < nl > + isChanged | = isCanEditAdmins . change ( rawObj . isCanEditAdmins ( ) ) ; < nl > + isChanged | = isCanViewAdmins . change ( rawObj . isCanViewAdmins ( ) ) ; < nl > < nl > if ( isChanged ) { < nl > notifyIfNeeded ( ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > index 45a21b1 . . 9b27d04 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > @ @ - 21 , 6 + 21 , 7 @ @ < nl > < uses - permission android : name = " android . permission . CAMERA " / > < nl > < uses - permission android : name = " android . permission . MODIFY _ AUDIO _ SETTINGS " / > < nl > < uses - permission android : name = " android . permission . LOCATION _ HARDWARE " / > < nl > + < uses - permission android : name = " android . permission . MODIFY _ AUDIO _ SETTINGS " / > < nl > < uses - permission android : name = " com . android . launcher . permission . INSTALL _ SHORTCUT " / > < nl > < nl > < uses - feature < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java < nl > index ab63452 . . d2e9acc 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java < nl > @ @ - 30 , 17 + 30 , 17 @ @ public class AudioActorEx extends AndroidPlayerActor { < nl > state = STATE _ NONE ; < nl > < nl > try { < nl > - < nl > - mplayer = new MediaPlayer ( ) ; < nl > + if ( mplayer = = null ) { < nl > + mplayer = new MediaPlayer ( ) ; < nl > + } < nl > mplayer . setAudioStreamType ( AudioManager . STREAM _ VOICE _ CALL ) ; < nl > mplayer . setDataSource ( context , Uri . parse ( " android . resource : / / " + context . getPackageName ( ) + " / " + R . raw . tone ) ) ; < nl > mplayer . prepare ( ) ; < nl > - mplayer . setLooping ( true ) ; < nl > mplayer . start ( ) ; < nl > mplayer . setOnCompletionListener ( new MediaPlayer . OnCompletionListener ( ) { < nl > @ Override < nl > public void onCompletion ( MediaPlayer mp ) { < nl > - self ( ) . send ( new Stop ( ) ) ; < nl > + self ( ) . send ( new Play ( " " ) ) ; < nl > } < nl > } ) ; < nl > mplayer . setOnErrorListener ( new MediaPlayer . OnErrorListener ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java < nl > index aa7899c . . 9bcba50 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java < nl > @ @ - 1 , 14 + 1 , 22 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . os . Bundle ; < nl > + import android . view . Menu ; < nl > import android . view . WindowManager ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > / * * < nl > * Created by ex3ndr on 30 . 09 . 14 . < nl > * / < nl > public class CallActivity extends BaseFragmentActivity { < nl > + < nl > + private long callId ; < nl > + < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > @ @ - 23 , 8 + 31 , 18 @ @ public class CallActivity extends BaseFragmentActivity { < nl > WindowManager . LayoutParams . FLAG _ SHOW _ WHEN _ LOCKED | < nl > WindowManager . LayoutParams . FLAG _ TURN _ SCREEN _ ON ) ; < nl > } < nl > - showFragment ( new CallFragment ( getIntent ( ) . getLongExtra ( " callId " , - 1 ) , incoming ) , false , false ) ; < nl > + callId = getIntent ( ) . getLongExtra ( " callId " , - 1 ) ; < nl > + showFragment ( new CallFragment ( callId , incoming ) , false , false ) ; < nl > } < nl > } < nl > < nl > + @ Override < nl > + public boolean onCreateOptionsMenu ( Menu menu ) { < nl > + / / Inflating menu < nl > + getMenuInflater ( ) . inflate ( R . menu . call _ menu , menu ) ; < nl > + if ( messenger ( ) . getCall ( callId ) . getPeer ( ) . getPeerType ( ) ! = PeerType . GROUP ) { < nl > + menu . findItem ( R . id . members ) . setVisible ( false ) ; < nl > + } < nl > + return super . onCreateOptionsMenu ( menu ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index 5bb61e2 . . 48a9000 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 8 , 6 + 8 , 8 @ @ import android . app . PendingIntent ; < nl > import android . content . Context ; < nl > import android . content . Intent ; < nl > import android . content . pm . PackageManager ; < nl > + import android . graphics . Color ; < nl > + import android . media . AudioManager ; < nl > import android . media . Ringtone ; < nl > import android . media . RingtoneManager ; < nl > import android . net . Uri ; < nl > @ @ - 17 , 11 + 19 , 12 @ @ import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > import android . view . LayoutInflater ; < nl > + import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > + import android . widget . AdapterView ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > - import android . widget . ImageView ; < nl > import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > < nl > @ @ - 52 , 11 + 55 , 10 @ @ import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > import im . actor . sdk . util . Screen ; < nl > - import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . TintImageView ; < nl > import im . actor . sdk . view . adapters . HolderAdapter ; < nl > import im . actor . sdk . view . adapters . ViewHolder ; < nl > import im . actor . sdk . view . avatar . AvatarView ; < nl > - import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > @ @ - 75 , 8 + 77 , 14 @ @ public class CallFragment extends BaseFragment { < nl > private Ringtone ringtone ; < nl > private CallVM call ; < nl > private ActorRef timer ; < nl > - private TextView timerTV ; < nl > + private TextView statusTV ; < nl > private NotificationManager manager ; < nl > + private CallState currentState ; < nl > + private ImageButton endCall ; < nl > + private boolean speakerOn = false ; < nl > + private AudioManager audioManager ; < nl > + private AvatarView avatarView ; < nl > + private ListView membersList ; < nl > < nl > public CallFragment ( ) { < nl > < nl > @ @ - 111 , 7 + 119 , 7 @ @ public class CallFragment extends BaseFragment { < nl > } < nl > } ) ; < nl > ImageButton notAnswer = ( ImageButton ) cont . findViewById ( R . id . notAnswer ) ; < nl > - ImageButton endCall = ( ImageButton ) cont . findViewById ( R . id . end _ call ) ; < nl > + endCall = ( ImageButton ) cont . findViewById ( R . id . end _ call ) ; < nl > notAnswer . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > @ @ - 126 , 61 + 134 , 145 @ @ public class CallFragment extends BaseFragment { < nl > } ) ; < nl > < nl > / / < nl > - / / Avatar / Name < nl > + / / Avatar / Name bind < nl > / / < nl > - CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > - avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > - nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > + avatarView = ( AvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 130 ) , 50 ) ; < nl > < nl > + TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > + nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > - < nl > UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > + avatarView . bind ( user ) ; < nl > bind ( nameTV , user . getName ( ) ) ; < nl > } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , g . getAvatar ( ) ) ; < nl > + avatarView . bind ( g ) ; < nl > bind ( nameTV , g . getName ( ) ) ; < nl > } < nl > < nl > - ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + / / < nl > + / / Members list < nl > + / / < nl > + membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > membersList . setAdapter ( membersAdapter ) ; < nl > < nl > - timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > - timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > + / / < nl > + / / Members list / avatar switch < nl > + / / < nl > + View . OnClickListener listener = new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + switchAvatarMembers ( ) ; < nl > + } < nl > + } ; < nl > + avatarView . setOnClickListener ( listener ) ; < nl > + cont . findViewById ( R . id . background ) . setOnClickListener ( listener ) ; < nl > + < nl > + membersList . setOnItemClickListener ( new AdapterView . OnItemClickListener ( ) { < nl > + @ Override < nl > + public void onItemClick ( AdapterView < ? > parent , View view , int position , long id ) { < nl > + switchAvatarMembers ( ) ; < nl > + } < nl > + < nl > + } ) ; < nl > + < nl > + < nl > + < nl > + statusTV = ( TextView ) cont . findViewById ( R . id . status ) ; < nl > + statusTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > < nl > / / < nl > / / Check permission < nl > / / < nl > if ( ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > + ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . MODIFY _ AUDIO _ SETTINGS ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . WAKE _ LOCK ) ! = PackageManager . PERMISSION _ GRANTED ) { < nl > Log . d ( " Permissions " , " call - no permission : c " ) ; < nl > - CallFragment . this . requestPermissions ( new String [ ] { Manifest . permission . RECORD _ AUDIO , Manifest . permission . VIBRATE , Manifest . permission . WAKE _ LOCK } , < nl > + CallFragment . this . requestPermissions ( new String [ ] { Manifest . permission . RECORD _ AUDIO , Manifest . permission . VIBRATE , Manifest . permission . MODIFY _ AUDIO _ SETTINGS , Manifest . permission . WAKE _ LOCK } , < nl > PERMISSIONS _ REQUEST _ FOR _ CALL ) ; < nl > < nl > } < nl > < nl > + audioManager = ( AudioManager ) getActivity ( ) . getSystemService ( Context . AUDIO _ SERVICE ) ; < nl > + final TintImageView speaker = ( TintImageView ) cont . findViewById ( R . id . speaker ) ; < nl > + speaker . setResource ( R . drawable . ic _ volume _ up _ white _ 36dp ) ; < nl > + speaker . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; < nl > + speaker . setOnClickListener ( new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + speakerOn = ! speakerOn ; < nl > + audioManager . setSpeakerphoneOn ( speakerOn ) ; < nl > + if ( speakerOn ) { < nl > + speaker . setBackgroundResource ( R . drawable . call _ action _ background _ active ) ; < nl > + speaker . setTint ( Color . WHITE ) ; < nl > + } else { < nl > + speaker . setBackgroundResource ( R . drawable . call _ action _ background ) ; < nl > + speaker . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; < nl > + } < nl > + } < nl > + } ) ; < nl > + < nl > + final TintImageView muteCall = ( TintImageView ) cont . findViewById ( R . id . mute ) ; < nl > + muteCall . setResource ( R . drawable . ic _ mic _ off _ white _ 36dp ) ; < nl > + muteCall . setOnClickListener ( new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + messenger ( ) . toggleCallMute ( callId ) ; < nl > + } < nl > + } ) ; < nl > + < nl > + < nl > + < nl > + call . getIsMuted ( ) . subscribe ( new ValueChangedListener < Boolean > ( ) { < nl > + @ Override < nl > + public void onChanged ( Boolean val , Value < Boolean > valueModel ) { < nl > + if ( val ) { < nl > + muteCall . setBackgroundResource ( R . drawable . call _ action _ background _ active ) ; < nl > + muteCall . setTint ( Color . WHITE ) ; < nl > + } else { < nl > + muteCall . setBackgroundResource ( R . drawable . call _ action _ background ) ; < nl > + muteCall . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; < nl > + } < nl > + } < nl > + } ) ; < nl > + < nl > call . getState ( ) . subscribe ( new ValueChangedListener < CallState > ( ) { < nl > @ Override < nl > public void onChanged ( CallState val , Value < CallState > valueModel ) { < nl > - switch ( val ) { < nl > - case ENDED : < nl > + if ( currentState ! = val ) { < nl > + currentState = val ; < nl > + switch ( val ) { < nl > + < nl > + case CALLING : < nl > + if ( call . isOutgoing ( ) ) { < nl > + statusTV . setText ( R . string . call _ outgoing ) ; < nl > + } else { < nl > + statusTV . setText ( R . string . call _ incoming ) ; < nl > + initIncoming ( ) ; < nl > + } < nl > + enableWakeLock ( ) ; < nl > + break ; < nl > + < nl > + case CONNECTING : < nl > + statusTV . setText ( R . string . call _ connecting ) ; < nl > + break ; < nl > + < nl > + case IN _ PROGRESS : < nl > + onConnected ( ) ; < nl > + startTimer ( ) ; < nl > + break ; < nl > + < nl > + case ENDED : < nl > + statusTV . setText ( R . string . call _ ended ) ; < nl > onCallEnd ( ) ; < nl > break ; < nl > - case IN _ PROGRESS : < nl > - onConnected ( ) ; < nl > - startTimer ( ) ; < nl > - break ; < nl > - case CALLING _ INCOMING : < nl > - initIncoming ( ) ; < nl > - break ; < nl > - case CALLING _ OUTGOING : < nl > - onConnecting ( ) ; < nl > - break ; < nl > + < nl > + } < nl > } < nl > + < nl > } < nl > } , true ) ; < nl > < nl > @ @ - 188 , 6 + 280 , 18 @ @ public class CallFragment extends BaseFragment { < nl > return cont ; < nl > } < nl > < nl > + public void switchAvatarMembers ( ) { < nl > + if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + if ( avatarView . getVisibility ( ) = = View . VISIBLE ) { < nl > + hideView ( avatarView ) ; < nl > + showView ( membersList ) ; < nl > + } else { < nl > + hideView ( membersList ) ; < nl > + showView ( avatarView ) ; < nl > + } < nl > + } < nl > + } < nl > + < nl > private void startTimer ( ) { < nl > < nl > final DateFormat formatter = new SimpleDateFormat ( " HH : mm : ss " ) ; < nl > @ @ - 207 , 7 + 311 , 9 @ @ public class CallFragment extends BaseFragment { < nl > getActivity ( ) . runOnUiThread ( new Runnable ( ) { < nl > @ Override < nl > public void run ( ) { < nl > - timerTV . setText ( formatter . format ( new Date ( timeFromRegister ) ) ) ; < nl > + if ( currentState = = CallState . IN _ PROGRESS ) { < nl > + statusTV . setText ( formatter . format ( new Date ( timeFromRegister ) ) ) ; < nl > + } < nl > } < nl > } ) ; < nl > } < nl > @ @ - 231 , 6 + 337 , 7 @ @ public class CallFragment extends BaseFragment { < nl > < nl > private void initIncoming ( ) { < nl > answerContainer . setVisibility ( View . VISIBLE ) ; < nl > + endCall . setVisibility ( View . INVISIBLE ) ; < nl > < nl > new Thread ( new Runnable ( ) { < nl > @ Override < nl > @ @ - 239 , 7 + 346 , 7 @ @ public class CallFragment extends BaseFragment { < nl > Thread . sleep ( 1100 ) ; < nl > Uri notification = RingtoneManager . getDefaultUri ( RingtoneManager . TYPE _ RINGTONE ) ; < nl > ringtone = RingtoneManager . getRingtone ( getActivity ( ) , notification ) ; < nl > - if ( getActivity ( ) ! = null & answerContainer . getVisibility ( ) = = View . VISIBLE ) { < nl > + if ( getActivity ( ) ! = null & answerContainer . getVisibility ( ) = = View . VISIBLE & & currentState = = CallState . CALLING ) { < nl > if ( ringtone ! = null ) { < nl > ringtone . play ( ) ; < nl > } < nl > @ @ - 255 , 7 + 362 , 7 @ @ public class CallFragment extends BaseFragment { < nl > < nl > private void onAnswer ( ) { < nl > < nl > - onConnecting ( ) ; < nl > + endCall . setVisibility ( View . VISIBLE ) ; < nl > answerContainer . setVisibility ( View . INVISIBLE ) ; < nl > if ( ringtone ! = null ) { < nl > ringtone . stop ( ) ; < nl > @ @ - 278 , 7 + 385 , 7 @ @ public class CallFragment extends BaseFragment { < nl > private int field = 0x00000020 ; < nl > < nl > < nl > - public void onConnecting ( ) { < nl > + public void enableWakeLock ( ) { < nl > powerManager = ( PowerManager ) getActivity ( ) . getSystemService ( Context . POWER _ SERVICE ) ; < nl > wakeLock = powerManager . newWakeLock ( field , getActivity ( ) . getLocalClassName ( ) ) ; < nl > < nl > @ @ - 296 , 6 + 403 , 7 @ @ public class CallFragment extends BaseFragment { < nl > } < nl > < nl > public void onCallEnd ( ) { < nl > + audioManager . setSpeakerphoneOn ( false ) ; < nl > vibrate = false ; < nl > if ( ringtone ! = null ) { < nl > ringtone . stop ( ) ; < nl > @ @ - 321 , 6 + 429 , 15 @ @ public class CallFragment extends BaseFragment { < nl > } < nl > < nl > @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . members ) { < nl > + switchAvatarMembers ( ) ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > if ( call . getState ( ) . get ( ) ! = CallState . ENDED ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java < nl > index f00df38 . . 59d1838 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java < nl > @ @ - 17 , 6 + 17 , 7 @ @ import com . facebook . imagepipeline . request . ImageRequestBuilder ; < nl > import java . io . File ; < nl > < nl > import im . actor . core . entity . Avatar ; < nl > + import im . actor . core . entity . AvatarImage ; < nl > import im . actor . core . entity . Contact ; < nl > import im . actor . core . entity . Dialog ; < nl > import im . actor . core . entity . PublicGroup ; < nl > @ @ - 91 , 8 + 92 , 8 @ @ public class AvatarView extends SimpleDraweeView { < nl > < nl > public void bind ( Avatar avatar , String title , int id ) { < nl > / / Same avatar < nl > - if ( avatar ! = null & & avatar . getSmallImage ( ) ! = null < nl > - & & avatar . getSmallImage ( ) . getFileReference ( ) . getFileId ( ) = = currentId ) { < nl > + if ( avatar ! = null & & getImage ( avatar ) ! = null < nl > + & & getImage ( avatar ) . getFileReference ( ) . getFileId ( ) = = currentId ) { < nl > return ; < nl > } < nl > < nl > @ @ - 105 , 13 + 106 , 13 @ @ public class AvatarView extends SimpleDraweeView { < nl > < nl > setImageURI ( null ) ; < nl > < nl > - if ( avatar = = null | | avatar . getSmallImage ( ) = = null ) { < nl > + if ( avatar = = null | | getImage ( avatar ) = = null ) { < nl > currentId = 0 ; < nl > return ; < nl > } < nl > - currentId = avatar . getSmallImage ( ) . getFileReference ( ) . getFileId ( ) ; < nl > + currentId = getImage ( avatar ) . getFileReference ( ) . getFileId ( ) ; < nl > < nl > - bindedFile = messenger ( ) . bindFile ( avatar . getSmallImage ( ) . getFileReference ( ) , true , new FileVMCallback ( ) { < nl > + bindedFile = messenger ( ) . bindFile ( getImage ( avatar ) . getFileReference ( ) , true , new FileVMCallback ( ) { < nl > @ Override < nl > public void onNotDownloaded ( ) { < nl > < nl > @ @ - 137 , 6 + 138 , 11 @ @ public class AvatarView extends SimpleDraweeView { < nl > } ) ; < nl > } < nl > < nl > + public AvatarImage getImage ( Avatar avatar ) { < nl > + < nl > + return size > = 100 ? avatar . getLargeImage ( ) : avatar . getSmallImage ( ) ; < nl > + } < nl > + < nl > public void bindRaw ( String fileName ) { < nl > if ( bindedFile ! = null ) { < nl > bindedFile . detach ( ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml < nl > new file mode 100644 < nl > index 0000000 . . 729e3ca < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml < nl > @ @ - 0 , 0 + 1 , 9 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ color / primary _ alt " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml < nl > new file mode 100644 < nl > index 0000000 . . 3597075 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml < nl > @ @ - 0 , 0 + 1 , 10 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ android : color / transparent " / > < nl > + < stroke android : width = " 2dp " android : color = " @ color / primary " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml < nl > new file mode 100644 < nl > index 0000000 . . f1c872d < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml < nl > @ @ - 0 , 0 + 1 , 10 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ color / primary " / > < nl > + < stroke android : width = " 2dp " android : color = " @ color / primary " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml < nl > new file mode 100644 < nl > index 0000000 . . dd3a7f9 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml < nl > @ @ - 0 , 0 + 1 , 9 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < nl > + < solid android : color = " @ color / accent " / > < nl > + < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 6ce5969 . . 1150291 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 4 , 80 + 4 , 165 @ @ < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " match _ parent " > < nl > < nl > - < ImageView < nl > - android : id = " @ + id / avatar _ bgrnd " < nl > + < im . actor . sdk . controllers . conversation . view . ChatBackgroundView < nl > + android : id = " @ + id / background " < nl > android : layout _ width = " match _ parent " < nl > - android : layout _ height = " match _ parent " < nl > - android : src = " @ drawable / img _ profile _ avatar _ default " < nl > - android : scaleType = " centerCrop " / > < nl > + android : layout _ height = " match _ parent " / > < nl > < nl > - < im . actor . sdk . view . avatar . CoverAvatarView < nl > - android : id = " @ + id / avatar " < nl > + < LinearLayout < nl > android : layout _ width = " match _ parent " < nl > - android : layout _ height = " match _ parent " / > < nl > + android : layout _ height = " match _ parent " < nl > + android : weightSum = " 2 " < nl > + android : orientation = " vertical " > < nl > < nl > - < LinearLayout < nl > - android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " wrap _ content " < nl > - android : layout _ gravity = " top | left " < nl > - android : orientation = " vertical " < nl > - android : layout _ margin = " 40dp " < nl > - > < nl > - < TextView < nl > - android : id = " @ + id / name " < nl > - android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " wrap _ content " < nl > - android : ellipsize = " end " < nl > - android : includeFontPadding = " false " < nl > - android : lines = " 1 " < nl > - android : textSize = " 26sp " / > < nl > - < nl > - < TextView < nl > - android : id = " @ + id / timer " < nl > - android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " wrap _ content " < nl > - android : textSize = " @ dimen / text _ secondary " / > < nl > - < nl > - < ListView < nl > - android : id = " @ + id / members _ list " < nl > - android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " wrap _ content " / > < nl > - < / LinearLayout > < nl > + < RelativeLayout < nl > + < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ gravity = " top | center _ horizontal " < nl > + android : orientation = " vertical " < nl > + android : layout _ weight = " 1 " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 130dp " < nl > + android : layout _ height = " 130dp " < nl > + android : layout _ centerVertical = " true " < nl > + android : layout _ centerHorizontal = " true " / > < nl > + < nl > + < ListView < nl > + android : paddingLeft = " 20dp " < nl > + android : paddingRight = " 20dp " < nl > + android : visibility = " invisible " < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ centerVertical = " true " < nl > + android : layout _ centerHorizontal = " true " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 130dp " / > < nl > + < nl > + < TextView < nl > + android : gravity = " center " < nl > + android : layout _ centerHorizontal = " true " < nl > + android : layout _ below = " @ id / avatar " < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " match _ parent " < nl > + android : lines = " 1 " < nl > + android : textSize = " 26sp " < nl > + android : layout _ alignParentBottom = " true " / > < nl > + < nl > + < nl > + < nl > + < nl > + < nl > + < / RelativeLayout > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ gravity = " top | center _ horizontal " < nl > + android : orientation = " vertical " < nl > + android : layout _ weight = " 1 " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / answer _ container " < nl > + android : visibility = " invisible " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 60dp " < nl > + android : orientation = " horizontal " < nl > + android : layout _ gravity = " bottom " < nl > + android : layout _ marginBottom = " 20dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ weight = " 1 " < nl > + android : layout _ height = " 60dp " > < nl > + < nl > + < ImageButton < nl > + android : layout _ gravity = " center " < nl > + android : id = " @ + id / notAnswer " < nl > + android : layout _ width = " 60dp " < nl > + android : layout _ height = " 60dp " < nl > + android : background = " @ drawable / end _ call _ background " < nl > + android : src = " @ drawable / ic _ call _ end _ white _ 36dp " / > < nl > + < / FrameLayout > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ weight = " 1 " < nl > + android : layout _ height = " 60dp " > < nl > + < ImageButton < nl > + android : layout _ gravity = " center " < nl > + android : id = " @ + id / answer " < nl > + android : layout _ width = " 60dp " < nl > + android : layout _ height = " 60dp " < nl > + android : background = " @ drawable / answer _ background " < nl > + android : src = " @ drawable / ic _ call _ white _ 36dp " / > < nl > + < nl > + < / FrameLayout > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < ImageButton < nl > + android : visibility = " visible " < nl > + android : layout _ gravity = " bottom | center _ horizontal " < nl > + android : id = " @ + id / end _ call " < nl > + android : layout _ width = " 60dp " < nl > + android : layout _ height = " 60dp " < nl > + android : background = " @ drawable / end _ call _ background " < nl > + android : src = " @ drawable / ic _ call _ end _ white _ 36dp " < nl > + android : layout _ marginBottom = " 20dp " / > < nl > + < nl > + < TextView < nl > + android : layout _ gravity = " center _ horizontal | top " < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : textSize = " 20sp " / > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " horizontal " < nl > + android : weightSum = " 2 " < nl > + android : layout _ gravity = " center " > < nl > + < nl > + < nl > + < FrameLayout < nl > + android : layout _ weight = " 1 " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " wrap _ content " > < nl > + < im . actor . sdk . view . TintImageView < nl > + android : id = " @ + id / speaker " < nl > + android : layout _ gravity = " center _ horizontal " < nl > + android : layout _ height = " 60dp " < nl > + android : scaleType = " centerInside " < nl > + android : layout _ width = " 60dp " < nl > + android : background = " @ drawable / call _ action _ background " < nl > + / > < nl > + < / FrameLayout > < nl > + < nl > + < FrameLayout < nl > + android : layout _ weight = " 1 " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " wrap _ content " > < nl > + < im . actor . sdk . view . TintImageView < nl > + android : id = " @ + id / mute " < nl > + android : layout _ gravity = " center _ horizontal " < nl > + android : layout _ height = " 60dp " < nl > + android : scaleType = " centerInside " < nl > + android : layout _ width = " 60dp " < nl > + android : background = " @ drawable / call _ action _ background " < nl > + / > < nl > + < / FrameLayout > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < / FrameLayout > < nl > < nl > < nl > - < ImageButton < nl > - android : layout _ gravity = " bottom " < nl > - android : id = " @ + id / end _ call " < nl > - android : layout _ width = " match _ parent " < nl > - android : layout _ height = " 60dp " < nl > - android : background = " @ color / accent " < nl > - android : src = " @ drawable / ic _ call _ white _ 36dp " / > < nl > < nl > - < LinearLayout < nl > - android : id = " @ + id / answer _ container " < nl > - android : visibility = " invisible " < nl > - android : layout _ width = " match _ parent " < nl > - android : layout _ height = " 60dp " < nl > - android : orientation = " horizontal " < nl > - android : layout _ gravity = " bottom " > < nl > - < nl > - < ImageButton < nl > - android : layout _ gravity = " bottom " < nl > - android : id = " @ + id / answer " < nl > - android : layout _ width = " 0dp " < nl > - android : layout _ weight = " 1 " < nl > - android : layout _ height = " 60dp " < nl > - android : background = " @ color / primary _ alt " < nl > - android : src = " @ drawable / ic _ call _ white _ 36dp " / > < nl > - < nl > - < ImageButton < nl > - android : layout _ gravity = " bottom " < nl > - android : id = " @ + id / notAnswer " < nl > - android : layout _ width = " 0dp " < nl > - android : layout _ weight = " 1 " < nl > - android : layout _ height = " 60dp " < nl > - android : background = " @ color / accent " < nl > - android : src = " @ drawable / ic _ call _ white _ 36dp " / > < nl > < / LinearLayout > < nl > < nl > + < nl > < / FrameLayout > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml < nl > new file mode 100644 < nl > index 0000000 . . c7dfa0e < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml < nl > @ @ - 0 , 0 + 1 , 17 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > < nl > + < nl > + < item < nl > + android : id = " @ + id / members " < nl > + android : icon = " @ drawable / main _ bar _ contacts _ active " < nl > + android : title = " " < nl > + app : showAsAction = " always " / > < nl > + < nl > + < nl > + < / menu > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 5461c8d . . 0ac8749 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 458 , 6 + 458 , 12 @ @ < nl > < string name = " media _ pager " formatted = " false " > % d of % d < / string > < nl > < string name = " emoji _ no _ recent " > no recent emoji yet < / string > < nl > < nl > + < ! - - Calls - - > < nl > + < string name = " call _ ended " > Call ended < / string > < nl > + < string name = " call _ incoming " > Incoming call < / string > < nl > + < string name = " call _ outgoing " > Ringing … < / string > < nl > + < string name = " call _ connecting " > Connecting … < / string > < nl > + < nl > < ! - - Dialogs - - > < nl > < string name = " alert _ leave _ group _ message " > Are you sure want to exit group " % 1 $ s " ? < / string > < nl > < string name = " alert _ leave _ group _ yes " > Exit < / string >

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 index 8582179 . . 84dc7a8 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 @ @ - 152 , 6 + 152 , 12 @ @ 
 android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 
 < activity 
 + android : name = " . controllers . group . GroupAdminActivity " 
 + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 + android : theme = " @ style / CommonActivityTheme " 
 + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 + 
 + < activity 
 android : name = " . controllers . group . MembersActivity " 
 android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 android : theme = " @ style / CommonActivityTheme " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java 
 index cd4defd . . 57bb60e 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / AddMemberActivity . java 
 @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . controllers . group ; 
 import android . os . Bundle ; 
 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 
 public class AddMemberActivity extends BaseFragmentActivity { 
 @ @ - 12 , 7 + 13 , 7 @ @ public class AddMemberActivity extends BaseFragmentActivity { 
 super . onCreate ( savedInstanceState ) ; 
 
 if ( savedInstanceState = = null ) { 
 - showFragment ( AddMemberFragment . create ( getIntent ( ) . getIntExtra ( " GROUP _ ID " , 0 ) ) , false ) ; 
 + showFragment ( AddMemberFragment . create ( getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java 
 new file mode 100644 
 index 0000000 . . 3aab5e0 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminActivity . java 
 @ @ - 0 , 0 + 1 , 19 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . os . Bundle ; 
 + 
 + import im . actor . sdk . controllers . Intents ; 
 + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + 
 + public class GroupAdminActivity extends BaseFragmentActivity { 
 + 
 + @ Override 
 + protected void onCreate ( Bundle savedInstanceState ) { 
 + super . onCreate ( savedInstanceState ) ; 
 + 
 + if ( savedInstanceState = = null ) { 
 + showFragment ( GroupAdminFragment . create ( 
 + getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; 
 + } 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 new file mode 100644 
 index 0000000 . . 770783d 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 @ @ - 0 , 0 + 1 , 158 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . os . Bundle ; 
 + import android . support . annotation . Nullable ; 
 + import android . view . LayoutInflater ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . widget . EditText ; 
 + import android . widget . RadioButton ; 
 + import android . widget . TextView ; 
 + import android . widget . Toast ; 
 + 
 + import im . actor . core . viewmodel . GroupVM ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . BaseFragment ; 
 + import im . actor . sdk . util . Fonts ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 + public class GroupAdminFragment extends BaseFragment { 
 + 
 + public static GroupAdminFragment create ( int groupId ) { 
 + Bundle bundle = new Bundle ( ) ; 
 + bundle . putInt ( " groupId " , groupId ) ; 
 + GroupAdminFragment editFragment = new GroupAdminFragment ( ) ; 
 + editFragment . setArguments ( bundle ) ; 
 + return editFragment ; 
 + } 
 + 
 + private EditText publicShortName ; 
 + private GroupVM groupVM ; 
 + private boolean isPublic ; 
 + 
 + public GroupAdminFragment ( ) { 
 + setTitle ( R . string . group _ title ) ; 
 + setRootFragment ( true ) ; 
 + setHomeAsUp ( true ) ; 
 + setShowHome ( true ) ; 
 + } 
 + 
 + @ Override 
 + public void onCreate ( Bundle saveInstance ) { 
 + super . onCreate ( saveInstance ) ; 
 + 
 + groupVM = messenger ( ) . getGroup ( getArguments ( ) . getInt ( " groupId " ) ) ; 
 + } 
 + 
 + @ Nullable 
 + @ Override 
 + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { 
 + View res = inflater . inflate ( R . layout . fragment _ administration , container , false ) ; 
 + res . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + TextView publicTitle = ( TextView ) res . findViewById ( R . id . publicTitle ) ; 
 + publicTitle . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 + TextView publicDescription = ( TextView ) res . findViewById ( R . id . publicDescription ) ; 
 + publicDescription . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 + TextView privateTitle = ( TextView ) res . findViewById ( R . id . privateTitle ) ; 
 + privateTitle . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 + TextView privateDescription = ( TextView ) res . findViewById ( R . id . privateDescription ) ; 
 + privateDescription . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 + TextView publicLinkPrefix = ( TextView ) res . findViewById ( R . id . publicLinkPrefix ) ; 
 + publicLinkPrefix . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 + publicLinkPrefix . setTypeface ( Fonts . medium ( ) ) ; 
 + RadioButton publicRadio = ( RadioButton ) res . findViewById ( R . id . publicRadio ) ; 
 + RadioButton privateRadio = ( RadioButton ) res . findViewById ( R . id . privateRadio ) ; 
 + publicShortName = ( EditText ) res . findViewById ( R . id . publicLink ) ; 
 + View publicLinkContainer = res . findViewById ( R . id . publicContainer ) ; 
 + View publicShadowTop = res . findViewById ( R . id . shadowTop ) ; 
 + View publicShadowBottom = res . findViewById ( R . id . shadowBottom ) ; 
 + 
 + if ( groupVM . getShortName ( ) . get ( ) ! = null ) { 
 + publicRadio . setChecked ( true ) ; 
 + privateRadio . setChecked ( false ) ; 
 + publicLinkContainer . setVisibility ( View . VISIBLE ) ; 
 + publicShadowTop . setVisibility ( View . VISIBLE ) ; 
 + publicShadowBottom . setVisibility ( View . VISIBLE ) ; 
 + publicShortName . setText ( groupVM . getShortName ( ) . get ( ) ) ; 
 + isPublic = true ; 
 + } else { 
 + publicRadio . setChecked ( false ) ; 
 + privateRadio . setChecked ( true ) ; 
 + publicLinkContainer . setVisibility ( View . GONE ) ; 
 + publicShadowTop . setVisibility ( View . GONE ) ; 
 + publicShadowBottom . setVisibility ( View . GONE ) ; 
 + publicShortName . setText ( null ) ; 
 + isPublic = false ; 
 + } 
 + View . OnClickListener publicClick = view - > { 
 + if ( ! isPublic ) { 
 + isPublic = true ; 
 + publicRadio . setChecked ( true ) ; 
 + privateRadio . setChecked ( false ) ; 
 + publicLinkContainer . setVisibility ( View . VISIBLE ) ; 
 + publicShadowTop . setVisibility ( View . VISIBLE ) ; 
 + publicShadowBottom . setVisibility ( View . VISIBLE ) ; 
 + publicShortName . setText ( groupVM . getShortName ( ) . get ( ) ) ; 
 + } 
 + } ; 
 + View . OnClickListener privateClick = view - > { 
 + if ( isPublic ) { 
 + isPublic = false ; 
 + publicRadio . setChecked ( false ) ; 
 + privateRadio . setChecked ( true ) ; 
 + publicLinkContainer . setVisibility ( View . GONE ) ; 
 + publicShadowTop . setVisibility ( View . GONE ) ; 
 + publicShadowBottom . setVisibility ( View . GONE ) ; 
 + publicShortName . setText ( null ) ; 
 + } 
 + } ; 
 + publicRadio . setOnClickListener ( publicClick ) ; 
 + privateRadio . setOnClickListener ( privateClick ) ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 + super . onCreateOptionsMenu ( menu , inflater ) ; 
 + inflater . inflate ( R . menu . next , menu ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . next ) { 
 + if ( isPublic ) { 
 + String nShortName = publicShortName . getText ( ) . toString ( ) . trim ( ) ; 
 + if ( nShortName . length ( ) = = 0 ) { 
 + finishActivity ( ) ; 
 + return true ; 
 + } 
 + if ( nShortName . equals ( groupVM . getShortName ( ) . get ( ) ) ) { 
 + return true ; 
 + } 
 + execute ( messenger ( ) . editGroupShortName ( groupVM . getId ( ) , nShortName ) . then ( r - > { 
 + finishActivity ( ) ; 
 + } ) . failure ( e - > { 
 + Toast . makeText ( getActivity ( ) , " Unable to change group short name " , Toast . LENGTH _ SHORT ) . show ( ) ; 
 + } ) ) ; 
 + } else { 
 + if ( groupVM . getShortName ( ) . get ( ) = = null ) { 
 + finishActivity ( ) ; 
 + return true ; 
 + } else { 
 + execute ( messenger ( ) . editGroupShortName ( groupVM . getId ( ) , null ) . then ( r - > { 
 + finishActivity ( ) ; 
 + } ) . failure ( e - > { 
 + Toast . makeText ( getActivity ( ) , " Unable to change group short name " , Toast . LENGTH _ SHORT ) . show ( ) ; 
 + } ) ) ; 
 + } 
 + } 
 + return true ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 index 0de7b45 . . fd7e43b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 @ @ - 31 , 6 + 31 , 8 @ @ import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserPhone ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . actors . messages . Void ; 
 + import im . actor . runtime . mvvm . Value ; 
 + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKLauncher ; 
 import im . actor . sdk . ActorStyle ; 
 @ @ - 111 , 9 + 113 , 11 @ @ public class GroupInfoFragment extends BaseFragment { 
 
 TextView aboutTV = ( TextView ) header . findViewById ( R . id . about ) ; 
 View aboutCont = header . findViewById ( R . id . aboutContainer ) ; 
 + 
 TextView addMember = ( TextView ) header . findViewById ( R . id . addMemberAction ) ; 
 TextView members = ( TextView ) header . findViewById ( R . id . viewMembersAction ) ; 
 TextView leaveAction = ( TextView ) header . findViewById ( R . id . leaveAction ) ; 
 + TextView administrationAction = ( TextView ) header . findViewById ( R . id . administrationAction ) ; 
 
 View descriptionContainer = header . findViewById ( R . id . descriptionContainer ) ; 
 SwitchCompat isNotificationsEnabled = ( SwitchCompat ) header . findViewById ( R . id . enableNotifications ) ; 
 @ @ - 137 , 8 + 141 , 10 @ @ public class GroupInfoFragment extends BaseFragment { 
 ( ( TextView ) header . findViewById ( R . id . addMemberAction ) ) 
 . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 members . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 + administrationAction . setTextColor ( style . getTextPrimaryColor ( ) ) ; 
 leaveAction . setTextColor ( style . getTextDangerColor ( ) ) ; 
 
 + 
 if ( groupVM . getGroupType ( ) = = GroupType . CHANNEL ) { 
 leaveAction . setText ( R . string . group _ leave _ channel ) ; 
 } else { 
 @ @ - 188 , 23 + 194 , 23 @ @ public class GroupInfoFragment extends BaseFragment { 
 } ) ; 
 addMember . setOnClickListener ( view - > { 
 startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) 
 - . putExtra ( " GROUP _ ID " , chatId ) ) ; 
 + . putExtra ( Intents . EXTRA _ GROUP _ ID , chatId ) ) ; 
 } ) ; 
 
 - / / Leave 
 - leaveAction . setOnClickListener ( view1 - > { 
 - new AlertDialog . Builder ( getActivity ( ) ) 
 - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 - groupVM . getName ( ) . get ( ) ) ) 
 - . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( dialog2 , which ) - > { 
 - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 - } ) 
 - . setNegativeButton ( R . string . dialog _ cancel , null ) 
 - . show ( ) 
 - . setCanceledOnTouchOutside ( true ) ; 
 + / / Administration 
 + bind ( groupVM . getIsCanEditAdministration ( ) , groupVM . getIsCanEditShortName ( ) , ( canEditAdministration , valueModel , canEditShortName , valueModel2 ) - > { 
 + if ( canEditAdministration | | canEditShortName ) { 
 + administrationAction . setVisibility ( View . VISIBLE ) ; 
 + } else { 
 + administrationAction . setVisibility ( View . GONE ) ; 
 + } 
 + } ) ; 
 + administrationAction . setOnClickListener ( view - > { 
 + startActivity ( new Intent ( getActivity ( ) , GroupAdminActivity . class ) 
 + . putExtra ( Intents . EXTRA _ GROUP _ ID , chatId ) ) ; 
 } ) ; 
 
 - / / Members 
 + / / Async Members 
 / / Showing member only when members available and async members is enabled 
 bind ( groupVM . getIsCanViewMembers ( ) , groupVM . getIsAsyncMembers ( ) , ( canViewMembers , vm1 , isAsync , vm2 ) - > { 
 if ( canViewMembers ) { 
 @ @ - 224 , 6 + 230 , 19 @ @ public class GroupInfoFragment extends BaseFragment { 
 . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; 
 } ) ; 
 
 + / / Leave 
 + leaveAction . setOnClickListener ( view1 - > { 
 + new AlertDialog . Builder ( getActivity ( ) ) 
 + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 + groupVM . getName ( ) . get ( ) ) ) 
 + . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( dialog2 , which ) - > { 
 + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 + } ) 
 + . setNegativeButton ( R . string . dialog _ cancel , null ) 
 + . show ( ) 
 + . setCanceledOnTouchOutside ( true ) ; 
 + } ) ; 
 + 
 listView . addHeaderView ( header , null , false ) ; 
 
 / / 
 @ @ - 300 , 6 + 319 , 11 @ @ public class GroupInfoFragment extends BaseFragment { 
 getActivity ( ) . invalidateOptionsMenu ( ) ; 
 } ) ; 
 
 + / / Menu 
 + bind ( groupVM . getIsCanEditInfo ( ) , canEditInfo - > { 
 + getActivity ( ) . invalidateOptionsMenu ( ) ; 
 + } ) ; 
 + 
 return res ; 
 } 
 
 @ @ - 368 , 7 + 392 , 7 @ @ public class GroupInfoFragment extends BaseFragment { 
 @ Override 
 public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { 
 super . onCreateOptionsMenu ( menu , menuInflater ) ; 
 - if ( groupVM . isMember ( ) . get ( ) ) { 
 + if ( groupVM . getIsCanEditInfo ( ) . get ( ) ) { 
 MenuItem menuItem = menu . add ( Menu . NONE , R . id . edit , Menu . NONE , R . string . actor _ menu _ edit ) ; 
 menuItem . setIcon ( R . drawable . ic _ edit _ white _ 24dp ) ; 
 menuItem . setShowAsAction ( MenuItem . SHOW _ AS _ ACTION _ ALWAYS ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml 
 new file mode 100644 
 index 0000000 . . aa83f0b 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ administration . xml 
 @ @ - 0 , 0 + 1 , 156 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : focusable = " true " 
 + android : focusableInTouchMode = " true " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : background = " @ android : color / white " 
 + android : orientation = " vertical " 
 + android : paddingBottom = " 8dp " 
 + android : paddingTop = " 8dp " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / publicSelector " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ marginBottom = " 8dp " 
 + android : background = " @ drawable / selector " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 48dp " 
 + android : layout _ height = " 48dp " 
 + android : layout _ gravity = " top " > 
 + 
 + < RadioButton 
 + android : id = " @ + id / publicRadio " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " vertical " 
 + android : paddingRight = " 16dp " > 
 + 
 + < TextView 
 + android : id = " @ + id / publicTitle " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ marginTop = " 4dp " 
 + android : background = " @ android : color / white " 
 + android : gravity = " center _ vertical " 
 + android : text = " @ string / group _ public _ group _ title " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / publicDescription " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : text = " @ string / group _ public _ group _ text " 
 + android : textSize = " 14sp " / > 
 + < / LinearLayout > 
 + < / LinearLayout > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / privateSelector " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : background = " @ drawable / selector " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 48dp " 
 + android : layout _ height = " 48dp " 
 + android : layout _ gravity = " top " > 
 + 
 + < RadioButton 
 + android : id = " @ + id / privateRadio " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " vertical " 
 + android : paddingRight = " 16dp " > 
 + 
 + < TextView 
 + android : id = " @ + id / privateTitle " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ marginTop = " 4dp " 
 + android : background = " @ android : color / white " 
 + android : gravity = " center _ vertical " 
 + android : text = " @ string / group _ private _ group _ title " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / privateDescription " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : background = " @ android : color / white " 
 + android : text = " @ string / group _ private _ group _ text " 
 + android : textSize = " 14sp " / > 
 + < / LinearLayout > 
 + < / LinearLayout > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : background = " @ drawable / card _ shadow _ bottom " / > 
 + 
 + < View 
 + android : id = " @ + id / shadowTop " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : layout _ marginTop = " 8dp " 
 + android : background = " @ drawable / card _ shadow _ top " / > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / publicContainer " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : background = " @ android : color / white " > 
 + 
 + < TextView 
 + android : id = " @ + id / publicLinkPrefix " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : paddingLeft = " 48dp " 
 + android : paddingRight = " 1dp " 
 + android : text = " \ @ " 
 + android : textSize = " 18sp " / > 
 + 
 + < EditText 
 + android : id = " @ + id / publicLink " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : background = " @ android : color / transparent " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 16dp " 
 + android : singleLine = " true " 
 + android : textSize = " 18sp " / > 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / shadowBottom " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : background = " @ drawable / card _ shadow _ bottom " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 index 42b2585 . . ca8893c 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ group _ header . xml 
 @ @ - 161 , 6 + 161 , 17 @ @ 
 android : textSize = " 16sp " / > 
 
 < TextView 
 + android : id = " @ + id / administrationAction " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : background = " @ drawable / selector " 
 + android : gravity = " center _ vertical " 
 + android : paddingLeft = " 72dp " 
 + android : paddingRight = " 8dp " 
 + android : text = " @ string / group _ administration " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 android : id = " @ + id / leaveAction " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " 48dp " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 49ec6e0 . . e7518c0 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 359 , 6 + 359 , 12 @ @ 
 < string name = " group _ add _ member " > Add a member < / string > 
 < string name = " group _ leave " > Leave group < / string > 
 < string name = " group _ leave _ channel " > Leave channel < / string > 
 + < string name = " group _ administration " > Administration < / string > 
 + 
 + < string name = " group _ public _ group _ title " > Public Group < / string > 
 + < string name = " group _ public _ group _ text " > Public groups can be found in search , anyone can join them . < / string > 
 + < string name = " group _ private _ group _ title " > Private Group < / string > 
 + < string name = " group _ private _ group _ text " > Private Group can only be joined via personal invitation . < / string > 
 
 < string name = " group _ not _ member " > You are not a member of this group < / string > 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index fcf1682 . . 928a183 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 1419 , 11 + 1419 , 24 @ @ public class Messenger { 
 * / 
 @ NotNull 
 @ ObjectiveCName ( " editGroupAboutWithGid : withAbout : " ) 
 - public Promise < Void > editGroupAbout ( final int gid , final String about ) { 
 + public Promise < Void > editGroupAbout ( int gid , String about ) { 
 return modules . getGroupsModule ( ) . editAbout ( gid , about ) ; 
 } 
 
 / * * 
 + * Edit group ' s short name 
 + * 
 + * @ param gid group ' s id 
 + * @ param shortName new group short name 
 + * @ return Promise for void 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " editGroupShortNameWithGid : withAbout : " ) 
 + public Promise < Void > editGroupShortName ( int gid , String shortName ) { 
 + return modules . getGroupsModule ( ) . editShortName ( gid , shortName ) ; 
 + } 
 + 
 + / * * 
 * Change group avatar 
 * 
 * @ param gid group ' s id 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java 
 index 84f5c7f . . 84919da 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / Group . java 
 @ @ - 87 , 6 + 87 , 14 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K 
 private boolean isSharedHistory ; 
 @ Property ( " readonly , nonatomic " ) 
 private boolean isCanEditInfo ; 
 + @ Property ( " readonly , nonatomic " ) 
 + private boolean isCanEditAdministration ; 
 + @ Property ( " readonly , nonatomic " ) 
 + private boolean isCanEditShortName ; 
 + @ Property ( " readonly , nonatomic " ) 
 + private boolean isCanViewAdmins ; 
 + @ Property ( " readonly , nonatomic " ) 
 + private boolean isCanEditAdmins ; 
 
 @ Property ( " readonly , nonatomic " ) 
 private boolean haveExtension ; 
 @ @ - 203 , 6 + 211 , 22 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K 
 return haveExtension ; 
 } 
 
 + public boolean isCanEditShortName ( ) { 
 + return isCanEditShortName ; 
 + } 
 + 
 + public boolean isCanEditAdministration ( ) { 
 + return isCanEditAdministration ; 
 + } 
 + 
 + public boolean isCanViewAdmins ( ) { 
 + return isCanViewAdmins ; 
 + } 
 + 
 + public boolean isCanEditAdmins ( ) { 
 + return isCanEditAdmins ; 
 + } 
 + 
 public Group updateExt ( @ Nullable ApiGroupFull ext ) { 
 return new Group ( getWrapped ( ) , ext ) ; 
 } 
 @ @ - 895 , 6 + 919 , 11 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K 
 this . isCanInviteMembers = ext . canViewMembers ( ) ! = null ? ext . canViewMembers ( ) : true ; 
 this . isSharedHistory = ext . isSharedHistory ( ) ! = null ? ext . isSharedHistory ( ) : false ; 
 this . isCanEditInfo = ext . canEditGroupInfo ( ) ! = null ? ext . canEditGroupInfo ( ) : false ; 
 + this . isCanEditShortName = ext . canEditShortName ( ) ! = null ? ext . canEditShortName ( ) : false ; 
 + this . isCanEditAdministration = ext . canEditAdminSettings ( ) ! = null ? ext . canEditAdminSettings ( ) : false ; 
 + this . isCanViewAdmins = ext . canViewAdminList ( ) ! = null ? ext . canViewAdminList ( ) : false ; 
 + this . isCanEditAdmins = ext . canEditAdminList ( ) ! = null ? ext . canEditAdminList ( ) : false ; 
 + 
 this . members = new ArrayList < > ( ) ; 
 for ( ApiMember m : ext . getMembers ( ) ) { 
 this . members . add ( new GroupMember ( m . getUid ( ) , m . getInviterUid ( ) , m . getDate ( ) , 
 @ @ - 905 , 13 + 934 , 17 @ @ public class Group extends WrapperExtEntity < ApiGroupFull , ApiGroup > implements K 
 this . ownerId = 0 ; 
 this . about = null ; 
 this . topic = null ; 
 + this . shortName = null ; 
 + this . members = new ArrayList < > ( ) ; 
 this . isAsyncMembers = false ; 
 this . isCanViewMembers = false ; 
 this . isCanInviteMembers = false ; 
 this . isSharedHistory = false ; 
 - this . members = new ArrayList < > ( ) ; 
 this . isCanEditInfo = false ; 
 - this . shortName = null ; 
 + this . isCanEditShortName = false ; 
 + this . isCanEditAdministration = false ; 
 + this . isCanViewAdmins = false ; 
 + this . isCanEditAdmins = false ; 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 index 2b5309f . . 57627ed 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 @ @ - 15 , 6 + 15 , 7 @ @ import im . actor . core . api . ApiPeerType ; 
 import im . actor . core . api . ApiUserOutPeer ; 
 import im . actor . core . api . rpc . RequestCreateGroup ; 
 import im . actor . core . api . rpc . RequestEditGroupAbout ; 
 + import im . actor . core . api . rpc . RequestEditGroupShortName ; 
 import im . actor . core . api . rpc . RequestEditGroupTitle ; 
 import im . actor . core . api . rpc . RequestEditGroupTopic ; 
 import im . actor . core . api . rpc . RequestGetGroupInviteUrl ; 
 @ @ - 230 , 6 + 231 , 14 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { 
 . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; 
 } 
 
 + public Promise < Void > editShortName ( final int gid , final String shortName ) { 
 + return getGroups ( ) . getValueAsync ( gid ) 
 + . flatMap ( group - > 
 + api ( new RequestEditGroupShortName ( new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , 
 + shortName ) ) ) 
 + . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; 
 + } 
 + 
 public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { 
 return getGroups ( ) . getValueAsync ( gid ) 
 . flatMap ( group - > 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java 
 index 0e8013f . . d9bc3b9 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GroupVM . java 
 @ @ - 69 , 6 + 69 , 21 @ @ public class GroupVM extends BaseValueModel < Group > { 
 @ NotNull 
 @ Property ( " nonatomic , readonly " ) 
 private BooleanValueModel isCanEditInfo ; 
 + @ NotNull 
 + @ Property ( " nonatomic , readonly " ) 
 + private BooleanValueModel isHistoryShared ; 
 + @ NotNull 
 + @ Property ( " nonatomic , readonly " ) 
 + private BooleanValueModel isCanEditAdministration ; 
 + @ NotNull 
 + @ Property ( " nonatomic , readonly " ) 
 + private BooleanValueModel isCanEditShortName ; 
 + @ NotNull 
 + @ Property ( " nonatomic , readonly " ) 
 + private BooleanValueModel isCanEditAdmins ; 
 + @ NotNull 
 + @ Property ( " nonatomic , readonly " ) 
 + private BooleanValueModel isCanViewAdmins ; 
 
 
 @ NotNull 
 @ @ - 109 , 6 + 124 , 12 @ @ public class GroupVM extends BaseValueModel < Group > { 
 this . isCanInviteMembers = new BooleanValueModel ( " group . " + groupId + " . can _ invite _ members " , rawObj . isCanInviteMembers ( ) ) ; 
 this . isCanEditInfo = new BooleanValueModel ( " group . " + groupId + " . can _ edit _ info " , rawObj . isCanEditInfo ( ) ) ; 
 this . isAsyncMembers = new BooleanValueModel ( " group . " + groupId + " . isAsyncMembers " , rawObj . isAsyncMembers ( ) ) ; 
 + this . isCanEditAdministration = new BooleanValueModel ( " group . " + groupId + " . isCanEditAdministration " , rawObj . isCanEditAdministration ( ) ) ; 
 + this . isCanEditShortName = new BooleanValueModel ( " group . " + groupId + " . isCanEditShortName " , rawObj . isCanEditShortName ( ) ) ; 
 + this . isHistoryShared = new BooleanValueModel ( " group . " + groupId + " . isHistoryShared " , rawObj . isSharedHistory ( ) ) ; 
 + this . isCanEditAdmins = new BooleanValueModel ( " group . " + groupId + " . isCanEditAdmins " , rawObj . isCanEditAdmins ( ) ) ; 
 + this . isCanViewAdmins = new BooleanValueModel ( " group . " + groupId + " . isCanViewAdmins " , rawObj . isCanViewAdmins ( ) ) ; 
 + 
 this . ownerId = new IntValueModel ( " group . " + groupId + " . membersCount " , rawObj . getOwnerId ( ) ) ; 
 this . members = new ValueModel < > ( " group . " + groupId + " . members " , new HashSet < > ( rawObj . getMembers ( ) ) ) ; 
 this . presence = new ValueModel < > ( " group . " + groupId + " . presence " , 0 ) ; 
 @ @ - 183 , 6 + 204 , 17 @ @ public class GroupVM extends BaseValueModel < Group > { 
 } 
 
 / * * 
 + * Get Short Name Model 
 + * 
 + * @ return Value Model of String 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " getShortNameModel " ) 
 + public StringValueModel getShortName ( ) { 
 + return shortName ; 
 + } 
 + 
 + / * * 
 * Get membership Value Model 
 * 
 * @ return Value Model of Boolean 
 @ @ - 261 , 6 + 293 , 39 @ @ public class GroupVM extends BaseValueModel < Group > { 
 } 
 
 / * * 
 + * Is history shared in this group 
 + * 
 + * @ return is history shared model 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " getIsHistorySharedModel " ) 
 + public BooleanValueModel getIsHistoryShared ( ) { 
 + return isHistoryShared ; 
 + } 
 + 
 + / * * 
 + * Is current user can edit administration settings 
 + * 
 + * @ return is can edit administration model 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " getIsCanEditAdministrationModel " ) 
 + public BooleanValueModel getIsCanEditAdministration ( ) { 
 + return isCanEditAdministration ; 
 + } 
 + 
 + / * * 
 + * Is current user can edit short name of a group 
 + * 
 + * @ return is current user can edit short name 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " getIsCanEditShortNameModel " ) 
 + public BooleanValueModel getIsCanEditShortName ( ) { 
 + return isCanEditShortName ; 
 + } 
 + 
 + / * * 
 * Get Group owner user id model 
 * 
 * @ return creator owner id model 
 @ @ - 358 , 6 + 423 , 10 @ @ public class GroupVM extends BaseValueModel < Group > { 
 isChanged | = isCanEditInfo . change ( rawObj . isCanEditInfo ( ) ) ; 
 isChanged | = shortName . change ( rawObj . getShortName ( ) ) ; 
 isChanged | = isAsyncMembers . change ( rawObj . isAsyncMembers ( ) ) ; 
 + isChanged | = isHistoryShared . change ( rawObj . isSharedHistory ( ) ) ; 
 + isChanged | = isCanEditAdministration . change ( rawObj . isCanEditAdministration ( ) ) ; 
 + isChanged | = isCanEditAdmins . change ( rawObj . isCanEditAdmins ( ) ) ; 
 + isChanged | = isCanViewAdmins . change ( rawObj . isCanViewAdmins ( ) ) ; 
 
 if ( isChanged ) { 
 notifyIfNeeded ( ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 index 45a21b1 . . 9b27d04 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 @ @ - 21 , 6 + 21 , 7 @ @ 
 < uses - permission android : name = " android . permission . CAMERA " / > 
 < uses - permission android : name = " android . permission . MODIFY _ AUDIO _ SETTINGS " / > 
 < uses - permission android : name = " android . permission . LOCATION _ HARDWARE " / > 
 + < uses - permission android : name = " android . permission . MODIFY _ AUDIO _ SETTINGS " / > 
 < uses - permission android : name = " com . android . launcher . permission . INSTALL _ SHORTCUT " / > 
 
 < uses - feature 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java 
 index ab63452 . . d2e9acc 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / AudioActorEx . java 
 @ @ - 30 , 17 + 30 , 17 @ @ public class AudioActorEx extends AndroidPlayerActor { 
 state = STATE _ NONE ; 
 
 try { 
 - 
 - mplayer = new MediaPlayer ( ) ; 
 + if ( mplayer = = null ) { 
 + mplayer = new MediaPlayer ( ) ; 
 + } 
 mplayer . setAudioStreamType ( AudioManager . STREAM _ VOICE _ CALL ) ; 
 mplayer . setDataSource ( context , Uri . parse ( " android . resource : / / " + context . getPackageName ( ) + " / " + R . raw . tone ) ) ; 
 mplayer . prepare ( ) ; 
 - mplayer . setLooping ( true ) ; 
 mplayer . start ( ) ; 
 mplayer . setOnCompletionListener ( new MediaPlayer . OnCompletionListener ( ) { 
 @ Override 
 public void onCompletion ( MediaPlayer mp ) { 
 - self ( ) . send ( new Stop ( ) ) ; 
 + self ( ) . send ( new Play ( " " ) ) ; 
 } 
 } ) ; 
 mplayer . setOnErrorListener ( new MediaPlayer . OnErrorListener ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java 
 index aa7899c . . 9bcba50 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallActivity . java 
 @ @ - 1 , 14 + 1 , 22 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . os . Bundle ; 
 + import android . view . Menu ; 
 import android . view . WindowManager ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 / * * 
 * Created by ex3ndr on 30 . 09 . 14 . 
 * / 
 public class CallActivity extends BaseFragmentActivity { 
 + 
 + private long callId ; 
 + 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 @ @ - 23 , 8 + 31 , 18 @ @ public class CallActivity extends BaseFragmentActivity { 
 WindowManager . LayoutParams . FLAG _ SHOW _ WHEN _ LOCKED | 
 WindowManager . LayoutParams . FLAG _ TURN _ SCREEN _ ON ) ; 
 } 
 - showFragment ( new CallFragment ( getIntent ( ) . getLongExtra ( " callId " , - 1 ) , incoming ) , false , false ) ; 
 + callId = getIntent ( ) . getLongExtra ( " callId " , - 1 ) ; 
 + showFragment ( new CallFragment ( callId , incoming ) , false , false ) ; 
 } 
 } 
 
 + @ Override 
 + public boolean onCreateOptionsMenu ( Menu menu ) { 
 + / / Inflating menu 
 + getMenuInflater ( ) . inflate ( R . menu . call _ menu , menu ) ; 
 + if ( messenger ( ) . getCall ( callId ) . getPeer ( ) . getPeerType ( ) ! = PeerType . GROUP ) { 
 + menu . findItem ( R . id . members ) . setVisible ( false ) ; 
 + } 
 + return super . onCreateOptionsMenu ( menu ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index 5bb61e2 . . 48a9000 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 8 , 6 + 8 , 8 @ @ import android . app . PendingIntent ; 
 import android . content . Context ; 
 import android . content . Intent ; 
 import android . content . pm . PackageManager ; 
 + import android . graphics . Color ; 
 + import android . media . AudioManager ; 
 import android . media . Ringtone ; 
 import android . media . RingtoneManager ; 
 import android . net . Uri ; 
 @ @ - 17 , 11 + 19 , 12 @ @ import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 import android . view . LayoutInflater ; 
 + import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 + import android . widget . AdapterView ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 - import android . widget . ImageView ; 
 import android . widget . ListView ; 
 import android . widget . TextView ; 
 
 @ @ - 52 , 11 + 55 , 10 @ @ import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 import im . actor . sdk . util . Screen ; 
 - import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . TintImageView ; 
 import im . actor . sdk . view . adapters . HolderAdapter ; 
 import im . actor . sdk . view . adapters . ViewHolder ; 
 import im . actor . sdk . view . avatar . AvatarView ; 
 - import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 @ @ - 75 , 8 + 77 , 14 @ @ public class CallFragment extends BaseFragment { 
 private Ringtone ringtone ; 
 private CallVM call ; 
 private ActorRef timer ; 
 - private TextView timerTV ; 
 + private TextView statusTV ; 
 private NotificationManager manager ; 
 + private CallState currentState ; 
 + private ImageButton endCall ; 
 + private boolean speakerOn = false ; 
 + private AudioManager audioManager ; 
 + private AvatarView avatarView ; 
 + private ListView membersList ; 
 
 public CallFragment ( ) { 
 
 @ @ - 111 , 7 + 119 , 7 @ @ public class CallFragment extends BaseFragment { 
 } 
 } ) ; 
 ImageButton notAnswer = ( ImageButton ) cont . findViewById ( R . id . notAnswer ) ; 
 - ImageButton endCall = ( ImageButton ) cont . findViewById ( R . id . end _ call ) ; 
 + endCall = ( ImageButton ) cont . findViewById ( R . id . end _ call ) ; 
 notAnswer . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 @ @ - 126 , 61 + 134 , 145 @ @ public class CallFragment extends BaseFragment { 
 } ) ; 
 
 / / 
 - / / Avatar / Name 
 + / / Avatar / Name bind 
 / / 
 - CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 - avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 - nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 + avatarView = ( AvatarView ) cont . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 130 ) , 50 ) ; 
 
 + TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 + nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 - 
 UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 + avatarView . bind ( user ) ; 
 bind ( nameTV , user . getName ( ) ) ; 
 } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , g . getAvatar ( ) ) ; 
 + avatarView . bind ( g ) ; 
 bind ( nameTV , g . getName ( ) ) ; 
 } 
 
 - ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + / / 
 + / / Members list 
 + / / 
 + membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 membersList . setAdapter ( membersAdapter ) ; 
 
 - timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 - timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 + / / 
 + / / Members list / avatar switch 
 + / / 
 + View . OnClickListener listener = new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + switchAvatarMembers ( ) ; 
 + } 
 + } ; 
 + avatarView . setOnClickListener ( listener ) ; 
 + cont . findViewById ( R . id . background ) . setOnClickListener ( listener ) ; 
 + 
 + membersList . setOnItemClickListener ( new AdapterView . OnItemClickListener ( ) { 
 + @ Override 
 + public void onItemClick ( AdapterView < ? > parent , View view , int position , long id ) { 
 + switchAvatarMembers ( ) ; 
 + } 
 + 
 + } ) ; 
 + 
 + 
 + 
 + statusTV = ( TextView ) cont . findViewById ( R . id . status ) ; 
 + statusTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 
 / / 
 / / Check permission 
 / / 
 if ( ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 + ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . MODIFY _ AUDIO _ SETTINGS ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . WAKE _ LOCK ) ! = PackageManager . PERMISSION _ GRANTED ) { 
 Log . d ( " Permissions " , " call - no permission : c " ) ; 
 - CallFragment . this . requestPermissions ( new String [ ] { Manifest . permission . RECORD _ AUDIO , Manifest . permission . VIBRATE , Manifest . permission . WAKE _ LOCK } , 
 + CallFragment . this . requestPermissions ( new String [ ] { Manifest . permission . RECORD _ AUDIO , Manifest . permission . VIBRATE , Manifest . permission . MODIFY _ AUDIO _ SETTINGS , Manifest . permission . WAKE _ LOCK } , 
 PERMISSIONS _ REQUEST _ FOR _ CALL ) ; 
 
 } 
 
 + audioManager = ( AudioManager ) getActivity ( ) . getSystemService ( Context . AUDIO _ SERVICE ) ; 
 + final TintImageView speaker = ( TintImageView ) cont . findViewById ( R . id . speaker ) ; 
 + speaker . setResource ( R . drawable . ic _ volume _ up _ white _ 36dp ) ; 
 + speaker . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; 
 + speaker . setOnClickListener ( new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + speakerOn = ! speakerOn ; 
 + audioManager . setSpeakerphoneOn ( speakerOn ) ; 
 + if ( speakerOn ) { 
 + speaker . setBackgroundResource ( R . drawable . call _ action _ background _ active ) ; 
 + speaker . setTint ( Color . WHITE ) ; 
 + } else { 
 + speaker . setBackgroundResource ( R . drawable . call _ action _ background ) ; 
 + speaker . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; 
 + } 
 + } 
 + } ) ; 
 + 
 + final TintImageView muteCall = ( TintImageView ) cont . findViewById ( R . id . mute ) ; 
 + muteCall . setResource ( R . drawable . ic _ mic _ off _ white _ 36dp ) ; 
 + muteCall . setOnClickListener ( new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + messenger ( ) . toggleCallMute ( callId ) ; 
 + } 
 + } ) ; 
 + 
 + 
 + 
 + call . getIsMuted ( ) . subscribe ( new ValueChangedListener < Boolean > ( ) { 
 + @ Override 
 + public void onChanged ( Boolean val , Value < Boolean > valueModel ) { 
 + if ( val ) { 
 + muteCall . setBackgroundResource ( R . drawable . call _ action _ background _ active ) ; 
 + muteCall . setTint ( Color . WHITE ) ; 
 + } else { 
 + muteCall . setBackgroundResource ( R . drawable . call _ action _ background ) ; 
 + muteCall . setTint ( getResources ( ) . getColor ( R . color . primary ) ) ; 
 + } 
 + } 
 + } ) ; 
 + 
 call . getState ( ) . subscribe ( new ValueChangedListener < CallState > ( ) { 
 @ Override 
 public void onChanged ( CallState val , Value < CallState > valueModel ) { 
 - switch ( val ) { 
 - case ENDED : 
 + if ( currentState ! = val ) { 
 + currentState = val ; 
 + switch ( val ) { 
 + 
 + case CALLING : 
 + if ( call . isOutgoing ( ) ) { 
 + statusTV . setText ( R . string . call _ outgoing ) ; 
 + } else { 
 + statusTV . setText ( R . string . call _ incoming ) ; 
 + initIncoming ( ) ; 
 + } 
 + enableWakeLock ( ) ; 
 + break ; 
 + 
 + case CONNECTING : 
 + statusTV . setText ( R . string . call _ connecting ) ; 
 + break ; 
 + 
 + case IN _ PROGRESS : 
 + onConnected ( ) ; 
 + startTimer ( ) ; 
 + break ; 
 + 
 + case ENDED : 
 + statusTV . setText ( R . string . call _ ended ) ; 
 onCallEnd ( ) ; 
 break ; 
 - case IN _ PROGRESS : 
 - onConnected ( ) ; 
 - startTimer ( ) ; 
 - break ; 
 - case CALLING _ INCOMING : 
 - initIncoming ( ) ; 
 - break ; 
 - case CALLING _ OUTGOING : 
 - onConnecting ( ) ; 
 - break ; 
 + 
 + } 
 } 
 + 
 } 
 } , true ) ; 
 
 @ @ - 188 , 6 + 280 , 18 @ @ public class CallFragment extends BaseFragment { 
 return cont ; 
 } 
 
 + public void switchAvatarMembers ( ) { 
 + if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + if ( avatarView . getVisibility ( ) = = View . VISIBLE ) { 
 + hideView ( avatarView ) ; 
 + showView ( membersList ) ; 
 + } else { 
 + hideView ( membersList ) ; 
 + showView ( avatarView ) ; 
 + } 
 + } 
 + } 
 + 
 private void startTimer ( ) { 
 
 final DateFormat formatter = new SimpleDateFormat ( " HH : mm : ss " ) ; 
 @ @ - 207 , 7 + 311 , 9 @ @ public class CallFragment extends BaseFragment { 
 getActivity ( ) . runOnUiThread ( new Runnable ( ) { 
 @ Override 
 public void run ( ) { 
 - timerTV . setText ( formatter . format ( new Date ( timeFromRegister ) ) ) ; 
 + if ( currentState = = CallState . IN _ PROGRESS ) { 
 + statusTV . setText ( formatter . format ( new Date ( timeFromRegister ) ) ) ; 
 + } 
 } 
 } ) ; 
 } 
 @ @ - 231 , 6 + 337 , 7 @ @ public class CallFragment extends BaseFragment { 
 
 private void initIncoming ( ) { 
 answerContainer . setVisibility ( View . VISIBLE ) ; 
 + endCall . setVisibility ( View . INVISIBLE ) ; 
 
 new Thread ( new Runnable ( ) { 
 @ Override 
 @ @ - 239 , 7 + 346 , 7 @ @ public class CallFragment extends BaseFragment { 
 Thread . sleep ( 1100 ) ; 
 Uri notification = RingtoneManager . getDefaultUri ( RingtoneManager . TYPE _ RINGTONE ) ; 
 ringtone = RingtoneManager . getRingtone ( getActivity ( ) , notification ) ; 
 - if ( getActivity ( ) ! = null & answerContainer . getVisibility ( ) = = View . VISIBLE ) { 
 + if ( getActivity ( ) ! = null & answerContainer . getVisibility ( ) = = View . VISIBLE & & currentState = = CallState . CALLING ) { 
 if ( ringtone ! = null ) { 
 ringtone . play ( ) ; 
 } 
 @ @ - 255 , 7 + 362 , 7 @ @ public class CallFragment extends BaseFragment { 
 
 private void onAnswer ( ) { 
 
 - onConnecting ( ) ; 
 + endCall . setVisibility ( View . VISIBLE ) ; 
 answerContainer . setVisibility ( View . INVISIBLE ) ; 
 if ( ringtone ! = null ) { 
 ringtone . stop ( ) ; 
 @ @ - 278 , 7 + 385 , 7 @ @ public class CallFragment extends BaseFragment { 
 private int field = 0x00000020 ; 
 
 
 - public void onConnecting ( ) { 
 + public void enableWakeLock ( ) { 
 powerManager = ( PowerManager ) getActivity ( ) . getSystemService ( Context . POWER _ SERVICE ) ; 
 wakeLock = powerManager . newWakeLock ( field , getActivity ( ) . getLocalClassName ( ) ) ; 
 
 @ @ - 296 , 6 + 403 , 7 @ @ public class CallFragment extends BaseFragment { 
 } 
 
 public void onCallEnd ( ) { 
 + audioManager . setSpeakerphoneOn ( false ) ; 
 vibrate = false ; 
 if ( ringtone ! = null ) { 
 ringtone . stop ( ) ; 
 @ @ - 321 , 6 + 429 , 15 @ @ public class CallFragment extends BaseFragment { 
 } 
 
 @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . members ) { 
 + switchAvatarMembers ( ) ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 + 
 + 
 + @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 if ( call . getState ( ) . get ( ) ! = CallState . ENDED ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java 
 index f00df38 . . 59d1838 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarView . java 
 @ @ - 17 , 6 + 17 , 7 @ @ import com . facebook . imagepipeline . request . ImageRequestBuilder ; 
 import java . io . File ; 
 
 import im . actor . core . entity . Avatar ; 
 + import im . actor . core . entity . AvatarImage ; 
 import im . actor . core . entity . Contact ; 
 import im . actor . core . entity . Dialog ; 
 import im . actor . core . entity . PublicGroup ; 
 @ @ - 91 , 8 + 92 , 8 @ @ public class AvatarView extends SimpleDraweeView { 
 
 public void bind ( Avatar avatar , String title , int id ) { 
 / / Same avatar 
 - if ( avatar ! = null & & avatar . getSmallImage ( ) ! = null 
 - & & avatar . getSmallImage ( ) . getFileReference ( ) . getFileId ( ) = = currentId ) { 
 + if ( avatar ! = null & & getImage ( avatar ) ! = null 
 + & & getImage ( avatar ) . getFileReference ( ) . getFileId ( ) = = currentId ) { 
 return ; 
 } 
 
 @ @ - 105 , 13 + 106 , 13 @ @ public class AvatarView extends SimpleDraweeView { 
 
 setImageURI ( null ) ; 
 
 - if ( avatar = = null | | avatar . getSmallImage ( ) = = null ) { 
 + if ( avatar = = null | | getImage ( avatar ) = = null ) { 
 currentId = 0 ; 
 return ; 
 } 
 - currentId = avatar . getSmallImage ( ) . getFileReference ( ) . getFileId ( ) ; 
 + currentId = getImage ( avatar ) . getFileReference ( ) . getFileId ( ) ; 
 
 - bindedFile = messenger ( ) . bindFile ( avatar . getSmallImage ( ) . getFileReference ( ) , true , new FileVMCallback ( ) { 
 + bindedFile = messenger ( ) . bindFile ( getImage ( avatar ) . getFileReference ( ) , true , new FileVMCallback ( ) { 
 @ Override 
 public void onNotDownloaded ( ) { 
 
 @ @ - 137 , 6 + 138 , 11 @ @ public class AvatarView extends SimpleDraweeView { 
 } ) ; 
 } 
 
 + public AvatarImage getImage ( Avatar avatar ) { 
 + 
 + return size > = 100 ? avatar . getLargeImage ( ) : avatar . getSmallImage ( ) ; 
 + } 
 + 
 public void bindRaw ( String fileName ) { 
 if ( bindedFile ! = null ) { 
 bindedFile . detach ( ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml 
 new file mode 100644 
 index 0000000 . . 729e3ca 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / answer _ background . xml 
 @ @ - 0 , 0 + 1 , 9 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ color / primary _ alt " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml 
 new file mode 100644 
 index 0000000 . . 3597075 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background . xml 
 @ @ - 0 , 0 + 1 , 10 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ android : color / transparent " / > 
 + < stroke android : width = " 2dp " android : color = " @ color / primary " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml 
 new file mode 100644 
 index 0000000 . . f1c872d 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / call _ action _ background _ active . xml 
 @ @ - 0 , 0 + 1 , 10 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ color / primary " / > 
 + < stroke android : width = " 2dp " android : color = " @ color / primary " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml 
 new file mode 100644 
 index 0000000 . . dd3a7f9 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / end _ call _ background . xml 
 @ @ - 0 , 0 + 1 , 9 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > 
 + < solid android : color = " @ color / accent " / > 
 + < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 6ce5969 . . 1150291 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 4 , 80 + 4 , 165 @ @ 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " match _ parent " > 
 
 - < ImageView 
 - android : id = " @ + id / avatar _ bgrnd " 
 + < im . actor . sdk . controllers . conversation . view . ChatBackgroundView 
 + android : id = " @ + id / background " 
 android : layout _ width = " match _ parent " 
 - android : layout _ height = " match _ parent " 
 - android : src = " @ drawable / img _ profile _ avatar _ default " 
 - android : scaleType = " centerCrop " / > 
 + android : layout _ height = " match _ parent " / > 
 
 - < im . actor . sdk . view . avatar . CoverAvatarView 
 - android : id = " @ + id / avatar " 
 + < LinearLayout 
 android : layout _ width = " match _ parent " 
 - android : layout _ height = " match _ parent " / > 
 + android : layout _ height = " match _ parent " 
 + android : weightSum = " 2 " 
 + android : orientation = " vertical " > 
 
 - < LinearLayout 
 - android : layout _ width = " wrap _ content " 
 - android : layout _ height = " wrap _ content " 
 - android : layout _ gravity = " top | left " 
 - android : orientation = " vertical " 
 - android : layout _ margin = " 40dp " 
 - > 
 - < TextView 
 - android : id = " @ + id / name " 
 - android : layout _ width = " wrap _ content " 
 - android : layout _ height = " wrap _ content " 
 - android : ellipsize = " end " 
 - android : includeFontPadding = " false " 
 - android : lines = " 1 " 
 - android : textSize = " 26sp " / > 
 - 
 - < TextView 
 - android : id = " @ + id / timer " 
 - android : layout _ width = " wrap _ content " 
 - android : layout _ height = " wrap _ content " 
 - android : textSize = " @ dimen / text _ secondary " / > 
 - 
 - < ListView 
 - android : id = " @ + id / members _ list " 
 - android : layout _ width = " wrap _ content " 
 - android : layout _ height = " wrap _ content " / > 
 - < / LinearLayout > 
 + < RelativeLayout 
 + 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ gravity = " top | center _ horizontal " 
 + android : orientation = " vertical " 
 + android : layout _ weight = " 1 " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 130dp " 
 + android : layout _ height = " 130dp " 
 + android : layout _ centerVertical = " true " 
 + android : layout _ centerHorizontal = " true " / > 
 + 
 + < ListView 
 + android : paddingLeft = " 20dp " 
 + android : paddingRight = " 20dp " 
 + android : visibility = " invisible " 
 + android : id = " @ + id / members _ list " 
 + android : layout _ centerVertical = " true " 
 + android : layout _ centerHorizontal = " true " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 130dp " / > 
 + 
 + < TextView 
 + android : gravity = " center " 
 + android : layout _ centerHorizontal = " true " 
 + android : layout _ below = " @ id / avatar " 
 + android : id = " @ + id / name " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " match _ parent " 
 + android : lines = " 1 " 
 + android : textSize = " 26sp " 
 + android : layout _ alignParentBottom = " true " / > 
 + 
 + 
 + 
 + 
 + 
 + < / RelativeLayout > 
 + 
 + < FrameLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ gravity = " top | center _ horizontal " 
 + android : orientation = " vertical " 
 + android : layout _ weight = " 1 " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / answer _ container " 
 + android : visibility = " invisible " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 60dp " 
 + android : orientation = " horizontal " 
 + android : layout _ gravity = " bottom " 
 + android : layout _ marginBottom = " 20dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 0dp " 
 + android : layout _ weight = " 1 " 
 + android : layout _ height = " 60dp " > 
 + 
 + < ImageButton 
 + android : layout _ gravity = " center " 
 + android : id = " @ + id / notAnswer " 
 + android : layout _ width = " 60dp " 
 + android : layout _ height = " 60dp " 
 + android : background = " @ drawable / end _ call _ background " 
 + android : src = " @ drawable / ic _ call _ end _ white _ 36dp " / > 
 + < / FrameLayout > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 0dp " 
 + android : layout _ weight = " 1 " 
 + android : layout _ height = " 60dp " > 
 + < ImageButton 
 + android : layout _ gravity = " center " 
 + android : id = " @ + id / answer " 
 + android : layout _ width = " 60dp " 
 + android : layout _ height = " 60dp " 
 + android : background = " @ drawable / answer _ background " 
 + android : src = " @ drawable / ic _ call _ white _ 36dp " / > 
 + 
 + < / FrameLayout > 
 + 
 + < / LinearLayout > 
 + 
 + < ImageButton 
 + android : visibility = " visible " 
 + android : layout _ gravity = " bottom | center _ horizontal " 
 + android : id = " @ + id / end _ call " 
 + android : layout _ width = " 60dp " 
 + android : layout _ height = " 60dp " 
 + android : background = " @ drawable / end _ call _ background " 
 + android : src = " @ drawable / ic _ call _ end _ white _ 36dp " 
 + android : layout _ marginBottom = " 20dp " / > 
 + 
 + < TextView 
 + android : layout _ gravity = " center _ horizontal | top " 
 + android : id = " @ + id / status " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : textSize = " 20sp " / > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " horizontal " 
 + android : weightSum = " 2 " 
 + android : layout _ gravity = " center " > 
 + 
 + 
 + < FrameLayout 
 + android : layout _ weight = " 1 " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " wrap _ content " > 
 + < im . actor . sdk . view . TintImageView 
 + android : id = " @ + id / speaker " 
 + android : layout _ gravity = " center _ horizontal " 
 + android : layout _ height = " 60dp " 
 + android : scaleType = " centerInside " 
 + android : layout _ width = " 60dp " 
 + android : background = " @ drawable / call _ action _ background " 
 + / > 
 + < / FrameLayout > 
 + 
 + < FrameLayout 
 + android : layout _ weight = " 1 " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " wrap _ content " > 
 + < im . actor . sdk . view . TintImageView 
 + android : id = " @ + id / mute " 
 + android : layout _ gravity = " center _ horizontal " 
 + android : layout _ height = " 60dp " 
 + android : scaleType = " centerInside " 
 + android : layout _ width = " 60dp " 
 + android : background = " @ drawable / call _ action _ background " 
 + / > 
 + < / FrameLayout > 
 + 
 + < / LinearLayout > 
 + 
 + < / FrameLayout > 
 
 
 - < ImageButton 
 - android : layout _ gravity = " bottom " 
 - android : id = " @ + id / end _ call " 
 - android : layout _ width = " match _ parent " 
 - android : layout _ height = " 60dp " 
 - android : background = " @ color / accent " 
 - android : src = " @ drawable / ic _ call _ white _ 36dp " / > 
 
 - < LinearLayout 
 - android : id = " @ + id / answer _ container " 
 - android : visibility = " invisible " 
 - android : layout _ width = " match _ parent " 
 - android : layout _ height = " 60dp " 
 - android : orientation = " horizontal " 
 - android : layout _ gravity = " bottom " > 
 - 
 - < ImageButton 
 - android : layout _ gravity = " bottom " 
 - android : id = " @ + id / answer " 
 - android : layout _ width = " 0dp " 
 - android : layout _ weight = " 1 " 
 - android : layout _ height = " 60dp " 
 - android : background = " @ color / primary _ alt " 
 - android : src = " @ drawable / ic _ call _ white _ 36dp " / > 
 - 
 - < ImageButton 
 - android : layout _ gravity = " bottom " 
 - android : id = " @ + id / notAnswer " 
 - android : layout _ width = " 0dp " 
 - android : layout _ weight = " 1 " 
 - android : layout _ height = " 60dp " 
 - android : background = " @ color / accent " 
 - android : src = " @ drawable / ic _ call _ white _ 36dp " / > 
 < / LinearLayout > 
 
 + 
 < / FrameLayout > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml 
 new file mode 100644 
 index 0000000 . . c7dfa0e 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / call _ menu . xml 
 @ @ - 0 , 0 + 1 , 17 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > 
 + 
 + < item 
 + android : id = " @ + id / members " 
 + android : icon = " @ drawable / main _ bar _ contacts _ active " 
 + android : title = " " 
 + app : showAsAction = " always " / > 
 + 
 + 
 + < / menu > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 5461c8d . . 0ac8749 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 458 , 6 + 458 , 12 @ @ 
 < string name = " media _ pager " formatted = " false " > % d of % d < / string > 
 < string name = " emoji _ no _ recent " > no recent emoji yet < / string > 
 
 + < ! - - Calls - - > 
 + < string name = " call _ ended " > Call ended < / string > 
 + < string name = " call _ incoming " > Incoming call < / string > 
 + < string name = " call _ outgoing " > Ringing … < / string > 
 + < string name = " call _ connecting " > Connecting … < / string > 
 + 
 < ! - - Dialogs - - > 
 < string name = " alert _ leave _ group _ message " > Are you sure want to exit group " % 1 $ s " ? < / string > 
 < string name = " alert _ leave _ group _ yes " > Exit < / string >
