BLEU SCORE: 0.1777835117834348

TEST MSG: fix ( android ) : recover + optimize fast share , disable by default
GENERATED MSG: feat ( android ) : chat backgrounds settings

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index 359d386 . . 516b460 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 139 , 6 + 139 , 11 @ @ public class ActorSDK { < nl > private String twitter = " actorapp " ; < nl > < nl > / * * < nl > + * Fast share menu is experimental feature - disabled be default < nl > + * / < nl > + private boolean fastShareEnabled = false ; < nl > + < nl > + / * * < nl > * Delegate < nl > * / < nl > @ NotNull < nl > @ @ - 555 , 6 + 560 , 24 @ @ public class ActorSDK { < nl > } < nl > < nl > / * * < nl > + * Is fast share menu enabled < nl > + * < nl > + * @ return fastShareEnabled is fast share enabled < nl > + * / < nl > + public boolean isFastShareEnabled ( ) { < nl > + return fastShareEnabled ; < nl > + } < nl > + < nl > + / * * < nl > + * Setting is is fast share enabled - experimental feature , disabled by default < nl > + * < nl > + * @ param fastShareEnabled < nl > + * / < nl > + public void setFastShareEnabled ( boolean fastShareEnabled ) { < nl > + this . fastShareEnabled = this . fastShareEnabled ; < nl > + } < nl > + < nl > + / * * < nl > * Setting is calls enabled - if enabled app will handle calls updates e . g . UpdateIncomingCall / UpdateCallSignal / UpdateCallEnded etc < nl > * < nl > * @ param callsEnabled is calls enabled < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 9e74bce . . 3e6ba78 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 320 , 6 + 320 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > final TextView locationText = ( TextView ) findViewById ( R . id . location _ text ) ; < nl > final View shareLocation = findViewById ( R . id . share _ location ) ; < nl > + findViewById ( R . id . share _ hide ) . setVisibility ( View . GONE ) ; < nl > / / try { < nl > / / ApplicationInfo app = ChatActivity . this . getPackageManager ( ) . getApplicationInfo ( ChatActivity . this . getPackageName ( ) , PackageManager . GET _ META _ DATA ) ; < nl > / / Bundle bundle = app . metaData ; < nl > @ @ - 407 , 12 + 408 , 6 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > findViewById ( R . id . share _ contact ) . setOnClickListener ( shareMenuOCL ) ; < nl > handleIntent ( ) ; < nl > < nl > - / / RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; < nl > - / / fastShareAdapter = new FastShareAdapter ( this ) ; < nl > - / / LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; < nl > - / / fastShare . setAdapter ( fastShareAdapter ) ; < nl > - / / fastShare . setLayoutManager ( layoutManager ) ; < nl > - < nl > final ImageButton shareMenuSend = ( ImageButton ) findViewById ( R . id . share _ send ) ; < nl > shareMenuSend . setColorFilter ( Color . WHITE , PorterDuff . Mode . SRC _ IN ) ; < nl > shareMenuSend . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ @ - 426 , 20 + 421 , 31 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > hideShare ( ) ; < nl > } < nl > } ) ; < nl > - / / fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { < nl > - / / @ Override < nl > - / / public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { < nl > - / / if ( val . size ( ) > 0 ) { < nl > - / / shareLocation . setVisibility ( View . INVISIBLE ) ; < nl > - / / shareMenuSend . setVisibility ( View . VISIBLE ) ; < nl > - / / locationText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; < nl > - / / } else { < nl > - / / shareLocation . setVisibility ( View . VISIBLE ) ; < nl > - / / shareMenuSend . setVisibility ( View . INVISIBLE ) ; < nl > - / / locationText . setText ( getString ( R . string . share _ menu _ location ) ) ; < nl > - / / } < nl > - / / } < nl > - / / } ) ; < nl > + < nl > + RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; < nl > + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { < nl > + fastShareAdapter = new FastShareAdapter ( this ) ; < nl > + LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; < nl > + fastShare . setAdapter ( fastShareAdapter ) ; < nl > + fastShare . setLayoutManager ( layoutManager ) ; < nl > + < nl > + fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { < nl > + @ Override < nl > + public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { < nl > + if ( val . size ( ) > 0 ) { < nl > + shareLocation . setVisibility ( View . INVISIBLE ) ; < nl > + shareMenuSend . setVisibility ( View . VISIBLE ) ; < nl > + locationText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; < nl > + } else { < nl > + shareLocation . setVisibility ( View . VISIBLE ) ; < nl > + shareMenuSend . setVisibility ( View . INVISIBLE ) ; < nl > + locationText . setText ( getString ( R . string . share _ menu _ location ) ) ; < nl > + } < nl > + } < nl > + } ) ; < nl > + } else { < nl > + fastShare . setVisibility ( View . GONE ) ; < nl > + } < nl > } < nl > < nl > private void startCamera ( ) { < nl > @ @ - 1426 , 7 + 1432 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > shareMenu . animate ( ) ; < nl > shareMenu . setVisibility ( View . VISIBLE ) ; < nl > isShareVisible = true ; < nl > - messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( true ) ) ; < nl > + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { < nl > + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( true ) ) ; < nl > + } < nl > } < nl > < nl > private void hideShare ( ) { < nl > @ @ - 1443 , 7 + 1451 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > shareMenu . animate ( ) ; < nl > shareMenu . setVisibility ( View . GONE ) ; < nl > shareContainer . setVisibility ( View . GONE ) ; < nl > - messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( false ) ) ; < nl > + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { < nl > + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( false ) ) ; < nl > + } < nl > < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java < nl > index 0dc7569 . . fd46cc2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java < nl > @ @ - 71 , 6 + 71 , 7 @ @ public class FastShareAdapter extends RecyclerView . Adapter < FastShareAdapter . Fast < nl > < nl > @ Override < nl > public void onBindViewHolder ( FastShareVH holder , int position ) { < nl > + < nl > holder . bind ( imagesPath . get ( position ) ) ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java < nl > index 6844310 . . fa8810d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java < nl > @ @ - 38 , 6 + 38 , 7 @ @ public class AvatarViewWithOnline extends FrameLayout { < nl > < nl > online = new ImageView ( getContext ( ) ) ; < nl > online . setImageResource ( R . drawable . indicator _ offline ) ; < nl > + online . setVisibility ( INVISIBLE ) ; < nl > addView ( online , new LayoutParams ( Screen . dp ( 11 ) , Screen . dp ( 11 ) , Gravity . RIGHT | Gravity . BOTTOM ) ) ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png < nl > deleted file mode 100644 < nl > index 153b20c . . 0000000 < nl > Binary files a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png and / dev / null differ < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png < nl > deleted file mode 100644 < nl > index 62e7b19 . . 0000000 < nl > Binary files a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png and / dev / null differ < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > index 4814076 . . 8da4e11 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml < nl > @ @ - 1 , 6 + 1 , 6 @ @ < nl > < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > - android : layout _ width = " match _ parent " < nl > + android : layout _ width = " wrap _ content " < nl > android : layout _ height = " match _ parent " < nl > android : padding = " 5dp " > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml < nl > index 946d8b8 . . 4624f49 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml < nl > @ @ - 8 , 6 + 8 , 10 @ @ < nl > < style name = " AppToolbarTheme " parent = " Theme . AppCompat . Light . DarkActionBar " > < nl > < item name = " android : windowContentOverlay " > @ null < / item > < nl > < nl > + < item name = " colorControlNormal " > # ffffffff < / item > < nl > + < item name = " android : textColorPrimary " > # ffffffff < / item > < nl > + < item name = " android : colorControlNormal " > # ffffffff < / item > < nl > + < nl > < item name = " colorPrimary " > @ color / primary < / item > < nl > < item name = " colorPrimaryDark " > @ color / primary _ hovered < / item > < nl > < item name = " colorAccent " > @ color / accent < / item > < nl > diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > index af83d18 . . 8b29b71 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > @ @ - 15 , 10 + 15 , 14 @ @ import java . util . ArrayList ; < nl > < nl > import im . actor . core . utils . ImageHelper ; < nl > import im . actor . core . viewmodel . GalleryVM ; < nl > + import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > < nl > public class GalleryScannerActor extends Actor { < nl > < nl > + public static final String TAG = " GALLERY _ SCANNER " ; < nl > + public static final int CHECK _ NEW _ DELAY = 1000 ; < nl > + public static final int SCAN _ DELAY = 100 ; < nl > Context context ; < nl > Uri uri ; < nl > Cursor cursor ; < nl > @ @ - 30 , 9 + 34 , 8 @ @ public class GalleryScannerActor extends Actor { < nl > < nl > String absolutePathOfImage = null ; < nl > GalleryVM galleryVM ; < nl > - Uri lastScan ; < nl > < nl > - private static final int SCAN _ COUNT = 10 ; < nl > + private static final int SCAN _ COUNT = 9 ; < nl > < nl > ArrayList < String > loaded = new ArrayList < > ( ) ; < nl > private boolean visible = false ; < nl > @ @ - 47 , 11 + 50 , 10 @ @ public class GalleryScannerActor extends Actor { < nl > @ Override < nl > public void preStart ( ) { < nl > uri = android . provider . MediaStore . Images . Media . EXTERNAL _ CONTENT _ URI ; < nl > - < nl > - self ( ) . send ( new InitScan ( ) ) ; < nl > } < nl > < nl > public void initScan ( ) { < nl > + Log . d ( TAG , " init scan " ) ; < nl > projection = new String [ ] { MediaStore . MediaColumns . DATA , < nl > MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME , < nl > MediaStore . Images . Media . DATE _ MODIFIED } ; < nl > @ @ - 65 , 9 + 67 , 11 @ @ public class GalleryScannerActor extends Actor { < nl > . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME ) ; < nl > < nl > < nl > + Log . d ( TAG , " init scan ok - starting scan iterations " ) ; < nl > self ( ) . send ( new Scan ( ) ) ; < nl > } else { < nl > - schedule ( new InitScan ( ) , 1000 ) ; < nl > + Log . d ( TAG , " init scan - no media , let ' s check it in " + CHECK _ NEW _ DELAY ) ; < nl > + schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; < nl > } < nl > < nl > } < nl > @ @ - 79 , 25 + 83 , 35 @ @ public class GalleryScannerActor extends Actor { < nl > < nl > private void scan ( ) { < nl > < nl > - < nl > + Log . d ( TAG , " scan " ) ; < nl > int i = 0 ; < nl > while ( offset + i + + < offset + SCAN _ COUNT & & cursor . moveToNext ( ) ) { < nl > absolutePathOfImage = cursor . getString ( column _ index _ data ) ; < nl > < nl > listOfAllImages . add ( absolutePathOfImage ) ; < nl > } < nl > - galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; < nl > + boolean added = false ; < nl > + if ( offset % 100 = = 0 ) { < nl > + Log . d ( TAG , " scan - update vm , offset - " + offset ) ; < nl > + galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; < nl > + added = true ; < nl > + } < nl > offset + = i ; < nl > if ( offset < cursor . getCount ( ) ) { < nl > - self ( ) . send ( new Scan ( ) ) ; < nl > + Log . d ( TAG , " scan - " + i + " iterations , offset - " + offset + " , schedule next in " + SCAN _ DELAY ) ; < nl > + schedule ( new Scan ( ) , SCAN _ DELAY ) ; < nl > } else { < nl > - lastScan = MediaStore . getMediaScannerUri ( ) ; < nl > + if ( ! added ) { < nl > + galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; < nl > + } < nl > + Log . d ( TAG , " scanned to end , offset - " + offset + " , schedule check new in " + CHECK _ NEW _ DELAY ) ; < nl > scanned = true ; < nl > - schedule ( new CheckNew ( ) , 1000 ) ; < nl > + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; < nl > } < nl > } < nl > < nl > private void checkNew ( ) { < nl > + Log . d ( TAG , " checkNew " ) ; < nl > cursor = getQuery ( ) ; < nl > newMedia . clear ( ) ; < nl > while ( cursor ! = null & & cursor . moveToNext ( ) ) { < nl > @ @ - 107 , 19 + 121 , 29 @ @ public class GalleryScannerActor extends Actor { < nl > if ( bitmap ! = null ) { < nl > bitmap . recycle ( ) ; < nl > newMedia . add ( absolutePathOfImage ) ; < nl > + Log . d ( TAG , " checkNew - new media " ) ; < nl > + < nl > } else { < nl > + Log . d ( TAG , " checkNew - new media writing , breaking for wait " ) ; < nl > + < nl > break ; < nl > } < nl > } else { < nl > + Log . d ( TAG , " checkNew - found old media , break " ) ; < nl > + < nl > break ; < nl > } < nl > } < nl > if ( newMedia . size ( ) > 0 ) { < nl > listOfAllImages . addAll ( 0 , newMedia ) ; < nl > galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; < nl > + Log . d ( TAG , " checkNew - new media add - " + newMedia . size ( ) ) ; < nl > + < nl > } < nl > if ( visible ) { < nl > - schedule ( new CheckNew ( ) , 1000 ) ; < nl > + Log . d ( TAG , " checkNew - visible , schedule next check in " + CHECK _ NEW _ DELAY ) ; < nl > + < nl > + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; < nl > } < nl > } < nl > < nl > @ @ - 136 , 6 + 160 , 8 @ @ public class GalleryScannerActor extends Actor { < nl > visible = true ; < nl > if ( scanned ) { < nl > self ( ) . send ( new CheckNew ( ) ) ; < nl > + } else { < nl > + self ( ) . send ( new InitScan ( ) ) ; < nl > } < nl > } else { < nl > visible = false ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 7b89f42 . . 1a6196a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > } < nl > } < nl > + super . onActivityResult ( requestCode , resultCode , data ) ; < nl > } < nl > < nl > / / Mentions < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > index d8717e9 . . e177ecd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > @ @ - 1 , 16 + 1 , 19 @ @ < nl > package im . actor . sdk . controllers . conversation . view ; < nl > < nl > import android . content . Context ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Canvas ; < nl > import android . graphics . drawable . Drawable ; < nl > import android . util . AttributeSet ; < nl > import android . view . View ; < nl > < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > < nl > public class ChatBackgroundView extends View { < nl > < nl > private Drawable background ; < nl > + SharedPreferences shp ; < nl > < nl > public ChatBackgroundView ( Context context ) { < nl > super ( context ) ; < nl > @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { < nl > < nl > public void bind ( ) { < nl > if ( background = = null ) { < nl > - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; < nl > + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; < nl > } < nl > + < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > index b88785e . . 50d64ca 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { < nl > ViewUtils . showView ( view , isAnimated , isSlow ) ; < nl > } < nl > < nl > + public void elevateView ( View view ) { < nl > + ViewUtils . elevateView ( view ) ; < nl > + } < nl > + < nl > + public void elevateView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . elevateView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + public void demoteView ( View view ) { < nl > + ViewUtils . demoteView ( view ) ; < nl > + } < nl > + < nl > + public void demoteView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . demoteView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + < nl > public void onClick ( View view , int id , final View . OnClickListener listener ) { < nl > onClick ( view . findViewById ( id ) , listener ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > index 04e80fd . . 8eba614 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { < nl > nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; < nl > tintImageView . setVisibility ( View . INVISIBLE ) ; < nl > - String value = nick ; < nl > + String value = " @ " . concat ( nick ) ; < nl > String title = getString ( R . string . nickname ) ; < nl > recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; < nl > ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > index a659507 . . d70cba7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; < nl > import android . content . Context ; < nl > import android . content . DialogInterface ; < nl > import android . content . Intent ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . net . Uri ; < nl > @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > import im . actor . sdk . controllers . fragment . help . HelpActivity ; < nl > import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > import im . actor . sdk . view . TintImageView ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > private int baseColor ; < nl > private CoverAvatarView avatarView ; < nl > + SharedPreferences shp ; < nl > + SharedPreferences . Editor ed ; < nl > < nl > @ Override < nl > public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; < nl > + < nl > + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + ed = shp . edit ( ) ; < nl > + < nl > baseColor = getResources ( ) . getColor ( R . color . primary ) ; < nl > final ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > final UserVM userModel = users ( ) . get ( myUid ( ) ) ; < nl > @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; < nl > < nl > + / / Wallpaper < nl > + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; < nl > + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; < nl > + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; < nl > + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + final View [ ] elevated = new View [ ] { null } ; < nl > + View . OnClickListener ocl = new View . OnClickListener ( ) { < nl > + < nl > + @ Override < nl > + public void onClick ( final View v ) { < nl > + if ( v ! = elevated [ 0 ] ) { < nl > + if ( elevated [ 0 ] ! = null ) { < nl > + demoteView ( elevated [ 0 ] ) ; < nl > + } < nl > + elevated [ 0 ] = v ; < nl > + elevateView ( v ) ; < nl > + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; < nl > + ed . commit ( ) ; < nl > + } < nl > + } < nl > + } ; < nl > + for ( int i = 0 ; i < 4 ; i + + ) { < nl > + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; < nl > + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; < nl > + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; < nl > + bckgrnd . bind ( i ) ; < nl > + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; < nl > + frame . setTag ( i ) ; < nl > + frame . setOnClickListener ( ocl ) ; < nl > + frame . addView ( bckgrnd ) ; < nl > + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; < nl > + < nl > + if ( i = = selectedWallpaper ) { < nl > + elevateView ( frame , false ) ; < nl > + elevated [ 0 ] = frame ; < nl > + } < nl > + } < nl > + < nl > view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > index 43b6b07 . . 81b27d3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; < nl > import android . view . View ; < nl > import android . view . animation . AlphaAnimation ; < nl > import android . view . animation . Animation ; < nl > + import android . view . animation . ScaleAnimation ; < nl > import android . view . animation . Transformation ; < nl > import android . widget . AbsListView ; < nl > < nl > @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { < nl > < nl > < nl > } < nl > + < nl > + public static void elevateView ( final View view ) { < nl > + elevateView ( view , true ) ; < nl > + } < nl > + < nl > + public static void elevateView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + < nl > + } < nl > + < nl > + public static void demoteView ( final View view ) { < nl > + demoteView ( view , true ) ; < nl > + } < nl > + < nl > + public static void demoteView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + if ( isAnimated ) { < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + } < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > new file mode 100644 < nl > index 0000000 . . fb7ae5c < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > @ @ - 0 , 0 + 1 , 79 @ @ < nl > + package im . actor . sdk . view ; < nl > + < nl > + import android . content . Context ; < nl > + import android . net . Uri ; < nl > + import android . util . AttributeSet ; < nl > + < nl > + import com . facebook . common . util . UriUtil ; < nl > + import com . facebook . drawee . backends . pipeline . Fresco ; < nl > + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchy ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; < nl > + import com . facebook . drawee . view . SimpleDraweeView ; < nl > + import com . facebook . imagepipeline . common . ResizeOptions ; < nl > + import com . facebook . imagepipeline . request . ImageRequest ; < nl > + import com . facebook . imagepipeline . request . ImageRequestBuilder ; < nl > + < nl > + import im . actor . sdk . R ; < nl > + < nl > + public class BackgroundPreviewView extends SimpleDraweeView { < nl > + < nl > + private int width ; < nl > + private int height ; < nl > + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; < nl > + < nl > + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { < nl > + super ( context , hierarchy ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { < nl > + super ( context , attrs ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { < nl > + super ( context , attrs , defStyle ) ; < nl > + } < nl > + < nl > + public void init ( int width , int height ) { < nl > + this . width = width ; < nl > + this . height = height ; < nl > + < nl > + GenericDraweeHierarchyBuilder builder = < nl > + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; < nl > + < nl > + GenericDraweeHierarchy hierarchy = builder < nl > + . setFadeDuration ( 200 ) < nl > + . build ( ) ; < nl > + setHierarchy ( hierarchy ) ; < nl > + } < nl > + < nl > + public void bind ( int i ) { < nl > + int bkgrnd = getBackground ( i ) ; < nl > + Uri uri = new Uri . Builder ( ) < nl > + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) < nl > + . path ( String . valueOf ( bkgrnd ) ) < nl > + . build ( ) ; < nl > + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > + . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > + . build ( ) ; < nl > + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > + . setOldController ( getController ( ) ) < nl > + . setImageRequest ( request ) < nl > + . build ( ) ; < nl > + setController ( controller ) ; < nl > + < nl > + } < nl > + < nl > + < nl > + public static int getBackground ( int i ) { < nl > + if ( i > = 0 & & BACKGROUNDS . length > i ) { < nl > + return BACKGROUNDS [ i ] ; < nl > + } else { < nl > + return R . drawable . img _ chat _ background _ default ; < nl > + } < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > index fa384b2 . . f688b72 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > @ @ - 282 , 6 + 282 , 56 @ @ < nl > < / LinearLayout > < nl > < nl > < FrameLayout < nl > + android : id = " @ + id / wallpaperDivider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 16dp " < nl > + android : background = " @ color / bg _ backyard " > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : background = " @ drawable / card _ shadow _ bottom " / > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 1dp " < nl > + android : layout _ gravity = " bottom " < nl > + android : background = " @ drawable / card _ shadow _ top " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / settings _ wallpaper _ title " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : gravity = " center _ vertical | left " < nl > + android : paddingLeft = " 72dp " < nl > + android : text = " @ string / wallpaper " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < HorizontalScrollView < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : requiresFadingEdge = " none " < nl > + android : scrollbars = " none " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / background _ container " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " horizontal " > < nl > + < nl > + < View < nl > + android : layout _ width = " 72dp " < nl > + android : layout _ height = " 200dp " < nl > + android : background = " @ android : color / transparent " / > < nl > + < nl > + < nl > + < / LinearLayout > < nl > + < / HorizontalScrollView > < nl > + < nl > + < nl > + < FrameLayout < nl > android : id = " @ + id / settings _ bottom _ container " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " / > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 3c3350b . . 9ad8001 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 153 , 6 + 153 , 7 @ @ < nl > < string name = " nickname _ change " > И з м е н и т ь н и к < / string > < nl > < string name = " about _ user _ me " > О б о м н е < / string > < nl > < string name = " about _ user " > О п о л ь з о в а т е л е < / string > < nl > + < string name = " wallpaper " > О б о и < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 2270a93 . . 3a7761d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 157 , 6 + 157 , 7 @ @ < nl > < string name = " nickname _ edittext _ hint " > Enter your Username < / string > < nl > < string name = " about _ user _ me " > About me < / string > < nl > < string name = " about _ user " > About user < / string > < nl > + < string name = " wallpaper " > Wallpaper < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > Call { 0 } < / string >

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index 359d386 . . 516b460 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 139 , 6 + 139 , 11 @ @ public class ActorSDK { 
 private String twitter = " actorapp " ; 
 
 / * * 
 + * Fast share menu is experimental feature - disabled be default 
 + * / 
 + private boolean fastShareEnabled = false ; 
 + 
 + / * * 
 * Delegate 
 * / 
 @ NotNull 
 @ @ - 555 , 6 + 560 , 24 @ @ public class ActorSDK { 
 } 
 
 / * * 
 + * Is fast share menu enabled 
 + * 
 + * @ return fastShareEnabled is fast share enabled 
 + * / 
 + public boolean isFastShareEnabled ( ) { 
 + return fastShareEnabled ; 
 + } 
 + 
 + / * * 
 + * Setting is is fast share enabled - experimental feature , disabled by default 
 + * 
 + * @ param fastShareEnabled 
 + * / 
 + public void setFastShareEnabled ( boolean fastShareEnabled ) { 
 + this . fastShareEnabled = this . fastShareEnabled ; 
 + } 
 + 
 + / * * 
 * Setting is calls enabled - if enabled app will handle calls updates e . g . UpdateIncomingCall / UpdateCallSignal / UpdateCallEnded etc 
 * 
 * @ param callsEnabled is calls enabled 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 9e74bce . . 3e6ba78 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 320 , 6 + 320 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 final TextView locationText = ( TextView ) findViewById ( R . id . location _ text ) ; 
 final View shareLocation = findViewById ( R . id . share _ location ) ; 
 + findViewById ( R . id . share _ hide ) . setVisibility ( View . GONE ) ; 
 / / try { 
 / / ApplicationInfo app = ChatActivity . this . getPackageManager ( ) . getApplicationInfo ( ChatActivity . this . getPackageName ( ) , PackageManager . GET _ META _ DATA ) ; 
 / / Bundle bundle = app . metaData ; 
 @ @ - 407 , 12 + 408 , 6 @ @ public class ChatActivity extends ActorEditTextActivity { 
 findViewById ( R . id . share _ contact ) . setOnClickListener ( shareMenuOCL ) ; 
 handleIntent ( ) ; 
 
 - / / RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; 
 - / / fastShareAdapter = new FastShareAdapter ( this ) ; 
 - / / LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; 
 - / / fastShare . setAdapter ( fastShareAdapter ) ; 
 - / / fastShare . setLayoutManager ( layoutManager ) ; 
 - 
 final ImageButton shareMenuSend = ( ImageButton ) findViewById ( R . id . share _ send ) ; 
 shareMenuSend . setColorFilter ( Color . WHITE , PorterDuff . Mode . SRC _ IN ) ; 
 shareMenuSend . setOnClickListener ( new View . OnClickListener ( ) { 
 @ @ - 426 , 20 + 421 , 31 @ @ public class ChatActivity extends ActorEditTextActivity { 
 hideShare ( ) ; 
 } 
 } ) ; 
 - / / fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { 
 - / / @ Override 
 - / / public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { 
 - / / if ( val . size ( ) > 0 ) { 
 - / / shareLocation . setVisibility ( View . INVISIBLE ) ; 
 - / / shareMenuSend . setVisibility ( View . VISIBLE ) ; 
 - / / locationText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; 
 - / / } else { 
 - / / shareLocation . setVisibility ( View . VISIBLE ) ; 
 - / / shareMenuSend . setVisibility ( View . INVISIBLE ) ; 
 - / / locationText . setText ( getString ( R . string . share _ menu _ location ) ) ; 
 - / / } 
 - / / } 
 - / / } ) ; 
 + 
 + RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; 
 + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { 
 + fastShareAdapter = new FastShareAdapter ( this ) ; 
 + LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; 
 + fastShare . setAdapter ( fastShareAdapter ) ; 
 + fastShare . setLayoutManager ( layoutManager ) ; 
 + 
 + fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { 
 + @ Override 
 + public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { 
 + if ( val . size ( ) > 0 ) { 
 + shareLocation . setVisibility ( View . INVISIBLE ) ; 
 + shareMenuSend . setVisibility ( View . VISIBLE ) ; 
 + locationText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; 
 + } else { 
 + shareLocation . setVisibility ( View . VISIBLE ) ; 
 + shareMenuSend . setVisibility ( View . INVISIBLE ) ; 
 + locationText . setText ( getString ( R . string . share _ menu _ location ) ) ; 
 + } 
 + } 
 + } ) ; 
 + } else { 
 + fastShare . setVisibility ( View . GONE ) ; 
 + } 
 } 
 
 private void startCamera ( ) { 
 @ @ - 1426 , 7 + 1432 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { 
 shareMenu . animate ( ) ; 
 shareMenu . setVisibility ( View . VISIBLE ) ; 
 isShareVisible = true ; 
 - messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( true ) ) ; 
 + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { 
 + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( true ) ) ; 
 + } 
 } 
 
 private void hideShare ( ) { 
 @ @ - 1443 , 7 + 1451 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { 
 shareMenu . animate ( ) ; 
 shareMenu . setVisibility ( View . GONE ) ; 
 shareContainer . setVisibility ( View . GONE ) ; 
 - messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( false ) ) ; 
 + if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { 
 + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Visible ( false ) ) ; 
 + } 
 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java 
 index 0dc7569 . . fd46cc2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / FastShareAdapter . java 
 @ @ - 71 , 6 + 71 , 7 @ @ public class FastShareAdapter extends RecyclerView . Adapter < FastShareAdapter . Fast 
 
 @ Override 
 public void onBindViewHolder ( FastShareVH holder , int position ) { 
 + 
 holder . bind ( imagesPath . get ( position ) ) ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java 
 index 6844310 . . fa8810d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / avatar / AvatarViewWithOnline . java 
 @ @ - 38 , 6 + 38 , 7 @ @ public class AvatarViewWithOnline extends FrameLayout { 
 
 online = new ImageView ( getContext ( ) ) ; 
 online . setImageResource ( R . drawable . indicator _ offline ) ; 
 + online . setVisibility ( INVISIBLE ) ; 
 addView ( online , new LayoutParams ( Screen . dp ( 11 ) , Screen . dp ( 11 ) , Gravity . RIGHT | Gravity . BOTTOM ) ) ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png 
 deleted file mode 100644 
 index 153b20c . . 0000000 
 Binary files a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls . png and / dev / null differ 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png 
 deleted file mode 100644 
 index 62e7b19 . . 0000000 
 Binary files a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / calls2 . png and / dev / null differ 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 index 4814076 . . 8da4e11 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ fast _ share . xml 
 @ @ - 1 , 6 + 1 , 6 @ @ 
 < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 - android : layout _ width = " match _ parent " 
 + android : layout _ width = " wrap _ content " 
 android : layout _ height = " match _ parent " 
 android : padding = " 5dp " > 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml 
 index 946d8b8 . . 4624f49 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / styles . xml 
 @ @ - 8 , 6 + 8 , 10 @ @ 
 < style name = " AppToolbarTheme " parent = " Theme . AppCompat . Light . DarkActionBar " > 
 < item name = " android : windowContentOverlay " > @ null < / item > 
 
 + < item name = " colorControlNormal " > # ffffffff < / item > 
 + < item name = " android : textColorPrimary " > # ffffffff < / item > 
 + < item name = " android : colorControlNormal " > # ffffffff < / item > 
 + 
 < item name = " colorPrimary " > @ color / primary < / item > 
 < item name = " colorPrimaryDark " > @ color / primary _ hovered < / item > 
 < item name = " colorAccent " > @ color / accent < / item > 
 diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 index af83d18 . . 8b29b71 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 @ @ - 15 , 10 + 15 , 14 @ @ import java . util . ArrayList ; 
 
 import im . actor . core . utils . ImageHelper ; 
 import im . actor . core . viewmodel . GalleryVM ; 
 + import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 
 public class GalleryScannerActor extends Actor { 
 
 + public static final String TAG = " GALLERY _ SCANNER " ; 
 + public static final int CHECK _ NEW _ DELAY = 1000 ; 
 + public static final int SCAN _ DELAY = 100 ; 
 Context context ; 
 Uri uri ; 
 Cursor cursor ; 
 @ @ - 30 , 9 + 34 , 8 @ @ public class GalleryScannerActor extends Actor { 
 
 String absolutePathOfImage = null ; 
 GalleryVM galleryVM ; 
 - Uri lastScan ; 
 
 - private static final int SCAN _ COUNT = 10 ; 
 + private static final int SCAN _ COUNT = 9 ; 
 
 ArrayList < String > loaded = new ArrayList < > ( ) ; 
 private boolean visible = false ; 
 @ @ - 47 , 11 + 50 , 10 @ @ public class GalleryScannerActor extends Actor { 
 @ Override 
 public void preStart ( ) { 
 uri = android . provider . MediaStore . Images . Media . EXTERNAL _ CONTENT _ URI ; 
 - 
 - self ( ) . send ( new InitScan ( ) ) ; 
 } 
 
 public void initScan ( ) { 
 + Log . d ( TAG , " init scan " ) ; 
 projection = new String [ ] { MediaStore . MediaColumns . DATA , 
 MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME , 
 MediaStore . Images . Media . DATE _ MODIFIED } ; 
 @ @ - 65 , 9 + 67 , 11 @ @ public class GalleryScannerActor extends Actor { 
 . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME ) ; 
 
 
 + Log . d ( TAG , " init scan ok - starting scan iterations " ) ; 
 self ( ) . send ( new Scan ( ) ) ; 
 } else { 
 - schedule ( new InitScan ( ) , 1000 ) ; 
 + Log . d ( TAG , " init scan - no media , let ' s check it in " + CHECK _ NEW _ DELAY ) ; 
 + schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; 
 } 
 
 } 
 @ @ - 79 , 25 + 83 , 35 @ @ public class GalleryScannerActor extends Actor { 
 
 private void scan ( ) { 
 
 - 
 + Log . d ( TAG , " scan " ) ; 
 int i = 0 ; 
 while ( offset + i + + < offset + SCAN _ COUNT & & cursor . moveToNext ( ) ) { 
 absolutePathOfImage = cursor . getString ( column _ index _ data ) ; 
 
 listOfAllImages . add ( absolutePathOfImage ) ; 
 } 
 - galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; 
 + boolean added = false ; 
 + if ( offset % 100 = = 0 ) { 
 + Log . d ( TAG , " scan - update vm , offset - " + offset ) ; 
 + galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; 
 + added = true ; 
 + } 
 offset + = i ; 
 if ( offset < cursor . getCount ( ) ) { 
 - self ( ) . send ( new Scan ( ) ) ; 
 + Log . d ( TAG , " scan - " + i + " iterations , offset - " + offset + " , schedule next in " + SCAN _ DELAY ) ; 
 + schedule ( new Scan ( ) , SCAN _ DELAY ) ; 
 } else { 
 - lastScan = MediaStore . getMediaScannerUri ( ) ; 
 + if ( ! added ) { 
 + galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; 
 + } 
 + Log . d ( TAG , " scanned to end , offset - " + offset + " , schedule check new in " + CHECK _ NEW _ DELAY ) ; 
 scanned = true ; 
 - schedule ( new CheckNew ( ) , 1000 ) ; 
 + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; 
 } 
 } 
 
 private void checkNew ( ) { 
 + Log . d ( TAG , " checkNew " ) ; 
 cursor = getQuery ( ) ; 
 newMedia . clear ( ) ; 
 while ( cursor ! = null & & cursor . moveToNext ( ) ) { 
 @ @ - 107 , 19 + 121 , 29 @ @ public class GalleryScannerActor extends Actor { 
 if ( bitmap ! = null ) { 
 bitmap . recycle ( ) ; 
 newMedia . add ( absolutePathOfImage ) ; 
 + Log . d ( TAG , " checkNew - new media " ) ; 
 + 
 } else { 
 + Log . d ( TAG , " checkNew - new media writing , breaking for wait " ) ; 
 + 
 break ; 
 } 
 } else { 
 + Log . d ( TAG , " checkNew - found old media , break " ) ; 
 + 
 break ; 
 } 
 } 
 if ( newMedia . size ( ) > 0 ) { 
 listOfAllImages . addAll ( 0 , newMedia ) ; 
 galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; 
 + Log . d ( TAG , " checkNew - new media add - " + newMedia . size ( ) ) ; 
 + 
 } 
 if ( visible ) { 
 - schedule ( new CheckNew ( ) , 1000 ) ; 
 + Log . d ( TAG , " checkNew - visible , schedule next check in " + CHECK _ NEW _ DELAY ) ; 
 + 
 + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; 
 } 
 } 
 
 @ @ - 136 , 6 + 160 , 8 @ @ public class GalleryScannerActor extends Actor { 
 visible = true ; 
 if ( scanned ) { 
 self ( ) . send ( new CheckNew ( ) ) ; 
 + } else { 
 + self ( ) . send ( new InitScan ( ) ) ; 
 } 
 } else { 
 visible = false ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 7b89f42 . . 1a6196a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 } 
 } 
 + super . onActivityResult ( requestCode , resultCode , data ) ; 
 } 
 
 / / Mentions 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 index d8717e9 . . e177ecd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 @ @ - 1 , 16 + 1 , 19 @ @ 
 package im . actor . sdk . controllers . conversation . view ; 
 
 import android . content . Context ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Canvas ; 
 import android . graphics . drawable . Drawable ; 
 import android . util . AttributeSet ; 
 import android . view . View ; 
 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 
 public class ChatBackgroundView extends View { 
 
 private Drawable background ; 
 + SharedPreferences shp ; 
 
 public ChatBackgroundView ( Context context ) { 
 super ( context ) ; 
 @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { 
 
 public void bind ( ) { 
 if ( background = = null ) { 
 - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; 
 + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; 
 } 
 + 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 index b88785e . . 50d64ca 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { 
 ViewUtils . showView ( view , isAnimated , isSlow ) ; 
 } 
 
 + public void elevateView ( View view ) { 
 + ViewUtils . elevateView ( view ) ; 
 + } 
 + 
 + public void elevateView ( final View view , boolean isAnimated ) { 
 + ViewUtils . elevateView ( view , isAnimated ) ; 
 + } 
 + 
 + public void demoteView ( View view ) { 
 + ViewUtils . demoteView ( view ) ; 
 + } 
 + 
 + public void demoteView ( final View view , boolean isAnimated ) { 
 + ViewUtils . demoteView ( view , isAnimated ) ; 
 + } 
 + 
 + 
 public void onClick ( View view , int id , final View . OnClickListener listener ) { 
 onClick ( view . findViewById ( id ) , listener ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 index 04e80fd . . 8eba614 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { 
 nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; 
 tintImageView . setVisibility ( View . INVISIBLE ) ; 
 - String value = nick ; 
 + String value = " @ " . concat ( nick ) ; 
 String title = getString ( R . string . nickname ) ; 
 recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; 
 ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 index a659507 . . d70cba7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; 
 import android . content . Context ; 
 import android . content . DialogInterface ; 
 import android . content . Intent ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . net . Uri ; 
 @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; 
 import im . actor . sdk . controllers . fragment . help . HelpActivity ; 
 import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 import im . actor . sdk . view . TintImageView ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 private int baseColor ; 
 private CoverAvatarView avatarView ; 
 + SharedPreferences shp ; 
 + SharedPreferences . Editor ed ; 
 
 @ Override 
 public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; 
 + 
 + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + ed = shp . edit ( ) ; 
 + 
 baseColor = getResources ( ) . getColor ( R . color . primary ) ; 
 final ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 final UserVM userModel = users ( ) . get ( myUid ( ) ) ; 
 @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; 
 
 + / / Wallpaper 
 + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; 
 + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; 
 + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; 
 + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + final View [ ] elevated = new View [ ] { null } ; 
 + View . OnClickListener ocl = new View . OnClickListener ( ) { 
 + 
 + @ Override 
 + public void onClick ( final View v ) { 
 + if ( v ! = elevated [ 0 ] ) { 
 + if ( elevated [ 0 ] ! = null ) { 
 + demoteView ( elevated [ 0 ] ) ; 
 + } 
 + elevated [ 0 ] = v ; 
 + elevateView ( v ) ; 
 + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; 
 + ed . commit ( ) ; 
 + } 
 + } 
 + } ; 
 + for ( int i = 0 ; i < 4 ; i + + ) { 
 + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; 
 + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; 
 + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; 
 + bckgrnd . bind ( i ) ; 
 + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; 
 + frame . setTag ( i ) ; 
 + frame . setOnClickListener ( ocl ) ; 
 + frame . addView ( bckgrnd ) ; 
 + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; 
 + 
 + if ( i = = selectedWallpaper ) { 
 + elevateView ( frame , false ) ; 
 + elevated [ 0 ] = frame ; 
 + } 
 + } 
 + 
 view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 index 43b6b07 . . 81b27d3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; 
 import android . view . View ; 
 import android . view . animation . AlphaAnimation ; 
 import android . view . animation . Animation ; 
 + import android . view . animation . ScaleAnimation ; 
 import android . view . animation . Transformation ; 
 import android . widget . AbsListView ; 
 
 @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { 
 
 
 } 
 + 
 + public static void elevateView ( final View view ) { 
 + elevateView ( view , true ) ; 
 + } 
 + 
 + public static void elevateView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + 
 + } 
 + 
 + public static void demoteView ( final View view ) { 
 + demoteView ( view , true ) ; 
 + } 
 + 
 + public static void demoteView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + if ( isAnimated ) { 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + } 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 new file mode 100644 
 index 0000000 . . fb7ae5c 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 @ @ - 0 , 0 + 1 , 79 @ @ 
 + package im . actor . sdk . view ; 
 + 
 + import android . content . Context ; 
 + import android . net . Uri ; 
 + import android . util . AttributeSet ; 
 + 
 + import com . facebook . common . util . UriUtil ; 
 + import com . facebook . drawee . backends . pipeline . Fresco ; 
 + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchy ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; 
 + import com . facebook . drawee . view . SimpleDraweeView ; 
 + import com . facebook . imagepipeline . common . ResizeOptions ; 
 + import com . facebook . imagepipeline . request . ImageRequest ; 
 + import com . facebook . imagepipeline . request . ImageRequestBuilder ; 
 + 
 + import im . actor . sdk . R ; 
 + 
 + public class BackgroundPreviewView extends SimpleDraweeView { 
 + 
 + private int width ; 
 + private int height ; 
 + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; 
 + 
 + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { 
 + super ( context , hierarchy ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context ) { 
 + super ( context ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { 
 + super ( context , attrs ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { 
 + super ( context , attrs , defStyle ) ; 
 + } 
 + 
 + public void init ( int width , int height ) { 
 + this . width = width ; 
 + this . height = height ; 
 + 
 + GenericDraweeHierarchyBuilder builder = 
 + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; 
 + 
 + GenericDraweeHierarchy hierarchy = builder 
 + . setFadeDuration ( 200 ) 
 + . build ( ) ; 
 + setHierarchy ( hierarchy ) ; 
 + } 
 + 
 + public void bind ( int i ) { 
 + int bkgrnd = getBackground ( i ) ; 
 + Uri uri = new Uri . Builder ( ) 
 + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) 
 + . path ( String . valueOf ( bkgrnd ) ) 
 + . build ( ) ; 
 + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 + . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 + . build ( ) ; 
 + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 + . setOldController ( getController ( ) ) 
 + . setImageRequest ( request ) 
 + . build ( ) ; 
 + setController ( controller ) ; 
 + 
 + } 
 + 
 + 
 + public static int getBackground ( int i ) { 
 + if ( i > = 0 & & BACKGROUNDS . length > i ) { 
 + return BACKGROUNDS [ i ] ; 
 + } else { 
 + return R . drawable . img _ chat _ background _ default ; 
 + } 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 index fa384b2 . . f688b72 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 @ @ - 282 , 6 + 282 , 56 @ @ 
 < / LinearLayout > 
 
 < FrameLayout 
 + android : id = " @ + id / wallpaperDivider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 16dp " 
 + android : background = " @ color / bg _ backyard " > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : background = " @ drawable / card _ shadow _ bottom " / > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 1dp " 
 + android : layout _ gravity = " bottom " 
 + android : background = " @ drawable / card _ shadow _ top " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / settings _ wallpaper _ title " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : gravity = " center _ vertical | left " 
 + android : paddingLeft = " 72dp " 
 + android : text = " @ string / wallpaper " 
 + android : textSize = " 16sp " / > 
 + 
 + < HorizontalScrollView 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : requiresFadingEdge = " none " 
 + android : scrollbars = " none " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / background _ container " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " horizontal " > 
 + 
 + < View 
 + android : layout _ width = " 72dp " 
 + android : layout _ height = " 200dp " 
 + android : background = " @ android : color / transparent " / > 
 + 
 + 
 + < / LinearLayout > 
 + < / HorizontalScrollView > 
 + 
 + 
 + < FrameLayout 
 android : id = " @ + id / settings _ bottom _ container " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " / > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 3c3350b . . 9ad8001 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 153 , 6 + 153 , 7 @ @ 
 < string name = " nickname _ change " > И з м е н и т ь н и к < / string > 
 < string name = " about _ user _ me " > О б о м н е < / string > 
 < string name = " about _ user " > О п о л ь з о в а т е л е < / string > 
 + < string name = " wallpaper " > О б о и < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 2270a93 . . 3a7761d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 157 , 6 + 157 , 7 @ @ 
 < string name = " nickname _ edittext _ hint " > Enter your Username < / string > 
 < string name = " about _ user _ me " > About me < / string > 
 < string name = " about _ user " > About user < / string > 
 + < string name = " wallpaper " > Wallpaper < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > Call { 0 } < / string >
