BLEU SCORE: 0.0622561686654695

TEST MSG: fix ( IOS ) call from profile by phone number
GENERATED MSG: fix ( iOS ) : remove memory leaks form conv controller and attachment sheet

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > index 64c1da3 . . 477cf6b 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > @ @ - 509 , 6 + 509 , 12 @ @ import DZNWebViewController < nl > func openUrl ( url : String ) { < nl > if let u = NSURL ( string : url ) { < nl > < nl > + / / Handle phone call < nl > + if ( u . scheme . lowercaseString = = " telprompt " ) { < nl > + UIApplication . sharedApplication ( ) . openURL ( u ) < nl > + return < nl > + } < nl > + < nl > / / Handle web invite url < nl > if ( u . scheme . lowercaseString = = " http " | | u . scheme . lowercaseString = = " https " ) & & inviteUrlHost ! = nil { < nl > < nl > @ @ - 540 , 6 + 546 , 8 @ @ import DZNWebViewController < nl > return < nl > } < nl > < nl > + < nl > + < nl > if ( url . isValidUrl ( ) ) { < nl > < nl > if let bindedController = bindedToWindow ? . rootViewController { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > index 2fb93ca . . 3275cbb 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > @ @ - 405 , 11 + 405 , 6 @ @ public class AABubbleCell : UICollectionViewCell { < nl > public override func layoutSubviews ( ) { < nl > super . layoutSubviews ( ) < nl > < nl > - / / if ( ! needLayout ) { < nl > - / / return < nl > - / / } < nl > - / / needLayout = false < nl > - < nl > UIView . performWithoutAnimation { ( ) - > Void in < nl > let endPadding : CGFloat = 32 < nl > let startPadding : CGFloat = ( ! self . isOut & & self . isGroup ) ? AABubbleCell . avatarPadding : 0 < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift < nl > index 3424a8e . . 66c3a70 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift < nl > @ @ - 52 , 10 + 52 , 6 @ @ public class AABubbleTextCell : AABubbleCell { < nl > } < nl > } < nl > < nl > - / / messageText . textLongPressAction = { ( containerView : UIView , text : NSAttributedString , range : NSRange , rect : CGRect ) - > ( ) in < nl > - / / < nl > - / / } < nl > - < nl > messageText . highlightLongPressAction = { ( containerView : UIView , text : NSAttributedString , range : NSRange , rect : CGRect ) - > ( ) in < nl > self . bubble < nl > let attributes = text . attributesAtIndex ( range . location , effectiveRange : nil )
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > index 5a15add . . 8f60973 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > @ @ - 122 , 7 + 122 , 7 @ @ public class AABubbleCell : UICollectionViewCell { < nl > < nl > / / Binded data < nl > public var peer : ACPeer ! < nl > - public var controller : AAConversationContentController ! < nl > + public weak var controller : AAConversationContentController ! < nl > public var isGroup : Bool = false < nl > public var isFullSize : Bool ! < nl > public var bindedSetting : AACellSetting ? < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > index 58f4ec0 . . 5e4ce78 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > @ @ - 305 , 5 + 305 , 6 @ @ class AAConvActionSheet : UIView { < nl > } < nl > < nl > } < nl > + < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index 8b6732b . . e1fe5cc 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 180 , 12 + 180 , 6 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > name : SLKKeyboardWillHideNotification , < nl > object : nil ) < nl > < nl > - } < nl > - < nl > - override func viewWillAppear ( animated : Bool ) { < nl > - super . viewWillAppear ( animated ) < nl > - < nl > - textView . text = Actor . loadDraftWithPeer ( peer ) < nl > < nl > / / Installing bindings < nl > if ( UInt ( peer . peerType . ordinal ( ) ) = = ACPeerType . PRIVATE . rawValue ) { < nl > @ @ - 240 , 7 + 234 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > } else { < nl > self . setTextInputbarHidden ( false , animated : false ) < nl > } < nl > - < nl > + < nl > if ( typingValue ! = nil & & typingValue ! . length ( ) > 0 ) { < nl > self . subtitleView . textColor = self . appStyle . navigationSubtitleActiveColor < nl > if ( typingValue ! . length ( ) = = 1 ) { < nl > @ @ - 268 , 6 + 262 , 19 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > < nl > Actor . onConversationOpenWithPeer ( peer ) < nl > ActorSDK . sharedActor ( ) . trackPageVisible ( content ) < nl > + < nl > + } < nl > + < nl > + override func viewWillAppear ( animated : Bool ) { < nl > + super . viewWillAppear ( animated ) < nl > + < nl > + < nl > + if textView . isFirstResponder ( ) = = false { < nl > + textView . resignFirstResponder ( ) < nl > + } < nl > + < nl > + textView . text = Actor . loadDraftWithPeer ( peer ) < nl > + < nl > } < nl > < nl > override func viewWillLayoutSubviews ( ) { < nl > @ @ - 320 , 6 + 327 , 9 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > < nl > / / Releasing bindings < nl > binder . unbindAll ( ) < nl > + < nl > + self . actionSheet . removeFromSuperview ( ) < nl > + self . actionSheet = nil < nl > } < nl > < nl > / / Chat avatar tap < nl > @ @ - 798 , 6 + 808 , 10 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > Actor . sendStickerWithPeer ( self . peer , withSticker : sticker ) < nl > < nl > } < nl > + < nl > + deinit { < nl > + print ( " conversation controller deinit ' ed " ) < nl > + } < nl > < nl > < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 index 64c1da3 . . 477cf6b 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 @ @ - 509 , 6 + 509 , 12 @ @ import DZNWebViewController 
 func openUrl ( url : String ) { 
 if let u = NSURL ( string : url ) { 
 
 + / / Handle phone call 
 + if ( u . scheme . lowercaseString = = " telprompt " ) { 
 + UIApplication . sharedApplication ( ) . openURL ( u ) 
 + return 
 + } 
 + 
 / / Handle web invite url 
 if ( u . scheme . lowercaseString = = " http " | | u . scheme . lowercaseString = = " https " ) & & inviteUrlHost ! = nil { 
 
 @ @ - 540 , 6 + 546 , 8 @ @ import DZNWebViewController 
 return 
 } 
 
 + 
 + 
 if ( url . isValidUrl ( ) ) { 
 
 if let bindedController = bindedToWindow ? . rootViewController { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 index 2fb93ca . . 3275cbb 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 @ @ - 405 , 11 + 405 , 6 @ @ public class AABubbleCell : UICollectionViewCell { 
 public override func layoutSubviews ( ) { 
 super . layoutSubviews ( ) 
 
 - / / if ( ! needLayout ) { 
 - / / return 
 - / / } 
 - / / needLayout = false 
 - 
 UIView . performWithoutAnimation { ( ) - > Void in 
 let endPadding : CGFloat = 32 
 let startPadding : CGFloat = ( ! self . isOut & & self . isGroup ) ? AABubbleCell . avatarPadding : 0 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift 
 index 3424a8e . . 66c3a70 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleTextCell . swift 
 @ @ - 52 , 10 + 52 , 6 @ @ public class AABubbleTextCell : AABubbleCell { 
 } 
 } 
 
 - / / messageText . textLongPressAction = { ( containerView : UIView , text : NSAttributedString , range : NSRange , rect : CGRect ) - > ( ) in 
 - / / 
 - / / } 
 - 
 messageText . highlightLongPressAction = { ( containerView : UIView , text : NSAttributedString , range : NSRange , rect : CGRect ) - > ( ) in 
 self . bubble 
 let attributes = text . attributesAtIndex ( range . location , effectiveRange : nil )

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 index 5a15add . . 8f60973 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 @ @ - 122 , 7 + 122 , 7 @ @ public class AABubbleCell : UICollectionViewCell { 
 
 / / Binded data 
 public var peer : ACPeer ! 
 - public var controller : AAConversationContentController ! 
 + public weak var controller : AAConversationContentController ! 
 public var isGroup : Bool = false 
 public var isFullSize : Bool ! 
 public var bindedSetting : AACellSetting ? 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 index 58f4ec0 . . 5e4ce78 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 @ @ - 305 , 5 + 305 , 6 @ @ class AAConvActionSheet : UIView { 
 } 
 
 } 
 + 
 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index 8b6732b . . e1fe5cc 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 180 , 12 + 180 , 6 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 name : SLKKeyboardWillHideNotification , 
 object : nil ) 
 
 - } 
 - 
 - override func viewWillAppear ( animated : Bool ) { 
 - super . viewWillAppear ( animated ) 
 - 
 - textView . text = Actor . loadDraftWithPeer ( peer ) 
 
 / / Installing bindings 
 if ( UInt ( peer . peerType . ordinal ( ) ) = = ACPeerType . PRIVATE . rawValue ) { 
 @ @ - 240 , 7 + 234 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 } else { 
 self . setTextInputbarHidden ( false , animated : false ) 
 } 
 - 
 + 
 if ( typingValue ! = nil & & typingValue ! . length ( ) > 0 ) { 
 self . subtitleView . textColor = self . appStyle . navigationSubtitleActiveColor 
 if ( typingValue ! . length ( ) = = 1 ) { 
 @ @ - 268 , 6 + 262 , 19 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 
 Actor . onConversationOpenWithPeer ( peer ) 
 ActorSDK . sharedActor ( ) . trackPageVisible ( content ) 
 + 
 + } 
 + 
 + override func viewWillAppear ( animated : Bool ) { 
 + super . viewWillAppear ( animated ) 
 + 
 + 
 + if textView . isFirstResponder ( ) = = false { 
 + textView . resignFirstResponder ( ) 
 + } 
 + 
 + textView . text = Actor . loadDraftWithPeer ( peer ) 
 + 
 } 
 
 override func viewWillLayoutSubviews ( ) { 
 @ @ - 320 , 6 + 327 , 9 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 
 / / Releasing bindings 
 binder . unbindAll ( ) 
 + 
 + self . actionSheet . removeFromSuperview ( ) 
 + self . actionSheet = nil 
 } 
 
 / / Chat avatar tap 
 @ @ - 798 , 6 + 808 , 10 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 Actor . sendStickerWithPeer ( self . peer , withSticker : sticker ) 
 
 } 
 + 
 + deinit { 
 + print ( " conversation controller deinit ' ed " ) 
 + } 
 
 
 }
