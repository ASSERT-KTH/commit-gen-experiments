BLEU SCORE: 0.17747405280050269

TEST MSG: wip ( android ) : VERY BIG ChatActivity refactoring
GENERATED MSG: feat ( android ) call members list

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java < nl > index e042f04 . . df0c2d3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java < nl > @ @ - 14 , 8 + 14 , 12 @ @ import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . PeerType ; < nl > import im . actor . core . entity . Sticker ; < nl > import im . actor . core . network . RpcException ; < nl > + import im . actor . core . viewmodel . ConversationVM ; < nl > import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . runtime . mvvm . Value ; < nl > + import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKLauncher ; < nl > import im . actor . sdk . R ; < nl > @ @ - 25 , 6 + 29 , 7 @ @ import im . actor . sdk . controllers . conversation . inputbar . InputBarCallback ; < nl > import im . actor . sdk . controllers . conversation . inputbar . InputBarFragment ; < nl > import im . actor . sdk . controllers . conversation . messages . MessagesDefaultFragment ; < nl > import im . actor . sdk . controllers . conversation . messages . MessagesFragmentCallback ; < nl > + import im . actor . sdk . controllers . conversation . placeholder . EmptyChatPlaceholder ; < nl > import im . actor . sdk . controllers . conversation . quote . QuoteCallback ; < nl > import im . actor . sdk . controllers . conversation . quote . QuoteFragment ; < nl > import im . actor . sdk . controllers . conversation . attach . AttachFragment ; < nl > @ @ - 47 , 6 + 52 , 7 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > private View quoteContainer ; < nl > private View inputContainer ; < nl > private View inputOverlayContainer ; < nl > + private View emptyContainer ; < nl > private TextView inputOverlayText ; < nl > private Peer peer ; < nl > private long editRid ; < nl > @ @ - 78 , 6 + 84 , 8 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > inputOverlayText = ( TextView ) res . findViewById ( R . id . overlayText ) ; < nl > inputOverlayText . setOnClickListener ( view - > onOverlayPressed ( ) ) ; < nl > inputOverlayContainer . setVisibility ( View . GONE ) ; < nl > + emptyContainer = res . findViewById ( R . id . emptyPlaceholder ) ; < nl > + emptyContainer . setVisibility ( View . GONE ) ; < nl > < nl > if ( savedInstanceState = = null ) { < nl > Fragment toolbarFragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForToolbar ( peer ) ; < nl > @ @ - 89 , 6 + 97 , 7 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > . add ( R . id . messagesFragment , MessagesDefaultFragment . create ( peer ) ) < nl > . add ( R . id . sendFragment , new InputBarFragment ( ) ) < nl > . add ( R . id . quoteFragment , new QuoteFragment ( ) ) < nl > + . add ( R . id . emptyPlaceholder , new EmptyChatPlaceholder ( ) ) < nl > . commitNow ( ) ; < nl > < nl > AbsAttachFragment fragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForAttachMenu ( peer ) ; < nl > @ @ - 112 , 16 + 121 , 30 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > UserVM userVM = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > < nl > if ( userVM . isBot ( ) ) { < nl > - bind ( messenger ( ) . getConversationVM ( peer ) . getIsEmpty ( ) , ( val , valueModel ) - > { < nl > - if ( val ) { < nl > + ConversationVM conversationVM = messenger ( ) . getConversationVM ( peer ) ; < nl > + bind ( conversationVM . getIsEmpty ( ) , conversationVM . getIsLoaded ( ) , ( isEmpty , valueModel , isLoaded , valueModel2 ) - > { < nl > + if ( isEmpty ) { < nl > inputOverlayText . setText ( R . string . chat _ empty _ bot ) ; < nl > inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; < nl > inputOverlayText . setClickable ( true ) ; < nl > - showView ( inputOverlayContainer ) ; < nl > - goneView ( inputContainer ) ; < nl > + showView ( inputOverlayContainer , false ) ; < nl > + goneView ( inputContainer , false ) ; < nl > } else { < nl > - goneView ( inputOverlayContainer ) ; < nl > - showView ( inputContainer ) ; < nl > + goneView ( inputOverlayContainer , false ) ; < nl > + showView ( inputContainer , false ) ; < nl > + } < nl > + < nl > + if ( isEmpty & & isLoaded ) { < nl > + showView ( emptyContainer , false ) ; < nl > + } else { < nl > + hideView ( emptyContainer , false ) ; < nl > + } < nl > + } ) ; < nl > + bind ( userVM . getAbout ( ) , ( val , valueModel ) - > { < nl > + if ( val = = null ) { < nl > + findEmptyPlaceholder ( ) . setText ( getString ( R . string . chat _ empty _ bot _ about ) ) ; < nl > + } else { < nl > + findEmptyPlaceholder ( ) . setText ( val ) ; < nl > } < nl > } ) ; < nl > } else { < nl > @ @ - 130 , 11 + 153 , 11 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > inputOverlayText . setText ( R . string . blocked _ unblock ) ; < nl > inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; < nl > inputOverlayText . setClickable ( true ) ; < nl > - showView ( inputOverlayContainer ) ; < nl > - goneView ( inputContainer ) ; < nl > + showView ( inputOverlayContainer , false ) ; < nl > + goneView ( inputContainer , false ) ; < nl > } else { < nl > - goneView ( inputOverlayContainer ) ; < nl > - showView ( inputContainer ) ; < nl > + goneView ( inputOverlayContainer , false ) ; < nl > + showView ( inputContainer , false ) ; < nl > } < nl > } ) ; < nl > } < nl > @ @ - 143 , 14 + 166 , 14 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > < nl > bind ( groupVM . isMember ( ) , ( val , valueModel ) - > { < nl > if ( val ) { < nl > - goneView ( inputOverlayContainer ) ; < nl > - showView ( inputContainer ) ; < nl > + goneView ( inputOverlayContainer , false ) ; < nl > + showView ( inputContainer , false ) ; < nl > } else { < nl > inputOverlayText . setText ( R . string . chat _ not _ member ) ; < nl > inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; < nl > inputOverlayText . setClickable ( false ) ; < nl > - showView ( inputOverlayContainer ) ; < nl > - goneView ( inputContainer ) ; < nl > + showView ( inputOverlayContainer , false ) ; < nl > + goneView ( inputContainer , false ) ; < nl > } < nl > } ) ; < nl > } < nl > @ @ - 353 , 6 + 376 , 10 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess < nl > return ( ( AbsAttachFragment ) getFragmentManager ( ) . findFragmentById ( R . id . overlay ) ) ; < nl > } < nl > < nl > + private EmptyChatPlaceholder findEmptyPlaceholder ( ) { < nl > + return ( ( EmptyChatPlaceholder ) getChildFragmentManager ( ) . findFragmentById ( R . id . emptyPlaceholder ) ) ; < nl > + } < nl > + < nl > private void hideQuote ( ) { < nl > hideView ( quoteContainer ) ; < nl > findInputBar ( ) . setDisableOnEmptyText ( true ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java < nl > new file mode 100644 < nl > index 0000000 . . 86a064a < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java < nl > @ @ - 0 , 0 + 1 , 34 @ @ < nl > + package im . actor . sdk . controllers . conversation . placeholder ; < nl > + < nl > + import android . os . Bundle ; < nl > + import android . support . annotation . Nullable ; < nl > + import android . view . LayoutInflater ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . widget . TextView ; < nl > + < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . BaseFragment ; < nl > + < nl > + public class EmptyChatPlaceholder extends BaseFragment { < nl > + < nl > + private TextView emptyTitle ; < nl > + < nl > + @ Nullable < nl > + @ Override < nl > + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { < nl > + View res = inflater . inflate ( R . layout . fragment _ chat _ empty , container , false ) ; < nl > + emptyTitle = ( TextView ) res . findViewById ( R . id . emptyHint ) ; < nl > + return res ; < nl > + } < nl > + < nl > + public void setText ( String text ) { < nl > + emptyTitle . setText ( text ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onDestroyView ( ) { < nl > + super . onDestroyView ( ) ; < nl > + emptyTitle = null ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml < nl > index 318ed10 . . 1be260b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml < nl > @ @ - 29 , 16 + 29 , 6 @ @ < nl > android : layout _ height = " match _ parent " < nl > android : layout _ below = " @ + id / toolbar " / > < nl > < nl > - < TextView < nl > - android : id = " @ + id / botEmptyHint " < nl > - android : layout _ width = " wrap _ content " < nl > - android : layout _ height = " wrap _ content " < nl > - android : layout _ centerHorizontal = " true " < nl > - android : layout _ centerVertical = " true " < nl > - android : background = " @ drawable / conv _ bubble _ media _ in " < nl > - android : gravity = " center " < nl > - android : padding = " 20dp " < nl > - android : visibility = " invisible " / > < nl > < nl > < im . actor . sdk . view . adapters . RecyclerListView < nl > android : id = " @ + id / mentionsList " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml < nl > index 314d347 . . da34ba6 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml < nl > @ @ - 10 , 6 + 10 , 12 @ @ < nl > android : layout _ above = " @ + id / sendContainer " / > < nl > < nl > < FrameLayout < nl > + android : id = " @ + id / emptyPlaceholder " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ above = " @ + id / sendContainer " / > < nl > + < nl > + < FrameLayout < nl > android : id = " @ + id / quoteFragment " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " < nl > @ @ - 45 , 8 + 51 , 8 @ @ < nl > android : id = " @ + id / overlayText " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " match _ parent " < nl > - android : clickable = " true " < nl > android : background = " @ drawable / selector " < nl > + android : clickable = " true " < nl > android : gravity = " center " < nl > android : textAllCaps = " true " < nl > android : textSize = " 18sp " / > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml < nl > new file mode 100644 < nl > index 0000000 . . 7972c18 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml < nl > @ @ - 0 , 0 + 1 , 15 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / emptyHint " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center " < nl > + android : background = " @ drawable / conv _ bubble _ media _ in " < nl > + android : gravity = " center " < nl > + android : padding = " 20dp " / > < nl > + < nl > + < / FrameLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > index 022aead . . f380f9a 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > @ @ - 504 , 6 + 504 , 12 @ @ public class RouterActor extends ModuleActor { < nl > < nl > conversation ( peer ) . clear ( ) ; < nl > < nl > + ConversationState state = conversationStates . getValue ( peer . getUnuqueId ( ) ) ; < nl > + if ( ! state . isLoaded ( ) ) { < nl > + state = state . changeIsLoaded ( true ) ; < nl > + conversationStates . addOrUpdateItem ( state ) ; < nl > + } < nl > + < nl > updateChatState ( peer ) ; < nl > < nl > return getDialogsRouter ( ) . onChatClear ( peer ) ; < nl > @ @ - 513 , 6 + 519 , 12 @ @ public class RouterActor extends ModuleActor { < nl > < nl > conversation ( peer ) . clear ( ) ; < nl > < nl > + ConversationState state = conversationStates . getValue ( peer . getUnuqueId ( ) ) ; < nl > + if ( ! state . isLoaded ( ) ) { < nl > + state = state . changeIsLoaded ( true ) ; < nl > + conversationStates . addOrUpdateItem ( state ) ; < nl > + } < nl > + < nl > updateChatState ( peer ) ; < nl > < nl > return getDialogsRouter ( ) . onChatDelete ( peer ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index fa9298f . . 5bb61e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . Manifest ; < nl > + import android . app . Activity ; < nl > import android . app . Notification ; < nl > import android . app . NotificationManager ; < nl > import android . app . PendingIntent ; < nl > @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; < nl > import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > - import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > - import android . widget . Toast ; < nl > < nl > import java . text . DateFormat ; < nl > import java . text . SimpleDateFormat ; < nl > + import java . util . ArrayList ; < nl > import java . util . Date ; < nl > import java . util . TimeZone ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . core . viewmodel . CallMember ; < nl > import im . actor . core . viewmodel . CallState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . viewmodel . CallVM ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; < nl > import im . actor . runtime . actors . messages . PoisonPill ; < nl > import im . actor . runtime . mvvm . Value ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > - import im . actor . sdk . core . audio . AndroidPlayerActor ; < nl > - import im . actor . sdk . core . audio . AudioPlayerActor ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . adapters . HolderAdapter ; < nl > + import im . actor . sdk . view . adapters . ViewHolder ; < nl > + import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { < nl > / / < nl > CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - < nl > - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > - < nl > TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > - bind ( nameTV , user . getName ( ) ) ; < nl > + < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + < nl > + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , user . getAvatar ( ) ) ; < nl > + bind ( nameTV , user . getName ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , g . getAvatar ( ) ) ; < nl > + bind ( nameTV , g . getName ( ) ) ; < nl > + } < nl > + < nl > + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > + membersList . setAdapter ( membersAdapter ) ; < nl > < nl > timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > } < nl > < nl > - private void toastInCenter ( String s ) { < nl > - Toast t = Toast . makeText ( getActivity ( ) , < nl > - s , Toast . LENGTH _ SHORT ) ; < nl > - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; < nl > - t . show ( ) ; < nl > - } < nl > - < nl > @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { < nl > super . onResume ( ) ; < nl > manager . cancel ( NOTIFICATION _ ID ) ; < nl > } < nl > + < nl > + class CallMembersAdapter extends HolderAdapter < CallMember > { < nl > + < nl > + < nl > + private ArrayList < CallMember > members ; < nl > + < nl > + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { < nl > + super ( context ) ; < nl > + this . members = members . get ( ) ; < nl > + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { < nl > + @ Override < nl > + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { < nl > + CallMembersAdapter . this . members = val ; < nl > + notifyDataSetChanged ( ) ; < nl > + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getCount ( ) { < nl > + return members . size ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public CallMember getItem ( int position ) { < nl > + return members . get ( position ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public long getItemId ( int position ) { < nl > + return members . get ( position ) . getUid ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { < nl > + return new MemberHolder ( ) ; < nl > + } < nl > + < nl > + private class MemberHolder extends ViewHolder < CallMember > { < nl > + < nl > + CallMember data ; < nl > + private TextView userName ; < nl > + private TextView status ; < nl > + private AvatarView avatarView ; < nl > + < nl > + @ Override < nl > + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { < nl > + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; < nl > + < nl > + userName = ( TextView ) res . findViewById ( R . id . name ) ; < nl > + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + status = ( TextView ) res . findViewById ( R . id . status ) ; < nl > + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; < nl > + this . data = data ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( CallMember data , int position , Context context ) { < nl > + UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + this . data = data ; < nl > + avatarView . bind ( user ) ; < nl > + userName . setText ( user . getName ( ) . get ( ) ) ; < nl > + status . setText ( data . getState ( ) . name ( ) ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 50aecee . . fe5738b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > menu . findItem ( R . id . call ) . setVisible ( false ) ; < nl > } < nl > < nl > @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > if ( item . getItemId ( ) = = R . id . call ) { < nl > if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > private void startCall ( ) { < nl > - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + Command < Long > cmd ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + < nl > + } else { < nl > + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; < nl > + } < nl > execute ( cmd , R . string . progress _ common ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 47ab3ad . . 6ce5969 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 37 , 6 + 37 , 11 @ @ < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > android : textSize = " @ dimen / text _ secondary " / > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > < / LinearLayout > < nl > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . fa1ed22 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > @ @ - 0 , 0 + 1 , 62 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : orientation = " horizontal " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 59dp " < nl > + android : layout _ height = " 48dp " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 35dp " < nl > + android : layout _ height = " 35dp " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / divider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ marginLeft = " 59dp " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > index 922d837 . . 09b3e47 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { < nl > public CallMemberState getState ( ) { < nl > return state ; < nl > } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + return uid + " | " + state . name ( ) ; < nl > + } < nl > } < nl > \ No newline at end of file

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java 
 index e042f04 . . df0c2d3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatFragment . java 
 @ @ - 14 , 8 + 14 , 12 @ @ import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . PeerType ; 
 import im . actor . core . entity . Sticker ; 
 import im . actor . core . network . RpcException ; 
 + import im . actor . core . viewmodel . ConversationVM ; 
 import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . runtime . mvvm . Value ; 
 + import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueDoubleChangedListener ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKLauncher ; 
 import im . actor . sdk . R ; 
 @ @ - 25 , 6 + 29 , 7 @ @ import im . actor . sdk . controllers . conversation . inputbar . InputBarCallback ; 
 import im . actor . sdk . controllers . conversation . inputbar . InputBarFragment ; 
 import im . actor . sdk . controllers . conversation . messages . MessagesDefaultFragment ; 
 import im . actor . sdk . controllers . conversation . messages . MessagesFragmentCallback ; 
 + import im . actor . sdk . controllers . conversation . placeholder . EmptyChatPlaceholder ; 
 import im . actor . sdk . controllers . conversation . quote . QuoteCallback ; 
 import im . actor . sdk . controllers . conversation . quote . QuoteFragment ; 
 import im . actor . sdk . controllers . conversation . attach . AttachFragment ; 
 @ @ - 47 , 6 + 52 , 7 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 private View quoteContainer ; 
 private View inputContainer ; 
 private View inputOverlayContainer ; 
 + private View emptyContainer ; 
 private TextView inputOverlayText ; 
 private Peer peer ; 
 private long editRid ; 
 @ @ - 78 , 6 + 84 , 8 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 inputOverlayText = ( TextView ) res . findViewById ( R . id . overlayText ) ; 
 inputOverlayText . setOnClickListener ( view - > onOverlayPressed ( ) ) ; 
 inputOverlayContainer . setVisibility ( View . GONE ) ; 
 + emptyContainer = res . findViewById ( R . id . emptyPlaceholder ) ; 
 + emptyContainer . setVisibility ( View . GONE ) ; 
 
 if ( savedInstanceState = = null ) { 
 Fragment toolbarFragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForToolbar ( peer ) ; 
 @ @ - 89 , 6 + 97 , 7 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 . add ( R . id . messagesFragment , MessagesDefaultFragment . create ( peer ) ) 
 . add ( R . id . sendFragment , new InputBarFragment ( ) ) 
 . add ( R . id . quoteFragment , new QuoteFragment ( ) ) 
 + . add ( R . id . emptyPlaceholder , new EmptyChatPlaceholder ( ) ) 
 . commitNow ( ) ; 
 
 AbsAttachFragment fragment = ActorSDK . sharedActor ( ) . getDelegate ( ) . fragmentForAttachMenu ( peer ) ; 
 @ @ - 112 , 16 + 121 , 30 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 UserVM userVM = users ( ) . get ( peer . getPeerId ( ) ) ; 
 
 if ( userVM . isBot ( ) ) { 
 - bind ( messenger ( ) . getConversationVM ( peer ) . getIsEmpty ( ) , ( val , valueModel ) - > { 
 - if ( val ) { 
 + ConversationVM conversationVM = messenger ( ) . getConversationVM ( peer ) ; 
 + bind ( conversationVM . getIsEmpty ( ) , conversationVM . getIsLoaded ( ) , ( isEmpty , valueModel , isLoaded , valueModel2 ) - > { 
 + if ( isEmpty ) { 
 inputOverlayText . setText ( R . string . chat _ empty _ bot ) ; 
 inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; 
 inputOverlayText . setClickable ( true ) ; 
 - showView ( inputOverlayContainer ) ; 
 - goneView ( inputContainer ) ; 
 + showView ( inputOverlayContainer , false ) ; 
 + goneView ( inputContainer , false ) ; 
 } else { 
 - goneView ( inputOverlayContainer ) ; 
 - showView ( inputContainer ) ; 
 + goneView ( inputOverlayContainer , false ) ; 
 + showView ( inputContainer , false ) ; 
 + } 
 + 
 + if ( isEmpty & & isLoaded ) { 
 + showView ( emptyContainer , false ) ; 
 + } else { 
 + hideView ( emptyContainer , false ) ; 
 + } 
 + } ) ; 
 + bind ( userVM . getAbout ( ) , ( val , valueModel ) - > { 
 + if ( val = = null ) { 
 + findEmptyPlaceholder ( ) . setText ( getString ( R . string . chat _ empty _ bot _ about ) ) ; 
 + } else { 
 + findEmptyPlaceholder ( ) . setText ( val ) ; 
 } 
 } ) ; 
 } else { 
 @ @ - 130 , 11 + 153 , 11 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 inputOverlayText . setText ( R . string . blocked _ unblock ) ; 
 inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; 
 inputOverlayText . setClickable ( true ) ; 
 - showView ( inputOverlayContainer ) ; 
 - goneView ( inputContainer ) ; 
 + showView ( inputOverlayContainer , false ) ; 
 + goneView ( inputContainer , false ) ; 
 } else { 
 - goneView ( inputOverlayContainer ) ; 
 - showView ( inputContainer ) ; 
 + goneView ( inputOverlayContainer , false ) ; 
 + showView ( inputContainer , false ) ; 
 } 
 } ) ; 
 } 
 @ @ - 143 , 14 + 166 , 14 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 
 bind ( groupVM . isMember ( ) , ( val , valueModel ) - > { 
 if ( val ) { 
 - goneView ( inputOverlayContainer ) ; 
 - showView ( inputContainer ) ; 
 + goneView ( inputOverlayContainer , false ) ; 
 + showView ( inputContainer , false ) ; 
 } else { 
 inputOverlayText . setText ( R . string . chat _ not _ member ) ; 
 inputOverlayText . setTextColor ( style . getListActionColor ( ) ) ; 
 inputOverlayText . setClickable ( false ) ; 
 - showView ( inputOverlayContainer ) ; 
 - goneView ( inputContainer ) ; 
 + showView ( inputOverlayContainer , false ) ; 
 + goneView ( inputContainer , false ) ; 
 } 
 } ) ; 
 } 
 @ @ - 353 , 6 + 376 , 10 @ @ public class ChatFragment extends BaseFragment implements InputBarCallback , Mess 
 return ( ( AbsAttachFragment ) getFragmentManager ( ) . findFragmentById ( R . id . overlay ) ) ; 
 } 
 
 + private EmptyChatPlaceholder findEmptyPlaceholder ( ) { 
 + return ( ( EmptyChatPlaceholder ) getChildFragmentManager ( ) . findFragmentById ( R . id . emptyPlaceholder ) ) ; 
 + } 
 + 
 private void hideQuote ( ) { 
 hideView ( quoteContainer ) ; 
 findInputBar ( ) . setDisableOnEmptyText ( true ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java 
 new file mode 100644 
 index 0000000 . . 86a064a 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / placeholder / EmptyChatPlaceholder . java 
 @ @ - 0 , 0 + 1 , 34 @ @ 
 + package im . actor . sdk . controllers . conversation . placeholder ; 
 + 
 + import android . os . Bundle ; 
 + import android . support . annotation . Nullable ; 
 + import android . view . LayoutInflater ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . widget . TextView ; 
 + 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . BaseFragment ; 
 + 
 + public class EmptyChatPlaceholder extends BaseFragment { 
 + 
 + private TextView emptyTitle ; 
 + 
 + @ Nullable 
 + @ Override 
 + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { 
 + View res = inflater . inflate ( R . layout . fragment _ chat _ empty , container , false ) ; 
 + emptyTitle = ( TextView ) res . findViewById ( R . id . emptyHint ) ; 
 + return res ; 
 + } 
 + 
 + public void setText ( String text ) { 
 + emptyTitle . setText ( text ) ; 
 + } 
 + 
 + @ Override 
 + public void onDestroyView ( ) { 
 + super . onDestroyView ( ) ; 
 + emptyTitle = null ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml 
 index 318ed10 . . 1be260b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / activity _ dialog . xml 
 @ @ - 29 , 16 + 29 , 6 @ @ 
 android : layout _ height = " match _ parent " 
 android : layout _ below = " @ + id / toolbar " / > 
 
 - < TextView 
 - android : id = " @ + id / botEmptyHint " 
 - android : layout _ width = " wrap _ content " 
 - android : layout _ height = " wrap _ content " 
 - android : layout _ centerHorizontal = " true " 
 - android : layout _ centerVertical = " true " 
 - android : background = " @ drawable / conv _ bubble _ media _ in " 
 - android : gravity = " center " 
 - android : padding = " 20dp " 
 - android : visibility = " invisible " / > 
 
 < im . actor . sdk . view . adapters . RecyclerListView 
 android : id = " @ + id / mentionsList " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml 
 index 314d347 . . da34ba6 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat . xml 
 @ @ - 10 , 6 + 10 , 12 @ @ 
 android : layout _ above = " @ + id / sendContainer " / > 
 
 < FrameLayout 
 + android : id = " @ + id / emptyPlaceholder " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ above = " @ + id / sendContainer " / > 
 + 
 + < FrameLayout 
 android : id = " @ + id / quoteFragment " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " 
 @ @ - 45 , 8 + 51 , 8 @ @ 
 android : id = " @ + id / overlayText " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " match _ parent " 
 - android : clickable = " true " 
 android : background = " @ drawable / selector " 
 + android : clickable = " true " 
 android : gravity = " center " 
 android : textAllCaps = " true " 
 android : textSize = " 18sp " / > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml 
 new file mode 100644 
 index 0000000 . . 7972c18 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ chat _ empty . xml 
 @ @ - 0 , 0 + 1 , 15 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " > 
 + 
 + < TextView 
 + android : id = " @ + id / emptyHint " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center " 
 + android : background = " @ drawable / conv _ bubble _ media _ in " 
 + android : gravity = " center " 
 + android : padding = " 20dp " / > 
 + 
 + < / FrameLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 index 022aead . . f380f9a 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 @ @ - 504 , 6 + 504 , 12 @ @ public class RouterActor extends ModuleActor { 
 
 conversation ( peer ) . clear ( ) ; 
 
 + ConversationState state = conversationStates . getValue ( peer . getUnuqueId ( ) ) ; 
 + if ( ! state . isLoaded ( ) ) { 
 + state = state . changeIsLoaded ( true ) ; 
 + conversationStates . addOrUpdateItem ( state ) ; 
 + } 
 + 
 updateChatState ( peer ) ; 
 
 return getDialogsRouter ( ) . onChatClear ( peer ) ; 
 @ @ - 513 , 6 + 519 , 12 @ @ public class RouterActor extends ModuleActor { 
 
 conversation ( peer ) . clear ( ) ; 
 
 + ConversationState state = conversationStates . getValue ( peer . getUnuqueId ( ) ) ; 
 + if ( ! state . isLoaded ( ) ) { 
 + state = state . changeIsLoaded ( true ) ; 
 + conversationStates . addOrUpdateItem ( state ) ; 
 + } 
 + 
 updateChatState ( peer ) ; 
 
 return getDialogsRouter ( ) . onChatDelete ( peer ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index fa9298f . . 5bb61e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . Manifest ; 
 + import android . app . Activity ; 
 import android . app . Notification ; 
 import android . app . NotificationManager ; 
 import android . app . PendingIntent ; 
 @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; 
 import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 - import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . ListView ; 
 import android . widget . TextView ; 
 - import android . widget . Toast ; 
 
 import java . text . DateFormat ; 
 import java . text . SimpleDateFormat ; 
 + import java . util . ArrayList ; 
 import java . util . Date ; 
 import java . util . TimeZone ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . core . viewmodel . CallMember ; 
 import im . actor . core . viewmodel . CallState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . viewmodel . CallVM ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; 
 import im . actor . runtime . actors . messages . PoisonPill ; 
 import im . actor . runtime . mvvm . Value ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 - import im . actor . sdk . core . audio . AndroidPlayerActor ; 
 - import im . actor . sdk . core . audio . AudioPlayerActor ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . adapters . HolderAdapter ; 
 + import im . actor . sdk . view . adapters . ViewHolder ; 
 + import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { 
 / / 
 CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - 
 - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 - 
 TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 - bind ( nameTV , user . getName ( ) ) ; 
 + 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + 
 + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , user . getAvatar ( ) ) ; 
 + bind ( nameTV , user . getName ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , g . getAvatar ( ) ) ; 
 + bind ( nameTV , g . getName ( ) ) ; 
 + } 
 + 
 + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 + membersList . setAdapter ( membersAdapter ) ; 
 
 timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 } 
 
 - private void toastInCenter ( String s ) { 
 - Toast t = Toast . makeText ( getActivity ( ) , 
 - s , Toast . LENGTH _ SHORT ) ; 
 - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; 
 - t . show ( ) ; 
 - } 
 - 
 @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { 
 super . onResume ( ) ; 
 manager . cancel ( NOTIFICATION _ ID ) ; 
 } 
 + 
 + class CallMembersAdapter extends HolderAdapter < CallMember > { 
 + 
 + 
 + private ArrayList < CallMember > members ; 
 + 
 + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { 
 + super ( context ) ; 
 + this . members = members . get ( ) ; 
 + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { 
 + @ Override 
 + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { 
 + CallMembersAdapter . this . members = val ; 
 + notifyDataSetChanged ( ) ; 
 + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public int getCount ( ) { 
 + return members . size ( ) ; 
 + } 
 + 
 + @ Override 
 + public CallMember getItem ( int position ) { 
 + return members . get ( position ) ; 
 + } 
 + 
 + @ Override 
 + public long getItemId ( int position ) { 
 + return members . get ( position ) . getUid ( ) ; 
 + } 
 + 
 + @ Override 
 + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { 
 + return new MemberHolder ( ) ; 
 + } 
 + 
 + private class MemberHolder extends ViewHolder < CallMember > { 
 + 
 + CallMember data ; 
 + private TextView userName ; 
 + private TextView status ; 
 + private AvatarView avatarView ; 
 + 
 + @ Override 
 + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { 
 + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; 
 + 
 + userName = ( TextView ) res . findViewById ( R . id . name ) ; 
 + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + status = ( TextView ) res . findViewById ( R . id . status ) ; 
 + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; 
 + this . data = data ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void bind ( CallMember data , int position , Context context ) { 
 + UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + this . data = data ; 
 + avatarView . bind ( user ) ; 
 + userName . setText ( user . getName ( ) . get ( ) ) ; 
 + status . setText ( data . getState ( ) . name ( ) ) ; 
 + } 
 + 
 + 
 + @ Override 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 50aecee . . fe5738b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 menu . findItem ( R . id . call ) . setVisible ( false ) ; 
 } 
 
 @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 if ( item . getItemId ( ) = = R . id . call ) { 
 if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 private void startCall ( ) { 
 - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + Command < Long > cmd ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + 
 + } else { 
 + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; 
 + } 
 execute ( cmd , R . string . progress _ common ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 47ab3ad . . 6ce5969 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 37 , 6 + 37 , 11 @ @ 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 android : textSize = " @ dimen / text _ secondary " / > 
 + 
 + < ListView 
 + android : id = " @ + id / members _ list " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 < / LinearLayout > 
 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 new file mode 100644 
 index 0000000 . . fa1ed22 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 @ @ - 0 , 0 + 1 , 62 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : orientation = " horizontal " 
 + android : paddingRight = " 8dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 59dp " 
 + android : layout _ height = " 48dp " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 35dp " 
 + android : layout _ height = " 35dp " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / status " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / divider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ marginLeft = " 59dp " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 index 922d837 . . 09b3e47 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { 
 public CallMemberState getState ( ) { 
 return state ; 
 } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + return uid + " | " + state . name ( ) ; 
 + } 
 } 
 \ No newline at end of file
