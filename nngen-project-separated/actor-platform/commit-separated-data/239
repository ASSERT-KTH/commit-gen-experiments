BLEU SCORE: 0.2891784933232571

TEST MSG: fix ( android ) : remove streams from VM after peer connection closed
GENERATED MSG: fix ( android ) : close pc correctly

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index 518bda0 . . f053089 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 668 , 7 + 668 , 7 @ @ public class CallFragment extends BaseFragment { < nl > isRemoteViewConfigured = true ; < nl > } < nl > < nl > - VideoTrack videoTrack = ( ( AndroidVideoTrack ) videoTracks . get ( videoTracks . size ( ) - 1 ) ) . getVideoTrack ( ) ; < nl > + VideoTrack videoTrack = ( ( AndroidVideoTrack ) videoTracks . get ( 0 ) ) . getVideoTrack ( ) ; < nl > < nl > if ( videoTrack ! = remoteTrack ) { < nl > if ( remoteTrack ! = null ) { < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > index 3e1baa0 . . a9232bd 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > @ @ - 331 , 6 + 331 , 14 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { < nl > peerConnection . removeStream ( ( ( AndroidMediaStream ) stream . get ( ) ) . getStream ( ) ) ; < nl > stream . release ( ) ; < nl > } < nl > + for ( MediaStream stream : streams . keySet ( ) ) { < nl > + AndroidMediaStream stream1 = streams . get ( stream ) ; < nl > + if ( stream1 ! = null ) { < nl > + for ( WebRTCPeerConnectionCallback c : callbacks ) { < nl > + c . onStreamRemoved ( stream1 ) ; < nl > + } < nl > + } < nl > + } < nl > peerConnection . dispose ( ) ; < nl > } ) ; < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java < nl > index 2c70fa0 . . 5de7e4b 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java < nl > @ @ - 55 , 7 + 55 , 7 @ @ public class AndroidMediaStream implements WebRTCMediaStream { < nl > < nl > @ Override < nl > public void close ( ) { < nl > - / / stream . dispose ( ) ; < nl > + stream . dispose ( ) ; < nl > } < nl > < nl > public MediaStream getStream ( ) { < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > index 437bc97 . . 0f16fa8 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > @ @ - 327 , 13 + 327 , 6 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { < nl > AndroidWebRTCRuntimeProvider . postToHandler ( new Runnable ( ) { < nl > @ Override < nl > public void run ( ) { < nl > - for ( AndroidMediaStream m : streams . values ( ) ) { < nl > - if ( m . isLocal ( ) ) { < nl > - peerConnection . removeStream ( m . getStream ( ) ) ; < nl > - m . getStream ( ) . dispose ( ) ; < nl > - } < nl > - } < nl > - peerConnection . close ( ) ; < nl > peerConnection . dispose ( ) ; < nl > } < nl > } ) ;

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index 518bda0 . . f053089 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 668 , 7 + 668 , 7 @ @ public class CallFragment extends BaseFragment { 
 isRemoteViewConfigured = true ; 
 } 
 
 - VideoTrack videoTrack = ( ( AndroidVideoTrack ) videoTracks . get ( videoTracks . size ( ) - 1 ) ) . getVideoTrack ( ) ; 
 + VideoTrack videoTrack = ( ( AndroidVideoTrack ) videoTracks . get ( 0 ) ) . getVideoTrack ( ) ; 
 
 if ( videoTrack ! = remoteTrack ) { 
 if ( remoteTrack ! = null ) { 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 index 3e1baa0 . . a9232bd 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 @ @ - 331 , 6 + 331 , 14 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { 
 peerConnection . removeStream ( ( ( AndroidMediaStream ) stream . get ( ) ) . getStream ( ) ) ; 
 stream . release ( ) ; 
 } 
 + for ( MediaStream stream : streams . keySet ( ) ) { 
 + AndroidMediaStream stream1 = streams . get ( stream ) ; 
 + if ( stream1 ! = null ) { 
 + for ( WebRTCPeerConnectionCallback c : callbacks ) { 
 + c . onStreamRemoved ( stream1 ) ; 
 + } 
 + } 
 + } 
 peerConnection . dispose ( ) ; 
 } ) ; 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java 
 index 2c70fa0 . . 5de7e4b 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidMediaStream . java 
 @ @ - 55 , 7 + 55 , 7 @ @ public class AndroidMediaStream implements WebRTCMediaStream { 
 
 @ Override 
 public void close ( ) { 
 - / / stream . dispose ( ) ; 
 + stream . dispose ( ) ; 
 } 
 
 public MediaStream getStream ( ) { 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 index 437bc97 . . 0f16fa8 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 @ @ - 327 , 13 + 327 , 6 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { 
 AndroidWebRTCRuntimeProvider . postToHandler ( new Runnable ( ) { 
 @ Override 
 public void run ( ) { 
 - for ( AndroidMediaStream m : streams . values ( ) ) { 
 - if ( m . isLocal ( ) ) { 
 - peerConnection . removeStream ( m . getStream ( ) ) ; 
 - m . getStream ( ) . dispose ( ) ; 
 - } 
 - } 
 - peerConnection . close ( ) ; 
 peerConnection . dispose ( ) ; 
 } 
 } ) ;
