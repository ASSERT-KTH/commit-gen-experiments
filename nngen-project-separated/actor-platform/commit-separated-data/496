BLEU SCORE: 0.1777835117834348

TEST MSG: refactor ( IOS ) : code formatting , perform delete chat in main queue
GENERATED MSG: fix ( IOS ) : remove red line after voice recording

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift < nl > index 8b13cbf . . 299c5b9 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift < nl > @ @ - 104 , 6 + 104 , 7 @ @ class AAUnblockActionSheet : AAConvActionSheet { < nl > < nl > let spearator1 = UIView ( frame : CGRectMake ( 0 , 0 , superWidth , 1 ) ) < nl > spearator1 . backgroundColor = UIColor ( red : 223 . 9 / 255 . 0 , green : 223 . 9 / 255 . 0 , blue : 223 . 9 / 255 . 0 , alpha : 0 . 6 ) < nl > + < nl > / / add separatos as subview < nl > < nl > self . sheetView . addSubview ( spearator1 ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index c36bbf6 . . 9ef436a 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 304 , 9 + 304 , 11 @ @ public class ConversationViewController : < nl > } < nl > } < nl > } ) < nl > - / / < nl > - / / Unblock User < nl > - / / < nl > + < nl > + / / < nl > + / / Unblock User < nl > + / / < nl > + < nl > if ( blockStatus ) { < nl > < nl > let unblockActionSheet = AAUnblockActionSheet ( ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > index 99bcba2 . . 0313e7d 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > @ @ - 236 , 8 + 236 , 8 @ @ class AAUserViewController : AAContentTableController { < nl > } < nl > } < nl > < nl > - / / Block Contact < nl > if ! self . isBot { < nl > + / / Block Contact < nl > section { ( s ) - > ( ) in < nl > s . common { ( r ) - > ( ) in < nl > r . bindAction = { ( r ) - > ( ) in < nl > @ @ - 251 , 13 + 251 , 20 @ @ class AAUserViewController : AAContentTableController { < nl > < nl > r . selectAction = { ( ) - > Bool in < nl > if ! self . user . isBlockedModel ( ) . get ( ) . booleanValue ( ) { < nl > - self . executePromise ( Actor . blockUser ( jint ( self . uid ) ) , successBlock : { success in < nl > - self . execute ( Actor . deleteChatCommandWithPeer ( ACPeer . userWithInt ( jint ( self . uid ) ) ) ) < nl > - r . reload ( ) < nl > - } , failureBlock : nil ) < nl > + self . executePromise ( Actor . blockUser ( jint ( self . uid ) ) , < nl > + successBlock : { success in < nl > + dispatch _ async ( dispatch _ get _ main _ queue ( ) , { < nl > + let peer = ACPeer . userWithInt ( jint ( self . uid ) ) < nl > + self . execute ( Actor . deleteChatCommandWithPeer ( peer ) ) < nl > + r . reload ( ) < nl > + } ) < nl > + } , failureBlock : nil ) < nl > } else { < nl > - self . executePromise ( Actor . unblockUser ( jint ( self . uid ) ) , successBlock : { success in < nl > - r . reload ( ) < nl > + self . executePromise ( Actor . unblockUser ( jint ( self . uid ) ) , < nl > + successBlock : { success in < nl > + dispatch _ async ( dispatch _ get _ main _ queue ( ) , { < nl > + r . reload ( ) < nl > + } ) < nl > } , failureBlock : nil ) < nl > } < nl > r . reload ( ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > index fc8bb6a . . 0ca9d84 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > @ @ - 175 , 7 + 175 , 6 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien < nl > { < nl > [ self cleanup ] ; < nl > } ] ; < nl > - < nl > } < nl > < nl > - ( void ) finish : ( void ( ^ ) ( NSString * , NSTimeInterval ) ) completion
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index f8c828f . . 97ded67 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 801 , 8 + 801 , 6 @ @ public class ConversationViewController : < nl > < nl > audioRecorder . delegate = self < nl > audioRecorder . start ( ) < nl > - < nl > - < nl > } < nl > < nl > func onAudioRecordingFinished ( ) { < nl > @ @ - 824 , 6 + 822 , 7 @ @ public class ConversationViewController : < nl > withDuration : jint ( duration * 1000 ) , withDescriptor : descriptor ) < nl > < nl > } < nl > + audioRecorder . cancel ( ) < nl > } < nl > < nl > public func audioRecorderDidStartRecording ( ) { < nl > @ @ - 924 , 7 + 923 , 6 @ @ public class ConversationViewController : < nl > self . stickersButton . hidden = false < nl > self . onAudioRecordingFinished ( ) < nl > self . voiceRecorderView . recordingStoped ( ) < nl > - < nl > } < nl > < nl > / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > index 6bed417 . . 99bcba2 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift < nl > @ @ - 264 , 7 + 264 , 6 @ @ class AAUserViewController : AAContentTableController { < nl > return true < nl > } < nl > } < nl > - < nl > } < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > index dc3eaa6 . . fc8bb6a 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m < nl > @ @ - 16 , 6 + 16 , 8 @ @ < nl > AATimer * _ timer ; < nl > < nl > AAOpusAudioRecorder * _ modernRecorder ; < nl > + < nl > + BOOL sessionCanceled ; < nl > } < nl > < nl > @ end < nl > @ @ - 65 , 6 + 67 , 7 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien < nl > < nl > - ( void ) start < nl > { < nl > + sessionCanceled = false ; < nl > NSLog ( @ " [ AAAudioRecorder start ] " ) ; < nl > < nl > [ [ AAAudioRecorder audioRecorderQueue ] dispatchOnQueue : ^ < nl > @ @ - 136 , 13 + 139 , 15 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien < nl > < nl > - ( void ) _ commitRecord < nl > { < nl > - [ _ modernRecorder record ] ; < nl > - < nl > - dispatch _ async ( dispatch _ get _ main _ queue ( ) , ^ < nl > - { < nl > - id < AAAudioRecorderDelegate > delegate = _ delegate ; < nl > - [ _ delegate audioRecorderDidStartRecording ] ; < nl > - } ) ; < nl > + if ( ! sessionCanceled ) { < nl > + [ _ modernRecorder record ] ; < nl > + < nl > + dispatch _ async ( dispatch _ get _ main _ queue ( ) , ^ < nl > + { < nl > + id < AAAudioRecorderDelegate > delegate = _ delegate ; < nl > + [ _ delegate audioRecorderDidStartRecording ] ; < nl > + } ) ; < nl > + } < nl > } < nl > < nl > - ( void ) cleanup < nl > @ @ - 164 , 10 + 169 , 13 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien < nl > < nl > - ( void ) cancel < nl > { < nl > + sessionCanceled = true ; < nl > + < nl > [ [ AAAudioRecorder audioRecorderQueue ] dispatchOnQueue : ^ < nl > { < nl > [ self cleanup ] ; < nl > } ] ; < nl > + < nl > } < nl > < nl > - ( void ) finish : ( void ( ^ ) ( NSString * , NSTimeInterval ) ) completion < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m < nl > index ec4795c . . 2e32a93 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m < nl > @ @ - 146 , 9 + 146 , 10 @ @ static dispatch _ semaphore _ t playSoundSemaphore = nil ; < nl > { < nl > _ _ autoreleasing NSError * error = nil ; < nl > AVAudioSession * audioSession = [ AVAudioSession sharedInstance ] ; < nl > + / / [ audioSession setActive : NO error : & error ] ; < nl > if ( ! [ audioSession setCategory : AVAudioSessionCategoryPlayback error : & error ] ) < nl > NSLog ( @ " [ AAAudioRecorder audio session set category failed : % @ ] " , error ) ; < nl > - if ( ! [ audioSession setActive : false error : & error ] ) < nl > + if ( ! [ audioSession setActive : NO error : & error ] ) < nl > NSLog ( @ " [ AAAudioRecorder audio session deactivation failed : % @ ] " , error ) ; < nl > } ] ; < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift 
 index 8b13cbf . . 299c5b9 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAUnblockActionSheet . swift 
 @ @ - 104 , 6 + 104 , 7 @ @ class AAUnblockActionSheet : AAConvActionSheet { 
 
 let spearator1 = UIView ( frame : CGRectMake ( 0 , 0 , superWidth , 1 ) ) 
 spearator1 . backgroundColor = UIColor ( red : 223 . 9 / 255 . 0 , green : 223 . 9 / 255 . 0 , blue : 223 . 9 / 255 . 0 , alpha : 0 . 6 ) 
 + 
 / / add separatos as subview 
 
 self . sheetView . addSubview ( spearator1 ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index c36bbf6 . . 9ef436a 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 304 , 9 + 304 , 11 @ @ public class ConversationViewController : 
 } 
 } 
 } ) 
 - / / 
 - / / Unblock User 
 - / / 
 + 
 + / / 
 + / / Unblock User 
 + / / 
 + 
 if ( blockStatus ) { 
 
 let unblockActionSheet = AAUnblockActionSheet ( ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 index 99bcba2 . . 0313e7d 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 @ @ - 236 , 8 + 236 , 8 @ @ class AAUserViewController : AAContentTableController { 
 } 
 } 
 
 - / / Block Contact 
 if ! self . isBot { 
 + / / Block Contact 
 section { ( s ) - > ( ) in 
 s . common { ( r ) - > ( ) in 
 r . bindAction = { ( r ) - > ( ) in 
 @ @ - 251 , 13 + 251 , 20 @ @ class AAUserViewController : AAContentTableController { 
 
 r . selectAction = { ( ) - > Bool in 
 if ! self . user . isBlockedModel ( ) . get ( ) . booleanValue ( ) { 
 - self . executePromise ( Actor . blockUser ( jint ( self . uid ) ) , successBlock : { success in 
 - self . execute ( Actor . deleteChatCommandWithPeer ( ACPeer . userWithInt ( jint ( self . uid ) ) ) ) 
 - r . reload ( ) 
 - } , failureBlock : nil ) 
 + self . executePromise ( Actor . blockUser ( jint ( self . uid ) ) , 
 + successBlock : { success in 
 + dispatch _ async ( dispatch _ get _ main _ queue ( ) , { 
 + let peer = ACPeer . userWithInt ( jint ( self . uid ) ) 
 + self . execute ( Actor . deleteChatCommandWithPeer ( peer ) ) 
 + r . reload ( ) 
 + } ) 
 + } , failureBlock : nil ) 
 } else { 
 - self . executePromise ( Actor . unblockUser ( jint ( self . uid ) ) , successBlock : { success in 
 - r . reload ( ) 
 + self . executePromise ( Actor . unblockUser ( jint ( self . uid ) ) , 
 + successBlock : { success in 
 + dispatch _ async ( dispatch _ get _ main _ queue ( ) , { 
 + r . reload ( ) 
 + } ) 
 } , failureBlock : nil ) 
 } 
 r . reload ( ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 index fc8bb6a . . 0ca9d84 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 @ @ - 175 , 7 + 175 , 6 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien 
 { 
 [ self cleanup ] ; 
 } ] ; 
 - 
 } 
 
 - ( void ) finish : ( void ( ^ ) ( NSString * , NSTimeInterval ) ) completion

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index f8c828f . . 97ded67 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 801 , 8 + 801 , 6 @ @ public class ConversationViewController : 
 
 audioRecorder . delegate = self 
 audioRecorder . start ( ) 
 - 
 - 
 } 
 
 func onAudioRecordingFinished ( ) { 
 @ @ - 824 , 6 + 822 , 7 @ @ public class ConversationViewController : 
 withDuration : jint ( duration * 1000 ) , withDescriptor : descriptor ) 
 
 } 
 + audioRecorder . cancel ( ) 
 } 
 
 public func audioRecorderDidStartRecording ( ) { 
 @ @ - 924 , 7 + 923 , 6 @ @ public class ConversationViewController : 
 self . stickersButton . hidden = false 
 self . onAudioRecordingFinished ( ) 
 self . voiceRecorderView . recordingStoped ( ) 
 - 
 } 
 
 / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 index 6bed417 . . 99bcba2 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / User / AAUserViewController . swift 
 @ @ - 264 , 7 + 264 , 6 @ @ class AAUserViewController : AAContentTableController { 
 return true 
 } 
 } 
 - 
 } 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 index dc3eaa6 . . fc8bb6a 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAAudioRecorder . m 
 @ @ - 16 , 6 + 16 , 8 @ @ 
 AATimer * _ timer ; 
 
 AAOpusAudioRecorder * _ modernRecorder ; 
 + 
 + BOOL sessionCanceled ; 
 } 
 
 @ end 
 @ @ - 65 , 6 + 67 , 7 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien 
 
 - ( void ) start 
 { 
 + sessionCanceled = false ; 
 NSLog ( @ " [ AAAudioRecorder start ] " ) ; 
 
 [ [ AAAudioRecorder audioRecorderQueue ] dispatchOnQueue : ^ 
 @ @ - 136 , 13 + 139 , 15 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien 
 
 - ( void ) _ commitRecord 
 { 
 - [ _ modernRecorder record ] ; 
 - 
 - dispatch _ async ( dispatch _ get _ main _ queue ( ) , ^ 
 - { 
 - id < AAAudioRecorderDelegate > delegate = _ delegate ; 
 - [ _ delegate audioRecorderDidStartRecording ] ; 
 - } ) ; 
 + if ( ! sessionCanceled ) { 
 + [ _ modernRecorder record ] ; 
 + 
 + dispatch _ async ( dispatch _ get _ main _ queue ( ) , ^ 
 + { 
 + id < AAAudioRecorderDelegate > delegate = _ delegate ; 
 + [ _ delegate audioRecorderDidStartRecording ] ; 
 + } ) ; 
 + } 
 } 
 
 - ( void ) cleanup 
 @ @ - 164 , 10 + 169 , 13 @ @ static void playSoundCompleted ( _ _ unused SystemSoundID ssID , _ _ unused void * clien 
 
 - ( void ) cancel 
 { 
 + sessionCanceled = true ; 
 + 
 [ [ AAAudioRecorder audioRecorderQueue ] dispatchOnQueue : ^ 
 { 
 [ self cleanup ] ; 
 } ] ; 
 + 
 } 
 
 - ( void ) finish : ( void ( ^ ) ( NSString * , NSTimeInterval ) ) completion 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m 
 index ec4795c . . 2e32a93 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Utils / AudioRecorder / AAOpusAudioRecorder . m 
 @ @ - 146 , 9 + 146 , 10 @ @ static dispatch _ semaphore _ t playSoundSemaphore = nil ; 
 { 
 _ _ autoreleasing NSError * error = nil ; 
 AVAudioSession * audioSession = [ AVAudioSession sharedInstance ] ; 
 + / / [ audioSession setActive : NO error : & error ] ; 
 if ( ! [ audioSession setCategory : AVAudioSessionCategoryPlayback error : & error ] ) 
 NSLog ( @ " [ AAAudioRecorder audio session set category failed : % @ ] " , error ) ; 
 - if ( ! [ audioSession setActive : false error : & error ] ) 
 + if ( ! [ audioSession setActive : NO error : & error ] ) 
 NSLog ( @ " [ AAAudioRecorder audio session deactivation failed : % @ ] " , error ) ; 
 } ] ; 
 }
