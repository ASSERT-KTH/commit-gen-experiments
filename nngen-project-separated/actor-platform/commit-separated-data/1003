BLEU SCORE: 0.5491004867761125

TEST MSG: perf ( server : sequence ) : x2 boost of difference query
GENERATED MSG: perf ( server : sequence ) : optimize difference sql query

TEST DIFF (one line): diff - - git a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > index 8d973cd . . ab0fafe 100644 < nl > - - - a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > + + + b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > @ @ - 47 , 7 + 47 , 7 @ @ object UserSequenceRepo { < nl > notReduced . reduceKey . isEmpty | | < nl > notReduced . seq . in ( < nl > byUser ( userId ) < nl > - . filter ( u ⇒ u . seq > = seq & & u . reduceKey = = = notReduced . reduceKey ) < nl > + . filter ( u ⇒ u . seq > = notReduced . seq & & u . reduceKey = = = notReduced . reduceKey ) < nl > . groupBy ( _ . reduceKey ) < nl > . map ( _ . _ 2 . map ( _ . seq ) . max ) < nl > )
NEAREST DIFF (one line): diff - - git a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > index 0d8f9d4 . . 8d973cd 100644 < nl > - - - a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > + + + b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala < nl > @ @ - 47 , 7 + 47 , 7 @ @ object UserSequenceRepo { < nl > notReduced . reduceKey . isEmpty | | < nl > notReduced . seq . in ( < nl > byUser ( userId ) < nl > - . filter ( _ . reduceKey = = = notReduced . reduceKey ) < nl > + . filter ( u ⇒ u . seq > = seq & & u . reduceKey = = = notReduced . reduceKey ) < nl > . groupBy ( _ . reduceKey ) < nl > . map ( _ . _ 2 . map ( _ . seq ) . max ) < nl > )

TEST DIFF:
diff - - git a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 index 8d973cd . . ab0fafe 100644 
 - - - a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 + + + b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 @ @ - 47 , 7 + 47 , 7 @ @ object UserSequenceRepo { 
 notReduced . reduceKey . isEmpty | | 
 notReduced . seq . in ( 
 byUser ( userId ) 
 - . filter ( u ⇒ u . seq > = seq & & u . reduceKey = = = notReduced . reduceKey ) 
 + . filter ( u ⇒ u . seq > = notReduced . seq & & u . reduceKey = = = notReduced . reduceKey ) 
 . groupBy ( _ . reduceKey ) 
 . map ( _ . _ 2 . map ( _ . seq ) . max ) 
 )

NEAREST DIFF:
diff - - git a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 index 0d8f9d4 . . 8d973cd 100644 
 - - - a / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 + + + b / actor - server / actor - persist / src / main / scala / im / actor / server / persist / sequence / UserSequenceRepo . scala 
 @ @ - 47 , 7 + 47 , 7 @ @ object UserSequenceRepo { 
 notReduced . reduceKey . isEmpty | | 
 notReduced . seq . in ( 
 byUser ( userId ) 
 - . filter ( _ . reduceKey = = = notReduced . reduceKey ) 
 + . filter ( u ⇒ u . seq > = seq & & u . reduceKey = = = notReduced . reduceKey ) 
 . groupBy ( _ . reduceKey ) 
 . map ( _ . _ 2 . map ( _ . seq ) . max ) 
 )
