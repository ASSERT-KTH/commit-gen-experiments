BLEU SCORE: 0.07257024107490348

TEST MSG: fix ( android ) : Fixing actor crashing on last message deletion
GENERATED MSG: fix ( core ) : clear dialog after deleting message if head message has PENDING status

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > index f380f9a . . 5ffc05e 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > @ @ - 497 , 7 + 497 , 11 @ @ public class RouterActor extends ModuleActor { < nl > < nl > Message head = conversation ( peer ) . getHeadValue ( ) ; < nl > < nl > - return getDialogsRouter ( ) . onMessageDeleted ( peer , head . getMessageState ( ) = = MessageState . PENDING ? null : head ) ; < nl > + if ( head ! = null & & head . getMessageState ( ) = = MessageState . PENDING ) { < nl > + head = null ; < nl > + } < nl > + < nl > + return getDialogsRouter ( ) . onMessageDeleted ( peer , head ) ; < nl > } < nl > < nl > private Promise < Void > onChatClear ( Peer peer ) {
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > index 65ee6d2 . . 4719bc6 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java < nl > @ @ - 451 , 7 + 451 , 7 @ @ public class RouterActor extends ModuleActor { < nl > conversation ( peer ) . removeItems ( JavaUtil . unbox ( rids ) ) ; < nl > < nl > Message head = conversation ( peer ) . getHeadValue ( ) ; < nl > - dialogsActor ( new DialogsActor . MessageDeleted ( peer , head ) ) ; < nl > + dialogsActor ( new DialogsActor . MessageDeleted ( peer , head . getMessageState ( ) = = MessageState . PENDING ? null : head ) ) ; < nl > < nl > return Promise . success ( null ) ; < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 index f380f9a . . 5ffc05e 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 @ @ - 497 , 7 + 497 , 11 @ @ public class RouterActor extends ModuleActor { 
 
 Message head = conversation ( peer ) . getHeadValue ( ) ; 
 
 - return getDialogsRouter ( ) . onMessageDeleted ( peer , head . getMessageState ( ) = = MessageState . PENDING ? null : head ) ; 
 + if ( head ! = null & & head . getMessageState ( ) = = MessageState . PENDING ) { 
 + head = null ; 
 + } 
 + 
 + return getDialogsRouter ( ) . onMessageDeleted ( peer , head ) ; 
 } 
 
 private Promise < Void > onChatClear ( Peer peer ) {

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 index 65ee6d2 . . 4719bc6 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / messaging / router / RouterActor . java 
 @ @ - 451 , 7 + 451 , 7 @ @ public class RouterActor extends ModuleActor { 
 conversation ( peer ) . removeItems ( JavaUtil . unbox ( rids ) ) ; 
 
 Message head = conversation ( peer ) . getHeadValue ( ) ; 
 - dialogsActor ( new DialogsActor . MessageDeleted ( peer , head ) ) ; 
 + dialogsActor ( new DialogsActor . MessageDeleted ( peer , head . getMessageState ( ) = = MessageState . PENDING ? null : head ) ) ; 
 
 return Promise . success ( null ) ; 
 }
