BLEU SCORE: 0.35084396956386854

TEST MSG: fix ( android ) : video calls local video aspect ratio
GENERATED MSG: fix ( android ) : remove call audio volume listener

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index 2fdeb61 . . ca79770 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 309 , 7 + 309 , 32 @ @ public class CallFragment extends BaseFragment { < nl > < nl > remoteVideoView = ( SurfaceViewRenderer ) cont . findViewById ( R . id . remote _ renderer ) ; < nl > < nl > - localVideoView = new SurfaceViewRenderer ( getActivity ( ) ) ; < nl > + localVideoView = new SurfaceViewRenderer ( getActivity ( ) ) { < nl > + private boolean aspectFixed = false ; < nl > + < nl > + @ Override < nl > + public void renderFrame ( VideoRenderer . I420Frame frame ) { < nl > + if ( ! aspectFixed ) { < nl > + aspectFixed = true ; < nl > + int maxWH = Screen . getWidth ( ) / 3 - Screen . dp ( 20 ) ; < nl > + float scale = Math . min ( maxWH / ( float ) frame . width , maxWH / ( float ) frame . height ) ; < nl > + < nl > + int destW = ( int ) ( scale * frame . width ) ; < nl > + int destH = ( int ) ( scale * frame . height ) ; < nl > + < nl > + boolean turned = frame . rotationDegree % 90 % 2 = = 0 ; < nl > + < nl > + localVideoView . post ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + localVideoView . getLayoutParams ( ) . height = turned ? destW : destH ; < nl > + localVideoView . getLayoutParams ( ) . width = turned ? destH : destW ; < nl > + } < nl > + } ) ; < nl > + } < nl > + super . renderFrame ( frame ) ; < nl > + } < nl > + } ; < nl > localVideoView . setVisibility ( View . INVISIBLE ) ; < nl > localVideoView . setZOrderMediaOverlay ( true ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index 119768f . . 084acb3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 172 , 10 + 172 , 10 @ @ public class Application extends ActorSDKApplication { < nl > } ; < nl > } < nl > < nl > - @ Override < nl > - public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { < nl > - return new MainPhoneControllerEx ( mainActivity ) ; < nl > - } < nl > + / / @ Override < nl > + / / public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { < nl > + / / return new MainPhoneControllerEx ( mainActivity ) ; < nl > + / / } < nl > } < nl > < nl > public static class ProfileFragmentEx extends ProfileFragment { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index 1476853 . . 4d8aa67 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 94 , 8 + 94 , 6 @ @ public class CallFragment extends BaseFragment { < nl > private View layer1 ; < nl > private View layer2 ; < nl > private View layer3 ; < nl > - private ActorRef audioVolumeListener ; < nl > - private AudioStreamVolumeValueActor . VolumeValueListener volumeValueListener ; < nl > < nl > public CallFragment ( ) { < nl > < nl > @ @ - 250 , 20 + 248 , 8 @ @ public class CallFragment extends BaseFragment { < nl > < nl > audioManager = ( AudioManager ) getActivity ( ) . getSystemService ( Context . AUDIO _ SERVICE ) ; < nl > < nl > - audioVolumeListener = ActorSystem . system ( ) . actorOf ( Props . create ( new ActorCreator ( ) { < nl > - @ Override < nl > - public AudioStreamVolumeValueActor create ( ) { < nl > - return new AudioStreamVolumeValueActor ( ) ; < nl > - } < nl > - } ) , " actor / calls / audioVolumeListener " ) ; < nl > < nl > - volumeValueListener = new AudioStreamVolumeValueActor . VolumeValueListener ( ) { < nl > - @ Override < nl > - public void onVolumeValue ( int val ) { < nl > - Log . d ( " VOLUME " , val + " " ) ; < nl > - } < nl > - } ; < nl > - audioVolumeListener . send ( new AudioStreamVolumeValueActor . Subscribe ( volumeValueListener ) ) ; < nl > + < nl > < nl > audioManager . getStreamVolume ( AudioManager . STREAM _ VOICE _ CALL ) ; < nl > final TintImageView speaker = ( TintImageView ) cont . findViewById ( R . id . speaker ) ; < nl > @ @ - 355 , 7 + 341 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > case ENDED : < nl > statusTV . setText ( R . string . call _ ended ) ; < nl > - audioVolumeListener . send ( new AudioStreamVolumeValueActor . Unsubscribe ( volumeValueListener ) ) ; < nl > onCallEnd ( ) ; < nl > break ;

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index 2fdeb61 . . ca79770 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 309 , 7 + 309 , 32 @ @ public class CallFragment extends BaseFragment { 
 
 remoteVideoView = ( SurfaceViewRenderer ) cont . findViewById ( R . id . remote _ renderer ) ; 
 
 - localVideoView = new SurfaceViewRenderer ( getActivity ( ) ) ; 
 + localVideoView = new SurfaceViewRenderer ( getActivity ( ) ) { 
 + private boolean aspectFixed = false ; 
 + 
 + @ Override 
 + public void renderFrame ( VideoRenderer . I420Frame frame ) { 
 + if ( ! aspectFixed ) { 
 + aspectFixed = true ; 
 + int maxWH = Screen . getWidth ( ) / 3 - Screen . dp ( 20 ) ; 
 + float scale = Math . min ( maxWH / ( float ) frame . width , maxWH / ( float ) frame . height ) ; 
 + 
 + int destW = ( int ) ( scale * frame . width ) ; 
 + int destH = ( int ) ( scale * frame . height ) ; 
 + 
 + boolean turned = frame . rotationDegree % 90 % 2 = = 0 ; 
 + 
 + localVideoView . post ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + localVideoView . getLayoutParams ( ) . height = turned ? destW : destH ; 
 + localVideoView . getLayoutParams ( ) . width = turned ? destH : destW ; 
 + } 
 + } ) ; 
 + } 
 + super . renderFrame ( frame ) ; 
 + } 
 + } ; 
 localVideoView . setVisibility ( View . INVISIBLE ) ; 
 localVideoView . setZOrderMediaOverlay ( true ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index 119768f . . 084acb3 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 172 , 10 + 172 , 10 @ @ public class Application extends ActorSDKApplication { 
 } ; 
 } 
 
 - @ Override 
 - public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { 
 - return new MainPhoneControllerEx ( mainActivity ) ; 
 - } 
 + / / @ Override 
 + / / public MainPhoneController getMainPhoneController ( ActorMainActivity mainActivity ) { 
 + / / return new MainPhoneControllerEx ( mainActivity ) ; 
 + / / } 
 } 
 
 public static class ProfileFragmentEx extends ProfileFragment { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index 1476853 . . 4d8aa67 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 94 , 8 + 94 , 6 @ @ public class CallFragment extends BaseFragment { 
 private View layer1 ; 
 private View layer2 ; 
 private View layer3 ; 
 - private ActorRef audioVolumeListener ; 
 - private AudioStreamVolumeValueActor . VolumeValueListener volumeValueListener ; 
 
 public CallFragment ( ) { 
 
 @ @ - 250 , 20 + 248 , 8 @ @ public class CallFragment extends BaseFragment { 
 
 audioManager = ( AudioManager ) getActivity ( ) . getSystemService ( Context . AUDIO _ SERVICE ) ; 
 
 - audioVolumeListener = ActorSystem . system ( ) . actorOf ( Props . create ( new ActorCreator ( ) { 
 - @ Override 
 - public AudioStreamVolumeValueActor create ( ) { 
 - return new AudioStreamVolumeValueActor ( ) ; 
 - } 
 - } ) , " actor / calls / audioVolumeListener " ) ; 
 
 - volumeValueListener = new AudioStreamVolumeValueActor . VolumeValueListener ( ) { 
 - @ Override 
 - public void onVolumeValue ( int val ) { 
 - Log . d ( " VOLUME " , val + " " ) ; 
 - } 
 - } ; 
 - audioVolumeListener . send ( new AudioStreamVolumeValueActor . Subscribe ( volumeValueListener ) ) ; 
 + 
 
 audioManager . getStreamVolume ( AudioManager . STREAM _ VOICE _ CALL ) ; 
 final TintImageView speaker = ( TintImageView ) cont . findViewById ( R . id . speaker ) ; 
 @ @ - 355 , 7 + 341 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 case ENDED : 
 statusTV . setText ( R . string . call _ ended ) ; 
 - audioVolumeListener . send ( new AudioStreamVolumeValueActor . Unsubscribe ( volumeValueListener ) ) ; 
 onCallEnd ( ) ; 
 break ;
