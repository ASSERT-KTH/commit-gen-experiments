BLEU SCORE: 0.07882750221706718

TEST MSG: fix ( core ) : stickers MVVM
GENERATED MSG: feat ( core + android ) : Passing timezone and locales to server

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index eede092 . . 5cd1832 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 25 , 10 + 25 , 9 @ @ public class Application extends ActorSDKApplication { < nl > ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > ActorSDK . sharedActor ( ) . setPushId ( 209133700967L ) ; < nl > < nl > - / / ArrayList < String > endpoints = new ArrayList < String > ( ) ; < nl > - / / endpoints . add ( " foo1 " ) ; < nl > - / / endpoints . add ( " foo2 " ) ; < nl > - / / ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; < nl > + ArrayList < String > endpoints = new ArrayList < String > ( ) ; < nl > + endpoints . add ( " tcp : / / x2015contaca2020trixxl . com : 9070 " ) ; < nl > + ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; < nl > < nl > ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > style . setMainColor ( Color . parseColor ( " # 529a88 " ) ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java < nl > index 2bbe68d . . 3410b94 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java < nl > @ @ - 32 , 6 + 32 , 10 @ @ public class SmilePagerAdapter extends PagerAdapter implements PagerSlidingTabSt < nl > < nl > public SmilePagerAdapter ( EmojiKeyboard emojiKeyboard ) { < nl > this . emojiKeyboard = emojiKeyboard ; < nl > + if ( messenger ( ) . getOwnStickerPacks ( ) . get ( ) . size ( ) = = 0 ) { < nl > + messenger ( ) . loadStickers ( ) ; < nl > + } < nl > + < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java < nl > index 4ae3d2f . . 5197c64 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java < nl > @ @ - 68 , 7 + 68 , 6 @ @ class StickerAdapter extends HolderAdapter < StickerLine > { < nl > < nl > packs = messenger ( ) . getOwnStickerPacks ( ) ; < nl > < nl > - < nl > ( ( BaseActivity ) context ) . bind ( packs , new ValueChangedListener < ArrayList < StickerPackVM > > ( ) { < nl > @ Override < nl > public void onChanged ( ArrayList < StickerPackVM > val , Value < ArrayList < StickerPackVM > > valueModel ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml < nl > index bcc3c6f . . 1a182ce 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml < nl > @ @ - 2 , 7 + 2 , 7 @ @ < nl > ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > - - > < nl > < nl > - < im . actor . messenger . app . fragment . chat . view . BubbleContainer xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + < im . actor . sdk . controllers . conversation . view . BubbleContainer xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > android : id = " @ + id / mainContainer " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " < nl > @ @ - 14 , 7 + 14 , 7 @ @ < nl > android : layout _ height = " wrap _ content " < nl > android : duplicateParentState = " true " > < nl > < nl > - < im . actor . messenger . app . view . emoji . stickers . StickerView < nl > + < im . actor . sdk . view . emoji . stickers . StickerView < nl > android : layout _ marginLeft = " 25dp " < nl > android : layout _ marginRight = " 25dp " < nl > android : layout _ marginTop = " 5dp " < nl > @ @ - 42 , 7 + 42 , 7 @ @ < nl > android : textColor = " @ android : color / white " < nl > android : textSize = " 12sp " / > < nl > < nl > - < im . actor . messenger . app . view . TintImageView < nl > + < im . actor . sdk . view . TintImageView < nl > android : id = " @ + id / stateIcon " < nl > android : layout _ width = " 16dp " < nl > android : layout _ height = " 9dp " < nl > @ @ - 52 , 4 + 52 , 4 @ @ < nl > < / FrameLayout > < nl > < nl > < nl > - < / im . actor . messenger . app . fragment . chat . view . BubbleContainer > < nl > \ No newline at end of file < nl > + < / im . actor . sdk . controllers . conversation . view . BubbleContainer > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > index 8c921f1 . . cb0c25f 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java < nl > @ @ - 8 , 10 + 8 , 12 @ @ import java . util . ArrayList ; < nl > < nl > import im . actor . core . api . rpc . RequestLoadOwnStickers ; < nl > import im . actor . core . api . rpc . ResponseLoadOwnStickers ; < nl > + import im . actor . core . api . updates . UpdateOwnStickersChanged ; < nl > import im . actor . core . api . updates . UpdateStickerCollectionsChanged ; < nl > import im . actor . core . entity . content . internal . StickersPack ; < nl > import im . actor . core . modules . AbsModule ; < nl > import im . actor . core . modules . ModuleContext ; < nl > + import im . actor . core . modules . updates . internal . StickersLoaded ; < nl > import im . actor . core . network . RpcCallback ; < nl > import im . actor . core . network . RpcException ; < nl > import im . actor . core . viewmodel . StickerPackVM ; < nl > @ @ - 59 , 7 + 61 , 7 @ @ public class StickersModule extends AbsModule { < nl > @ Override < nl > public void onResult ( final ResponseLoadOwnStickers response ) { < nl > updates ( ) . onUpdateReceived ( < nl > - new UpdateStickerCollectionsChanged ( response . getOwnStickers ( ) ) < nl > + new StickersLoaded ( response . getOwnStickers ( ) ) < nl > ) ; < nl > } < nl > < nl > @ @ - 72 , 9 + 74 , 7 @ @ public class StickersModule extends AbsModule { < nl > < nl > private ArrayList < StickerPackVM > buildStickerPacks ( ) { < nl > ArrayList < StickerPackVM > vms = new ArrayList < StickerPackVM > ( ) ; < nl > - for ( int i = 0 ; i < stickerPacksList . getCount ( ) ; i + + ) { < nl > - vms . add ( collection . get ( stickerPacksList . getValue ( i ) . getId ( ) ) ) ; < nl > - } < nl > + stickerPacksList . < nl > return vms ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > index 7dc4db8 . . 7c61f68 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java < nl > @ @ - 60 , 6 + 60 , 7 @ @ import im . actor . core . modules . updates . internal . InternalUpdate ; < nl > import im . actor . core . modules . updates . internal . LoggedIn ; < nl > import im . actor . core . modules . updates . internal . MessagesHistoryLoaded ; < nl > import im . actor . core . modules . updates . internal . RelatedResponse ; < nl > + import im . actor . core . modules . updates . internal . StickersLoaded ; < nl > import im . actor . core . modules . updates . internal . UsersFounded ; < nl > import im . actor . core . network . parser . Update ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > @ @ - 145 , 6 + 146 , 8 @ @ public class UpdateProcessor extends AbsModule { < nl > RelatedResponse relatedResponse = ( RelatedResponse ) update ; < nl > applyRelated ( relatedResponse . getRelatedUsers ( ) , relatedResponse . getRelatedGroups ( ) , false ) ; < nl > relatedResponse . getAfterApply ( ) . run ( ) ; < nl > + } else if ( update instanceof StickersLoaded ) { < nl > + stickersProcessor . onOwnStickerCollectionsChanged ( ( ( StickersLoaded ) update ) . getCollections ( ) ) ; < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java < nl > new file mode 100644 < nl > index 0000000 . . 5fc5ccb < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java < nl > @ @ - 0 , 0 + 1 , 20 @ @ < nl > + package im . actor . core . modules . updates . internal ; < nl > + < nl > + import java . util . List ; < nl > + < nl > + import im . actor . core . api . ApiStickerCollection ; < nl > + < nl > + / * * < nl > + * Created by root on 12 / 15 / 15 . < nl > + * / < nl > + public class StickersLoaded extends InternalUpdate { < nl > + private List < ApiStickerCollection > collections ; < nl > + < nl > + public StickersLoaded ( List < ApiStickerCollection > collections ) { < nl > + this . collections = collections ; < nl > + } < nl > + < nl > + public List < ApiStickerCollection > getCollections ( ) { < nl > + return collections ; < nl > + } < nl > + }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index 3808015 . . 8674ea8 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 12 , 12 + 12 , 15 @ @ import com . facebook . drawee . backends . pipeline . Fresco ; < nl > < nl > import java . util . ArrayList ; < nl > import java . util . List ; < nl > + import java . util . Locale ; < nl > + import java . util . TimeZone ; < nl > < nl > import im . actor . core . AndroidMessenger ; < nl > import im . actor . core . ApiConfiguration ; < nl > import im . actor . core . ConfigurationBuilder ; < nl > import im . actor . core . DeviceCategory ; < nl > import im . actor . core . PlatformType ; < nl > + import im . actor . runtime . Log ; < nl > import im . actor . sdk . core . AndroidNotifications ; < nl > import im . actor . sdk . core . AndroidPhoneBook ; < nl > import im . actor . sdk . core . ActorPushManager ; < nl > @ @ - 30 , 6 + 33 , 7 @ @ import im . actor . runtime . android . AndroidContext ; < nl > < nl > public class ActorSDK { < nl > < nl > + private static final String TAG = " ActorSDK " ; < nl > < nl > private static volatile ActorSDK sdk = new ActorSDK ( ) ; < nl > / / < nl > @ @ - 67 , 6 + 71 , 10 @ @ public class ActorSDK { < nl > * / < nl > private String apiAppKey = " 4295f9666fad3faf2d04277fe7a0c40ff39a85d313de5348ad8ffa650ad71855 " ; < nl > / * * < nl > + * Actor App Name < nl > + * / < nl > + private String appName = " Actor " ; < nl > + / * * < nl > * Push Registration Id < nl > * / < nl > private long pushId = 0 ; < nl > @ @ - 128 , 12 + 136 , 24 @ @ public class ActorSDK { < nl > builder . setDeviceCategory ( DeviceCategory . MOBILE ) ; < nl > builder . setPlatformType ( PlatformType . ANDROID ) ; < nl > builder . setApiConfiguration ( new ApiConfiguration ( < nl > - / / TODO : Update Title < nl > - " Title ? " , < nl > + appName , < nl > apiAppId , < nl > apiAppKey , < nl > Devices . getDeviceName ( ) , < nl > AndroidContext . getContext ( ) . getPackageName ( ) + " : " + Build . SERIAL ) ) ; < nl > + < nl > + / / Adding Locales < nl > + Locale defaultLocale = Locale . getDefault ( ) ; < nl > + Log . d ( TAG , " Found Locale : " + defaultLocale . getLanguage ( ) + " - " + defaultLocale . getCountry ( ) ) ; < nl > + Log . d ( TAG , " Found Locale : " + defaultLocale . getLanguage ( ) ) ; < nl > + builder . addPreferredLanguage ( defaultLocale . getLanguage ( ) + " - " + defaultLocale . getCountry ( ) ) ; < nl > + builder . addPreferredLanguage ( defaultLocale . getLanguage ( ) ) ; < nl > + < nl > + / / Adding TimeZone < nl > + String timeZone = TimeZone . getDefault ( ) . getID ( ) ; < nl > + Log . d ( TAG , " Found TimeZone : " + timeZone ) ; < nl > + builder . setTimeZone ( timeZone ) ; < nl > + < nl > this . messenger = new AndroidMessenger ( AndroidContext . getContext ( ) , builder . build ( ) ) ; < nl > < nl > / / < nl > @ @ - 270 , 6 + 290 , 24 @ @ public class ActorSDK { < nl > } < nl > < nl > / * * < nl > + * Getting Application Name . Used to identify application . < nl > + * < nl > + * @ return Application Name < nl > + * / < nl > + public String getAppName ( ) { < nl > + return appName ; < nl > + } < nl > + < nl > + / * * < nl > + * Setting Application Name . < nl > + * < nl > + * @ param appName Application name < nl > + * / < nl > + public void setAppName ( String appName ) { < nl > + this . appName = appName ; < nl > + } < nl > + < nl > + / * * < nl > * Getting Push Registration Id < nl > * < nl > * @ return pushId < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > index 8a0b75a . . 93f8478 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > @ @ - 114 , 12 + 114 , 17 @ @ public class Authentication { < nl > return new Command < AuthState > ( ) { < nl > @ Override < nl > public void start ( final CommandCallback < AuthState > callback ) { < nl > + ArrayList < String > langs = new ArrayList < String > ( ) ; < nl > + for ( String s : modules . getConfiguration ( ) . getPreferredLanguages ( ) ) { < nl > + langs . add ( s ) ; < nl > + } < nl > request ( new RequestStartEmailAuth ( email , < nl > apiConfiguration . getAppId ( ) , < nl > apiConfiguration . getAppKey ( ) , < nl > deviceHash , < nl > apiConfiguration . getDeviceTitle ( ) , < nl > - null , new ArrayList < String > ( ) < nl > + modules . getConfiguration ( ) . getTimeZone ( ) , < nl > + langs < nl > ) , new RpcCallback < ResponseStartEmailAuth > ( ) { < nl > @ Override < nl > public void onResult ( ResponseStartEmailAuth response ) { < nl > @ @ - 160 , 12 + 165 , 17 @ @ public class Authentication { < nl > return new Command < AuthState > ( ) { < nl > @ Override < nl > public void start ( final CommandCallback < AuthState > callback ) { < nl > + ArrayList < String > langs = new ArrayList < String > ( ) ; < nl > + for ( String s : modules . getConfiguration ( ) . getPreferredLanguages ( ) ) { < nl > + langs . add ( s ) ; < nl > + } < nl > request ( new RequestStartPhoneAuth ( phone , < nl > apiConfiguration . getAppId ( ) , < nl > apiConfiguration . getAppKey ( ) , < nl > deviceHash , < nl > apiConfiguration . getDeviceTitle ( ) , < nl > - null , new ArrayList < String > ( ) < nl > + modules . getConfiguration ( ) . getTimeZone ( ) , < nl > + langs < nl > ) , new RpcCallback < ResponseStartPhoneAuth > ( ) { < nl > @ Override < nl > public void onResult ( ResponseStartPhoneAuth response ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > index f5c5862 . . 4bd048f 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java < nl > @ @ - 6 , 6 + 6 , 7 @ @ import im . actor . core . Messenger ; < nl > import im . actor . core . i18n . I18nEngine ; < nl > import im . actor . core . modules . internal . AppStateModule ; < nl > import im . actor . core . modules . internal . ContactsModule ; < nl > + import im . actor . core . modules . internal . DeviceInfoModule ; < nl > import im . actor . core . modules . internal . DisplayLists ; < nl > import im . actor . core . modules . internal . ExternalModule ; < nl > import im . actor . core . modules . internal . FilesModule ; < nl > @ @ - 84 , 5 + 85 , 7 @ @ public interface ModuleContext { < nl > < nl > MentionsModule getMentions ( ) ; < nl > < nl > + DeviceInfoModule getDeviceInfoModule ( ) ; < nl > + < nl > Extensions getExtensions ( ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java < nl > index 9f80b34 . . 15ad0e9 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java < nl > @ @ - 10 , 6 + 10 , 7 @ @ import im . actor . core . Messenger ; < nl > import im . actor . core . i18n . I18nEngine ; < nl > import im . actor . core . modules . internal . AppStateModule ; < nl > import im . actor . core . modules . internal . ContactsModule ; < nl > + import im . actor . core . modules . internal . DeviceInfoModule ; < nl > import im . actor . core . modules . internal . DisplayLists ; < nl > import im . actor . core . modules . internal . ExternalModule ; < nl > import im . actor . core . modules . internal . FilesModule ; < nl > @ @ - 68 , 6 + 69 , 7 @ @ public class Modules implements ModuleContext { < nl > private volatile SecurityModule security ; < nl > private volatile DisplayLists displayLists ; < nl > private volatile MentionsModule mentions ; < nl > + private volatile DeviceInfoModule deviceInfoModule ; < nl > < nl > public Modules ( Messenger messenger , Configuration configuration ) { < nl > this . messenger = messenger ; < nl > @ @ - 143 , 12 + 145 , 16 @ @ public class Modules implements ModuleContext { < nl > mentions = new MentionsModule ( this ) ; < nl > timing . section ( " DisplayLists " ) ; < nl > displayLists = new DisplayLists ( this ) ; < nl > + timing . section ( " DeviceInfo " ) ; < nl > + deviceInfoModule = new DeviceInfoModule ( this ) ; < nl > timing . end ( ) ; < nl > < nl > < nl > timing = new Timing ( " ACCOUNT _ RUN " ) ; < nl > timing . section ( " Settings " ) ; < nl > settings . run ( ) ; < nl > + timing . section ( " DeviceInfo " ) ; < nl > + deviceInfoModule . run ( ) ; < nl > timing . section ( " Files " ) ; < nl > filesModule . run ( ) ; < nl > timing . section ( " Search " ) ; < nl > @ @ - 283 , 6 + 289 , 10 @ @ public class Modules implements ModuleContext { < nl > return mentions ; < nl > } < nl > < nl > + public DeviceInfoModule getDeviceInfoModule ( ) { < nl > + return deviceInfoModule ; < nl > + } < nl > + < nl > @ Override < nl > public Extensions getExtensions ( ) { < nl > return extensions ; < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java < nl > new file mode 100644 < nl > index 0000000 . . b991f5e < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java < nl > @ @ - 0 , 0 + 1 , 23 @ @ < nl > + package im . actor . core . modules . internal ; < nl > + < nl > + import java . util . ArrayList ; < nl > + < nl > + import im . actor . core . api . rpc . RequestNotifyAboutDeviceInfo ; < nl > + import im . actor . core . modules . AbsModule ; < nl > + import im . actor . core . modules . ModuleContext ; < nl > + < nl > + public class DeviceInfoModule extends AbsModule { < nl > + < nl > + public DeviceInfoModule ( ModuleContext context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + public void run ( ) { < nl > + ArrayList < String > langs = new ArrayList < String > ( ) ; < nl > + for ( String s : context ( ) . getConfiguration ( ) . getPreferredLanguages ( ) ) { < nl > + langs . add ( s ) ; < nl > + } < nl > + String timeZone = context ( ) . getConfiguration ( ) . getTimeZone ( ) ; < nl > + request ( new RequestNotifyAboutDeviceInfo ( langs , timeZone ) ) ; < nl > + } < nl > + }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index eede092 . . 5cd1832 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 25 , 10 + 25 , 9 @ @ public class Application extends ActorSDKApplication { 
 ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 ActorSDK . sharedActor ( ) . setPushId ( 209133700967L ) ; 
 
 - / / ArrayList < String > endpoints = new ArrayList < String > ( ) ; 
 - / / endpoints . add ( " foo1 " ) ; 
 - / / endpoints . add ( " foo2 " ) ; 
 - / / ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; 
 + ArrayList < String > endpoints = new ArrayList < String > ( ) ; 
 + endpoints . add ( " tcp : / / x2015contaca2020trixxl . com : 9070 " ) ; 
 + ActorSDK . sharedActor ( ) . setEndpoints ( endpoints ) ; 
 
 ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 style . setMainColor ( Color . parseColor ( " # 529a88 " ) ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java 
 index 2bbe68d . . 3410b94 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / keyboard / emoji / smiles / SmilePagerAdapter . java 
 @ @ - 32 , 6 + 32 , 10 @ @ public class SmilePagerAdapter extends PagerAdapter implements PagerSlidingTabSt 
 
 public SmilePagerAdapter ( EmojiKeyboard emojiKeyboard ) { 
 this . emojiKeyboard = emojiKeyboard ; 
 + if ( messenger ( ) . getOwnStickerPacks ( ) . get ( ) . size ( ) = = 0 ) { 
 + messenger ( ) . loadStickers ( ) ; 
 + } 
 + 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java 
 index 4ae3d2f . . 5197c64 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / emoji / stickers / StickerAdapter . java 
 @ @ - 68 , 7 + 68 , 6 @ @ class StickerAdapter extends HolderAdapter < StickerLine > { 
 
 packs = messenger ( ) . getOwnStickerPacks ( ) ; 
 
 - 
 ( ( BaseActivity ) context ) . bind ( packs , new ValueChangedListener < ArrayList < StickerPackVM > > ( ) { 
 @ Override 
 public void onChanged ( ArrayList < StickerPackVM > val , Value < ArrayList < StickerPackVM > > valueModel ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml 
 index bcc3c6f . . 1a182ce 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / adapter _ dialog _ sticker . xml 
 @ @ - 2 , 7 + 2 , 7 @ @ 
 ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 - - > 
 
 - < im . actor . messenger . app . fragment . chat . view . BubbleContainer xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + < im . actor . sdk . controllers . conversation . view . BubbleContainer xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 android : id = " @ + id / mainContainer " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " 
 @ @ - 14 , 7 + 14 , 7 @ @ 
 android : layout _ height = " wrap _ content " 
 android : duplicateParentState = " true " > 
 
 - < im . actor . messenger . app . view . emoji . stickers . StickerView 
 + < im . actor . sdk . view . emoji . stickers . StickerView 
 android : layout _ marginLeft = " 25dp " 
 android : layout _ marginRight = " 25dp " 
 android : layout _ marginTop = " 5dp " 
 @ @ - 42 , 7 + 42 , 7 @ @ 
 android : textColor = " @ android : color / white " 
 android : textSize = " 12sp " / > 
 
 - < im . actor . messenger . app . view . TintImageView 
 + < im . actor . sdk . view . TintImageView 
 android : id = " @ + id / stateIcon " 
 android : layout _ width = " 16dp " 
 android : layout _ height = " 9dp " 
 @ @ - 52 , 4 + 52 , 4 @ @ 
 < / FrameLayout > 
 
 
 - < / im . actor . messenger . app . fragment . chat . view . BubbleContainer > 
 \ No newline at end of file 
 + < / im . actor . sdk . controllers . conversation . view . BubbleContainer > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 index 8c921f1 . . cb0c25f 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / StickersModule . java 
 @ @ - 8 , 10 + 8 , 12 @ @ import java . util . ArrayList ; 
 
 import im . actor . core . api . rpc . RequestLoadOwnStickers ; 
 import im . actor . core . api . rpc . ResponseLoadOwnStickers ; 
 + import im . actor . core . api . updates . UpdateOwnStickersChanged ; 
 import im . actor . core . api . updates . UpdateStickerCollectionsChanged ; 
 import im . actor . core . entity . content . internal . StickersPack ; 
 import im . actor . core . modules . AbsModule ; 
 import im . actor . core . modules . ModuleContext ; 
 + import im . actor . core . modules . updates . internal . StickersLoaded ; 
 import im . actor . core . network . RpcCallback ; 
 import im . actor . core . network . RpcException ; 
 import im . actor . core . viewmodel . StickerPackVM ; 
 @ @ - 59 , 7 + 61 , 7 @ @ public class StickersModule extends AbsModule { 
 @ Override 
 public void onResult ( final ResponseLoadOwnStickers response ) { 
 updates ( ) . onUpdateReceived ( 
 - new UpdateStickerCollectionsChanged ( response . getOwnStickers ( ) ) 
 + new StickersLoaded ( response . getOwnStickers ( ) ) 
 ) ; 
 } 
 
 @ @ - 72 , 9 + 74 , 7 @ @ public class StickersModule extends AbsModule { 
 
 private ArrayList < StickerPackVM > buildStickerPacks ( ) { 
 ArrayList < StickerPackVM > vms = new ArrayList < StickerPackVM > ( ) ; 
 - for ( int i = 0 ; i < stickerPacksList . getCount ( ) ; i + + ) { 
 - vms . add ( collection . get ( stickerPacksList . getValue ( i ) . getId ( ) ) ) ; 
 - } 
 + stickerPacksList . 
 return vms ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 index 7dc4db8 . . 7c61f68 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / UpdateProcessor . java 
 @ @ - 60 , 6 + 60 , 7 @ @ import im . actor . core . modules . updates . internal . InternalUpdate ; 
 import im . actor . core . modules . updates . internal . LoggedIn ; 
 import im . actor . core . modules . updates . internal . MessagesHistoryLoaded ; 
 import im . actor . core . modules . updates . internal . RelatedResponse ; 
 + import im . actor . core . modules . updates . internal . StickersLoaded ; 
 import im . actor . core . modules . updates . internal . UsersFounded ; 
 import im . actor . core . network . parser . Update ; 
 import im . actor . core . viewmodel . UserVM ; 
 @ @ - 145 , 6 + 146 , 8 @ @ public class UpdateProcessor extends AbsModule { 
 RelatedResponse relatedResponse = ( RelatedResponse ) update ; 
 applyRelated ( relatedResponse . getRelatedUsers ( ) , relatedResponse . getRelatedGroups ( ) , false ) ; 
 relatedResponse . getAfterApply ( ) . run ( ) ; 
 + } else if ( update instanceof StickersLoaded ) { 
 + stickersProcessor . onOwnStickerCollectionsChanged ( ( ( StickersLoaded ) update ) . getCollections ( ) ) ; 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java 
 new file mode 100644 
 index 0000000 . . 5fc5ccb 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / updates / internal / StickersLoaded . java 
 @ @ - 0 , 0 + 1 , 20 @ @ 
 + package im . actor . core . modules . updates . internal ; 
 + 
 + import java . util . List ; 
 + 
 + import im . actor . core . api . ApiStickerCollection ; 
 + 
 + / * * 
 + * Created by root on 12 / 15 / 15 . 
 + * / 
 + public class StickersLoaded extends InternalUpdate { 
 + private List < ApiStickerCollection > collections ; 
 + 
 + public StickersLoaded ( List < ApiStickerCollection > collections ) { 
 + this . collections = collections ; 
 + } 
 + 
 + public List < ApiStickerCollection > getCollections ( ) { 
 + return collections ; 
 + } 
 + }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index 3808015 . . 8674ea8 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 12 , 12 + 12 , 15 @ @ import com . facebook . drawee . backends . pipeline . Fresco ; 
 
 import java . util . ArrayList ; 
 import java . util . List ; 
 + import java . util . Locale ; 
 + import java . util . TimeZone ; 
 
 import im . actor . core . AndroidMessenger ; 
 import im . actor . core . ApiConfiguration ; 
 import im . actor . core . ConfigurationBuilder ; 
 import im . actor . core . DeviceCategory ; 
 import im . actor . core . PlatformType ; 
 + import im . actor . runtime . Log ; 
 import im . actor . sdk . core . AndroidNotifications ; 
 import im . actor . sdk . core . AndroidPhoneBook ; 
 import im . actor . sdk . core . ActorPushManager ; 
 @ @ - 30 , 6 + 33 , 7 @ @ import im . actor . runtime . android . AndroidContext ; 
 
 public class ActorSDK { 
 
 + private static final String TAG = " ActorSDK " ; 
 
 private static volatile ActorSDK sdk = new ActorSDK ( ) ; 
 / / 
 @ @ - 67 , 6 + 71 , 10 @ @ public class ActorSDK { 
 * / 
 private String apiAppKey = " 4295f9666fad3faf2d04277fe7a0c40ff39a85d313de5348ad8ffa650ad71855 " ; 
 / * * 
 + * Actor App Name 
 + * / 
 + private String appName = " Actor " ; 
 + / * * 
 * Push Registration Id 
 * / 
 private long pushId = 0 ; 
 @ @ - 128 , 12 + 136 , 24 @ @ public class ActorSDK { 
 builder . setDeviceCategory ( DeviceCategory . MOBILE ) ; 
 builder . setPlatformType ( PlatformType . ANDROID ) ; 
 builder . setApiConfiguration ( new ApiConfiguration ( 
 - / / TODO : Update Title 
 - " Title ? " , 
 + appName , 
 apiAppId , 
 apiAppKey , 
 Devices . getDeviceName ( ) , 
 AndroidContext . getContext ( ) . getPackageName ( ) + " : " + Build . SERIAL ) ) ; 
 + 
 + / / Adding Locales 
 + Locale defaultLocale = Locale . getDefault ( ) ; 
 + Log . d ( TAG , " Found Locale : " + defaultLocale . getLanguage ( ) + " - " + defaultLocale . getCountry ( ) ) ; 
 + Log . d ( TAG , " Found Locale : " + defaultLocale . getLanguage ( ) ) ; 
 + builder . addPreferredLanguage ( defaultLocale . getLanguage ( ) + " - " + defaultLocale . getCountry ( ) ) ; 
 + builder . addPreferredLanguage ( defaultLocale . getLanguage ( ) ) ; 
 + 
 + / / Adding TimeZone 
 + String timeZone = TimeZone . getDefault ( ) . getID ( ) ; 
 + Log . d ( TAG , " Found TimeZone : " + timeZone ) ; 
 + builder . setTimeZone ( timeZone ) ; 
 + 
 this . messenger = new AndroidMessenger ( AndroidContext . getContext ( ) , builder . build ( ) ) ; 
 
 / / 
 @ @ - 270 , 6 + 290 , 24 @ @ public class ActorSDK { 
 } 
 
 / * * 
 + * Getting Application Name . Used to identify application . 
 + * 
 + * @ return Application Name 
 + * / 
 + public String getAppName ( ) { 
 + return appName ; 
 + } 
 + 
 + / * * 
 + * Setting Application Name . 
 + * 
 + * @ param appName Application name 
 + * / 
 + public void setAppName ( String appName ) { 
 + this . appName = appName ; 
 + } 
 + 
 + / * * 
 * Getting Push Registration Id 
 * 
 * @ return pushId 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 index 8a0b75a . . 93f8478 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 @ @ - 114 , 12 + 114 , 17 @ @ public class Authentication { 
 return new Command < AuthState > ( ) { 
 @ Override 
 public void start ( final CommandCallback < AuthState > callback ) { 
 + ArrayList < String > langs = new ArrayList < String > ( ) ; 
 + for ( String s : modules . getConfiguration ( ) . getPreferredLanguages ( ) ) { 
 + langs . add ( s ) ; 
 + } 
 request ( new RequestStartEmailAuth ( email , 
 apiConfiguration . getAppId ( ) , 
 apiConfiguration . getAppKey ( ) , 
 deviceHash , 
 apiConfiguration . getDeviceTitle ( ) , 
 - null , new ArrayList < String > ( ) 
 + modules . getConfiguration ( ) . getTimeZone ( ) , 
 + langs 
 ) , new RpcCallback < ResponseStartEmailAuth > ( ) { 
 @ Override 
 public void onResult ( ResponseStartEmailAuth response ) { 
 @ @ - 160 , 12 + 165 , 17 @ @ public class Authentication { 
 return new Command < AuthState > ( ) { 
 @ Override 
 public void start ( final CommandCallback < AuthState > callback ) { 
 + ArrayList < String > langs = new ArrayList < String > ( ) ; 
 + for ( String s : modules . getConfiguration ( ) . getPreferredLanguages ( ) ) { 
 + langs . add ( s ) ; 
 + } 
 request ( new RequestStartPhoneAuth ( phone , 
 apiConfiguration . getAppId ( ) , 
 apiConfiguration . getAppKey ( ) , 
 deviceHash , 
 apiConfiguration . getDeviceTitle ( ) , 
 - null , new ArrayList < String > ( ) 
 + modules . getConfiguration ( ) . getTimeZone ( ) , 
 + langs 
 ) , new RpcCallback < ResponseStartPhoneAuth > ( ) { 
 @ Override 
 public void onResult ( ResponseStartPhoneAuth response ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 index f5c5862 . . 4bd048f 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / ModuleContext . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import im . actor . core . Messenger ; 
 import im . actor . core . i18n . I18nEngine ; 
 import im . actor . core . modules . internal . AppStateModule ; 
 import im . actor . core . modules . internal . ContactsModule ; 
 + import im . actor . core . modules . internal . DeviceInfoModule ; 
 import im . actor . core . modules . internal . DisplayLists ; 
 import im . actor . core . modules . internal . ExternalModule ; 
 import im . actor . core . modules . internal . FilesModule ; 
 @ @ - 84 , 5 + 85 , 7 @ @ public interface ModuleContext { 
 
 MentionsModule getMentions ( ) ; 
 
 + DeviceInfoModule getDeviceInfoModule ( ) ; 
 + 
 Extensions getExtensions ( ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java 
 index 9f80b34 . . 15ad0e9 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Modules . java 
 @ @ - 10 , 6 + 10 , 7 @ @ import im . actor . core . Messenger ; 
 import im . actor . core . i18n . I18nEngine ; 
 import im . actor . core . modules . internal . AppStateModule ; 
 import im . actor . core . modules . internal . ContactsModule ; 
 + import im . actor . core . modules . internal . DeviceInfoModule ; 
 import im . actor . core . modules . internal . DisplayLists ; 
 import im . actor . core . modules . internal . ExternalModule ; 
 import im . actor . core . modules . internal . FilesModule ; 
 @ @ - 68 , 6 + 69 , 7 @ @ public class Modules implements ModuleContext { 
 private volatile SecurityModule security ; 
 private volatile DisplayLists displayLists ; 
 private volatile MentionsModule mentions ; 
 + private volatile DeviceInfoModule deviceInfoModule ; 
 
 public Modules ( Messenger messenger , Configuration configuration ) { 
 this . messenger = messenger ; 
 @ @ - 143 , 12 + 145 , 16 @ @ public class Modules implements ModuleContext { 
 mentions = new MentionsModule ( this ) ; 
 timing . section ( " DisplayLists " ) ; 
 displayLists = new DisplayLists ( this ) ; 
 + timing . section ( " DeviceInfo " ) ; 
 + deviceInfoModule = new DeviceInfoModule ( this ) ; 
 timing . end ( ) ; 
 
 
 timing = new Timing ( " ACCOUNT _ RUN " ) ; 
 timing . section ( " Settings " ) ; 
 settings . run ( ) ; 
 + timing . section ( " DeviceInfo " ) ; 
 + deviceInfoModule . run ( ) ; 
 timing . section ( " Files " ) ; 
 filesModule . run ( ) ; 
 timing . section ( " Search " ) ; 
 @ @ - 283 , 6 + 289 , 10 @ @ public class Modules implements ModuleContext { 
 return mentions ; 
 } 
 
 + public DeviceInfoModule getDeviceInfoModule ( ) { 
 + return deviceInfoModule ; 
 + } 
 + 
 @ Override 
 public Extensions getExtensions ( ) { 
 return extensions ; 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java 
 new file mode 100644 
 index 0000000 . . b991f5e 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / DeviceInfoModule . java 
 @ @ - 0 , 0 + 1 , 23 @ @ 
 + package im . actor . core . modules . internal ; 
 + 
 + import java . util . ArrayList ; 
 + 
 + import im . actor . core . api . rpc . RequestNotifyAboutDeviceInfo ; 
 + import im . actor . core . modules . AbsModule ; 
 + import im . actor . core . modules . ModuleContext ; 
 + 
 + public class DeviceInfoModule extends AbsModule { 
 + 
 + public DeviceInfoModule ( ModuleContext context ) { 
 + super ( context ) ; 
 + } 
 + 
 + public void run ( ) { 
 + ArrayList < String > langs = new ArrayList < String > ( ) ; 
 + for ( String s : context ( ) . getConfiguration ( ) . getPreferredLanguages ( ) ) { 
 + langs . add ( s ) ; 
 + } 
 + String timeZone = context ( ) . getConfiguration ( ) . getTimeZone ( ) ; 
 + request ( new RequestNotifyAboutDeviceInfo ( langs , timeZone ) ) ; 
 + } 
 + }
