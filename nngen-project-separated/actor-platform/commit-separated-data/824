BLEU SCORE: 0.21200626759025185

TEST MSG: feat ( android ) share media - confirm share / notify gallery
GENERATED MSG: feat ( android ) : chat backgrounds settings

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > index dbfc558 . . 64411a3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . activity . controllers ; < nl > < nl > import android . content . Context ; < nl > + import android . content . DialogInterface ; < nl > import android . content . Intent ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . net . Uri ; < nl > @ @ - 11 , 6 + 12 , 7 @ @ import android . support . v4 . app . FragmentManager ; < nl > import android . support . v4 . view . MenuItemCompat ; < nl > import android . support . v4 . view . ViewPager ; < nl > import android . support . v7 . app . ActionBar ; < nl > + import android . support . v7 . app . AlertDialog ; < nl > import android . support . v7 . widget . ChatLinearLayoutManager ; < nl > import android . support . v7 . widget . RecyclerView ; < nl > import android . support . v7 . widget . SearchView ; < nl > @ @ - 104 , 7 + 106 , 29 @ @ public class MainPhoneController extends MainBaseController { < nl > } < nl > < nl > @ Override < nl > - public void onItemClicked ( Dialog item ) { < nl > + public void onItemClicked ( final Dialog item ) { < nl > + if ( ( sendUriMultiple ! = null & & ! sendUriMultiple . isEmpty ( ) ) | | ( sendUriString ! = null & & ! sendUriString . isEmpty ( ) ) ) { < nl > + new AlertDialog . Builder ( getActivity ( ) ) < nl > + . setMessage ( getActivity ( ) . getString ( R . string . confirm _ share ) + " " + item . getDialogTitle ( ) + " ? " ) < nl > + . setPositiveButton ( R . string . dialog _ ok , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog , int which ) { < nl > + openDialog ( item ) ; < nl > + } < nl > + } ) < nl > + . setNegativeButton ( R . string . dialog _ cancel , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog , int which ) { < nl > + dialog . dismiss ( ) ; < nl > + } < nl > + } ) < nl > + . show ( ) ; < nl > + } else { < nl > + openDialog ( item ) ; < nl > + } < nl > + } < nl > + < nl > + public void openDialog ( Dialog item ) { < nl > startActivity ( Intents . openDialog ( item . getPeer ( ) , false , getActivity ( ) ) . putExtra ( " send _ uri " , sendUriString ) < nl > . putExtra ( " send _ uri _ multiple " , sendUriMultiple ) < nl > . putExtra ( " send _ text " , sendText ) < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index fe5738b . . 0945edf 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 11 , 8 + 11 , 10 @ @ import android . content . pm . PackageManager ; < nl > import android . content . res . Configuration ; < nl > import android . database . Cursor ; < nl > import android . graphics . PorterDuff ; < nl > + import android . media . MediaScannerConnection ; < nl > import android . net . Uri ; < nl > import android . os . Bundle ; < nl > + import android . os . Environment ; < nl > import android . provider . ContactsContract ; < nl > import android . provider . MediaStore ; < nl > import android . support . v4 . app . ActivityCompat ; < nl > @ @ - 324 , 14 + 326 , 15 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > intent . setType ( " image / * video / * " ) ; < nl > startActivityForResult ( intent , REQUEST _ GALLERY ) ; < nl > } else if ( item . getId ( ) = = R . id . share _ camera ) { < nl > - File externalFile = getExternalFilesDir ( null ) ; < nl > + File externalFile = Environment . getExternalStorageDirectory ( ) ; < nl > if ( externalFile = = null ) { < nl > Toast . makeText ( ChatActivity . this , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; < nl > - } < nl > - String externalPath = externalFile . getAbsolutePath ( ) ; < nl > - new File ( externalPath + " / actor / " ) . mkdirs ( ) ; < nl > + } else { < nl > + String externalPath = externalFile . getAbsolutePath ( ) ; < nl > + new File ( externalPath + " / Actor / capture / " ) . mkdirs ( ) ; < nl > < nl > - pending _ fileName = externalPath + " / actor / capture _ " + Randoms . randomId ( ) + " . jpg " ; < nl > + pending _ fileName = externalPath + " / Actor / capture / capture _ " + Randoms . randomId ( ) + " . jpg " ; < nl > + } < nl > if ( ContextCompat . checkSelfPermission ( ChatActivity . this , Manifest . permission . CAMERA ) ! = PackageManager . PERMISSION _ GRANTED ) { < nl > Log . d ( " Permissions " , " camera - no permission : c " ) ; < nl > ActivityCompat . requestPermissions ( ChatActivity . this , < nl > @ @ - 343 , 18 + 346 , 19 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > } else if ( item . getId ( ) = = R . id . share _ video ) { < nl > < nl > - File externalFile = getExternalFilesDir ( null ) ; < nl > + File externalFile = Environment . getExternalStorageDirectory ( ) ; < nl > if ( externalFile = = null ) { < nl > Toast . makeText ( ChatActivity . this , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; < nl > - } < nl > - String externalPath = externalFile . getAbsolutePath ( ) ; < nl > - new File ( externalPath + " / actor / " ) . mkdirs ( ) ; < nl > + } else { < nl > + String externalPath = externalFile . getAbsolutePath ( ) ; < nl > + new File ( externalPath + " / Actor / capture / " ) . mkdirs ( ) ; < nl > < nl > - pending _ fileName = externalPath + " / actor / capture _ " + Randoms . randomId ( ) + " . mp4 " ; < nl > + pending _ fileName = externalPath + " / Actor / capture / capture _ " + Randoms . randomId ( ) + " . mp4 " ; < nl > < nl > - Intent i = new Intent ( MediaStore . ACTION _ VIDEO _ CAPTURE ) < nl > - . putExtra ( MediaStore . EXTRA _ OUTPUT , Uri . fromFile ( new File ( pending _ fileName ) ) ) ; < nl > - startActivityForResult ( i , REQUEST _ VIDEO ) ; < nl > + Intent i = new Intent ( MediaStore . ACTION _ VIDEO _ CAPTURE ) < nl > + . putExtra ( MediaStore . EXTRA _ OUTPUT , Uri . fromFile ( new File ( pending _ fileName ) ) ) ; < nl > + startActivityForResult ( i , REQUEST _ VIDEO ) ; < nl > + } < nl > } else if ( item . getId ( ) = = R . id . share _ file ) { < nl > startActivityForResult ( Intents . pickFile ( ChatActivity . this ) , REQUEST _ DOC ) ; < nl > } else if ( item . getId ( ) = = R . id . share _ location ) { < nl > @ @ - 810 , 8 + 814 , 10 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > } else if ( requestCode = = REQUEST _ PHOTO ) { < nl > messenger ( ) . sendPhoto ( peer , pending _ fileName ) ; < nl > + MediaScannerConnection . scanFile ( this , new String [ ] { pending _ fileName } , new String [ ] { " image / jpeg " } , null ) ; < nl > } else if ( requestCode = = REQUEST _ VIDEO ) { < nl > messenger ( ) . sendVideo ( peer , pending _ fileName ) ; < nl > + MediaScannerConnection . scanFile ( this , new String [ ] { pending _ fileName } , new String [ ] { " image / jpeg " } , null ) ; < nl > } else if ( requestCode = = REQUEST _ DOC ) { < nl > if ( data . getData ( ) ! = null ) { < nl > execute ( messenger ( ) . sendUri ( peer , data . getData ( ) ) , R . string . pick _ downloading ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java < nl > index d5a7a04 . . b1b37a5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java < nl > @ @ - 5 , 8 + 5 , 12 @ @ import android . animation . AnimatorListenerAdapter ; < nl > import android . app . Activity ; < nl > import android . content . Intent ; < nl > import android . graphics . Bitmap ; < nl > + import android . media . MediaScannerConnection ; < nl > + import android . net . Uri ; < nl > import android . os . Build ; < nl > import android . os . Bundle ; < nl > + import android . os . Environment ; < nl > + import android . provider . MediaStore ; < nl > import android . support . v4 . app . Fragment ; < nl > import android . support . v7 . app . ActionBar ; < nl > import android . support . v7 . widget . Toolbar ; < nl > @ @ - 19 , 12 + 23 , 18 @ @ import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . ImageView ; < nl > import android . widget . TextView ; < nl > + import android . widget . Toast ; < nl > < nl > import com . droidkit . progress . CircularView ; < nl > < nl > + import java . io . File ; < nl > + import java . io . IOException ; < nl > + < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseActivity ; < nl > + import im . actor . sdk . util . Files ; < nl > + import im . actor . sdk . util . Randoms ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . util . images . common . ImageLoadException ; < nl > import im . actor . sdk . util . images . ops . ImageLoading ; < nl > @ @ - 463 , 25 + 473 , 24 @ @ public class PictureActivity extends BaseActivity { < nl > . putExtra ( Intent . EXTRA _ STREAM , Uri . parse ( path ) ) ) ; * / < nl > return true ; < nl > } else if ( item . getItemId ( ) = = R . id . save ) { < nl > - / / getImageLoader ( ) . createReceiver ( new ReceiverCallback ( ) { < nl > - / / @ Override < nl > - / / public void onImageLoaded ( BitmapReference bitmap ) { < nl > - / / Intents . savePicture ( getActivity ( ) , bitmap . getBitmap ( ) ) ; < nl > - / / } < nl > - / / < nl > - / / @ Override < nl > - / / public void onImageCleared ( ) { < nl > - / / < nl > - / / } < nl > - / / < nl > - / / @ Override < nl > - / / public void onImageError ( ) { < nl > - / / < nl > - / / } < nl > - / / } ) . request ( new RawFileTask ( path ) ) ; < nl > + File externalFile = Environment . getExternalStorageDirectory ( ) ; < nl > + if ( externalFile = = null ) { < nl > + Toast . makeText ( getActivity ( ) , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + } else { < nl > + String externalPath = externalFile . getAbsolutePath ( ) ; < nl > + new File ( externalPath + " / Actor / exported / " ) . mkdirs ( ) ; < nl > + try { < nl > + String exportPath = externalPath + " / Actor / exported / " + ( fileName ! = null ? fileName : " exported " ) + " _ " + Randoms . randomId ( ) + " . jpg " ; < nl > + Files . copy ( new File ( this . path ) , new File ( exportPath ) ) ; < nl > + MediaScannerConnection . scanFile ( getActivity ( ) , new String [ ] { exportPath } , new String [ ] { " image / jpeg " } , null ) ; < nl > + Toast . makeText ( getActivity ( ) , getString ( R . string . file _ saved ) + " " + exportPath , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + item . setEnabled ( false ) ; < nl > + item . setTitle ( R . string . menu _ saved ) ; < nl > + } catch ( IOException e ) { < nl > + e . printStackTrace ( ) ; < nl > + } < nl > + } < nl > < nl > - item . setEnabled ( false ) ; < nl > - item . setTitle ( R . string . menu _ saved ) ; < nl > < nl > return true ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java < nl > index ee34e6e . . 3036111 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java < nl > @ @ - 1 , 6 + 1 , 11 @ @ < nl > package im . actor . sdk . util ; < nl > < nl > import java . io . File ; < nl > + import java . io . FileInputStream ; < nl > + import java . io . FileOutputStream ; < nl > + import java . io . IOException ; < nl > + import java . io . InputStream ; < nl > + import java . io . OutputStream ; < nl > < nl > import im . actor . runtime . android . AndroidContext ; < nl > < nl > @ @ - 37 , 4 + 42 , 17 @ @ public class Files { < nl > File outputFile = new File ( dest , prefix + " _ " + Randoms . randomId ( ) + " " + postfix ) ; < nl > return outputFile . getAbsolutePath ( ) ; < nl > } < nl > + < nl > + public static void copy ( File src , File dst ) throws IOException { < nl > + InputStream in = new FileInputStream ( src ) ; < nl > + OutputStream out = new FileOutputStream ( dst ) ; < nl > + < nl > + byte [ ] buf = new byte [ 1024 ] ; < nl > + int len ; < nl > + while ( ( len = in . read ( buf ) ) > 0 ) { < nl > + out . write ( buf , 0 , len ) ; < nl > + } < nl > + in . close ( ) ; < nl > + out . close ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index c8eea5c . . 42e4042 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 365 , 6 + 365 , 8 @ @ < nl > < ! - - Documents - - > < nl > < string name = " documents _ title " > Д о к у м е н т ы < / string > < nl > < string name = " documents _ empty " > Е щ е н е т д о к у м е н т о в < / string > < nl > + < string name = " file _ saved " > Ф а й л с о х р а н е н : < / string > < nl > + < nl > < nl > < ! - - Edit name - - > < nl > < string name = " edit _ name _ title _ you " > В в е д и т е В а ш е и м я < / string > < nl > @ @ - 472 , 4 + 474 , 5 @ @ < nl > < string name = " error _ unknown " > Н е в о з м о ж н о п р о и з в е с т и о п е р а ц и ю . \ n \ n П о ж а л у й с т а , п р о в е р ь т е с в о й т е л е ф о н и в ы к л ю ч и т е и в к л ю ч и т е е г о , е с л и п р о б л е м а н е б у д е т р е ш е н а . < nl > < / string > < nl > < string name = " error _ view _ url " > Н е и з в е с т н ы й т и п с с ы л к и < / string > < nl > + < string name = " confirm _ share " > П о д е л и т ь с я с < / string > < nl > < / resources > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 0ac8749 . . 6b782e0 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 370 , 6 + 370 , 7 @ @ < nl > < ! - - Documents - - > < nl > < string name = " documents _ title " > Documents < / string > < nl > < string name = " documents _ empty " > No documents yet < / string > < nl > + < string name = " file _ saved " > File saved : < / string > < nl > < nl > < ! - - Edit name - - > < nl > < string name = " edit _ name _ title _ you " > Enter your name < / string > < nl > @ @ - 498 , 4 + 499 , 5 @ @ < nl > < string name = " notification _ multiple _ canversations _ after _ msg _ count " > " messages in " < / string > < nl > < string name = " notifications _ multiple _ canversations _ after _ coversations _ count " > " chats " < / string > < nl > < string name = " notifications _ single _ conversation _ а fter _ messages _ count " > " messages " < / string > < nl > + < string name = " confirm _ share " > Share with < / string > < nl > < / resources > < nl > \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 7b89f42 . . 1a6196a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > } < nl > } < nl > + super . onActivityResult ( requestCode , resultCode , data ) ; < nl > } < nl > < nl > / / Mentions < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > index d8717e9 . . e177ecd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > @ @ - 1 , 16 + 1 , 19 @ @ < nl > package im . actor . sdk . controllers . conversation . view ; < nl > < nl > import android . content . Context ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Canvas ; < nl > import android . graphics . drawable . Drawable ; < nl > import android . util . AttributeSet ; < nl > import android . view . View ; < nl > < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > < nl > public class ChatBackgroundView extends View { < nl > < nl > private Drawable background ; < nl > + SharedPreferences shp ; < nl > < nl > public ChatBackgroundView ( Context context ) { < nl > super ( context ) ; < nl > @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { < nl > < nl > public void bind ( ) { < nl > if ( background = = null ) { < nl > - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; < nl > + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; < nl > } < nl > + < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > index b88785e . . 50d64ca 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { < nl > ViewUtils . showView ( view , isAnimated , isSlow ) ; < nl > } < nl > < nl > + public void elevateView ( View view ) { < nl > + ViewUtils . elevateView ( view ) ; < nl > + } < nl > + < nl > + public void elevateView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . elevateView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + public void demoteView ( View view ) { < nl > + ViewUtils . demoteView ( view ) ; < nl > + } < nl > + < nl > + public void demoteView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . demoteView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + < nl > public void onClick ( View view , int id , final View . OnClickListener listener ) { < nl > onClick ( view . findViewById ( id ) , listener ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > index 04e80fd . . 8eba614 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { < nl > nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; < nl > tintImageView . setVisibility ( View . INVISIBLE ) ; < nl > - String value = nick ; < nl > + String value = " @ " . concat ( nick ) ; < nl > String title = getString ( R . string . nickname ) ; < nl > recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; < nl > ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > index a659507 . . d70cba7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; < nl > import android . content . Context ; < nl > import android . content . DialogInterface ; < nl > import android . content . Intent ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . net . Uri ; < nl > @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > import im . actor . sdk . controllers . fragment . help . HelpActivity ; < nl > import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > import im . actor . sdk . view . TintImageView ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > private int baseColor ; < nl > private CoverAvatarView avatarView ; < nl > + SharedPreferences shp ; < nl > + SharedPreferences . Editor ed ; < nl > < nl > @ Override < nl > public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; < nl > + < nl > + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + ed = shp . edit ( ) ; < nl > + < nl > baseColor = getResources ( ) . getColor ( R . color . primary ) ; < nl > final ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > final UserVM userModel = users ( ) . get ( myUid ( ) ) ; < nl > @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; < nl > < nl > + / / Wallpaper < nl > + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; < nl > + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; < nl > + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; < nl > + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + final View [ ] elevated = new View [ ] { null } ; < nl > + View . OnClickListener ocl = new View . OnClickListener ( ) { < nl > + < nl > + @ Override < nl > + public void onClick ( final View v ) { < nl > + if ( v ! = elevated [ 0 ] ) { < nl > + if ( elevated [ 0 ] ! = null ) { < nl > + demoteView ( elevated [ 0 ] ) ; < nl > + } < nl > + elevated [ 0 ] = v ; < nl > + elevateView ( v ) ; < nl > + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; < nl > + ed . commit ( ) ; < nl > + } < nl > + } < nl > + } ; < nl > + for ( int i = 0 ; i < 4 ; i + + ) { < nl > + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; < nl > + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; < nl > + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; < nl > + bckgrnd . bind ( i ) ; < nl > + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; < nl > + frame . setTag ( i ) ; < nl > + frame . setOnClickListener ( ocl ) ; < nl > + frame . addView ( bckgrnd ) ; < nl > + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; < nl > + < nl > + if ( i = = selectedWallpaper ) { < nl > + elevateView ( frame , false ) ; < nl > + elevated [ 0 ] = frame ; < nl > + } < nl > + } < nl > + < nl > view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > index 43b6b07 . . 81b27d3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; < nl > import android . view . View ; < nl > import android . view . animation . AlphaAnimation ; < nl > import android . view . animation . Animation ; < nl > + import android . view . animation . ScaleAnimation ; < nl > import android . view . animation . Transformation ; < nl > import android . widget . AbsListView ; < nl > < nl > @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { < nl > < nl > < nl > } < nl > + < nl > + public static void elevateView ( final View view ) { < nl > + elevateView ( view , true ) ; < nl > + } < nl > + < nl > + public static void elevateView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + < nl > + } < nl > + < nl > + public static void demoteView ( final View view ) { < nl > + demoteView ( view , true ) ; < nl > + } < nl > + < nl > + public static void demoteView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + if ( isAnimated ) { < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + } < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > new file mode 100644 < nl > index 0000000 . . fb7ae5c < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > @ @ - 0 , 0 + 1 , 79 @ @ < nl > + package im . actor . sdk . view ; < nl > + < nl > + import android . content . Context ; < nl > + import android . net . Uri ; < nl > + import android . util . AttributeSet ; < nl > + < nl > + import com . facebook . common . util . UriUtil ; < nl > + import com . facebook . drawee . backends . pipeline . Fresco ; < nl > + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchy ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; < nl > + import com . facebook . drawee . view . SimpleDraweeView ; < nl > + import com . facebook . imagepipeline . common . ResizeOptions ; < nl > + import com . facebook . imagepipeline . request . ImageRequest ; < nl > + import com . facebook . imagepipeline . request . ImageRequestBuilder ; < nl > + < nl > + import im . actor . sdk . R ; < nl > + < nl > + public class BackgroundPreviewView extends SimpleDraweeView { < nl > + < nl > + private int width ; < nl > + private int height ; < nl > + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; < nl > + < nl > + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { < nl > + super ( context , hierarchy ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { < nl > + super ( context , attrs ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { < nl > + super ( context , attrs , defStyle ) ; < nl > + } < nl > + < nl > + public void init ( int width , int height ) { < nl > + this . width = width ; < nl > + this . height = height ; < nl > + < nl > + GenericDraweeHierarchyBuilder builder = < nl > + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; < nl > + < nl > + GenericDraweeHierarchy hierarchy = builder < nl > + . setFadeDuration ( 200 ) < nl > + . build ( ) ; < nl > + setHierarchy ( hierarchy ) ; < nl > + } < nl > + < nl > + public void bind ( int i ) { < nl > + int bkgrnd = getBackground ( i ) ; < nl > + Uri uri = new Uri . Builder ( ) < nl > + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) < nl > + . path ( String . valueOf ( bkgrnd ) ) < nl > + . build ( ) ; < nl > + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > + . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > + . build ( ) ; < nl > + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > + . setOldController ( getController ( ) ) < nl > + . setImageRequest ( request ) < nl > + . build ( ) ; < nl > + setController ( controller ) ; < nl > + < nl > + } < nl > + < nl > + < nl > + public static int getBackground ( int i ) { < nl > + if ( i > = 0 & & BACKGROUNDS . length > i ) { < nl > + return BACKGROUNDS [ i ] ; < nl > + } else { < nl > + return R . drawable . img _ chat _ background _ default ; < nl > + } < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > index fa384b2 . . f688b72 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > @ @ - 282 , 6 + 282 , 56 @ @ < nl > < / LinearLayout > < nl > < nl > < FrameLayout < nl > + android : id = " @ + id / wallpaperDivider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 16dp " < nl > + android : background = " @ color / bg _ backyard " > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : background = " @ drawable / card _ shadow _ bottom " / > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 1dp " < nl > + android : layout _ gravity = " bottom " < nl > + android : background = " @ drawable / card _ shadow _ top " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / settings _ wallpaper _ title " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : gravity = " center _ vertical | left " < nl > + android : paddingLeft = " 72dp " < nl > + android : text = " @ string / wallpaper " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < HorizontalScrollView < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : requiresFadingEdge = " none " < nl > + android : scrollbars = " none " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / background _ container " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " horizontal " > < nl > + < nl > + < View < nl > + android : layout _ width = " 72dp " < nl > + android : layout _ height = " 200dp " < nl > + android : background = " @ android : color / transparent " / > < nl > + < nl > + < nl > + < / LinearLayout > < nl > + < / HorizontalScrollView > < nl > + < nl > + < nl > + < FrameLayout < nl > android : id = " @ + id / settings _ bottom _ container " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " / > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 3c3350b . . 9ad8001 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 153 , 6 + 153 , 7 @ @ < nl > < string name = " nickname _ change " > И з м е н и т ь н и к < / string > < nl > < string name = " about _ user _ me " > О б о м н е < / string > < nl > < string name = " about _ user " > О п о л ь з о в а т е л е < / string > < nl > + < string name = " wallpaper " > О б о и < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 2270a93 . . 3a7761d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 157 , 6 + 157 , 7 @ @ < nl > < string name = " nickname _ edittext _ hint " > Enter your Username < / string > < nl > < string name = " about _ user _ me " > About me < / string > < nl > < string name = " about _ user " > About user < / string > < nl > + < string name = " wallpaper " > Wallpaper < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > Call { 0 } < / string >

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 index dbfc558 . . 64411a3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / activity / controllers / MainPhoneController . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . activity . controllers ; 
 
 import android . content . Context ; 
 + import android . content . DialogInterface ; 
 import android . content . Intent ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . net . Uri ; 
 @ @ - 11 , 6 + 12 , 7 @ @ import android . support . v4 . app . FragmentManager ; 
 import android . support . v4 . view . MenuItemCompat ; 
 import android . support . v4 . view . ViewPager ; 
 import android . support . v7 . app . ActionBar ; 
 + import android . support . v7 . app . AlertDialog ; 
 import android . support . v7 . widget . ChatLinearLayoutManager ; 
 import android . support . v7 . widget . RecyclerView ; 
 import android . support . v7 . widget . SearchView ; 
 @ @ - 104 , 7 + 106 , 29 @ @ public class MainPhoneController extends MainBaseController { 
 } 
 
 @ Override 
 - public void onItemClicked ( Dialog item ) { 
 + public void onItemClicked ( final Dialog item ) { 
 + if ( ( sendUriMultiple ! = null & & ! sendUriMultiple . isEmpty ( ) ) | | ( sendUriString ! = null & & ! sendUriString . isEmpty ( ) ) ) { 
 + new AlertDialog . Builder ( getActivity ( ) ) 
 + . setMessage ( getActivity ( ) . getString ( R . string . confirm _ share ) + " " + item . getDialogTitle ( ) + " ? " ) 
 + . setPositiveButton ( R . string . dialog _ ok , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog , int which ) { 
 + openDialog ( item ) ; 
 + } 
 + } ) 
 + . setNegativeButton ( R . string . dialog _ cancel , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog , int which ) { 
 + dialog . dismiss ( ) ; 
 + } 
 + } ) 
 + . show ( ) ; 
 + } else { 
 + openDialog ( item ) ; 
 + } 
 + } 
 + 
 + public void openDialog ( Dialog item ) { 
 startActivity ( Intents . openDialog ( item . getPeer ( ) , false , getActivity ( ) ) . putExtra ( " send _ uri " , sendUriString ) 
 . putExtra ( " send _ uri _ multiple " , sendUriMultiple ) 
 . putExtra ( " send _ text " , sendText ) 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index fe5738b . . 0945edf 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 11 , 8 + 11 , 10 @ @ import android . content . pm . PackageManager ; 
 import android . content . res . Configuration ; 
 import android . database . Cursor ; 
 import android . graphics . PorterDuff ; 
 + import android . media . MediaScannerConnection ; 
 import android . net . Uri ; 
 import android . os . Bundle ; 
 + import android . os . Environment ; 
 import android . provider . ContactsContract ; 
 import android . provider . MediaStore ; 
 import android . support . v4 . app . ActivityCompat ; 
 @ @ - 324 , 14 + 326 , 15 @ @ public class ChatActivity extends ActorEditTextActivity { 
 intent . setType ( " image / * video / * " ) ; 
 startActivityForResult ( intent , REQUEST _ GALLERY ) ; 
 } else if ( item . getId ( ) = = R . id . share _ camera ) { 
 - File externalFile = getExternalFilesDir ( null ) ; 
 + File externalFile = Environment . getExternalStorageDirectory ( ) ; 
 if ( externalFile = = null ) { 
 Toast . makeText ( ChatActivity . this , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; 
 - } 
 - String externalPath = externalFile . getAbsolutePath ( ) ; 
 - new File ( externalPath + " / actor / " ) . mkdirs ( ) ; 
 + } else { 
 + String externalPath = externalFile . getAbsolutePath ( ) ; 
 + new File ( externalPath + " / Actor / capture / " ) . mkdirs ( ) ; 
 
 - pending _ fileName = externalPath + " / actor / capture _ " + Randoms . randomId ( ) + " . jpg " ; 
 + pending _ fileName = externalPath + " / Actor / capture / capture _ " + Randoms . randomId ( ) + " . jpg " ; 
 + } 
 if ( ContextCompat . checkSelfPermission ( ChatActivity . this , Manifest . permission . CAMERA ) ! = PackageManager . PERMISSION _ GRANTED ) { 
 Log . d ( " Permissions " , " camera - no permission : c " ) ; 
 ActivityCompat . requestPermissions ( ChatActivity . this , 
 @ @ - 343 , 18 + 346 , 19 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 } else if ( item . getId ( ) = = R . id . share _ video ) { 
 
 - File externalFile = getExternalFilesDir ( null ) ; 
 + File externalFile = Environment . getExternalStorageDirectory ( ) ; 
 if ( externalFile = = null ) { 
 Toast . makeText ( ChatActivity . this , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; 
 - } 
 - String externalPath = externalFile . getAbsolutePath ( ) ; 
 - new File ( externalPath + " / actor / " ) . mkdirs ( ) ; 
 + } else { 
 + String externalPath = externalFile . getAbsolutePath ( ) ; 
 + new File ( externalPath + " / Actor / capture / " ) . mkdirs ( ) ; 
 
 - pending _ fileName = externalPath + " / actor / capture _ " + Randoms . randomId ( ) + " . mp4 " ; 
 + pending _ fileName = externalPath + " / Actor / capture / capture _ " + Randoms . randomId ( ) + " . mp4 " ; 
 
 - Intent i = new Intent ( MediaStore . ACTION _ VIDEO _ CAPTURE ) 
 - . putExtra ( MediaStore . EXTRA _ OUTPUT , Uri . fromFile ( new File ( pending _ fileName ) ) ) ; 
 - startActivityForResult ( i , REQUEST _ VIDEO ) ; 
 + Intent i = new Intent ( MediaStore . ACTION _ VIDEO _ CAPTURE ) 
 + . putExtra ( MediaStore . EXTRA _ OUTPUT , Uri . fromFile ( new File ( pending _ fileName ) ) ) ; 
 + startActivityForResult ( i , REQUEST _ VIDEO ) ; 
 + } 
 } else if ( item . getId ( ) = = R . id . share _ file ) { 
 startActivityForResult ( Intents . pickFile ( ChatActivity . this ) , REQUEST _ DOC ) ; 
 } else if ( item . getId ( ) = = R . id . share _ location ) { 
 @ @ - 810 , 8 + 814 , 10 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 } else if ( requestCode = = REQUEST _ PHOTO ) { 
 messenger ( ) . sendPhoto ( peer , pending _ fileName ) ; 
 + MediaScannerConnection . scanFile ( this , new String [ ] { pending _ fileName } , new String [ ] { " image / jpeg " } , null ) ; 
 } else if ( requestCode = = REQUEST _ VIDEO ) { 
 messenger ( ) . sendVideo ( peer , pending _ fileName ) ; 
 + MediaScannerConnection . scanFile ( this , new String [ ] { pending _ fileName } , new String [ ] { " image / jpeg " } , null ) ; 
 } else if ( requestCode = = REQUEST _ DOC ) { 
 if ( data . getData ( ) ! = null ) { 
 execute ( messenger ( ) . sendUri ( peer , data . getData ( ) ) , R . string . pick _ downloading ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java 
 index d5a7a04 . . b1b37a5 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / preview / PictureActivity . java 
 @ @ - 5 , 8 + 5 , 12 @ @ import android . animation . AnimatorListenerAdapter ; 
 import android . app . Activity ; 
 import android . content . Intent ; 
 import android . graphics . Bitmap ; 
 + import android . media . MediaScannerConnection ; 
 + import android . net . Uri ; 
 import android . os . Build ; 
 import android . os . Bundle ; 
 + import android . os . Environment ; 
 + import android . provider . MediaStore ; 
 import android . support . v4 . app . Fragment ; 
 import android . support . v7 . app . ActionBar ; 
 import android . support . v7 . widget . Toolbar ; 
 @ @ - 19 , 12 + 23 , 18 @ @ import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . ImageView ; 
 import android . widget . TextView ; 
 + import android . widget . Toast ; 
 
 import com . droidkit . progress . CircularView ; 
 
 + import java . io . File ; 
 + import java . io . IOException ; 
 + 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseActivity ; 
 + import im . actor . sdk . util . Files ; 
 + import im . actor . sdk . util . Randoms ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . util . images . common . ImageLoadException ; 
 import im . actor . sdk . util . images . ops . ImageLoading ; 
 @ @ - 463 , 25 + 473 , 24 @ @ public class PictureActivity extends BaseActivity { 
 . putExtra ( Intent . EXTRA _ STREAM , Uri . parse ( path ) ) ) ; * / 
 return true ; 
 } else if ( item . getItemId ( ) = = R . id . save ) { 
 - / / getImageLoader ( ) . createReceiver ( new ReceiverCallback ( ) { 
 - / / @ Override 
 - / / public void onImageLoaded ( BitmapReference bitmap ) { 
 - / / Intents . savePicture ( getActivity ( ) , bitmap . getBitmap ( ) ) ; 
 - / / } 
 - / / 
 - / / @ Override 
 - / / public void onImageCleared ( ) { 
 - / / 
 - / / } 
 - / / 
 - / / @ Override 
 - / / public void onImageError ( ) { 
 - / / 
 - / / } 
 - / / } ) . request ( new RawFileTask ( path ) ) ; 
 + File externalFile = Environment . getExternalStorageDirectory ( ) ; 
 + if ( externalFile = = null ) { 
 + Toast . makeText ( getActivity ( ) , R . string . toast _ no _ sdcard , Toast . LENGTH _ LONG ) . show ( ) ; 
 + } else { 
 + String externalPath = externalFile . getAbsolutePath ( ) ; 
 + new File ( externalPath + " / Actor / exported / " ) . mkdirs ( ) ; 
 + try { 
 + String exportPath = externalPath + " / Actor / exported / " + ( fileName ! = null ? fileName : " exported " ) + " _ " + Randoms . randomId ( ) + " . jpg " ; 
 + Files . copy ( new File ( this . path ) , new File ( exportPath ) ) ; 
 + MediaScannerConnection . scanFile ( getActivity ( ) , new String [ ] { exportPath } , new String [ ] { " image / jpeg " } , null ) ; 
 + Toast . makeText ( getActivity ( ) , getString ( R . string . file _ saved ) + " " + exportPath , Toast . LENGTH _ LONG ) . show ( ) ; 
 + item . setEnabled ( false ) ; 
 + item . setTitle ( R . string . menu _ saved ) ; 
 + } catch ( IOException e ) { 
 + e . printStackTrace ( ) ; 
 + } 
 + } 
 
 - item . setEnabled ( false ) ; 
 - item . setTitle ( R . string . menu _ saved ) ; 
 
 return true ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java 
 index ee34e6e . . 3036111 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / Files . java 
 @ @ - 1 , 6 + 1 , 11 @ @ 
 package im . actor . sdk . util ; 
 
 import java . io . File ; 
 + import java . io . FileInputStream ; 
 + import java . io . FileOutputStream ; 
 + import java . io . IOException ; 
 + import java . io . InputStream ; 
 + import java . io . OutputStream ; 
 
 import im . actor . runtime . android . AndroidContext ; 
 
 @ @ - 37 , 4 + 42 , 17 @ @ public class Files { 
 File outputFile = new File ( dest , prefix + " _ " + Randoms . randomId ( ) + " " + postfix ) ; 
 return outputFile . getAbsolutePath ( ) ; 
 } 
 + 
 + public static void copy ( File src , File dst ) throws IOException { 
 + InputStream in = new FileInputStream ( src ) ; 
 + OutputStream out = new FileOutputStream ( dst ) ; 
 + 
 + byte [ ] buf = new byte [ 1024 ] ; 
 + int len ; 
 + while ( ( len = in . read ( buf ) ) > 0 ) { 
 + out . write ( buf , 0 , len ) ; 
 + } 
 + in . close ( ) ; 
 + out . close ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index c8eea5c . . 42e4042 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 365 , 6 + 365 , 8 @ @ 
 < ! - - Documents - - > 
 < string name = " documents _ title " > Д о к у м е н т ы < / string > 
 < string name = " documents _ empty " > Е щ е н е т д о к у м е н т о в < / string > 
 + < string name = " file _ saved " > Ф а й л с о х р а н е н : < / string > 
 + 
 
 < ! - - Edit name - - > 
 < string name = " edit _ name _ title _ you " > В в е д и т е В а ш е и м я < / string > 
 @ @ - 472 , 4 + 474 , 5 @ @ 
 < string name = " error _ unknown " > Н е в о з м о ж н о п р о и з в е с т и о п е р а ц и ю . \ n \ n П о ж а л у й с т а , п р о в е р ь т е с в о й т е л е ф о н и в ы к л ю ч и т е и в к л ю ч и т е е г о , е с л и п р о б л е м а н е б у д е т р е ш е н а . 
 < / string > 
 < string name = " error _ view _ url " > Н е и з в е с т н ы й т и п с с ы л к и < / string > 
 + < string name = " confirm _ share " > П о д е л и т ь с я с < / string > 
 < / resources > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 0ac8749 . . 6b782e0 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 370 , 6 + 370 , 7 @ @ 
 < ! - - Documents - - > 
 < string name = " documents _ title " > Documents < / string > 
 < string name = " documents _ empty " > No documents yet < / string > 
 + < string name = " file _ saved " > File saved : < / string > 
 
 < ! - - Edit name - - > 
 < string name = " edit _ name _ title _ you " > Enter your name < / string > 
 @ @ - 498 , 4 + 499 , 5 @ @ 
 < string name = " notification _ multiple _ canversations _ after _ msg _ count " > " messages in " < / string > 
 < string name = " notifications _ multiple _ canversations _ after _ coversations _ count " > " chats " < / string > 
 < string name = " notifications _ single _ conversation _ а fter _ messages _ count " > " messages " < / string > 
 + < string name = " confirm _ share " > Share with < / string > 
 < / resources > 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 7b89f42 . . 1a6196a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 } 
 } 
 + super . onActivityResult ( requestCode , resultCode , data ) ; 
 } 
 
 / / Mentions 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 index d8717e9 . . e177ecd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 @ @ - 1 , 16 + 1 , 19 @ @ 
 package im . actor . sdk . controllers . conversation . view ; 
 
 import android . content . Context ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Canvas ; 
 import android . graphics . drawable . Drawable ; 
 import android . util . AttributeSet ; 
 import android . view . View ; 
 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 
 public class ChatBackgroundView extends View { 
 
 private Drawable background ; 
 + SharedPreferences shp ; 
 
 public ChatBackgroundView ( Context context ) { 
 super ( context ) ; 
 @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { 
 
 public void bind ( ) { 
 if ( background = = null ) { 
 - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; 
 + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; 
 } 
 + 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 index b88785e . . 50d64ca 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { 
 ViewUtils . showView ( view , isAnimated , isSlow ) ; 
 } 
 
 + public void elevateView ( View view ) { 
 + ViewUtils . elevateView ( view ) ; 
 + } 
 + 
 + public void elevateView ( final View view , boolean isAnimated ) { 
 + ViewUtils . elevateView ( view , isAnimated ) ; 
 + } 
 + 
 + public void demoteView ( View view ) { 
 + ViewUtils . demoteView ( view ) ; 
 + } 
 + 
 + public void demoteView ( final View view , boolean isAnimated ) { 
 + ViewUtils . demoteView ( view , isAnimated ) ; 
 + } 
 + 
 + 
 public void onClick ( View view , int id , final View . OnClickListener listener ) { 
 onClick ( view . findViewById ( id ) , listener ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 index 04e80fd . . 8eba614 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { 
 nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; 
 tintImageView . setVisibility ( View . INVISIBLE ) ; 
 - String value = nick ; 
 + String value = " @ " . concat ( nick ) ; 
 String title = getString ( R . string . nickname ) ; 
 recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; 
 ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 index a659507 . . d70cba7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; 
 import android . content . Context ; 
 import android . content . DialogInterface ; 
 import android . content . Intent ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . net . Uri ; 
 @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; 
 import im . actor . sdk . controllers . fragment . help . HelpActivity ; 
 import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 import im . actor . sdk . view . TintImageView ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 private int baseColor ; 
 private CoverAvatarView avatarView ; 
 + SharedPreferences shp ; 
 + SharedPreferences . Editor ed ; 
 
 @ Override 
 public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; 
 + 
 + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + ed = shp . edit ( ) ; 
 + 
 baseColor = getResources ( ) . getColor ( R . color . primary ) ; 
 final ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 final UserVM userModel = users ( ) . get ( myUid ( ) ) ; 
 @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; 
 
 + / / Wallpaper 
 + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; 
 + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; 
 + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; 
 + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + final View [ ] elevated = new View [ ] { null } ; 
 + View . OnClickListener ocl = new View . OnClickListener ( ) { 
 + 
 + @ Override 
 + public void onClick ( final View v ) { 
 + if ( v ! = elevated [ 0 ] ) { 
 + if ( elevated [ 0 ] ! = null ) { 
 + demoteView ( elevated [ 0 ] ) ; 
 + } 
 + elevated [ 0 ] = v ; 
 + elevateView ( v ) ; 
 + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; 
 + ed . commit ( ) ; 
 + } 
 + } 
 + } ; 
 + for ( int i = 0 ; i < 4 ; i + + ) { 
 + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; 
 + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; 
 + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; 
 + bckgrnd . bind ( i ) ; 
 + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; 
 + frame . setTag ( i ) ; 
 + frame . setOnClickListener ( ocl ) ; 
 + frame . addView ( bckgrnd ) ; 
 + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; 
 + 
 + if ( i = = selectedWallpaper ) { 
 + elevateView ( frame , false ) ; 
 + elevated [ 0 ] = frame ; 
 + } 
 + } 
 + 
 view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 index 43b6b07 . . 81b27d3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; 
 import android . view . View ; 
 import android . view . animation . AlphaAnimation ; 
 import android . view . animation . Animation ; 
 + import android . view . animation . ScaleAnimation ; 
 import android . view . animation . Transformation ; 
 import android . widget . AbsListView ; 
 
 @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { 
 
 
 } 
 + 
 + public static void elevateView ( final View view ) { 
 + elevateView ( view , true ) ; 
 + } 
 + 
 + public static void elevateView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + 
 + } 
 + 
 + public static void demoteView ( final View view ) { 
 + demoteView ( view , true ) ; 
 + } 
 + 
 + public static void demoteView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + if ( isAnimated ) { 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + } 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 new file mode 100644 
 index 0000000 . . fb7ae5c 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 @ @ - 0 , 0 + 1 , 79 @ @ 
 + package im . actor . sdk . view ; 
 + 
 + import android . content . Context ; 
 + import android . net . Uri ; 
 + import android . util . AttributeSet ; 
 + 
 + import com . facebook . common . util . UriUtil ; 
 + import com . facebook . drawee . backends . pipeline . Fresco ; 
 + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchy ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; 
 + import com . facebook . drawee . view . SimpleDraweeView ; 
 + import com . facebook . imagepipeline . common . ResizeOptions ; 
 + import com . facebook . imagepipeline . request . ImageRequest ; 
 + import com . facebook . imagepipeline . request . ImageRequestBuilder ; 
 + 
 + import im . actor . sdk . R ; 
 + 
 + public class BackgroundPreviewView extends SimpleDraweeView { 
 + 
 + private int width ; 
 + private int height ; 
 + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; 
 + 
 + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { 
 + super ( context , hierarchy ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context ) { 
 + super ( context ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { 
 + super ( context , attrs ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { 
 + super ( context , attrs , defStyle ) ; 
 + } 
 + 
 + public void init ( int width , int height ) { 
 + this . width = width ; 
 + this . height = height ; 
 + 
 + GenericDraweeHierarchyBuilder builder = 
 + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; 
 + 
 + GenericDraweeHierarchy hierarchy = builder 
 + . setFadeDuration ( 200 ) 
 + . build ( ) ; 
 + setHierarchy ( hierarchy ) ; 
 + } 
 + 
 + public void bind ( int i ) { 
 + int bkgrnd = getBackground ( i ) ; 
 + Uri uri = new Uri . Builder ( ) 
 + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) 
 + . path ( String . valueOf ( bkgrnd ) ) 
 + . build ( ) ; 
 + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 + . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 + . build ( ) ; 
 + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 + . setOldController ( getController ( ) ) 
 + . setImageRequest ( request ) 
 + . build ( ) ; 
 + setController ( controller ) ; 
 + 
 + } 
 + 
 + 
 + public static int getBackground ( int i ) { 
 + if ( i > = 0 & & BACKGROUNDS . length > i ) { 
 + return BACKGROUNDS [ i ] ; 
 + } else { 
 + return R . drawable . img _ chat _ background _ default ; 
 + } 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 index fa384b2 . . f688b72 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 @ @ - 282 , 6 + 282 , 56 @ @ 
 < / LinearLayout > 
 
 < FrameLayout 
 + android : id = " @ + id / wallpaperDivider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 16dp " 
 + android : background = " @ color / bg _ backyard " > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : background = " @ drawable / card _ shadow _ bottom " / > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 1dp " 
 + android : layout _ gravity = " bottom " 
 + android : background = " @ drawable / card _ shadow _ top " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / settings _ wallpaper _ title " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : gravity = " center _ vertical | left " 
 + android : paddingLeft = " 72dp " 
 + android : text = " @ string / wallpaper " 
 + android : textSize = " 16sp " / > 
 + 
 + < HorizontalScrollView 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : requiresFadingEdge = " none " 
 + android : scrollbars = " none " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / background _ container " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " horizontal " > 
 + 
 + < View 
 + android : layout _ width = " 72dp " 
 + android : layout _ height = " 200dp " 
 + android : background = " @ android : color / transparent " / > 
 + 
 + 
 + < / LinearLayout > 
 + < / HorizontalScrollView > 
 + 
 + 
 + < FrameLayout 
 android : id = " @ + id / settings _ bottom _ container " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " / > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 3c3350b . . 9ad8001 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 153 , 6 + 153 , 7 @ @ 
 < string name = " nickname _ change " > И з м е н и т ь н и к < / string > 
 < string name = " about _ user _ me " > О б о м н е < / string > 
 < string name = " about _ user " > О п о л ь з о в а т е л е < / string > 
 + < string name = " wallpaper " > О б о и < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 2270a93 . . 3a7761d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 157 , 6 + 157 , 7 @ @ 
 < string name = " nickname _ edittext _ hint " > Enter your Username < / string > 
 < string name = " about _ user _ me " > About me < / string > 
 < string name = " about _ user " > About user < / string > 
 + < string name = " wallpaper " > Wallpaper < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > Call { 0 } < / string >
