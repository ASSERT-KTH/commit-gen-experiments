BLEU SCORE: 0.2172185626567896

TEST MSG: fix ( server ) : reorder group delete updates
GENERATED MSG: fix ( server : groups ) : group deletion updates

TEST DIFF (one line): diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > index 5f750cb . . c96ef7e 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > @ @ - 320 , 20 + 320 , 17 @ @ private [ group ] trait AdminCommandHandlers extends GroupsImplicits { < nl > val randomId = ACLUtils . randomLong ( ) < nl > val ZeroPermissions = 0L < nl > < nl > - val emptyPermissions = Vector ( < nl > - UpdateGroupPermissionsChanged ( groupId , ZeroPermissions ) , < nl > - UpdateGroupFullPermissionsChanged ( groupId , ZeroPermissions ) < nl > - ) < nl > - < nl > - val deleteGroupMembersUpdates : Vector [ Update ] = emptyPermissions + + < nl > + val deleteGroupMembersUpdates : Vector [ Update ] = < nl > Vector ( < nl > UpdateGroupMemberChanged ( groupId , isMember = false ) , < nl > - UpdateGroupDeleted ( groupId ) , < nl > / / if channel , or group is big enough < nl > - if ( exGroupType . isChannel ) < nl > + ( if ( exGroupType . isChannel ) < nl > UpdateGroupMembersCountChanged ( groupId , membersCount = 0 ) < nl > else < nl > - UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) < nl > + UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) ) , < nl > + UpdateGroupPermissionsChanged ( groupId , ZeroPermissions ) , < nl > + UpdateGroupFullPermissionsChanged ( groupId , ZeroPermissions ) , < nl > + UpdateGroupDeleted ( groupId ) < nl > ) < nl > < nl > / / TODO : remove deprecated . GroupInviteTokenRepo don ' t have replacement yet .
NEAREST DIFF (one line): diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala < nl > index eaae17e . . 090a6d0 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala < nl > @ @ - 270 , 7 + 270 , 6 @ @ private class DialogRoot ( val userId : Int , extensions : Seq [ ApiExtension ] ) < nl > } < nl > < nl > private def sendChatGroupsChanged ( authId : Long ) : Future [ SeqState ] = { < nl > - val pushRules = if ( authId = = 0L ) PushRules ( ) else PushRules ( ) . withExcludeAuthIds ( Seq ( authId ) ) < nl > for { < nl > groups ← DialogExtension ( system ) . fetchApiGroupedDialogs ( userId ) < nl > update = UpdateChatGroupsChanged ( groups ) < nl > @ @ - 278 , 7 + 277 , 6 @ @ private class DialogRoot ( val userId : Int , extensions : Seq [ ApiExtension ] ) < nl > userId , < nl > authId , < nl > update , < nl > - pushRules , < nl > reduceKey = Some ( s " dialogschanged _ $ { userId } " ) < nl > ) < nl > } yield seqState < nl > diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > index 8254b34 . . 5f750cb 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala < nl > @ @ - 328 , 12 + 328 , 12 @ @ private [ group ] trait AdminCommandHandlers extends GroupsImplicits { < nl > val deleteGroupMembersUpdates : Vector [ Update ] = emptyPermissions + + < nl > Vector ( < nl > UpdateGroupMemberChanged ( groupId , isMember = false ) , < nl > + UpdateGroupDeleted ( groupId ) , < nl > / / if channel , or group is big enough < nl > if ( exGroupType . isChannel ) < nl > UpdateGroupMembersCountChanged ( groupId , membersCount = 0 ) < nl > else < nl > - UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) , < nl > - UpdateGroupDeleted ( groupId ) < nl > + UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) < nl > ) < nl > < nl > / / TODO : remove deprecated . GroupInviteTokenRepo don ' t have replacement yet .

TEST DIFF:
diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 index 5f750cb . . c96ef7e 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 @ @ - 320 , 20 + 320 , 17 @ @ private [ group ] trait AdminCommandHandlers extends GroupsImplicits { 
 val randomId = ACLUtils . randomLong ( ) 
 val ZeroPermissions = 0L 
 
 - val emptyPermissions = Vector ( 
 - UpdateGroupPermissionsChanged ( groupId , ZeroPermissions ) , 
 - UpdateGroupFullPermissionsChanged ( groupId , ZeroPermissions ) 
 - ) 
 - 
 - val deleteGroupMembersUpdates : Vector [ Update ] = emptyPermissions + + 
 + val deleteGroupMembersUpdates : Vector [ Update ] = 
 Vector ( 
 UpdateGroupMemberChanged ( groupId , isMember = false ) , 
 - UpdateGroupDeleted ( groupId ) , 
 / / if channel , or group is big enough 
 - if ( exGroupType . isChannel ) 
 + ( if ( exGroupType . isChannel ) 
 UpdateGroupMembersCountChanged ( groupId , membersCount = 0 ) 
 else 
 - UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) 
 + UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) ) , 
 + UpdateGroupPermissionsChanged ( groupId , ZeroPermissions ) , 
 + UpdateGroupFullPermissionsChanged ( groupId , ZeroPermissions ) , 
 + UpdateGroupDeleted ( groupId ) 
 ) 
 
 / / TODO : remove deprecated . GroupInviteTokenRepo don ' t have replacement yet .

NEAREST DIFF:
diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala 
 index eaae17e . . 090a6d0 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / dialog / DialogRoot . scala 
 @ @ - 270 , 7 + 270 , 6 @ @ private class DialogRoot ( val userId : Int , extensions : Seq [ ApiExtension ] ) 
 } 
 
 private def sendChatGroupsChanged ( authId : Long ) : Future [ SeqState ] = { 
 - val pushRules = if ( authId = = 0L ) PushRules ( ) else PushRules ( ) . withExcludeAuthIds ( Seq ( authId ) ) 
 for { 
 groups ← DialogExtension ( system ) . fetchApiGroupedDialogs ( userId ) 
 update = UpdateChatGroupsChanged ( groups ) 
 @ @ - 278 , 7 + 277 , 6 @ @ private class DialogRoot ( val userId : Int , extensions : Seq [ ApiExtension ] ) 
 userId , 
 authId , 
 update , 
 - pushRules , 
 reduceKey = Some ( s " dialogschanged _ $ { userId } " ) 
 ) 
 } yield seqState 
 diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 index 8254b34 . . 5f750cb 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / group / AdminCommandHandlers . scala 
 @ @ - 328 , 12 + 328 , 12 @ @ private [ group ] trait AdminCommandHandlers extends GroupsImplicits { 
 val deleteGroupMembersUpdates : Vector [ Update ] = emptyPermissions + + 
 Vector ( 
 UpdateGroupMemberChanged ( groupId , isMember = false ) , 
 + UpdateGroupDeleted ( groupId ) , 
 / / if channel , or group is big enough 
 if ( exGroupType . isChannel ) 
 UpdateGroupMembersCountChanged ( groupId , membersCount = 0 ) 
 else 
 - UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) , 
 - UpdateGroupDeleted ( groupId ) 
 + UpdateGroupMembersUpdated ( groupId , members = Vector . empty ) 
 ) 
 
 / / TODO : remove deprecated . GroupInviteTokenRepo don ' t have replacement yet .
