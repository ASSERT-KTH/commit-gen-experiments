BLEU SCORE: 0.07495553473355841

TEST MSG: perf ( android ) : Micro optimizations of Android for slow devices
GENERATED MSG: feat ( runtime ) : Implemented WakeLock support

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java < nl > index 4a37277 . . 66986e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java < nl > @ @ - 69 , 7 + 69 , 10 @ @ public abstract class DisplayListFragment < T extends BserObject & ListEngineItem , < nl > < nl > protected void configureRecyclerView ( RecyclerView recyclerView ) { < nl > recyclerView . setHasFixedSize ( true ) ; < nl > - recyclerView . setLayoutManager ( new LinearLayoutManager ( getActivity ( ) ) ) ; < nl > + LinearLayoutManager linearLayoutManager = new LinearLayoutManager ( getActivity ( ) ) ; < nl > + linearLayoutManager . setRecycleChildrenOnDetach ( false ) ; < nl > + linearLayoutManager . setSmoothScrollbarEnabled ( false ) ; < nl > + recyclerView . setLayoutManager ( linearLayoutManager ) ; < nl > recyclerView . setHorizontalScrollBarEnabled ( false ) ; < nl > recyclerView . setVerticalScrollBarEnabled ( true ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java < nl > index c48f90f . . 673fba4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java < nl > @ @ - 102 , 12 + 102 , 16 @ @ public class DialogView extends ListItemBackgroundView < Dialog , DialogView . Dialog < nl > . setFadeDuration ( 0 ) < nl > . setRoundingParams ( new RoundingParams ( ) < nl > . setRoundAsCircle ( true ) < nl > - . setRoundingMethod ( RoundingParams . RoundingMethod . BITMAP _ ONLY ) ) < nl > + . setRoundingMethod ( RoundingParams . RoundingMethod . OVERLAY _ COLOR ) < nl > + . setOverlayColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ) < nl > . build ( ) ; < nl > draweeHolder = DraweeHolder . create ( hierarchy , getContext ( ) ) ; < nl > draweeHolder . getTopLevelDrawable ( ) . setCallback ( this ) ; < nl > + < nl > setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 72 ) ) ) ; < nl > setDividerPaddingLeft ( Screen . dp ( 72 ) ) ; < nl > + < nl > + / / setLayerType ( LAYER _ TYPE _ HARDWARE , null ) ; < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java < nl > index 5a0c0ab . . 0603172 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java < nl > @ @ - 1 , 11 + 1 , 22 @ @ < nl > package im . actor . sdk . view ; < nl > < nl > + import android . os . Handler ; < nl > + import android . os . HandlerThread ; < nl > + < nl > import im . actor . runtime . Runtime ; < nl > import im . actor . runtime . function . Cancellable ; < nl > import im . actor . runtime . function . CancellableSimple ; < nl > < nl > public class ViewAsyncDispatch { < nl > < nl > + private static final HandlerThread THREAD = new HandlerThread ( " async _ view " ) ; < nl > + private static final Handler HANDLER ; < nl > + < nl > + static { < nl > + THREAD . start ( ) ; < nl > + HANDLER = new Handler ( THREAD . getLooper ( ) ) ; < nl > + } < nl > + < nl > private ThreadLocal < Cancellable > currentCancellable = new ThreadLocal < > ( ) ; < nl > < nl > public Cancellable dispatch ( Runnable runnable ) { < nl > @ @ - 15 , 7 + 26 , 7 @ @ public class ViewAsyncDispatch { < nl > } < nl > < nl > public void dispatch ( Cancellable cancellable , Runnable runnable ) { < nl > - Runtime . dispatch ( ( ) - > { < nl > + HANDLER . post ( ( ) - > { < nl > if ( cancellable . isCancelled ( ) ) { < nl > return ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java < nl > index 4c4b6ea . . c8c81e1 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java < nl > @ @ - 4 , 8 + 4 , 14 @ @ < nl > < nl > package im . actor . runtime . android ; < nl > < nl > + import im . actor . runtime . android . crypto . AndroidSHA256 ; < nl > + import im . actor . runtime . crypto . Digest ; < nl > import im . actor . runtime . generic . GenericCryptoProvider ; < nl > < nl > public class AndroidCryptoProvider extends GenericCryptoProvider { < nl > < nl > + @ Override < nl > + public Digest SHA256 ( ) { < nl > + return new AndroidSHA256 ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java < nl > index b8fa3b8 . . 09a0dbc 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java < nl > @ @ - 4 , 14 + 4 , 13 @ @ < nl > < nl > package im . actor . runtime . android ; < nl > < nl > - import java . util . concurrent . Executor ; < nl > - import java . util . concurrent . Executors ; < nl > - < nl > import im . actor . runtime . DispatcherRuntime ; < nl > + import im . actor . runtime . actors . ThreadPriority ; < nl > + import im . actor . runtime . android . threading . AndroidImmediateDispatcher ; < nl > < nl > public class AndroidDispatcherProvider implements DispatcherRuntime { < nl > < nl > - private Executor EXECUTOR ; < nl > + private AndroidImmediateDispatcher dispatcher ; < nl > < nl > public AndroidDispatcherProvider ( ) { < nl > < nl > @ @ - 19 , 9 + 18 , 9 @ @ public class AndroidDispatcherProvider implements DispatcherRuntime { < nl > < nl > @ Override < nl > public synchronized void dispatch ( Runnable runnable ) { < nl > - if ( EXECUTOR = = null ) { < nl > - EXECUTOR = Executors . newSingleThreadExecutor ( ) ; < nl > + if ( dispatcher = = null ) { < nl > + dispatcher = new AndroidImmediateDispatcher ( " callback _ dispatcher " , ThreadPriority . LOW ) ; < nl > } < nl > - EXECUTOR . execute ( runnable ) ; < nl > + dispatcher . dispatchNow ( runnable ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java < nl > index 0e4a068 . . 4178095 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java < nl > @ @ - 13 , 6 + 13 , 7 @ @ import android . content . SharedPreferences ; < nl > import im . actor . runtime . Runtime ; < nl > import im . actor . runtime . actors . ThreadPriority ; < nl > import im . actor . runtime . android . threading . AndroidDispatcher ; < nl > + import im . actor . runtime . android . threading . AndroidImmediateDispatcher ; < nl > import im . actor . runtime . android . time . SntpClient ; < nl > import im . actor . runtime . generic . GenericThreadingProvider ; < nl > import im . actor . runtime . Log ; < nl > @ @ - 75 , 4 + 76 , 9 @ @ public class AndroidThreadingProvider extends GenericThreadingProvider { < nl > public Dispatcher createDispatcher ( String name ) { < nl > return new AndroidDispatcher ( name ) ; < nl > } < nl > + < nl > + @ Override < nl > + public ImmediateDispatcher createImmediateDispatcher ( String name , ThreadPriority priority ) { < nl > + return new AndroidImmediateDispatcher ( name , priority ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java < nl > new file mode 100644 < nl > index 0000000 . . 3234d24 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java < nl > @ @ - 0 , 0 + 1 , 44 @ @ < nl > + package im . actor . runtime . android . crypto ; < nl > + < nl > + import java . security . DigestException ; < nl > + import java . security . MessageDigest ; < nl > + import java . security . NoSuchAlgorithmException ; < nl > + < nl > + import im . actor . runtime . crypto . Digest ; < nl > + < nl > + public class AndroidSHA256 implements Digest { < nl > + < nl > + private MessageDigest messageDigest ; < nl > + < nl > + public AndroidSHA256 ( ) { < nl > + try { < nl > + messageDigest = MessageDigest . getInstance ( " SHA - 256 " ) ; < nl > + } catch ( NoSuchAlgorithmException e1 ) { < nl > + throw new RuntimeException ( e1 ) ; / / Unexpected < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public void reset ( ) { < nl > + messageDigest . reset ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void update ( byte [ ] src , int offset , int length ) { < nl > + messageDigest . update ( src , offset , length ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void doFinal ( byte [ ] dest , int destOffset ) { < nl > + try { < nl > + messageDigest . digest ( dest , destOffset , 32 ) ; < nl > + } catch ( DigestException e ) { < nl > + throw new RuntimeException ( e ) ; / / Unexpected < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public int getDigestSize ( ) { < nl > + return 32 ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java < nl > new file mode 100644 < nl > index 0000000 . . c3bd255 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java < nl > @ @ - 0 , 0 + 1 , 40 @ @ < nl > + package im . actor . runtime . android . threading ; < nl > + < nl > + import android . os . Handler ; < nl > + import android . os . HandlerThread ; < nl > + < nl > + import im . actor . runtime . actors . ThreadPriority ; < nl > + import im . actor . runtime . threading . ImmediateDispatcher ; < nl > + < nl > + public class AndroidImmediateDispatcher implements ImmediateDispatcher { < nl > + < nl > + private HandlerThread handlerThread ; < nl > + private Handler handler ; < nl > + < nl > + public AndroidImmediateDispatcher ( String name , ThreadPriority priority ) { < nl > + < nl > + handlerThread = new HandlerThread ( name ) ; < nl > + switch ( priority ) { < nl > + case HIGH : < nl > + handlerThread . setPriority ( Thread . MAX _ PRIORITY ) ; < nl > + case LOW : < nl > + handlerThread . setPriority ( Thread . MIN _ PRIORITY ) ; < nl > + default : < nl > + case NORMAL : < nl > + handlerThread . setPriority ( Thread . NORM _ PRIORITY ) ; < nl > + } < nl > + handlerThread . start ( ) ; < nl > + < nl > + / / Wait for Looper ready < nl > + while ( handlerThread . getLooper ( ) = = null ) { < nl > + < nl > + } < nl > + < nl > + handler = new Handler ( handlerThread . getLooper ( ) ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void dispatchNow ( Runnable runnable ) { < nl > + handler . post ( runnable ) ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > index fb5dc32 . . 4ef8c46 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > @ @ - 91 , 7 + 91 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " touchWithIndex : " ) < nl > public void touch ( int index ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > if ( index > = getSize ( ) - loadGap ) { < nl > if ( window . isForwardCompleted ( ) ) { < nl > @ @ - 127 , 7 + 127 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " initEmpty " ) < nl > public void initEmpty ( ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > pendingModifications . clear ( ) ; < nl > mode = ListMode . FORWARD ; < nl > @ @ - 143 , 7 + 143 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " initTopWithRefresh : " ) < nl > public void initTop ( boolean refresh ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > / / Log . d ( TAG , " initTop ( : " + refresh + " ) " ) ; < nl > < nl > @ @ - 186 , 7 + 186 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " initBottomWithRefresh : " ) < nl > public void initBottom ( boolean refresh ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > if ( isGlobalList ) { < nl > throw new RuntimeException ( " Global DisplayList can ' t grow from bottom " ) ; < nl > @ @ - 231 , 7 + 231 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " initCenterWithKey : withRefresh : " ) < nl > public void initCenter ( long centerSortKey , boolean refresh ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > if ( mode ! = null & & mode = = ListMode . CENTER ) { < nl > return ; < nl > @ @ - 273 , 7 + 273 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > @ MainThread < nl > @ ObjectiveCName ( " initSearchWithQuery : withRefresh : " ) < nl > public void initSearch ( String query , boolean refresh ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > if ( isGlobalList ) { < nl > throw new RuntimeException ( " Global DisplayList can ' t perform search " ) ; < nl > @ @ - 324 , 7 + 324 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > < nl > @ MainThread < nl > private void loadMoreForward ( ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > / / Log . d ( TAG , " Requesting loading more . . . " ) ; < nl > < nl > @ @ - 384 , 7 + 384 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > < nl > @ MainThread < nl > private void loadMoreBackward ( ) { < nl > - im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > + / / im . actor . runtime . Runtime . checkMainThread ( ) ; < nl > < nl > if ( isLoadMoreBackwardRequested ) { < nl > return ; < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java < nl > index 831c8aa . . adcdff6 100755 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java < nl > @ @ - 18 , 7 + 18 , 7 @ @ import im . actor . runtime . collections . SparseArray ; < nl > < nl > public final class BserParser { < nl > public static SparseArray < Object > deserialize ( DataInput is ) throws IOException { < nl > - SparseArray < Object > hashMap = new SparseArray < Object > ( ) ; < nl > + SparseArray < Object > hashMap = new SparseArray < > ( ) ; < nl > while ( ! is . isEOF ( ) ) { < nl > long currentTag = is . readVarInt ( ) ; < nl > < nl > @ @ - 46 , 7 + 46 , 7 @ @ public final class BserParser { < nl > if ( hashMap . get ( id ) instanceof List ) { < nl > ( ( List ) hashMap . get ( id ) ) . add ( res ) ; < nl > } else { < nl > - ArrayList < Object > list = new ArrayList < Object > ( ) ; < nl > + ArrayList < Object > list = new ArrayList < > ( ) ; < nl > list . add ( hashMap . get ( id ) ) ; < nl > list . add ( res ) ; < nl > hashMap . put ( id , list ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > index 9e777b1 . . 1f1141b 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj < nl > @ @ - 207 , 6 + 207 , 9 @ @ < nl > 	 	 	 	 	 	 	 com . apple . Maps . iOS = { < nl > 	 	 	 	 	 	 	 	 enabled = 1 ; < nl > 	 	 	 	 	 	 	 } ; < nl > + 	 	 	 	 	 	 	 com . apple . Push = { < nl > + 	 	 	 	 	 	 	 	 enabled = 1 ; < nl > + 	 	 	 	 	 	 	 } ; < nl > 	 	 	 	 	 	 	 com . apple . iCloud = { < nl > 	 	 	 	 	 	 	 	 enabled = 1 ; < nl > 	 	 	 	 	 	 	 } ; < nl > @ @ - 393 , 7 + 396 , 7 @ @ < nl > 	 	 	 	 LIBRARY _ SEARCH _ PATHS = " $ ( inherited ) " ; < nl > 	 	 	 	 ONLY _ ACTIVE _ ARCH = YES ; < nl > 	 	 	 	 OTHER _ LDFLAGS = " $ ( inherited ) " ; < nl > - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; < nl > + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . development ; < nl > 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; < nl > 	 	 	 	 PROVISIONING _ PROFILE = " " ; < nl > 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; < nl > @ @ - 469 , 7 + 472 , 7 @ @ < nl > 	 	 	 	 LD _ RUNPATH _ SEARCH _ PATHS = " $ ( inherited ) @ executable _ path / Frameworks @ loader _ path / Frameworks " ; < nl > 	 	 	 	 LIBRARY _ SEARCH _ PATHS = " $ ( inherited ) " ; < nl > 	 	 	 	 OTHER _ LDFLAGS = " $ ( inherited ) " ; < nl > - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; < nl > + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . development ; < nl > 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; < nl > 	 	 	 	 PROVISIONING _ PROFILE = " " ; < nl > 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist b / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist < nl > index 051f421 . . 5525958 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist 	 < nl > + + + b / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist 	 < nl > @ @ - 71 , 6 + 71 , 7 @ @ < nl > 	 	 < string > audio < / string > < nl > 	 	 < string > fetch < / string > < nl > 	 	 < string > remote - notification < / string > < nl > + 	 	 < string > voip < / string > < nl > 	 < / array > < nl > 	 < key > UILaunchStoryboardName < / key > < nl > 	 < string > Launch Screen < / string > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index db07441 . . e39318a 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 7 , 6 + 7 , 7 @ @ < nl > 	 objects = { < nl > < nl > / * Begin PBXBuildFile section * / < nl > + 	 	 06129AA61C8359FB0099286B / * CocoaLifecycleRuntime . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / ; } ; < nl > 	 	 06230F411BC95BD200A4807B / * RMPhoneFormat . m in Sources * / = { isa = PBXBuildFile ; fileRef = 06230F3F1BC95BD200A4807B / * RMPhoneFormat . m * / ; } ; < nl > 	 	 06230F421BC95BD200A4807B / * RMPhoneFormat . h in Headers * / = { isa = PBXBuildFile ; fileRef = 06230F401BC95BD200A4807B / * RMPhoneFormat . h * / ; settings = { ATTRIBUTES = ( Public , ) ; } ; } ; < nl > 	 	 06230F451BC95C0E00A4807B / * ABPhoneFieldCodes . txt in Resources * / = { isa = PBXBuildFile ; fileRef = 06230F431BC95C0E00A4807B / * ABPhoneFieldCodes . txt * / ; } ; < nl > @ @ - 302 , 6 + 303 , 7 @ @ < nl > / * End PBXBuildFile section * / < nl > < nl > / * Begin PBXFileReference section * / < nl > + 	 	 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = CocoaLifecycleRuntime . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 06230F3F1BC95BD200A4807B / * RMPhoneFormat . m * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . objc ; path = RMPhoneFormat . m ; sourceTree = " < group > " ; } ; < nl > 	 	 06230F401BC95BD200A4807B / * RMPhoneFormat . h * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . h ; path = RMPhoneFormat . h ; sourceTree = " < group > " ; } ; < nl > 	 	 06230F431BC95C0E00A4807B / * ABPhoneFieldCodes . txt * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = text ; path = ABPhoneFieldCodes . txt ; sourceTree = " < group > " ; } ; < nl > @ @ - 772 , 6 + 774 , 7 @ @ < nl > 	 	 	 	 066A51891BC4C383000E606E / * CocoaNetworkRuntime . swift * / , < nl > 	 	 	 	 066A51861BC4C383000E606E / * CocoaStorageRuntime . swift * / , < nl > 	 	 	 	 065A06B51C6CEFE00012EA09 / * CocoaWebRTCRuntime . swift * / , < nl > + 	 	 	 	 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / , < nl > 	 	 	 	 066A51871BC4C383000E606E / * iOSNotificationProvider . swift * / , < nl > 	 	 	 	 066A51881BC4C383000E606E / * iOSPhoneBookProvider . swift * / , < nl > 	 	 	 	 06E322C81C69344A00D66F53 / * iOSCallsProvider . swift * / , < nl > @ @ - 1891 , 6 + 1894 , 7 @ @ < nl > 	 	 	 	 06E7B24C1C0FAB500090660C / * AAMapFastView . swift in Sources * / , < nl > 	 	 	 	 BED5A1F11C48396A0045FDB0 / * NYTPhotoCaptionView . m in Sources * / , < nl > 	 	 	 	 BED5A20F1C4839880045FDB0 / * NSBundle + NYTPhotoViewer . m in Sources * / , < nl > + 	 	 	 	 06129AA61C8359FB0099286B / * CocoaLifecycleRuntime . swift in Sources * / , < nl > 	 	 	 	 066A516D1BC4C366000E606E / * ActorCoreExt . swift in Sources * / , < nl > 	 	 	 	 066A517E1BC4C373000E606E / * FMDatabaseAdditions . m in Sources * / , < nl > 	 	 	 	 066A519A1BC4C390000E606E / * FMDBList . swift in Sources * / , < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > index d65d367 . . a06525d 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift < nl > @ @ - 20 , 5 + 20 , 6 @ @ class AAActorRuntime { < nl > ARCocoaNetworkProxyProvider . setNetworkRuntime ( CocoaNetworkRuntime ( ) ) < nl > ARCocoaAssetsProxyProvider . setAssetsRuntimeWithARAssetsRuntime ( CocoaAssetsRuntime ( ) ) < nl > ARCocoaWebRTCProxyProvider . setWebRTCRuntime ( CocoaWebRTCRuntime ( ) ) < nl > + ARCocoaLifecycleProxyProvider . setLifecycleRuntime ( CocoaLifecycleRuntime ( ) ) < nl > } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift < nl > new file mode 100644 < nl > index 0000000 . . 086cb1a < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift < nl > @ @ - 0 , 0 + 1 , 37 @ @ < nl > + / / < nl > + / / CocoaLifecycleProvider . swift < nl > + / / ActorSDK < nl > + / / < nl > + / / Created by Steve Kite on 28 . 02 . 16 . < nl > + / / Copyright © 2016 Steve Kite . All rights reserved . < nl > + / / < nl > + < nl > + import Foundation < nl > + < nl > + @ objc class CocoaLifecycleRuntime : NSObject , ARLifecycleRuntime { < nl > + < nl > + func killApp ( ) { < nl > + [ ] [ 100 ] < nl > + } < nl > + < nl > + func makeWakeLock ( ) - > ARWakeLock ! { < nl > + return CocoaWakeLock ( ) < nl > + } < nl > + } < nl > + < nl > + @ objc class CocoaWakeLock : NSObject , ARWakeLock { < nl > + < nl > + private var background : UIBackgroundTaskIdentifier ? < nl > + < nl > + override init ( ) { < nl > + background = UIApplication . sharedApplication ( ) . beginBackgroundTaskWithExpirationHandler ( nil ) < nl > + super . init ( ) < nl > + } < nl > + < nl > + func releaseLock ( ) { < nl > + if background ! = nil { < nl > + UIApplication . sharedApplication ( ) . endBackgroundTask ( background ! ) < nl > + background = nil < nl > + } < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java < nl > index d428070 . . 79f1d56 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java < nl > @ @ - 4 , 6 + 4 , 8 @ @ < nl > package im . actor . runtime . android ; < nl > < nl > import im . actor . runtime . LifecycleRuntime ; < nl > + import im . actor . runtime . android . power . AndroidWakeLock ; < nl > + import im . actor . runtime . power . WakeLock ; < nl > < nl > public class AndroidLifecycleProvider implements LifecycleRuntime { < nl > < nl > @ @ - 11 , 4 + 13 , 9 @ @ public class AndroidLifecycleProvider implements LifecycleRuntime { < nl > public void killApp ( ) { < nl > android . os . Process . killProcess ( android . os . Process . myPid ( ) ) ; < nl > } < nl > + < nl > + @ Override < nl > + public WakeLock makeWakeLock ( ) { < nl > + return new AndroidWakeLock ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java < nl > new file mode 100644 < nl > index 0000000 . . dbd0892 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java < nl > @ @ - 0 , 0 + 1 , 11 @ @ < nl > + package im . actor . runtime . android . power ; < nl > + < nl > + import im . actor . runtime . power . WakeLock ; < nl > + < nl > + public class AndroidWakeLock implements WakeLock { < nl > + < nl > + @ Override < nl > + public void releaseLock ( ) { < nl > + / / TODO : Implement < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java < nl > index 8bd4bbc . . 7fb1922 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java < nl > @ @ - 1 , 7 + 1 , 7 @ @ < nl > package im . actor . runtime ; < nl > < nl > - import im . actor . runtime . cocoa . CocoaLifecycleProvider ; < nl > + import im . actor . runtime . cocoa . CocoaLifecycleProxyProvider ; < nl > < nl > - public class LifecycleRuntimeProvider extends CocoaLifecycleProvider { < nl > + public class LifecycleRuntimeProvider extends CocoaLifecycleProxyProvider { < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java < nl > deleted file mode 100644 < nl > index 4088651 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java < nl > + + + / dev / null < nl > @ @ - 1 , 10 + 0 , 0 @ @ < nl > - package im . actor . runtime . cocoa ; < nl > - < nl > - import im . actor . runtime . LifecycleRuntime ; < nl > - < nl > - public class CocoaLifecycleProvider implements LifecycleRuntime { < nl > - @ Override < nl > - public native void killApp ( ) / * - [ < nl > - @ throw NSInternalInconsistencyException ; < nl > - ] - * / ; < nl > - } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java < nl > new file mode 100644 < nl > index 0000000 . . f4bdfea < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java < nl > @ @ - 0 , 0 + 1 , 32 @ @ < nl > + package im . actor . runtime . cocoa ; < nl > + < nl > + import com . google . j2objc . annotations . ObjectiveCName ; < nl > + < nl > + import im . actor . runtime . LifecycleRuntime ; < nl > + import im . actor . runtime . power . WakeLock ; < nl > + < nl > + public class CocoaLifecycleProxyProvider implements LifecycleRuntime { < nl > + < nl > + private static LifecycleRuntime lifecycleRuntime ; < nl > + < nl > + @ ObjectiveCName ( " setLifecycleRuntime : " ) < nl > + public static void setLifecycleRuntime ( LifecycleRuntime lifecycleRuntime ) { < nl > + CocoaLifecycleProxyProvider . lifecycleRuntime = lifecycleRuntime ; < nl > + } < nl > + < nl > + @ Override < nl > + public void killApp ( ) { < nl > + if ( lifecycleRuntime = = null ) { < nl > + throw new RuntimeException ( " Lifecycle Runtime not set ! " ) ; < nl > + } < nl > + lifecycleRuntime . killApp ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public WakeLock makeWakeLock ( ) { < nl > + if ( lifecycleRuntime = = null ) { < nl > + throw new RuntimeException ( " Lifecycle Runtime not set ! " ) ; < nl > + } < nl > + return lifecycleRuntime . makeWakeLock ( ) ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties < nl > index eef5836 . . ae22c4f 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties < nl > @ @ - 20 , 6 + 20 , 8 @ @ im . actor . runtime . crypto . asn1 : AR < nl > im . actor . runtime . crypto . bouncycastle : AR < nl > im . actor . runtime . crypto . encoding : AR < nl > < nl > + im . actor . runtime . power : AR < nl > + < nl > im . actor . runtime . cocoa : AR < nl > < nl > im . actor . runtime . files : AR < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java < nl > index 3bbb095 . . 9089b70 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java < nl > @ @ - 7 , 10 + 7 , 18 @ @ package im . actor . runtime . js ; < nl > import com . google . gwt . user . client . Window ; < nl > < nl > import im . actor . runtime . LifecycleRuntime ; < nl > + import im . actor . runtime . js . power . JsWakeLock ; < nl > + import im . actor . runtime . power . WakeLock ; < nl > < nl > public class JsLifecycleProvider implements LifecycleRuntime { < nl > + < nl > @ Override < nl > public void killApp ( ) { < nl > Window . Location . reload ( ) ; < nl > } < nl > + < nl > + @ Override < nl > + public WakeLock makeWakeLock ( ) { < nl > + return new JsWakeLock ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java < nl > new file mode 100644 < nl > index 0000000 . . d79d2cf < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java < nl > @ @ - 0 , 0 + 1 , 11 @ @ < nl > + package im . actor . runtime . js . power ; < nl > + < nl > + import im . actor . runtime . power . WakeLock ; < nl > + < nl > + public class JsWakeLock implements WakeLock { < nl > + < nl > + @ Override < nl > + public void releaseLock ( ) { < nl > + / / Do nothing as wake lock is not required for js environments < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java < nl > index 77aa331 . . 2f12932 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java < nl > @ @ - 6 , 7 + 6 , 13 @ @ package im . actor . runtime ; < nl > < nl > import com . google . j2objc . annotations . ObjectiveCName ; < nl > < nl > + import im . actor . runtime . power . WakeLock ; < nl > + < nl > public interface LifecycleRuntime { < nl > + < nl > @ ObjectiveCName ( " killApp " ) < nl > void killApp ( ) ; < nl > + < nl > + @ ObjectiveCName ( " makeWakeLock " ) < nl > + WakeLock makeWakeLock ( ) ; < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java < nl > new file mode 100644 < nl > index 0000000 . . bf29d92 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java < nl > @ @ - 0 , 0 + 1 , 9 @ @ < nl > + package im . actor . runtime . power ; < nl > + < nl > + import com . google . j2objc . annotations . ObjectiveCName ; < nl > + < nl > + public interface WakeLock { < nl > + < nl > + @ ObjectiveCName ( " releaseLock " ) < nl > + void releaseLock ( ) ; < nl > + }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java 
 index 4a37277 . . 66986e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / DisplayListFragment . java 
 @ @ - 69 , 7 + 69 , 10 @ @ public abstract class DisplayListFragment < T extends BserObject & ListEngineItem , 
 
 protected void configureRecyclerView ( RecyclerView recyclerView ) { 
 recyclerView . setHasFixedSize ( true ) ; 
 - recyclerView . setLayoutManager ( new LinearLayoutManager ( getActivity ( ) ) ) ; 
 + LinearLayoutManager linearLayoutManager = new LinearLayoutManager ( getActivity ( ) ) ; 
 + linearLayoutManager . setRecycleChildrenOnDetach ( false ) ; 
 + linearLayoutManager . setSmoothScrollbarEnabled ( false ) ; 
 + recyclerView . setLayoutManager ( linearLayoutManager ) ; 
 recyclerView . setHorizontalScrollBarEnabled ( false ) ; 
 recyclerView . setVerticalScrollBarEnabled ( true ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java 
 index c48f90f . . 673fba4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / view / DialogView . java 
 @ @ - 102 , 12 + 102 , 16 @ @ public class DialogView extends ListItemBackgroundView < Dialog , DialogView . Dialog 
 . setFadeDuration ( 0 ) 
 . setRoundingParams ( new RoundingParams ( ) 
 . setRoundAsCircle ( true ) 
 - . setRoundingMethod ( RoundingParams . RoundingMethod . BITMAP _ ONLY ) ) 
 + . setRoundingMethod ( RoundingParams . RoundingMethod . OVERLAY _ COLOR ) 
 + . setOverlayColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ) 
 . build ( ) ; 
 draweeHolder = DraweeHolder . create ( hierarchy , getContext ( ) ) ; 
 draweeHolder . getTopLevelDrawable ( ) . setCallback ( this ) ; 
 + 
 setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 72 ) ) ) ; 
 setDividerPaddingLeft ( Screen . dp ( 72 ) ) ; 
 + 
 + / / setLayerType ( LAYER _ TYPE _ HARDWARE , null ) ; 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java 
 index 5a0c0ab . . 0603172 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ViewAsyncDispatch . java 
 @ @ - 1 , 11 + 1 , 22 @ @ 
 package im . actor . sdk . view ; 
 
 + import android . os . Handler ; 
 + import android . os . HandlerThread ; 
 + 
 import im . actor . runtime . Runtime ; 
 import im . actor . runtime . function . Cancellable ; 
 import im . actor . runtime . function . CancellableSimple ; 
 
 public class ViewAsyncDispatch { 
 
 + private static final HandlerThread THREAD = new HandlerThread ( " async _ view " ) ; 
 + private static final Handler HANDLER ; 
 + 
 + static { 
 + THREAD . start ( ) ; 
 + HANDLER = new Handler ( THREAD . getLooper ( ) ) ; 
 + } 
 + 
 private ThreadLocal < Cancellable > currentCancellable = new ThreadLocal < > ( ) ; 
 
 public Cancellable dispatch ( Runnable runnable ) { 
 @ @ - 15 , 7 + 26 , 7 @ @ public class ViewAsyncDispatch { 
 } 
 
 public void dispatch ( Cancellable cancellable , Runnable runnable ) { 
 - Runtime . dispatch ( ( ) - > { 
 + HANDLER . post ( ( ) - > { 
 if ( cancellable . isCancelled ( ) ) { 
 return ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java 
 index 4c4b6ea . . c8c81e1 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidCryptoProvider . java 
 @ @ - 4 , 8 + 4 , 14 @ @ 
 
 package im . actor . runtime . android ; 
 
 + import im . actor . runtime . android . crypto . AndroidSHA256 ; 
 + import im . actor . runtime . crypto . Digest ; 
 import im . actor . runtime . generic . GenericCryptoProvider ; 
 
 public class AndroidCryptoProvider extends GenericCryptoProvider { 
 
 + @ Override 
 + public Digest SHA256 ( ) { 
 + return new AndroidSHA256 ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java 
 index b8fa3b8 . . 09a0dbc 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidDispatcherProvider . java 
 @ @ - 4 , 14 + 4 , 13 @ @ 
 
 package im . actor . runtime . android ; 
 
 - import java . util . concurrent . Executor ; 
 - import java . util . concurrent . Executors ; 
 - 
 import im . actor . runtime . DispatcherRuntime ; 
 + import im . actor . runtime . actors . ThreadPriority ; 
 + import im . actor . runtime . android . threading . AndroidImmediateDispatcher ; 
 
 public class AndroidDispatcherProvider implements DispatcherRuntime { 
 
 - private Executor EXECUTOR ; 
 + private AndroidImmediateDispatcher dispatcher ; 
 
 public AndroidDispatcherProvider ( ) { 
 
 @ @ - 19 , 9 + 18 , 9 @ @ public class AndroidDispatcherProvider implements DispatcherRuntime { 
 
 @ Override 
 public synchronized void dispatch ( Runnable runnable ) { 
 - if ( EXECUTOR = = null ) { 
 - EXECUTOR = Executors . newSingleThreadExecutor ( ) ; 
 + if ( dispatcher = = null ) { 
 + dispatcher = new AndroidImmediateDispatcher ( " callback _ dispatcher " , ThreadPriority . LOW ) ; 
 } 
 - EXECUTOR . execute ( runnable ) ; 
 + dispatcher . dispatchNow ( runnable ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java 
 index 0e4a068 . . 4178095 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidThreadingProvider . java 
 @ @ - 13 , 6 + 13 , 7 @ @ import android . content . SharedPreferences ; 
 import im . actor . runtime . Runtime ; 
 import im . actor . runtime . actors . ThreadPriority ; 
 import im . actor . runtime . android . threading . AndroidDispatcher ; 
 + import im . actor . runtime . android . threading . AndroidImmediateDispatcher ; 
 import im . actor . runtime . android . time . SntpClient ; 
 import im . actor . runtime . generic . GenericThreadingProvider ; 
 import im . actor . runtime . Log ; 
 @ @ - 75 , 4 + 76 , 9 @ @ public class AndroidThreadingProvider extends GenericThreadingProvider { 
 public Dispatcher createDispatcher ( String name ) { 
 return new AndroidDispatcher ( name ) ; 
 } 
 + 
 + @ Override 
 + public ImmediateDispatcher createImmediateDispatcher ( String name , ThreadPriority priority ) { 
 + return new AndroidImmediateDispatcher ( name , priority ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java 
 new file mode 100644 
 index 0000000 . . 3234d24 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / crypto / AndroidSHA256 . java 
 @ @ - 0 , 0 + 1 , 44 @ @ 
 + package im . actor . runtime . android . crypto ; 
 + 
 + import java . security . DigestException ; 
 + import java . security . MessageDigest ; 
 + import java . security . NoSuchAlgorithmException ; 
 + 
 + import im . actor . runtime . crypto . Digest ; 
 + 
 + public class AndroidSHA256 implements Digest { 
 + 
 + private MessageDigest messageDigest ; 
 + 
 + public AndroidSHA256 ( ) { 
 + try { 
 + messageDigest = MessageDigest . getInstance ( " SHA - 256 " ) ; 
 + } catch ( NoSuchAlgorithmException e1 ) { 
 + throw new RuntimeException ( e1 ) ; / / Unexpected 
 + } 
 + } 
 + 
 + @ Override 
 + public void reset ( ) { 
 + messageDigest . reset ( ) ; 
 + } 
 + 
 + @ Override 
 + public void update ( byte [ ] src , int offset , int length ) { 
 + messageDigest . update ( src , offset , length ) ; 
 + } 
 + 
 + @ Override 
 + public void doFinal ( byte [ ] dest , int destOffset ) { 
 + try { 
 + messageDigest . digest ( dest , destOffset , 32 ) ; 
 + } catch ( DigestException e ) { 
 + throw new RuntimeException ( e ) ; / / Unexpected 
 + } 
 + } 
 + 
 + @ Override 
 + public int getDigestSize ( ) { 
 + return 32 ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java 
 new file mode 100644 
 index 0000000 . . c3bd255 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / threading / AndroidImmediateDispatcher . java 
 @ @ - 0 , 0 + 1 , 40 @ @ 
 + package im . actor . runtime . android . threading ; 
 + 
 + import android . os . Handler ; 
 + import android . os . HandlerThread ; 
 + 
 + import im . actor . runtime . actors . ThreadPriority ; 
 + import im . actor . runtime . threading . ImmediateDispatcher ; 
 + 
 + public class AndroidImmediateDispatcher implements ImmediateDispatcher { 
 + 
 + private HandlerThread handlerThread ; 
 + private Handler handler ; 
 + 
 + public AndroidImmediateDispatcher ( String name , ThreadPriority priority ) { 
 + 
 + handlerThread = new HandlerThread ( name ) ; 
 + switch ( priority ) { 
 + case HIGH : 
 + handlerThread . setPriority ( Thread . MAX _ PRIORITY ) ; 
 + case LOW : 
 + handlerThread . setPriority ( Thread . MIN _ PRIORITY ) ; 
 + default : 
 + case NORMAL : 
 + handlerThread . setPriority ( Thread . NORM _ PRIORITY ) ; 
 + } 
 + handlerThread . start ( ) ; 
 + 
 + / / Wait for Looper ready 
 + while ( handlerThread . getLooper ( ) = = null ) { 
 + 
 + } 
 + 
 + handler = new Handler ( handlerThread . getLooper ( ) ) ; 
 + } 
 + 
 + @ Override 
 + public void dispatchNow ( Runnable runnable ) { 
 + handler . post ( runnable ) ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 index fb5dc32 . . 4ef8c46 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 @ @ - 91 , 7 + 91 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " touchWithIndex : " ) 
 public void touch ( int index ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 if ( index > = getSize ( ) - loadGap ) { 
 if ( window . isForwardCompleted ( ) ) { 
 @ @ - 127 , 7 + 127 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " initEmpty " ) 
 public void initEmpty ( ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 pendingModifications . clear ( ) ; 
 mode = ListMode . FORWARD ; 
 @ @ - 143 , 7 + 143 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " initTopWithRefresh : " ) 
 public void initTop ( boolean refresh ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 / / Log . d ( TAG , " initTop ( : " + refresh + " ) " ) ; 
 
 @ @ - 186 , 7 + 186 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " initBottomWithRefresh : " ) 
 public void initBottom ( boolean refresh ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 if ( isGlobalList ) { 
 throw new RuntimeException ( " Global DisplayList can ' t grow from bottom " ) ; 
 @ @ - 231 , 7 + 231 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " initCenterWithKey : withRefresh : " ) 
 public void initCenter ( long centerSortKey , boolean refresh ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 if ( mode ! = null & & mode = = ListMode . CENTER ) { 
 return ; 
 @ @ - 273 , 7 + 273 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 @ MainThread 
 @ ObjectiveCName ( " initSearchWithQuery : withRefresh : " ) 
 public void initSearch ( String query , boolean refresh ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 if ( isGlobalList ) { 
 throw new RuntimeException ( " Global DisplayList can ' t perform search " ) ; 
 @ @ - 324 , 7 + 324 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 
 @ MainThread 
 private void loadMoreForward ( ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 / / Log . d ( TAG , " Requesting loading more . . . " ) ; 
 
 @ @ - 384 , 7 + 384 , 7 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 
 @ MainThread 
 private void loadMoreBackward ( ) { 
 - im . actor . runtime . Runtime . checkMainThread ( ) ; 
 + / / im . actor . runtime . Runtime . checkMainThread ( ) ; 
 
 if ( isLoadMoreBackwardRequested ) { 
 return ; 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java 
 index 831c8aa . . adcdff6 100755 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / bser / BserParser . java 
 @ @ - 18 , 7 + 18 , 7 @ @ import im . actor . runtime . collections . SparseArray ; 
 
 public final class BserParser { 
 public static SparseArray < Object > deserialize ( DataInput is ) throws IOException { 
 - SparseArray < Object > hashMap = new SparseArray < Object > ( ) ; 
 + SparseArray < Object > hashMap = new SparseArray < > ( ) ; 
 while ( ! is . isEOF ( ) ) { 
 long currentTag = is . readVarInt ( ) ; 
 
 @ @ - 46 , 7 + 46 , 7 @ @ public final class BserParser { 
 if ( hashMap . get ( id ) instanceof List ) { 
 ( ( List ) hashMap . get ( id ) ) . add ( res ) ; 
 } else { 
 - ArrayList < Object > list = new ArrayList < Object > ( ) ; 
 + ArrayList < Object > list = new ArrayList < > ( ) ; 
 list . add ( hashMap . get ( id ) ) ; 
 list . add ( res ) ; 
 hashMap . put ( id , list ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 index 9e777b1 . . 1f1141b 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorApp . xcodeproj / project . pbxproj 
 @ @ - 207 , 6 + 207 , 9 @ @ 
 	 	 	 	 	 	 	 com . apple . Maps . iOS = { 
 	 	 	 	 	 	 	 	 enabled = 1 ; 
 	 	 	 	 	 	 	 } ; 
 + 	 	 	 	 	 	 	 com . apple . Push = { 
 + 	 	 	 	 	 	 	 	 enabled = 1 ; 
 + 	 	 	 	 	 	 	 } ; 
 	 	 	 	 	 	 	 com . apple . iCloud = { 
 	 	 	 	 	 	 	 	 enabled = 1 ; 
 	 	 	 	 	 	 	 } ; 
 @ @ - 393 , 7 + 396 , 7 @ @ 
 	 	 	 	 LIBRARY _ SEARCH _ PATHS = " $ ( inherited ) " ; 
 	 	 	 	 ONLY _ ACTIVE _ ARCH = YES ; 
 	 	 	 	 OTHER _ LDFLAGS = " $ ( inherited ) " ; 
 - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; 
 + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . development ; 
 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; 
 	 	 	 	 PROVISIONING _ PROFILE = " " ; 
 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; 
 @ @ - 469 , 7 + 472 , 7 @ @ 
 	 	 	 	 LD _ RUNPATH _ SEARCH _ PATHS = " $ ( inherited ) @ executable _ path / Frameworks @ loader _ path / Frameworks " ; 
 	 	 	 	 LIBRARY _ SEARCH _ PATHS = " $ ( inherited ) " ; 
 	 	 	 	 OTHER _ LDFLAGS = " $ ( inherited ) " ; 
 - 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . app ; 
 + 	 	 	 	 PRODUCT _ BUNDLE _ IDENTIFIER = im . actor . sdk . development ; 
 	 	 	 	 PRODUCT _ NAME = " $ ( TARGET _ NAME ) " ; 
 	 	 	 	 PROVISIONING _ PROFILE = " " ; 
 	 	 	 	 SDK _ PATH = " . . / actor - sdk " ; 
 diff - - git a / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist b / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist 
 index 051f421 . . 5525958 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist 	 
 + + + b / actor - sdk / sdk - core - ios / ActorApp / Supporting Files / Info . plist 	 
 @ @ - 71 , 6 + 71 , 7 @ @ 
 	 	 < string > audio < / string > 
 	 	 < string > fetch < / string > 
 	 	 < string > remote - notification < / string > 
 + 	 	 < string > voip < / string > 
 	 < / array > 
 	 < key > UILaunchStoryboardName < / key > 
 	 < string > Launch Screen < / string > 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index db07441 . . e39318a 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 7 , 6 + 7 , 7 @ @ 
 	 objects = { 
 
 / * Begin PBXBuildFile section * / 
 + 	 	 06129AA61C8359FB0099286B / * CocoaLifecycleRuntime . swift in Sources * / = { isa = PBXBuildFile ; fileRef = 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / ; } ; 
 	 	 06230F411BC95BD200A4807B / * RMPhoneFormat . m in Sources * / = { isa = PBXBuildFile ; fileRef = 06230F3F1BC95BD200A4807B / * RMPhoneFormat . m * / ; } ; 
 	 	 06230F421BC95BD200A4807B / * RMPhoneFormat . h in Headers * / = { isa = PBXBuildFile ; fileRef = 06230F401BC95BD200A4807B / * RMPhoneFormat . h * / ; settings = { ATTRIBUTES = ( Public , ) ; } ; } ; 
 	 	 06230F451BC95C0E00A4807B / * ABPhoneFieldCodes . txt in Resources * / = { isa = PBXBuildFile ; fileRef = 06230F431BC95C0E00A4807B / * ABPhoneFieldCodes . txt * / ; } ; 
 @ @ - 302 , 6 + 303 , 7 @ @ 
 / * End PBXBuildFile section * / 
 
 / * Begin PBXFileReference section * / 
 + 	 	 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = CocoaLifecycleRuntime . swift ; sourceTree = " < group > " ; } ; 
 	 	 06230F3F1BC95BD200A4807B / * RMPhoneFormat . m * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . objc ; path = RMPhoneFormat . m ; sourceTree = " < group > " ; } ; 
 	 	 06230F401BC95BD200A4807B / * RMPhoneFormat . h * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . c . h ; path = RMPhoneFormat . h ; sourceTree = " < group > " ; } ; 
 	 	 06230F431BC95C0E00A4807B / * ABPhoneFieldCodes . txt * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = text ; path = ABPhoneFieldCodes . txt ; sourceTree = " < group > " ; } ; 
 @ @ - 772 , 6 + 774 , 7 @ @ 
 	 	 	 	 066A51891BC4C383000E606E / * CocoaNetworkRuntime . swift * / , 
 	 	 	 	 066A51861BC4C383000E606E / * CocoaStorageRuntime . swift * / , 
 	 	 	 	 065A06B51C6CEFE00012EA09 / * CocoaWebRTCRuntime . swift * / , 
 + 	 	 	 	 06129AA51C8359FB0099286B / * CocoaLifecycleRuntime . swift * / , 
 	 	 	 	 066A51871BC4C383000E606E / * iOSNotificationProvider . swift * / , 
 	 	 	 	 066A51881BC4C383000E606E / * iOSPhoneBookProvider . swift * / , 
 	 	 	 	 06E322C81C69344A00D66F53 / * iOSCallsProvider . swift * / , 
 @ @ - 1891 , 6 + 1894 , 7 @ @ 
 	 	 	 	 06E7B24C1C0FAB500090660C / * AAMapFastView . swift in Sources * / , 
 	 	 	 	 BED5A1F11C48396A0045FDB0 / * NYTPhotoCaptionView . m in Sources * / , 
 	 	 	 	 BED5A20F1C4839880045FDB0 / * NSBundle + NYTPhotoViewer . m in Sources * / , 
 + 	 	 	 	 06129AA61C8359FB0099286B / * CocoaLifecycleRuntime . swift in Sources * / , 
 	 	 	 	 066A516D1BC4C366000E606E / * ActorCoreExt . swift in Sources * / , 
 	 	 	 	 066A517E1BC4C373000E606E / * FMDatabaseAdditions . m in Sources * / , 
 	 	 	 	 066A519A1BC4C390000E606E / * FMDBList . swift in Sources * / , 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 index d65d367 . . a06525d 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorRuntime . swift 
 @ @ - 20 , 5 + 20 , 6 @ @ class AAActorRuntime { 
 ARCocoaNetworkProxyProvider . setNetworkRuntime ( CocoaNetworkRuntime ( ) ) 
 ARCocoaAssetsProxyProvider . setAssetsRuntimeWithARAssetsRuntime ( CocoaAssetsRuntime ( ) ) 
 ARCocoaWebRTCProxyProvider . setWebRTCRuntime ( CocoaWebRTCRuntime ( ) ) 
 + ARCocoaLifecycleProxyProvider . setLifecycleRuntime ( CocoaLifecycleRuntime ( ) ) 
 } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift 
 new file mode 100644 
 index 0000000 . . 086cb1a 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaLifecycleRuntime . swift 
 @ @ - 0 , 0 + 1 , 37 @ @ 
 + / / 
 + / / CocoaLifecycleProvider . swift 
 + / / ActorSDK 
 + / / 
 + / / Created by Steve Kite on 28 . 02 . 16 . 
 + / / Copyright © 2016 Steve Kite . All rights reserved . 
 + / / 
 + 
 + import Foundation 
 + 
 + @ objc class CocoaLifecycleRuntime : NSObject , ARLifecycleRuntime { 
 + 
 + func killApp ( ) { 
 + [ ] [ 100 ] 
 + } 
 + 
 + func makeWakeLock ( ) - > ARWakeLock ! { 
 + return CocoaWakeLock ( ) 
 + } 
 + } 
 + 
 + @ objc class CocoaWakeLock : NSObject , ARWakeLock { 
 + 
 + private var background : UIBackgroundTaskIdentifier ? 
 + 
 + override init ( ) { 
 + background = UIApplication . sharedApplication ( ) . beginBackgroundTaskWithExpirationHandler ( nil ) 
 + super . init ( ) 
 + } 
 + 
 + func releaseLock ( ) { 
 + if background ! = nil { 
 + UIApplication . sharedApplication ( ) . endBackgroundTask ( background ! ) 
 + background = nil 
 + } 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java 
 index d428070 . . 79f1d56 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / AndroidLifecycleProvider . java 
 @ @ - 4 , 6 + 4 , 8 @ @ 
 package im . actor . runtime . android ; 
 
 import im . actor . runtime . LifecycleRuntime ; 
 + import im . actor . runtime . android . power . AndroidWakeLock ; 
 + import im . actor . runtime . power . WakeLock ; 
 
 public class AndroidLifecycleProvider implements LifecycleRuntime { 
 
 @ @ - 11 , 4 + 13 , 9 @ @ public class AndroidLifecycleProvider implements LifecycleRuntime { 
 public void killApp ( ) { 
 android . os . Process . killProcess ( android . os . Process . myPid ( ) ) ; 
 } 
 + 
 + @ Override 
 + public WakeLock makeWakeLock ( ) { 
 + return new AndroidWakeLock ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java 
 new file mode 100644 
 index 0000000 . . dbd0892 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / power / AndroidWakeLock . java 
 @ @ - 0 , 0 + 1 , 11 @ @ 
 + package im . actor . runtime . android . power ; 
 + 
 + import im . actor . runtime . power . WakeLock ; 
 + 
 + public class AndroidWakeLock implements WakeLock { 
 + 
 + @ Override 
 + public void releaseLock ( ) { 
 + / / TODO : Implement 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java 
 index 8bd4bbc . . 7fb1922 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / LifecycleRuntimeProvider . java 
 @ @ - 1 , 7 + 1 , 7 @ @ 
 package im . actor . runtime ; 
 
 - import im . actor . runtime . cocoa . CocoaLifecycleProvider ; 
 + import im . actor . runtime . cocoa . CocoaLifecycleProxyProvider ; 
 
 - public class LifecycleRuntimeProvider extends CocoaLifecycleProvider { 
 + public class LifecycleRuntimeProvider extends CocoaLifecycleProxyProvider { 
 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java 
 deleted file mode 100644 
 index 4088651 . . 0000000 
 - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProvider . java 
 + + + / dev / null 
 @ @ - 1 , 10 + 0 , 0 @ @ 
 - package im . actor . runtime . cocoa ; 
 - 
 - import im . actor . runtime . LifecycleRuntime ; 
 - 
 - public class CocoaLifecycleProvider implements LifecycleRuntime { 
 - @ Override 
 - public native void killApp ( ) / * - [ 
 - @ throw NSInternalInconsistencyException ; 
 - ] - * / ; 
 - } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java 
 new file mode 100644 
 index 0000000 . . f4bdfea 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / java / im / actor / runtime / cocoa / CocoaLifecycleProxyProvider . java 
 @ @ - 0 , 0 + 1 , 32 @ @ 
 + package im . actor . runtime . cocoa ; 
 + 
 + import com . google . j2objc . annotations . ObjectiveCName ; 
 + 
 + import im . actor . runtime . LifecycleRuntime ; 
 + import im . actor . runtime . power . WakeLock ; 
 + 
 + public class CocoaLifecycleProxyProvider implements LifecycleRuntime { 
 + 
 + private static LifecycleRuntime lifecycleRuntime ; 
 + 
 + @ ObjectiveCName ( " setLifecycleRuntime : " ) 
 + public static void setLifecycleRuntime ( LifecycleRuntime lifecycleRuntime ) { 
 + CocoaLifecycleProxyProvider . lifecycleRuntime = lifecycleRuntime ; 
 + } 
 + 
 + @ Override 
 + public void killApp ( ) { 
 + if ( lifecycleRuntime = = null ) { 
 + throw new RuntimeException ( " Lifecycle Runtime not set ! " ) ; 
 + } 
 + lifecycleRuntime . killApp ( ) ; 
 + } 
 + 
 + @ Override 
 + public WakeLock makeWakeLock ( ) { 
 + if ( lifecycleRuntime = = null ) { 
 + throw new RuntimeException ( " Lifecycle Runtime not set ! " ) ; 
 + } 
 + return lifecycleRuntime . makeWakeLock ( ) ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties 
 index eef5836 . . ae22c4f 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties 
 + + + b / actor - sdk / sdk - core / runtime / runtime - cocoa / src / main / prefixes . properties 
 @ @ - 20 , 6 + 20 , 8 @ @ im . actor . runtime . crypto . asn1 : AR 
 im . actor . runtime . crypto . bouncycastle : AR 
 im . actor . runtime . crypto . encoding : AR 
 
 + im . actor . runtime . power : AR 
 + 
 im . actor . runtime . cocoa : AR 
 
 im . actor . runtime . files : AR 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java 
 index 3bbb095 . . 9089b70 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / JsLifecycleProvider . java 
 @ @ - 7 , 10 + 7 , 18 @ @ package im . actor . runtime . js ; 
 import com . google . gwt . user . client . Window ; 
 
 import im . actor . runtime . LifecycleRuntime ; 
 + import im . actor . runtime . js . power . JsWakeLock ; 
 + import im . actor . runtime . power . WakeLock ; 
 
 public class JsLifecycleProvider implements LifecycleRuntime { 
 + 
 @ Override 
 public void killApp ( ) { 
 Window . Location . reload ( ) ; 
 } 
 + 
 + @ Override 
 + public WakeLock makeWakeLock ( ) { 
 + return new JsWakeLock ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java 
 new file mode 100644 
 index 0000000 . . d79d2cf 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / power / JsWakeLock . java 
 @ @ - 0 , 0 + 1 , 11 @ @ 
 + package im . actor . runtime . js . power ; 
 + 
 + import im . actor . runtime . power . WakeLock ; 
 + 
 + public class JsWakeLock implements WakeLock { 
 + 
 + @ Override 
 + public void releaseLock ( ) { 
 + / / Do nothing as wake lock is not required for js environments 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java 
 index 77aa331 . . 2f12932 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / LifecycleRuntime . java 
 @ @ - 6 , 7 + 6 , 13 @ @ package im . actor . runtime ; 
 
 import com . google . j2objc . annotations . ObjectiveCName ; 
 
 + import im . actor . runtime . power . WakeLock ; 
 + 
 public interface LifecycleRuntime { 
 + 
 @ ObjectiveCName ( " killApp " ) 
 void killApp ( ) ; 
 + 
 + @ ObjectiveCName ( " makeWakeLock " ) 
 + WakeLock makeWakeLock ( ) ; 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java 
 new file mode 100644 
 index 0000000 . . bf29d92 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / power / WakeLock . java 
 @ @ - 0 , 0 + 1 , 9 @ @ 
 + package im . actor . runtime . power ; 
 + 
 + import com . google . j2objc . annotations . ObjectiveCName ; 
 + 
 + public interface WakeLock { 
 + 
 + @ ObjectiveCName ( " releaseLock " ) 
 + void releaseLock ( ) ; 
 + }
