BLEU SCORE: 0.2626909894424158

TEST MSG: feat ( android ) : add suggested email for auth
GENERATED MSG: feat ( android ) call members list

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java < nl > index 740e192 . . cdb8898 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java < nl > @ @ - 1 , 13 + 1 , 20 @ @ < nl > package im . actor . sdk . controllers . auth ; < nl > < nl > + import android . Manifest ; < nl > + import android . accounts . Account ; < nl > + import android . accounts . AccountManager ; < nl > + import android . content . pm . PackageManager ; < nl > + import android . support . annotation . Nullable ; < nl > + import android . support . v4 . app . ActivityCompat ; < nl > + import android . support . v4 . content . ContextCompat ; < nl > + import android . util . Patterns ; < nl > import android . widget . EditText ; < nl > < nl > - import im . actor . core . AuthState ; < nl > - import im . actor . core . entity . AuthCodeRes ; < nl > + import java . util . regex . Pattern ; < nl > + < nl > import im . actor . core . entity . AuthRes ; < nl > - import im . actor . core . entity . AuthStartRes ; < nl > import im . actor . core . entity . Sex ; < nl > - import im . actor . core . viewmodel . Command ; < nl > + import im . actor . runtime . Log ; < nl > import im . actor . runtime . promise . Promise ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > @ @ - 16 , 6 + 23 , 8 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public abstract class BaseAuthFragment extends BaseFragment { < nl > < nl > + private static final int PERMISSIONS _ REQUEST _ ACCOUNT = 1 ; < nl > + private EditText edittextToFill ; < nl > public BaseAuthFragment ( ) { < nl > < nl > } < nl > @ @ - 63 , 6 + 72 , 30 @ @ public abstract class BaseAuthFragment extends BaseFragment { < nl > ( ( AuthActivity ) getActivity ( ) ) . switchToPhoneAuth ( ) ; < nl > } < nl > < nl > + protected void setSuggestedEmail ( EditText et ) { < nl > + edittextToFill = et ; < nl > + if ( ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . GET _ ACCOUNTS ) ! = PackageManager . PERMISSION _ GRANTED ) { < nl > + requestPermissions ( new String [ ] { Manifest . permission . GET _ ACCOUNTS } , < nl > + PERMISSIONS _ REQUEST _ ACCOUNT ) ; < nl > + < nl > + } else { < nl > + et . setText ( getSuggestedEmailChecked ( ) ) ; < nl > + } < nl > + } < nl > + < nl > + < nl > + private String getSuggestedEmailChecked ( ) { < nl > + Pattern emailPattern = Patterns . EMAIL _ ADDRESS ; < nl > + Account [ ] accounts = AccountManager . get ( getActivity ( ) ) . getAccounts ( ) ; < nl > + for ( Account account : accounts ) { < nl > + if ( emailPattern . matcher ( account . name ) . matches ( ) ) { < nl > + return account . name ; < nl > + } < nl > + } < nl > + < nl > + return null ; < nl > + } < nl > + < nl > protected void focus ( final EditText editText ) { < nl > editText . post ( new Runnable ( ) { < nl > @ Override < nl > @ @ - 72 , 4 + 105 , 14 @ @ public abstract class BaseAuthFragment extends BaseFragment { < nl > } < nl > } ) ; < nl > } < nl > + < nl > + @ Override < nl > + public void onRequestPermissionsResult ( int requestCode , String [ ] permissions , int [ ] grantResults ) { < nl > + super . onRequestPermissionsResult ( requestCode , permissions , grantResults ) ; < nl > + if ( requestCode = = PERMISSIONS _ REQUEST _ ACCOUNT & & grantResults . length > 0 & & grantResults [ 0 ] = = PackageManager . PERMISSION _ GRANTED ) { < nl > + if ( edittextToFill ! = null ) { < nl > + edittextToFill . setText ( getSuggestedEmailChecked ( ) ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java < nl > index 863c28f . . aca6af9 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java < nl > @ @ - 1 , 11 + 1 , 8 @ @ < nl > package im . actor . sdk . controllers . auth ; < nl > < nl > import android . app . AlertDialog ; < nl > - import android . graphics . drawable . Drawable ; < nl > import android . graphics . drawable . StateListDrawable ; < nl > import android . os . Bundle ; < nl > - import android . support . v4 . app . Fragment ; < nl > - import android . telephony . PhoneNumberFormattingTextWatcher ; < nl > import android . text . Editable ; < nl > import android . text . TextWatcher ; < nl > import android . view . KeyEvent ; < nl > @ @ - 15 , 26 + 12 , 20 @ @ import android . view . ViewGroup ; < nl > import android . view . inputmethod . EditorInfo ; < nl > import android . widget . Button ; < nl > import android . widget . EditText ; < nl > - import android . widget . ImageView ; < nl > import android . widget . TextView ; < nl > < nl > - import im . actor . core . AuthState ; < nl > - import im . actor . runtime . actors . ActorRef ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . util . Fonts ; < nl > import im . actor . sdk . util . KeyboardHelper ; < nl > import im . actor . sdk . view . SelectorFactory ; < nl > < nl > - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > - < nl > public class SignEmailFragment extends BaseAuthFragment { < nl > < nl > private EditText emailEditText ; < nl > private KeyboardHelper keyboardHelper ; < nl > private String rawEmail ; < nl > - private ImageView logo ; < nl > - ActorRef logoActor ; < nl > + < nl > < nl > @ Override < nl > public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > @ @ - 112 , 11 + 103 , 8 @ @ public class SignEmailFragment extends BaseAuthFragment { < nl > ( ( TextView ) v . findViewById ( R . id . email _ login _ hint ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > emailEditText = ( EditText ) v . findViewById ( R . id . tv _ email ) ; < nl > emailEditText . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > - emailEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; < nl > - String email = messenger ( ) . getAuthEmail ( ) ; < nl > - if ( email ! = null & & ! email . isEmpty ( ) ) { < nl > - emailEditText . setText ( email ) ; < nl > - } < nl > + setSuggestedEmail ( emailEditText ) ; < nl > + < nl > emailEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { < nl > @ Override < nl > public boolean onEditorAction ( TextView textView , int id , KeyEvent keyEvent ) { < nl > @ @ - 160 , 6 + 148 , 14 @ @ public class SignEmailFragment extends BaseAuthFragment { < nl > switchToPhone . setVisibility ( View . GONE ) ; < nl > } < nl > < nl > + Button singIn = ( Button ) v . findViewById ( R . id . button _ sign _ in ) ; < nl > + singIn . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + onClick ( singIn , new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + startSignIn ( ) ; < nl > + } < nl > + } ) ; < nl > < nl > onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java < nl > index ecfdfb1 . . e60721e 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java < nl > @ @ - 3 , 9 + 3 , 6 @ @ package im . actor . sdk . controllers . auth ; < nl > import android . app . AlertDialog ; < nl > import android . graphics . drawable . StateListDrawable ; < nl > import android . os . Bundle ; < nl > - import android . telephony . PhoneNumberFormattingTextWatcher ; < nl > - import android . text . Editable ; < nl > - import android . text . TextWatcher ; < nl > import android . view . KeyEvent ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > @ @ - 13 , 18 + 10 , 14 @ @ import android . view . ViewGroup ; < nl > import android . view . inputmethod . EditorInfo ; < nl > import android . widget . Button ; < nl > import android . widget . EditText ; < nl > - import android . widget . ImageView ; < nl > import android . widget . TextView ; < nl > < nl > - import im . actor . runtime . actors . ActorRef ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . util . Fonts ; < nl > import im . actor . sdk . util . KeyboardHelper ; < nl > import im . actor . sdk . view . SelectorFactory ; < nl > < nl > - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > - < nl > public class SignInFragment extends BaseAuthFragment { < nl > < nl > private EditText signIdEditText ; < nl > @ @ - 93 , 7 + 86 , 7 @ @ public class SignInFragment extends BaseAuthFragment { < nl > ( ( TextView ) v . findViewById ( R . id . sign _ in _ login _ hint ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > signIdEditText = ( EditText ) v . findViewById ( R . id . tv _ sign _ in ) ; < nl > signIdEditText . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > - signIdEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; < nl > + setSuggestedEmail ( signIdEditText ) ; < nl > < nl > signIdEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java < nl > index fb12d03 . . d82b548 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java < nl > @ @ - 249 , 6 + 249 , 14 @ @ public class SignPhoneFragment extends BaseAuthFragment { < nl > switchToEmail . setVisibility ( View . GONE ) ; < nl > } < nl > < nl > + Button singIn = ( Button ) v . findViewById ( R . id . button _ sign _ in ) ; < nl > + singIn . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + onClick ( singIn , new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + startSignIn ( ) ; < nl > + } < nl > + } ) ; < nl > < nl > onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml < nl > index 6abd93c . . 1596c28 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml < nl > @ @ - 106 , 12 + 106 , 26 @ @ < nl > android : layout _ gravity = " center _ horizontal " < nl > android : layout _ marginLeft = " 8dp " < nl > android : layout _ marginRight = " 8dp " < nl > + android : layout _ marginBottom = " 8dp " < nl > android : background = " @ null " < nl > android : paddingLeft = " 26dp " < nl > android : paddingRight = " 26dp " < nl > android : text = " @ string / auth _ switch _ to _ phone " < nl > android : textSize = " 14sp " / > < nl > < nl > + < Button < nl > + android : id = " @ + id / button _ sign _ in " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center _ horizontal " < nl > + android : layout _ marginLeft = " 8dp " < nl > + android : layout _ marginRight = " 8dp " < nl > + android : background = " @ null " < nl > + android : paddingLeft = " 26dp " < nl > + android : paddingRight = " 26dp " < nl > + android : text = " @ string / tour _ sign _ in " < nl > + android : textSize = " 14sp " / > < nl > + < nl > < / LinearLayout > < nl > < / ScrollView > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml < nl > index 1f8cc30 . . ca69445 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml < nl > @ @ - 71 , 7 + 71 , 7 @ @ < nl > android : minWidth = " 88dp " < nl > android : paddingLeft = " 24dp " < nl > android : paddingRight = " 24dp " < nl > - android : text = " @ string / sign _ in _ get _ code " < nl > + android : text = " @ string / tour _ sign _ in " < nl > android : textSize = " 15sp " / > < nl > < / FrameLayout > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml < nl > index 8cf305f . . 7395274 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml < nl > @ @ - 103 , 6 + 103 , 7 @ @ < nl > < / FrameLayout > < nl > < nl > < Button < nl > + android : visibility = " gone " < nl > android : id = " @ + id / button _ why " < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > @ @ - 123 , 12 + 124 , 26 @ @ < nl > android : layout _ gravity = " center _ horizontal " < nl > android : layout _ marginLeft = " 8dp " < nl > android : layout _ marginRight = " 8dp " < nl > + android : layout _ marginBottom = " 8dp " < nl > android : background = " @ null " < nl > android : paddingLeft = " 26dp " < nl > android : paddingRight = " 26dp " < nl > android : text = " @ string / auth _ switch _ to _ email " < nl > android : textSize = " 14sp " / > < nl > < nl > + < Button < nl > + android : id = " @ + id / button _ sign _ in " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center _ horizontal " < nl > + android : layout _ marginLeft = " 8dp " < nl > + android : layout _ marginRight = " 8dp " < nl > + android : background = " @ null " < nl > + android : paddingLeft = " 26dp " < nl > + android : paddingRight = " 26dp " < nl > + android : text = " @ string / tour _ sign _ in " < nl > + android : textSize = " 14sp " / > < nl > + < nl > < / LinearLayout > < nl > < / ScrollView > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 0b54ba4 . . e1b7ac6 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 104 , 6 + 104 , 13 @ @ < nl > < string name = " auth _ profile _ done " > Н А Ч А Т Ь О Б Щ Е Н И Е < / string > < nl > < string name = " auth _ profile _ name _ hint " > В а ш е и м я < / string > < nl > < nl > + < ! - - Sign in Fragment - - > < nl > + < string name = " sign _ in _ title " > В х о д < / string > < nl > + < string name = " sign _ in _ hint " > П о ж а л у й с т а , в в е д и т е с в о й н о м е р т е л е ф о н а и л и email < / string > < nl > + < string name = " sign _ in _ edit _ text _ hint " > т е л е ф о н а и л и email < / string > < nl > + < string name = " sign _ in _ get _ code " > В х о д < / string > < nl > + < nl > + < nl > < ! - - Auth errors - - > < nl > < string name = " auth _ error _ wrong _ auth _ id " > П о ж а л у й с т а , в в е д и т е д е й с т в и т е л ь н ы й email и л и н о м е р т е л е ф о н а . < / string > < nl > < string name = " auth _ error _ empty _ phone " > П о ж а л у й с т а , в в е д и т е с в о й н о м е р т е л е ф о н а . < / string >
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index fa9298f . . 5bb61e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . Manifest ; < nl > + import android . app . Activity ; < nl > import android . app . Notification ; < nl > import android . app . NotificationManager ; < nl > import android . app . PendingIntent ; < nl > @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; < nl > import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > - import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > - import android . widget . Toast ; < nl > < nl > import java . text . DateFormat ; < nl > import java . text . SimpleDateFormat ; < nl > + import java . util . ArrayList ; < nl > import java . util . Date ; < nl > import java . util . TimeZone ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . core . viewmodel . CallMember ; < nl > import im . actor . core . viewmodel . CallState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . viewmodel . CallVM ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; < nl > import im . actor . runtime . actors . messages . PoisonPill ; < nl > import im . actor . runtime . mvvm . Value ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > - import im . actor . sdk . core . audio . AndroidPlayerActor ; < nl > - import im . actor . sdk . core . audio . AudioPlayerActor ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . adapters . HolderAdapter ; < nl > + import im . actor . sdk . view . adapters . ViewHolder ; < nl > + import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { < nl > / / < nl > CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - < nl > - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > - < nl > TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > - bind ( nameTV , user . getName ( ) ) ; < nl > + < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + < nl > + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , user . getAvatar ( ) ) ; < nl > + bind ( nameTV , user . getName ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , g . getAvatar ( ) ) ; < nl > + bind ( nameTV , g . getName ( ) ) ; < nl > + } < nl > + < nl > + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > + membersList . setAdapter ( membersAdapter ) ; < nl > < nl > timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > } < nl > < nl > - private void toastInCenter ( String s ) { < nl > - Toast t = Toast . makeText ( getActivity ( ) , < nl > - s , Toast . LENGTH _ SHORT ) ; < nl > - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; < nl > - t . show ( ) ; < nl > - } < nl > - < nl > @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { < nl > super . onResume ( ) ; < nl > manager . cancel ( NOTIFICATION _ ID ) ; < nl > } < nl > + < nl > + class CallMembersAdapter extends HolderAdapter < CallMember > { < nl > + < nl > + < nl > + private ArrayList < CallMember > members ; < nl > + < nl > + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { < nl > + super ( context ) ; < nl > + this . members = members . get ( ) ; < nl > + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { < nl > + @ Override < nl > + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { < nl > + CallMembersAdapter . this . members = val ; < nl > + notifyDataSetChanged ( ) ; < nl > + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getCount ( ) { < nl > + return members . size ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public CallMember getItem ( int position ) { < nl > + return members . get ( position ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public long getItemId ( int position ) { < nl > + return members . get ( position ) . getUid ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { < nl > + return new MemberHolder ( ) ; < nl > + } < nl > + < nl > + private class MemberHolder extends ViewHolder < CallMember > { < nl > + < nl > + CallMember data ; < nl > + private TextView userName ; < nl > + private TextView status ; < nl > + private AvatarView avatarView ; < nl > + < nl > + @ Override < nl > + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { < nl > + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; < nl > + < nl > + userName = ( TextView ) res . findViewById ( R . id . name ) ; < nl > + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + status = ( TextView ) res . findViewById ( R . id . status ) ; < nl > + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; < nl > + this . data = data ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( CallMember data , int position , Context context ) { < nl > + UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + this . data = data ; < nl > + avatarView . bind ( user ) ; < nl > + userName . setText ( user . getName ( ) . get ( ) ) ; < nl > + status . setText ( data . getState ( ) . name ( ) ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 50aecee . . fe5738b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > menu . findItem ( R . id . call ) . setVisible ( false ) ; < nl > } < nl > < nl > @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > if ( item . getItemId ( ) = = R . id . call ) { < nl > if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > private void startCall ( ) { < nl > - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + Command < Long > cmd ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + < nl > + } else { < nl > + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; < nl > + } < nl > execute ( cmd , R . string . progress _ common ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 47ab3ad . . 6ce5969 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 37 , 6 + 37 , 11 @ @ < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > android : textSize = " @ dimen / text _ secondary " / > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > < / LinearLayout > < nl > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . fa1ed22 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > @ @ - 0 , 0 + 1 , 62 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : orientation = " horizontal " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 59dp " < nl > + android : layout _ height = " 48dp " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 35dp " < nl > + android : layout _ height = " 35dp " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / divider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ marginLeft = " 59dp " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > index 922d837 . . 09b3e47 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { < nl > public CallMemberState getState ( ) { < nl > return state ; < nl > } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + return uid + " | " + state . name ( ) ; < nl > + } < nl > } < nl > \ No newline at end of file

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java 
 index 740e192 . . cdb8898 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / BaseAuthFragment . java 
 @ @ - 1 , 13 + 1 , 20 @ @ 
 package im . actor . sdk . controllers . auth ; 
 
 + import android . Manifest ; 
 + import android . accounts . Account ; 
 + import android . accounts . AccountManager ; 
 + import android . content . pm . PackageManager ; 
 + import android . support . annotation . Nullable ; 
 + import android . support . v4 . app . ActivityCompat ; 
 + import android . support . v4 . content . ContextCompat ; 
 + import android . util . Patterns ; 
 import android . widget . EditText ; 
 
 - import im . actor . core . AuthState ; 
 - import im . actor . core . entity . AuthCodeRes ; 
 + import java . util . regex . Pattern ; 
 + 
 import im . actor . core . entity . AuthRes ; 
 - import im . actor . core . entity . AuthStartRes ; 
 import im . actor . core . entity . Sex ; 
 - import im . actor . core . viewmodel . Command ; 
 + import im . actor . runtime . Log ; 
 import im . actor . runtime . promise . Promise ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 @ @ - 16 , 6 + 23 , 8 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public abstract class BaseAuthFragment extends BaseFragment { 
 
 + private static final int PERMISSIONS _ REQUEST _ ACCOUNT = 1 ; 
 + private EditText edittextToFill ; 
 public BaseAuthFragment ( ) { 
 
 } 
 @ @ - 63 , 6 + 72 , 30 @ @ public abstract class BaseAuthFragment extends BaseFragment { 
 ( ( AuthActivity ) getActivity ( ) ) . switchToPhoneAuth ( ) ; 
 } 
 
 + protected void setSuggestedEmail ( EditText et ) { 
 + edittextToFill = et ; 
 + if ( ContextCompat . checkSelfPermission ( getActivity ( ) , Manifest . permission . GET _ ACCOUNTS ) ! = PackageManager . PERMISSION _ GRANTED ) { 
 + requestPermissions ( new String [ ] { Manifest . permission . GET _ ACCOUNTS } , 
 + PERMISSIONS _ REQUEST _ ACCOUNT ) ; 
 + 
 + } else { 
 + et . setText ( getSuggestedEmailChecked ( ) ) ; 
 + } 
 + } 
 + 
 + 
 + private String getSuggestedEmailChecked ( ) { 
 + Pattern emailPattern = Patterns . EMAIL _ ADDRESS ; 
 + Account [ ] accounts = AccountManager . get ( getActivity ( ) ) . getAccounts ( ) ; 
 + for ( Account account : accounts ) { 
 + if ( emailPattern . matcher ( account . name ) . matches ( ) ) { 
 + return account . name ; 
 + } 
 + } 
 + 
 + return null ; 
 + } 
 + 
 protected void focus ( final EditText editText ) { 
 editText . post ( new Runnable ( ) { 
 @ Override 
 @ @ - 72 , 4 + 105 , 14 @ @ public abstract class BaseAuthFragment extends BaseFragment { 
 } 
 } ) ; 
 } 
 + 
 + @ Override 
 + public void onRequestPermissionsResult ( int requestCode , String [ ] permissions , int [ ] grantResults ) { 
 + super . onRequestPermissionsResult ( requestCode , permissions , grantResults ) ; 
 + if ( requestCode = = PERMISSIONS _ REQUEST _ ACCOUNT & & grantResults . length > 0 & & grantResults [ 0 ] = = PackageManager . PERMISSION _ GRANTED ) { 
 + if ( edittextToFill ! = null ) { 
 + edittextToFill . setText ( getSuggestedEmailChecked ( ) ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java 
 index 863c28f . . aca6af9 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignEmailFragment . java 
 @ @ - 1 , 11 + 1 , 8 @ @ 
 package im . actor . sdk . controllers . auth ; 
 
 import android . app . AlertDialog ; 
 - import android . graphics . drawable . Drawable ; 
 import android . graphics . drawable . StateListDrawable ; 
 import android . os . Bundle ; 
 - import android . support . v4 . app . Fragment ; 
 - import android . telephony . PhoneNumberFormattingTextWatcher ; 
 import android . text . Editable ; 
 import android . text . TextWatcher ; 
 import android . view . KeyEvent ; 
 @ @ - 15 , 26 + 12 , 20 @ @ import android . view . ViewGroup ; 
 import android . view . inputmethod . EditorInfo ; 
 import android . widget . Button ; 
 import android . widget . EditText ; 
 - import android . widget . ImageView ; 
 import android . widget . TextView ; 
 
 - import im . actor . core . AuthState ; 
 - import im . actor . runtime . actors . ActorRef ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . util . Fonts ; 
 import im . actor . sdk . util . KeyboardHelper ; 
 import im . actor . sdk . view . SelectorFactory ; 
 
 - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 - 
 public class SignEmailFragment extends BaseAuthFragment { 
 
 private EditText emailEditText ; 
 private KeyboardHelper keyboardHelper ; 
 private String rawEmail ; 
 - private ImageView logo ; 
 - ActorRef logoActor ; 
 + 
 
 @ Override 
 public View onCreateView ( LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 @ @ - 112 , 11 + 103 , 8 @ @ public class SignEmailFragment extends BaseAuthFragment { 
 ( ( TextView ) v . findViewById ( R . id . email _ login _ hint ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 emailEditText = ( EditText ) v . findViewById ( R . id . tv _ email ) ; 
 emailEditText . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 - emailEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; 
 - String email = messenger ( ) . getAuthEmail ( ) ; 
 - if ( email ! = null & & ! email . isEmpty ( ) ) { 
 - emailEditText . setText ( email ) ; 
 - } 
 + setSuggestedEmail ( emailEditText ) ; 
 + 
 emailEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { 
 @ Override 
 public boolean onEditorAction ( TextView textView , int id , KeyEvent keyEvent ) { 
 @ @ - 160 , 6 + 148 , 14 @ @ public class SignEmailFragment extends BaseAuthFragment { 
 switchToPhone . setVisibility ( View . GONE ) ; 
 } 
 
 + Button singIn = ( Button ) v . findViewById ( R . id . button _ sign _ in ) ; 
 + singIn . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + onClick ( singIn , new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + startSignIn ( ) ; 
 + } 
 + } ) ; 
 
 onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java 
 index ecfdfb1 . . e60721e 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignInFragment . java 
 @ @ - 3 , 9 + 3 , 6 @ @ package im . actor . sdk . controllers . auth ; 
 import android . app . AlertDialog ; 
 import android . graphics . drawable . StateListDrawable ; 
 import android . os . Bundle ; 
 - import android . telephony . PhoneNumberFormattingTextWatcher ; 
 - import android . text . Editable ; 
 - import android . text . TextWatcher ; 
 import android . view . KeyEvent ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 @ @ - 13 , 18 + 10 , 14 @ @ import android . view . ViewGroup ; 
 import android . view . inputmethod . EditorInfo ; 
 import android . widget . Button ; 
 import android . widget . EditText ; 
 - import android . widget . ImageView ; 
 import android . widget . TextView ; 
 
 - import im . actor . runtime . actors . ActorRef ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . util . Fonts ; 
 import im . actor . sdk . util . KeyboardHelper ; 
 import im . actor . sdk . view . SelectorFactory ; 
 
 - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 - 
 public class SignInFragment extends BaseAuthFragment { 
 
 private EditText signIdEditText ; 
 @ @ - 93 , 7 + 86 , 7 @ @ public class SignInFragment extends BaseAuthFragment { 
 ( ( TextView ) v . findViewById ( R . id . sign _ in _ login _ hint ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 signIdEditText = ( EditText ) v . findViewById ( R . id . tv _ sign _ in ) ; 
 signIdEditText . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 - signIdEditText . addTextChangedListener ( new PhoneNumberFormattingTextWatcher ( ) ) ; 
 + setSuggestedEmail ( signIdEditText ) ; 
 
 signIdEditText . setOnEditorActionListener ( new TextView . OnEditorActionListener ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java 
 index fb12d03 . . d82b548 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / auth / SignPhoneFragment . java 
 @ @ - 249 , 6 + 249 , 14 @ @ public class SignPhoneFragment extends BaseAuthFragment { 
 switchToEmail . setVisibility ( View . GONE ) ; 
 } 
 
 + Button singIn = ( Button ) v . findViewById ( R . id . button _ sign _ in ) ; 
 + singIn . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + onClick ( singIn , new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + startSignIn ( ) ; 
 + } 
 + } ) ; 
 
 onClick ( v , R . id . button _ continue , new View . OnClickListener ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml 
 index 6abd93c . . 1596c28 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ email . xml 
 @ @ - 106 , 12 + 106 , 26 @ @ 
 android : layout _ gravity = " center _ horizontal " 
 android : layout _ marginLeft = " 8dp " 
 android : layout _ marginRight = " 8dp " 
 + android : layout _ marginBottom = " 8dp " 
 android : background = " @ null " 
 android : paddingLeft = " 26dp " 
 android : paddingRight = " 26dp " 
 android : text = " @ string / auth _ switch _ to _ phone " 
 android : textSize = " 14sp " / > 
 
 + < Button 
 + android : id = " @ + id / button _ sign _ in " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center _ horizontal " 
 + android : layout _ marginLeft = " 8dp " 
 + android : layout _ marginRight = " 8dp " 
 + android : background = " @ null " 
 + android : paddingLeft = " 26dp " 
 + android : paddingRight = " 26dp " 
 + android : text = " @ string / tour _ sign _ in " 
 + android : textSize = " 14sp " / > 
 + 
 < / LinearLayout > 
 < / ScrollView > 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml 
 index 1f8cc30 . . ca69445 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ in . xml 
 @ @ - 71 , 7 + 71 , 7 @ @ 
 android : minWidth = " 88dp " 
 android : paddingLeft = " 24dp " 
 android : paddingRight = " 24dp " 
 - android : text = " @ string / sign _ in _ get _ code " 
 + android : text = " @ string / tour _ sign _ in " 
 android : textSize = " 15sp " / > 
 < / FrameLayout > 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml 
 index 8cf305f . . 7395274 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ sign _ phone . xml 
 @ @ - 103 , 6 + 103 , 7 @ @ 
 < / FrameLayout > 
 
 < Button 
 + android : visibility = " gone " 
 android : id = " @ + id / button _ why " 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 @ @ - 123 , 12 + 124 , 26 @ @ 
 android : layout _ gravity = " center _ horizontal " 
 android : layout _ marginLeft = " 8dp " 
 android : layout _ marginRight = " 8dp " 
 + android : layout _ marginBottom = " 8dp " 
 android : background = " @ null " 
 android : paddingLeft = " 26dp " 
 android : paddingRight = " 26dp " 
 android : text = " @ string / auth _ switch _ to _ email " 
 android : textSize = " 14sp " / > 
 
 + < Button 
 + android : id = " @ + id / button _ sign _ in " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center _ horizontal " 
 + android : layout _ marginLeft = " 8dp " 
 + android : layout _ marginRight = " 8dp " 
 + android : background = " @ null " 
 + android : paddingLeft = " 26dp " 
 + android : paddingRight = " 26dp " 
 + android : text = " @ string / tour _ sign _ in " 
 + android : textSize = " 14sp " / > 
 + 
 < / LinearLayout > 
 < / ScrollView > 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 0b54ba4 . . e1b7ac6 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 104 , 6 + 104 , 13 @ @ 
 < string name = " auth _ profile _ done " > Н А Ч А Т Ь О Б Щ Е Н И Е < / string > 
 < string name = " auth _ profile _ name _ hint " > В а ш е и м я < / string > 
 
 + < ! - - Sign in Fragment - - > 
 + < string name = " sign _ in _ title " > В х о д < / string > 
 + < string name = " sign _ in _ hint " > П о ж а л у й с т а , в в е д и т е с в о й н о м е р т е л е ф о н а и л и email < / string > 
 + < string name = " sign _ in _ edit _ text _ hint " > т е л е ф о н а и л и email < / string > 
 + < string name = " sign _ in _ get _ code " > В х о д < / string > 
 + 
 + 
 < ! - - Auth errors - - > 
 < string name = " auth _ error _ wrong _ auth _ id " > П о ж а л у й с т а , в в е д и т е д е й с т в и т е л ь н ы й email и л и н о м е р т е л е ф о н а . < / string > 
 < string name = " auth _ error _ empty _ phone " > П о ж а л у й с т а , в в е д и т е с в о й н о м е р т е л е ф о н а . < / string >

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index fa9298f . . 5bb61e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . Manifest ; 
 + import android . app . Activity ; 
 import android . app . Notification ; 
 import android . app . NotificationManager ; 
 import android . app . PendingIntent ; 
 @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; 
 import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 - import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . ListView ; 
 import android . widget . TextView ; 
 - import android . widget . Toast ; 
 
 import java . text . DateFormat ; 
 import java . text . SimpleDateFormat ; 
 + import java . util . ArrayList ; 
 import java . util . Date ; 
 import java . util . TimeZone ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . core . viewmodel . CallMember ; 
 import im . actor . core . viewmodel . CallState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . viewmodel . CallVM ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; 
 import im . actor . runtime . actors . messages . PoisonPill ; 
 import im . actor . runtime . mvvm . Value ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 - import im . actor . sdk . core . audio . AndroidPlayerActor ; 
 - import im . actor . sdk . core . audio . AudioPlayerActor ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . adapters . HolderAdapter ; 
 + import im . actor . sdk . view . adapters . ViewHolder ; 
 + import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { 
 / / 
 CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - 
 - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 - 
 TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 - bind ( nameTV , user . getName ( ) ) ; 
 + 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + 
 + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , user . getAvatar ( ) ) ; 
 + bind ( nameTV , user . getName ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , g . getAvatar ( ) ) ; 
 + bind ( nameTV , g . getName ( ) ) ; 
 + } 
 + 
 + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 + membersList . setAdapter ( membersAdapter ) ; 
 
 timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 } 
 
 - private void toastInCenter ( String s ) { 
 - Toast t = Toast . makeText ( getActivity ( ) , 
 - s , Toast . LENGTH _ SHORT ) ; 
 - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; 
 - t . show ( ) ; 
 - } 
 - 
 @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { 
 super . onResume ( ) ; 
 manager . cancel ( NOTIFICATION _ ID ) ; 
 } 
 + 
 + class CallMembersAdapter extends HolderAdapter < CallMember > { 
 + 
 + 
 + private ArrayList < CallMember > members ; 
 + 
 + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { 
 + super ( context ) ; 
 + this . members = members . get ( ) ; 
 + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { 
 + @ Override 
 + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { 
 + CallMembersAdapter . this . members = val ; 
 + notifyDataSetChanged ( ) ; 
 + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public int getCount ( ) { 
 + return members . size ( ) ; 
 + } 
 + 
 + @ Override 
 + public CallMember getItem ( int position ) { 
 + return members . get ( position ) ; 
 + } 
 + 
 + @ Override 
 + public long getItemId ( int position ) { 
 + return members . get ( position ) . getUid ( ) ; 
 + } 
 + 
 + @ Override 
 + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { 
 + return new MemberHolder ( ) ; 
 + } 
 + 
 + private class MemberHolder extends ViewHolder < CallMember > { 
 + 
 + CallMember data ; 
 + private TextView userName ; 
 + private TextView status ; 
 + private AvatarView avatarView ; 
 + 
 + @ Override 
 + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { 
 + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; 
 + 
 + userName = ( TextView ) res . findViewById ( R . id . name ) ; 
 + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + status = ( TextView ) res . findViewById ( R . id . status ) ; 
 + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; 
 + this . data = data ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void bind ( CallMember data , int position , Context context ) { 
 + UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + this . data = data ; 
 + avatarView . bind ( user ) ; 
 + userName . setText ( user . getName ( ) . get ( ) ) ; 
 + status . setText ( data . getState ( ) . name ( ) ) ; 
 + } 
 + 
 + 
 + @ Override 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 50aecee . . fe5738b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 menu . findItem ( R . id . call ) . setVisible ( false ) ; 
 } 
 
 @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 if ( item . getItemId ( ) = = R . id . call ) { 
 if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 private void startCall ( ) { 
 - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + Command < Long > cmd ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + 
 + } else { 
 + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; 
 + } 
 execute ( cmd , R . string . progress _ common ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 47ab3ad . . 6ce5969 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 37 , 6 + 37 , 11 @ @ 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 android : textSize = " @ dimen / text _ secondary " / > 
 + 
 + < ListView 
 + android : id = " @ + id / members _ list " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 < / LinearLayout > 
 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 new file mode 100644 
 index 0000000 . . fa1ed22 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 @ @ - 0 , 0 + 1 , 62 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : orientation = " horizontal " 
 + android : paddingRight = " 8dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 59dp " 
 + android : layout _ height = " 48dp " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 35dp " 
 + android : layout _ height = " 35dp " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / status " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / divider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ marginLeft = " 59dp " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 index 922d837 . . 09b3e47 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { 
 public CallMemberState getState ( ) { 
 return state ; 
 } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + return uid + " | " + state . name ( ) ; 
 + } 
 } 
 \ No newline at end of file
