BLEU SCORE: 0.020244462660665517

TEST MSG: Merge branch ' master ' of https : / / github . com / actorapp / actor - platform
GENERATED MSG: feat ( android ) : custom auth start state

TEST DIFF (one line): diff - - git a / README . MD b / README . MD < nl > index 7eb91db . . 42ded3a 100644 < nl > - - - a / README . MD < nl > + + + b / README . MD < nl > @ @ - 1 , 6 + 1 , 6 @ @ < nl > < h3 align = " center " > < nl > < a href = " https : / / github . com / actorapp / actor - platform " > < nl > - < img src = " docs / assets / Actor _ Logo . png " width = " 150 " / > < nl > + < img src = " docs / assets / Actor _ Logo _ New . png " width = " 150 " / > < nl > < br / > < nl > Actor < nl > < / a > < nl > diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index ff97824 . . 6b5273b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 1 , 32 + 1 , 26 @ @ < nl > package im . actor ; < nl > < nl > - import android . content . Context ; < nl > import android . os . Bundle ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . CheckBox ; < nl > - import android . widget . LinearLayout ; < nl > import android . widget . Toast ; < nl > < nl > import java . util . ArrayList ; < nl > < nl > + import im . actor . develop . R ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKApplication ; < nl > import im . actor . sdk . ActorStyle ; < nl > import im . actor . sdk . BaseActorSDKDelegate ; < nl > import im . actor . sdk . controllers . conversation . ShareMenuField ; < nl > - import im . actor . sdk . controllers . group . GroupInfoFragment ; < nl > - import im . actor . sdk . controllers . profile . ProfileFragment ; < nl > import im . actor . sdk . controllers . settings . ActorSettingsCategories ; < nl > import im . actor . sdk . controllers . settings . ActorSettingsCategory ; < nl > import im . actor . sdk . controllers . settings . ActorSettingsField ; < nl > - import im . actor . sdk . controllers . settings . BaseActorProfileActivity ; < nl > import im . actor . sdk . controllers . settings . BaseActorSettingsActivity ; < nl > import im . actor . sdk . controllers . settings . BaseActorSettingsFragment ; < nl > - import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; < nl > import im . actor . sdk . intents . ActorIntentFragmentActivity ; < nl > - import im . actor . sdk . util . Screen ; < nl > < nl > public class Application extends ActorSDKApplication { < nl > < nl > @ @ - 81 , 8 + 75 , 7 @ @ public class Application extends ActorSDKApplication { < nl > < nl > / / < nl > @ Override < nl > - public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { < nl > - ArrayList < ShareMenuField > shareMenuFields = new ArrayList < > ( ) ; < nl > + public void addCustomShareMenuFields ( ArrayList < ShareMenuField > shareMenuFields ) { < nl > shareMenuFields . add ( new ShareMenuField ( R . drawable . conv _ location _ icon , ActorSDK . sharedActor ( ) . style . getAccentColor ( ) , " lol " , new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > @ @ - 107 , 7 + 100 , 6 @ @ public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { < nl > Toast . makeText ( v . getContext ( ) , " Hey " , Toast . LENGTH _ LONG ) . show ( ) ; < nl > } < nl > } ) ) ; < nl > - return shareMenuFields ; < nl > } < nl > < nl > / / @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > index 73b6404 . . 343b5e3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > @ @ - 247 , 7 + 247 , 6 @ @ < nl > android : theme = " @ style / CommonActivityTheme " < nl > android : windowSoftInputMode = " adjustResize " / > < nl > < nl > - < nl > < ! - - Actions - - > < nl > < activity < nl > android : name = " . controllers . settings . EditNameActivity " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index f9eb81d . . ca73df8 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 193 , 5 + 193 , 5 @ @ public interface ActorSDKDelegate { < nl > * / < nl > void onShareMenuCreated ( TableLayout shareMenu ) ; < nl > < nl > - ArrayList < ShareMenuField > addCustomShareMenuFields ( ) ; < nl > + void addCustomShareMenuFields ( ArrayList < ShareMenuField > menuFields ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 3adac8b . . f696d9b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 218 , 8 + 218 , 7 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > } < nl > < nl > @ Override < nl > - public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { < nl > - return null ; < nl > + public void addCustomShareMenuFields ( ArrayList < ShareMenuField > menuFields ) { < nl > } < nl > < nl > / / < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 8e39e1a . . 5da8f33 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 434 , 10 + 434 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menuFields . add ( new ShareMenuField ( getString ( R . string . share _ menu _ video ) , R . id . share _ video , R . drawable . share _ video _ selector , shareMenuOCL ) ) ; < nl > menuFields . add ( new ShareMenuField ( getString ( R . string . share _ menu _ contact ) , R . id . share _ contact , R . drawable . share _ contact _ selector , shareMenuOCL ) ) ; < nl > < nl > - ArrayList < ShareMenuField > customMenuFields = ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( ) ; < nl > - if ( customMenuFields ! = null ) { < nl > - menuFields . addAll ( customMenuFields ) ; < nl > - } < nl > + ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( menuFields ) ; < nl > < nl > if ( menuFields . size ( ) % 2 ! = 0 ) { < nl > menuFields . add ( new ShareMenuField ( R . drawable . attach _ hide2 , < nl > @ @ - 811 , 6 + 808 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > checkEmptyBot ( ) ; < nl > } < nl > < nl > + if ( isShareVisible ) { < nl > + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Show ( ) ) ; < nl > + } < nl > < nl > } < nl > < nl > @ @ - 949 , 7 + 949 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > AudioHolder . stopPlaying ( ) ; < nl > / / Saving draft < nl > messenger ( ) . saveDraft ( peer , messageEditText . getText ( ) . toString ( ) ) ; < nl > - < nl > + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Hide ( ) ) ; < nl > } < nl > < nl > / / Message send < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java < nl > index ff9c942 . . 306f3dd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java < nl > @ @ - 47 , 4 + 47 , 28 @ @ public class ShareMenuField { < nl > public View . OnClickListener getOnClickListener ( ) { < nl > return onClickListener ; < nl > } < nl > + < nl > + public void setIcon ( int icon ) { < nl > + this . icon = icon ; < nl > + } < nl > + < nl > + public void setColor ( int color ) { < nl > + this . color = color ; < nl > + } < nl > + < nl > + public void setSelector ( int selector ) { < nl > + this . selector = selector ; < nl > + } < nl > + < nl > + public void setId ( int id ) { < nl > + this . id = id ; < nl > + } < nl > + < nl > + public void setTitle ( String title ) { < nl > + this . title = title ; < nl > + } < nl > + < nl > + public void setOnClickListener ( View . OnClickListener onClickListener ) { < nl > + this . onClickListener = onClickListener ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > index ae014c0 . . d525e76 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > @ @ - 5 , 13 + 5 , 15 @ @ import android . database . Cursor ; < nl > import android . graphics . Bitmap ; < nl > import android . graphics . BitmapFactory ; < nl > import android . net . Uri ; < nl > + import android . os . Environment ; < nl > import android . provider . MediaStore ; < nl > < nl > import java . util . ArrayList ; < nl > - < nl > + import java . util . HashMap ; < nl > import im . actor . core . viewmodel . GalleryVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > + import im . actor . runtime . collections . SparseArray ; < nl > < nl > public class GalleryScannerActor extends Actor { < nl > < nl > @ @ - 22 , 7 + 24 , 7 @ @ public class GalleryScannerActor extends Actor { < nl > Uri uri ; < nl > Cursor cursor ; < nl > int offset = 0 ; < nl > - int column _ index _ data , column _ index _ folder _ name , column _ index _ date ; < nl > + int column _ index _ data , column _ index _ folder _ name , column _ index _ date , column _ index _ id , column _ index _ folder _ id ; < nl > < nl > ArrayList < String > listOfAllImages = new ArrayList < > ( ) ; < nl > ArrayList < String > newMedia = new ArrayList < > ( ) ; < nl > @ @ - 50 , 15 + 52 , 19 @ @ public class GalleryScannerActor extends Actor { < nl > < nl > private void initScan ( ) { < nl > Log . d ( TAG , " init scan " ) ; < nl > - projection = new String [ ] { MediaStore . MediaColumns . DATA , < nl > + projection = new String [ ] { MediaStore . Images . Media . DATA , < nl > + MediaStore . Images . Media . _ ID , < nl > + MediaStore . Images . Media . BUCKET _ ID , < nl > MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME , < nl > - MediaStore . Images . Media . DATE _ MODIFIED } ; < nl > + MediaStore . Images . Media . DATE _ TAKEN } ; < nl > < nl > cursor = getQuery ( ) ; < nl > < nl > if ( cursor ! = null & & cursor . getCount ( ) > 0 ) { < nl > - column _ index _ data = cursor . getColumnIndexOrThrow ( MediaStore . MediaColumns . DATA ) ; < nl > - column _ index _ date = cursor . getColumnIndexOrThrow ( MediaStore . MediaColumns . DATE _ MODIFIED ) ; < nl > + column _ index _ data = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . DATA ) ; < nl > + column _ index _ id = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . _ ID ) ; < nl > + column _ index _ folder _ id = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ ID ) ; < nl > + column _ index _ date = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . DATE _ TAKEN ) ; < nl > column _ index _ folder _ name = cursor < nl > . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME ) ; < nl > < nl > @ @ - 68 , 7 + 74 , 9 @ @ public class GalleryScannerActor extends Actor { < nl > self ( ) . send ( new Scan ( ) ) ; < nl > } else { < nl > Log . d ( TAG , " init scan - no media , let ' s check it in " + CHECK _ NEW _ DELAY ) ; < nl > - schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; < nl > + if ( visible ) { < nl > + schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; < nl > + } < nl > } < nl > < nl > } < nl > @ @ - 76 , 7 + 84 , 7 @ @ public class GalleryScannerActor extends Actor { < nl > private Cursor getQuery ( ) { < nl > try { < nl > return context . getContentResolver ( ) . query ( uri , projection , null , < nl > - null , MediaStore . MediaColumns . DATE _ MODIFIED + " DESC " ) ; < nl > + null , MediaStore . Images . Media . DATE _ TAKEN + " DESC " ) ; < nl > } catch ( Exception e ) { < nl > return null ; < nl > } < nl > @ @ - 92 , 19 + 100 , 23 @ @ public class GalleryScannerActor extends Actor { < nl > } < nl > < nl > offset + = SCAN _ COUNT ; < nl > - if ( offset < cursor . getCount ( ) ) { < nl > - Log . d ( TAG , " scan - iterations , offset - " + offset + " , schedule next in " + SCAN _ DELAY ) ; < nl > - schedule ( new Scan ( ) , SCAN _ DELAY ) ; < nl > - } else { < nl > - Log . d ( TAG , " scanned to end , offset - " + offset + " , schedule check new in " + CHECK _ NEW _ DELAY ) ; < nl > - scanned = true ; < nl > - schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; < nl > - } < nl > + scanned = offset > = cursor . getCount ( ) ; < nl > < nl > - if ( offset % 100 = = 0 | | scanned ) { < nl > + / / < nl > + / / Update VM after 1st batch , every 100 photos , when scanned to end < nl > + / / < nl > + if ( offset = = SCAN _ COUNT | | offset % 100 = = 0 | | scanned ) { < nl > Log . d ( TAG , " scan - update vm , offset - " + offset ) ; < nl > galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; < nl > } < nl > + < nl > + if ( visible ) { < nl > + if ( ! scanned ) { < nl > + schedule ( new Scan ( ) , SCAN _ DELAY ) ; < nl > + } else { < nl > + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; < nl > + } < nl > + } < nl > } < nl > < nl > private void checkNew ( ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java < nl > index 9a3eb07 . . 660001d 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java < nl > @ @ - 1 , 8 + 1 , 6 @ @ < nl > package im . actor . core . viewmodel ; < nl > < nl > import java . util . ArrayList ; < nl > - < nl > - import im . actor . core . entity . StickerPack ; < nl > import im . actor . runtime . mvvm . ValueModel ; < nl > < nl > public class GalleryVM { < nl > diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala b / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala < nl > index d87f645 . . 632a46d 100644 < nl > - - - a / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala < nl > + + + b / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala < nl > @ @ - 40 , 12 + 40 , 14 @ @ trait IncrementalSnapshots [ S < : ProcessorState [ S ] ] extends ProcessorStateControl < nl > < nl > override protected def afterCommit ( e : Event ) : Unit = { < nl > super . afterCommit ( e ) < nl > - _ commitsNum + = 1 < nl > - if ( _ commitsNum > = SnapshotCommitsThreshold & & _ savingSequenceNr ! = snapshotSequenceNr ) { < nl > - log . debug ( " Saving snapshot due to threshold hit " ) < nl > - _ commitsNum = 0 < nl > - _ savingSequenceNr = snapshotSequenceNr < nl > - saveSnapshot ( state . snapshot ) < nl > + if ( recoveryFinished ) { < nl > + _ commitsNum + = 1 < nl > + if ( _ commitsNum > = SnapshotCommitsThreshold & & _ savingSequenceNr ! = snapshotSequenceNr ) { < nl > + log . debug ( " Saving snapshot due to threshold hit " ) < nl > + _ commitsNum = 0 < nl > + _ savingSequenceNr = snapshotSequenceNr < nl > + saveSnapshot ( state . snapshot ) < nl > + } < nl > } < nl > } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml < nl > index 4c6b35d . . 25c5fbf 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml < nl > @ @ - 10 , 7 + 10 , 7 @ @ < nl > android : theme = " @ style / AppTheme " > < nl > < activity < nl > android : name = " . MainActivity " < nl > - android : label = " @ string / title _ activity _ main " > < nl > + android : label = " @ string / app _ name " > < nl > < intent - filter > < nl > < action android : name = " android . intent . action . MAIN " / > < nl > < nl > @ @ - 26 , 7 + 26 , 6 @ @ < nl > android : theme = " @ style / NoBarActivityTheme " < nl > android : windowSoftInputMode = " adjustNothing " / > < nl > < nl > - < nl > < / application > < nl > < nl > < / manifest > < nl > diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index 9bd8c2a . . 9d36309 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 1 , 6 + 1 , 8 @ @ < nl > package im . actor ; < nl > < nl > + import im . actor . core . AuthState ; < nl > import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . BaseActorSDKDelegate ; < nl > < nl > / * * < nl > * Created by badgr on 16 . 10 . 2015 . < nl > @ @ - 9 , 6 + 11 , 14 @ @ public class Application extends android . app . Application { < nl > @ Override < nl > public void onCreate ( ) { < nl > super . onCreate ( ) ; < nl > + ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > ActorSDK . sharedActor ( ) . createActor ( this ) ; < nl > } < nl > + < nl > + private class ActorSDKDelegate extends BaseActorSDKDelegate { < nl > + @ Override < nl > + public AuthState getAuthStartState ( ) { < nl > + return AuthState . AUTH _ EMAIL ; < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java < nl > index e4c2a7d . . 6c7dc8b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java < nl > @ @ - 12 , 6 + 12 , 7 @ @ import android . view . animation . AccelerateDecelerateInterpolator ; < nl > import android . widget . RelativeLayout ; < nl > import android . widget . TextView ; < nl > < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > import im . actor . sdk . util . Screen ; < nl > @ @ - 49 , 9 + 50 , 9 @ @ public class TourActivity extends ActionBarActivity { < nl > findViewById ( R . id . signUpButton ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > - Intent authIntent = new Intent ( TourActivity . this , AuthActivity . class ) ; < nl > - authIntent . putExtra ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ UP ) ; < nl > - startActivity ( authIntent ) ; < nl > + Bundle authExtras = new Bundle ( ) ; < nl > + authExtras . putInt ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ UP ) ; < nl > + ActorSDK . sharedActor ( ) . getActivityManager ( ) . startAuthActivity ( TourActivity . this , authExtras ) ; < nl > finish ( ) ; < nl > < nl > } < nl > @ @ - 60 , 9 + 61 , 9 @ @ public class TourActivity extends ActionBarActivity { < nl > findViewById ( R . id . signIn ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > - Intent authIntent = new Intent ( TourActivity . this , AuthActivity . class ) ; < nl > - authIntent . putExtra ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ IN ) ; < nl > - startActivity ( authIntent ) ; < nl > + Bundle authExtras = new Bundle ( ) ; < nl > + authExtras . putInt ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ IN ) ; < nl > + ActorSDK . sharedActor ( ) . getActivityManager ( ) . startAuthActivity ( TourActivity . this , authExtras ) ; < nl > finish ( ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index e57a646 . . e89067c 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 18 , 10 + 18 , 9 @ @ import im . actor . core . ApiConfiguration ; < nl > import im . actor . core . ConfigurationBuilder ; < nl > import im . actor . core . DeviceCategory ; < nl > import im . actor . core . PlatformType ; < nl > - import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > - import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > import im . actor . sdk . core . AndroidNotifications ; < nl > import im . actor . sdk . core . AndroidPhoneBook ; < nl > + import im . actor . sdk . intents . ActivityManager ; < nl > import im . actor . sdk . services . KeepAliveService ; < nl > import im . actor . sdk . util . Devices ; < nl > import im . actor . sdk . view . emoji . SmileProcessor ; < nl > @ @ - 65 , 7 + 64 , 14 @ @ public class ActorSDK { < nl > * Is Keeping app alive enabled < nl > * / < nl > private boolean isKeepAliveEnabled = false ; < nl > - < nl > + / * * < nl > + * Delegate < nl > + * / < nl > + private ActorSDKDelegate delegate = new BaseActorSDKDelegate ( ) ; < nl > + / * * < nl > + * ActivityManager < nl > + * / < nl > + private ActivityManager activityManager = new ActivityManager ( ) ; < nl > private ActorSDK ( ) { < nl > endpoints . add ( " tls : / / front1 - mtproto - api - rev2 . actor . im " ) ; < nl > endpoints . add ( " tls : / / front2 - mtproto - api - rev2 . actor . im " ) ; < nl > @ @ - 133 , 9 + 139 , 9 @ @ public class ActorSDK { < nl > < nl > public void startMessagingApp ( Activity context ) { < nl > if ( messenger . isLoggedIn ( ) ) { < nl > - context . startActivity ( new Intent ( AndroidContext . getContext ( ) , ActorMainActivity . class ) ) ; < nl > + getActivityManager ( ) . startMessagingActivity ( context ) ; < nl > } else { < nl > - context . startActivity ( new Intent ( context , AuthActivity . class ) ) ; < nl > + getActivityManager ( ) . startAuthActivity ( context ) ; < nl > } < nl > } < nl > < nl > @ @ - 233 , 4 + 239 , 17 @ @ public class ActorSDK { < nl > public void setIsKeepAliveEnabled ( boolean isKeepAliveEnabled ) { < nl > this . isKeepAliveEnabled = isKeepAliveEnabled ; < nl > } < nl > + < nl > + public ActorSDKDelegate getDelegate ( ) { < nl > + return delegate ; < nl > + } < nl > + < nl > + public void setDelegate ( ActorSDKDelegate delegate ) { < nl > + this . delegate = delegate ; < nl > + activityManager . setSdkDelegate ( delegate ) ; < nl > + } < nl > + < nl > + public ActivityManager getActivityManager ( ) { < nl > + return activityManager ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index bdaea38 . . cdf9495 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 1 , 5 + 1 , 6 @ @ < nl > package im . actor . sdk ; < nl > < nl > + import im . actor . core . AuthState ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > public interface ActorSDKDelegate { < nl > @ @ - 24 , 4 + 25 , 6 @ @ public interface ActorSDKDelegate { < nl > * @ return Actor Intent < nl > * / < nl > ActorIntent getStartIntent ( ) ; < nl > + < nl > + AuthState getAuthStartState ( ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 043dcc0 . . 6a2eb02 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 1 , 5 + 1 , 6 @ @ < nl > package im . actor . sdk ; < nl > < nl > + import im . actor . core . AuthState ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > @ @ - 18 , 4 + 19 , 9 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > public ActorIntent getStartIntent ( ) { < nl > return null ; < nl > } < nl > + < nl > + @ Override < nl > + public AuthState getAuthStartState ( ) { < nl > + return AuthState . AUTH _ PHONE ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > index 141861b . . d958ac5 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java < nl > @ @ - 22 , 16 + 22 , 16 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public class AuthActivity extends BaseFragmentActivity { < nl > < nl > - private static final int OAUTH _ DIALOG = 1 ; < nl > - private ProgressDialog progressDialog ; < nl > - private AlertDialog alertDialog ; < nl > - private AuthState state ; < nl > public static final String AUTH _ TYPE _ KEY = " auth _ type " ; < nl > public static final String SIGN _ TYPE _ KEY = " sign _ type " ; < nl > public static final int AUTH _ TYPE _ PHONE = 1 ; < nl > public static final int AUTH _ TYPE _ EMAIL = 2 ; < nl > public static final int SIGN _ TYPE _ IN = 3 ; < nl > public static final int SIGN _ TYPE _ UP = 4 ; < nl > + private static final int OAUTH _ DIALOG = 1 ; < nl > + private ProgressDialog progressDialog ; < nl > + private AlertDialog alertDialog ; < nl > + private AuthState state ; < nl > private int authType = AUTH _ TYPE _ PHONE ; < nl > private int signType ; < nl > < nl > @ @ - 76 , 18 + 76 , 18 @ @ public class AuthActivity extends BaseFragmentActivity { < nl > this . state = state ; < nl > < nl > switch ( state ) { < nl > - case AUTH _ START : < nl > + / / case AUTH _ START : < nl > / / Fragment chooseAuthFr = new ChooseAuthTypeFragment ( ) ; < nl > / / Bundle b = new Bundle ( ) ; < nl > / / b . putInt ( SIGN _ TYPE _ KEY , signType ) ; < nl > / / chooseAuthFr . setArguments ( b ) ; < nl > / / showFragment ( chooseAuthFr , false , false ) ; < nl > / / break ; < nl > - / / case AUTH _ EMAIL : < nl > - / / showFragment ( new SignEmailFragment ( ) , false , false ) ; < nl > - / / authType = AUTH _ TYPE _ EMAIL ; < nl > - / / break ; < nl > - / / case AUTH _ PHONE : < nl > + case AUTH _ EMAIL : < nl > + showFragment ( new SignEmailFragment ( ) , false , false ) ; < nl > + authType = AUTH _ TYPE _ EMAIL ; < nl > + break ; < nl > + case AUTH _ PHONE : < nl > showFragment ( new SignPhoneFragment ( ) , false , false ) ; < nl > authType = AUTH _ TYPE _ PHONE ; < nl > break ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java < nl > new file mode 100644 < nl > index 0000000 . . 30c8f44 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java < nl > @ @ - 0 , 0 + 1 , 73 @ @ < nl > + package im . actor . sdk . intents ; < nl > + < nl > + import android . content . Context ; < nl > + import android . content . Intent ; < nl > + import android . os . Bundle ; < nl > + < nl > + import im . actor . sdk . ActorSDKDelegate ; < nl > + import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > + < nl > + / * * < nl > + * Created by root on 10 / 20 / 15 . < nl > + * / < nl > + public class ActivityManager { < nl > + private ActorSDKDelegate sdkDelegate ; < nl > + < nl > + public void startAuthActivity ( Context context ) { < nl > + startAuthActivity ( context , null ) ; < nl > + } < nl > + < nl > + public void startAuthActivity ( Context context , Bundle extras ) { < nl > + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + startActivity ( context , extras , AuthActivity . class ) ; < nl > + } < nl > + } < nl > + < nl > + public void startAfterLoginActivity ( Context context ) { < nl > + startAfterLoginActivity ( context , null ) ; < nl > + } < nl > + < nl > + public void startAfterLoginActivity ( Context context , Bundle extras ) { < nl > + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + startActivity ( context , extras , ActorMainActivity . class ) ; < nl > + } < nl > + } < nl > + < nl > + public void startMessagingActivity ( Context context ) { < nl > + startMessagingActivity ( context , null ) ; < nl > + } < nl > + < nl > + public void startMessagingActivity ( Context context , Bundle extras ) { < nl > + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { < nl > + startActivity ( context , extras , ActorMainActivity . class ) ; < nl > + } < nl > + } < nl > + < nl > + private boolean startDelegateActivity ( Context context , ActorIntent intent , Bundle extras ) { < nl > + if ( intent ! = null & & intent instanceof ActorIntentActivity ) { < nl > + Intent startIntent = ( ( ActorIntentActivity ) sdkDelegate . getAuthStartIntent ( ) ) . getIntent ( ) ; < nl > + if ( extras ! = null ) { < nl > + startIntent . putExtras ( extras ) ; < nl > + } < nl > + context . startActivity ( startIntent ) ; < nl > + return true ; < nl > + } else { < nl > + return false ; < nl > + } < nl > + < nl > + } < nl > + < nl > + private void startActivity ( Context context , Bundle extras , Class < ? > cls ) { < nl > + Intent intent = new Intent ( context , cls ) ; < nl > + if ( extras ! = null ) { < nl > + intent . putExtras ( extras ) ; < nl > + } < nl > + context . startActivity ( intent ) ; < nl > + } < nl > + < nl > + < nl > + public void setSdkDelegate ( ActorSDKDelegate sdkDelegate ) { < nl > + this . sdkDelegate = sdkDelegate ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > index 2f83c05 . . bda924e 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java < nl > @ @ - 34 , 6 + 34 , 7 @ @ import im . actor . core . viewmodel . Command ; < nl > import im . actor . core . viewmodel . CommandCallback ; < nl > import im . actor . runtime . * ; < nl > import im . actor . runtime . Runtime ; < nl > + import im . actor . sdk . ActorSDK ; < nl > < nl > public class Authentication { < nl > < nl > @ @ - 106 , 7 + 107 , 7 @ @ public class Authentication { < nl > } < nl > } < nl > } else { < nl > - state = AuthState . AUTH _ START ; < nl > + state = ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartState ( ) ; < nl > } < nl > }

TEST DIFF:
diff - - git a / README . MD b / README . MD 
 index 7eb91db . . 42ded3a 100644 
 - - - a / README . MD 
 + + + b / README . MD 
 @ @ - 1 , 6 + 1 , 6 @ @ 
 < h3 align = " center " > 
 < a href = " https : / / github . com / actorapp / actor - platform " > 
 - < img src = " docs / assets / Actor _ Logo . png " width = " 150 " / > 
 + < img src = " docs / assets / Actor _ Logo _ New . png " width = " 150 " / > 
 < br / > 
 Actor 
 < / a > 
 diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index ff97824 . . 6b5273b 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 1 , 32 + 1 , 26 @ @ 
 package im . actor ; 
 
 - import android . content . Context ; 
 import android . os . Bundle ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . CheckBox ; 
 - import android . widget . LinearLayout ; 
 import android . widget . Toast ; 
 
 import java . util . ArrayList ; 
 
 + import im . actor . develop . R ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKApplication ; 
 import im . actor . sdk . ActorStyle ; 
 import im . actor . sdk . BaseActorSDKDelegate ; 
 import im . actor . sdk . controllers . conversation . ShareMenuField ; 
 - import im . actor . sdk . controllers . group . GroupInfoFragment ; 
 - import im . actor . sdk . controllers . profile . ProfileFragment ; 
 import im . actor . sdk . controllers . settings . ActorSettingsCategories ; 
 import im . actor . sdk . controllers . settings . ActorSettingsCategory ; 
 import im . actor . sdk . controllers . settings . ActorSettingsField ; 
 - import im . actor . sdk . controllers . settings . BaseActorProfileActivity ; 
 import im . actor . sdk . controllers . settings . BaseActorSettingsActivity ; 
 import im . actor . sdk . controllers . settings . BaseActorSettingsFragment ; 
 - import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; 
 import im . actor . sdk . intents . ActorIntentFragmentActivity ; 
 - import im . actor . sdk . util . Screen ; 
 
 public class Application extends ActorSDKApplication { 
 
 @ @ - 81 , 8 + 75 , 7 @ @ public class Application extends ActorSDKApplication { 
 
 / / 
 @ Override 
 - public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { 
 - ArrayList < ShareMenuField > shareMenuFields = new ArrayList < > ( ) ; 
 + public void addCustomShareMenuFields ( ArrayList < ShareMenuField > shareMenuFields ) { 
 shareMenuFields . add ( new ShareMenuField ( R . drawable . conv _ location _ icon , ActorSDK . sharedActor ( ) . style . getAccentColor ( ) , " lol " , new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 @ @ - 107 , 7 + 100 , 6 @ @ public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { 
 Toast . makeText ( v . getContext ( ) , " Hey " , Toast . LENGTH _ LONG ) . show ( ) ; 
 } 
 } ) ) ; 
 - return shareMenuFields ; 
 } 
 
 / / @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 index 73b6404 . . 343b5e3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 @ @ - 247 , 7 + 247 , 6 @ @ 
 android : theme = " @ style / CommonActivityTheme " 
 android : windowSoftInputMode = " adjustResize " / > 
 
 - 
 < ! - - Actions - - > 
 < activity 
 android : name = " . controllers . settings . EditNameActivity " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index f9eb81d . . ca73df8 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 193 , 5 + 193 , 5 @ @ public interface ActorSDKDelegate { 
 * / 
 void onShareMenuCreated ( TableLayout shareMenu ) ; 
 
 - ArrayList < ShareMenuField > addCustomShareMenuFields ( ) ; 
 + void addCustomShareMenuFields ( ArrayList < ShareMenuField > menuFields ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 3adac8b . . f696d9b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 218 , 8 + 218 , 7 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 } 
 
 @ Override 
 - public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { 
 - return null ; 
 + public void addCustomShareMenuFields ( ArrayList < ShareMenuField > menuFields ) { 
 } 
 
 / / 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 8e39e1a . . 5da8f33 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 434 , 10 + 434 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menuFields . add ( new ShareMenuField ( getString ( R . string . share _ menu _ video ) , R . id . share _ video , R . drawable . share _ video _ selector , shareMenuOCL ) ) ; 
 menuFields . add ( new ShareMenuField ( getString ( R . string . share _ menu _ contact ) , R . id . share _ contact , R . drawable . share _ contact _ selector , shareMenuOCL ) ) ; 
 
 - ArrayList < ShareMenuField > customMenuFields = ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( ) ; 
 - if ( customMenuFields ! = null ) { 
 - menuFields . addAll ( customMenuFields ) ; 
 - } 
 + ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( menuFields ) ; 
 
 if ( menuFields . size ( ) % 2 ! = 0 ) { 
 menuFields . add ( new ShareMenuField ( R . drawable . attach _ hide2 , 
 @ @ - 811 , 6 + 808 , 9 @ @ public class ChatActivity extends ActorEditTextActivity { 
 checkEmptyBot ( ) ; 
 } 
 
 + if ( isShareVisible ) { 
 + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Show ( ) ) ; 
 + } 
 
 } 
 
 @ @ - 949 , 7 + 949 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 AudioHolder . stopPlaying ( ) ; 
 / / Saving draft 
 messenger ( ) . saveDraft ( peer , messageEditText . getText ( ) . toString ( ) ) ; 
 - 
 + messenger ( ) . getGalleryScannerActor ( ) . send ( new GalleryScannerActor . Hide ( ) ) ; 
 } 
 
 / / Message send 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java 
 index ff9c942 . . 306f3dd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java 
 @ @ - 47 , 4 + 47 , 28 @ @ public class ShareMenuField { 
 public View . OnClickListener getOnClickListener ( ) { 
 return onClickListener ; 
 } 
 + 
 + public void setIcon ( int icon ) { 
 + this . icon = icon ; 
 + } 
 + 
 + public void setColor ( int color ) { 
 + this . color = color ; 
 + } 
 + 
 + public void setSelector ( int selector ) { 
 + this . selector = selector ; 
 + } 
 + 
 + public void setId ( int id ) { 
 + this . id = id ; 
 + } 
 + 
 + public void setTitle ( String title ) { 
 + this . title = title ; 
 + } 
 + 
 + public void setOnClickListener ( View . OnClickListener onClickListener ) { 
 + this . onClickListener = onClickListener ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 index ae014c0 . . d525e76 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 @ @ - 5 , 13 + 5 , 15 @ @ import android . database . Cursor ; 
 import android . graphics . Bitmap ; 
 import android . graphics . BitmapFactory ; 
 import android . net . Uri ; 
 + import android . os . Environment ; 
 import android . provider . MediaStore ; 
 
 import java . util . ArrayList ; 
 - 
 + import java . util . HashMap ; 
 import im . actor . core . viewmodel . GalleryVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 + import im . actor . runtime . collections . SparseArray ; 
 
 public class GalleryScannerActor extends Actor { 
 
 @ @ - 22 , 7 + 24 , 7 @ @ public class GalleryScannerActor extends Actor { 
 Uri uri ; 
 Cursor cursor ; 
 int offset = 0 ; 
 - int column _ index _ data , column _ index _ folder _ name , column _ index _ date ; 
 + int column _ index _ data , column _ index _ folder _ name , column _ index _ date , column _ index _ id , column _ index _ folder _ id ; 
 
 ArrayList < String > listOfAllImages = new ArrayList < > ( ) ; 
 ArrayList < String > newMedia = new ArrayList < > ( ) ; 
 @ @ - 50 , 15 + 52 , 19 @ @ public class GalleryScannerActor extends Actor { 
 
 private void initScan ( ) { 
 Log . d ( TAG , " init scan " ) ; 
 - projection = new String [ ] { MediaStore . MediaColumns . DATA , 
 + projection = new String [ ] { MediaStore . Images . Media . DATA , 
 + MediaStore . Images . Media . _ ID , 
 + MediaStore . Images . Media . BUCKET _ ID , 
 MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME , 
 - MediaStore . Images . Media . DATE _ MODIFIED } ; 
 + MediaStore . Images . Media . DATE _ TAKEN } ; 
 
 cursor = getQuery ( ) ; 
 
 if ( cursor ! = null & & cursor . getCount ( ) > 0 ) { 
 - column _ index _ data = cursor . getColumnIndexOrThrow ( MediaStore . MediaColumns . DATA ) ; 
 - column _ index _ date = cursor . getColumnIndexOrThrow ( MediaStore . MediaColumns . DATE _ MODIFIED ) ; 
 + column _ index _ data = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . DATA ) ; 
 + column _ index _ id = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . _ ID ) ; 
 + column _ index _ folder _ id = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ ID ) ; 
 + column _ index _ date = cursor . getColumnIndexOrThrow ( MediaStore . Images . Media . DATE _ TAKEN ) ; 
 column _ index _ folder _ name = cursor 
 . getColumnIndexOrThrow ( MediaStore . Images . Media . BUCKET _ DISPLAY _ NAME ) ; 
 
 @ @ - 68 , 7 + 74 , 9 @ @ public class GalleryScannerActor extends Actor { 
 self ( ) . send ( new Scan ( ) ) ; 
 } else { 
 Log . d ( TAG , " init scan - no media , let ' s check it in " + CHECK _ NEW _ DELAY ) ; 
 - schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; 
 + if ( visible ) { 
 + schedule ( new InitScan ( ) , CHECK _ NEW _ DELAY ) ; 
 + } 
 } 
 
 } 
 @ @ - 76 , 7 + 84 , 7 @ @ public class GalleryScannerActor extends Actor { 
 private Cursor getQuery ( ) { 
 try { 
 return context . getContentResolver ( ) . query ( uri , projection , null , 
 - null , MediaStore . MediaColumns . DATE _ MODIFIED + " DESC " ) ; 
 + null , MediaStore . Images . Media . DATE _ TAKEN + " DESC " ) ; 
 } catch ( Exception e ) { 
 return null ; 
 } 
 @ @ - 92 , 19 + 100 , 23 @ @ public class GalleryScannerActor extends Actor { 
 } 
 
 offset + = SCAN _ COUNT ; 
 - if ( offset < cursor . getCount ( ) ) { 
 - Log . d ( TAG , " scan - iterations , offset - " + offset + " , schedule next in " + SCAN _ DELAY ) ; 
 - schedule ( new Scan ( ) , SCAN _ DELAY ) ; 
 - } else { 
 - Log . d ( TAG , " scanned to end , offset - " + offset + " , schedule check new in " + CHECK _ NEW _ DELAY ) ; 
 - scanned = true ; 
 - schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; 
 - } 
 + scanned = offset > = cursor . getCount ( ) ; 
 
 - if ( offset % 100 = = 0 | | scanned ) { 
 + / / 
 + / / Update VM after 1st batch , every 100 photos , when scanned to end 
 + / / 
 + if ( offset = = SCAN _ COUNT | | offset % 100 = = 0 | | scanned ) { 
 Log . d ( TAG , " scan - update vm , offset - " + offset ) ; 
 galleryVM . getGalleryMediaPath ( ) . change ( new ArrayList < String > ( listOfAllImages ) ) ; 
 } 
 + 
 + if ( visible ) { 
 + if ( ! scanned ) { 
 + schedule ( new Scan ( ) , SCAN _ DELAY ) ; 
 + } else { 
 + schedule ( new CheckNew ( ) , CHECK _ NEW _ DELAY ) ; 
 + } 
 + } 
 } 
 
 private void checkNew ( ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java 
 index 9a3eb07 . . 660001d 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / GalleryVM . java 
 @ @ - 1 , 8 + 1 , 6 @ @ 
 package im . actor . core . viewmodel ; 
 
 import java . util . ArrayList ; 
 - 
 - import im . actor . core . entity . StickerPack ; 
 import im . actor . runtime . mvvm . ValueModel ; 
 
 public class GalleryVM { 
 diff - - git a / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala b / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala 
 index d87f645 . . 632a46d 100644 
 - - - a / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala 
 + + + b / actor - server / actor - core / src / main / scala / im / actor / server / cqrs / Processor . scala 
 @ @ - 40 , 12 + 40 , 14 @ @ trait IncrementalSnapshots [ S < : ProcessorState [ S ] ] extends ProcessorStateControl 
 
 override protected def afterCommit ( e : Event ) : Unit = { 
 super . afterCommit ( e ) 
 - _ commitsNum + = 1 
 - if ( _ commitsNum > = SnapshotCommitsThreshold & & _ savingSequenceNr ! = snapshotSequenceNr ) { 
 - log . debug ( " Saving snapshot due to threshold hit " ) 
 - _ commitsNum = 0 
 - _ savingSequenceNr = snapshotSequenceNr 
 - saveSnapshot ( state . snapshot ) 
 + if ( recoveryFinished ) { 
 + _ commitsNum + = 1 
 + if ( _ commitsNum > = SnapshotCommitsThreshold & & _ savingSequenceNr ! = snapshotSequenceNr ) { 
 + log . debug ( " Saving snapshot due to threshold hit " ) 
 + _ commitsNum = 0 
 + _ savingSequenceNr = snapshotSequenceNr 
 + saveSnapshot ( state . snapshot ) 
 + } 
 } 
 } 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml 
 index 4c6b35d . . 25c5fbf 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / AndroidManifest . xml 
 @ @ - 10 , 7 + 10 , 7 @ @ 
 android : theme = " @ style / AppTheme " > 
 < activity 
 android : name = " . MainActivity " 
 - android : label = " @ string / title _ activity _ main " > 
 + android : label = " @ string / app _ name " > 
 < intent - filter > 
 < action android : name = " android . intent . action . MAIN " / > 
 
 @ @ - 26 , 7 + 26 , 6 @ @ 
 android : theme = " @ style / NoBarActivityTheme " 
 android : windowSoftInputMode = " adjustNothing " / > 
 
 - 
 < / application > 
 
 < / manifest > 
 diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index 9bd8c2a . . 9d36309 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 1 , 6 + 1 , 8 @ @ 
 package im . actor ; 
 
 + import im . actor . core . AuthState ; 
 import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . BaseActorSDKDelegate ; 
 
 / * * 
 * Created by badgr on 16 . 10 . 2015 . 
 @ @ - 9 , 6 + 11 , 14 @ @ public class Application extends android . app . Application { 
 @ Override 
 public void onCreate ( ) { 
 super . onCreate ( ) ; 
 + ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 ActorSDK . sharedActor ( ) . createActor ( this ) ; 
 } 
 + 
 + private class ActorSDKDelegate extends BaseActorSDKDelegate { 
 + @ Override 
 + public AuthState getAuthStartState ( ) { 
 + return AuthState . AUTH _ EMAIL ; 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java 
 index e4c2a7d . . 6c7dc8b 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / tour / TourActivity . java 
 @ @ - 12 , 6 + 12 , 7 @ @ import android . view . animation . AccelerateDecelerateInterpolator ; 
 import android . widget . RelativeLayout ; 
 import android . widget . TextView ; 
 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 import im . actor . sdk . util . Screen ; 
 @ @ - 49 , 9 + 50 , 9 @ @ public class TourActivity extends ActionBarActivity { 
 findViewById ( R . id . signUpButton ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 - Intent authIntent = new Intent ( TourActivity . this , AuthActivity . class ) ; 
 - authIntent . putExtra ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ UP ) ; 
 - startActivity ( authIntent ) ; 
 + Bundle authExtras = new Bundle ( ) ; 
 + authExtras . putInt ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ UP ) ; 
 + ActorSDK . sharedActor ( ) . getActivityManager ( ) . startAuthActivity ( TourActivity . this , authExtras ) ; 
 finish ( ) ; 
 
 } 
 @ @ - 60 , 9 + 61 , 9 @ @ public class TourActivity extends ActionBarActivity { 
 findViewById ( R . id . signIn ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 - Intent authIntent = new Intent ( TourActivity . this , AuthActivity . class ) ; 
 - authIntent . putExtra ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ IN ) ; 
 - startActivity ( authIntent ) ; 
 + Bundle authExtras = new Bundle ( ) ; 
 + authExtras . putInt ( AuthActivity . SIGN _ TYPE _ KEY , AuthActivity . SIGN _ TYPE _ IN ) ; 
 + ActorSDK . sharedActor ( ) . getActivityManager ( ) . startAuthActivity ( TourActivity . this , authExtras ) ; 
 finish ( ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index e57a646 . . e89067c 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 18 , 10 + 18 , 9 @ @ import im . actor . core . ApiConfiguration ; 
 import im . actor . core . ConfigurationBuilder ; 
 import im . actor . core . DeviceCategory ; 
 import im . actor . core . PlatformType ; 
 - import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 - import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 import im . actor . sdk . core . AndroidNotifications ; 
 import im . actor . sdk . core . AndroidPhoneBook ; 
 + import im . actor . sdk . intents . ActivityManager ; 
 import im . actor . sdk . services . KeepAliveService ; 
 import im . actor . sdk . util . Devices ; 
 import im . actor . sdk . view . emoji . SmileProcessor ; 
 @ @ - 65 , 7 + 64 , 14 @ @ public class ActorSDK { 
 * Is Keeping app alive enabled 
 * / 
 private boolean isKeepAliveEnabled = false ; 
 - 
 + / * * 
 + * Delegate 
 + * / 
 + private ActorSDKDelegate delegate = new BaseActorSDKDelegate ( ) ; 
 + / * * 
 + * ActivityManager 
 + * / 
 + private ActivityManager activityManager = new ActivityManager ( ) ; 
 private ActorSDK ( ) { 
 endpoints . add ( " tls : / / front1 - mtproto - api - rev2 . actor . im " ) ; 
 endpoints . add ( " tls : / / front2 - mtproto - api - rev2 . actor . im " ) ; 
 @ @ - 133 , 9 + 139 , 9 @ @ public class ActorSDK { 
 
 public void startMessagingApp ( Activity context ) { 
 if ( messenger . isLoggedIn ( ) ) { 
 - context . startActivity ( new Intent ( AndroidContext . getContext ( ) , ActorMainActivity . class ) ) ; 
 + getActivityManager ( ) . startMessagingActivity ( context ) ; 
 } else { 
 - context . startActivity ( new Intent ( context , AuthActivity . class ) ) ; 
 + getActivityManager ( ) . startAuthActivity ( context ) ; 
 } 
 } 
 
 @ @ - 233 , 4 + 239 , 17 @ @ public class ActorSDK { 
 public void setIsKeepAliveEnabled ( boolean isKeepAliveEnabled ) { 
 this . isKeepAliveEnabled = isKeepAliveEnabled ; 
 } 
 + 
 + public ActorSDKDelegate getDelegate ( ) { 
 + return delegate ; 
 + } 
 + 
 + public void setDelegate ( ActorSDKDelegate delegate ) { 
 + this . delegate = delegate ; 
 + activityManager . setSdkDelegate ( delegate ) ; 
 + } 
 + 
 + public ActivityManager getActivityManager ( ) { 
 + return activityManager ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index bdaea38 . . cdf9495 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 1 , 5 + 1 , 6 @ @ 
 package im . actor . sdk ; 
 
 + import im . actor . core . AuthState ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 public interface ActorSDKDelegate { 
 @ @ - 24 , 4 + 25 , 6 @ @ public interface ActorSDKDelegate { 
 * @ return Actor Intent 
 * / 
 ActorIntent getStartIntent ( ) ; 
 + 
 + AuthState getAuthStartState ( ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 043dcc0 . . 6a2eb02 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 1 , 5 + 1 , 6 @ @ 
 package im . actor . sdk ; 
 
 + import im . actor . core . AuthState ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 @ @ - 18 , 4 + 19 , 9 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 public ActorIntent getStartIntent ( ) { 
 return null ; 
 } 
 + 
 + @ Override 
 + public AuthState getAuthStartState ( ) { 
 + return AuthState . AUTH _ PHONE ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 index 141861b . . d958ac5 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / auth / AuthActivity . java 
 @ @ - 22 , 16 + 22 , 16 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public class AuthActivity extends BaseFragmentActivity { 
 
 - private static final int OAUTH _ DIALOG = 1 ; 
 - private ProgressDialog progressDialog ; 
 - private AlertDialog alertDialog ; 
 - private AuthState state ; 
 public static final String AUTH _ TYPE _ KEY = " auth _ type " ; 
 public static final String SIGN _ TYPE _ KEY = " sign _ type " ; 
 public static final int AUTH _ TYPE _ PHONE = 1 ; 
 public static final int AUTH _ TYPE _ EMAIL = 2 ; 
 public static final int SIGN _ TYPE _ IN = 3 ; 
 public static final int SIGN _ TYPE _ UP = 4 ; 
 + private static final int OAUTH _ DIALOG = 1 ; 
 + private ProgressDialog progressDialog ; 
 + private AlertDialog alertDialog ; 
 + private AuthState state ; 
 private int authType = AUTH _ TYPE _ PHONE ; 
 private int signType ; 
 
 @ @ - 76 , 18 + 76 , 18 @ @ public class AuthActivity extends BaseFragmentActivity { 
 this . state = state ; 
 
 switch ( state ) { 
 - case AUTH _ START : 
 + / / case AUTH _ START : 
 / / Fragment chooseAuthFr = new ChooseAuthTypeFragment ( ) ; 
 / / Bundle b = new Bundle ( ) ; 
 / / b . putInt ( SIGN _ TYPE _ KEY , signType ) ; 
 / / chooseAuthFr . setArguments ( b ) ; 
 / / showFragment ( chooseAuthFr , false , false ) ; 
 / / break ; 
 - / / case AUTH _ EMAIL : 
 - / / showFragment ( new SignEmailFragment ( ) , false , false ) ; 
 - / / authType = AUTH _ TYPE _ EMAIL ; 
 - / / break ; 
 - / / case AUTH _ PHONE : 
 + case AUTH _ EMAIL : 
 + showFragment ( new SignEmailFragment ( ) , false , false ) ; 
 + authType = AUTH _ TYPE _ EMAIL ; 
 + break ; 
 + case AUTH _ PHONE : 
 showFragment ( new SignPhoneFragment ( ) , false , false ) ; 
 authType = AUTH _ TYPE _ PHONE ; 
 break ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java 
 new file mode 100644 
 index 0000000 . . 30c8f44 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / intents / ActivityManager . java 
 @ @ - 0 , 0 + 1 , 73 @ @ 
 + package im . actor . sdk . intents ; 
 + 
 + import android . content . Context ; 
 + import android . content . Intent ; 
 + import android . os . Bundle ; 
 + 
 + import im . actor . sdk . ActorSDKDelegate ; 
 + import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 + 
 + / * * 
 + * Created by root on 10 / 20 / 15 . 
 + * / 
 + public class ActivityManager { 
 + private ActorSDKDelegate sdkDelegate ; 
 + 
 + public void startAuthActivity ( Context context ) { 
 + startAuthActivity ( context , null ) ; 
 + } 
 + 
 + public void startAuthActivity ( Context context , Bundle extras ) { 
 + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + startActivity ( context , extras , AuthActivity . class ) ; 
 + } 
 + } 
 + 
 + public void startAfterLoginActivity ( Context context ) { 
 + startAfterLoginActivity ( context , null ) ; 
 + } 
 + 
 + public void startAfterLoginActivity ( Context context , Bundle extras ) { 
 + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + startActivity ( context , extras , ActorMainActivity . class ) ; 
 + } 
 + } 
 + 
 + public void startMessagingActivity ( Context context ) { 
 + startMessagingActivity ( context , null ) ; 
 + } 
 + 
 + public void startMessagingActivity ( Context context , Bundle extras ) { 
 + if ( ! startDelegateActivity ( context , sdkDelegate . getAuthStartIntent ( ) , extras ) ) { 
 + startActivity ( context , extras , ActorMainActivity . class ) ; 
 + } 
 + } 
 + 
 + private boolean startDelegateActivity ( Context context , ActorIntent intent , Bundle extras ) { 
 + if ( intent ! = null & & intent instanceof ActorIntentActivity ) { 
 + Intent startIntent = ( ( ActorIntentActivity ) sdkDelegate . getAuthStartIntent ( ) ) . getIntent ( ) ; 
 + if ( extras ! = null ) { 
 + startIntent . putExtras ( extras ) ; 
 + } 
 + context . startActivity ( startIntent ) ; 
 + return true ; 
 + } else { 
 + return false ; 
 + } 
 + 
 + } 
 + 
 + private void startActivity ( Context context , Bundle extras , Class < ? > cls ) { 
 + Intent intent = new Intent ( context , cls ) ; 
 + if ( extras ! = null ) { 
 + intent . putExtras ( extras ) ; 
 + } 
 + context . startActivity ( intent ) ; 
 + } 
 + 
 + 
 + public void setSdkDelegate ( ActorSDKDelegate sdkDelegate ) { 
 + this . sdkDelegate = sdkDelegate ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 index 2f83c05 . . bda924e 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / Authentication . java 
 @ @ - 34 , 6 + 34 , 7 @ @ import im . actor . core . viewmodel . Command ; 
 import im . actor . core . viewmodel . CommandCallback ; 
 import im . actor . runtime . * ; 
 import im . actor . runtime . Runtime ; 
 + import im . actor . sdk . ActorSDK ; 
 
 public class Authentication { 
 
 @ @ - 106 , 7 + 107 , 7 @ @ public class Authentication { 
 } 
 } 
 } else { 
 - state = AuthState . AUTH _ START ; 
 + state = ActorSDK . sharedActor ( ) . getDelegate ( ) . getAuthStartState ( ) ; 
 } 
 }
