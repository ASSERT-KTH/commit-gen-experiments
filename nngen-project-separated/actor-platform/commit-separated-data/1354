BLEU SCORE: 0.10738977135035864

TEST MSG: refactor ( server ) : log connection id on close
GENERATED MSG: perf ( server : frontend ) : flatten instead of map

TEST DIFF (one line): diff - - git a / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala b / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala < nl > index c20e36e . . 4de8a65 100644 < nl > - - - a / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala < nl > + + + b / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala < nl > @ @ - 44 , 9 + 44 , 9 @ @ object MTProtoBlueprint { < nl > case res ⇒ < nl > res match { < nl > case Success ( _ ) ⇒ < nl > - system . log . debug ( " Closing connection " ) < nl > + system . log . debug ( " Closing connection { } " , connId ) < nl > case Failure ( e ) ⇒ < nl > - system . log . debug ( " Closing connection due to error : { } " , e ) < nl > + system . log . debug ( " Closing connection { } due to error : { } " , connId , e ) < nl > } < nl > < nl > connTimeHist . record ( System . currentTimeMillis ( ) - connStartTime )
NEAREST DIFF (one line): diff - - git a / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala b / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala < nl > index c67074c . . ab323a1 100644 < nl > - - - a / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala < nl > + + + b / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala < nl > @ @ - 62 , 10 + 62 , 8 @ @ object WsFrontend extends Frontend { < nl > . collect { < nl > case msg : BinaryMessage ⇒ msg < nl > } < nl > - . mapAsync ( 1 ) { msg : BinaryMessage ⇒ < nl > - / / FIXME : control buffer size < nl > - msg . dataStream . runWith ( Sink . fold ( ByteString . empty ) ( _ + + _ ) ) < nl > - } < nl > + . map ( _ . dataStream ) < nl > + . flatten ( FlattenStrategy . concat ) < nl > . via ( mtProtoFlow ) < nl > . map { < nl > case bs ⇒

TEST DIFF:
diff - - git a / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala b / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala 
 index c20e36e . . 4de8a65 100644 
 - - - a / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala 
 + + + b / actor - server / actor - frontend / src / main / scala / im / actor / server / frontend / MTProtoBlueprint . scala 
 @ @ - 44 , 9 + 44 , 9 @ @ object MTProtoBlueprint { 
 case res ⇒ 
 res match { 
 case Success ( _ ) ⇒ 
 - system . log . debug ( " Closing connection " ) 
 + system . log . debug ( " Closing connection { } " , connId ) 
 case Failure ( e ) ⇒ 
 - system . log . debug ( " Closing connection due to error : { } " , e ) 
 + system . log . debug ( " Closing connection { } due to error : { } " , connId , e ) 
 } 
 
 connTimeHist . record ( System . currentTimeMillis ( ) - connStartTime )

NEAREST DIFF:
diff - - git a / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala b / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala 
 index c67074c . . ab323a1 100644 
 - - - a / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala 
 + + + b / actor - server / actor - frontend / src / main / scala / im / actor / server / api / frontend / WsFrontend . scala 
 @ @ - 62 , 10 + 62 , 8 @ @ object WsFrontend extends Frontend { 
 . collect { 
 case msg : BinaryMessage ⇒ msg 
 } 
 - . mapAsync ( 1 ) { msg : BinaryMessage ⇒ 
 - / / FIXME : control buffer size 
 - msg . dataStream . runWith ( Sink . fold ( ByteString . empty ) ( _ + + _ ) ) 
 - } 
 + . map ( _ . dataStream ) 
 + . flatten ( FlattenStrategy . concat ) 
 . via ( mtProtoFlow ) 
 . map { 
 case bs ⇒
