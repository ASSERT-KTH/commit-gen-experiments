BLEU SCORE: 0.14528679532351443

TEST MSG: fix + chore ( iOS ) : fetch stickers only on keyboard open and get photos permission on open attachment menu
GENERATED MSG: fix ( iOS ) : fix upload video and save point for new attachment menu

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index 2f54661 . . 788c05f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 1339 , 7 + 1339 , 6 @ @ < nl > 	 	 BE2621551C46569800A817AB / * AttachmentView * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > - 	 	 	 	 BE26215A1C4656F100A817AB / * Manager * / , < nl > 	 	 	 	 BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / , < nl > 	 	 	 	 BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / , < nl > 	 	 	 	 BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / , < nl > @ @ - 1347 , 13 + 1346 , 6 @ @ < nl > 	 	 	 name = AttachmentView ; < nl > 	 	 	 sourceTree = " < group > " ; < nl > 	 	 } ; < nl > - 	 	 BE26215A1C4656F100A817AB / * Manager * / = { < nl > - 	 	 	 isa = PBXGroup ; < nl > - 	 	 	 children = ( < nl > - 	 	 	 ) ; < nl > - 	 	 	 name = Manager ; < nl > - 	 	 	 sourceTree = " < group > " ; < nl > - 	 	 } ; < nl > 	 	 BED5A1CF1C4839200045FDB0 / * NYTPhotoViewer * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > index 8f60973 . . fc85adb 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift < nl > @ @ - 218 , 8 + 218 , 10 @ @ public class AABubbleCell : UICollectionViewCell { < nl > } < nl > < nl > public func performBind ( message : ACMessage , setting : AACellSetting , isShowNewMessages : Bool , layout : AACellLayout ) { < nl > - self . clipsToBounds = false < nl > - self . contentView . clipsToBounds = false < nl > + self . clipsToBounds = true < nl > + self . contentView . clipsToBounds = true < nl > + self . layer . drawsAsynchronously = true < nl > + self . contentView . layer . drawsAsynchronously = true < nl > < nl > var reuse = false < nl > if ( bindedMessage ! = nil & & bindedMessage ? . rid = = message . rid ) { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > index 5e4ce78 . . c7ec5b0 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > @ @ - 23 , 7 + 23 , 7 @ @ class AAConvActionSheet : UIView { < nl > var btnContact : UIButton ! < nl > var btnCancel : UIButton ! < nl > < nl > - var thumbnailView = AAThumbnailView ( ) < nl > + var thumbnailView : AAThumbnailView ! < nl > < nl > weak var weakSuper : ConversationViewController ! < nl > < nl > @ @ - 49 , 17 + 49 , 12 @ @ class AAConvActionSheet : UIView { < nl > self . frame = CGRectMake ( 0 , 0 , screenWidth , screenHeigth ) < nl > self . backgroundColor = UIColor . blackColor ( ) . colorWithAlphaComponent ( 0 . 7 ) < nl > < nl > - < nl > - < nl > - / / make photo < nl > - < nl > } < nl > < nl > < nl > deinit { < nl > < nl > self . weakSuper = nil < nl > - < nl > < nl > } < nl > < nl > @ @ - 71 , 6 + 66 , 17 @ @ class AAConvActionSheet : UIView { < nl > < nl > self . weakSuper . navigationController ! . interactivePopGestureRecognizer ! . enabled = false < nl > < nl > + / / < nl > + < nl > + if ( self . thumbnailView = = nil ) { < nl > + < nl > + self . thumbnailView = AAThumbnailView ( ) < nl > + self . sheetView . addSubview ( self . thumbnailView ) < nl > + self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) < nl > + self . thumbnailView . bindedConvSheet = self < nl > + < nl > + } < nl > + < nl > UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in < nl > self . sheetView . frame = frame < nl > self . alpha = 1 < nl > @ @ - 117 , 30 + 123 , 30 @ @ class AAConvActionSheet : UIView { < nl > < nl > self . addSubview ( self . sheetView ) < nl > < nl > - self . btnCamera = UIButton ( type : UIButtonType . System ) < nl > - self . btnLibrary = UIButton ( type : UIButtonType . System ) < nl > - self . btnDocuments = UIButton ( type : UIButtonType . System ) < nl > - self . btnLocation = UIButton ( type : UIButtonType . System ) < nl > - self . btnContact = UIButton ( type : UIButtonType . System ) < nl > - self . btnCancel = UIButton ( type : UIButtonType . System ) < nl > + self . btnCamera = UIButton ( type : UIButtonType . System ) < nl > + self . btnLibrary = UIButton ( type : UIButtonType . System ) < nl > + self . btnDocuments = UIButton ( type : UIButtonType . System ) < nl > + self . btnLocation = UIButton ( type : UIButtonType . System ) < nl > + self . btnContact = UIButton ( type : UIButtonType . System ) < nl > + self . btnCancel = UIButton ( type : UIButtonType . System ) < nl > < nl > / / color < nl > < nl > - self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > - self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > - self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > - self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > - self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > - self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > < nl > / / font size < nl > < nl > - self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > - self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > - self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > - self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > - self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > - self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > < nl > / / add buttons as subivews < nl > < nl > @ @ - 150 , 15 + 156 , 15 @ @ class AAConvActionSheet : UIView { < nl > self . sheetView . addSubview ( self . btnLocation ) < nl > self . sheetView . addSubview ( self . btnContact ) < nl > self . sheetView . addSubview ( self . btnCancel ) < nl > - self . sheetView . addSubview ( self . thumbnailView ) < nl > + / / self . sheetView . addSubview ( self . thumbnailView ) < nl > < nl > - self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) < nl > - self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) < nl > - self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) < nl > - self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) < nl > - self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) < nl > - self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) < nl > - self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) < nl > + / / self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) < nl > + self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) < nl > + self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) < nl > + self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) < nl > + self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) < nl > + self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) < nl > + self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) < nl > < nl > / / separators < nl > < nl > @ @ - 204 , 7 + 210 , 7 @ @ class AAConvActionSheet : UIView { < nl > < nl > / / bineded self < nl > < nl > - self . thumbnailView . bindedConvSheet = self < nl > + / / self . thumbnailView . bindedConvSheet = self < nl > < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift < nl > index 1018daf . . 5391fac 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift < nl > @ @ - 174 , 8 + 174 , 6 @ @ class AAStickersView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > < nl > self . backgroundColor = UIColor . clearColor ( ) < nl > < nl > - self . loadStickers ( ) < nl > - < nl > } < nl > < nl > required init ? ( coder aDecoder : NSCoder ) { < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > index 7a03ef1 . . 43fadd6 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > @ @ - 23 , 7 + 23 , 7 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > < nl > private var assets = [ PHAsset ] ( ) < nl > var selectedAssets = [ PHAsset ] ( ) < nl > - private var imageManager = PHCachingImageManager ( ) < nl > + private var imageManager : PHCachingImageManager ! < nl > < nl > private let minimumPreviewHeight : CGFloat = 90 < nl > private var maximumPreviewHeight : CGFloat = 90 < nl > @ @ - 54 , 6 + 54 , 8 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > < nl > func open ( ) { < nl > < nl > + self . imageManager = PHCachingImageManager ( ) < nl > + < nl > if PHPhotoLibrary . authorizationStatus ( ) = = . Authorized { < nl > fetchAssets ( ) < nl > self . collectionView . reloadData ( ) < nl > @ @ - 204 , 34 + 206 , 6 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > } < nl > < nl > < nl > - / / let priority = DISPATCH _ QUEUE _ PRIORITY _ DEFAULT < nl > - / / dispatch _ async ( dispatch _ get _ global _ queue ( priority , 0 ) ) { < nl > - / / / / do some task < nl > - / / < nl > - / / self . requestOptions . synchronous = true < nl > - / / < nl > - / / self . imageManagerForOrig . requestImageDataForAsset ( photoModel , options : self . requestOptions , resultHandler : { ( data , _ , _ , _ ) - > Void in < nl > - / / if data ! = nil { < nl > - / / < nl > - / / let imageFromAsset = UIImage ( data : data ! ) ! < nl > - / / var complitedImage : UIImage ! < nl > - / / < nl > - / / if imageFromAsset . size . width > imageFromAsset . size . height { < nl > - / / complitedImage = self . imageByCroppingImage ( imageFromAsset , toSize : CGSizeMake ( imageFromAsset . size . height , imageFromAsset . size . height ) ) < nl > - / / } else { < nl > - / / complitedImage = self . imageByCroppingImage ( imageFromAsset , toSize : CGSizeMake ( imageFromAsset . size . width , imageFromAsset . size . width ) ) < nl > - / / } < nl > - / / < nl > - / / dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { < nl > - / / / / update some UI < nl > - / / cell . imgThumbnails . image = complitedImage < nl > - / / } < nl > - / / } < nl > - / / } ) < nl > - / / < nl > - / / } < nl > - < nl > - < nl > return cell < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > index 0428791 . . 706ac5f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj < nl > @ @ - 273 , 7 + 273 , 6 @ @ < nl > 	 	 BE2621571C4656D700A817AB / * AAConvActionSheet . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / ; } ; < nl > 	 	 BE2621591C4656EE00A817AB / * AAThumbnailView . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / ; } ; < nl > 	 	 BEAC2B311C42D683007F7A2F / * libopus . a in Frameworks * / = { isa = PBXBuildFile ; fileRef = 15F89F001C211FDE00776ACD / * libopus . a * / ; } ; < nl > - 	 	 BEF11DB51C4657D20076400A / * AAASAssetManager . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / ; } ; < nl > 	 	 BEF11DB61C466D800076400A / * begin _ record . caf in Resources * / = { isa = PBXBuildFile ; fileRef = 153F6B3C1C2A9B1900C0B960 / * begin _ record . caf * / ; } ; < nl > 	 	 BEFE68D51C4657360001F2D6 / * AAThumbnailCollectionCell . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / ; } ; < nl > / * End PBXBuildFile section * / < nl > @ @ - 555 , 7 + 554 , 6 @ @ < nl > 	 	 BE237C9C1C422FFA00060648 / * AAStickersView . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAStickersView . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAConvActionSheet . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAThumbnailView . swift ; sourceTree = " < group > " ; } ; < nl > - 	 	 BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAASAssetManager . swift ; sourceTree = " < group > " ; } ; < nl > 	 	 BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAThumbnailCollectionCell . swift ; sourceTree = " < group > " ; } ; < nl > / * End PBXFileReference section * / < nl > < nl > @ @ - 1320 , 7 + 1318 , 6 @ @ < nl > 	 	 BE26215A1C4656F100A817AB / * Manager * / = { < nl > 	 	 	 isa = PBXGroup ; < nl > 	 	 	 children = ( < nl > - 	 	 	 	 BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / , < nl > 	 	 	 ) ; < nl > 	 	 	 name = Manager ; < nl > 	 	 	 sourceTree = " < group > " ; < nl > @ @ - 1692 , 7 + 1689 , 6 @ @ < nl > 	 	 	 	 15D35F671C20187E00E3717A / * NSObject + TGLock . m in Sources * / , < nl > 	 	 	 	 15D35F5C1C20187E00E3717A / * AAAudioPlayer . m in Sources * / , < nl > 	 	 	 	 152AA8BF1C298C4B0030DEEE / * AASettingsLastSeenController . swift in Sources * / , < nl > - 	 	 	 	 BEF11DB51C4657D20076400A / * AAASAssetManager . swift in Sources * / , < nl > 	 	 	 	 066A51561BC4BEF5000E606E / * AALocalized . swift in Sources * / , < nl > 	 	 	 	 069CF4CF1BCB909A00C66E12 / * CLToken . m in Sources * / , < nl > 	 	 	 	 15D35F751C201B6B00E3717A / * AACustomPresentationController . swift in Sources * / , < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift < nl > index b6bf9c5 . . 006ea4f 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift < nl > @ @ - 37 , 7 + 37 , 6 @ @ public extension ACCocoaMessenger { < nl > let path = CocoaFiles . pathFromDescriptor ( descriptor ) ; < nl > < nl > videoData . writeToFile ( path , atomically : true ) / / write to file < nl > - < nl > < nl > / / get video duration < nl > < nl > @ @ - 55 , 8 + 54 , 9 @ @ public extension ACCocoaMessenger { < nl > do { < nl > let imageRef = try imageGenerator . copyCGImageAtTime ( thumbnailTime , actualTime : nil ) < nl > let thumbnail = UIImage ( CGImage : imageRef ) < nl > - let thumbData = UIImageJPEGRepresentation ( thumbnail , 0 . 55 ) ; / / thumbnail binary data < nl > - let fastThumb = ACFastThumb ( int : jint ( thumbnail . size . width ) , withInt : jint ( thumbnail . size . height ) , withByteArray : thumbData ! . toJavaBytes ( ) ) < nl > + let thumb = thumbnail . resizeSquare ( 90 , maxH : 90 ) ; < nl > + let thumbData = UIImageJPEGRepresentation ( thumb , 0 . 55 ) ; / / thumbnail binary data < nl > + let fastThumb = ACFastThumb ( int : jint ( thumb . size . width ) , withInt : jint ( thumb . size . height ) , withByteArray : thumbData ! . toJavaBytes ( ) ) < nl > < nl > print ( " video upload imageRef = \ ( imageRef ) " ) < nl > print ( " video upload thumbnail = \ ( thumbnail ) " ) < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > index a70b6c6 . . 01a0edb 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift < nl > @ @ - 40 , 11 + 40 , 8 @ @ public class ActorSDK { < nl > / / / Server Endpoints < nl > public var endpoints = [ < nl > " tls : / / front1 - mtproto - api - rev2 . actor . im " , < nl > - " tls : / / front2 - mtproto - api - rev2 . actor . im " , < nl > + " tls : / / front2 - mtproto - api - rev2 . actor . im " < nl > < nl > - " tcp : / / front1 - mtproto - api - rev3 . actor . im : 443 " , < nl > - " tcp : / / front2 - mtproto - api - rev3 . actor . im : 443 " , < nl > - " tcp : / / front3 - mtproto - api - rev3 . actor . im : 443 " < nl > ] { < nl > didSet { < nl > trustedKeys = [ ] < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift < nl > deleted file mode 100644 < nl > index 1850eeb . . 0000000 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift < nl > + + + / dev / null < nl > @ @ - 1 , 250 + 0 , 0 @ @ < nl > - / / < nl > - / / AAASAssetManager . swift < nl > - / / ActorSDK < nl > - / / < nl > - / / Created by kioshimafx on 1 / 13 / 16 . < nl > - / / Copyright © 2016 Steve Kite . All rights reserved . < nl > - / / < nl > - < nl > - import UIKit < nl > - import AssetsLibrary < nl > - < nl > - let ASSET _ PHOTO _ THUMBNAIL : Int = 0 < nl > - let ASSET _ PHOTO _ ASPECT _ THUMBNAIL : Int = 1 < nl > - let ASSET _ PHOTO _ SCREEN _ SIZE : Int = 2 < nl > - let ASSET _ PHOTO _ FULL _ RESOLUTION : Int = 3 < nl > - < nl > - let kNotificationSendPhotos = " NotificationSendPhotos " < nl > - let kNotificationUpdateSelected = " NotificationUpdateSelected " < nl > - < nl > - class AAAssetPhoto { < nl > - < nl > - var asset : ALAsset ! < nl > - var index : Int ! < nl > - var isSelected : Bool ! < nl > - var groupIndex : String ! < nl > - < nl > - var group : Int ! < nl > - < nl > - init ( groupIn : Int , indexIn : Int , assetIn : ALAsset ) { < nl > - < nl > - self . group = groupIn < nl > - self . index = indexIn < nl > - self . asset = assetIn < nl > - self . isSelected = true < nl > - < nl > - self . groupIndex = " \ ( group ) - \ ( index ) " < nl > - < nl > - } < nl > - < nl > - } < nl > - < nl > - class AAASAssetManager : NSObject { < nl > - < nl > - / / # # # singleton # # # < nl > - static let sharedInstance = AAASAssetManager ( ) < nl > - < nl > - var maxSelected : Int ! < nl > - var currentGroupIndex : Int ! < nl > - < nl > - / / / < nl > - < nl > - var assetPhotos : Array < ALAsset > ! < nl > - var selectedPhotos : Array < AAAssetPhoto > ! < nl > - < nl > - / / / < nl > - < nl > - var assetsLibrary : ALAssetsLibrary ! < nl > - var assetGroups : Array < ALAssetsGroup > ! < nl > - var selectedAsset : ALAsset ! < nl > - < nl > - override init ( ) { < nl > - < nl > - self . selectedPhotos = Array < AAAssetPhoto > ( ) < nl > - self . assetsLibrary = ALAssetsLibrary ( ) < nl > - self . assetsLibrary . writeImageToSavedPhotosAlbum ( nil , metadata : nil ) { ( _ , _ ) - > Void in < nl > - / / < nl > - } < nl > - < nl > - } < nl > - < nl > - / / messages _ setActivity ( user _ id : Int , reqResponse : ( VKResponse ! ) - > ( ) < nl > - < nl > - func getSavedPhotoList ( result : ( Array < AnyObject > ! ) - > ( ) , error : ( String ) - > ( ) ) { < nl > - < nl > - < nl > - dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { ( ) - > Void in < nl > - / / < nl > - } < nl > - < nl > - < nl > - } < nl > - < nl > - < nl > - func getGroupCount ( ) - > Int { < nl > - return self . assetGroups . count < nl > - } < nl > - < nl > - func getPhotoCountOfCurrentGroup ( ) - > Int { < nl > - return self . assetPhotos . count < nl > - } < nl > - < nl > - func getSelectedPhotoCount ( ) - > Int { < nl > - < nl > - let selectedArray = self . selectedPhotos . filter ( { < nl > - $ 0 . isSelected = = true < nl > - } ) < nl > - < nl > - return selectedArray . count < nl > - } < nl > - < nl > - func clearData ( ) { < nl > - < nl > - self . selectedPhotos . removeAll ( ) < nl > - self . assetGroups . removeAll ( ) < nl > - self . assetPhotos . removeAll ( ) < nl > - < nl > - < nl > - self . selectedPhotos = nil < nl > - self . assetGroups = nil < nl > - self . assetPhotos = nil < nl > - < nl > - } < nl > - < nl > - / / / / < nl > - < nl > - < nl > - func getImageFromAsset ( asset : ALAsset , type : Int ) - > UIImage { < nl > - / * < nl > - NSString * strXMP = asset . defaultRepresentation . metadata [ @ " AdjustmentXMP " ] ; < nl > - if ( strXMP = = nil | | [ strXMP isKindOfClass : [ NSNull class ] ] ) < nl > - { < nl > - iRef = [ asset . defaultRepresentation fullResolutionImage ] ; < nl > - return [ UIImage imageWithCGImage : iRef scale : 1 . 0 orientation : ( UIImageOrientation ) asset . defaultRepresentation . orientation ] ; < nl > - } < nl > - else < nl > - { < nl > - NSData * dXMP = [ strXMP dataUsingEncoding : NSUTF8StringEncoding ] ; < nl > - < nl > - CIImage * image = [ CIImage imageWithCGImage : asset . defaultRepresentation . fullResolutionImage ] ; < nl > - < nl > - NSError * error = nil ; < nl > - NSArray * filterArray = [ CIFilter filterArrayFromSerializedXMP : dXMP < nl > - inputImageExtent : image . extent < nl > - error : & error ] ; < nl > - if ( error ) { < nl > - NSLog ( @ " Error during CIFilter creation : % @ " , [ error localizedDescription ] ) ; < nl > - } < nl > - < nl > - for ( CIFilter * filter in filterArray ) { < nl > - [ filter setValue : image forKey : kCIInputImageKey ] ; < nl > - image = [ filter outputImage ] ; < nl > - } < nl > - CIContext * context = [ CIContext contextWithOptions : nil ] ; < nl > - CGImageRef cgimage = [ context createCGImage : image fromRect : [ image extent ] ] ; < nl > - UIImage * iImage = [ UIImage imageWithCGImage : cgimage scale : 1 . 0 orientation : ( UIImageOrientation ) asset . defaultRepresentation . orientation ] ; < nl > - return iImage ; < nl > - * / < nl > - < nl > - var imageRef : CGImageRef ! < nl > - < nl > - if ( type = = ASSET _ PHOTO _ THUMBNAIL ) { < nl > - imageRef = asset . thumbnail ( ) as ! CGImageRef < nl > - } else if ( type = = ASSET _ PHOTO _ ASPECT _ THUMBNAIL ) { < nl > - imageRef = asset . aspectRatioThumbnail ( ) as ! CGImageRef < nl > - } else if ( type = = ASSET _ PHOTO _ SCREEN _ SIZE ) { < nl > - imageRef = asset . defaultRepresentation ( ) as ! CGImageRef < nl > - } else if ( type = = ASSET _ PHOTO _ FULL _ RESOLUTION ) { < nl > - imageRef = asset . defaultRepresentation ( ) as ! CGImageRef < nl > - / / let strXMP = asset . defaultRepresentation ( ) . metadata ( ) [ " AdjustmentXMP " ] < nl > - < nl > - < nl > - < nl > - < nl > - } < nl > - < nl > - return UIImage ( CGImage : imageRef ) < nl > - } < nl > - < nl > - func getImageAtIndex ( nIndex : Int , nType : Int ) - > UIImage { < nl > - return getImageFromAsset ( self . assetPhotos [ nIndex ] , type : nType ) < nl > - } < nl > - < nl > - func getImagePreviewAtIndex ( nIndex : Int , nType : Int ) - > UIImage { < nl > - let photoObj = self . selectedPhotos [ nIndex ] < nl > - return getImageFromAsset ( photoObj . asset , type : nType ) < nl > - } < nl > - < nl > - func getAssetAtIndex ( index : Int ) - > ALAsset { < nl > - return self . assetPhotos [ index ] < nl > - } < nl > - < nl > - func getGroupAtIndex ( index : Int ) - > ALAssetsGroup { < nl > - return self . assetGroups [ index ] < nl > - } < nl > - < nl > - func sendSelectedPhotos ( type : Int ) - > Array < UIImage > { < nl > - < nl > - var sendArray = Array < UIImage > ( ) < nl > - < nl > - for ( _ , photoObj ) in self . selectedPhotos . enumerate ( ) { < nl > - < nl > - let image = self . getImageFromAsset ( photoObj . asset , type : type ) < nl > - sendArray . append ( image ) < nl > - < nl > - } < nl > - < nl > - self . selectedPhotos . removeAll ( ) < nl > - < nl > - return sendArray < nl > - } < nl > - < nl > - func addObjectWithIndex ( index : Int ) { < nl > - < nl > - let model = AAAssetPhoto ( groupIn : self . currentGroupIndex , indexIn : index , assetIn : self . assetPhotos [ index ] ) < nl > - < nl > - self . selectedPhotos . append ( model ) < nl > - < nl > - / / [ [ NSNotificationCenter defaultCenter ] postNotificationName : kNotificationUpdateSelected object : nil ] ; < nl > - < nl > - } < nl > - < nl > - < nl > - func removeObjectWithIndex ( index : Int ) { < nl > - < nl > - let groupIndex = " \ ( self . currentGroupIndex ! ) - \ ( index ) " < nl > - < nl > - let results = self . selectedPhotos . filter ( { < nl > - $ 0 . groupIndex = = groupIndex < nl > - } ) < nl > - < nl > - if ( results . count > 0 ) { < nl > - < nl > - / / let model = results [ 0 ] < nl > - < nl > - < nl > - } < nl > - < nl > - < nl > - } < nl > - < nl > - < nl > - func currentGroupFirstIndex ( ) - > Int { < nl > - < nl > - let results = self . selectedPhotos . filter ( { < nl > - $ 0 . group = = self . currentGroupIndex < nl > - } ) < nl > - < nl > - if ( results . count > 0 ) { < nl > - < nl > - let model = results [ 0 ] < nl > - return model . index < nl > - < nl > - } < nl > - < nl > - return 0 < nl > - } < nl > - < nl > - < nl > - < nl > - } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > index d235ec3 . . d0bc182 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift < nl > @ @ - 12 , 21 + 12 , 27 @ @ protocol AAActionSheetDelegate { < nl > func actionSheetDidFinished ( selectedObjs : Array < AnyObject > ) < nl > } < nl > < nl > + let screenWidth = UIScreen . mainScreen ( ) . bounds . size . width < nl > + let screenHeigth = UIScreen . mainScreen ( ) . bounds . size . height < nl > + < nl > class AAConvActionSheet : UIView { < nl > < nl > var delegate : AAActionSheetDelegate ? < nl > < nl > var sheetView : UIView ! < nl > - var btnAlbum : UIButton ! < nl > + < nl > var btnCamera : UIButton ! < nl > + var btnLibrary : UIButton ! < nl > + var btnDocuments : UIButton ! < nl > + var btnLocation : UIButton ! < nl > + var btnContact : UIButton ! < nl > var btnCancel : UIButton ! < nl > - var thumbnailView : AAThumbnailView ! < nl > + < nl > + var thumbnailView = AAThumbnailView ( ) < nl > < nl > weak var weakSuper : ConversationViewController ! < nl > < nl > < nl > - let screenWidth = UIScreen . mainScreen ( ) . bounds . size . width < nl > - let screenHeigth = UIScreen . mainScreen ( ) . bounds . size . height < nl > < nl > init ( maxSelected : Int , weakSuperIn : ConversationViewController ) { < nl > super . init ( frame : CGRectZero ) < nl > @ @ - 48 , 14 + 54 , 12 @ @ class AAConvActionSheet : UIView { < nl > < nl > self . alpha = 0 < nl > self . frame = CGRectMake ( 0 , 0 , screenWidth , screenHeigth ) < nl > - self . backgroundColor = UIColor . clearColor ( ) < nl > + self . backgroundColor = UIColor . blackColor ( ) . colorWithAlphaComponent ( 0 . 5 ) < nl > + < nl > < nl > - self . addSubview ( self . sheetView ) < nl > < nl > - / / self . sheetView . addSubview ( self . btnCancel ) < nl > - / / self . sheetView . addSubview ( self . btnAlbum ) < nl > - / / self . sheetView . addSubview ( self . btnCamera ) < nl > - / / self . sheetView . addSubview ( self . thumbnailView ) < nl > + / / make photo < nl > + < nl > < nl > self . configNotification ( ) < nl > < nl > @ @ - 63 , 17 + 67 , 13 @ @ class AAConvActionSheet : UIView { < nl > < nl > func configNotification ( ) { < nl > < nl > - NSNotificationCenter . defaultCenter ( ) . addObserver ( self , selector : " " , name : kNotificationSendPhotos , object : nil ) < nl > - NSNotificationCenter . defaultCenter ( ) . addObserver ( self , selector : " " , name : kNotificationUpdateSelected , object : nil ) < nl > < nl > } < nl > < nl > deinit { < nl > < nl > self . weakSuper = nil < nl > - < nl > - AAASAssetManager . sharedInstance . clearData ( ) < nl > - NSNotificationCenter . defaultCenter ( ) . removeObserver ( self ) < nl > + < nl > < nl > } < nl > < nl > @ @ - 81 , 19 + 81 , 22 @ @ class AAConvActionSheet : UIView { < nl > func showAnimation ( ) { < nl > < nl > / / self . btnCamera . selected = true < nl > - / / self . thumbnailView . reloadView ( ) < nl > / / self . btnCamera . setTitle ( " Camera " , forState : UIControlState . Normal ) < nl > < nl > var frame = self . sheetView . frame < nl > - frame . origin . y = screenHeigth - 350 < nl > + frame . origin . y = screenHeigth - 400 < nl > < nl > UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in < nl > self . sheetView . frame = frame < nl > self . alpha = 1 < nl > < nl > + self . thumbnailView . open ( ) < nl > + self . thumbnailView . reloadView ( ) < nl > + < nl > } < nl > < nl > < nl > + < nl > } < nl > < nl > func cancelAnimation ( ) { < nl > @ @ - 101 , 10 + 104 , 10 @ @ class AAConvActionSheet : UIView { < nl > var frame = self . sheetView . frame < nl > frame . origin . y = screenHeigth < nl > < nl > - UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in < nl > + UIView . animateWithDuration ( 0 . 25 , animations : { ( ) - > Void in < nl > self . sheetView . frame = frame < nl > self . alpha = 0 < nl > - < nl > + } ) { ( bool ) - > Void in < nl > } < nl > < nl > } < nl > @ @ - 117 , 21 + 120 , 128 @ @ class AAConvActionSheet : UIView { < nl > < nl > < nl > / / sheet view < nl > - let frame = CGRectMake ( 0 , screenHeigth , screenWidth , 350 ) < nl > + let frame = CGRectMake ( 0 , screenHeigth , screenWidth , 400 ) < nl > self . sheetView = UIView ( frame : frame ) < nl > - self . sheetView . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 231 . 0 / 255 . 0 , blue : 234 . 0 / 255 . 0 , alpha : 1 ) < nl > - < nl > - < nl > - / / button cancel < nl > - < nl > - self . btnCancel = UIButton ( type : UIButtonType . Custom ) < nl > - < nl > - / / thumbnail view < nl > - < nl > - < nl > + self . sheetView . backgroundColor = UIColor . whiteColor ( ) < nl > < nl > + self . addSubview ( self . sheetView ) < nl > < nl > + self . btnCamera = UIButton ( type : UIButtonType . System ) < nl > + self . btnLibrary = UIButton ( type : UIButtonType . System ) < nl > + self . btnDocuments = UIButton ( type : UIButtonType . System ) < nl > + self . btnLocation = UIButton ( type : UIButtonType . System ) < nl > + self . btnContact = UIButton ( type : UIButtonType . System ) < nl > + self . btnCancel = UIButton ( type : UIButtonType . System ) < nl > + < nl > + / / color < nl > + < nl > + self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) < nl > + < nl > + / / font size < nl > + < nl > + self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) < nl > + < nl > + / / add buttons as subivews < nl > + < nl > + self . sheetView . addSubview ( self . btnCamera ) < nl > + self . sheetView . addSubview ( self . btnLibrary ) < nl > + self . sheetView . addSubview ( self . btnDocuments ) < nl > + self . sheetView . addSubview ( self . btnLocation ) < nl > + self . sheetView . addSubview ( self . btnContact ) < nl > + self . sheetView . addSubview ( self . btnCancel ) < nl > + self . sheetView . addSubview ( self . thumbnailView ) < nl > + < nl > + self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 100 ) < nl > + self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) < nl > + self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) < nl > + self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) < nl > + self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) < nl > + self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) < nl > + self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) < nl > + < nl > + / / separators < nl > + < nl > + let spearator1 = UIView ( frame : CGRectMake ( 0 , 99 , screenWidth , 1 ) ) < nl > + spearator1 . backgroundColor = UIColor ( red : 223 . 9 / 255 . 0 , green : 223 . 9 / 255 . 0 , blue : 223 . 9 / 255 . 0 , alpha : 0 . 6 ) < nl > + let spearator2 = UIView ( frame : CGRectMake ( 10 , 149 , screenWidth - 20 , 1 ) ) < nl > + spearator2 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) < nl > + let spearator3 = UIView ( frame : CGRectMake ( 10 , 199 , screenWidth - 20 , 1 ) ) < nl > + spearator3 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) < nl > + let spearator4 = UIView ( frame : CGRectMake ( 10 , 249 , screenWidth - 20 , 1 ) ) < nl > + spearator4 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) < nl > + let spearator5 = UIView ( frame : CGRectMake ( 10 , 299 , screenWidth - 20 , 1 ) ) < nl > + spearator5 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) < nl > + let spearator6 = UIView ( frame : CGRectMake ( 10 , 349 , screenWidth - 20 , 1 ) ) < nl > + spearator6 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) < nl > + < nl > + / / add separatos as subview < nl > + < nl > + self . sheetView . addSubview ( spearator1 ) < nl > + self . sheetView . addSubview ( spearator2 ) < nl > + self . sheetView . addSubview ( spearator3 ) < nl > + self . sheetView . addSubview ( spearator4 ) < nl > + self . sheetView . addSubview ( spearator5 ) < nl > + self . sheetView . addSubview ( spearator6 ) < nl > + < nl > + / / set title for buttons < nl > + < nl > + self . btnCamera . setTitle ( AALocalized ( " PhotoCamera " ) , forState : UIControlState . Normal ) < nl > + self . btnLibrary . setTitle ( AALocalized ( " PhotoLibrary " ) , forState : UIControlState . Normal ) < nl > + self . btnDocuments . setTitle ( AALocalized ( " SendDocument " ) , forState : UIControlState . Normal ) < nl > + self . btnLocation . setTitle ( AALocalized ( " ShareLocation " ) , forState : UIControlState . Normal ) < nl > + self . btnContact . setTitle ( AALocalized ( " ShareContact " ) , forState : UIControlState . Normal ) < nl > + self . btnCancel . setTitle ( AALocalized ( " AlertCancel " ) , forState : UIControlState . Normal ) < nl > + < nl > + / / add actins < nl > + < nl > + self . btnCamera . addTarget ( self , action : " btnCameraAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + self . btnLibrary . addTarget ( self , action : " btnLibraryAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + self . btnDocuments . addTarget ( self , action : " btnDocumentAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + self . btnLocation . addTarget ( self , action : " btnLocationAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + self . btnContact . addTarget ( self , action : " btnContactAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + self . btnCancel . addTarget ( self , action : " btnCloseAction " , forControlEvents : UIControlEvents . TouchUpInside ) < nl > + < nl > + } < nl > + < nl > + / / MARK : - Button ' s actions < nl > + < nl > + func btnCameraAction ( ) { < nl > + cancelAnimation ( ) < nl > + self . weakSuper . pickImage ( . Camera ) < nl > } < nl > < nl > + func btnLibraryAction ( ) { < nl > + cancelAnimation ( ) < nl > + self . weakSuper . pickImage ( . PhotoLibrary ) < nl > + } < nl > + < nl > + func btnDocumentAction ( ) { < nl > + cancelAnimation ( ) < nl > + self . weakSuper . pickDocument ( ) < nl > + } < nl > + < nl > + func btnLocationAction ( ) { < nl > + cancelAnimation ( ) < nl > + self . weakSuper . pickLocation ( ) < nl > + } < nl > + < nl > + func btnContactAction ( ) { < nl > + cancelAnimation ( ) < nl > + self . weakSuper . pickContact ( ) < nl > + } < nl > + < nl > + func btnCloseAction ( ) { < nl > + cancelAnimation ( ) < nl > + } < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift < nl > index 41da72f . . d53eb8e 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift < nl > @ @ - 47 , 12 + 47 , 16 @ @ class AAThumbnailCollectionCell : UICollectionViewCell { < nl > override func layoutSubviews ( ) { < nl > super . layoutSubviews ( ) < nl > < nl > + self . imgThumbnails . frame = CGRectMake ( 0 , 0 , self . contentView . frame . size . width , self . contentView . frame . size . height ) < nl > + self . imgSelected . frame = CGRectMake ( 0 , 0 , self . contentView . frame . size . width , self . contentView . frame . size . height ) < nl > + < nl > < nl > } < nl > < nl > override func prepareForReuse ( ) { < nl > super . prepareForReuse ( ) < nl > < nl > + self . imgSelected . image = nil < nl > < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > index 8267e7a . . bb33b2e 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift < nl > @ @ - 7 , 16 + 7 , 40 @ @ < nl > / / < nl > < nl > import UIKit < nl > + import Photos < nl > + < nl > + public enum ImagePickerMediaType { < nl > + case Image < nl > + case Video < nl > + case ImageAndVideo < nl > + } < nl > < nl > class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSource { < nl > < nl > var collectionView : UICollectionView ! < nl > + let mediaType : ImagePickerMediaType = ImagePickerMediaType . Image < nl > + < nl > + private var assets = [ PHAsset ] ( ) < nl > + private let imageManager = PHCachingImageManager ( ) < nl > + < nl > + private let minimumPreviewHeight : CGFloat = 70 < nl > + private var maximumPreviewHeight : CGFloat = 70 < nl > + < nl > + private lazy var requestOptions : PHImageRequestOptions = { < nl > + let options = PHImageRequestOptions ( ) < nl > + options . deliveryMode = . HighQualityFormat < nl > + options . resizeMode = . Fast < nl > + < nl > + return options < nl > + } ( ) < nl > + < nl > + private let previewCollectionViewInset : CGFloat = 5 < nl > < nl > < nl > override init ( frame : CGRect ) { < nl > super . init ( frame : frame ) < nl > < nl > - self . configUI ( ) < nl > + self . collectionViewSetup ( ) < nl > < nl > } < nl > < nl > @ @ - 26 , 23 + 50 , 123 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > < nl > / / / < nl > < nl > - func configUI ( ) { < nl > - self . collectionViewSetup ( ) < nl > - self . addSubview ( self . collectionView ) < nl > + func open ( ) { < nl > + < nl > + if PHPhotoLibrary . authorizationStatus ( ) = = . Authorized { < nl > + fetchAssets ( ) < nl > + self . collectionView . reloadData ( ) < nl > + } else if PHPhotoLibrary . authorizationStatus ( ) = = . NotDetermined { < nl > + PHPhotoLibrary . requestAuthorization ( ) { status in < nl > + if status = = . Authorized { < nl > + dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { < nl > + self . fetchAssets ( ) < nl > + self . collectionView . reloadData ( ) < nl > + } < nl > + } < nl > + } < nl > + } < nl > + < nl > + } < nl > + < nl > + private func fetchAssets ( ) { < nl > + let options = PHFetchOptions ( ) < nl > + options . sortDescriptors = [ NSSortDescriptor ( key : " creationDate " , ascending : false ) ] < nl > + < nl > + / / switch mediaType { < nl > + / / case . Image : < nl > + / / options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Image . rawValue ) < nl > + / / case . Video : < nl > + / / options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Video . rawValue ) < nl > + / / case . ImageAndVideo : < nl > + / / options . predicate = NSPredicate ( format : " mediaType = % d OR mediaType = % d " , PHAssetMediaType . Image . rawValue , PHAssetMediaType . Video . rawValue ) < nl > + / / } < nl > + < nl > + options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Image . rawValue ) < nl > + < nl > + let fetchLimit = 50 < nl > + if # available ( iOS 9 , * ) { < nl > + options . fetchLimit = fetchLimit < nl > + } < nl > + < nl > + let result = PHAsset . fetchAssetsWithOptions ( options ) < nl > + let requestOptions = PHImageRequestOptions ( ) < nl > + requestOptions . synchronous = true < nl > + requestOptions . deliveryMode = . FastFormat < nl > + < nl > + result . enumerateObjectsUsingBlock { asset , _ , stop in < nl > + defer { < nl > + if self . assets . count > fetchLimit { < nl > + stop . initialize ( true ) < nl > + } < nl > + } < nl > + < nl > + if let asset = asset as ? PHAsset { < nl > + self . imageManager . requestImageDataForAsset ( asset , options : requestOptions ) { data , _ , _ , info in < nl > + if data ! = nil { < nl > + self . assets . append ( asset ) < nl > + } < nl > + } < nl > + } < nl > + } < nl > + } < nl > + < nl > + private func prefetchImagesForAsset ( asset : PHAsset ) { < nl > + let targetSize = sizeForAsset ( asset , scale : UIScreen . mainScreen ( ) . scale ) < nl > + imageManager . startCachingImagesForAssets ( [ asset ] , targetSize : targetSize , contentMode : . AspectFill , options : requestOptions ) < nl > + } < nl > + < nl > + private func requestImageForAsset ( asset : PHAsset , completion : ( image : UIImage ? ) - > ( ) ) { < nl > + let targetSize = sizeForAsset ( asset , scale : UIScreen . mainScreen ( ) . scale ) < nl > + requestOptions . synchronous = true < nl > + < nl > + / / Workaround because PHImageManager . requestImageForAsset doesn ' t work for burst images < nl > + if asset . representsBurst { < nl > + imageManager . requestImageDataForAsset ( asset , options : requestOptions ) { data , _ , _ , _ in < nl > + let image = data . flatMap { UIImage ( data : $ 0 ) } < nl > + completion ( image : image ) < nl > + } < nl > + } < nl > + else { < nl > + imageManager . requestImageForAsset ( asset , targetSize : targetSize , contentMode : . AspectFill , options : requestOptions ) { image , _ in < nl > + completion ( image : image ) < nl > + } < nl > + } < nl > + } < nl > + < nl > + private func sizeForAsset ( asset : PHAsset , scale : CGFloat = 1 ) - > CGSize { < nl > + let proportion = CGFloat ( asset . pixelWidth ) / CGFloat ( asset . pixelHeight ) < nl > + < nl > + let imageHeight = maximumPreviewHeight - 2 * previewCollectionViewInset < nl > + let imageWidth = floor ( proportion * imageHeight ) < nl > + < nl > + return CGSize ( width : imageWidth * scale , height : imageHeight * scale ) < nl > } < nl > < nl > / / / collection view delegate < nl > < nl > func numberOfSectionsInCollectionView ( collectionView : UICollectionView ) - > Int { < nl > - return 0 < nl > + return 1 < nl > } < nl > < nl > func collectionView ( collectionView : UICollectionView , numberOfItemsInSection section : Int ) - > Int { < nl > - return 0 < nl > + print ( " ASSSEEETS = = = \ ( self . assets . count ) " ) < nl > + return self . assets . count < nl > } < nl > < nl > func collectionView ( collectionView : UICollectionView , cellForItemAtIndexPath indexPath : NSIndexPath ) - > UICollectionViewCell { < nl > - return UICollectionViewCell ( ) < nl > + < nl > + let cell = self . collectionView . dequeueReusableCellWithReuseIdentifier ( " AAThumbnailCollectionCell " , forIndexPath : indexPath ) as ! AAThumbnailCollectionCell < nl > + < nl > + cell . backgroundColor = UIColor . whiteColor ( ) < nl > + < nl > + let asset = assets [ indexPath . row ] < nl > + < nl > + requestImageForAsset ( asset ) { image in < nl > + cell . imgSelected . image = image < nl > + } < nl > + < nl > + < nl > + return cell < nl > } < nl > < nl > / / / < nl > @ @ - 52 , 43 + 176 , 41 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou < nl > } < nl > < nl > func collectionViewSetup ( ) { < nl > - < nl > - if ( self . collectionView = = nil ) { < nl > - < nl > - let flowLayout = UICollectionViewFlowLayout ( ) < nl > - flowLayout . scrollDirection = . Horizontal < nl > - flowLayout . minimumLineSpacing = 4 < nl > - flowLayout . sectionInset = UIEdgeInsetsMake ( 5 . 0 , 4 . 0 , 5 . 0 , 4 . 0 ) < nl > - < nl > - flowLayout . itemSize = CGSizeMake ( 105 , 180 ) < nl > - < nl > - self . collectionView = UICollectionView ( frame : self . bounds , collectionViewLayout : flowLayout ) < nl > - self . collectionView . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 231 . 0 / 255 . 0 , blue : 234 . 0 / 255 . 0 , alpha : 1 . 0 ) < nl > - self . collectionView . showsHorizontalScrollIndicator = false < nl > - self . collectionView . delegate = self < nl > - self . collectionView . dataSource = self < nl > - < nl > - self . collectionView . registerClass ( AAThumbnailCollectionCell . self , forCellWithReuseIdentifier : " AAThumbnailCollectionCell " ) < nl > - < nl > - / / AAASAssetManager . sharedInstance < nl > - < nl > - / * < nl > - < nl > - [ [ UUAssetManager sharedInstance ] getGroupList : ^ ( NSArray * obj ) { < nl > - < nl > - [ [ UUAssetManager sharedInstance ] getPhotoListOfGroupByIndex : [ UUAssetManager sharedInstance ] . currentGroupIndex result : ^ ( NSArray * obj ) { < nl > - < nl > - [ _ collectionView reloadData ] ; < nl > - < nl > - } ] ; < nl > - } ] ; < nl > < nl > - * / < nl > - < nl > - < nl > - < nl > - } < nl > + let flowLayout = UICollectionViewFlowLayout ( ) < nl > + flowLayout . scrollDirection = . Horizontal < nl > + flowLayout . minimumLineSpacing = 4 < nl > + flowLayout . sectionInset = UIEdgeInsetsMake ( 5 . 0 , 4 . 0 , 5 . 0 , 4 . 0 ) < nl > + < nl > + flowLayout . itemSize = CGSizeMake ( 90 , 90 ) < nl > + < nl > + self . collectionView = UICollectionView ( frame : self . bounds , collectionViewLayout : flowLayout ) < nl > + self . collectionView . backgroundColor = UIColor . clearColor ( ) < nl > + self . collectionView . showsHorizontalScrollIndicator = false < nl > + self . collectionView . delegate = self < nl > + self . collectionView . dataSource = self < nl > + self . collectionView . frame = CGRectMake ( 0 , 0 , screenWidth , 80 ) < nl > + < nl > + self . collectionView . registerClass ( AAThumbnailCollectionCell . self , forCellWithReuseIdentifier : " AAThumbnailCollectionCell " ) < nl > + < nl > + self . addSubview ( self . collectionView ) < nl > < nl > } < nl > < nl > + func imageByCroppingImage ( image : UIImage , toSize : CGSize ) - > UIImage { < nl > + < nl > + let refWidth = CGImageGetWidth ( image . CGImage ) < nl > + let refHeight = CGImageGetHeight ( image . CGImage ) < nl > + < nl > + let x = CGFloat ( ( refWidth - Int ( toSize . width ) ) / 2 ) < nl > + let y = CGFloat ( ( refHeight - Int ( toSize . height ) ) / 2 ) < nl > + < nl > + let cropRect = CGRectMake ( x , y , toSize . height , toSize . width ) < nl > + let imageRef = CGImageCreateWithImageInRect ( image . CGImage , cropRect ) ! as CGImageRef < nl > + < nl > + let cropped = UIImage ( CGImage : imageRef , scale : 0 . 0 , orientation : UIImageOrientation . Up ) < nl > + < nl > + return cropped ; < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > index 119c94c . . e34b500 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift < nl > @ @ - 88 , 11 + 88 , 6 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > self . rightButton . enabled = true < nl > self . rightButton . layoutIfNeeded ( ) < nl > < nl > - / / self . rightButton . setTitle ( AALocalized ( " ChatSend " ) , forState : UIControlState . Normal ) < nl > - / / self . rightButton . setTitleColor ( appStyle . chatSendColor , forState : UIControlState . Normal ) < nl > - / / self . rightButton . setTitleColor ( appStyle . chatSendDisabledColor , forState : UIControlState . Disabled ) < nl > - / / self . rightButton . setImage ( nil , forState : UIControlState . Normal ) < nl > - < nl > / / < nl > < nl > self . audioButton = UIButton ( type : UIButtonType . Custom ) < nl > @ @ - 496 , 7 + 491 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > < nl > showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : self . leftButton , sourceRect : self . leftButton . bounds , tapClosure : builder . tapClosure ) < nl > < nl > - / / self . actionSheet . showAnimation ( ) < nl > + / / self . actionSheet . showAnimation ( ) < nl > < nl > self . rightButton . layoutIfNeeded ( ) < nl > } < nl > @ @ - 615 , 7 + 610 , 9 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen < nl > func pickImage ( source : UIImagePickerControllerSourceType ) { < nl > let pickerController = AAImagePickerController ( ) < nl > pickerController . sourceType = source < nl > - pickerController . mediaTypes = [ kUTTypeImage as String , kUTTypeMovie as String ] < nl > + pickerController . mediaTypes = [ kUTTypeImage as String ] < nl > + < nl > + / / [ kUTTypeImage as String , kUTTypeMovie as String ] < nl > < nl > / / / / Style controller bg < nl > / / pickerController . view . backgroundColor = appStyle . vcBgColor

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index 2f54661 . . 788c05f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 1339 , 7 + 1339 , 6 @ @ 
 	 	 BE2621551C46569800A817AB / * AttachmentView * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 - 	 	 	 	 BE26215A1C4656F100A817AB / * Manager * / , 
 	 	 	 	 BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / , 
 	 	 	 	 BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / , 
 	 	 	 	 BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / , 
 @ @ - 1347 , 13 + 1346 , 6 @ @ 
 	 	 	 name = AttachmentView ; 
 	 	 	 sourceTree = " < group > " ; 
 	 	 } ; 
 - 	 	 BE26215A1C4656F100A817AB / * Manager * / = { 
 - 	 	 	 isa = PBXGroup ; 
 - 	 	 	 children = ( 
 - 	 	 	 ) ; 
 - 	 	 	 name = Manager ; 
 - 	 	 	 sourceTree = " < group > " ; 
 - 	 	 } ; 
 	 	 BED5A1CF1C4839200045FDB0 / * NYTPhotoViewer * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 index 8f60973 . . fc85adb 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Cell / AABubbleCell . swift 
 @ @ - 218 , 8 + 218 , 10 @ @ public class AABubbleCell : UICollectionViewCell { 
 } 
 
 public func performBind ( message : ACMessage , setting : AACellSetting , isShowNewMessages : Bool , layout : AACellLayout ) { 
 - self . clipsToBounds = false 
 - self . contentView . clipsToBounds = false 
 + self . clipsToBounds = true 
 + self . contentView . clipsToBounds = true 
 + self . layer . drawsAsynchronously = true 
 + self . contentView . layer . drawsAsynchronously = true 
 
 var reuse = false 
 if ( bindedMessage ! = nil & & bindedMessage ? . rid = = message . rid ) { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 index 5e4ce78 . . c7ec5b0 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 @ @ - 23 , 7 + 23 , 7 @ @ class AAConvActionSheet : UIView { 
 var btnContact : UIButton ! 
 var btnCancel : UIButton ! 
 
 - var thumbnailView = AAThumbnailView ( ) 
 + var thumbnailView : AAThumbnailView ! 
 
 weak var weakSuper : ConversationViewController ! 
 
 @ @ - 49 , 17 + 49 , 12 @ @ class AAConvActionSheet : UIView { 
 self . frame = CGRectMake ( 0 , 0 , screenWidth , screenHeigth ) 
 self . backgroundColor = UIColor . blackColor ( ) . colorWithAlphaComponent ( 0 . 7 ) 
 
 - 
 - 
 - / / make photo 
 - 
 } 
 
 
 deinit { 
 
 self . weakSuper = nil 
 - 
 
 } 
 
 @ @ - 71 , 6 + 66 , 17 @ @ class AAConvActionSheet : UIView { 
 
 self . weakSuper . navigationController ! . interactivePopGestureRecognizer ! . enabled = false 
 
 + / / 
 + 
 + if ( self . thumbnailView = = nil ) { 
 + 
 + self . thumbnailView = AAThumbnailView ( ) 
 + self . sheetView . addSubview ( self . thumbnailView ) 
 + self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) 
 + self . thumbnailView . bindedConvSheet = self 
 + 
 + } 
 + 
 UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in 
 self . sheetView . frame = frame 
 self . alpha = 1 
 @ @ - 117 , 30 + 123 , 30 @ @ class AAConvActionSheet : UIView { 
 
 self . addSubview ( self . sheetView ) 
 
 - self . btnCamera = UIButton ( type : UIButtonType . System ) 
 - self . btnLibrary = UIButton ( type : UIButtonType . System ) 
 - self . btnDocuments = UIButton ( type : UIButtonType . System ) 
 - self . btnLocation = UIButton ( type : UIButtonType . System ) 
 - self . btnContact = UIButton ( type : UIButtonType . System ) 
 - self . btnCancel = UIButton ( type : UIButtonType . System ) 
 + self . btnCamera = UIButton ( type : UIButtonType . System ) 
 + self . btnLibrary = UIButton ( type : UIButtonType . System ) 
 + self . btnDocuments = UIButton ( type : UIButtonType . System ) 
 + self . btnLocation = UIButton ( type : UIButtonType . System ) 
 + self . btnContact = UIButton ( type : UIButtonType . System ) 
 + self . btnCancel = UIButton ( type : UIButtonType . System ) 
 
 / / color 
 
 - self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 - self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 - self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 - self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 - self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 - self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 
 / / font size 
 
 - self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 - self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 - self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 - self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 - self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 - self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 
 / / add buttons as subivews 
 
 @ @ - 150 , 15 + 156 , 15 @ @ class AAConvActionSheet : UIView { 
 self . sheetView . addSubview ( self . btnLocation ) 
 self . sheetView . addSubview ( self . btnContact ) 
 self . sheetView . addSubview ( self . btnCancel ) 
 - self . sheetView . addSubview ( self . thumbnailView ) 
 + / / self . sheetView . addSubview ( self . thumbnailView ) 
 
 - self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) 
 - self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) 
 - self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) 
 - self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) 
 - self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) 
 - self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) 
 - self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) 
 + / / self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 90 ) 
 + self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) 
 + self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) 
 + self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) 
 + self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) 
 + self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) 
 + self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) 
 
 / / separators 
 
 @ @ - 204 , 7 + 210 , 7 @ @ class AAConvActionSheet : UIView { 
 
 / / bineded self 
 
 - self . thumbnailView . bindedConvSheet = self 
 + / / self . thumbnailView . bindedConvSheet = self 
 
 } 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift 
 index 1018daf . . 5391fac 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAStickersView . swift 
 @ @ - 174 , 8 + 174 , 6 @ @ class AAStickersView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 
 self . backgroundColor = UIColor . clearColor ( ) 
 
 - self . loadStickers ( ) 
 - 
 } 
 
 required init ? ( coder aDecoder : NSCoder ) { 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 index 7a03ef1 . . 43fadd6 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 @ @ - 23 , 7 + 23 , 7 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 
 private var assets = [ PHAsset ] ( ) 
 var selectedAssets = [ PHAsset ] ( ) 
 - private var imageManager = PHCachingImageManager ( ) 
 + private var imageManager : PHCachingImageManager ! 
 
 private let minimumPreviewHeight : CGFloat = 90 
 private var maximumPreviewHeight : CGFloat = 90 
 @ @ - 54 , 6 + 54 , 8 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 
 func open ( ) { 
 
 + self . imageManager = PHCachingImageManager ( ) 
 + 
 if PHPhotoLibrary . authorizationStatus ( ) = = . Authorized { 
 fetchAssets ( ) 
 self . collectionView . reloadData ( ) 
 @ @ - 204 , 34 + 206 , 6 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 } 
 
 
 - / / let priority = DISPATCH _ QUEUE _ PRIORITY _ DEFAULT 
 - / / dispatch _ async ( dispatch _ get _ global _ queue ( priority , 0 ) ) { 
 - / / / / do some task 
 - / / 
 - / / self . requestOptions . synchronous = true 
 - / / 
 - / / self . imageManagerForOrig . requestImageDataForAsset ( photoModel , options : self . requestOptions , resultHandler : { ( data , _ , _ , _ ) - > Void in 
 - / / if data ! = nil { 
 - / / 
 - / / let imageFromAsset = UIImage ( data : data ! ) ! 
 - / / var complitedImage : UIImage ! 
 - / / 
 - / / if imageFromAsset . size . width > imageFromAsset . size . height { 
 - / / complitedImage = self . imageByCroppingImage ( imageFromAsset , toSize : CGSizeMake ( imageFromAsset . size . height , imageFromAsset . size . height ) ) 
 - / / } else { 
 - / / complitedImage = self . imageByCroppingImage ( imageFromAsset , toSize : CGSizeMake ( imageFromAsset . size . width , imageFromAsset . size . width ) ) 
 - / / } 
 - / / 
 - / / dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { 
 - / / / / update some UI 
 - / / cell . imgThumbnails . image = complitedImage 
 - / / } 
 - / / } 
 - / / } ) 
 - / / 
 - / / } 
 - 
 - 
 return cell 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 index 0428791 . . 706ac5f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK . xcodeproj / project . pbxproj 
 @ @ - 273 , 7 + 273 , 6 @ @ 
 	 	 BE2621571C4656D700A817AB / * AAConvActionSheet . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / ; } ; 
 	 	 BE2621591C4656EE00A817AB / * AAThumbnailView . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / ; } ; 
 	 	 BEAC2B311C42D683007F7A2F / * libopus . a in Frameworks * / = { isa = PBXBuildFile ; fileRef = 15F89F001C211FDE00776ACD / * libopus . a * / ; } ; 
 - 	 	 BEF11DB51C4657D20076400A / * AAASAssetManager . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / ; } ; 
 	 	 BEF11DB61C466D800076400A / * begin _ record . caf in Resources * / = { isa = PBXBuildFile ; fileRef = 153F6B3C1C2A9B1900C0B960 / * begin _ record . caf * / ; } ; 
 	 	 BEFE68D51C4657360001F2D6 / * AAThumbnailCollectionCell . swift in Sources * / = { isa = PBXBuildFile ; fileRef = BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / ; } ; 
 / * End PBXBuildFile section * / 
 @ @ - 555 , 7 + 554 , 6 @ @ 
 	 	 BE237C9C1C422FFA00060648 / * AAStickersView . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAStickersView . swift ; sourceTree = " < group > " ; } ; 
 	 	 BE2621561C4656D700A817AB / * AAConvActionSheet . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAConvActionSheet . swift ; sourceTree = " < group > " ; } ; 
 	 	 BE2621581C4656EE00A817AB / * AAThumbnailView . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAThumbnailView . swift ; sourceTree = " < group > " ; } ; 
 - 	 	 BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAASAssetManager . swift ; sourceTree = " < group > " ; } ; 
 	 	 BEFE68D41C4657360001F2D6 / * AAThumbnailCollectionCell . swift * / = { isa = PBXFileReference ; fileEncoding = 4 ; lastKnownFileType = sourcecode . swift ; path = AAThumbnailCollectionCell . swift ; sourceTree = " < group > " ; } ; 
 / * End PBXFileReference section * / 
 
 @ @ - 1320 , 7 + 1318 , 6 @ @ 
 	 	 BE26215A1C4656F100A817AB / * Manager * / = { 
 	 	 	 isa = PBXGroup ; 
 	 	 	 children = ( 
 - 	 	 	 	 BEF11DB41C4657D20076400A / * AAASAssetManager . swift * / , 
 	 	 	 ) ; 
 	 	 	 name = Manager ; 
 	 	 	 sourceTree = " < group > " ; 
 @ @ - 1692 , 7 + 1689 , 6 @ @ 
 	 	 	 	 15D35F671C20187E00E3717A / * NSObject + TGLock . m in Sources * / , 
 	 	 	 	 15D35F5C1C20187E00E3717A / * AAAudioPlayer . m in Sources * / , 
 	 	 	 	 152AA8BF1C298C4B0030DEEE / * AASettingsLastSeenController . swift in Sources * / , 
 - 	 	 	 	 BEF11DB51C4657D20076400A / * AAASAssetManager . swift in Sources * / , 
 	 	 	 	 066A51561BC4BEF5000E606E / * AALocalized . swift in Sources * / , 
 	 	 	 	 069CF4CF1BCB909A00C66E12 / * CLToken . m in Sources * / , 
 	 	 	 	 15D35F751C201B6B00E3717A / * AACustomPresentationController . swift in Sources * / , 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift 
 index b6bf9c5 . . 006ea4f 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / ActorCoreExt . swift 
 @ @ - 37 , 7 + 37 , 6 @ @ public extension ACCocoaMessenger { 
 let path = CocoaFiles . pathFromDescriptor ( descriptor ) ; 
 
 videoData . writeToFile ( path , atomically : true ) / / write to file 
 - 
 
 / / get video duration 
 
 @ @ - 55 , 8 + 54 , 9 @ @ public extension ACCocoaMessenger { 
 do { 
 let imageRef = try imageGenerator . copyCGImageAtTime ( thumbnailTime , actualTime : nil ) 
 let thumbnail = UIImage ( CGImage : imageRef ) 
 - let thumbData = UIImageJPEGRepresentation ( thumbnail , 0 . 55 ) ; / / thumbnail binary data 
 - let fastThumb = ACFastThumb ( int : jint ( thumbnail . size . width ) , withInt : jint ( thumbnail . size . height ) , withByteArray : thumbData ! . toJavaBytes ( ) ) 
 + let thumb = thumbnail . resizeSquare ( 90 , maxH : 90 ) ; 
 + let thumbData = UIImageJPEGRepresentation ( thumb , 0 . 55 ) ; / / thumbnail binary data 
 + let fastThumb = ACFastThumb ( int : jint ( thumb . size . width ) , withInt : jint ( thumb . size . height ) , withByteArray : thumbData ! . toJavaBytes ( ) ) 
 
 print ( " video upload imageRef = \ ( imageRef ) " ) 
 print ( " video upload thumbnail = \ ( thumbnail ) " ) 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 index a70b6c6 . . 01a0edb 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorSDK . swift 
 @ @ - 40 , 11 + 40 , 8 @ @ public class ActorSDK { 
 / / / Server Endpoints 
 public var endpoints = [ 
 " tls : / / front1 - mtproto - api - rev2 . actor . im " , 
 - " tls : / / front2 - mtproto - api - rev2 . actor . im " , 
 + " tls : / / front2 - mtproto - api - rev2 . actor . im " 
 
 - " tcp : / / front1 - mtproto - api - rev3 . actor . im : 443 " , 
 - " tcp : / / front2 - mtproto - api - rev3 . actor . im : 443 " , 
 - " tcp : / / front3 - mtproto - api - rev3 . actor . im : 443 " 
 ] { 
 didSet { 
 trustedKeys = [ ] 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift 
 deleted file mode 100644 
 index 1850eeb . . 0000000 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAASAssetManager . swift 
 + + + / dev / null 
 @ @ - 1 , 250 + 0 , 0 @ @ 
 - / / 
 - / / AAASAssetManager . swift 
 - / / ActorSDK 
 - / / 
 - / / Created by kioshimafx on 1 / 13 / 16 . 
 - / / Copyright © 2016 Steve Kite . All rights reserved . 
 - / / 
 - 
 - import UIKit 
 - import AssetsLibrary 
 - 
 - let ASSET _ PHOTO _ THUMBNAIL : Int = 0 
 - let ASSET _ PHOTO _ ASPECT _ THUMBNAIL : Int = 1 
 - let ASSET _ PHOTO _ SCREEN _ SIZE : Int = 2 
 - let ASSET _ PHOTO _ FULL _ RESOLUTION : Int = 3 
 - 
 - let kNotificationSendPhotos = " NotificationSendPhotos " 
 - let kNotificationUpdateSelected = " NotificationUpdateSelected " 
 - 
 - class AAAssetPhoto { 
 - 
 - var asset : ALAsset ! 
 - var index : Int ! 
 - var isSelected : Bool ! 
 - var groupIndex : String ! 
 - 
 - var group : Int ! 
 - 
 - init ( groupIn : Int , indexIn : Int , assetIn : ALAsset ) { 
 - 
 - self . group = groupIn 
 - self . index = indexIn 
 - self . asset = assetIn 
 - self . isSelected = true 
 - 
 - self . groupIndex = " \ ( group ) - \ ( index ) " 
 - 
 - } 
 - 
 - } 
 - 
 - class AAASAssetManager : NSObject { 
 - 
 - / / # # # singleton # # # 
 - static let sharedInstance = AAASAssetManager ( ) 
 - 
 - var maxSelected : Int ! 
 - var currentGroupIndex : Int ! 
 - 
 - / / / 
 - 
 - var assetPhotos : Array < ALAsset > ! 
 - var selectedPhotos : Array < AAAssetPhoto > ! 
 - 
 - / / / 
 - 
 - var assetsLibrary : ALAssetsLibrary ! 
 - var assetGroups : Array < ALAssetsGroup > ! 
 - var selectedAsset : ALAsset ! 
 - 
 - override init ( ) { 
 - 
 - self . selectedPhotos = Array < AAAssetPhoto > ( ) 
 - self . assetsLibrary = ALAssetsLibrary ( ) 
 - self . assetsLibrary . writeImageToSavedPhotosAlbum ( nil , metadata : nil ) { ( _ , _ ) - > Void in 
 - / / 
 - } 
 - 
 - } 
 - 
 - / / messages _ setActivity ( user _ id : Int , reqResponse : ( VKResponse ! ) - > ( ) 
 - 
 - func getSavedPhotoList ( result : ( Array < AnyObject > ! ) - > ( ) , error : ( String ) - > ( ) ) { 
 - 
 - 
 - dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { ( ) - > Void in 
 - / / 
 - } 
 - 
 - 
 - } 
 - 
 - 
 - func getGroupCount ( ) - > Int { 
 - return self . assetGroups . count 
 - } 
 - 
 - func getPhotoCountOfCurrentGroup ( ) - > Int { 
 - return self . assetPhotos . count 
 - } 
 - 
 - func getSelectedPhotoCount ( ) - > Int { 
 - 
 - let selectedArray = self . selectedPhotos . filter ( { 
 - $ 0 . isSelected = = true 
 - } ) 
 - 
 - return selectedArray . count 
 - } 
 - 
 - func clearData ( ) { 
 - 
 - self . selectedPhotos . removeAll ( ) 
 - self . assetGroups . removeAll ( ) 
 - self . assetPhotos . removeAll ( ) 
 - 
 - 
 - self . selectedPhotos = nil 
 - self . assetGroups = nil 
 - self . assetPhotos = nil 
 - 
 - } 
 - 
 - / / / / 
 - 
 - 
 - func getImageFromAsset ( asset : ALAsset , type : Int ) - > UIImage { 
 - / * 
 - NSString * strXMP = asset . defaultRepresentation . metadata [ @ " AdjustmentXMP " ] ; 
 - if ( strXMP = = nil | | [ strXMP isKindOfClass : [ NSNull class ] ] ) 
 - { 
 - iRef = [ asset . defaultRepresentation fullResolutionImage ] ; 
 - return [ UIImage imageWithCGImage : iRef scale : 1 . 0 orientation : ( UIImageOrientation ) asset . defaultRepresentation . orientation ] ; 
 - } 
 - else 
 - { 
 - NSData * dXMP = [ strXMP dataUsingEncoding : NSUTF8StringEncoding ] ; 
 - 
 - CIImage * image = [ CIImage imageWithCGImage : asset . defaultRepresentation . fullResolutionImage ] ; 
 - 
 - NSError * error = nil ; 
 - NSArray * filterArray = [ CIFilter filterArrayFromSerializedXMP : dXMP 
 - inputImageExtent : image . extent 
 - error : & error ] ; 
 - if ( error ) { 
 - NSLog ( @ " Error during CIFilter creation : % @ " , [ error localizedDescription ] ) ; 
 - } 
 - 
 - for ( CIFilter * filter in filterArray ) { 
 - [ filter setValue : image forKey : kCIInputImageKey ] ; 
 - image = [ filter outputImage ] ; 
 - } 
 - CIContext * context = [ CIContext contextWithOptions : nil ] ; 
 - CGImageRef cgimage = [ context createCGImage : image fromRect : [ image extent ] ] ; 
 - UIImage * iImage = [ UIImage imageWithCGImage : cgimage scale : 1 . 0 orientation : ( UIImageOrientation ) asset . defaultRepresentation . orientation ] ; 
 - return iImage ; 
 - * / 
 - 
 - var imageRef : CGImageRef ! 
 - 
 - if ( type = = ASSET _ PHOTO _ THUMBNAIL ) { 
 - imageRef = asset . thumbnail ( ) as ! CGImageRef 
 - } else if ( type = = ASSET _ PHOTO _ ASPECT _ THUMBNAIL ) { 
 - imageRef = asset . aspectRatioThumbnail ( ) as ! CGImageRef 
 - } else if ( type = = ASSET _ PHOTO _ SCREEN _ SIZE ) { 
 - imageRef = asset . defaultRepresentation ( ) as ! CGImageRef 
 - } else if ( type = = ASSET _ PHOTO _ FULL _ RESOLUTION ) { 
 - imageRef = asset . defaultRepresentation ( ) as ! CGImageRef 
 - / / let strXMP = asset . defaultRepresentation ( ) . metadata ( ) [ " AdjustmentXMP " ] 
 - 
 - 
 - 
 - 
 - } 
 - 
 - return UIImage ( CGImage : imageRef ) 
 - } 
 - 
 - func getImageAtIndex ( nIndex : Int , nType : Int ) - > UIImage { 
 - return getImageFromAsset ( self . assetPhotos [ nIndex ] , type : nType ) 
 - } 
 - 
 - func getImagePreviewAtIndex ( nIndex : Int , nType : Int ) - > UIImage { 
 - let photoObj = self . selectedPhotos [ nIndex ] 
 - return getImageFromAsset ( photoObj . asset , type : nType ) 
 - } 
 - 
 - func getAssetAtIndex ( index : Int ) - > ALAsset { 
 - return self . assetPhotos [ index ] 
 - } 
 - 
 - func getGroupAtIndex ( index : Int ) - > ALAssetsGroup { 
 - return self . assetGroups [ index ] 
 - } 
 - 
 - func sendSelectedPhotos ( type : Int ) - > Array < UIImage > { 
 - 
 - var sendArray = Array < UIImage > ( ) 
 - 
 - for ( _ , photoObj ) in self . selectedPhotos . enumerate ( ) { 
 - 
 - let image = self . getImageFromAsset ( photoObj . asset , type : type ) 
 - sendArray . append ( image ) 
 - 
 - } 
 - 
 - self . selectedPhotos . removeAll ( ) 
 - 
 - return sendArray 
 - } 
 - 
 - func addObjectWithIndex ( index : Int ) { 
 - 
 - let model = AAAssetPhoto ( groupIn : self . currentGroupIndex , indexIn : index , assetIn : self . assetPhotos [ index ] ) 
 - 
 - self . selectedPhotos . append ( model ) 
 - 
 - / / [ [ NSNotificationCenter defaultCenter ] postNotificationName : kNotificationUpdateSelected object : nil ] ; 
 - 
 - } 
 - 
 - 
 - func removeObjectWithIndex ( index : Int ) { 
 - 
 - let groupIndex = " \ ( self . currentGroupIndex ! ) - \ ( index ) " 
 - 
 - let results = self . selectedPhotos . filter ( { 
 - $ 0 . groupIndex = = groupIndex 
 - } ) 
 - 
 - if ( results . count > 0 ) { 
 - 
 - / / let model = results [ 0 ] 
 - 
 - 
 - } 
 - 
 - 
 - } 
 - 
 - 
 - func currentGroupFirstIndex ( ) - > Int { 
 - 
 - let results = self . selectedPhotos . filter ( { 
 - $ 0 . group = = self . currentGroupIndex 
 - } ) 
 - 
 - if ( results . count > 0 ) { 
 - 
 - let model = results [ 0 ] 
 - return model . index 
 - 
 - } 
 - 
 - return 0 
 - } 
 - 
 - 
 - 
 - } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 index d235ec3 . . d0bc182 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAConvActionSheet . swift 
 @ @ - 12 , 21 + 12 , 27 @ @ protocol AAActionSheetDelegate { 
 func actionSheetDidFinished ( selectedObjs : Array < AnyObject > ) 
 } 
 
 + let screenWidth = UIScreen . mainScreen ( ) . bounds . size . width 
 + let screenHeigth = UIScreen . mainScreen ( ) . bounds . size . height 
 + 
 class AAConvActionSheet : UIView { 
 
 var delegate : AAActionSheetDelegate ? 
 
 var sheetView : UIView ! 
 - var btnAlbum : UIButton ! 
 + 
 var btnCamera : UIButton ! 
 + var btnLibrary : UIButton ! 
 + var btnDocuments : UIButton ! 
 + var btnLocation : UIButton ! 
 + var btnContact : UIButton ! 
 var btnCancel : UIButton ! 
 - var thumbnailView : AAThumbnailView ! 
 + 
 + var thumbnailView = AAThumbnailView ( ) 
 
 weak var weakSuper : ConversationViewController ! 
 
 
 - let screenWidth = UIScreen . mainScreen ( ) . bounds . size . width 
 - let screenHeigth = UIScreen . mainScreen ( ) . bounds . size . height 
 
 init ( maxSelected : Int , weakSuperIn : ConversationViewController ) { 
 super . init ( frame : CGRectZero ) 
 @ @ - 48 , 14 + 54 , 12 @ @ class AAConvActionSheet : UIView { 
 
 self . alpha = 0 
 self . frame = CGRectMake ( 0 , 0 , screenWidth , screenHeigth ) 
 - self . backgroundColor = UIColor . clearColor ( ) 
 + self . backgroundColor = UIColor . blackColor ( ) . colorWithAlphaComponent ( 0 . 5 ) 
 + 
 
 - self . addSubview ( self . sheetView ) 
 
 - / / self . sheetView . addSubview ( self . btnCancel ) 
 - / / self . sheetView . addSubview ( self . btnAlbum ) 
 - / / self . sheetView . addSubview ( self . btnCamera ) 
 - / / self . sheetView . addSubview ( self . thumbnailView ) 
 + / / make photo 
 + 
 
 self . configNotification ( ) 
 
 @ @ - 63 , 17 + 67 , 13 @ @ class AAConvActionSheet : UIView { 
 
 func configNotification ( ) { 
 
 - NSNotificationCenter . defaultCenter ( ) . addObserver ( self , selector : " " , name : kNotificationSendPhotos , object : nil ) 
 - NSNotificationCenter . defaultCenter ( ) . addObserver ( self , selector : " " , name : kNotificationUpdateSelected , object : nil ) 
 
 } 
 
 deinit { 
 
 self . weakSuper = nil 
 - 
 - AAASAssetManager . sharedInstance . clearData ( ) 
 - NSNotificationCenter . defaultCenter ( ) . removeObserver ( self ) 
 + 
 
 } 
 
 @ @ - 81 , 19 + 81 , 22 @ @ class AAConvActionSheet : UIView { 
 func showAnimation ( ) { 
 
 / / self . btnCamera . selected = true 
 - / / self . thumbnailView . reloadView ( ) 
 / / self . btnCamera . setTitle ( " Camera " , forState : UIControlState . Normal ) 
 
 var frame = self . sheetView . frame 
 - frame . origin . y = screenHeigth - 350 
 + frame . origin . y = screenHeigth - 400 
 
 UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in 
 self . sheetView . frame = frame 
 self . alpha = 1 
 
 + self . thumbnailView . open ( ) 
 + self . thumbnailView . reloadView ( ) 
 + 
 } 
 
 
 + 
 } 
 
 func cancelAnimation ( ) { 
 @ @ - 101 , 10 + 104 , 10 @ @ class AAConvActionSheet : UIView { 
 var frame = self . sheetView . frame 
 frame . origin . y = screenHeigth 
 
 - UIView . animateWithDuration ( 0 . 25 ) { ( ) - > Void in 
 + UIView . animateWithDuration ( 0 . 25 , animations : { ( ) - > Void in 
 self . sheetView . frame = frame 
 self . alpha = 0 
 - 
 + } ) { ( bool ) - > Void in 
 } 
 
 } 
 @ @ - 117 , 21 + 120 , 128 @ @ class AAConvActionSheet : UIView { 
 
 
 / / sheet view 
 - let frame = CGRectMake ( 0 , screenHeigth , screenWidth , 350 ) 
 + let frame = CGRectMake ( 0 , screenHeigth , screenWidth , 400 ) 
 self . sheetView = UIView ( frame : frame ) 
 - self . sheetView . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 231 . 0 / 255 . 0 , blue : 234 . 0 / 255 . 0 , alpha : 1 ) 
 - 
 - 
 - / / button cancel 
 - 
 - self . btnCancel = UIButton ( type : UIButtonType . Custom ) 
 - 
 - / / thumbnail view 
 - 
 - 
 + self . sheetView . backgroundColor = UIColor . whiteColor ( ) 
 
 + self . addSubview ( self . sheetView ) 
 
 + self . btnCamera = UIButton ( type : UIButtonType . System ) 
 + self . btnLibrary = UIButton ( type : UIButtonType . System ) 
 + self . btnDocuments = UIButton ( type : UIButtonType . System ) 
 + self . btnLocation = UIButton ( type : UIButtonType . System ) 
 + self . btnContact = UIButton ( type : UIButtonType . System ) 
 + self . btnCancel = UIButton ( type : UIButtonType . System ) 
 + 
 + / / color 
 + 
 + self . btnCamera . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnLibrary . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnDocuments . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnLocation . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnContact . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + self . btnCancel . tintColor = UIColor ( red : 5 . 0 / 255 . 0 , green : 124 . 0 / 255 . 0 , blue : 226 . 0 / 255 . 0 , alpha : 1 ) 
 + 
 + / / font size 
 + 
 + self . btnCamera . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnLibrary . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnDocuments . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnLocation . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnContact . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + self . btnCancel . titleLabel ? . font = UIFont . systemFontOfSize ( 17 ) 
 + 
 + / / add buttons as subivews 
 + 
 + self . sheetView . addSubview ( self . btnCamera ) 
 + self . sheetView . addSubview ( self . btnLibrary ) 
 + self . sheetView . addSubview ( self . btnDocuments ) 
 + self . sheetView . addSubview ( self . btnLocation ) 
 + self . sheetView . addSubview ( self . btnContact ) 
 + self . sheetView . addSubview ( self . btnCancel ) 
 + self . sheetView . addSubview ( self . thumbnailView ) 
 + 
 + self . thumbnailView . frame = CGRectMake ( 0 , 5 , screenWidth , 100 ) 
 + self . btnCamera . frame = CGRectMake ( 0 , 100 , screenWidth , 50 ) 
 + self . btnLibrary . frame = CGRectMake ( 0 , 150 , screenWidth , 50 ) 
 + self . btnDocuments . frame = CGRectMake ( 0 , 200 , screenWidth , 50 ) 
 + self . btnLocation . frame = CGRectMake ( 0 , 250 , screenWidth , 50 ) 
 + self . btnContact . frame = CGRectMake ( 0 , 300 , screenWidth , 50 ) 
 + self . btnCancel . frame = CGRectMake ( 0 , 350 , screenWidth , 50 ) 
 + 
 + / / separators 
 + 
 + let spearator1 = UIView ( frame : CGRectMake ( 0 , 99 , screenWidth , 1 ) ) 
 + spearator1 . backgroundColor = UIColor ( red : 223 . 9 / 255 . 0 , green : 223 . 9 / 255 . 0 , blue : 223 . 9 / 255 . 0 , alpha : 0 . 6 ) 
 + let spearator2 = UIView ( frame : CGRectMake ( 10 , 149 , screenWidth - 20 , 1 ) ) 
 + spearator2 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) 
 + let spearator3 = UIView ( frame : CGRectMake ( 10 , 199 , screenWidth - 20 , 1 ) ) 
 + spearator3 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) 
 + let spearator4 = UIView ( frame : CGRectMake ( 10 , 249 , screenWidth - 20 , 1 ) ) 
 + spearator4 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) 
 + let spearator5 = UIView ( frame : CGRectMake ( 10 , 299 , screenWidth - 20 , 1 ) ) 
 + spearator5 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) 
 + let spearator6 = UIView ( frame : CGRectMake ( 10 , 349 , screenWidth - 20 , 1 ) ) 
 + spearator6 . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 230 . 0 / 255 . 0 , blue : 230 . 0 / 255 . 0 , alpha : 0 . 6 ) 
 + 
 + / / add separatos as subview 
 + 
 + self . sheetView . addSubview ( spearator1 ) 
 + self . sheetView . addSubview ( spearator2 ) 
 + self . sheetView . addSubview ( spearator3 ) 
 + self . sheetView . addSubview ( spearator4 ) 
 + self . sheetView . addSubview ( spearator5 ) 
 + self . sheetView . addSubview ( spearator6 ) 
 + 
 + / / set title for buttons 
 + 
 + self . btnCamera . setTitle ( AALocalized ( " PhotoCamera " ) , forState : UIControlState . Normal ) 
 + self . btnLibrary . setTitle ( AALocalized ( " PhotoLibrary " ) , forState : UIControlState . Normal ) 
 + self . btnDocuments . setTitle ( AALocalized ( " SendDocument " ) , forState : UIControlState . Normal ) 
 + self . btnLocation . setTitle ( AALocalized ( " ShareLocation " ) , forState : UIControlState . Normal ) 
 + self . btnContact . setTitle ( AALocalized ( " ShareContact " ) , forState : UIControlState . Normal ) 
 + self . btnCancel . setTitle ( AALocalized ( " AlertCancel " ) , forState : UIControlState . Normal ) 
 + 
 + / / add actins 
 + 
 + self . btnCamera . addTarget ( self , action : " btnCameraAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + self . btnLibrary . addTarget ( self , action : " btnLibraryAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + self . btnDocuments . addTarget ( self , action : " btnDocumentAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + self . btnLocation . addTarget ( self , action : " btnLocationAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + self . btnContact . addTarget ( self , action : " btnContactAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + self . btnCancel . addTarget ( self , action : " btnCloseAction " , forControlEvents : UIControlEvents . TouchUpInside ) 
 + 
 + } 
 + 
 + / / MARK : - Button ' s actions 
 + 
 + func btnCameraAction ( ) { 
 + cancelAnimation ( ) 
 + self . weakSuper . pickImage ( . Camera ) 
 } 
 
 + func btnLibraryAction ( ) { 
 + cancelAnimation ( ) 
 + self . weakSuper . pickImage ( . PhotoLibrary ) 
 + } 
 + 
 + func btnDocumentAction ( ) { 
 + cancelAnimation ( ) 
 + self . weakSuper . pickDocument ( ) 
 + } 
 + 
 + func btnLocationAction ( ) { 
 + cancelAnimation ( ) 
 + self . weakSuper . pickLocation ( ) 
 + } 
 + 
 + func btnContactAction ( ) { 
 + cancelAnimation ( ) 
 + self . weakSuper . pickContact ( ) 
 + } 
 + 
 + func btnCloseAction ( ) { 
 + cancelAnimation ( ) 
 + } 
 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift 
 index 41da72f . . d53eb8e 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailCollectionCell . swift 
 @ @ - 47 , 12 + 47 , 16 @ @ class AAThumbnailCollectionCell : UICollectionViewCell { 
 override func layoutSubviews ( ) { 
 super . layoutSubviews ( ) 
 
 + self . imgThumbnails . frame = CGRectMake ( 0 , 0 , self . contentView . frame . size . width , self . contentView . frame . size . height ) 
 + self . imgSelected . frame = CGRectMake ( 0 , 0 , self . contentView . frame . size . width , self . contentView . frame . size . height ) 
 + 
 
 } 
 
 override func prepareForReuse ( ) { 
 super . prepareForReuse ( ) 
 
 + self . imgSelected . image = nil 
 
 } 
 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 index 8267e7a . . bb33b2e 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Content / Conversation / Views / AAThumbnailView . swift 
 @ @ - 7 , 16 + 7 , 40 @ @ 
 / / 
 
 import UIKit 
 + import Photos 
 + 
 + public enum ImagePickerMediaType { 
 + case Image 
 + case Video 
 + case ImageAndVideo 
 + } 
 
 class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSource { 
 
 var collectionView : UICollectionView ! 
 + let mediaType : ImagePickerMediaType = ImagePickerMediaType . Image 
 + 
 + private var assets = [ PHAsset ] ( ) 
 + private let imageManager = PHCachingImageManager ( ) 
 + 
 + private let minimumPreviewHeight : CGFloat = 70 
 + private var maximumPreviewHeight : CGFloat = 70 
 + 
 + private lazy var requestOptions : PHImageRequestOptions = { 
 + let options = PHImageRequestOptions ( ) 
 + options . deliveryMode = . HighQualityFormat 
 + options . resizeMode = . Fast 
 + 
 + return options 
 + } ( ) 
 + 
 + private let previewCollectionViewInset : CGFloat = 5 
 
 
 override init ( frame : CGRect ) { 
 super . init ( frame : frame ) 
 
 - self . configUI ( ) 
 + self . collectionViewSetup ( ) 
 
 } 
 
 @ @ - 26 , 23 + 50 , 123 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 
 / / / 
 
 - func configUI ( ) { 
 - self . collectionViewSetup ( ) 
 - self . addSubview ( self . collectionView ) 
 + func open ( ) { 
 + 
 + if PHPhotoLibrary . authorizationStatus ( ) = = . Authorized { 
 + fetchAssets ( ) 
 + self . collectionView . reloadData ( ) 
 + } else if PHPhotoLibrary . authorizationStatus ( ) = = . NotDetermined { 
 + PHPhotoLibrary . requestAuthorization ( ) { status in 
 + if status = = . Authorized { 
 + dispatch _ async ( dispatch _ get _ main _ queue ( ) ) { 
 + self . fetchAssets ( ) 
 + self . collectionView . reloadData ( ) 
 + } 
 + } 
 + } 
 + } 
 + 
 + } 
 + 
 + private func fetchAssets ( ) { 
 + let options = PHFetchOptions ( ) 
 + options . sortDescriptors = [ NSSortDescriptor ( key : " creationDate " , ascending : false ) ] 
 + 
 + / / switch mediaType { 
 + / / case . Image : 
 + / / options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Image . rawValue ) 
 + / / case . Video : 
 + / / options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Video . rawValue ) 
 + / / case . ImageAndVideo : 
 + / / options . predicate = NSPredicate ( format : " mediaType = % d OR mediaType = % d " , PHAssetMediaType . Image . rawValue , PHAssetMediaType . Video . rawValue ) 
 + / / } 
 + 
 + options . predicate = NSPredicate ( format : " mediaType = % d " , PHAssetMediaType . Image . rawValue ) 
 + 
 + let fetchLimit = 50 
 + if # available ( iOS 9 , * ) { 
 + options . fetchLimit = fetchLimit 
 + } 
 + 
 + let result = PHAsset . fetchAssetsWithOptions ( options ) 
 + let requestOptions = PHImageRequestOptions ( ) 
 + requestOptions . synchronous = true 
 + requestOptions . deliveryMode = . FastFormat 
 + 
 + result . enumerateObjectsUsingBlock { asset , _ , stop in 
 + defer { 
 + if self . assets . count > fetchLimit { 
 + stop . initialize ( true ) 
 + } 
 + } 
 + 
 + if let asset = asset as ? PHAsset { 
 + self . imageManager . requestImageDataForAsset ( asset , options : requestOptions ) { data , _ , _ , info in 
 + if data ! = nil { 
 + self . assets . append ( asset ) 
 + } 
 + } 
 + } 
 + } 
 + } 
 + 
 + private func prefetchImagesForAsset ( asset : PHAsset ) { 
 + let targetSize = sizeForAsset ( asset , scale : UIScreen . mainScreen ( ) . scale ) 
 + imageManager . startCachingImagesForAssets ( [ asset ] , targetSize : targetSize , contentMode : . AspectFill , options : requestOptions ) 
 + } 
 + 
 + private func requestImageForAsset ( asset : PHAsset , completion : ( image : UIImage ? ) - > ( ) ) { 
 + let targetSize = sizeForAsset ( asset , scale : UIScreen . mainScreen ( ) . scale ) 
 + requestOptions . synchronous = true 
 + 
 + / / Workaround because PHImageManager . requestImageForAsset doesn ' t work for burst images 
 + if asset . representsBurst { 
 + imageManager . requestImageDataForAsset ( asset , options : requestOptions ) { data , _ , _ , _ in 
 + let image = data . flatMap { UIImage ( data : $ 0 ) } 
 + completion ( image : image ) 
 + } 
 + } 
 + else { 
 + imageManager . requestImageForAsset ( asset , targetSize : targetSize , contentMode : . AspectFill , options : requestOptions ) { image , _ in 
 + completion ( image : image ) 
 + } 
 + } 
 + } 
 + 
 + private func sizeForAsset ( asset : PHAsset , scale : CGFloat = 1 ) - > CGSize { 
 + let proportion = CGFloat ( asset . pixelWidth ) / CGFloat ( asset . pixelHeight ) 
 + 
 + let imageHeight = maximumPreviewHeight - 2 * previewCollectionViewInset 
 + let imageWidth = floor ( proportion * imageHeight ) 
 + 
 + return CGSize ( width : imageWidth * scale , height : imageHeight * scale ) 
 } 
 
 / / / collection view delegate 
 
 func numberOfSectionsInCollectionView ( collectionView : UICollectionView ) - > Int { 
 - return 0 
 + return 1 
 } 
 
 func collectionView ( collectionView : UICollectionView , numberOfItemsInSection section : Int ) - > Int { 
 - return 0 
 + print ( " ASSSEEETS = = = \ ( self . assets . count ) " ) 
 + return self . assets . count 
 } 
 
 func collectionView ( collectionView : UICollectionView , cellForItemAtIndexPath indexPath : NSIndexPath ) - > UICollectionViewCell { 
 - return UICollectionViewCell ( ) 
 + 
 + let cell = self . collectionView . dequeueReusableCellWithReuseIdentifier ( " AAThumbnailCollectionCell " , forIndexPath : indexPath ) as ! AAThumbnailCollectionCell 
 + 
 + cell . backgroundColor = UIColor . whiteColor ( ) 
 + 
 + let asset = assets [ indexPath . row ] 
 + 
 + requestImageForAsset ( asset ) { image in 
 + cell . imgSelected . image = image 
 + } 
 + 
 + 
 + return cell 
 } 
 
 / / / 
 @ @ - 52 , 43 + 176 , 41 @ @ class AAThumbnailView : UIView , UICollectionViewDelegate , UICollectionViewDataSou 
 } 
 
 func collectionViewSetup ( ) { 
 - 
 - if ( self . collectionView = = nil ) { 
 - 
 - let flowLayout = UICollectionViewFlowLayout ( ) 
 - flowLayout . scrollDirection = . Horizontal 
 - flowLayout . minimumLineSpacing = 4 
 - flowLayout . sectionInset = UIEdgeInsetsMake ( 5 . 0 , 4 . 0 , 5 . 0 , 4 . 0 ) 
 - 
 - flowLayout . itemSize = CGSizeMake ( 105 , 180 ) 
 - 
 - self . collectionView = UICollectionView ( frame : self . bounds , collectionViewLayout : flowLayout ) 
 - self . collectionView . backgroundColor = UIColor ( red : 230 . 0 / 255 . 0 , green : 231 . 0 / 255 . 0 , blue : 234 . 0 / 255 . 0 , alpha : 1 . 0 ) 
 - self . collectionView . showsHorizontalScrollIndicator = false 
 - self . collectionView . delegate = self 
 - self . collectionView . dataSource = self 
 - 
 - self . collectionView . registerClass ( AAThumbnailCollectionCell . self , forCellWithReuseIdentifier : " AAThumbnailCollectionCell " ) 
 - 
 - / / AAASAssetManager . sharedInstance 
 - 
 - / * 
 - 
 - [ [ UUAssetManager sharedInstance ] getGroupList : ^ ( NSArray * obj ) { 
 - 
 - [ [ UUAssetManager sharedInstance ] getPhotoListOfGroupByIndex : [ UUAssetManager sharedInstance ] . currentGroupIndex result : ^ ( NSArray * obj ) { 
 - 
 - [ _ collectionView reloadData ] ; 
 - 
 - } ] ; 
 - } ] ; 
 
 - * / 
 - 
 - 
 - 
 - } 
 + let flowLayout = UICollectionViewFlowLayout ( ) 
 + flowLayout . scrollDirection = . Horizontal 
 + flowLayout . minimumLineSpacing = 4 
 + flowLayout . sectionInset = UIEdgeInsetsMake ( 5 . 0 , 4 . 0 , 5 . 0 , 4 . 0 ) 
 + 
 + flowLayout . itemSize = CGSizeMake ( 90 , 90 ) 
 + 
 + self . collectionView = UICollectionView ( frame : self . bounds , collectionViewLayout : flowLayout ) 
 + self . collectionView . backgroundColor = UIColor . clearColor ( ) 
 + self . collectionView . showsHorizontalScrollIndicator = false 
 + self . collectionView . delegate = self 
 + self . collectionView . dataSource = self 
 + self . collectionView . frame = CGRectMake ( 0 , 0 , screenWidth , 80 ) 
 + 
 + self . collectionView . registerClass ( AAThumbnailCollectionCell . self , forCellWithReuseIdentifier : " AAThumbnailCollectionCell " ) 
 + 
 + self . addSubview ( self . collectionView ) 
 
 } 
 
 + func imageByCroppingImage ( image : UIImage , toSize : CGSize ) - > UIImage { 
 + 
 + let refWidth = CGImageGetWidth ( image . CGImage ) 
 + let refHeight = CGImageGetHeight ( image . CGImage ) 
 + 
 + let x = CGFloat ( ( refWidth - Int ( toSize . width ) ) / 2 ) 
 + let y = CGFloat ( ( refHeight - Int ( toSize . height ) ) / 2 ) 
 + 
 + let cropRect = CGRectMake ( x , y , toSize . height , toSize . width ) 
 + let imageRef = CGImageCreateWithImageInRect ( image . CGImage , cropRect ) ! as CGImageRef 
 + 
 + let cropped = UIImage ( CGImage : imageRef , scale : 0 . 0 , orientation : UIImageOrientation . Up ) 
 + 
 + return cropped ; 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 index 119c94c . . e34b500 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / Controllers / Conversation / ConversationViewController . swift 
 @ @ - 88 , 11 + 88 , 6 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 self . rightButton . enabled = true 
 self . rightButton . layoutIfNeeded ( ) 
 
 - / / self . rightButton . setTitle ( AALocalized ( " ChatSend " ) , forState : UIControlState . Normal ) 
 - / / self . rightButton . setTitleColor ( appStyle . chatSendColor , forState : UIControlState . Normal ) 
 - / / self . rightButton . setTitleColor ( appStyle . chatSendDisabledColor , forState : UIControlState . Disabled ) 
 - / / self . rightButton . setImage ( nil , forState : UIControlState . Normal ) 
 - 
 / / 
 
 self . audioButton = UIButton ( type : UIButtonType . Custom ) 
 @ @ - 496 , 7 + 491 , 7 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 
 showActionSheet ( builder . items , cancelButton : " AlertCancel " , destructButton : nil , sourceView : self . leftButton , sourceRect : self . leftButton . bounds , tapClosure : builder . tapClosure ) 
 
 - / / self . actionSheet . showAnimation ( ) 
 + / / self . actionSheet . showAnimation ( ) 
 
 self . rightButton . layoutIfNeeded ( ) 
 } 
 @ @ - 615 , 7 + 610 , 9 @ @ class ConversationViewController : AAConversationContentController , UIDocumentMen 
 func pickImage ( source : UIImagePickerControllerSourceType ) { 
 let pickerController = AAImagePickerController ( ) 
 pickerController . sourceType = source 
 - pickerController . mediaTypes = [ kUTTypeImage as String , kUTTypeMovie as String ] 
 + pickerController . mediaTypes = [ kUTTypeImage as String ] 
 + 
 + / / [ kUTTypeImage as String , kUTTypeMovie as String ] 
 
 / / / / Style controller bg 
 / / pickerController . view . backgroundColor = appStyle . vcBgColor
