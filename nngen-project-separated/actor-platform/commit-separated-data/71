BLEU SCORE: 0.02383853510228548

TEST MSG: feat ( android ) : add full global search
GENERATED MSG: Merge commit ' 3c548d4f2e5b40a6254bb1ce5daf5e3dbf9af4f9 '

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > index febdcc1 . . 9a21152 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > @ @ - 15 , 9 + 15 , 9 @ @ import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > - import android . widget . LinearLayout ; < nl > import android . widget . TextView ; < nl > < nl > + import java . util . ArrayList ; < nl > import java . util . List ; < nl > < nl > import im . actor . core . entity . Avatar ; < nl > @ @ - 30 , 10 + 30 , 10 @ @ import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > import im . actor . runtime . generic . mvvm . DisplayList ; < nl > + import im . actor . runtime . generic . mvvm . alg . Modifications ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . BaseFragment ; < nl > - import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; < nl > import im . actor . sdk . view . adapters . OnItemClickedListener ; < nl > @ @ - 57 , 9 + 57 , 9 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > private BindedDisplayList < SearchEntity > searchDisplay ; < nl > private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; < nl > < nl > - SearchHolder footerSearchHolder ; < nl > private String searchQuery ; < nl > - private LinearLayout footer ; < nl > + private boolean scrolledToEnd = true ; < nl > + private ArrayList < SearchEntity > globalSearchResults = new ArrayList < > ( ) ; < nl > < nl > public GlobalSearchBaseFragment ( ) { < nl > setHasOptionsMenu ( true ) ; < nl > @ @ - 159 , 20 + 159 , 25 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > if ( s . trim ( ) . length ( ) > 0 ) { < nl > String activeSearchQuery = searchQuery ; < nl > searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; < nl > + scrolledToEnd = false ; < nl > searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; < nl > + globalSearchResults . clear ( ) ; < nl > messenger ( ) . findPeers ( s ) . start ( new CommandCallback < List < PeerSearchEntity > > ( ) { < nl > @ Override < nl > public void onResult ( List < PeerSearchEntity > res ) { < nl > - int footerVisability = footer . getVisibility ( ) ; < nl > if ( searchQuery . equals ( activeSearchQuery ) ) { < nl > - boolean showResult = false ; < nl > - Peer peer = null ; < nl > - String name = null ; < nl > - Avatar avatar = null ; < nl > - if ( res . size ( ) > 0 ) { < nl > - PeerSearchEntity peerSearchEntity = res . get ( 0 ) ; < nl > - peer = peerSearchEntity . getPeer ( ) ; < nl > + int order = 0 ; < nl > + outer : < nl > + for ( PeerSearchEntity pse : res ) { < nl > + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { < nl > + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( pse . getPeer ( ) ) ) { < nl > + continue outer ; < nl > + } < nl > + } < nl > < nl > + Avatar avatar ; < nl > + Peer peer = pse . getPeer ( ) ; < nl > + String name ; < nl > if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > UserVM userVM = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > name = userVM . getName ( ) . get ( ) ; < nl > @ @ - 182 , 29 + 187 , 19 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > name = groupVM . getName ( ) . get ( ) ; < nl > avatar = groupVM . getAvatar ( ) . get ( ) ; < nl > } else { < nl > - return ; < nl > - } < nl > - showResult = true ; < nl > - for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { < nl > - if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( peer ) ) < nl > - showResult = false ; < nl > - break ; < nl > - } < nl > - < nl > - if ( peerSearchEntity . getOptMatchString ( ) ! = null ) { < nl > - name = peerSearchEntity . getOptMatchString ( ) ; < nl > + continue ; < nl > } < nl > + String optMatchString = pse . getOptMatchString ( ) ; < nl > + globalSearchResults . add ( new SearchEntity ( pse . getPeer ( ) , order + + , avatar , optMatchString = = null ? name : optMatchString ) ) ; < nl > } < nl > - if ( showResult ) { < nl > - footerSearchHolder . bind ( new SearchEntity ( peer , 0 , avatar , name ) , activeSearchQuery , true ) ; < nl > - showView ( footer ) ; < nl > - } else { < nl > - goneView ( footer ) ; < nl > + if ( globalSearchResults . size ( ) > 0 ) { < nl > + globalSearchResults . add ( new SearchEntityHeader ( order + + ) ) ; < nl > } < nl > - } < nl > - if ( footerVisability ! = footer . getVisibility ( ) ) { < nl > + checkGlobalSearch ( ) ; < nl > onSearchChanged ( ) ; < nl > + < nl > } < nl > + < nl > } < nl > < nl > @ Override < nl > @ @ - 215 , 8 + 210 , 6 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > < nl > } else { < nl > searchDisplay . initEmpty ( ) ; < nl > - goneView ( footer ) ; < nl > - < nl > } < nl > } < nl > return false ; < nl > @ @ - 225 , 12 + 218 , 15 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > } < nl > < nl > private void onSearchChanged ( ) { < nl > + if ( searchDisplay = = null ) { < nl > + return ; < nl > + } < nl > if ( ! searchDisplay . isInSearchState ( ) ) { < nl > showView ( searchHintView ) ; < nl > goneView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchHintView ) ; < nl > - if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { < nl > + if ( searchDisplay . getSize ( ) = = 0 ) { < nl > showView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchEmptyView ) ; < nl > @ @ - 245 , 6 + 241 , 18 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > isSearchVisible = true ; < nl > < nl > searchDisplay = messenger ( ) . buildSearchDisplayList ( ) ; < nl > + searchDisplay . setBindHook ( new BindedDisplayList . BindHook < SearchEntity > ( ) { < nl > + @ Override < nl > + public void onScrolledToEnd ( ) { < nl > + scrolledToEnd = true ; < nl > + checkGlobalSearch ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onItemTouched ( SearchEntity item ) { < nl > + < nl > + } < nl > + } ) ; < nl > searchAdapter = new SearchAdapter ( getActivity ( ) , searchDisplay , new OnItemClickedListener < SearchEntity > ( ) { < nl > @ Override < nl > public void onClicked ( SearchEntity item ) { < nl > @ @ - 264 , 46 + 272 , 6 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > recyclerAdapter . addHeaderView ( header ) ; < nl > < nl > - TextView footerTitle = new TextView ( getActivity ( ) ) ; < nl > - footerTitle . setText ( R . string . main _ search _ global _ header ) ; < nl > - footerTitle . setTextSize ( 16 ) ; < nl > - footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; < nl > - footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; < nl > - footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > - < nl > - footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { < nl > - @ Override < nl > - public void onClicked ( SearchEntity item ) { < nl > - searchMenu . collapseActionView ( ) ; < nl > - int peerId = item . getPeer ( ) . getPeerId ( ) ; < nl > - switch ( item . getPeer ( ) . getPeerType ( ) ) { < nl > - case PRIVATE : < nl > - startActivity ( Intents . openPrivateDialog ( peerId , true , getActivity ( ) ) ) ; < nl > - break ; < nl > - < nl > - case GROUP : < nl > - startActivity ( Intents . openGroupDialog ( peerId , false , getActivity ( ) ) ) ; < nl > - break ; < nl > - } < nl > - } < nl > - < nl > - @ Override < nl > - public boolean onLongClicked ( SearchEntity item ) { < nl > - return false ; < nl > - } < nl > - } ) ; < nl > - View footerGlobalSearchView = footerSearchHolder . itemView ; < nl > - < nl > - footer = new LinearLayout ( getActivity ( ) ) ; < nl > - footer . setOrientation ( LinearLayout . VERTICAL ) ; < nl > - LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; < nl > - footer . addView ( footerTitle , params ) ; < nl > - footer . addView ( footerGlobalSearchView , params ) ; < nl > - < nl > - footer . setVisibility ( View . GONE ) ; < nl > - < nl > - recyclerAdapter . addFooterView ( footer ) ; < nl > - < nl > searchList . setAdapter ( recyclerAdapter ) ; < nl > searchDisplay . addListener ( searchListener ) ; < nl > showView ( searchHintView , false ) ; < nl > @ @ - 317 , 6 + 285 , 12 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > } < nl > } < nl > < nl > + private void checkGlobalSearch ( ) { < nl > + if ( ( scrolledToEnd | | searchDisplay . getSize ( ) = = 0 ) & & globalSearchResults . size ( ) > 0 ) { < nl > + searchDisplay . editList ( Modifications . addLoadMore ( globalSearchResults ) ) ; < nl > + } < nl > + } < nl > + < nl > private void hideSearch ( ) { < nl > if ( ! isSearchVisible ) { < nl > return ; < nl > @ @ - 343 , 5 + 317 , 14 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > } < nl > } < nl > < nl > + public class SearchEntityHeader extends SearchEntity { < nl > + < nl > + public SearchEntityHeader ( int order ) { < nl > + super ( Peer . group ( 0 ) , order , null , " " ) ; < nl > + } < nl > + < nl > + < nl > + } < nl > + < nl > protected abstract void onPeerPicked ( Peer peer ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java < nl > index fa9e3c0 . . 749ac79 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java < nl > @ @ - 1 , 10 + 1 , 15 @ @ < nl > package im . actor . sdk . controllers . search ; < nl > < nl > import android . content . Context ; < nl > + import android . support . v7 . widget . RecyclerView ; < nl > import android . view . ViewGroup ; < nl > + import android . widget . TextView ; < nl > < nl > import im . actor . core . entity . SearchEntity ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > + import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . util . Screen ; < nl > import im . actor . sdk . view . adapters . OnItemClickedListener ; < nl > import im . actor . runtime . android . view . BindedListAdapter ; < nl > < nl > @ @ - 26 , 12 + 31 , 52 @ @ public class SearchAdapter extends BindedListAdapter < SearchEntity , SearchHolder > < nl > } < nl > < nl > @ Override < nl > + public int getItemViewType ( int position ) { < nl > + SearchEntity e = getItem ( position ) ; < nl > + if ( e instanceof GlobalSearchBaseFragment . SearchEntityHeader ) { < nl > + return 1 ; < nl > + } else { < nl > + return super . getItemViewType ( position ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > public SearchHolder onCreateViewHolder ( ViewGroup viewGroup , int viewType ) { < nl > - return new SearchHolder ( context , onItemClickedListener ) ; < nl > + switch ( viewType ) { < nl > + case 1 : < nl > + return new SearchHolderEx ( context , onItemClickedListener ) ; < nl > + default : < nl > + case 0 : < nl > + return new SearchHolder ( context , onItemClickedListener ) ; < nl > + } < nl > } < nl > < nl > @ Override < nl > public void onBindViewHolder ( SearchHolder dialogHolder , int index , SearchEntity item ) { < nl > dialogHolder . bind ( item , query , index = = getItemCount ( ) - 1 ) ; < nl > } < nl > + < nl > + public class SearchHolderEx extends SearchHolder { < nl > + public SearchHolderEx ( Context context , OnItemClickedListener < SearchEntity > clickedListener ) { < nl > + super ( context , clickedListener ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected void init ( Context context , OnItemClickedListener < SearchEntity > clickedListener ) { < nl > + itemView . setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , < nl > + ViewGroup . LayoutParams . WRAP _ CONTENT ) ) ; < nl > + itemView . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; < nl > + TextView globalSearchTitle = new TextView ( context ) ; < nl > + globalSearchTitle . setText ( R . string . main _ search _ global _ header ) ; < nl > + globalSearchTitle . setTextSize ( 16 ) ; < nl > + globalSearchTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; < nl > + globalSearchTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; < nl > + globalSearchTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + ( ( ViewGroup ) itemView ) . addView ( globalSearchTitle ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( SearchEntity entity , String query , boolean isLast ) { < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java < nl > index 89cb375 . . da08eb4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java < nl > @ @ - 30 , 7 + 30 , 10 @ @ public class SearchHolder extends BindedViewHolder { < nl > < nl > public SearchHolder ( Context context , final OnItemClickedListener < SearchEntity > clickedListener ) { < nl > super ( new FrameLayout ( context ) ) ; < nl > + init ( context , clickedListener ) ; < nl > + } < nl > < nl > + protected void init ( Context context , final OnItemClickedListener < SearchEntity > clickedListener ) { < nl > itemView . setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , < nl > ViewGroup . LayoutParams . WRAP _ CONTENT ) ) ; < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 5149fa8 . . 8f4b323 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 149 , 7 + 149 , 7 @ @ < nl > < nl > < ! - - Main - - > < nl > < string name = " main _ search _ hint " > Н а ч н и т е н а б и р а т ь д л я п о и с к а < / string > < nl > - < string name = " main _ search _ global _ header " > О б щ и й п о и с к < / string > < nl > + < string name = " main _ search _ global _ header " > Г л о б а л ь н ы й п о и с к < / string > < nl > < string name = " main _ search _ empty " > Н и ч е г о н е н а й д е н о < / string > < nl > < string name = " main _ menu _ help " > П о м о щ ь < / string > < nl > < string name = " main _ menu _ search " > П о и с к < / string > < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > index 4ef8c46 . . ef71ef2 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java < nl > @ @ - 353 , 6 + 353 , 9 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di < nl > < nl > if ( items . size ( ) = = 0 ) { < nl > window . onForwardCompleted ( ) ; < nl > + if ( bindHook ! = null ) { < nl > + bindHook . onScrolledToEnd ( ) ; < nl > + } < nl > / / Log . d ( TAG , " isLoadMoreForwardRequested = false : sync " ) ; < nl > isLoadMoreForwardRequested = false ; < nl > } else {
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index cbd1b86 . . 4d865cb 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 163 , 13 + 163 , 6 @ @ public interface ActorSDKDelegate { < nl > < nl > < nl > / * * < nl > - * Is Actor pushes used for this app - added for testing < nl > - * < nl > - * @ return is Actor push id used < nl > - * / < nl > - boolean useActorPush ( ) ; < nl > - < nl > - / * * < nl > * Method for hacking share menu in dialog < nl > * < nl > * @ param shareMenu share menu < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index f591d2a . . 63cd509 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 168 , 16 + 168 , 6 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > } < nl > < nl > / * * < nl > - * Is Actor pushes used for this app - added for testing < nl > - * < nl > - * @ return is Actor push id used < nl > - * / < nl > - @ Override < nl > - public boolean useActorPush ( ) { < nl > - return true ; < nl > - } < nl > - < nl > - / * * < nl > * Method for hacking share menu in dialog < nl > * < nl > * @ param shareMenu share menu < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > index 8edc540 . . 4907cd2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > @ @ - 1 , 21 + 1 , 36 @ @ < nl > package im . actor . sdk . controllers . group ; < nl > < nl > + import android . app . AlertDialog ; < nl > + import android . content . DialogInterface ; < nl > + import android . content . Intent ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . os . Bundle ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > public class GroupInfoActivity extends BaseFragmentActivity { < nl > < nl > + private GroupVM groupInfo ; < nl > + private int chatId ; < nl > + < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > - < nl > + chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > + groupInfo = groups ( ) . get ( chatId ) ; < nl > getSupportActionBar ( ) . setBackgroundDrawable ( new ColorDrawable ( Color . TRANSPARENT ) ) ; < nl > getSupportActionBar ( ) . setTitle ( null ) ; < nl > < nl > @ @ - 31 , 4 + 46 , 40 @ @ public class GroupInfoActivity extends BaseFragmentActivity { < nl > showFragment ( fragment , false , false ) ; < nl > } < nl > } < nl > + < nl > + @ Override < nl > + public boolean onCreateOptionsMenu ( Menu menu ) { < nl > + if ( groupInfo . isMember ( ) . get ( ) ) { < nl > + getMenuInflater ( ) . inflate ( R . menu . group _ info , menu ) ; < nl > + } < nl > + return true ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . leaveGroup ) { < nl > + new AlertDialog . Builder ( this ) < nl > + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > + groupInfo . getName ( ) . get ( ) ) ) < nl > + . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog2 , int which ) { < nl > + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > + } < nl > + } ) < nl > + . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > + . show ( ) < nl > + . setCanceledOnTouchOutside ( true ) ; < nl > + < nl > + return true ; < nl > + } else if ( item . getItemId ( ) = = R . id . addMember ) { < nl > + startActivity ( new Intent ( this , AddMemberActivity . class ) < nl > + . putExtra ( " GROUP _ ID " , chatId ) ) ; < nl > + } else if ( item . getItemId ( ) = = R . id . editTitle ) { < nl > + startActivity ( Intents . editGroupTitle ( chatId , this ) ) ; < nl > + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > + startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , this ) ) ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > index c58a224 . . 36170a7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > @ @ - 424 , 42 + 424 , 6 @ @ public class GroupInfoFragment extends BaseFragment { < nl > } < nl > < nl > @ Override < nl > - public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { < nl > - super . onCreateOptionsMenu ( menu , menuInflater ) ; < nl > - if ( groupInfo . isMember ( ) . get ( ) ) { < nl > - menuInflater . inflate ( R . menu . group _ info , menu ) ; < nl > - } < nl > - } < nl > - < nl > - @ Override < nl > - public boolean onOptionsItemSelected ( MenuItem item ) { < nl > - if ( item . getItemId ( ) = = R . id . leaveGroup ) { < nl > - new AlertDialog . Builder ( getActivity ( ) ) < nl > - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > - groupInfo . getName ( ) . get ( ) ) ) < nl > - . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { < nl > - @ Override < nl > - public void onClick ( DialogInterface dialog2 , int which ) { < nl > - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > - } < nl > - } ) < nl > - . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > - . show ( ) < nl > - . setCanceledOnTouchOutside ( true ) ; < nl > - < nl > - return true ; < nl > - } else if ( item . getItemId ( ) = = R . id . addMember ) { < nl > - startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) < nl > - . putExtra ( " GROUP _ ID " , chatId ) ) ; < nl > - } else if ( item . getItemId ( ) = = R . id . editTitle ) { < nl > - startActivity ( Intents . editGroupTitle ( chatId , getActivity ( ) ) ) ; < nl > - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > - startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , getActivity ( ) ) ) ; < nl > - } < nl > - return super . onOptionsItemSelected ( item ) ; < nl > - } < nl > - < nl > - @ Override < nl > public void onActivityResult ( int requestCode , int resultCode , Intent data ) { < nl > if ( resultCode = = Activity . RESULT _ OK & & requestCode = = 0 & & data ! = null & & data . hasExtra ( Intents . EXTRA _ UID ) ) { < nl > final UserVM userModel = users ( ) . get ( data . getIntExtra ( Intents . EXTRA _ UID , 0 ) ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > index 0efdef7 . . e9fa9ce 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > @ @ - 15 , 10 + 15 , 13 @ @ import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > + import android . widget . LinearLayout ; < nl > import android . widget . TextView ; < nl > < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . SearchEntity ; < nl > + import im . actor . core . viewmodel . CommandCallback ; < nl > + import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > import im . actor . runtime . generic . mvvm . DisplayList ; < nl > import im . actor . sdk . ActorSDK ; < nl > @ @ - 45 , 6 + 48 , 10 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > private BindedDisplayList < SearchEntity > searchDisplay ; < nl > private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; < nl > < nl > + SearchHolder footerSearchHolder ; < nl > + private String searchQuery ; < nl > + private LinearLayout footer ; < nl > + < nl > public GlobalSearchBaseFragment ( ) { < nl > setHasOptionsMenu ( true ) ; < nl > setUnbindOnPause ( true ) ; < nl > @ @ - 137 , 12 + 144 , 50 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > < nl > @ Override < nl > public boolean onQueryTextChange ( String s ) { < nl > + searchQuery = s . trim ( ) ; < nl > + < nl > if ( isSearchVisible ) { < nl > if ( s . trim ( ) . length ( ) > 0 ) { < nl > + String activeSearchQuery = searchQuery ; < nl > searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; < nl > searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; < nl > + messenger ( ) . findUsers ( s ) . start ( new CommandCallback < UserVM [ ] > ( ) { < nl > + @ Override < nl > + public void onResult ( UserVM [ ] res ) { < nl > + int footerVisability = footer . getVisibility ( ) ; < nl > + if ( searchQuery . equals ( activeSearchQuery ) ) { < nl > + boolean showResult = false ; < nl > + UserVM u = null ; < nl > + if ( res . length > 0 ) { < nl > + u = res [ 0 ] ; < nl > + showResult = true ; < nl > + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { < nl > + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( Peer . user ( u . getId ( ) ) ) ) < nl > + showResult = false ; < nl > + break ; < nl > + } < nl > + } < nl > + if ( showResult ) { < nl > + footerSearchHolder . bind ( new SearchEntity ( Peer . user ( u . getId ( ) ) , 0 , u . getAvatar ( ) . get ( ) , u . getName ( ) . get ( ) ) , activeSearchQuery , true ) ; < nl > + showView ( footer ) ; < nl > + } else { < nl > + goneView ( footer ) ; < nl > + } < nl > + } < nl > + if ( footerVisability ! = footer . getVisibility ( ) ) { < nl > + onSearchChanged ( ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + < nl > + } < nl > + } ) ; < nl > } else { < nl > searchDisplay . initEmpty ( ) ; < nl > + goneView ( footer ) ; < nl > + < nl > } < nl > } < nl > return false ; < nl > @ @ - 156 , 7 + 201 , 7 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > goneView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchHintView ) ; < nl > - if ( searchDisplay . getSize ( ) = = 0 ) { < nl > + if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { < nl > showView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchEmptyView ) ; < nl > @ @ - 190 , 6 + 235 , 51 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > recyclerAdapter . addHeaderView ( header ) ; < nl > < nl > + TextView footerTitle = new TextView ( getActivity ( ) ) ; < nl > + footerTitle . setText ( R . string . main _ search _ global _ header ) ; < nl > + footerTitle . setTextSize ( 16 ) ; < nl > + footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; < nl > + footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; < nl > + footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + < nl > + footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { < nl > + @ Override < nl > + public void onClicked ( SearchEntity item ) { < nl > + int peerId = item . getPeer ( ) . getPeerId ( ) ; < nl > + execute ( messenger ( ) . addContact ( peerId ) , R . string . progress _ common , new CommandCallback < Boolean > ( ) { < nl > + @ Override < nl > + public void onResult ( Boolean res2 ) { < nl > + startActivity ( Intents . openPrivateDialog ( peerId , < nl > + true , < nl > + getActivity ( ) ) ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + startActivity ( Intents . openPrivateDialog ( peerId , < nl > + true , < nl > + getActivity ( ) ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onLongClicked ( SearchEntity item ) { < nl > + return false ; < nl > + } < nl > + } ) ; < nl > + View footerGlobalSearchView = footerSearchHolder . itemView ; < nl > + < nl > + footer = new LinearLayout ( getActivity ( ) ) ; < nl > + footer . setOrientation ( LinearLayout . VERTICAL ) ; < nl > + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; < nl > + footer . addView ( footerTitle , params ) ; < nl > + footer . addView ( footerGlobalSearchView , params ) ; < nl > + < nl > + footer . setVisibility ( View . GONE ) ; < nl > + < nl > + recyclerAdapter . addFooterView ( footer ) ; < nl > + < nl > searchList . setAdapter ( recyclerAdapter ) ; < nl > searchDisplay . addListener ( searchListener ) ; < nl > showView ( searchHintView , false ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > index 57c9e38 . . f35bc06 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > @ @ - 345 , 10 + 345 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } ) ; < nl > < nl > - if ( noEmails & & noPhones ) { < nl > - contactsContainer . setVisibility ( View . GONE ) ; < nl > - about . findViewById ( R . id . divider ) . setVisibility ( View . INVISIBLE ) ; < nl > - } < nl > < nl > view . findViewById ( R . id . chatSettings ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > @ @ - 601 , 7 + 597 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } ) ; < nl > < nl > - updateActionBar ( scrollView . getScrollY ( ) ) ; < nl > + / / updateActionBar ( scrollView . getScrollY ( ) ) ; < nl > < nl > return view ; < nl > } < nl > @ @ - 726 , 24 + 722 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } < nl > < nl > - @ Override < nl > - public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > - super . onCreateOptionsMenu ( menu , inflater ) ; < nl > - inflater . inflate ( R . menu . my _ profile , menu ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public boolean onOptionsItemSelected ( MenuItem item ) { < nl > - if ( item . getItemId ( ) = = R . id . editProfile ) { < nl > - startActivity ( Intents . editMyName ( getActivity ( ) ) ) ; < nl > - return true ; < nl > - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > - startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , getActivity ( ) ) ) ; < nl > - return true ; < nl > - } < nl > - < nl > - return super . onOptionsItemSelected ( item ) ; < nl > - } < nl > < nl > @ Override < nl > public View getBeforeNickSettingsView ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > index ab18972 . . a61a53f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > @ @ - 3 , 11 + 3 , 18 @ @ package im . actor . sdk . controllers . settings ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . os . Bundle ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuItem ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; < nl > + < nl > public class MyProfileActivity extends BaseFragmentActivity { < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > @ @ - 33 , 4 + 40 , 23 @ @ public class MyProfileActivity extends BaseFragmentActivity { < nl > showFragment ( fragment , false , false ) ; < nl > } < nl > } < nl > + < nl > + @ Override < nl > + public boolean onCreateOptionsMenu ( Menu menu ) { < nl > + getMenuInflater ( ) . inflate ( R . menu . my _ profile , menu ) ; < nl > + return super . onCreateOptionsMenu ( menu ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . editProfile ) { < nl > + startActivity ( Intents . editMyName ( this ) ) ; < nl > + return true ; < nl > + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > + startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , this ) ) ; < nl > + return true ; < nl > + } < nl > + < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > index 95264da . . 3a58f6a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > @ @ - 18 , 6 + 18 , 7 @ @ < nl > < LinearLayout < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " < nl > + android : focusableInTouchMode = " true " < nl > android : orientation = " vertical " > < nl > < nl > < FrameLayout

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 index febdcc1 . . 9a21152 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 @ @ - 15 , 9 + 15 , 9 @ @ import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 - import android . widget . LinearLayout ; 
 import android . widget . TextView ; 
 
 + import java . util . ArrayList ; 
 import java . util . List ; 
 
 import im . actor . core . entity . Avatar ; 
 @ @ - 30 , 10 + 30 , 10 @ @ import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 import im . actor . runtime . generic . mvvm . DisplayList ; 
 + import im . actor . runtime . generic . mvvm . alg . Modifications ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . BaseFragment ; 
 - import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; 
 import im . actor . sdk . view . adapters . OnItemClickedListener ; 
 @ @ - 57 , 9 + 57 , 9 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 private BindedDisplayList < SearchEntity > searchDisplay ; 
 private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; 
 
 - SearchHolder footerSearchHolder ; 
 private String searchQuery ; 
 - private LinearLayout footer ; 
 + private boolean scrolledToEnd = true ; 
 + private ArrayList < SearchEntity > globalSearchResults = new ArrayList < > ( ) ; 
 
 public GlobalSearchBaseFragment ( ) { 
 setHasOptionsMenu ( true ) ; 
 @ @ - 159 , 20 + 159 , 25 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 if ( s . trim ( ) . length ( ) > 0 ) { 
 String activeSearchQuery = searchQuery ; 
 searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; 
 + scrolledToEnd = false ; 
 searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; 
 + globalSearchResults . clear ( ) ; 
 messenger ( ) . findPeers ( s ) . start ( new CommandCallback < List < PeerSearchEntity > > ( ) { 
 @ Override 
 public void onResult ( List < PeerSearchEntity > res ) { 
 - int footerVisability = footer . getVisibility ( ) ; 
 if ( searchQuery . equals ( activeSearchQuery ) ) { 
 - boolean showResult = false ; 
 - Peer peer = null ; 
 - String name = null ; 
 - Avatar avatar = null ; 
 - if ( res . size ( ) > 0 ) { 
 - PeerSearchEntity peerSearchEntity = res . get ( 0 ) ; 
 - peer = peerSearchEntity . getPeer ( ) ; 
 + int order = 0 ; 
 + outer : 
 + for ( PeerSearchEntity pse : res ) { 
 + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { 
 + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( pse . getPeer ( ) ) ) { 
 + continue outer ; 
 + } 
 + } 
 
 + Avatar avatar ; 
 + Peer peer = pse . getPeer ( ) ; 
 + String name ; 
 if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 UserVM userVM = users ( ) . get ( peer . getPeerId ( ) ) ; 
 name = userVM . getName ( ) . get ( ) ; 
 @ @ - 182 , 29 + 187 , 19 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 name = groupVM . getName ( ) . get ( ) ; 
 avatar = groupVM . getAvatar ( ) . get ( ) ; 
 } else { 
 - return ; 
 - } 
 - showResult = true ; 
 - for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { 
 - if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( peer ) ) 
 - showResult = false ; 
 - break ; 
 - } 
 - 
 - if ( peerSearchEntity . getOptMatchString ( ) ! = null ) { 
 - name = peerSearchEntity . getOptMatchString ( ) ; 
 + continue ; 
 } 
 + String optMatchString = pse . getOptMatchString ( ) ; 
 + globalSearchResults . add ( new SearchEntity ( pse . getPeer ( ) , order + + , avatar , optMatchString = = null ? name : optMatchString ) ) ; 
 } 
 - if ( showResult ) { 
 - footerSearchHolder . bind ( new SearchEntity ( peer , 0 , avatar , name ) , activeSearchQuery , true ) ; 
 - showView ( footer ) ; 
 - } else { 
 - goneView ( footer ) ; 
 + if ( globalSearchResults . size ( ) > 0 ) { 
 + globalSearchResults . add ( new SearchEntityHeader ( order + + ) ) ; 
 } 
 - } 
 - if ( footerVisability ! = footer . getVisibility ( ) ) { 
 + checkGlobalSearch ( ) ; 
 onSearchChanged ( ) ; 
 + 
 } 
 + 
 } 
 
 @ Override 
 @ @ - 215 , 8 + 210 , 6 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 
 } else { 
 searchDisplay . initEmpty ( ) ; 
 - goneView ( footer ) ; 
 - 
 } 
 } 
 return false ; 
 @ @ - 225 , 12 + 218 , 15 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 } 
 
 private void onSearchChanged ( ) { 
 + if ( searchDisplay = = null ) { 
 + return ; 
 + } 
 if ( ! searchDisplay . isInSearchState ( ) ) { 
 showView ( searchHintView ) ; 
 goneView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchHintView ) ; 
 - if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { 
 + if ( searchDisplay . getSize ( ) = = 0 ) { 
 showView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchEmptyView ) ; 
 @ @ - 245 , 6 + 241 , 18 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 isSearchVisible = true ; 
 
 searchDisplay = messenger ( ) . buildSearchDisplayList ( ) ; 
 + searchDisplay . setBindHook ( new BindedDisplayList . BindHook < SearchEntity > ( ) { 
 + @ Override 
 + public void onScrolledToEnd ( ) { 
 + scrolledToEnd = true ; 
 + checkGlobalSearch ( ) ; 
 + } 
 + 
 + @ Override 
 + public void onItemTouched ( SearchEntity item ) { 
 + 
 + } 
 + } ) ; 
 searchAdapter = new SearchAdapter ( getActivity ( ) , searchDisplay , new OnItemClickedListener < SearchEntity > ( ) { 
 @ Override 
 public void onClicked ( SearchEntity item ) { 
 @ @ - 264 , 46 + 272 , 6 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 recyclerAdapter . addHeaderView ( header ) ; 
 
 - TextView footerTitle = new TextView ( getActivity ( ) ) ; 
 - footerTitle . setText ( R . string . main _ search _ global _ header ) ; 
 - footerTitle . setTextSize ( 16 ) ; 
 - footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; 
 - footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; 
 - footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 - 
 - footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { 
 - @ Override 
 - public void onClicked ( SearchEntity item ) { 
 - searchMenu . collapseActionView ( ) ; 
 - int peerId = item . getPeer ( ) . getPeerId ( ) ; 
 - switch ( item . getPeer ( ) . getPeerType ( ) ) { 
 - case PRIVATE : 
 - startActivity ( Intents . openPrivateDialog ( peerId , true , getActivity ( ) ) ) ; 
 - break ; 
 - 
 - case GROUP : 
 - startActivity ( Intents . openGroupDialog ( peerId , false , getActivity ( ) ) ) ; 
 - break ; 
 - } 
 - } 
 - 
 - @ Override 
 - public boolean onLongClicked ( SearchEntity item ) { 
 - return false ; 
 - } 
 - } ) ; 
 - View footerGlobalSearchView = footerSearchHolder . itemView ; 
 - 
 - footer = new LinearLayout ( getActivity ( ) ) ; 
 - footer . setOrientation ( LinearLayout . VERTICAL ) ; 
 - LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; 
 - footer . addView ( footerTitle , params ) ; 
 - footer . addView ( footerGlobalSearchView , params ) ; 
 - 
 - footer . setVisibility ( View . GONE ) ; 
 - 
 - recyclerAdapter . addFooterView ( footer ) ; 
 - 
 searchList . setAdapter ( recyclerAdapter ) ; 
 searchDisplay . addListener ( searchListener ) ; 
 showView ( searchHintView , false ) ; 
 @ @ - 317 , 6 + 285 , 12 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 } 
 } 
 
 + private void checkGlobalSearch ( ) { 
 + if ( ( scrolledToEnd | | searchDisplay . getSize ( ) = = 0 ) & & globalSearchResults . size ( ) > 0 ) { 
 + searchDisplay . editList ( Modifications . addLoadMore ( globalSearchResults ) ) ; 
 + } 
 + } 
 + 
 private void hideSearch ( ) { 
 if ( ! isSearchVisible ) { 
 return ; 
 @ @ - 343 , 5 + 317 , 14 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 } 
 } 
 
 + public class SearchEntityHeader extends SearchEntity { 
 + 
 + public SearchEntityHeader ( int order ) { 
 + super ( Peer . group ( 0 ) , order , null , " " ) ; 
 + } 
 + 
 + 
 + } 
 + 
 protected abstract void onPeerPicked ( Peer peer ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java 
 index fa9e3c0 . . 749ac79 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchAdapter . java 
 @ @ - 1 , 10 + 1 , 15 @ @ 
 package im . actor . sdk . controllers . search ; 
 
 import android . content . Context ; 
 + import android . support . v7 . widget . RecyclerView ; 
 import android . view . ViewGroup ; 
 + import android . widget . TextView ; 
 
 import im . actor . core . entity . SearchEntity ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 + import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . util . Screen ; 
 import im . actor . sdk . view . adapters . OnItemClickedListener ; 
 import im . actor . runtime . android . view . BindedListAdapter ; 
 
 @ @ - 26 , 12 + 31 , 52 @ @ public class SearchAdapter extends BindedListAdapter < SearchEntity , SearchHolder > 
 } 
 
 @ Override 
 + public int getItemViewType ( int position ) { 
 + SearchEntity e = getItem ( position ) ; 
 + if ( e instanceof GlobalSearchBaseFragment . SearchEntityHeader ) { 
 + return 1 ; 
 + } else { 
 + return super . getItemViewType ( position ) ; 
 + } 
 + } 
 + 
 + @ Override 
 public SearchHolder onCreateViewHolder ( ViewGroup viewGroup , int viewType ) { 
 - return new SearchHolder ( context , onItemClickedListener ) ; 
 + switch ( viewType ) { 
 + case 1 : 
 + return new SearchHolderEx ( context , onItemClickedListener ) ; 
 + default : 
 + case 0 : 
 + return new SearchHolder ( context , onItemClickedListener ) ; 
 + } 
 } 
 
 @ Override 
 public void onBindViewHolder ( SearchHolder dialogHolder , int index , SearchEntity item ) { 
 dialogHolder . bind ( item , query , index = = getItemCount ( ) - 1 ) ; 
 } 
 + 
 + public class SearchHolderEx extends SearchHolder { 
 + public SearchHolderEx ( Context context , OnItemClickedListener < SearchEntity > clickedListener ) { 
 + super ( context , clickedListener ) ; 
 + } 
 + 
 + @ Override 
 + protected void init ( Context context , OnItemClickedListener < SearchEntity > clickedListener ) { 
 + itemView . setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , 
 + ViewGroup . LayoutParams . WRAP _ CONTENT ) ) ; 
 + itemView . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; 
 + TextView globalSearchTitle = new TextView ( context ) ; 
 + globalSearchTitle . setText ( R . string . main _ search _ global _ header ) ; 
 + globalSearchTitle . setTextSize ( 16 ) ; 
 + globalSearchTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; 
 + globalSearchTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; 
 + globalSearchTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + ( ( ViewGroup ) itemView ) . addView ( globalSearchTitle ) ; 
 + } 
 + 
 + @ Override 
 + public void bind ( SearchEntity entity , String query , boolean isLast ) { 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java 
 index 89cb375 . . da08eb4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / SearchHolder . java 
 @ @ - 30 , 7 + 30 , 10 @ @ public class SearchHolder extends BindedViewHolder { 
 
 public SearchHolder ( Context context , final OnItemClickedListener < SearchEntity > clickedListener ) { 
 super ( new FrameLayout ( context ) ) ; 
 + init ( context , clickedListener ) ; 
 + } 
 
 + protected void init ( Context context , final OnItemClickedListener < SearchEntity > clickedListener ) { 
 itemView . setLayoutParams ( new RecyclerView . LayoutParams ( ViewGroup . LayoutParams . MATCH _ PARENT , 
 ViewGroup . LayoutParams . WRAP _ CONTENT ) ) ; 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 5149fa8 . . 8f4b323 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 149 , 7 + 149 , 7 @ @ 
 
 < ! - - Main - - > 
 < string name = " main _ search _ hint " > Н а ч н и т е н а б и р а т ь д л я п о и с к а < / string > 
 - < string name = " main _ search _ global _ header " > О б щ и й п о и с к < / string > 
 + < string name = " main _ search _ global _ header " > Г л о б а л ь н ы й п о и с к < / string > 
 < string name = " main _ search _ empty " > Н и ч е г о н е н а й д е н о < / string > 
 < string name = " main _ menu _ help " > П о м о щ ь < / string > 
 < string name = " main _ menu _ search " > П о и с к < / string > 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 index 4ef8c46 . . ef71ef2 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - generic / src / main / java / im / actor / runtime / generic / mvvm / BindedDisplayList . java 
 @ @ - 353 , 6 + 353 , 9 @ @ public class BindedDisplayList < T extends BserObject & ListEngineItem > extends Di 
 
 if ( items . size ( ) = = 0 ) { 
 window . onForwardCompleted ( ) ; 
 + if ( bindHook ! = null ) { 
 + bindHook . onScrolledToEnd ( ) ; 
 + } 
 / / Log . d ( TAG , " isLoadMoreForwardRequested = false : sync " ) ; 
 isLoadMoreForwardRequested = false ; 
 } else {

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index cbd1b86 . . 4d865cb 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 163 , 13 + 163 , 6 @ @ public interface ActorSDKDelegate { 
 
 
 / * * 
 - * Is Actor pushes used for this app - added for testing 
 - * 
 - * @ return is Actor push id used 
 - * / 
 - boolean useActorPush ( ) ; 
 - 
 - / * * 
 * Method for hacking share menu in dialog 
 * 
 * @ param shareMenu share menu 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index f591d2a . . 63cd509 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 168 , 16 + 168 , 6 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 } 
 
 / * * 
 - * Is Actor pushes used for this app - added for testing 
 - * 
 - * @ return is Actor push id used 
 - * / 
 - @ Override 
 - public boolean useActorPush ( ) { 
 - return true ; 
 - } 
 - 
 - / * * 
 * Method for hacking share menu in dialog 
 * 
 * @ param shareMenu share menu 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 index 8edc540 . . 4907cd2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 @ @ - 1 , 21 + 1 , 36 @ @ 
 package im . actor . sdk . controllers . group ; 
 
 + import android . app . AlertDialog ; 
 + import android . content . DialogInterface ; 
 + import android . content . Intent ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . os . Bundle ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 public class GroupInfoActivity extends BaseFragmentActivity { 
 
 + private GroupVM groupInfo ; 
 + private int chatId ; 
 + 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 - 
 + chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 + groupInfo = groups ( ) . get ( chatId ) ; 
 getSupportActionBar ( ) . setBackgroundDrawable ( new ColorDrawable ( Color . TRANSPARENT ) ) ; 
 getSupportActionBar ( ) . setTitle ( null ) ; 
 
 @ @ - 31 , 4 + 46 , 40 @ @ public class GroupInfoActivity extends BaseFragmentActivity { 
 showFragment ( fragment , false , false ) ; 
 } 
 } 
 + 
 + @ Override 
 + public boolean onCreateOptionsMenu ( Menu menu ) { 
 + if ( groupInfo . isMember ( ) . get ( ) ) { 
 + getMenuInflater ( ) . inflate ( R . menu . group _ info , menu ) ; 
 + } 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . leaveGroup ) { 
 + new AlertDialog . Builder ( this ) 
 + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 + groupInfo . getName ( ) . get ( ) ) ) 
 + . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog2 , int which ) { 
 + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 + } 
 + } ) 
 + . setNegativeButton ( R . string . dialog _ cancel , null ) 
 + . show ( ) 
 + . setCanceledOnTouchOutside ( true ) ; 
 + 
 + return true ; 
 + } else if ( item . getItemId ( ) = = R . id . addMember ) { 
 + startActivity ( new Intent ( this , AddMemberActivity . class ) 
 + . putExtra ( " GROUP _ ID " , chatId ) ) ; 
 + } else if ( item . getItemId ( ) = = R . id . editTitle ) { 
 + startActivity ( Intents . editGroupTitle ( chatId , this ) ) ; 
 + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 + startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , this ) ) ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 index c58a224 . . 36170a7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 @ @ - 424 , 42 + 424 , 6 @ @ public class GroupInfoFragment extends BaseFragment { 
 } 
 
 @ Override 
 - public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { 
 - super . onCreateOptionsMenu ( menu , menuInflater ) ; 
 - if ( groupInfo . isMember ( ) . get ( ) ) { 
 - menuInflater . inflate ( R . menu . group _ info , menu ) ; 
 - } 
 - } 
 - 
 - @ Override 
 - public boolean onOptionsItemSelected ( MenuItem item ) { 
 - if ( item . getItemId ( ) = = R . id . leaveGroup ) { 
 - new AlertDialog . Builder ( getActivity ( ) ) 
 - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 - groupInfo . getName ( ) . get ( ) ) ) 
 - . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { 
 - @ Override 
 - public void onClick ( DialogInterface dialog2 , int which ) { 
 - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 - } 
 - } ) 
 - . setNegativeButton ( R . string . dialog _ cancel , null ) 
 - . show ( ) 
 - . setCanceledOnTouchOutside ( true ) ; 
 - 
 - return true ; 
 - } else if ( item . getItemId ( ) = = R . id . addMember ) { 
 - startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) 
 - . putExtra ( " GROUP _ ID " , chatId ) ) ; 
 - } else if ( item . getItemId ( ) = = R . id . editTitle ) { 
 - startActivity ( Intents . editGroupTitle ( chatId , getActivity ( ) ) ) ; 
 - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 - startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , getActivity ( ) ) ) ; 
 - } 
 - return super . onOptionsItemSelected ( item ) ; 
 - } 
 - 
 - @ Override 
 public void onActivityResult ( int requestCode , int resultCode , Intent data ) { 
 if ( resultCode = = Activity . RESULT _ OK & & requestCode = = 0 & & data ! = null & & data . hasExtra ( Intents . EXTRA _ UID ) ) { 
 final UserVM userModel = users ( ) . get ( data . getIntExtra ( Intents . EXTRA _ UID , 0 ) ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 index 0efdef7 . . e9fa9ce 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 @ @ - 15 , 10 + 15 , 13 @ @ import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 + import android . widget . LinearLayout ; 
 import android . widget . TextView ; 
 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . SearchEntity ; 
 + import im . actor . core . viewmodel . CommandCallback ; 
 + import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 import im . actor . runtime . generic . mvvm . DisplayList ; 
 import im . actor . sdk . ActorSDK ; 
 @ @ - 45 , 6 + 48 , 10 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 private BindedDisplayList < SearchEntity > searchDisplay ; 
 private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; 
 
 + SearchHolder footerSearchHolder ; 
 + private String searchQuery ; 
 + private LinearLayout footer ; 
 + 
 public GlobalSearchBaseFragment ( ) { 
 setHasOptionsMenu ( true ) ; 
 setUnbindOnPause ( true ) ; 
 @ @ - 137 , 12 + 144 , 50 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 
 @ Override 
 public boolean onQueryTextChange ( String s ) { 
 + searchQuery = s . trim ( ) ; 
 + 
 if ( isSearchVisible ) { 
 if ( s . trim ( ) . length ( ) > 0 ) { 
 + String activeSearchQuery = searchQuery ; 
 searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; 
 searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; 
 + messenger ( ) . findUsers ( s ) . start ( new CommandCallback < UserVM [ ] > ( ) { 
 + @ Override 
 + public void onResult ( UserVM [ ] res ) { 
 + int footerVisability = footer . getVisibility ( ) ; 
 + if ( searchQuery . equals ( activeSearchQuery ) ) { 
 + boolean showResult = false ; 
 + UserVM u = null ; 
 + if ( res . length > 0 ) { 
 + u = res [ 0 ] ; 
 + showResult = true ; 
 + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { 
 + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( Peer . user ( u . getId ( ) ) ) ) 
 + showResult = false ; 
 + break ; 
 + } 
 + } 
 + if ( showResult ) { 
 + footerSearchHolder . bind ( new SearchEntity ( Peer . user ( u . getId ( ) ) , 0 , u . getAvatar ( ) . get ( ) , u . getName ( ) . get ( ) ) , activeSearchQuery , true ) ; 
 + showView ( footer ) ; 
 + } else { 
 + goneView ( footer ) ; 
 + } 
 + } 
 + if ( footerVisability ! = footer . getVisibility ( ) ) { 
 + onSearchChanged ( ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + 
 + } 
 + } ) ; 
 } else { 
 searchDisplay . initEmpty ( ) ; 
 + goneView ( footer ) ; 
 + 
 } 
 } 
 return false ; 
 @ @ - 156 , 7 + 201 , 7 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 goneView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchHintView ) ; 
 - if ( searchDisplay . getSize ( ) = = 0 ) { 
 + if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { 
 showView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchEmptyView ) ; 
 @ @ - 190 , 6 + 235 , 51 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 recyclerAdapter . addHeaderView ( header ) ; 
 
 + TextView footerTitle = new TextView ( getActivity ( ) ) ; 
 + footerTitle . setText ( R . string . main _ search _ global _ header ) ; 
 + footerTitle . setTextSize ( 16 ) ; 
 + footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; 
 + footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; 
 + footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + 
 + footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { 
 + @ Override 
 + public void onClicked ( SearchEntity item ) { 
 + int peerId = item . getPeer ( ) . getPeerId ( ) ; 
 + execute ( messenger ( ) . addContact ( peerId ) , R . string . progress _ common , new CommandCallback < Boolean > ( ) { 
 + @ Override 
 + public void onResult ( Boolean res2 ) { 
 + startActivity ( Intents . openPrivateDialog ( peerId , 
 + true , 
 + getActivity ( ) ) ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + startActivity ( Intents . openPrivateDialog ( peerId , 
 + true , 
 + getActivity ( ) ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onLongClicked ( SearchEntity item ) { 
 + return false ; 
 + } 
 + } ) ; 
 + View footerGlobalSearchView = footerSearchHolder . itemView ; 
 + 
 + footer = new LinearLayout ( getActivity ( ) ) ; 
 + footer . setOrientation ( LinearLayout . VERTICAL ) ; 
 + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; 
 + footer . addView ( footerTitle , params ) ; 
 + footer . addView ( footerGlobalSearchView , params ) ; 
 + 
 + footer . setVisibility ( View . GONE ) ; 
 + 
 + recyclerAdapter . addFooterView ( footer ) ; 
 + 
 searchList . setAdapter ( recyclerAdapter ) ; 
 searchDisplay . addListener ( searchListener ) ; 
 showView ( searchHintView , false ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 index 57c9e38 . . f35bc06 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 @ @ - 345 , 10 + 345 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } ) ; 
 
 - if ( noEmails & & noPhones ) { 
 - contactsContainer . setVisibility ( View . GONE ) ; 
 - about . findViewById ( R . id . divider ) . setVisibility ( View . INVISIBLE ) ; 
 - } 
 
 view . findViewById ( R . id . chatSettings ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 @ @ - 601 , 7 + 597 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } ) ; 
 
 - updateActionBar ( scrollView . getScrollY ( ) ) ; 
 + / / updateActionBar ( scrollView . getScrollY ( ) ) ; 
 
 return view ; 
 } 
 @ @ - 726 , 24 + 722 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } 
 
 - @ Override 
 - public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 - super . onCreateOptionsMenu ( menu , inflater ) ; 
 - inflater . inflate ( R . menu . my _ profile , menu ) ; 
 - } 
 - 
 - @ Override 
 - public boolean onOptionsItemSelected ( MenuItem item ) { 
 - if ( item . getItemId ( ) = = R . id . editProfile ) { 
 - startActivity ( Intents . editMyName ( getActivity ( ) ) ) ; 
 - return true ; 
 - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 - startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , getActivity ( ) ) ) ; 
 - return true ; 
 - } 
 - 
 - return super . onOptionsItemSelected ( item ) ; 
 - } 
 
 @ Override 
 public View getBeforeNickSettingsView ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 index ab18972 . . a61a53f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 @ @ - 3 , 11 + 3 , 18 @ @ package im . actor . sdk . controllers . settings ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . os . Bundle ; 
 + import android . view . Menu ; 
 + import android . view . MenuItem ; 
 
 import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; 
 + 
 public class MyProfileActivity extends BaseFragmentActivity { 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 @ @ - 33 , 4 + 40 , 23 @ @ public class MyProfileActivity extends BaseFragmentActivity { 
 showFragment ( fragment , false , false ) ; 
 } 
 } 
 + 
 + @ Override 
 + public boolean onCreateOptionsMenu ( Menu menu ) { 
 + getMenuInflater ( ) . inflate ( R . menu . my _ profile , menu ) ; 
 + return super . onCreateOptionsMenu ( menu ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . editProfile ) { 
 + startActivity ( Intents . editMyName ( this ) ) ; 
 + return true ; 
 + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 + startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , this ) ) ; 
 + return true ; 
 + } 
 + 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 index 95264da . . 3a58f6a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 @ @ - 18 , 6 + 18 , 7 @ @ 
 < LinearLayout 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " 
 + android : focusableInTouchMode = " true " 
 android : orientation = " vertical " > 
 
 < FrameLayout
