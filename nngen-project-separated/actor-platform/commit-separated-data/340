BLEU SCORE: 0.2186976686325118

TEST MSG: feat ( android ) : recover old share app link , multiple invites - select all / none
GENERATED MSG: feat ( android ) : add group app invites

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > index b4c3406 . . dadcd57 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > @ @ - 1 , 6 + 1 , 8 @ @ < nl > package im . actor . sdk . controllers . contacts ; < nl > < nl > import android . app . Activity ; < nl > + import android . app . AlertDialog ; < nl > + import android . content . DialogInterface ; < nl > import android . content . Intent ; < nl > import android . os . Bundle ; < nl > import android . support . v7 . widget . RecyclerView ; < nl > @ @ - 116 , 18 + 118 , 7 @ @ public abstract class BaseContactFragment extends DisplayListFragment < Contact , C < nl > addFooterOrHeaderAction ( ActorSDK . sharedActor ( ) . style . getActionShareColor ( ) , R . drawable . ic _ share _ white _ 24dp , R . string . contacts _ share , false , new Runnable ( ) { < nl > @ Override < nl > public void run ( ) { < nl > - Intent intent ; < nl > - < nl > - if ( USE _ APP _ INVITES ) { < nl > - intent = new Intent ( getActivity ( ) , InviteActivity . class ) ; < nl > - } else { < nl > - String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; < nl > - intent = new Intent ( Intent . ACTION _ SEND ) ; < nl > - intent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; < nl > - intent . setType ( " text / plain " ) ; < nl > - } < nl > - < nl > - startActivity ( intent ) ; < nl > + sendInvites ( ) ; < nl > } < nl > } , true ) ; < nl > < nl > @ @ - 145 , 6 + 136 , 39 @ @ public abstract class BaseContactFragment extends DisplayListFragment < Contact , C < nl > } < nl > } < nl > < nl > + public void sendInvites ( ) { < nl > + < nl > + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; < nl > + builder . setItems ( new String [ ] { getString ( R . string . invites _ share _ link _ one ) , getString ( R . string . invites _ share _ link _ multiple ) } , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog , int which ) { < nl > + switch ( which ) { < nl > + case 0 : < nl > + sendOneInvite ( ) ; < nl > + break ; < nl > + < nl > + case 1 : < nl > + sendMultipleInvites ( ) ; < nl > + break ; < nl > + } < nl > + dialog . dismiss ( ) ; < nl > + } < nl > + } ) . show ( ) ; < nl > + } < nl > + < nl > + public void sendMultipleInvites ( ) { < nl > + Intent intent = new Intent ( getActivity ( ) , InviteActivity . class ) ; < nl > + startActivity ( intent ) ; < nl > + } < nl > + < nl > + public void sendOneInvite ( ) { < nl > + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; < nl > + Intent sendIntent = new Intent ( Intent . ACTION _ SEND ) ; < nl > + sendIntent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; < nl > + sendIntent . setType ( " text / plain " ) ; < nl > + startActivity ( sendIntent ) ; < nl > + } < nl > + < nl > protected void addFooterOrHeaderAction ( int color , int icon , int text , boolean isLast , final Runnable action , boolean isHeader ) { < nl > FrameLayout container = new FrameLayout ( getActivity ( ) ) ; < nl > container . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java < nl > index 208fa12 . . d11b861 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java < nl > @ @ - 34 , 11 + 34 , 7 @ @ public class ContactsFragment extends BaseContactFragment { < nl > res . findViewById ( R . id . inviteButton ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > - String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; < nl > - Intent sendIntent = new Intent ( Intent . ACTION _ SEND ) ; < nl > - sendIntent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; < nl > - sendIntent . setType ( " text / plain " ) ; < nl > - startActivity ( sendIntent ) ; < nl > + sendInvites ( ) ; < nl > } < nl > } ) ; < nl > ( ( TextView ) res . findViewById ( R . id . no _ contacts _ text ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryAccentColor ( ) ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java < nl > index 8382dc9 . . f02d7c1 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java < nl > @ @ - 102 , 4 + 102 , 15 @ @ public class InviteAdapter extends HolderAdapter < PhoneBookContact > { < nl > protected ViewHolder < PhoneBookContact > createHolder ( PhoneBookContact obj ) { < nl > return new InviteContactHolder ( new FrameLayout ( context ) , context , onItemClickedListener ) ; < nl > } < nl > + < nl > + public void selectNone ( ) { < nl > + selectedContactType . clear ( ) ; < nl > + selectedUsers . clear ( ) ; < nl > + notifyDataSetChanged ( ) ; < nl > + } < nl > + < nl > + public void selectAll ( ) { < nl > + selectedUsers . addAll ( phoneBook ) ; < nl > + notifyDataSetChanged ( ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java < nl > index 9fb6622 . . abc3aa7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java < nl > @ @ - 170 , 14 + 170 , 10 @ @ public class InviteContactHolder extends ViewHolder < PhoneBookContact > { < nl > title . setText ( data . getName ( ) ) ; < nl > } < nl > < nl > - if ( selected ) { < nl > - if ( ( type = = TYPE _ EMAIL & & data . getEmails ( ) . size ( ) > 0 ) | | data . getPhones ( ) . size ( ) = = 0 ) { < nl > - subtitle . setText ( data . getEmails ( ) . get ( 0 ) . getEmail ( ) ) ; < nl > - } else { < nl > - subtitle . setText ( Long . toString ( data . getPhones ( ) . get ( 0 ) . getNumber ( ) ) ) ; < nl > - } < nl > + if ( ( type = = TYPE _ EMAIL & & data . getEmails ( ) . size ( ) > 0 ) | | data . getPhones ( ) . size ( ) = = 0 ) { < nl > + subtitle . setText ( data . getEmails ( ) . get ( 0 ) . getEmail ( ) ) ; < nl > } else { < nl > - subtitle . setText ( " " ) ; < nl > + subtitle . setText ( Long . toString ( data . getPhones ( ) . get ( 0 ) . getNumber ( ) ) ) ; < nl > } < nl > < nl > isSelected . setChecked ( selected ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > index bde4106 . . e57f6ba 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > @ @ - 28 , 11 + 28 , 12 @ @ import im . actor . sdk . view . adapters . RecyclerListView ; < nl > public class InviteFragment extends BaseFragment { < nl > < nl > < nl > - private MenuItem sendButton ; < nl > private RecyclerListView collection ; < nl > private InviteAdapter adapter ; < nl > private List < PhoneBookContact > contacts ; < nl > private TextView emptyText ; < nl > + private Menu menu ; < nl > + private MenuInflater inflater ; < nl > < nl > public InviteFragment ( ) { < nl > } < nl > @ @ - 51 , 6 + 52 , 8 @ @ public class InviteFragment extends BaseFragment { < nl > AndroidPhoneBook phoneBookLoader = new AndroidPhoneBook ( ) ; < nl > phoneBookLoader . useDelay ( false ) ; < nl > < nl > + res . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > + < nl > phoneBookLoader . loadPhoneBook ( contacts - > { < nl > if ( contacts . size ( ) > 0 ) { < nl > < nl > @ @ - 75 , 19 + 78 , 12 @ @ public class InviteFragment extends BaseFragment { < nl > < nl > hideView ( emptyText ) ; < nl > showView ( collection ) ; < nl > - < nl > - < nl > - if ( sendButton ! = null ) { < nl > - sendButton . setVisible ( true ) ; < nl > - } < nl > + showMenu ( ) ; < nl > } ) ; < nl > < nl > } < nl > } ) ; < nl > < nl > - < nl > - res . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > - < nl > return res ; < nl > } < nl > < nl > @ @ - 140 , 18 + 136 , 29 @ @ public class InviteFragment extends BaseFragment { < nl > @ Override < nl > public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > super . onCreateOptionsMenu ( menu , inflater ) ; < nl > - inflater . inflate ( R . menu . invite , menu ) ; < nl > - sendButton = menu . getItem ( 0 ) ; < nl > - if ( adapter ! = null & & adapter . getCount ( ) > 0 ) { < nl > - sendButton . setVisible ( true ) ; < nl > + this . menu = menu ; < nl > + this . inflater = inflater ; < nl > + showMenu ( ) ; < nl > + } < nl > + < nl > + public void showMenu ( ) { < nl > + if ( menu ! = null & & inflater ! = null & & adapter ! = null ) { < nl > + if ( adapter . getCount ( ) > 0 ) { < nl > + inflater . inflate ( R . menu . invite , menu ) ; < nl > + } < nl > } < nl > } < nl > < nl > @ Override < nl > public boolean onOptionsItemSelected ( MenuItem item ) { < nl > - if ( item . getItemId ( ) = = R . id . send _ invites ) { < nl > + int id = item . getItemId ( ) ; < nl > + if ( id = = R . id . send _ invites ) { < nl > sendInvites ( ) ; < nl > return true ; < nl > + } else if ( id = = R . id . select _ all ) { < nl > + adapter . selectAll ( ) ; < nl > + } else if ( id = = R . id . select _ none ) { < nl > + adapter . selectNone ( ) ; < nl > } < nl > return super . onOptionsItemSelected ( item ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > index cddbf65 . . fdf0a92 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > @ @ - 8 , 11 + 8 , 20 @ @ < nl > xmlns : app = " http : / / schemas . android . com / apk / res - auto " > < nl > < nl > < item < nl > - android : visible = " false " < nl > android : id = " @ + id / send _ invites " < nl > android : icon = " @ drawable / attach _ send2 " < nl > android : title = " @ string / contacts _ invite _ via _ link " < nl > app : showAsAction = " always " / > < nl > < nl > + < item < nl > + android : id = " @ + id / select _ all " < nl > + android : title = " @ string / invites _ select _ all " < nl > + app : showAsAction = " never " / > < nl > + < nl > + < item < nl > + android : id = " @ + id / select _ none " < nl > + android : title = " @ string / invites _ select _ none " < nl > + app : showAsAction = " never " / > < nl > + < nl > < nl > < / menu > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 9d9e57d . . 641e30f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 215 , 7 + 215 , 7 @ @ < nl > < string name = " contacts _ title " > К о н т а к т ы < / string > < nl > < string name = " contacts _ empty _ short " > Е щ е н е т к о н т а к т о в < / string > < nl > < string name = " contacts _ share " > Р а с с к а з а т ь д р у з ь я м о б { appName } < / string > < nl > - < string name = " contacts _ add " > Д о б а в и т ь д р у г а . . . < / string > < nl > + < string name = " contacts _ add " > Д о б а в и т ь д р у г а … < / string > < nl > < nl > < string name = " contacts _ menu _ remove " > У д а л и т ь { 0 } и з к о н т а к т о в < / string > < nl > < string name = " contacts _ menu _ remove _ progress " > У д а л е н и е … < / string > < nl > @ @ - 228 , 6 + 228 , 13 @ @ < nl > < nl > < string name = " contacts _ invite _ via _ link " > О т п р а в и т ь с с ы л к у < / string > < nl > < nl > + < string name = " invites _ select _ all " > В ы б р а т ь в с е < / string > < nl > + < string name = " invites _ select _ none " > С н я т ь в ы б о р < / string > < nl > + < nl > + < string name = " invites _ share _ link _ one " > О т п р а в и т ь с с ы л к у < / string > < nl > + < string name = " invites _ share _ link _ multiple " > О т п р а в и т ь с с ы л к у н е с к о л ь к и м к о н т а к т а м < / string > < nl > + < nl > + < nl > < ! - - Chat - - > < nl > < string name = " chat _ menu _ group _ info " > И н ф . о г р у п п е < / string > < nl > < string name = " chat _ menu _ view _ contact " > И н ф . о к о н т а к т е < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 20ead16 . . 11b52d3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 219 , 7 + 219 , 7 @ @ < nl > < string name = " contacts _ title " > Contacts < / string > < nl > < string name = " contacts _ empty _ short " > No contacts here yet < / string > < nl > < string name = " contacts _ share " > Tell your friends about { appName } < / string > < nl > - < string name = " contacts _ add " > Add friend . . . < / string > < nl > + < string name = " contacts _ add " > Add friend … < / string > < nl > < nl > < string name = " contacts _ empty _ title " > Invite your friends < / string > < nl > < string name = " contacts _ empty _ invite _ hint " > None of your contacts are using { appName } . Use the button below to invite them . < / string > < nl > @ @ - 232 , 6 + 232 , 12 @ @ < nl > < nl > < string name = " contacts _ invite _ via _ link " > Invite via link < / string > < nl > < nl > + < string name = " invites _ select _ all " > Select all < / string > < nl > + < string name = " invites _ select _ none " > Select none < / string > < nl > + < nl > + < string name = " invites _ share _ link _ one " > Share link < / string > < nl > + < string name = " invites _ share _ link _ multiple " > Send link via sms / email to multiple contacts < / string > < nl > + < nl > < ! - - Chat - - > < nl > < string name = " chat _ menu _ group _ info " > Group info < / string > < nl > < string name = " chat _ menu _ view _ contact " > View contact < / string >
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > index 740e6c2 . . edf0d6d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > @ @ - 37 , 7 + 37 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public abstract class BaseContactFragment extends DisplayListFragment < Contact , ContactHolder > { < nl > < nl > - private static final boolean USE _ APP _ INVITES = false ; < nl > + private static final boolean USE _ APP _ INVITES = true ; < nl > private final boolean useCompactVersion ; < nl > private final boolean userSearch ; < nl > private final boolean useSelection ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > index c61f017 . . 52bb42a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > @ @ - 13 , 7 + 13 , 7 @ @ public class InviteActivity extends BaseFragmentActivity { < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > < nl > - getSupportActionBar ( ) . setTitle ( R . string . contacts _ share ) ; < nl > + getSupportActionBar ( ) . setTitle ( R . string . contacts _ invite _ via _ link ) ; < nl > < nl > < nl > if ( savedInstanceState = = null ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > index 89b964f . . f9a8748 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > @ @ - 1 , 14 + 1 , 24 @ @ < nl > package im . actor . sdk . controllers . contacts ; < nl > < nl > import android . app . Activity ; < nl > + import android . content . DialogInterface ; < nl > + import android . content . Intent ; < nl > + import android . net . Uri ; < nl > import android . os . Bundle ; < nl > import android . support . v7 . app . AlertDialog ; < nl > + import android . telephony . SmsManager ; < nl > import android . view . LayoutInflater ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . TextView ; < nl > < nl > + import java . util . ArrayList ; < nl > + import java . util . HashMap ; < nl > + < nl > import im . actor . core . entity . PhoneBookContact ; < nl > import im . actor . runtime . android . view . BindedListAdapter ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > @ @ - 26 , 6 + 36 , 7 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite < nl > < nl > < nl > private View emptyView ; < nl > + private MenuItem sendButton ; < nl > < nl > public InviteFragment ( ) { < nl > } < nl > @ @ - 144 , 4 + 155 , 107 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite < nl > return ( ( InviteContactAdapter ) getAdapter ( ) ) . isSelected ( id ) ; < nl > } < nl > < nl > + @ Override < nl > + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > + super . onCreateOptionsMenu ( menu , inflater ) ; < nl > + inflater . inflate ( R . menu . invite , menu ) ; < nl > + sendButton = menu . getItem ( 0 ) ; < nl > + checkSEndButton ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . send _ invites ) { < nl > + sendInvites ( ) ; < nl > + return true ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > + < nl > + private void sendInvites ( ) { < nl > + ArrayList < Long > phones = new ArrayList < Long > ( ) ; < nl > + ArrayList < String > emails = new ArrayList < String > ( ) ; < nl > + Long [ ] selected = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelected ( ) ; < nl > + HashMap < Long , Integer > selectedTypes = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelectedContactsTypes ( ) ; < nl > + PhoneBookContact contact ; < nl > + Integer selectedType ; < nl > + < nl > + / / Prepare email / phones lists < nl > + String phoneNumbersStrings = " " ; < nl > + String emailsString = " " ; < nl > + String email ; < nl > + long number ; < nl > + < nl > + for ( long s : selected ) { < nl > + contact = messenger ( ) . getPhoneBookContact ( s ) ; < nl > + selectedType = selectedTypes . get ( s ) ; < nl > + selectedType = selectedType ! = null ? selectedType : InviteContactHolder . TYPE _ PHONE ; < nl > + if ( ( selectedType = = InviteContactHolder . TYPE _ EMAIL & & contact . getEmails ( ) . size ( ) > 0 ) | | contact . getPhones ( ) . size ( ) = = 0 ) { < nl > + email = contact . getEmails ( ) . get ( 0 ) . getEmail ( ) ; < nl > + emails . add ( email ) ; < nl > + emailsString + = email + " ; " ; < nl > + < nl > + } else { < nl > + number = contact . getPhones ( ) . get ( 0 ) . getNumber ( ) ; < nl > + phones . add ( number ) ; < nl > + phoneNumbersStrings + = number + " ; " ; < nl > + } < nl > + < nl > + } < nl > + < nl > + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; < nl > + < nl > + if ( phones . size ( ) > 0 & & emails . size ( ) > 0 ) { < nl > + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; < nl > + String [ ] options = new String [ ] { getString ( R . string . invite _ options _ sms ) , getString ( R . string . invite _ options _ email ) } ; < nl > + final String finalPhoneNumbersStrings = phoneNumbersStrings ; < nl > + final String finalEmailsString = emailsString ; < nl > + builder . setItems ( options , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog , int which ) { < nl > + if ( which = = 0 ) { < nl > + sendSmsInvites ( finalPhoneNumbersStrings , inviteMessage ) ; < nl > + } else { < nl > + sendEmailInvites ( finalEmailsString , inviteMessage ) ; < nl > + } < nl > + dialog . dismiss ( ) ; < nl > + } < nl > + } ) . show ( ) ; < nl > + } else if ( phones . size ( ) > 0 ) { < nl > + sendSmsInvites ( phoneNumbersStrings , inviteMessage ) ; < nl > + < nl > + } else { < nl > + sendEmailInvites ( emailsString , inviteMessage ) ; < nl > + } < nl > + < nl > + / / SmsManager smsManager = SmsManager . getDefault ( ) ; < nl > + / / smsManager . sendTextMessage ( phoneNumbers , null , inviteMessage , null , null ) ; < nl > + } < nl > + < nl > + private void sendEmailInvites ( String emailsString , String inviteMessage ) { < nl > + Uri emailsToUri = Uri . parse ( " mailto : " + emailsString ) ; < nl > + Intent i = new Intent ( Intent . ACTION _ SENDTO , emailsToUri ) ; < nl > + i . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; < nl > + startActivity ( Intent . createChooser ( i , getString ( R . string . contacts _ invite _ via _ link ) ) ) ; < nl > + } < nl > + < nl > + private void sendSmsInvites ( String phoneNumbersStrings , String inviteMessage ) { < nl > + Uri smsToUri = Uri . parse ( " smsto : " + phoneNumbersStrings ) ; < nl > + Intent i = new Intent ( Intent . ACTION _ SENDTO , smsToUri ) ; < nl > + i . putExtra ( " sms _ body " , inviteMessage ) ; < nl > + startActivity ( i ) ; < nl > + } < nl > + < nl > + public void checkSEndButton ( ) { < nl > + if ( sendButton ! = null ) { < nl > + sendButton . setVisible ( getDisplayList ( ) . getSize ( ) ! = 0 ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public void onCollectionChanged ( ) { < nl > + super . onCollectionChanged ( ) ; < nl > + checkSEndButton ( ) ; < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > new file mode 100644 < nl > index 0000000 . . 84f3a1d < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > @ @ - 0 , 0 + 1 , 17 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > < nl > + < nl > + < item < nl > + android : id = " @ + id / send _ invites " < nl > + android : icon = " @ drawable / attach _ send2 " < nl > + android : title = " @ string / contacts _ invite _ via _ link " < nl > + app : showAsAction = " always " / > < nl > + < nl > + < nl > + < / menu > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 734b501 . . 5f240a2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 37 , 7 + 37 , 11 @ @ < nl > < string name = " menu _ saved " > С о х р а н е н о < / string > < nl > < string name = " menu _ next " > Д а л е е < / string > < nl > < nl > + < nl > + < ! - - Invites - - > < nl > < string name = " invite _ message " > П р и в е т ! Д а в а й п р о д о л ж и м о б щ а т ь с я в { appName } { inviteUrl } < / string > < nl > + < string name = " invite _ options _ sms " > О т п р а в и т ь sms п р и г л а ш е н и я < / string > < nl > + < string name = " invite _ options _ email " > О т п р а в и т ь email п р и г л а ш е н и я < / string > < nl > < nl > < ! - - Tour - - > < nl > < string name = " tour _ sign _ up " > Р Е Г И С Т Р А Ц И Я < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 2e1ad37 . . 95eacc4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 44 , 7 + 44 , 10 @ @ < nl > < string name = " menu _ saved " > Saved < / string > < nl > < string name = " menu _ next " > Next < / string > < nl > < nl > + < ! - - Invites - - > < nl > < string name = " invite _ message " > Hi ! Let \ ' s switch to { appName } ! { inviteUrl } < / string > < nl > + < string name = " invite _ options _ sms " > Invite via sms < / string > < nl > + < string name = " invite _ options _ email " > Invite via email < / string > < nl > < nl > < ! - - Tour - - > < nl > < string name = " tour _ sign _ up " > SIGN UP < / string > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index 08793f0 . . 231d2cd 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . entity . MessageSearchEntity ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . PeerSearchEntity ; < nl > import im . actor . core . entity . PeerSearchType ; < nl > + import im . actor . core . entity . PhoneBookContact ; < nl > import im . actor . core . entity . PublicGroup ; < nl > import im . actor . core . entity . Sex ; < nl > import im . actor . core . entity . User ; < nl > @ @ - 1621 , 6 + 1622 , 13 @ @ public class Messenger { < nl > return modules . getContactsModule ( ) . findUsers ( query ) ; < nl > } < nl > < nl > + public PhoneBookContact getPhoneBookContact ( long contactId ) { < nl > + return modules . getContactsModule ( ) . getPhoneBook ( ) . getValue ( contactId ) ; < nl > + } < nl > + < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > + / / Bindings < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > < nl > / * * < nl > * Bind File View Model

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 index b4c3406 . . dadcd57 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 @ @ - 1 , 6 + 1 , 8 @ @ 
 package im . actor . sdk . controllers . contacts ; 
 
 import android . app . Activity ; 
 + import android . app . AlertDialog ; 
 + import android . content . DialogInterface ; 
 import android . content . Intent ; 
 import android . os . Bundle ; 
 import android . support . v7 . widget . RecyclerView ; 
 @ @ - 116 , 18 + 118 , 7 @ @ public abstract class BaseContactFragment extends DisplayListFragment < Contact , C 
 addFooterOrHeaderAction ( ActorSDK . sharedActor ( ) . style . getActionShareColor ( ) , R . drawable . ic _ share _ white _ 24dp , R . string . contacts _ share , false , new Runnable ( ) { 
 @ Override 
 public void run ( ) { 
 - Intent intent ; 
 - 
 - if ( USE _ APP _ INVITES ) { 
 - intent = new Intent ( getActivity ( ) , InviteActivity . class ) ; 
 - } else { 
 - String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; 
 - intent = new Intent ( Intent . ACTION _ SEND ) ; 
 - intent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; 
 - intent . setType ( " text / plain " ) ; 
 - } 
 - 
 - startActivity ( intent ) ; 
 + sendInvites ( ) ; 
 } 
 } , true ) ; 
 
 @ @ - 145 , 6 + 136 , 39 @ @ public abstract class BaseContactFragment extends DisplayListFragment < Contact , C 
 } 
 } 
 
 + public void sendInvites ( ) { 
 + 
 + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; 
 + builder . setItems ( new String [ ] { getString ( R . string . invites _ share _ link _ one ) , getString ( R . string . invites _ share _ link _ multiple ) } , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog , int which ) { 
 + switch ( which ) { 
 + case 0 : 
 + sendOneInvite ( ) ; 
 + break ; 
 + 
 + case 1 : 
 + sendMultipleInvites ( ) ; 
 + break ; 
 + } 
 + dialog . dismiss ( ) ; 
 + } 
 + } ) . show ( ) ; 
 + } 
 + 
 + public void sendMultipleInvites ( ) { 
 + Intent intent = new Intent ( getActivity ( ) , InviteActivity . class ) ; 
 + startActivity ( intent ) ; 
 + } 
 + 
 + public void sendOneInvite ( ) { 
 + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; 
 + Intent sendIntent = new Intent ( Intent . ACTION _ SEND ) ; 
 + sendIntent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; 
 + sendIntent . setType ( " text / plain " ) ; 
 + startActivity ( sendIntent ) ; 
 + } 
 + 
 protected void addFooterOrHeaderAction ( int color , int icon , int text , boolean isLast , final Runnable action , boolean isHeader ) { 
 FrameLayout container = new FrameLayout ( getActivity ( ) ) ; 
 container . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java 
 index 208fa12 . . d11b861 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / ContactsFragment . java 
 @ @ - 34 , 11 + 34 , 7 @ @ public class ContactsFragment extends BaseContactFragment { 
 res . findViewById ( R . id . inviteButton ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 - String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; 
 - Intent sendIntent = new Intent ( Intent . ACTION _ SEND ) ; 
 - sendIntent . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; 
 - sendIntent . setType ( " text / plain " ) ; 
 - startActivity ( sendIntent ) ; 
 + sendInvites ( ) ; 
 } 
 } ) ; 
 ( ( TextView ) res . findViewById ( R . id . no _ contacts _ text ) ) . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryAccentColor ( ) ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java 
 index 8382dc9 . . f02d7c1 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteAdapter . java 
 @ @ - 102 , 4 + 102 , 15 @ @ public class InviteAdapter extends HolderAdapter < PhoneBookContact > { 
 protected ViewHolder < PhoneBookContact > createHolder ( PhoneBookContact obj ) { 
 return new InviteContactHolder ( new FrameLayout ( context ) , context , onItemClickedListener ) ; 
 } 
 + 
 + public void selectNone ( ) { 
 + selectedContactType . clear ( ) ; 
 + selectedUsers . clear ( ) ; 
 + notifyDataSetChanged ( ) ; 
 + } 
 + 
 + public void selectAll ( ) { 
 + selectedUsers . addAll ( phoneBook ) ; 
 + notifyDataSetChanged ( ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java 
 index 9fb6622 . . abc3aa7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteContactHolder . java 
 @ @ - 170 , 14 + 170 , 10 @ @ public class InviteContactHolder extends ViewHolder < PhoneBookContact > { 
 title . setText ( data . getName ( ) ) ; 
 } 
 
 - if ( selected ) { 
 - if ( ( type = = TYPE _ EMAIL & & data . getEmails ( ) . size ( ) > 0 ) | | data . getPhones ( ) . size ( ) = = 0 ) { 
 - subtitle . setText ( data . getEmails ( ) . get ( 0 ) . getEmail ( ) ) ; 
 - } else { 
 - subtitle . setText ( Long . toString ( data . getPhones ( ) . get ( 0 ) . getNumber ( ) ) ) ; 
 - } 
 + if ( ( type = = TYPE _ EMAIL & & data . getEmails ( ) . size ( ) > 0 ) | | data . getPhones ( ) . size ( ) = = 0 ) { 
 + subtitle . setText ( data . getEmails ( ) . get ( 0 ) . getEmail ( ) ) ; 
 } else { 
 - subtitle . setText ( " " ) ; 
 + subtitle . setText ( Long . toString ( data . getPhones ( ) . get ( 0 ) . getNumber ( ) ) ) ; 
 } 
 
 isSelected . setChecked ( selected ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 index bde4106 . . e57f6ba 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 @ @ - 28 , 11 + 28 , 12 @ @ import im . actor . sdk . view . adapters . RecyclerListView ; 
 public class InviteFragment extends BaseFragment { 
 
 
 - private MenuItem sendButton ; 
 private RecyclerListView collection ; 
 private InviteAdapter adapter ; 
 private List < PhoneBookContact > contacts ; 
 private TextView emptyText ; 
 + private Menu menu ; 
 + private MenuInflater inflater ; 
 
 public InviteFragment ( ) { 
 } 
 @ @ - 51 , 6 + 52 , 8 @ @ public class InviteFragment extends BaseFragment { 
 AndroidPhoneBook phoneBookLoader = new AndroidPhoneBook ( ) ; 
 phoneBookLoader . useDelay ( false ) ; 
 
 + res . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 + 
 phoneBookLoader . loadPhoneBook ( contacts - > { 
 if ( contacts . size ( ) > 0 ) { 
 
 @ @ - 75 , 19 + 78 , 12 @ @ public class InviteFragment extends BaseFragment { 
 
 hideView ( emptyText ) ; 
 showView ( collection ) ; 
 - 
 - 
 - if ( sendButton ! = null ) { 
 - sendButton . setVisible ( true ) ; 
 - } 
 + showMenu ( ) ; 
 } ) ; 
 
 } 
 } ) ; 
 
 - 
 - res . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 - 
 return res ; 
 } 
 
 @ @ - 140 , 18 + 136 , 29 @ @ public class InviteFragment extends BaseFragment { 
 @ Override 
 public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 super . onCreateOptionsMenu ( menu , inflater ) ; 
 - inflater . inflate ( R . menu . invite , menu ) ; 
 - sendButton = menu . getItem ( 0 ) ; 
 - if ( adapter ! = null & & adapter . getCount ( ) > 0 ) { 
 - sendButton . setVisible ( true ) ; 
 + this . menu = menu ; 
 + this . inflater = inflater ; 
 + showMenu ( ) ; 
 + } 
 + 
 + public void showMenu ( ) { 
 + if ( menu ! = null & & inflater ! = null & & adapter ! = null ) { 
 + if ( adapter . getCount ( ) > 0 ) { 
 + inflater . inflate ( R . menu . invite , menu ) ; 
 + } 
 } 
 } 
 
 @ Override 
 public boolean onOptionsItemSelected ( MenuItem item ) { 
 - if ( item . getItemId ( ) = = R . id . send _ invites ) { 
 + int id = item . getItemId ( ) ; 
 + if ( id = = R . id . send _ invites ) { 
 sendInvites ( ) ; 
 return true ; 
 + } else if ( id = = R . id . select _ all ) { 
 + adapter . selectAll ( ) ; 
 + } else if ( id = = R . id . select _ none ) { 
 + adapter . selectNone ( ) ; 
 } 
 return super . onOptionsItemSelected ( item ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 index cddbf65 . . fdf0a92 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 @ @ - 8 , 11 + 8 , 20 @ @ 
 xmlns : app = " http : / / schemas . android . com / apk / res - auto " > 
 
 < item 
 - android : visible = " false " 
 android : id = " @ + id / send _ invites " 
 android : icon = " @ drawable / attach _ send2 " 
 android : title = " @ string / contacts _ invite _ via _ link " 
 app : showAsAction = " always " / > 
 
 + < item 
 + android : id = " @ + id / select _ all " 
 + android : title = " @ string / invites _ select _ all " 
 + app : showAsAction = " never " / > 
 + 
 + < item 
 + android : id = " @ + id / select _ none " 
 + android : title = " @ string / invites _ select _ none " 
 + app : showAsAction = " never " / > 
 + 
 
 < / menu > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 9d9e57d . . 641e30f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 215 , 7 + 215 , 7 @ @ 
 < string name = " contacts _ title " > К о н т а к т ы < / string > 
 < string name = " contacts _ empty _ short " > Е щ е н е т к о н т а к т о в < / string > 
 < string name = " contacts _ share " > Р а с с к а з а т ь д р у з ь я м о б { appName } < / string > 
 - < string name = " contacts _ add " > Д о б а в и т ь д р у г а . . . < / string > 
 + < string name = " contacts _ add " > Д о б а в и т ь д р у г а … < / string > 
 
 < string name = " contacts _ menu _ remove " > У д а л и т ь { 0 } и з к о н т а к т о в < / string > 
 < string name = " contacts _ menu _ remove _ progress " > У д а л е н и е … < / string > 
 @ @ - 228 , 6 + 228 , 13 @ @ 
 
 < string name = " contacts _ invite _ via _ link " > О т п р а в и т ь с с ы л к у < / string > 
 
 + < string name = " invites _ select _ all " > В ы б р а т ь в с е < / string > 
 + < string name = " invites _ select _ none " > С н я т ь в ы б о р < / string > 
 + 
 + < string name = " invites _ share _ link _ one " > О т п р а в и т ь с с ы л к у < / string > 
 + < string name = " invites _ share _ link _ multiple " > О т п р а в и т ь с с ы л к у н е с к о л ь к и м к о н т а к т а м < / string > 
 + 
 + 
 < ! - - Chat - - > 
 < string name = " chat _ menu _ group _ info " > И н ф . о г р у п п е < / string > 
 < string name = " chat _ menu _ view _ contact " > И н ф . о к о н т а к т е < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 20ead16 . . 11b52d3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 219 , 7 + 219 , 7 @ @ 
 < string name = " contacts _ title " > Contacts < / string > 
 < string name = " contacts _ empty _ short " > No contacts here yet < / string > 
 < string name = " contacts _ share " > Tell your friends about { appName } < / string > 
 - < string name = " contacts _ add " > Add friend . . . < / string > 
 + < string name = " contacts _ add " > Add friend … < / string > 
 
 < string name = " contacts _ empty _ title " > Invite your friends < / string > 
 < string name = " contacts _ empty _ invite _ hint " > None of your contacts are using { appName } . Use the button below to invite them . < / string > 
 @ @ - 232 , 6 + 232 , 12 @ @ 
 
 < string name = " contacts _ invite _ via _ link " > Invite via link < / string > 
 
 + < string name = " invites _ select _ all " > Select all < / string > 
 + < string name = " invites _ select _ none " > Select none < / string > 
 + 
 + < string name = " invites _ share _ link _ one " > Share link < / string > 
 + < string name = " invites _ share _ link _ multiple " > Send link via sms / email to multiple contacts < / string > 
 + 
 < ! - - Chat - - > 
 < string name = " chat _ menu _ group _ info " > Group info < / string > 
 < string name = " chat _ menu _ view _ contact " > View contact < / string >

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 index 740e6c2 . . edf0d6d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 @ @ - 37 , 7 + 37 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public abstract class BaseContactFragment extends DisplayListFragment < Contact , ContactHolder > { 
 
 - private static final boolean USE _ APP _ INVITES = false ; 
 + private static final boolean USE _ APP _ INVITES = true ; 
 private final boolean useCompactVersion ; 
 private final boolean userSearch ; 
 private final boolean useSelection ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 index c61f017 . . 52bb42a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 @ @ - 13 , 7 + 13 , 7 @ @ public class InviteActivity extends BaseFragmentActivity { 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 
 - getSupportActionBar ( ) . setTitle ( R . string . contacts _ share ) ; 
 + getSupportActionBar ( ) . setTitle ( R . string . contacts _ invite _ via _ link ) ; 
 
 
 if ( savedInstanceState = = null ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 index 89b964f . . f9a8748 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 @ @ - 1 , 14 + 1 , 24 @ @ 
 package im . actor . sdk . controllers . contacts ; 
 
 import android . app . Activity ; 
 + import android . content . DialogInterface ; 
 + import android . content . Intent ; 
 + import android . net . Uri ; 
 import android . os . Bundle ; 
 import android . support . v7 . app . AlertDialog ; 
 + import android . telephony . SmsManager ; 
 import android . view . LayoutInflater ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . TextView ; 
 
 + import java . util . ArrayList ; 
 + import java . util . HashMap ; 
 + 
 import im . actor . core . entity . PhoneBookContact ; 
 import im . actor . runtime . android . view . BindedListAdapter ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 @ @ - 26 , 6 + 36 , 7 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite 
 
 
 private View emptyView ; 
 + private MenuItem sendButton ; 
 
 public InviteFragment ( ) { 
 } 
 @ @ - 144 , 4 + 155 , 107 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite 
 return ( ( InviteContactAdapter ) getAdapter ( ) ) . isSelected ( id ) ; 
 } 
 
 + @ Override 
 + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 + super . onCreateOptionsMenu ( menu , inflater ) ; 
 + inflater . inflate ( R . menu . invite , menu ) ; 
 + sendButton = menu . getItem ( 0 ) ; 
 + checkSEndButton ( ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . send _ invites ) { 
 + sendInvites ( ) ; 
 + return true ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 + 
 + private void sendInvites ( ) { 
 + ArrayList < Long > phones = new ArrayList < Long > ( ) ; 
 + ArrayList < String > emails = new ArrayList < String > ( ) ; 
 + Long [ ] selected = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelected ( ) ; 
 + HashMap < Long , Integer > selectedTypes = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelectedContactsTypes ( ) ; 
 + PhoneBookContact contact ; 
 + Integer selectedType ; 
 + 
 + / / Prepare email / phones lists 
 + String phoneNumbersStrings = " " ; 
 + String emailsString = " " ; 
 + String email ; 
 + long number ; 
 + 
 + for ( long s : selected ) { 
 + contact = messenger ( ) . getPhoneBookContact ( s ) ; 
 + selectedType = selectedTypes . get ( s ) ; 
 + selectedType = selectedType ! = null ? selectedType : InviteContactHolder . TYPE _ PHONE ; 
 + if ( ( selectedType = = InviteContactHolder . TYPE _ EMAIL & & contact . getEmails ( ) . size ( ) > 0 ) | | contact . getPhones ( ) . size ( ) = = 0 ) { 
 + email = contact . getEmails ( ) . get ( 0 ) . getEmail ( ) ; 
 + emails . add ( email ) ; 
 + emailsString + = email + " ; " ; 
 + 
 + } else { 
 + number = contact . getPhones ( ) . get ( 0 ) . getNumber ( ) ; 
 + phones . add ( number ) ; 
 + phoneNumbersStrings + = number + " ; " ; 
 + } 
 + 
 + } 
 + 
 + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; 
 + 
 + if ( phones . size ( ) > 0 & & emails . size ( ) > 0 ) { 
 + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; 
 + String [ ] options = new String [ ] { getString ( R . string . invite _ options _ sms ) , getString ( R . string . invite _ options _ email ) } ; 
 + final String finalPhoneNumbersStrings = phoneNumbersStrings ; 
 + final String finalEmailsString = emailsString ; 
 + builder . setItems ( options , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog , int which ) { 
 + if ( which = = 0 ) { 
 + sendSmsInvites ( finalPhoneNumbersStrings , inviteMessage ) ; 
 + } else { 
 + sendEmailInvites ( finalEmailsString , inviteMessage ) ; 
 + } 
 + dialog . dismiss ( ) ; 
 + } 
 + } ) . show ( ) ; 
 + } else if ( phones . size ( ) > 0 ) { 
 + sendSmsInvites ( phoneNumbersStrings , inviteMessage ) ; 
 + 
 + } else { 
 + sendEmailInvites ( emailsString , inviteMessage ) ; 
 + } 
 + 
 + / / SmsManager smsManager = SmsManager . getDefault ( ) ; 
 + / / smsManager . sendTextMessage ( phoneNumbers , null , inviteMessage , null , null ) ; 
 + } 
 + 
 + private void sendEmailInvites ( String emailsString , String inviteMessage ) { 
 + Uri emailsToUri = Uri . parse ( " mailto : " + emailsString ) ; 
 + Intent i = new Intent ( Intent . ACTION _ SENDTO , emailsToUri ) ; 
 + i . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; 
 + startActivity ( Intent . createChooser ( i , getString ( R . string . contacts _ invite _ via _ link ) ) ) ; 
 + } 
 + 
 + private void sendSmsInvites ( String phoneNumbersStrings , String inviteMessage ) { 
 + Uri smsToUri = Uri . parse ( " smsto : " + phoneNumbersStrings ) ; 
 + Intent i = new Intent ( Intent . ACTION _ SENDTO , smsToUri ) ; 
 + i . putExtra ( " sms _ body " , inviteMessage ) ; 
 + startActivity ( i ) ; 
 + } 
 + 
 + public void checkSEndButton ( ) { 
 + if ( sendButton ! = null ) { 
 + sendButton . setVisible ( getDisplayList ( ) . getSize ( ) ! = 0 ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public void onCollectionChanged ( ) { 
 + super . onCollectionChanged ( ) ; 
 + checkSEndButton ( ) ; 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 new file mode 100644 
 index 0000000 . . 84f3a1d 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 @ @ - 0 , 0 + 1 , 17 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > 
 + 
 + < item 
 + android : id = " @ + id / send _ invites " 
 + android : icon = " @ drawable / attach _ send2 " 
 + android : title = " @ string / contacts _ invite _ via _ link " 
 + app : showAsAction = " always " / > 
 + 
 + 
 + < / menu > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 734b501 . . 5f240a2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 37 , 7 + 37 , 11 @ @ 
 < string name = " menu _ saved " > С о х р а н е н о < / string > 
 < string name = " menu _ next " > Д а л е е < / string > 
 
 + 
 + < ! - - Invites - - > 
 < string name = " invite _ message " > П р и в е т ! Д а в а й п р о д о л ж и м о б щ а т ь с я в { appName } { inviteUrl } < / string > 
 + < string name = " invite _ options _ sms " > О т п р а в и т ь sms п р и г л а ш е н и я < / string > 
 + < string name = " invite _ options _ email " > О т п р а в и т ь email п р и г л а ш е н и я < / string > 
 
 < ! - - Tour - - > 
 < string name = " tour _ sign _ up " > Р Е Г И С Т Р А Ц И Я < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 2e1ad37 . . 95eacc4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 44 , 7 + 44 , 10 @ @ 
 < string name = " menu _ saved " > Saved < / string > 
 < string name = " menu _ next " > Next < / string > 
 
 + < ! - - Invites - - > 
 < string name = " invite _ message " > Hi ! Let \ ' s switch to { appName } ! { inviteUrl } < / string > 
 + < string name = " invite _ options _ sms " > Invite via sms < / string > 
 + < string name = " invite _ options _ email " > Invite via email < / string > 
 
 < ! - - Tour - - > 
 < string name = " tour _ sign _ up " > SIGN UP < / string > 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index 08793f0 . . 231d2cd 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . entity . MessageSearchEntity ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . PeerSearchEntity ; 
 import im . actor . core . entity . PeerSearchType ; 
 + import im . actor . core . entity . PhoneBookContact ; 
 import im . actor . core . entity . PublicGroup ; 
 import im . actor . core . entity . Sex ; 
 import im . actor . core . entity . User ; 
 @ @ - 1621 , 6 + 1622 , 13 @ @ public class Messenger { 
 return modules . getContactsModule ( ) . findUsers ( query ) ; 
 } 
 
 + public PhoneBookContact getPhoneBookContact ( long contactId ) { 
 + return modules . getContactsModule ( ) . getPhoneBook ( ) . getValue ( contactId ) ; 
 + } 
 + 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + / / Bindings 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 
 / * * 
 * Bind File View Model
