BLEU SCORE: 0.24808415001701817

TEST MSG: fix ( android ) : delete group in administration fragment confirm
GENERATED MSG: feat ( android ) : add group app invites

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java < nl > index 4b36a20 . . 572471b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java < nl > @ @ - 85 , 7 + 85 , 9 @ @ public class DialogsDefaultFragment extends BaseDialogFragment { < nl > startActivity ( Intents . editGroupTitle ( dialog . getPeer ( ) . getPeerId ( ) , getActivity ( ) ) ) ; < nl > } else if ( which = = 2 ) { < nl > new AlertDialog . Builder ( getActivity ( ) ) < nl > - . setMessage ( getString ( R . string . alert _ leave _ group _ message , dialog . getDialogTitle ( ) ) ) < nl > + . setMessage ( getString ( groupVM . getIsCanLeave ( ) . get ( ) ? R . string . alert _ delete _ group _ title : < nl > + groupVM . getIsCanDelete ( ) . get ( ) ? R . string . alert _ delete _ group _ title : < nl > + R . string . alert _ leave _ group _ message , dialog . getDialogTitle ( ) ) ) < nl > . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( d1 , which1 ) - > { < nl > if ( groupVM . getIsCanLeave ( ) . get ( ) ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > index 6c9d144 . . c37527e 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > @ @ - 3 , 13 + 3 , 20 @ @ package im . actor . sdk . controllers . group ; < nl > import android . content . Intent ; < nl > import android . os . Bundle ; < nl > import android . support . annotation . Nullable ; < nl > + import android . support . v7 . app . AlertDialog ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . TextView ; < nl > + import android . widget . Toast ; < nl > < nl > import im . actor . core . entity . GroupType ; < nl > + import im . actor . core . entity . Peer ; < nl > + import im . actor . core . viewmodel . CommandCallback ; < nl > import im . actor . core . viewmodel . GroupVM ; < nl > + import im . actor . runtime . actors . messages . * ; < nl > + import im . actor . runtime . actors . messages . Void ; < nl > + import im . actor . runtime . mvvm . ValueDoubleListener ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . BaseFragment ; < nl > @ @ - 136 , 23 + 143 , 40 @ @ public class GroupAdminFragment extends BaseFragment { < nl > delete . setText ( R . string . group _ delete ) ; < nl > deleteHint . setText ( R . string . group _ delete _ hint ) ; < nl > } < nl > - bind ( groupVM . getIsCanDelete ( ) , canDelete - > { < nl > - if ( canDelete ) { < nl > + < nl > + bind ( groupVM . getIsCanLeave ( ) , groupVM . getIsCanDelete ( ) , ( canLeave , canDelete ) - > { < nl > + if ( canDelete | | canDelete ) { < nl > deleteContainer . setVisibility ( View . VISIBLE ) ; < nl > delete . setOnClickListener ( v - > { < nl > - execute ( messenger ( ) . deleteGroup ( groupVM . getId ( ) ) ) . then ( r - > { < nl > - ActorSDK . sharedActor ( ) . startMessagingApp ( getActivity ( ) ) ; < nl > - finishActivity ( ) ; < nl > - } ) ; < nl > + < nl > + new AlertDialog . Builder ( getActivity ( ) ) < nl > + . setMessage ( getString ( groupVM . getIsCanLeave ( ) . get ( ) ? R . string . alert _ delete _ group _ title : < nl > + groupVM . getIsCanDelete ( ) . get ( ) ? R . string . alert _ delete _ group _ title : < nl > + R . string . alert _ leave _ group _ message , groupVM . getName ( ) . get ( ) ) ) < nl > + . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > + . setPositiveButton ( R . string . alert _ delete _ group _ yes , ( d1 , which1 ) - > { < nl > + if ( groupVM . getIsCanLeave ( ) . get ( ) ) { < nl > + execute ( messenger ( ) . leaveAndDeleteGroup ( groupVM . getId ( ) ) , R . string . progress _ common ) . failure ( e - > { < nl > + Toast . makeText ( getActivity ( ) , R . string . toast _ unable _ leave , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + } ) ; < nl > + } else if ( groupVM . getIsCanDelete ( ) . get ( ) ) { < nl > + execute ( messenger ( ) . deleteGroup ( groupVM . getId ( ) ) , R . string . progress _ common ) . failure ( e - > { < nl > + Toast . makeText ( getActivity ( ) , R . string . toast _ unable _ delete _ chat , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + } ) ; < nl > + } < nl > + } ) < nl > + . show ( ) ; < nl > + < nl > } ) ; < nl > + < nl > } else { < nl > deleteContainer . setVisibility ( View . GONE ) ; < nl > delete . setOnClickListener ( null ) ; < nl > delete . setClickable ( false ) ; < nl > } < nl > - < nl > } ) ; < nl > < nl > + < nl > return res ; < nl > } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > index 740e6c2 . . edf0d6d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java < nl > @ @ - 37 , 7 + 37 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public abstract class BaseContactFragment extends DisplayListFragment < Contact , ContactHolder > { < nl > < nl > - private static final boolean USE _ APP _ INVITES = false ; < nl > + private static final boolean USE _ APP _ INVITES = true ; < nl > private final boolean useCompactVersion ; < nl > private final boolean userSearch ; < nl > private final boolean useSelection ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > index c61f017 . . 52bb42a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java < nl > @ @ - 13 , 7 + 13 , 7 @ @ public class InviteActivity extends BaseFragmentActivity { < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > < nl > - getSupportActionBar ( ) . setTitle ( R . string . contacts _ share ) ; < nl > + getSupportActionBar ( ) . setTitle ( R . string . contacts _ invite _ via _ link ) ; < nl > < nl > < nl > if ( savedInstanceState = = null ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > index 89b964f . . f9a8748 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java < nl > @ @ - 1 , 14 + 1 , 24 @ @ < nl > package im . actor . sdk . controllers . contacts ; < nl > < nl > import android . app . Activity ; < nl > + import android . content . DialogInterface ; < nl > + import android . content . Intent ; < nl > + import android . net . Uri ; < nl > import android . os . Bundle ; < nl > import android . support . v7 . app . AlertDialog ; < nl > + import android . telephony . SmsManager ; < nl > import android . view . LayoutInflater ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . TextView ; < nl > < nl > + import java . util . ArrayList ; < nl > + import java . util . HashMap ; < nl > + < nl > import im . actor . core . entity . PhoneBookContact ; < nl > import im . actor . runtime . android . view . BindedListAdapter ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > @ @ - 26 , 6 + 36 , 7 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite < nl > < nl > < nl > private View emptyView ; < nl > + private MenuItem sendButton ; < nl > < nl > public InviteFragment ( ) { < nl > } < nl > @ @ - 144 , 4 + 155 , 107 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite < nl > return ( ( InviteContactAdapter ) getAdapter ( ) ) . isSelected ( id ) ; < nl > } < nl > < nl > + @ Override < nl > + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > + super . onCreateOptionsMenu ( menu , inflater ) ; < nl > + inflater . inflate ( R . menu . invite , menu ) ; < nl > + sendButton = menu . getItem ( 0 ) ; < nl > + checkSEndButton ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . send _ invites ) { < nl > + sendInvites ( ) ; < nl > + return true ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > + < nl > + private void sendInvites ( ) { < nl > + ArrayList < Long > phones = new ArrayList < Long > ( ) ; < nl > + ArrayList < String > emails = new ArrayList < String > ( ) ; < nl > + Long [ ] selected = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelected ( ) ; < nl > + HashMap < Long , Integer > selectedTypes = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelectedContactsTypes ( ) ; < nl > + PhoneBookContact contact ; < nl > + Integer selectedType ; < nl > + < nl > + / / Prepare email / phones lists < nl > + String phoneNumbersStrings = " " ; < nl > + String emailsString = " " ; < nl > + String email ; < nl > + long number ; < nl > + < nl > + for ( long s : selected ) { < nl > + contact = messenger ( ) . getPhoneBookContact ( s ) ; < nl > + selectedType = selectedTypes . get ( s ) ; < nl > + selectedType = selectedType ! = null ? selectedType : InviteContactHolder . TYPE _ PHONE ; < nl > + if ( ( selectedType = = InviteContactHolder . TYPE _ EMAIL & & contact . getEmails ( ) . size ( ) > 0 ) | | contact . getPhones ( ) . size ( ) = = 0 ) { < nl > + email = contact . getEmails ( ) . get ( 0 ) . getEmail ( ) ; < nl > + emails . add ( email ) ; < nl > + emailsString + = email + " ; " ; < nl > + < nl > + } else { < nl > + number = contact . getPhones ( ) . get ( 0 ) . getNumber ( ) ; < nl > + phones . add ( number ) ; < nl > + phoneNumbersStrings + = number + " ; " ; < nl > + } < nl > + < nl > + } < nl > + < nl > + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; < nl > + < nl > + if ( phones . size ( ) > 0 & & emails . size ( ) > 0 ) { < nl > + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; < nl > + String [ ] options = new String [ ] { getString ( R . string . invite _ options _ sms ) , getString ( R . string . invite _ options _ email ) } ; < nl > + final String finalPhoneNumbersStrings = phoneNumbersStrings ; < nl > + final String finalEmailsString = emailsString ; < nl > + builder . setItems ( options , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog , int which ) { < nl > + if ( which = = 0 ) { < nl > + sendSmsInvites ( finalPhoneNumbersStrings , inviteMessage ) ; < nl > + } else { < nl > + sendEmailInvites ( finalEmailsString , inviteMessage ) ; < nl > + } < nl > + dialog . dismiss ( ) ; < nl > + } < nl > + } ) . show ( ) ; < nl > + } else if ( phones . size ( ) > 0 ) { < nl > + sendSmsInvites ( phoneNumbersStrings , inviteMessage ) ; < nl > + < nl > + } else { < nl > + sendEmailInvites ( emailsString , inviteMessage ) ; < nl > + } < nl > + < nl > + / / SmsManager smsManager = SmsManager . getDefault ( ) ; < nl > + / / smsManager . sendTextMessage ( phoneNumbers , null , inviteMessage , null , null ) ; < nl > + } < nl > + < nl > + private void sendEmailInvites ( String emailsString , String inviteMessage ) { < nl > + Uri emailsToUri = Uri . parse ( " mailto : " + emailsString ) ; < nl > + Intent i = new Intent ( Intent . ACTION _ SENDTO , emailsToUri ) ; < nl > + i . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; < nl > + startActivity ( Intent . createChooser ( i , getString ( R . string . contacts _ invite _ via _ link ) ) ) ; < nl > + } < nl > + < nl > + private void sendSmsInvites ( String phoneNumbersStrings , String inviteMessage ) { < nl > + Uri smsToUri = Uri . parse ( " smsto : " + phoneNumbersStrings ) ; < nl > + Intent i = new Intent ( Intent . ACTION _ SENDTO , smsToUri ) ; < nl > + i . putExtra ( " sms _ body " , inviteMessage ) ; < nl > + startActivity ( i ) ; < nl > + } < nl > + < nl > + public void checkSEndButton ( ) { < nl > + if ( sendButton ! = null ) { < nl > + sendButton . setVisible ( getDisplayList ( ) . getSize ( ) ! = 0 ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public void onCollectionChanged ( ) { < nl > + super . onCollectionChanged ( ) ; < nl > + checkSEndButton ( ) ; < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > new file mode 100644 < nl > index 0000000 . . 84f3a1d < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml < nl > @ @ - 0 , 0 + 1 , 17 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > < nl > + < nl > + < item < nl > + android : id = " @ + id / send _ invites " < nl > + android : icon = " @ drawable / attach _ send2 " < nl > + android : title = " @ string / contacts _ invite _ via _ link " < nl > + app : showAsAction = " always " / > < nl > + < nl > + < nl > + < / menu > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 734b501 . . 5f240a2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 37 , 7 + 37 , 11 @ @ < nl > < string name = " menu _ saved " > С о х р а н е н о < / string > < nl > < string name = " menu _ next " > Д а л е е < / string > < nl > < nl > + < nl > + < ! - - Invites - - > < nl > < string name = " invite _ message " > П р и в е т ! Д а в а й п р о д о л ж и м о б щ а т ь с я в { appName } { inviteUrl } < / string > < nl > + < string name = " invite _ options _ sms " > О т п р а в и т ь sms п р и г л а ш е н и я < / string > < nl > + < string name = " invite _ options _ email " > О т п р а в и т ь email п р и г л а ш е н и я < / string > < nl > < nl > < ! - - Tour - - > < nl > < string name = " tour _ sign _ up " > Р Е Г И С Т Р А Ц И Я < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 2e1ad37 . . 95eacc4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 44 , 7 + 44 , 10 @ @ < nl > < string name = " menu _ saved " > Saved < / string > < nl > < string name = " menu _ next " > Next < / string > < nl > < nl > + < ! - - Invites - - > < nl > < string name = " invite _ message " > Hi ! Let \ ' s switch to { appName } ! { inviteUrl } < / string > < nl > + < string name = " invite _ options _ sms " > Invite via sms < / string > < nl > + < string name = " invite _ options _ email " > Invite via email < / string > < nl > < nl > < ! - - Tour - - > < nl > < string name = " tour _ sign _ up " > SIGN UP < / string > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index 08793f0 . . 231d2cd 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . entity . MessageSearchEntity ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . PeerSearchEntity ; < nl > import im . actor . core . entity . PeerSearchType ; < nl > + import im . actor . core . entity . PhoneBookContact ; < nl > import im . actor . core . entity . PublicGroup ; < nl > import im . actor . core . entity . Sex ; < nl > import im . actor . core . entity . User ; < nl > @ @ - 1621 , 6 + 1622 , 13 @ @ public class Messenger { < nl > return modules . getContactsModule ( ) . findUsers ( query ) ; < nl > } < nl > < nl > + public PhoneBookContact getPhoneBookContact ( long contactId ) { < nl > + return modules . getContactsModule ( ) . getPhoneBook ( ) . getValue ( contactId ) ; < nl > + } < nl > + < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > + / / Bindings < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > < nl > / * * < nl > * Bind File View Model

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java 
 index 4b36a20 . . 572471b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / dialogs / DialogsDefaultFragment . java 
 @ @ - 85 , 7 + 85 , 9 @ @ public class DialogsDefaultFragment extends BaseDialogFragment { 
 startActivity ( Intents . editGroupTitle ( dialog . getPeer ( ) . getPeerId ( ) , getActivity ( ) ) ) ; 
 } else if ( which = = 2 ) { 
 new AlertDialog . Builder ( getActivity ( ) ) 
 - . setMessage ( getString ( R . string . alert _ leave _ group _ message , dialog . getDialogTitle ( ) ) ) 
 + . setMessage ( getString ( groupVM . getIsCanLeave ( ) . get ( ) ? R . string . alert _ delete _ group _ title : 
 + groupVM . getIsCanDelete ( ) . get ( ) ? R . string . alert _ delete _ group _ title : 
 + R . string . alert _ leave _ group _ message , dialog . getDialogTitle ( ) ) ) 
 . setNegativeButton ( R . string . dialog _ cancel , null ) 
 . setPositiveButton ( R . string . alert _ leave _ group _ yes , ( d1 , which1 ) - > { 
 if ( groupVM . getIsCanLeave ( ) . get ( ) ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 index 6c9d144 . . c37527e 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 @ @ - 3 , 13 + 3 , 20 @ @ package im . actor . sdk . controllers . group ; 
 import android . content . Intent ; 
 import android . os . Bundle ; 
 import android . support . annotation . Nullable ; 
 + import android . support . v7 . app . AlertDialog ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . TextView ; 
 + import android . widget . Toast ; 
 
 import im . actor . core . entity . GroupType ; 
 + import im . actor . core . entity . Peer ; 
 + import im . actor . core . viewmodel . CommandCallback ; 
 import im . actor . core . viewmodel . GroupVM ; 
 + import im . actor . runtime . actors . messages . * ; 
 + import im . actor . runtime . actors . messages . Void ; 
 + import im . actor . runtime . mvvm . ValueDoubleListener ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . BaseFragment ; 
 @ @ - 136 , 23 + 143 , 40 @ @ public class GroupAdminFragment extends BaseFragment { 
 delete . setText ( R . string . group _ delete ) ; 
 deleteHint . setText ( R . string . group _ delete _ hint ) ; 
 } 
 - bind ( groupVM . getIsCanDelete ( ) , canDelete - > { 
 - if ( canDelete ) { 
 + 
 + bind ( groupVM . getIsCanLeave ( ) , groupVM . getIsCanDelete ( ) , ( canLeave , canDelete ) - > { 
 + if ( canDelete | | canDelete ) { 
 deleteContainer . setVisibility ( View . VISIBLE ) ; 
 delete . setOnClickListener ( v - > { 
 - execute ( messenger ( ) . deleteGroup ( groupVM . getId ( ) ) ) . then ( r - > { 
 - ActorSDK . sharedActor ( ) . startMessagingApp ( getActivity ( ) ) ; 
 - finishActivity ( ) ; 
 - } ) ; 
 + 
 + new AlertDialog . Builder ( getActivity ( ) ) 
 + . setMessage ( getString ( groupVM . getIsCanLeave ( ) . get ( ) ? R . string . alert _ delete _ group _ title : 
 + groupVM . getIsCanDelete ( ) . get ( ) ? R . string . alert _ delete _ group _ title : 
 + R . string . alert _ leave _ group _ message , groupVM . getName ( ) . get ( ) ) ) 
 + . setNegativeButton ( R . string . dialog _ cancel , null ) 
 + . setPositiveButton ( R . string . alert _ delete _ group _ yes , ( d1 , which1 ) - > { 
 + if ( groupVM . getIsCanLeave ( ) . get ( ) ) { 
 + execute ( messenger ( ) . leaveAndDeleteGroup ( groupVM . getId ( ) ) , R . string . progress _ common ) . failure ( e - > { 
 + Toast . makeText ( getActivity ( ) , R . string . toast _ unable _ leave , Toast . LENGTH _ LONG ) . show ( ) ; 
 + } ) ; 
 + } else if ( groupVM . getIsCanDelete ( ) . get ( ) ) { 
 + execute ( messenger ( ) . deleteGroup ( groupVM . getId ( ) ) , R . string . progress _ common ) . failure ( e - > { 
 + Toast . makeText ( getActivity ( ) , R . string . toast _ unable _ delete _ chat , Toast . LENGTH _ LONG ) . show ( ) ; 
 + } ) ; 
 + } 
 + } ) 
 + . show ( ) ; 
 + 
 } ) ; 
 + 
 } else { 
 deleteContainer . setVisibility ( View . GONE ) ; 
 delete . setOnClickListener ( null ) ; 
 delete . setClickable ( false ) ; 
 } 
 - 
 } ) ; 
 
 + 
 return res ; 
 } 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 index 740e6c2 . . edf0d6d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / BaseContactFragment . java 
 @ @ - 37 , 7 + 37 , 7 @ @ import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public abstract class BaseContactFragment extends DisplayListFragment < Contact , ContactHolder > { 
 
 - private static final boolean USE _ APP _ INVITES = false ; 
 + private static final boolean USE _ APP _ INVITES = true ; 
 private final boolean useCompactVersion ; 
 private final boolean userSearch ; 
 private final boolean useSelection ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 index c61f017 . . 52bb42a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteActivity . java 
 @ @ - 13 , 7 + 13 , 7 @ @ public class InviteActivity extends BaseFragmentActivity { 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 
 - getSupportActionBar ( ) . setTitle ( R . string . contacts _ share ) ; 
 + getSupportActionBar ( ) . setTitle ( R . string . contacts _ invite _ via _ link ) ; 
 
 
 if ( savedInstanceState = = null ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 index 89b964f . . f9a8748 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / contacts / InviteFragment . java 
 @ @ - 1 , 14 + 1 , 24 @ @ 
 package im . actor . sdk . controllers . contacts ; 
 
 import android . app . Activity ; 
 + import android . content . DialogInterface ; 
 + import android . content . Intent ; 
 + import android . net . Uri ; 
 import android . os . Bundle ; 
 import android . support . v7 . app . AlertDialog ; 
 + import android . telephony . SmsManager ; 
 import android . view . LayoutInflater ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . TextView ; 
 
 + import java . util . ArrayList ; 
 + import java . util . HashMap ; 
 + 
 import im . actor . core . entity . PhoneBookContact ; 
 import im . actor . runtime . android . view . BindedListAdapter ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 @ @ - 26 , 6 + 36 , 7 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite 
 
 
 private View emptyView ; 
 + private MenuItem sendButton ; 
 
 public InviteFragment ( ) { 
 } 
 @ @ - 144 , 4 + 155 , 107 @ @ public class InviteFragment extends DisplayListFragment < PhoneBookContact , Invite 
 return ( ( InviteContactAdapter ) getAdapter ( ) ) . isSelected ( id ) ; 
 } 
 
 + @ Override 
 + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 + super . onCreateOptionsMenu ( menu , inflater ) ; 
 + inflater . inflate ( R . menu . invite , menu ) ; 
 + sendButton = menu . getItem ( 0 ) ; 
 + checkSEndButton ( ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . send _ invites ) { 
 + sendInvites ( ) ; 
 + return true ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 + 
 + private void sendInvites ( ) { 
 + ArrayList < Long > phones = new ArrayList < Long > ( ) ; 
 + ArrayList < String > emails = new ArrayList < String > ( ) ; 
 + Long [ ] selected = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelected ( ) ; 
 + HashMap < Long , Integer > selectedTypes = ( ( InviteContactAdapter ) getAdapter ( ) ) . getSelectedContactsTypes ( ) ; 
 + PhoneBookContact contact ; 
 + Integer selectedType ; 
 + 
 + / / Prepare email / phones lists 
 + String phoneNumbersStrings = " " ; 
 + String emailsString = " " ; 
 + String email ; 
 + long number ; 
 + 
 + for ( long s : selected ) { 
 + contact = messenger ( ) . getPhoneBookContact ( s ) ; 
 + selectedType = selectedTypes . get ( s ) ; 
 + selectedType = selectedType ! = null ? selectedType : InviteContactHolder . TYPE _ PHONE ; 
 + if ( ( selectedType = = InviteContactHolder . TYPE _ EMAIL & & contact . getEmails ( ) . size ( ) > 0 ) | | contact . getPhones ( ) . size ( ) = = 0 ) { 
 + email = contact . getEmails ( ) . get ( 0 ) . getEmail ( ) ; 
 + emails . add ( email ) ; 
 + emailsString + = email + " ; " ; 
 + 
 + } else { 
 + number = contact . getPhones ( ) . get ( 0 ) . getNumber ( ) ; 
 + phones . add ( number ) ; 
 + phoneNumbersStrings + = number + " ; " ; 
 + } 
 + 
 + } 
 + 
 + String inviteMessage = getResources ( ) . getString ( R . string . invite _ message ) . replace ( " { inviteUrl } " , ActorSDK . sharedActor ( ) . getInviteUrl ( ) ) . replace ( " { appName } " , ActorSDK . sharedActor ( ) . getAppName ( ) ) ; 
 + 
 + if ( phones . size ( ) > 0 & & emails . size ( ) > 0 ) { 
 + AlertDialog . Builder builder = new AlertDialog . Builder ( getActivity ( ) ) ; 
 + String [ ] options = new String [ ] { getString ( R . string . invite _ options _ sms ) , getString ( R . string . invite _ options _ email ) } ; 
 + final String finalPhoneNumbersStrings = phoneNumbersStrings ; 
 + final String finalEmailsString = emailsString ; 
 + builder . setItems ( options , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog , int which ) { 
 + if ( which = = 0 ) { 
 + sendSmsInvites ( finalPhoneNumbersStrings , inviteMessage ) ; 
 + } else { 
 + sendEmailInvites ( finalEmailsString , inviteMessage ) ; 
 + } 
 + dialog . dismiss ( ) ; 
 + } 
 + } ) . show ( ) ; 
 + } else if ( phones . size ( ) > 0 ) { 
 + sendSmsInvites ( phoneNumbersStrings , inviteMessage ) ; 
 + 
 + } else { 
 + sendEmailInvites ( emailsString , inviteMessage ) ; 
 + } 
 + 
 + / / SmsManager smsManager = SmsManager . getDefault ( ) ; 
 + / / smsManager . sendTextMessage ( phoneNumbers , null , inviteMessage , null , null ) ; 
 + } 
 + 
 + private void sendEmailInvites ( String emailsString , String inviteMessage ) { 
 + Uri emailsToUri = Uri . parse ( " mailto : " + emailsString ) ; 
 + Intent i = new Intent ( Intent . ACTION _ SENDTO , emailsToUri ) ; 
 + i . putExtra ( Intent . EXTRA _ TEXT , inviteMessage ) ; 
 + startActivity ( Intent . createChooser ( i , getString ( R . string . contacts _ invite _ via _ link ) ) ) ; 
 + } 
 + 
 + private void sendSmsInvites ( String phoneNumbersStrings , String inviteMessage ) { 
 + Uri smsToUri = Uri . parse ( " smsto : " + phoneNumbersStrings ) ; 
 + Intent i = new Intent ( Intent . ACTION _ SENDTO , smsToUri ) ; 
 + i . putExtra ( " sms _ body " , inviteMessage ) ; 
 + startActivity ( i ) ; 
 + } 
 + 
 + public void checkSEndButton ( ) { 
 + if ( sendButton ! = null ) { 
 + sendButton . setVisible ( getDisplayList ( ) . getSize ( ) ! = 0 ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public void onCollectionChanged ( ) { 
 + super . onCollectionChanged ( ) ; 
 + checkSEndButton ( ) ; 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 new file mode 100644 
 index 0000000 . . 84f3a1d 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / menu / invite . xml 
 @ @ - 0 , 0 + 1 , 17 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < menu xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + xmlns : app = " http : / / schemas . android . com / apk / res - auto " > 
 + 
 + < item 
 + android : id = " @ + id / send _ invites " 
 + android : icon = " @ drawable / attach _ send2 " 
 + android : title = " @ string / contacts _ invite _ via _ link " 
 + app : showAsAction = " always " / > 
 + 
 + 
 + < / menu > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 734b501 . . 5f240a2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 37 , 7 + 37 , 11 @ @ 
 < string name = " menu _ saved " > С о х р а н е н о < / string > 
 < string name = " menu _ next " > Д а л е е < / string > 
 
 + 
 + < ! - - Invites - - > 
 < string name = " invite _ message " > П р и в е т ! Д а в а й п р о д о л ж и м о б щ а т ь с я в { appName } { inviteUrl } < / string > 
 + < string name = " invite _ options _ sms " > О т п р а в и т ь sms п р и г л а ш е н и я < / string > 
 + < string name = " invite _ options _ email " > О т п р а в и т ь email п р и г л а ш е н и я < / string > 
 
 < ! - - Tour - - > 
 < string name = " tour _ sign _ up " > Р Е Г И С Т Р А Ц И Я < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 2e1ad37 . . 95eacc4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 44 , 7 + 44 , 10 @ @ 
 < string name = " menu _ saved " > Saved < / string > 
 < string name = " menu _ next " > Next < / string > 
 
 + < ! - - Invites - - > 
 < string name = " invite _ message " > Hi ! Let \ ' s switch to { appName } ! { inviteUrl } < / string > 
 + < string name = " invite _ options _ sms " > Invite via sms < / string > 
 + < string name = " invite _ options _ email " > Invite via email < / string > 
 
 < ! - - Tour - - > 
 < string name = " tour _ sign _ up " > SIGN UP < / string > 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index 08793f0 . . 231d2cd 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 27 , 6 + 27 , 7 @ @ import im . actor . core . entity . MessageSearchEntity ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . PeerSearchEntity ; 
 import im . actor . core . entity . PeerSearchType ; 
 + import im . actor . core . entity . PhoneBookContact ; 
 import im . actor . core . entity . PublicGroup ; 
 import im . actor . core . entity . Sex ; 
 import im . actor . core . entity . User ; 
 @ @ - 1621 , 6 + 1622 , 13 @ @ public class Messenger { 
 return modules . getContactsModule ( ) . findUsers ( query ) ; 
 } 
 
 + public PhoneBookContact getPhoneBookContact ( long contactId ) { 
 + return modules . getContactsModule ( ) . getPhoneBook ( ) . getValue ( contactId ) ; 
 + } 
 + 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + / / Bindings 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 
 / * * 
 * Bind File View Model
