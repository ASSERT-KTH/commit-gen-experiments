BLEU SCORE: 0.24808415001701817

TEST MSG: feat ( android ) : members fragment header actions , loader
GENERATED MSG: feat ( android ) call members list

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java < nl > index f767550 . . 499dc42 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java < nl > @ @ - 1 , 24 + 1 , 38 @ @ < nl > package im . actor . sdk . controllers . group ; < nl > < nl > + import android . content . Intent ; < nl > import android . os . Bundle ; < nl > import android . support . annotation . Nullable ; < nl > + import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > + import android . widget . LinearLayout ; < nl > import android . widget . ListView ; < nl > + import android . widget . TextView ; < nl > < nl > import java . util . ArrayList ; < nl > < nl > + import fr . castorflex . android . circularprogressbar . CircularProgressBar ; < nl > import im . actor . core . entity . GroupMember ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . BaseFragment ; < nl > + import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . group . view . MembersAdapter ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . DividerView ; < nl > + import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; < nl > import im . actor . sdk . view . adapters . RecyclerListView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > < nl > public class MembersFragment extends BaseFragment { < nl > < nl > + protected CircularProgressBar progressView ; < nl > + < nl > public static MembersFragment create ( int groupId ) { < nl > MembersFragment res = new MembersFragment ( ) ; < nl > Bundle args = new Bundle ( ) ; < nl > @ @ - 40 , 9 + 54 , 65 @ @ public class MembersFragment extends BaseFragment { < nl > @ Override < nl > public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { < nl > View res = inflater . inflate ( R . layout . fragment _ members , container , false ) ; < nl > - adapter = new MembersAdapter ( getContext ( ) , getArguments ( ) . getInt ( " groupId " ) ) ; < nl > + int groupId = getArguments ( ) . getInt ( " groupId " ) ; < nl > + adapter = new MembersAdapter ( getContext ( ) , groupId ) ; < nl > + < nl > + GroupVM groupVM = groups ( ) . get ( groupId ) ; < nl > + RecyclerListView list = ( RecyclerListView ) res . findViewById ( R . id . items ) ; < nl > + < nl > + < nl > + Boolean canInvite = groupVM . getIsCanInviteMembers ( ) . get ( ) ; < nl > + Boolean canInviteViaLink = groupVM . getIsCanInviteViaLink ( ) . get ( ) ; < nl > + if ( canInvite | | canInviteViaLink ) { < nl > + LinearLayout header = new LinearLayout ( getActivity ( ) ) ; < nl > + list . addHeaderView ( header ) ; < nl > + < nl > + if ( canInvite ) { < nl > + TextView addMmemberTV = new TextView ( getContext ( ) ) ; < nl > + addMmemberTV . setBackgroundResource ( R . drawable . selector ) ; < nl > + addMmemberTV . setTextSize ( 16 ) ; < nl > + addMmemberTV . setPadding ( Screen . dp ( 72 ) , 0 , 0 , 0 ) ; < nl > + addMmemberTV . setGravity ( Gravity . CENTER _ VERTICAL ) ; < nl > + addMmemberTV . setText ( R . string . group _ add _ member ) ; < nl > + addMmemberTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + addMmemberTV . setOnClickListener ( new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View view ) { < nl > + startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) < nl > + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupId ) ) ; < nl > + } < nl > + } ) ; < nl > + < nl > + header . addView ( addMmemberTV , ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 58 ) ) ; < nl > + } < nl > + < nl > + if ( canInvite & & canInviteViaLink ) { < nl > + header . addView ( new DividerView ( getActivity ( ) ) , ViewGroup . LayoutParams . MATCH _ PARENT , 1 ) ; < nl > + } < nl > < nl > - ( ( RecyclerListView ) res . findViewById ( R . id . items ) ) . setAdapter ( adapter ) ; < nl > + if ( canInviteViaLink ) { < nl > + TextView shareLinkTV = new TextView ( getContext ( ) ) ; < nl > + shareLinkTV . setBackgroundResource ( R . drawable . selector ) ; < nl > + shareLinkTV . setTextSize ( 16 ) ; < nl > + shareLinkTV . setPadding ( Screen . dp ( 72 ) , 0 , 0 , 0 ) ; < nl > + shareLinkTV . setGravity ( Gravity . CENTER _ VERTICAL ) ; < nl > + shareLinkTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + shareLinkTV . setText ( R . string . invite _ link _ action _ share ) ; < nl > + shareLinkTV . setOnClickListener ( new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View view ) { < nl > + Intents . inviteLink ( groupId , getActivity ( ) ) ; < nl > + } < nl > + } ) ; < nl > + < nl > + header . addView ( shareLinkTV , ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 58 ) ) ; < nl > + } < nl > + } < nl > + < nl > + list . setAdapter ( adapter ) ; < nl > + < nl > + progressView = ( CircularProgressBar ) res . findViewById ( R . id . loadingProgress ) ; < nl > + progressView . setIndeterminate ( true ) ; < nl > < nl > return res ; < nl > } < nl > @ @ - 50 , 6 + 120 , 12 @ @ public class MembersFragment extends BaseFragment { < nl > @ Override < nl > public void onResume ( ) { < nl > super . onResume ( ) ; < nl > - adapter . initLoad ( ) ; < nl > + adapter . initLoad ( ( ) - > hideView ( progressView ) ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onDestroyView ( ) { < nl > + super . onDestroyView ( ) ; < nl > + adapter . dispose ( ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > index 013996b . . 8a19a48 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java < nl > @ @ - 9 , 6 + 9 , 7 @ @ import android . widget . TextView ; < nl > import java . util . ArrayList ; < nl > import java . util . Arrays ; < nl > import java . util . Collection ; < nl > + import java . util . Optional ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > @ @ - 31 , 6 + 32 , 7 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > private ActorBinder BINDER = new ActorBinder ( ) ; < nl > private boolean loadInProgress = false ; < nl > private boolean loaddedToEnd = false ; < nl > + private LoadedCallback callback ; < nl > < nl > public MembersAdapter ( Context context , int groupId ) { < nl > super ( context ) ; < nl > @ @ - 76 , 17 + 78 , 27 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { < nl > private byte [ ] nextMembers ; < nl > private ArrayList < Integer > rawMembers = new ArrayList < > ( ) ; < nl > < nl > - public void initLoad ( ) { < nl > + public void initLoad ( LoadedCallback callback ) { < nl > + this . callback = callback ; < nl > if ( ! isInitiallyLoaded ) { < nl > loadMore ( ) ; < nl > } < nl > } < nl > < nl > + public interface LoadedCallback { < nl > + void onLoaded ( ) ; < nl > + } < nl > + < nl > private void loadMore ( ) { < nl > if ( ! loadInProgress & & ! loaddedToEnd ) { < nl > loadInProgress = true ; < nl > messenger ( ) . loadMembers ( groupId , LIMIT , nextMembers ) . then ( groupMembersSlice - > { < nl > - isInitiallyLoaded = true ; < nl > + if ( ! isInitiallyLoaded ) { < nl > + isInitiallyLoaded = true ; < nl > + if ( callback ! = null ) { < nl > + callback . onLoaded ( ) ; < nl > + } < nl > + } < nl > rawMembers . clear ( ) ; < nl > rawMembers . addAll ( groupMembersSlice . getUids ( ) ) ; < nl > nextMembers = groupMembersSlice . getNext ( ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml < nl > index dc3773c . . 9ee9658 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml < nl > @ @ - 7 , 4 + 7 , 12 @ @ < nl > android : id = " @ + id / items " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " match _ parent " / > < nl > + < nl > + < fr . castorflex . android . circularprogressbar . CircularProgressBar < nl > + android : id = " @ + id / loadingProgress " < nl > + android : layout _ width = " 40dp " < nl > + android : layout _ height = " 40dp " < nl > + android : layout _ gravity = " center " < nl > + android : indeterminate = " true " / > < nl > + < nl > < / FrameLayout > < nl > \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index fa9298f . . 5bb61e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . Manifest ; < nl > + import android . app . Activity ; < nl > import android . app . Notification ; < nl > import android . app . NotificationManager ; < nl > import android . app . PendingIntent ; < nl > @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; < nl > import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > - import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > - import android . widget . Toast ; < nl > < nl > import java . text . DateFormat ; < nl > import java . text . SimpleDateFormat ; < nl > + import java . util . ArrayList ; < nl > import java . util . Date ; < nl > import java . util . TimeZone ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . core . viewmodel . CallMember ; < nl > import im . actor . core . viewmodel . CallState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . viewmodel . CallVM ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; < nl > import im . actor . runtime . actors . messages . PoisonPill ; < nl > import im . actor . runtime . mvvm . Value ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > - import im . actor . sdk . core . audio . AndroidPlayerActor ; < nl > - import im . actor . sdk . core . audio . AudioPlayerActor ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . adapters . HolderAdapter ; < nl > + import im . actor . sdk . view . adapters . ViewHolder ; < nl > + import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { < nl > / / < nl > CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - < nl > - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > - < nl > TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > - bind ( nameTV , user . getName ( ) ) ; < nl > + < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + < nl > + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , user . getAvatar ( ) ) ; < nl > + bind ( nameTV , user . getName ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , g . getAvatar ( ) ) ; < nl > + bind ( nameTV , g . getName ( ) ) ; < nl > + } < nl > + < nl > + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > + membersList . setAdapter ( membersAdapter ) ; < nl > < nl > timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > } < nl > < nl > - private void toastInCenter ( String s ) { < nl > - Toast t = Toast . makeText ( getActivity ( ) , < nl > - s , Toast . LENGTH _ SHORT ) ; < nl > - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; < nl > - t . show ( ) ; < nl > - } < nl > - < nl > @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { < nl > super . onResume ( ) ; < nl > manager . cancel ( NOTIFICATION _ ID ) ; < nl > } < nl > + < nl > + class CallMembersAdapter extends HolderAdapter < CallMember > { < nl > + < nl > + < nl > + private ArrayList < CallMember > members ; < nl > + < nl > + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { < nl > + super ( context ) ; < nl > + this . members = members . get ( ) ; < nl > + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { < nl > + @ Override < nl > + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { < nl > + CallMembersAdapter . this . members = val ; < nl > + notifyDataSetChanged ( ) ; < nl > + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getCount ( ) { < nl > + return members . size ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public CallMember getItem ( int position ) { < nl > + return members . get ( position ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public long getItemId ( int position ) { < nl > + return members . get ( position ) . getUid ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { < nl > + return new MemberHolder ( ) ; < nl > + } < nl > + < nl > + private class MemberHolder extends ViewHolder < CallMember > { < nl > + < nl > + CallMember data ; < nl > + private TextView userName ; < nl > + private TextView status ; < nl > + private AvatarView avatarView ; < nl > + < nl > + @ Override < nl > + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { < nl > + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; < nl > + < nl > + userName = ( TextView ) res . findViewById ( R . id . name ) ; < nl > + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + status = ( TextView ) res . findViewById ( R . id . status ) ; < nl > + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; < nl > + this . data = data ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( CallMember data , int position , Context context ) { < nl > + UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + this . data = data ; < nl > + avatarView . bind ( user ) ; < nl > + userName . setText ( user . getName ( ) . get ( ) ) ; < nl > + status . setText ( data . getState ( ) . name ( ) ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 50aecee . . fe5738b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > menu . findItem ( R . id . call ) . setVisible ( false ) ; < nl > } < nl > < nl > @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > if ( item . getItemId ( ) = = R . id . call ) { < nl > if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > private void startCall ( ) { < nl > - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + Command < Long > cmd ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + < nl > + } else { < nl > + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; < nl > + } < nl > execute ( cmd , R . string . progress _ common ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 47ab3ad . . 6ce5969 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 37 , 6 + 37 , 11 @ @ < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > android : textSize = " @ dimen / text _ secondary " / > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > < / LinearLayout > < nl > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . fa1ed22 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > @ @ - 0 , 0 + 1 , 62 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : orientation = " horizontal " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 59dp " < nl > + android : layout _ height = " 48dp " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 35dp " < nl > + android : layout _ height = " 35dp " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / divider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ marginLeft = " 59dp " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > index 922d837 . . 09b3e47 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { < nl > public CallMemberState getState ( ) { < nl > return state ; < nl > } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + return uid + " | " + state . name ( ) ; < nl > + } < nl > } < nl > \ No newline at end of file

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java 
 index f767550 . . 499dc42 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / MembersFragment . java 
 @ @ - 1 , 24 + 1 , 38 @ @ 
 package im . actor . sdk . controllers . group ; 
 
 + import android . content . Intent ; 
 import android . os . Bundle ; 
 import android . support . annotation . Nullable ; 
 + import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 + import android . widget . LinearLayout ; 
 import android . widget . ListView ; 
 + import android . widget . TextView ; 
 
 import java . util . ArrayList ; 
 
 + import fr . castorflex . android . circularprogressbar . CircularProgressBar ; 
 import im . actor . core . entity . GroupMember ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . BaseFragment ; 
 + import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . group . view . MembersAdapter ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . DividerView ; 
 + import im . actor . sdk . view . adapters . HeaderViewRecyclerAdapter ; 
 import im . actor . sdk . view . adapters . RecyclerListView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 
 public class MembersFragment extends BaseFragment { 
 
 + protected CircularProgressBar progressView ; 
 + 
 public static MembersFragment create ( int groupId ) { 
 MembersFragment res = new MembersFragment ( ) ; 
 Bundle args = new Bundle ( ) ; 
 @ @ - 40 , 9 + 54 , 65 @ @ public class MembersFragment extends BaseFragment { 
 @ Override 
 public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { 
 View res = inflater . inflate ( R . layout . fragment _ members , container , false ) ; 
 - adapter = new MembersAdapter ( getContext ( ) , getArguments ( ) . getInt ( " groupId " ) ) ; 
 + int groupId = getArguments ( ) . getInt ( " groupId " ) ; 
 + adapter = new MembersAdapter ( getContext ( ) , groupId ) ; 
 + 
 + GroupVM groupVM = groups ( ) . get ( groupId ) ; 
 + RecyclerListView list = ( RecyclerListView ) res . findViewById ( R . id . items ) ; 
 + 
 + 
 + Boolean canInvite = groupVM . getIsCanInviteMembers ( ) . get ( ) ; 
 + Boolean canInviteViaLink = groupVM . getIsCanInviteViaLink ( ) . get ( ) ; 
 + if ( canInvite | | canInviteViaLink ) { 
 + LinearLayout header = new LinearLayout ( getActivity ( ) ) ; 
 + list . addHeaderView ( header ) ; 
 + 
 + if ( canInvite ) { 
 + TextView addMmemberTV = new TextView ( getContext ( ) ) ; 
 + addMmemberTV . setBackgroundResource ( R . drawable . selector ) ; 
 + addMmemberTV . setTextSize ( 16 ) ; 
 + addMmemberTV . setPadding ( Screen . dp ( 72 ) , 0 , 0 , 0 ) ; 
 + addMmemberTV . setGravity ( Gravity . CENTER _ VERTICAL ) ; 
 + addMmemberTV . setText ( R . string . group _ add _ member ) ; 
 + addMmemberTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + addMmemberTV . setOnClickListener ( new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View view ) { 
 + startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) 
 + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupId ) ) ; 
 + } 
 + } ) ; 
 + 
 + header . addView ( addMmemberTV , ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 58 ) ) ; 
 + } 
 + 
 + if ( canInvite & & canInviteViaLink ) { 
 + header . addView ( new DividerView ( getActivity ( ) ) , ViewGroup . LayoutParams . MATCH _ PARENT , 1 ) ; 
 + } 
 
 - ( ( RecyclerListView ) res . findViewById ( R . id . items ) ) . setAdapter ( adapter ) ; 
 + if ( canInviteViaLink ) { 
 + TextView shareLinkTV = new TextView ( getContext ( ) ) ; 
 + shareLinkTV . setBackgroundResource ( R . drawable . selector ) ; 
 + shareLinkTV . setTextSize ( 16 ) ; 
 + shareLinkTV . setPadding ( Screen . dp ( 72 ) , 0 , 0 , 0 ) ; 
 + shareLinkTV . setGravity ( Gravity . CENTER _ VERTICAL ) ; 
 + shareLinkTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + shareLinkTV . setText ( R . string . invite _ link _ action _ share ) ; 
 + shareLinkTV . setOnClickListener ( new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View view ) { 
 + Intents . inviteLink ( groupId , getActivity ( ) ) ; 
 + } 
 + } ) ; 
 + 
 + header . addView ( shareLinkTV , ViewGroup . LayoutParams . MATCH _ PARENT , Screen . dp ( 58 ) ) ; 
 + } 
 + } 
 + 
 + list . setAdapter ( adapter ) ; 
 + 
 + progressView = ( CircularProgressBar ) res . findViewById ( R . id . loadingProgress ) ; 
 + progressView . setIndeterminate ( true ) ; 
 
 return res ; 
 } 
 @ @ - 50 , 6 + 120 , 12 @ @ public class MembersFragment extends BaseFragment { 
 @ Override 
 public void onResume ( ) { 
 super . onResume ( ) ; 
 - adapter . initLoad ( ) ; 
 + adapter . initLoad ( ( ) - > hideView ( progressView ) ) ; 
 + } 
 + 
 + @ Override 
 + public void onDestroyView ( ) { 
 + super . onDestroyView ( ) ; 
 + adapter . dispose ( ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 index 013996b . . 8a19a48 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / view / MembersAdapter . java 
 @ @ - 9 , 6 + 9 , 7 @ @ import android . widget . TextView ; 
 import java . util . ArrayList ; 
 import java . util . Arrays ; 
 import java . util . Collection ; 
 + import java . util . Optional ; 
 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 @ @ - 31 , 6 + 32 , 7 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 private ActorBinder BINDER = new ActorBinder ( ) ; 
 private boolean loadInProgress = false ; 
 private boolean loaddedToEnd = false ; 
 + private LoadedCallback callback ; 
 
 public MembersAdapter ( Context context , int groupId ) { 
 super ( context ) ; 
 @ @ - 76 , 17 + 78 , 27 @ @ public class MembersAdapter extends HolderAdapter < GroupMember > { 
 private byte [ ] nextMembers ; 
 private ArrayList < Integer > rawMembers = new ArrayList < > ( ) ; 
 
 - public void initLoad ( ) { 
 + public void initLoad ( LoadedCallback callback ) { 
 + this . callback = callback ; 
 if ( ! isInitiallyLoaded ) { 
 loadMore ( ) ; 
 } 
 } 
 
 + public interface LoadedCallback { 
 + void onLoaded ( ) ; 
 + } 
 + 
 private void loadMore ( ) { 
 if ( ! loadInProgress & & ! loaddedToEnd ) { 
 loadInProgress = true ; 
 messenger ( ) . loadMembers ( groupId , LIMIT , nextMembers ) . then ( groupMembersSlice - > { 
 - isInitiallyLoaded = true ; 
 + if ( ! isInitiallyLoaded ) { 
 + isInitiallyLoaded = true ; 
 + if ( callback ! = null ) { 
 + callback . onLoaded ( ) ; 
 + } 
 + } 
 rawMembers . clear ( ) ; 
 rawMembers . addAll ( groupMembersSlice . getUids ( ) ) ; 
 nextMembers = groupMembersSlice . getNext ( ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml 
 index dc3773c . . 9ee9658 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ members . xml 
 @ @ - 7 , 4 + 7 , 12 @ @ 
 android : id = " @ + id / items " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " match _ parent " / > 
 + 
 + < fr . castorflex . android . circularprogressbar . CircularProgressBar 
 + android : id = " @ + id / loadingProgress " 
 + android : layout _ width = " 40dp " 
 + android : layout _ height = " 40dp " 
 + android : layout _ gravity = " center " 
 + android : indeterminate = " true " / > 
 + 
 < / FrameLayout > 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index fa9298f . . 5bb61e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . Manifest ; 
 + import android . app . Activity ; 
 import android . app . Notification ; 
 import android . app . NotificationManager ; 
 import android . app . PendingIntent ; 
 @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; 
 import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 - import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . ListView ; 
 import android . widget . TextView ; 
 - import android . widget . Toast ; 
 
 import java . text . DateFormat ; 
 import java . text . SimpleDateFormat ; 
 + import java . util . ArrayList ; 
 import java . util . Date ; 
 import java . util . TimeZone ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . core . viewmodel . CallMember ; 
 import im . actor . core . viewmodel . CallState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . viewmodel . CallVM ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; 
 import im . actor . runtime . actors . messages . PoisonPill ; 
 import im . actor . runtime . mvvm . Value ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 - import im . actor . sdk . core . audio . AndroidPlayerActor ; 
 - import im . actor . sdk . core . audio . AudioPlayerActor ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . adapters . HolderAdapter ; 
 + import im . actor . sdk . view . adapters . ViewHolder ; 
 + import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { 
 / / 
 CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - 
 - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 - 
 TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 - bind ( nameTV , user . getName ( ) ) ; 
 + 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + 
 + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , user . getAvatar ( ) ) ; 
 + bind ( nameTV , user . getName ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , g . getAvatar ( ) ) ; 
 + bind ( nameTV , g . getName ( ) ) ; 
 + } 
 + 
 + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 + membersList . setAdapter ( membersAdapter ) ; 
 
 timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 } 
 
 - private void toastInCenter ( String s ) { 
 - Toast t = Toast . makeText ( getActivity ( ) , 
 - s , Toast . LENGTH _ SHORT ) ; 
 - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; 
 - t . show ( ) ; 
 - } 
 - 
 @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { 
 super . onResume ( ) ; 
 manager . cancel ( NOTIFICATION _ ID ) ; 
 } 
 + 
 + class CallMembersAdapter extends HolderAdapter < CallMember > { 
 + 
 + 
 + private ArrayList < CallMember > members ; 
 + 
 + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { 
 + super ( context ) ; 
 + this . members = members . get ( ) ; 
 + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { 
 + @ Override 
 + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { 
 + CallMembersAdapter . this . members = val ; 
 + notifyDataSetChanged ( ) ; 
 + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public int getCount ( ) { 
 + return members . size ( ) ; 
 + } 
 + 
 + @ Override 
 + public CallMember getItem ( int position ) { 
 + return members . get ( position ) ; 
 + } 
 + 
 + @ Override 
 + public long getItemId ( int position ) { 
 + return members . get ( position ) . getUid ( ) ; 
 + } 
 + 
 + @ Override 
 + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { 
 + return new MemberHolder ( ) ; 
 + } 
 + 
 + private class MemberHolder extends ViewHolder < CallMember > { 
 + 
 + CallMember data ; 
 + private TextView userName ; 
 + private TextView status ; 
 + private AvatarView avatarView ; 
 + 
 + @ Override 
 + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { 
 + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; 
 + 
 + userName = ( TextView ) res . findViewById ( R . id . name ) ; 
 + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + status = ( TextView ) res . findViewById ( R . id . status ) ; 
 + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; 
 + this . data = data ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void bind ( CallMember data , int position , Context context ) { 
 + UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + this . data = data ; 
 + avatarView . bind ( user ) ; 
 + userName . setText ( user . getName ( ) . get ( ) ) ; 
 + status . setText ( data . getState ( ) . name ( ) ) ; 
 + } 
 + 
 + 
 + @ Override 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 50aecee . . fe5738b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 menu . findItem ( R . id . call ) . setVisible ( false ) ; 
 } 
 
 @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 if ( item . getItemId ( ) = = R . id . call ) { 
 if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 private void startCall ( ) { 
 - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + Command < Long > cmd ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + 
 + } else { 
 + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; 
 + } 
 execute ( cmd , R . string . progress _ common ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 47ab3ad . . 6ce5969 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 37 , 6 + 37 , 11 @ @ 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 android : textSize = " @ dimen / text _ secondary " / > 
 + 
 + < ListView 
 + android : id = " @ + id / members _ list " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 < / LinearLayout > 
 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 new file mode 100644 
 index 0000000 . . fa1ed22 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 @ @ - 0 , 0 + 1 , 62 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : orientation = " horizontal " 
 + android : paddingRight = " 8dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 59dp " 
 + android : layout _ height = " 48dp " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 35dp " 
 + android : layout _ height = " 35dp " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / status " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / divider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ marginLeft = " 59dp " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 index 922d837 . . 09b3e47 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { 
 public CallMemberState getState ( ) { 
 return state ; 
 } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + return uid + " | " + state . name ( ) ; 
 + } 
 } 
 \ No newline at end of file
