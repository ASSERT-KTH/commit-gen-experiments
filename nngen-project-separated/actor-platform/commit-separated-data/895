BLEU SCORE: 0.14535768424205484

TEST MSG: feat ( runtime ) : Adding tests
GENERATED MSG: wip ( webrtc ) : SDP parser

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java < nl > index 28b26d5 . . 78ff921 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java < nl > @ @ - 3 , 8 + 3 , 6 @ @ package im . actor . core . modules . calls ; < nl > import java . util . HashMap ; < nl > import java . util . HashSet ; < nl > < nl > - import im . actor . core . api . rpc . RequestGetCallInfo ; < nl > - import im . actor . core . api . rpc . ResponseGetCallInfo ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . modules . ModuleContext ; < nl > import im . actor . core . util . ModuleActor ; < nl > @ @ - 16 , 7 + 14 , 6 @ @ import im . actor . runtime . actors . Actor ; < nl > import im . actor . runtime . actors . ActorCreator ; < nl > import im . actor . runtime . actors . ActorRef ; < nl > import im . actor . runtime . function . Constructor ; < nl > - import im . actor . runtime . function . Consumer ; < nl > < nl > public class CallManagerActor extends ModuleActor { < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java < nl > index 6f02abf . . 8b1641e 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java < nl > @ @ - 36 , 17 + 36 , 14 @ @ public class CallSlaveActor extends CallActor { < nl > } ) . done ( self ( ) ) ; < nl > } < nl > < nl > - @ Override < nl > - public void onBusStarted ( ) { < nl > - super . onBusStarted ( ) ; < nl > - } < nl > - < nl > public void onMasterNodeChanged ( int fromUid , long fromDeviceId ) { < nl > masterNode = new MasterNode ( fromUid , fromDeviceId ) ; < nl > if ( isAnswerPending ) { < nl > isAnswerPending = false ; < nl > sendSignalingMessage ( masterNode . getUid ( ) , masterNode . getDeviceId ( ) , new ApiAnswerCall ( ) ) ; < nl > } < nl > + < nl > + schedule ( new DoAnswer ( ) , 5000 ) ; < nl > } < nl > < nl > public void onNeedOffer ( int destUid , long destDeviceId ) { < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java < nl > deleted file mode 100644 < nl > index 5587d10 . . 0000000 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java < nl > + + + / dev / null < nl > @ @ - 1 , 45 + 0 , 0 @ @ < nl > - package im . actor . core . webrtc . sdp ; < nl > - < nl > - import org . junit . Test ; < nl > - < nl > - public class SDPTest { < nl > - < nl > - private String sdp = " v = 0 \ n " + < nl > - " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + < nl > - " s = - \ n " + < nl > - " t = 0 0 \ n " + < nl > - " a = group : BUNDLE audio \ n " + < nl > - " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > - " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + < nl > - " c = IN IP4 0 . 0 . 0 . 0 \ n " + < nl > - " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + < nl > - " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + < nl > - " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + < nl > - " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + < nl > - " a = setup : active \ n " + < nl > - " a = mid : audio \ n " + < nl > - " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + < nl > - " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + < nl > - " a = sendrecv \ n " + < nl > - " a = rtcp - mux \ n " + < nl > - " a = rtpmap : 111 opus / 48000 / 2 \ n " + < nl > - " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + < nl > - " a = rtpmap : 103 ISAC / 16000 \ n " + < nl > - " a = rtpmap : 9 G722 / 8000 \ n " + < nl > - " a = rtpmap : 0 PCMU / 8000 \ n " + < nl > - " a = rtpmap : 8 PCMA / 8000 \ n " + < nl > - " a = rtpmap : 106 CN / 32000 \ n " + < nl > - " a = rtpmap : 105 CN / 16000 \ n " + < nl > - " a = rtpmap : 13 CN / 8000 \ n " + < nl > - " a = rtpmap : 126 telephone - event / 8000 \ n " + < nl > - " a = maxptime : 60 \ n " + < nl > - " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + < nl > - " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + < nl > - " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > - " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; < nl > - < nl > - @ Test < nl > - public void testSDPParser ( ) { < nl > - SDP . parse ( sdp ) ; < nl > - } < nl > - } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java < nl > index 7506d33 . . e67012f 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java < nl > @ @ - 45 , 12 + 45 , 12 @ @ public class ThreadingRuntimeProvider implements ThreadingRuntime { < nl > } < nl > < nl > @ Override < nl > - public Dispatcher createDispatcher ( ThreadPriority priority ) { < nl > + public Dispatcher createDispatcher ( String name ) { < nl > throw new RuntimeException ( " Dumb " ) ; < nl > } < nl > < nl > @ Override < nl > - public ImmediateDispatcher createImmediateDispatcher ( ThreadPriority priority ) { < nl > + public ImmediateDispatcher createImmediateDispatcher ( String name , ThreadPriority priority ) { < nl > throw new RuntimeException ( " Dumb " ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java < nl > index 1c2f2e1 . . 4d5b68c 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java < nl > @ @ - 4 , 7 + 4 , 7 @ @ import org . jetbrains . annotations . NotNull ; < nl > < nl > import im . actor . runtime . promise . Promise ; < nl > import im . actor . runtime . promise . Promises ; < nl > - import im . actor . runtime . webrtc . WebRTCLocalStream ; < nl > + import im . actor . runtime . webrtc . WebRTCMediaStream ; < nl > import im . actor . runtime . webrtc . WebRTCPeerConnection ; < nl > < nl > public class WebRTCRuntimeProvider implements WebRTCRuntime { < nl > @ @ - 15 , 9 + 15 , 9 @ @ public class WebRTCRuntimeProvider implements WebRTCRuntime { < nl > return Promises . failure ( new RuntimeException ( " Dumb " ) ) ; < nl > } < nl > < nl > - @ Override < nl > @ NotNull < nl > - public Promise < WebRTCLocalStream > getUserAudio ( ) { < nl > + @ Override < nl > + public Promise < WebRTCMediaStream > getUserAudio ( ) { < nl > return Promises . failure ( new RuntimeException ( " Dumb " ) ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java < nl > new file mode 100644 < nl > index 0000000 . . 3d79bc7 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java < nl > @ @ - 0 , 0 + 1 , 45 @ @ < nl > + package im . actor . runtime . webrtc . sdp ; < nl > + < nl > + import org . junit . Test ; < nl > + < nl > + public class SDPTest { < nl > + < nl > + private String sdp = " v = 0 \ n " + < nl > + " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + < nl > + " s = - \ n " + < nl > + " t = 0 0 \ n " + < nl > + " a = group : BUNDLE audio \ n " + < nl > + " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > + " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + < nl > + " c = IN IP4 0 . 0 . 0 . 0 \ n " + < nl > + " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + < nl > + " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + < nl > + " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + < nl > + " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + < nl > + " a = setup : active \ n " + < nl > + " a = mid : audio \ n " + < nl > + " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + < nl > + " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + < nl > + " a = sendrecv \ n " + < nl > + " a = rtcp - mux \ n " + < nl > + " a = rtpmap : 111 opus / 48000 / 2 \ n " + < nl > + " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + < nl > + " a = rtpmap : 103 ISAC / 16000 \ n " + < nl > + " a = rtpmap : 9 G722 / 8000 \ n " + < nl > + " a = rtpmap : 0 PCMU / 8000 \ n " + < nl > + " a = rtpmap : 8 PCMA / 8000 \ n " + < nl > + " a = rtpmap : 106 CN / 32000 \ n " + < nl > + " a = rtpmap : 105 CN / 16000 \ n " + < nl > + " a = rtpmap : 13 CN / 8000 \ n " + < nl > + " a = rtpmap : 126 telephone - event / 8000 \ n " + < nl > + " a = maxptime : 60 \ n " + < nl > + " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + < nl > + " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + < nl > + " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > + " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; < nl > + < nl > + @ Test < nl > + public void testSDPParser ( ) { < nl > + SDP . parse ( sdp ) ; < nl > + } < nl > + }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java < nl > new file mode 100644 < nl > index 0000000 . . 96bbb58 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java < nl > @ @ - 0 , 0 + 1 , 11 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + public abstract class SDP { < nl > + public static SDPScheme parse ( String sdp ) { < nl > + String [ ] lines = sdp . split ( " \ \ r ? \ \ n " ) ; < nl > + if ( ! lines [ 0 ] . startsWith ( " v = " ) ) { < nl > + throw new RuntimeException ( " First line doesn ' t start with version of SDP " ) ; < nl > + } < nl > + return null ; < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java < nl > new file mode 100644 < nl > index 0000000 . . 45698ba < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java < nl > @ @ - 0 , 0 + 1 , 15 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + import java . util . ArrayList ; < nl > + < nl > + public class SDPMedia { < nl > + private ArrayList < SDPRawRecord > records ; < nl > + < nl > + public SDPMedia ( ArrayList < SDPRawRecord > records ) { < nl > + this . records = records ; < nl > + } < nl > + < nl > + public ArrayList < SDPRawRecord > getRecords ( ) { < nl > + return records ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java < nl > new file mode 100644 < nl > index 0000000 . . cae45eb < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java < nl > @ @ - 0 , 0 + 1 , 20 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + public class SDPRawRecord { < nl > + < nl > + private char type ; < nl > + private String value ; < nl > + < nl > + public SDPRawRecord ( char type , String value ) { < nl > + this . type = type ; < nl > + this . value = value ; < nl > + } < nl > + < nl > + public char getType ( ) { < nl > + return type ; < nl > + } < nl > + < nl > + public String getValue ( ) { < nl > + return value ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java < nl > new file mode 100644 < nl > index 0000000 . . 0165227 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java < nl > @ @ - 0 , 0 + 1 , 23 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + import java . util . ArrayList ; < nl > + import java . util . List ; < nl > + < nl > + public class SDPScheme { < nl > + < nl > + public SDPSession sessionLevel ; < nl > + public ArrayList < SDPMedia > mediaLevel ; < nl > + < nl > + public SDPScheme ( SDPSession sessionLevel , List < SDPMedia > mediaLevel ) { < nl > + this . sessionLevel = sessionLevel ; < nl > + this . mediaLevel = new ArrayList < > ( mediaLevel ) ; < nl > + } < nl > + < nl > + public SDPSession getSessionLevel ( ) { < nl > + return sessionLevel ; < nl > + } < nl > + < nl > + public ArrayList < SDPMedia > getMediaLevel ( ) { < nl > + return mediaLevel ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java < nl > new file mode 100644 < nl > index 0000000 . . 973c035 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java < nl > @ @ - 0 , 0 + 1 , 32 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + import java . util . ArrayList ; < nl > + import java . util . List ; < nl > + < nl > + public class SDPSession { < nl > + < nl > + private final int version ; < nl > + private final ArrayList < SDPRawRecord > records ; < nl > + < nl > + public SDPSession ( int version , List < SDPRawRecord > records ) { < nl > + this . version = version ; < nl > + this . records = new ArrayList < > ( records ) ; < nl > + } < nl > + < nl > + public int getVersion ( ) { < nl > + return version ; < nl > + } < nl > + < nl > + public ArrayList < SDPRawRecord > getRecords ( ) { < nl > + return records ; < nl > + } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + String res = " v = " + version + " \ r \ n " ; < nl > + for ( SDPRawRecord r : records ) { < nl > + res = r . getType ( ) + " = " + r . getType ( ) + " \ r \ n " ; < nl > + } < nl > + return res ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java < nl > new file mode 100644 < nl > index 0000000 . . 5587d10 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java < nl > @ @ - 0 , 0 + 1 , 45 @ @ < nl > + package im . actor . core . webrtc . sdp ; < nl > + < nl > + import org . junit . Test ; < nl > + < nl > + public class SDPTest { < nl > + < nl > + private String sdp = " v = 0 \ n " + < nl > + " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + < nl > + " s = - \ n " + < nl > + " t = 0 0 \ n " + < nl > + " a = group : BUNDLE audio \ n " + < nl > + " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > + " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + < nl > + " c = IN IP4 0 . 0 . 0 . 0 \ n " + < nl > + " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + < nl > + " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + < nl > + " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + < nl > + " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + < nl > + " a = setup : active \ n " + < nl > + " a = mid : audio \ n " + < nl > + " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + < nl > + " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + < nl > + " a = sendrecv \ n " + < nl > + " a = rtcp - mux \ n " + < nl > + " a = rtpmap : 111 opus / 48000 / 2 \ n " + < nl > + " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + < nl > + " a = rtpmap : 103 ISAC / 16000 \ n " + < nl > + " a = rtpmap : 9 G722 / 8000 \ n " + < nl > + " a = rtpmap : 0 PCMU / 8000 \ n " + < nl > + " a = rtpmap : 8 PCMA / 8000 \ n " + < nl > + " a = rtpmap : 106 CN / 32000 \ n " + < nl > + " a = rtpmap : 105 CN / 16000 \ n " + < nl > + " a = rtpmap : 13 CN / 8000 \ n " + < nl > + " a = rtpmap : 126 telephone - event / 8000 \ n " + < nl > + " a = maxptime : 60 \ n " + < nl > + " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + < nl > + " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + < nl > + " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + < nl > + " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; < nl > + < nl > + @ Test < nl > + public void testSDPParser ( ) { < nl > + SDP . parse ( sdp ) ; < nl > + } < nl > + }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java 
 index 28b26d5 . . 78ff921 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallManagerActor . java 
 @ @ - 3 , 8 + 3 , 6 @ @ package im . actor . core . modules . calls ; 
 import java . util . HashMap ; 
 import java . util . HashSet ; 
 
 - import im . actor . core . api . rpc . RequestGetCallInfo ; 
 - import im . actor . core . api . rpc . ResponseGetCallInfo ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . modules . ModuleContext ; 
 import im . actor . core . util . ModuleActor ; 
 @ @ - 16 , 7 + 14 , 6 @ @ import im . actor . runtime . actors . Actor ; 
 import im . actor . runtime . actors . ActorCreator ; 
 import im . actor . runtime . actors . ActorRef ; 
 import im . actor . runtime . function . Constructor ; 
 - import im . actor . runtime . function . Consumer ; 
 
 public class CallManagerActor extends ModuleActor { 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java 
 index 6f02abf . . 8b1641e 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallSlaveActor . java 
 @ @ - 36 , 17 + 36 , 14 @ @ public class CallSlaveActor extends CallActor { 
 } ) . done ( self ( ) ) ; 
 } 
 
 - @ Override 
 - public void onBusStarted ( ) { 
 - super . onBusStarted ( ) ; 
 - } 
 - 
 public void onMasterNodeChanged ( int fromUid , long fromDeviceId ) { 
 masterNode = new MasterNode ( fromUid , fromDeviceId ) ; 
 if ( isAnswerPending ) { 
 isAnswerPending = false ; 
 sendSignalingMessage ( masterNode . getUid ( ) , masterNode . getDeviceId ( ) , new ApiAnswerCall ( ) ) ; 
 } 
 + 
 + schedule ( new DoAnswer ( ) , 5000 ) ; 
 } 
 
 public void onNeedOffer ( int destUid , long destDeviceId ) { 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java 
 deleted file mode 100644 
 index 5587d10 . . 0000000 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java 
 + + + / dev / null 
 @ @ - 1 , 45 + 0 , 0 @ @ 
 - package im . actor . core . webrtc . sdp ; 
 - 
 - import org . junit . Test ; 
 - 
 - public class SDPTest { 
 - 
 - private String sdp = " v = 0 \ n " + 
 - " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + 
 - " s = - \ n " + 
 - " t = 0 0 \ n " + 
 - " a = group : BUNDLE audio \ n " + 
 - " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 - " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + 
 - " c = IN IP4 0 . 0 . 0 . 0 \ n " + 
 - " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + 
 - " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + 
 - " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + 
 - " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + 
 - " a = setup : active \ n " + 
 - " a = mid : audio \ n " + 
 - " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + 
 - " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + 
 - " a = sendrecv \ n " + 
 - " a = rtcp - mux \ n " + 
 - " a = rtpmap : 111 opus / 48000 / 2 \ n " + 
 - " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + 
 - " a = rtpmap : 103 ISAC / 16000 \ n " + 
 - " a = rtpmap : 9 G722 / 8000 \ n " + 
 - " a = rtpmap : 0 PCMU / 8000 \ n " + 
 - " a = rtpmap : 8 PCMA / 8000 \ n " + 
 - " a = rtpmap : 106 CN / 32000 \ n " + 
 - " a = rtpmap : 105 CN / 16000 \ n " + 
 - " a = rtpmap : 13 CN / 8000 \ n " + 
 - " a = rtpmap : 126 telephone - event / 8000 \ n " + 
 - " a = maxptime : 60 \ n " + 
 - " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + 
 - " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + 
 - " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 - " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; 
 - 
 - @ Test 
 - public void testSDPParser ( ) { 
 - SDP . parse ( sdp ) ; 
 - } 
 - } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java 
 index 7506d33 . . e67012f 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / ThreadingRuntimeProvider . java 
 @ @ - 45 , 12 + 45 , 12 @ @ public class ThreadingRuntimeProvider implements ThreadingRuntime { 
 } 
 
 @ Override 
 - public Dispatcher createDispatcher ( ThreadPriority priority ) { 
 + public Dispatcher createDispatcher ( String name ) { 
 throw new RuntimeException ( " Dumb " ) ; 
 } 
 
 @ Override 
 - public ImmediateDispatcher createImmediateDispatcher ( ThreadPriority priority ) { 
 + public ImmediateDispatcher createImmediateDispatcher ( String name , ThreadPriority priority ) { 
 throw new RuntimeException ( " Dumb " ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java 
 index 1c2f2e1 . . 4d5b68c 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / template / java / im / actor / runtime / WebRTCRuntimeProvider . java 
 @ @ - 4 , 7 + 4 , 7 @ @ import org . jetbrains . annotations . NotNull ; 
 
 import im . actor . runtime . promise . Promise ; 
 import im . actor . runtime . promise . Promises ; 
 - import im . actor . runtime . webrtc . WebRTCLocalStream ; 
 + import im . actor . runtime . webrtc . WebRTCMediaStream ; 
 import im . actor . runtime . webrtc . WebRTCPeerConnection ; 
 
 public class WebRTCRuntimeProvider implements WebRTCRuntime { 
 @ @ - 15 , 9 + 15 , 9 @ @ public class WebRTCRuntimeProvider implements WebRTCRuntime { 
 return Promises . failure ( new RuntimeException ( " Dumb " ) ) ; 
 } 
 
 - @ Override 
 @ NotNull 
 - public Promise < WebRTCLocalStream > getUserAudio ( ) { 
 + @ Override 
 + public Promise < WebRTCMediaStream > getUserAudio ( ) { 
 return Promises . failure ( new RuntimeException ( " Dumb " ) ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java 
 new file mode 100644 
 index 0000000 . . 3d79bc7 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / test / java / im / actor / runtime / webrtc / sdp / SDPTest . java 
 @ @ - 0 , 0 + 1 , 45 @ @ 
 + package im . actor . runtime . webrtc . sdp ; 
 + 
 + import org . junit . Test ; 
 + 
 + public class SDPTest { 
 + 
 + private String sdp = " v = 0 \ n " + 
 + " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + 
 + " s = - \ n " + 
 + " t = 0 0 \ n " + 
 + " a = group : BUNDLE audio \ n " + 
 + " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 + " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + 
 + " c = IN IP4 0 . 0 . 0 . 0 \ n " + 
 + " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + 
 + " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + 
 + " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + 
 + " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + 
 + " a = setup : active \ n " + 
 + " a = mid : audio \ n " + 
 + " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + 
 + " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + 
 + " a = sendrecv \ n " + 
 + " a = rtcp - mux \ n " + 
 + " a = rtpmap : 111 opus / 48000 / 2 \ n " + 
 + " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + 
 + " a = rtpmap : 103 ISAC / 16000 \ n " + 
 + " a = rtpmap : 9 G722 / 8000 \ n " + 
 + " a = rtpmap : 0 PCMU / 8000 \ n " + 
 + " a = rtpmap : 8 PCMA / 8000 \ n " + 
 + " a = rtpmap : 106 CN / 32000 \ n " + 
 + " a = rtpmap : 105 CN / 16000 \ n " + 
 + " a = rtpmap : 13 CN / 8000 \ n " + 
 + " a = rtpmap : 126 telephone - event / 8000 \ n " + 
 + " a = maxptime : 60 \ n " + 
 + " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + 
 + " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + 
 + " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 + " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; 
 + 
 + @ Test 
 + public void testSDPParser ( ) { 
 + SDP . parse ( sdp ) ; 
 + } 
 + }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java 
 new file mode 100644 
 index 0000000 . . 96bbb58 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDP . java 
 @ @ - 0 , 0 + 1 , 11 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + public abstract class SDP { 
 + public static SDPScheme parse ( String sdp ) { 
 + String [ ] lines = sdp . split ( " \ \ r ? \ \ n " ) ; 
 + if ( ! lines [ 0 ] . startsWith ( " v = " ) ) { 
 + throw new RuntimeException ( " First line doesn ' t start with version of SDP " ) ; 
 + } 
 + return null ; 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java 
 new file mode 100644 
 index 0000000 . . 45698ba 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPMedia . java 
 @ @ - 0 , 0 + 1 , 15 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + import java . util . ArrayList ; 
 + 
 + public class SDPMedia { 
 + private ArrayList < SDPRawRecord > records ; 
 + 
 + public SDPMedia ( ArrayList < SDPRawRecord > records ) { 
 + this . records = records ; 
 + } 
 + 
 + public ArrayList < SDPRawRecord > getRecords ( ) { 
 + return records ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java 
 new file mode 100644 
 index 0000000 . . cae45eb 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPRawRecord . java 
 @ @ - 0 , 0 + 1 , 20 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + public class SDPRawRecord { 
 + 
 + private char type ; 
 + private String value ; 
 + 
 + public SDPRawRecord ( char type , String value ) { 
 + this . type = type ; 
 + this . value = value ; 
 + } 
 + 
 + public char getType ( ) { 
 + return type ; 
 + } 
 + 
 + public String getValue ( ) { 
 + return value ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java 
 new file mode 100644 
 index 0000000 . . 0165227 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPScheme . java 
 @ @ - 0 , 0 + 1 , 23 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + import java . util . ArrayList ; 
 + import java . util . List ; 
 + 
 + public class SDPScheme { 
 + 
 + public SDPSession sessionLevel ; 
 + public ArrayList < SDPMedia > mediaLevel ; 
 + 
 + public SDPScheme ( SDPSession sessionLevel , List < SDPMedia > mediaLevel ) { 
 + this . sessionLevel = sessionLevel ; 
 + this . mediaLevel = new ArrayList < > ( mediaLevel ) ; 
 + } 
 + 
 + public SDPSession getSessionLevel ( ) { 
 + return sessionLevel ; 
 + } 
 + 
 + public ArrayList < SDPMedia > getMediaLevel ( ) { 
 + return mediaLevel ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java 
 new file mode 100644 
 index 0000000 . . 973c035 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / webrtc / sdp / SDPSession . java 
 @ @ - 0 , 0 + 1 , 32 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + import java . util . ArrayList ; 
 + import java . util . List ; 
 + 
 + public class SDPSession { 
 + 
 + private final int version ; 
 + private final ArrayList < SDPRawRecord > records ; 
 + 
 + public SDPSession ( int version , List < SDPRawRecord > records ) { 
 + this . version = version ; 
 + this . records = new ArrayList < > ( records ) ; 
 + } 
 + 
 + public int getVersion ( ) { 
 + return version ; 
 + } 
 + 
 + public ArrayList < SDPRawRecord > getRecords ( ) { 
 + return records ; 
 + } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + String res = " v = " + version + " \ r \ n " ; 
 + for ( SDPRawRecord r : records ) { 
 + res = r . getType ( ) + " = " + r . getType ( ) + " \ r \ n " ; 
 + } 
 + return res ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java 
 new file mode 100644 
 index 0000000 . . 5587d10 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / test / java / im / actor / core / webrtc / sdp / SDPTest . java 
 @ @ - 0 , 0 + 1 , 45 @ @ 
 + package im . actor . core . webrtc . sdp ; 
 + 
 + import org . junit . Test ; 
 + 
 + public class SDPTest { 
 + 
 + private String sdp = " v = 0 \ n " + 
 + " o = - 3369226760567452353 2 IN IP4 127 . 0 . 0 . 1 \ n " + 
 + " s = - \ n " + 
 + " t = 0 0 \ n " + 
 + " a = group : BUNDLE audio \ n " + 
 + " a = msid - semantic : WMS 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 + " m = audio 9 UDP / TLS / RTP / SAVPF 111 103 9 0 8 106 105 13 126 \ n " + 
 + " c = IN IP4 0 . 0 . 0 . 0 \ n " + 
 + " a = rtcp : 9 IN IP4 0 . 0 . 0 . 0 \ n " + 
 + " a = ice - ufrag : Cf21p3V3DLMewJzW \ n " + 
 + " a = ice - pwd : GZVX4lWnwLpUF9bgdFP8Rjjm \ n " + 
 + " a = fingerprint : sha - 256 63 : DF : AC : 5B : AC : 01 : B2 : 16 : 33 : 92 : 61 : 4A : 83 : CE : A1 : 27 : DC : 43 : 12 : DF : 9D : D2 : 2B : 86 : 84 : 58 : AB : C9 : 01 : DA : C3 : 2A \ n " + 
 + " a = setup : active \ n " + 
 + " a = mid : audio \ n " + 
 + " a = extmap : 1 urn : ietf : params : rtp - hdrext : ssrc - audio - level \ n " + 
 + " a = extmap : 3 http : / / www . webrtc . org / experiments / rtp - hdrext / abs - send - time \ n " + 
 + " a = sendrecv \ n " + 
 + " a = rtcp - mux \ n " + 
 + " a = rtpmap : 111 opus / 48000 / 2 \ n " + 
 + " a = fmtp : 111 minptime = 10 ; useinbandfec = 1 \ n " + 
 + " a = rtpmap : 103 ISAC / 16000 \ n " + 
 + " a = rtpmap : 9 G722 / 8000 \ n " + 
 + " a = rtpmap : 0 PCMU / 8000 \ n " + 
 + " a = rtpmap : 8 PCMA / 8000 \ n " + 
 + " a = rtpmap : 106 CN / 32000 \ n " + 
 + " a = rtpmap : 105 CN / 16000 \ n " + 
 + " a = rtpmap : 13 CN / 8000 \ n " + 
 + " a = rtpmap : 126 telephone - event / 8000 \ n " + 
 + " a = maxptime : 60 \ n " + 
 + " a = ssrc : 419421375 cname : us7FwY4nl + TCdXVa \ n " + 
 + " a = ssrc : 419421375 msid : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " + 
 + " a = ssrc : 419421375 mslabel : 4l5CG6RIEL30oDxuCDaOXlJSQJDjjEFcPqSZ \ n " + 
 + " a = ssrc : 419421375 label : 3b9e5bd4 - 81bf - 4080 - b914 - 2c55696e8ba0 \ n " ; 
 + 
 + @ Test 
 + public void testSDPParser ( ) { 
 + SDP . parse ( sdp ) ; 
 + } 
 + }
