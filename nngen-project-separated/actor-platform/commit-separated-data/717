BLEU SCORE: 0.09578464408619825

TEST MSG: fix ( core ) : Removing Stream from Peer Connection before disposing
GENERATED MSG: fix ( js ) : Fixing media streams closing

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift < nl > index 1d50b9e . . e1bf32d 100644 < nl > - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift < nl > + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift < nl > @ @ - 105 , 6 + 105 , 12 @ @ class CocoaWebRTCPeerConnection : NSObject , ARWebRTCPeerConnection , RTCPeerConnec < nl > } < nl > } < nl > < nl > + func removeOwnStream ( stream : ARWebRTCMediaStream ) { < nl > + if let str = stream as ? MediaStream { < nl > + peerConnection . removeStream ( str . stream ) < nl > + } < nl > + } < nl > + < nl > func createAnswer ( ) - > ARPromise { < nl > return ARPromise ( closure : { ( resolver ) - > ( ) in < nl > self . peerConnection . createAnswer ( RTCMediaConstraints ( ) , didCreate : { ( desc , error ) - > ( ) in < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java < nl > index c30924b . . 5166d2b 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java < nl > @ @ - 270 , 6 + 270 , 7 @ @ public class PeerConnectionActor extends ModuleActor { < nl > super . postStop ( ) ; < nl > < nl > if ( peerConnection ! = null ) { < nl > + peerConnection . removeOwnStream ( stream ) ; < nl > peerConnection . close ( ) ; < nl > peerConnection = null ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > index fb1aed9 . . 437bc97 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java < nl > @ @ - 162 , 6 + 162 , 16 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { < nl > } ) ; < nl > } < nl > < nl > + @ Override < nl > + public void removeOwnStream ( @ NotNull final WebRTCMediaStream stream ) { < nl > + AndroidWebRTCRuntimeProvider . postToHandler ( new Runnable ( ) { < nl > + @ Override < nl > + public void run ( ) { < nl > + peerConnection . removeStream ( ( ( AndroidMediaStream ) stream ) . getStream ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > @ NotNull < nl > @ Override < nl > public Promise < WebRTCSessionDescription > setLocalDescription ( @ NotNull final WebRTCSessionDescription description ) { < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java < nl > index 629945f . . 0d577c0 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java < nl > @ @ - 21 , 6 + 21 , 10 @ @ public class JsPeerConnection extends JavaScriptObject { < nl > this . peerConnection . addStream ( stream ) ; < nl > } - * / ; < nl > < nl > + public final native void removeStream ( JsMediaStream stream ) / * - { < nl > + this . peerConnection . removeStream ( stream ) ; < nl > + } - * / ; < nl > + < nl > public final native void addIceCandidate ( int label , String candidate ) / * - { < nl > this . peerConnection . addIceCandidate ( new RTCIceCandidate ( { sdpMLineIndex : label , candidate : candidate } ) ) ; < nl > } - * / ; < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > index c26aa42 . . 4b3af84 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > @ @ - 87 , 6 + 87 , 13 @ @ public class PeerConnection implements WebRTCPeerConnection { < nl > } < nl > } < nl > < nl > + @ Override < nl > + public void removeOwnStream ( @ NotNull WebRTCMediaStream stream ) { < nl > + if ( stream instanceof MediaStream ) { < nl > + peerConnection . removeStream ( ( ( MediaStream ) stream ) . getStream ( ) ) ; < nl > + } < nl > + } < nl > + < nl > @ NotNull < nl > @ Override < nl > public Promise < WebRTCSessionDescription > setLocalDescription ( @ NotNull final WebRTCSessionDescription description ) { < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java < nl > index 04f0459 . . a7ed92a 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java < nl > @ @ - 45 , 6 + 45 , 15 @ @ public interface WebRTCPeerConnection { < nl > @ ObjectiveCName ( " addOwnStream : " ) < nl > void addOwnStream ( @ NotNull WebRTCMediaStream stream ) ; < nl > < nl > + < nl > + / * * < nl > + * Removing Own Stream < nl > + * < nl > + * @ param stream removed stream < nl > + * / < nl > + @ ObjectiveCName ( " removeOwnStream : " ) < nl > + void removeOwnStream ( @ NotNull WebRTCMediaStream stream ) ; < nl > + < nl > / * * < nl > * Setting Local Description < nl > *
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java < nl > index bf97a7a . . c2684a1 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java < nl > @ @ - 268 , 7 + 268 , 7 @ @ public class CallMasterActor extends CallActor { < nl > / / < nl > if ( state . getConnectedMembers ( ) < nl > . isAll ( MasterCallMember . IS _ ENDED ) ) { < nl > - callVM . getState ( ) . change ( CallState . ENDED ) ; < nl > + shutdown ( ) ; < nl > return ; < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java < nl > index 122f8dc . . d792314 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java < nl > @ @ - 284 , 8 + 284 , 14 @ @ public class PeerConnectionActor extends ModuleActor { < nl > < nl > public void onEnded ( ) { < nl > Log . d ( TAG , " OnEnded " ) ; < nl > - peerConnection . close ( ) ; < nl > - stream . close ( ) ; < nl > + if ( peerConnection ! = null ) { < nl > + peerConnection . close ( ) ; < nl > + peerConnection = null ; < nl > + } < nl > + if ( stream ! = null ) { < nl > + stream . close ( ) ; < nl > + stream = null ; < nl > + } < nl > isReady = false ; < nl > state = State . CLOSED ; < nl > self ( ) . send ( PoisonPill . INSTANCE ) ; < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java < nl > index fc0137e . . a581c76 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java < nl > @ @ - 29 , 6 + 29 , 13 @ @ public class JsMediaStream extends JavaScriptObject { < nl > this . removeTrack ( track ) ; < nl > } - * / ; < nl > < nl > + public final void stop ( ) { < nl > + JsArray < JsMediaStreamTrack > tracks = getTracks ( ) ; < nl > + for ( int i = 0 ; i < tracks . length ( ) ; i + + ) { < nl > + tracks . get ( i ) . stop ( ) ; < nl > + } < nl > + } < nl > + < nl > public native final String createUrl ( ) / * - { < nl > return URL . createObjectURL ( this ) ; < nl > } - * / ; < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java < nl > index 7bfc7aa . . 82d7cab 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java < nl > @ @ - 53 , 8 + 53 , 9 @ @ public class MediaStream implements WebRTCMediaStream { < nl > @ Override < nl > public void close ( ) { < nl > if ( audio ! = null ) { < nl > + audio . pause ( ) ; < nl > audio . reset ( ) ; < nl > } < nl > - stream . stopAll ( ) ; < nl > + stream . stop ( ) ; < nl > } < nl > } < nl > diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > index 26f7797 . . c26aa42 100644 < nl > - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java < nl > @ @ - 175 , 9 + 175 , 13 @ @ public class PeerConnection implements WebRTCPeerConnection { < nl > < nl > @ Override < nl > public void close ( ) { < nl > - peerConnection . close ( ) ; < nl > + if ( peerConnection ! = null ) { < nl > + peerConnection . close ( ) ; < nl > + peerConnection = null ; < nl > + } < nl > for ( MediaStream s : streams . values ( ) ) { < nl > s . close ( ) ; < nl > } < nl > + streams . clear ( ) ; < nl > } < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift 
 index 1d50b9e . . e1bf32d 100644 
 - - - a / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift 
 + + + b / actor - sdk / sdk - core - ios / ActorSDK / Sources / ActorCore / Providers / CocoaWebRTCRuntime . swift 
 @ @ - 105 , 6 + 105 , 12 @ @ class CocoaWebRTCPeerConnection : NSObject , ARWebRTCPeerConnection , RTCPeerConnec 
 } 
 } 
 
 + func removeOwnStream ( stream : ARWebRTCMediaStream ) { 
 + if let str = stream as ? MediaStream { 
 + peerConnection . removeStream ( str . stream ) 
 + } 
 + } 
 + 
 func createAnswer ( ) - > ARPromise { 
 return ARPromise ( closure : { ( resolver ) - > ( ) in 
 self . peerConnection . createAnswer ( RTCMediaConstraints ( ) , didCreate : { ( desc , error ) - > ( ) in 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java 
 index c30924b . . 5166d2b 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / peers / PeerConnectionActor . java 
 @ @ - 270 , 6 + 270 , 7 @ @ public class PeerConnectionActor extends ModuleActor { 
 super . postStop ( ) ; 
 
 if ( peerConnection ! = null ) { 
 + peerConnection . removeOwnStream ( stream ) ; 
 peerConnection . close ( ) ; 
 peerConnection = null ; 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 index fb1aed9 . . 437bc97 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - android / src / main / java / im / actor / runtime / android / webrtc / AndroidPeerConnection . java 
 @ @ - 162 , 6 + 162 , 16 @ @ public class AndroidPeerConnection implements WebRTCPeerConnection { 
 } ) ; 
 } 
 
 + @ Override 
 + public void removeOwnStream ( @ NotNull final WebRTCMediaStream stream ) { 
 + AndroidWebRTCRuntimeProvider . postToHandler ( new Runnable ( ) { 
 + @ Override 
 + public void run ( ) { 
 + peerConnection . removeStream ( ( ( AndroidMediaStream ) stream ) . getStream ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 @ NotNull 
 @ Override 
 public Promise < WebRTCSessionDescription > setLocalDescription ( @ NotNull final WebRTCSessionDescription description ) { 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java 
 index 629945f . . 0d577c0 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsPeerConnection . java 
 @ @ - 21 , 6 + 21 , 10 @ @ public class JsPeerConnection extends JavaScriptObject { 
 this . peerConnection . addStream ( stream ) ; 
 } - * / ; 
 
 + public final native void removeStream ( JsMediaStream stream ) / * - { 
 + this . peerConnection . removeStream ( stream ) ; 
 + } - * / ; 
 + 
 public final native void addIceCandidate ( int label , String candidate ) / * - { 
 this . peerConnection . addIceCandidate ( new RTCIceCandidate ( { sdpMLineIndex : label , candidate : candidate } ) ) ; 
 } - * / ; 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 index c26aa42 . . 4b3af84 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 @ @ - 87 , 6 + 87 , 13 @ @ public class PeerConnection implements WebRTCPeerConnection { 
 } 
 } 
 
 + @ Override 
 + public void removeOwnStream ( @ NotNull WebRTCMediaStream stream ) { 
 + if ( stream instanceof MediaStream ) { 
 + peerConnection . removeStream ( ( ( MediaStream ) stream ) . getStream ( ) ) ; 
 + } 
 + } 
 + 
 @ NotNull 
 @ Override 
 public Promise < WebRTCSessionDescription > setLocalDescription ( @ NotNull final WebRTCSessionDescription description ) { 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java 
 index 04f0459 . . a7ed92a 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - shared / src / main / java / im / actor / runtime / webrtc / WebRTCPeerConnection . java 
 @ @ - 45 , 6 + 45 , 15 @ @ public interface WebRTCPeerConnection { 
 @ ObjectiveCName ( " addOwnStream : " ) 
 void addOwnStream ( @ NotNull WebRTCMediaStream stream ) ; 
 
 + 
 + / * * 
 + * Removing Own Stream 
 + * 
 + * @ param stream removed stream 
 + * / 
 + @ ObjectiveCName ( " removeOwnStream : " ) 
 + void removeOwnStream ( @ NotNull WebRTCMediaStream stream ) ; 
 + 
 / * * 
 * Setting Local Description 
 *

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java 
 index bf97a7a . . c2684a1 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / CallMasterActor . java 
 @ @ - 268 , 7 + 268 , 7 @ @ public class CallMasterActor extends CallActor { 
 / / 
 if ( state . getConnectedMembers ( ) 
 . isAll ( MasterCallMember . IS _ ENDED ) ) { 
 - callVM . getState ( ) . change ( CallState . ENDED ) ; 
 + shutdown ( ) ; 
 return ; 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java 
 index 122f8dc . . d792314 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / calls / PeerConnectionActor . java 
 @ @ - 284 , 8 + 284 , 14 @ @ public class PeerConnectionActor extends ModuleActor { 
 
 public void onEnded ( ) { 
 Log . d ( TAG , " OnEnded " ) ; 
 - peerConnection . close ( ) ; 
 - stream . close ( ) ; 
 + if ( peerConnection ! = null ) { 
 + peerConnection . close ( ) ; 
 + peerConnection = null ; 
 + } 
 + if ( stream ! = null ) { 
 + stream . close ( ) ; 
 + stream = null ; 
 + } 
 isReady = false ; 
 state = State . CLOSED ; 
 self ( ) . send ( PoisonPill . INSTANCE ) ; 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java 
 index fc0137e . . a581c76 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / JsMediaStream . java 
 @ @ - 29 , 6 + 29 , 13 @ @ public class JsMediaStream extends JavaScriptObject { 
 this . removeTrack ( track ) ; 
 } - * / ; 
 
 + public final void stop ( ) { 
 + JsArray < JsMediaStreamTrack > tracks = getTracks ( ) ; 
 + for ( int i = 0 ; i < tracks . length ( ) ; i + + ) { 
 + tracks . get ( i ) . stop ( ) ; 
 + } 
 + } 
 + 
 public native final String createUrl ( ) / * - { 
 return URL . createObjectURL ( this ) ; 
 } - * / ; 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java 
 index 7bfc7aa . . 82d7cab 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / MediaStream . java 
 @ @ - 53 , 8 + 53 , 9 @ @ public class MediaStream implements WebRTCMediaStream { 
 @ Override 
 public void close ( ) { 
 if ( audio ! = null ) { 
 + audio . pause ( ) ; 
 audio . reset ( ) ; 
 } 
 - stream . stopAll ( ) ; 
 + stream . stop ( ) ; 
 } 
 } 
 diff - - git a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 index 26f7797 . . c26aa42 100644 
 - - - a / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 + + + b / actor - sdk / sdk - core / runtime / runtime - js / src / main / java / im / actor / runtime / js / webrtc / PeerConnection . java 
 @ @ - 175 , 9 + 175 , 13 @ @ public class PeerConnection implements WebRTCPeerConnection { 
 
 @ Override 
 public void close ( ) { 
 - peerConnection . close ( ) ; 
 + if ( peerConnection ! = null ) { 
 + peerConnection . close ( ) ; 
 + peerConnection = null ; 
 + } 
 for ( MediaStream s : streams . values ( ) ) { 
 s . close ( ) ; 
 } 
 + streams . clear ( ) ; 
 } 
 }
