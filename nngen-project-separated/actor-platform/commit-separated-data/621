BLEU SCORE: 0.21200626759025185

TEST MSG: fix ( android ) : remove messenger ( ) import from GalleryScannerActor
GENERATED MSG: feat ( android ) : call methods in Messenger

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > index 25288ba . . 829ca2f 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java < nl > @ @ - 488 , 13 + 488 , 13 @ @ public class AndroidMessenger extends im . actor . core . Messenger { < nl > < nl > public GalleryVM getGalleryVM ( ) { < nl > if ( galleryVM = = null ) { < nl > + galleryVM = new GalleryVM ( ) ; < nl > galleryScannerActor = ActorSystem . system ( ) . actorOf ( Props . create ( new ActorCreator ( ) { < nl > @ Override < nl > public Actor create ( ) { < nl > - return new GalleryScannerActor ( AndroidContext . getContext ( ) ) ; < nl > + return new GalleryScannerActor ( AndroidContext . getContext ( ) , galleryVM ) ; < nl > } < nl > } ) , " actor / gallery _ scanner " ) ; < nl > - galleryVM = new GalleryVM ( ) ; < nl > } < nl > return galleryVM ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > index 42d8d19 . . af83d18 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java < nl > @ @ - 17 , 8 + 17 , 6 @ @ import im . actor . core . utils . ImageHelper ; < nl > import im . actor . core . viewmodel . GalleryVM ; < nl > import im . actor . runtime . actors . Actor ; < nl > < nl > - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > - < nl > public class GalleryScannerActor extends Actor { < nl > < nl > Context context ; < nl > @ @ - 41 , 13 + 39 , 13 @ @ public class GalleryScannerActor extends Actor { < nl > private boolean scanned = false ; < nl > private String [ ] projection ; < nl > < nl > - public GalleryScannerActor ( Context context ) { < nl > + public GalleryScannerActor ( Context context , GalleryVM galleryVM ) { < nl > this . context = context ; < nl > + this . galleryVM = galleryVM ; < nl > } < nl > < nl > @ Override < nl > public void preStart ( ) { < nl > - galleryVM = messenger ( ) . getGalleryVM ( ) ; < nl > uri = android . provider . MediaStore . Images . Media . EXTERNAL _ CONTENT _ URI ; < nl > < nl > self ( ) . send ( new InitScan ( ) ) ;
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index 0da562b . . 502315f 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 16 , 6 + 16 , 7 @ @ import java . util . List ; < nl > import im . actor . core . api . ApiMessage ; < nl > import im . actor . core . api . ApiSex ; < nl > import im . actor . core . api . ApiAuthSession ; < nl > + import im . actor . core . api . rpc . ResponseDoCall ; < nl > import im . actor . core . entity . FileReference ; < nl > import im . actor . core . entity . Group ; < nl > import im . actor . core . entity . MentionFilterResult ; < nl > @ @ - 41 , 6 + 42 , 7 @ @ import im . actor . core . modules . events . PeerChatOpened ; < nl > import im . actor . core . modules . events . PeerInfoClosed ; < nl > import im . actor . core . modules . events . PeerInfoOpened ; < nl > import im . actor . core . modules . events . UserVisible ; < nl > + import im . actor . core . modules . internal . CallsModule ; < nl > import im . actor . core . network . NetworkState ; < nl > import im . actor . core . util . ActorTrace ; < nl > import im . actor . core . util . Timing ; < nl > @ @ - 964 , 6 + 966 , 22 @ @ public class Messenger { < nl > } < nl > < nl > / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > + / / Calls < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > + < nl > + public Command < ResponseDoCall > doCall ( User user , CallsModule . CallCallback callCallback ) { < nl > + return modules . getCallsModule ( ) . makeCall ( user , callCallback ) ; < nl > + } < nl > + < nl > + public void endCall ( long callId ) { < nl > + modules . getCallsModule ( ) . endCall ( callId ) ; < nl > + } < nl > + < nl > + public void answerCall ( long callId , CallsModule . CallCallback callback ) { < nl > + modules . getCallsModule ( ) . answerCall ( callId , callback ) ; < nl > + } < nl > + < nl > + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > / / Peer operations < nl > / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > index b414eb1 . . 50606dc 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java < nl > @ @ - 7 , 6 + 7 , 7 @ @ import im . actor . runtime . actors . messages . PoisonPill ; < nl > < nl > public class CallActor extends ModuleActor { < nl > < nl > + private boolean inited = false ; < nl > private int timeout = 0 ; < nl > private boolean alive = false ; < nl > private long callId ; < nl > @ @ - 21 , 7 + 22 , 6 @ @ public class CallActor extends ModuleActor { < nl > @ Override < nl > public void preStart ( ) { < nl > super . preStart ( ) ; < nl > - self ( ) . send ( new CheckAlive ( ) , CallsModule . CALL _ TIMEOUT ) ; < nl > self ( ) . send ( new SendCallInProgress ( ) ) ; < nl > } < nl > < nl > @ @ - 69 , 6 + 69 , 10 @ @ public class CallActor extends ModuleActor { < nl > private void onCallInProgress ( int timeout ) { < nl > alive = true ; < nl > this . timeout = timeout ; < nl > + if ( ! inited ) { < nl > + inited = true ; < nl > + self ( ) . send ( new CheckAlive ( ) , CallsModule . CALL _ TIMEOUT ) ; < nl > + } < nl > } < nl > < nl > public static class EndCall {

TEST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 index 25288ba . . 829ca2f 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / AndroidMessenger . java 
 @ @ - 488 , 13 + 488 , 13 @ @ public class AndroidMessenger extends im . actor . core . Messenger { 
 
 public GalleryVM getGalleryVM ( ) { 
 if ( galleryVM = = null ) { 
 + galleryVM = new GalleryVM ( ) ; 
 galleryScannerActor = ActorSystem . system ( ) . actorOf ( Props . create ( new ActorCreator ( ) { 
 @ Override 
 public Actor create ( ) { 
 - return new GalleryScannerActor ( AndroidContext . getContext ( ) ) ; 
 + return new GalleryScannerActor ( AndroidContext . getContext ( ) , galleryVM ) ; 
 } 
 } ) , " actor / gallery _ scanner " ) ; 
 - galleryVM = new GalleryVM ( ) ; 
 } 
 return galleryVM ; 
 } 
 diff - - git a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 index 42d8d19 . . af83d18 100644 
 - - - a / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 + + + b / actor - sdk / sdk - core / core / core - android / src / main / java / im / actor / core / utils / GalleryScannerActor . java 
 @ @ - 17 , 8 + 17 , 6 @ @ import im . actor . core . utils . ImageHelper ; 
 import im . actor . core . viewmodel . GalleryVM ; 
 import im . actor . runtime . actors . Actor ; 
 
 - import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 - 
 public class GalleryScannerActor extends Actor { 
 
 Context context ; 
 @ @ - 41 , 13 + 39 , 13 @ @ public class GalleryScannerActor extends Actor { 
 private boolean scanned = false ; 
 private String [ ] projection ; 
 
 - public GalleryScannerActor ( Context context ) { 
 + public GalleryScannerActor ( Context context , GalleryVM galleryVM ) { 
 this . context = context ; 
 + this . galleryVM = galleryVM ; 
 } 
 
 @ Override 
 public void preStart ( ) { 
 - galleryVM = messenger ( ) . getGalleryVM ( ) ; 
 uri = android . provider . MediaStore . Images . Media . EXTERNAL _ CONTENT _ URI ; 
 
 self ( ) . send ( new InitScan ( ) ) ;

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index 0da562b . . 502315f 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 16 , 6 + 16 , 7 @ @ import java . util . List ; 
 import im . actor . core . api . ApiMessage ; 
 import im . actor . core . api . ApiSex ; 
 import im . actor . core . api . ApiAuthSession ; 
 + import im . actor . core . api . rpc . ResponseDoCall ; 
 import im . actor . core . entity . FileReference ; 
 import im . actor . core . entity . Group ; 
 import im . actor . core . entity . MentionFilterResult ; 
 @ @ - 41 , 6 + 42 , 7 @ @ import im . actor . core . modules . events . PeerChatOpened ; 
 import im . actor . core . modules . events . PeerInfoClosed ; 
 import im . actor . core . modules . events . PeerInfoOpened ; 
 import im . actor . core . modules . events . UserVisible ; 
 + import im . actor . core . modules . internal . CallsModule ; 
 import im . actor . core . network . NetworkState ; 
 import im . actor . core . util . ActorTrace ; 
 import im . actor . core . util . Timing ; 
 @ @ - 964 , 6 + 966 , 22 @ @ public class Messenger { 
 } 
 
 / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + / / Calls 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + 
 + public Command < ResponseDoCall > doCall ( User user , CallsModule . CallCallback callCallback ) { 
 + return modules . getCallsModule ( ) . makeCall ( user , callCallback ) ; 
 + } 
 + 
 + public void endCall ( long callId ) { 
 + modules . getCallsModule ( ) . endCall ( callId ) ; 
 + } 
 + 
 + public void answerCall ( long callId , CallsModule . CallCallback callback ) { 
 + modules . getCallsModule ( ) . answerCall ( callId , callback ) ; 
 + } 
 + 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 / / Peer operations 
 / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 index b414eb1 . . 50606dc 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / internal / calls / CallActor . java 
 @ @ - 7 , 6 + 7 , 7 @ @ import im . actor . runtime . actors . messages . PoisonPill ; 
 
 public class CallActor extends ModuleActor { 
 
 + private boolean inited = false ; 
 private int timeout = 0 ; 
 private boolean alive = false ; 
 private long callId ; 
 @ @ - 21 , 7 + 22 , 6 @ @ public class CallActor extends ModuleActor { 
 @ Override 
 public void preStart ( ) { 
 super . preStart ( ) ; 
 - self ( ) . send ( new CheckAlive ( ) , CallsModule . CALL _ TIMEOUT ) ; 
 self ( ) . send ( new SendCallInProgress ( ) ) ; 
 } 
 
 @ @ - 69 , 6 + 69 , 10 @ @ public class CallActor extends ModuleActor { 
 private void onCallInProgress ( int timeout ) { 
 alive = true ; 
 this . timeout = timeout ; 
 + if ( ! inited ) { 
 + inited = true ; 
 + self ( ) . send ( new CheckAlive ( ) , CallsModule . CALL _ TIMEOUT ) ; 
 + } 
 } 
 
 public static class EndCall {
