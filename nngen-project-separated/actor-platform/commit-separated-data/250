BLEU SCORE: 0.392814650900513

TEST MSG: feat ( android ) : add custom share menu delegate
GENERATED MSG: feat ( android ) : chat backgrounds settings

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index 5347bc6 . . 702f6f7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 5 , 11 + 5 , 15 @ @ import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . CheckBox ; < nl > + import android . widget . Toast ; < nl > + < nl > + import java . util . ArrayList ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKApplication ; < nl > import im . actor . sdk . ActorStyle ; < nl > import im . actor . sdk . BaseActorSDKDelegate ; < nl > + import im . actor . sdk . controllers . conversation . ShareMenuField ; < nl > import im . actor . sdk . controllers . group . GroupInfoFragment ; < nl > import im . actor . sdk . controllers . profile . ProfileFragment ; < nl > import im . actor . sdk . controllers . settings . ActorSettingsCategory ; < nl > @ @ - 24 , 7 + 28 , 7 @ @ public class Application extends ActorSDKApplication { < nl > < nl > @ Override < nl > public void onConfigureActorSDK ( ) { < nl > - / / ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > + ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; < nl > ActorSDK . sharedActor ( ) . setPushId ( 209133700967L ) ; < nl > < nl > ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > @ @ - 71 , 6 + 75 , 19 @ @ public class Application extends ActorSDKApplication { < nl > / / return null ; < nl > / / } < nl > < nl > + < nl > + @ Override < nl > + public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { < nl > + ArrayList < ShareMenuField > shareMenuFields = new ArrayList < > ( ) ; < nl > + shareMenuFields . add ( new ShareMenuField ( R . drawable . conv _ location _ icon , ActorSDK . sharedActor ( ) . style . getMainColor ( ) , " lol " , new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + Toast . makeText ( v . getContext ( ) , " Hey " , Toast . LENGTH _ LONG ) . show ( ) ; < nl > + } < nl > + } ) ) ; < nl > + return shareMenuFields ; < nl > + } < nl > + < nl > @ Override < nl > public BaseActorProfileActivity getProfileIntent ( int uid ) { < nl > return new BaseActorProfileActivity ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index 8670147 . . ee1612b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 5 , 9 + 5 , 12 @ @ import android . net . Uri ; < nl > import android . view . ViewGroup ; < nl > import android . widget . TableLayout ; < nl > < nl > + import java . util . ArrayList ; < nl > + < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . conversation . ShareMenuField ; < nl > import im . actor . sdk . controllers . root . MainPhoneController ; < nl > import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > import im . actor . sdk . controllers . conversation . MessagesAdapter ; < nl > @ @ - 178 , 4 + 181 , 6 @ @ public interface ActorSDKDelegate { < nl > * @ param shareMenu share menu < nl > * / < nl > void onShareMenuCreated ( TableLayout shareMenu ) ; < nl > + < nl > + ArrayList < ShareMenuField > addCustomShareMenuFields ( ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 098dc0f . . 23f344c 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 6 , 10 + 6 , 13 @ @ import android . provider . Settings ; < nl > import android . view . ViewGroup ; < nl > import android . widget . TableLayout ; < nl > < nl > + import java . util . ArrayList ; < nl > + < nl > import im . actor . core . AuthState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . conversation . ShareMenuField ; < nl > import im . actor . sdk . controllers . root . MainPhoneController ; < nl > import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > import im . actor . sdk . controllers . conversation . MessagesAdapter ; < nl > @ @ - 206 , 6 + 209 , 11 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > < nl > } < nl > < nl > + @ Override < nl > + public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { < nl > + return null ; < nl > + } < nl > + < nl > / / < nl > / / Notifications < nl > / / < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index a1b8524 . . b77ffde 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 14 , 6 + 14 , 7 @ @ import android . graphics . Color ; < nl > import android . graphics . PorterDuff ; < nl > import android . graphics . PorterDuffColorFilter ; < nl > import android . graphics . drawable . Drawable ; < nl > + import android . graphics . drawable . StateListDrawable ; < nl > import android . media . MediaScannerConnection ; < nl > import android . net . Uri ; < nl > import android . os . Build ; < nl > @ @ - 39 , 6 + 40 , 7 @ @ import android . view . Menu ; < nl > import android . view . MenuItem ; < nl > import android . view . MotionEvent ; < nl > import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > import android . view . animation . AlphaAnimation ; < nl > import android . view . animation . Animation ; < nl > import android . view . animation . TranslateAnimation ; < nl > @ @ - 46 , 7 + 48 , 9 @ @ import android . widget . AdapterView ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . LinearLayout ; < nl > import android . widget . TableLayout ; < nl > + import android . widget . TableRow ; < nl > import android . widget . TextView ; < nl > import android . widget . Toast ; < nl > < nl > @ @ - 85 , 6 + 89 , 7 @ @ import im . actor . sdk . intents . ActorIntent ; < nl > import im . actor . sdk . util . Randoms ; < nl > import im . actor . sdk . util . Screen ; < nl > import im . actor . core . utils . GalleryScannerActor ; < nl > + import im . actor . sdk . view . ShareMenuButtonFactory ; < nl > import im . actor . sdk . view . TintDrawable ; < nl > import im . actor . sdk . view . adapters . HolderAdapter ; < nl > import im . actor . sdk . view . adapters . RecyclerListView ; < nl > @ @ - 230 , 6 + 235 , 10 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > private boolean isBot = false ; < nl > private View emptyBotSend ; < nl > private TextView emptyBotHint ; < nl > + private ImageView menuIconToChange ; < nl > + private TextView menuTitleToChange ; < nl > + private View . OnClickListener shareSendOcl ; < nl > + private View . OnClickListener defaultSendOcl ; < nl > < nl > public static Intent build ( Peer peer , boolean compose , Context context ) { < nl > final Intent intent = new Intent ( context , ChatActivity . class ) ; < nl > @ @ - 348 , 7 + 357 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } ) ; < nl > < nl > final TextView contactText = ( TextView ) findViewById ( R . id . contact _ text ) ; < nl > - final View shareContact = findViewById ( R . id . share _ contact ) ; < nl > + final ImageView shareContact = ( ImageView ) findViewById ( R . id . share _ contact ) ; < nl > findViewById ( R . id . share _ hide ) . setVisibility ( View . GONE ) ; < nl > < nl > View . OnClickListener shareMenuOCL = new View . OnClickListener ( ) { < nl > @ @ - 409 , 6 + 418 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > hideShare ( ) ; < nl > } < nl > } ; < nl > + defaultSendOcl = shareMenuOCL ; < nl > < nl > findViewById ( R . id . share _ gallery ) . setOnClickListener ( shareMenuOCL ) ; < nl > findViewById ( R . id . share _ video ) . setOnClickListener ( shareMenuOCL ) ; < nl > @ @ - 420 , 6 + 430 , 77 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > shareLocation . setOnClickListener ( shareMenuOCL ) ; < nl > ActorSDK . sharedActor ( ) . getDelegate ( ) . onShareMenuCreated ( shareMenu ) ; < nl > < nl > + menuIconToChange = shareContact ; < nl > + menuTitleToChange = contactText ; < nl > + < nl > + ArrayList < ShareMenuField > customFields = ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( ) ; < nl > + < nl > + if ( customFields ! = null & & customFields . size ( ) > 0 ) { < nl > + if ( customFields . size ( ) % 2 ! = 0 ) { < nl > + customFields . add ( new ShareMenuField ( R . drawable . attach _ hide2 , < nl > + / / ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) , < nl > + Color . RED , < nl > + " " , < nl > + new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + < nl > + } < nl > + } ) ) ; < nl > + } < nl > + TableRow rowOne = ( TableRow ) shareMenu . findViewById ( R . id . share _ row _ one ) ; < nl > + TableRow rowTwo = ( TableRow ) shareMenu . findViewById ( R . id . share _ row _ two ) ; < nl > + boolean first = true ; < nl > + TableRow row ; < nl > + TableRow . LayoutParams params = new TableRow . LayoutParams ( 0 , ViewGroup . LayoutParams . WRAP _ CONTENT , 1 ) ; < nl > + < nl > + for ( int i = 0 ; i < customFields . size ( ) ; i + + ) { < nl > + ShareMenuField f = customFields . get ( i ) ; < nl > + row = first ? rowOne : rowTwo ; < nl > + < nl > + View shareItem = getLayoutInflater ( ) . inflate ( R . layout . share _ menu _ item , null ) ; < nl > + < nl > + TextView title = ( TextView ) shareItem . findViewById ( R . id . title ) ; < nl > + title . setText ( f . getTitle ( ) ) ; < nl > + < nl > + ImageView icon = ( ImageView ) shareItem . findViewById ( R . id . icon ) ; < nl > + icon . setClickable ( true ) ; < nl > + if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . JELLY _ BEAN ) { < nl > + icon . setBackground ( ShareMenuButtonFactory . get ( f . getColor ( ) , this ) ) ; < nl > + } else { < nl > + icon . setBackgroundDrawable ( ShareMenuButtonFactory . get ( f . getColor ( ) , this ) ) ; < nl > + } < nl > + icon . setImageResource ( f . getIcon ( ) ) ; < nl > + < nl > + View . OnClickListener l = new View . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( View v ) { < nl > + hideShare ( ) ; < nl > + f . getOnClickListener ( ) . onClick ( shareItem ) ; < nl > + } < nl > + } ; < nl > + icon . setOnClickListener ( l ) ; < nl > + < nl > + if ( i = = customFields . size ( ) - 1 ) { < nl > + menuIconToChange = icon ; < nl > + menuTitleToChange = title ; < nl > + defaultSendOcl = l ; < nl > + } < nl > + < nl > + row . addView ( shareItem , params ) ; < nl > + < nl > + first = ! first ; < nl > + } < nl > + < nl > + if ( menuIconToChange instanceof ImageView ) { < nl > + menuIconToChange . setTag ( R . id . icon , ( ( ImageView ) menuIconToChange ) . getDrawable ( ) ) ; < nl > + } < nl > + menuIconToChange . setTag ( R . id . background , menuIconToChange . getBackground ( ) ) ; < nl > + menuTitleToChange . setTag ( menuTitleToChange . getText ( ) . toString ( ) ) ; < nl > + } < nl > + < nl > + < nl > + < nl > handleIntent ( ) ; < nl > < nl > try { < nl > @ @ - 431 , 9 + 512 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > < nl > - final ImageButton shareMenuSend = ( ImageButton ) findViewById ( R . id . share _ send ) ; < nl > - shareMenuSend . setColorFilter ( Color . WHITE , PorterDuff . Mode . SRC _ IN ) ; < nl > - shareMenuSend . setOnClickListener ( new View . OnClickListener ( ) { < nl > + shareSendOcl = new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > Set < String > strings = fastShareAdapter . getSelectedVM ( ) . get ( ) ; < nl > @ @ - 443 , 7 + 522 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > fastShareAdapter . clearSelected ( ) ; < nl > hideShare ( ) ; < nl > } < nl > - } ) ; < nl > + } ; < nl > < nl > RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; < nl > if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { < nl > @ @ - 451 , 18 + 530 , 24 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; < nl > fastShare . setAdapter ( fastShareAdapter ) ; < nl > fastShare . setLayoutManager ( layoutManager ) ; < nl > + StateListDrawable background = ShareMenuButtonFactory . get ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) , ChatActivity . this ) ; < nl > < nl > fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { < nl > @ Override < nl > public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { < nl > if ( val . size ( ) > 0 ) { < nl > - shareContact . setVisibility ( View . INVISIBLE ) ; < nl > - shareMenuSend . setVisibility ( View . VISIBLE ) ; < nl > - contactText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; < nl > + menuIconToChange . setBackgroundDrawable ( background ) ; < nl > + menuIconToChange . setImageResource ( R . drawable . conv _ send ) ; < nl > + menuIconToChange . setColorFilter ( 0xffffffff , PorterDuff . Mode . MULTIPLY ) ; < nl > + menuTitleToChange . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; < nl > + menuIconToChange . setOnClickListener ( shareSendOcl ) ; < nl > } else { < nl > - shareContact . setVisibility ( View . VISIBLE ) ; < nl > - shareMenuSend . setVisibility ( View . INVISIBLE ) ; < nl > - contactText . setText ( getString ( R . string . share _ menu _ contact ) ) ; < nl > + < nl > + menuIconToChange . setBackgroundDrawable ( ( Drawable ) menuIconToChange . getTag ( R . id . background ) ) ; < nl > + menuIconToChange . setImageDrawable ( ( Drawable ) menuIconToChange . getTag ( R . id . icon ) ) ; < nl > + menuIconToChange . setColorFilter ( null ) ; < nl > + menuIconToChange . setOnClickListener ( defaultSendOcl ) ; < nl > + menuTitleToChange . setText ( ( String ) menuTitleToChange . getTag ( ) ) ; < nl > } < nl > } < nl > } ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java < nl > new file mode 100644 < nl > index 0000000 . . 221df62 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java < nl > @ @ - 0 , 0 + 1 , 33 @ @ < nl > + package im . actor . sdk . controllers . conversation ; < nl > + < nl > + import android . view . View ; < nl > + < nl > + public class ShareMenuField { < nl > + int icon ; < nl > + int color ; < nl > + String title ; < nl > + View . OnClickListener onClickListener ; < nl > + < nl > + public ShareMenuField ( int icon , int color , String title , View . OnClickListener onClickListener ) { < nl > + this . icon = icon ; < nl > + this . color = color ; < nl > + this . title = title ; < nl > + this . onClickListener = onClickListener ; < nl > + } < nl > + < nl > + public int getIcon ( ) { < nl > + return icon ; < nl > + } < nl > + < nl > + public int getColor ( ) { < nl > + return color ; < nl > + } < nl > + < nl > + public String getTitle ( ) { < nl > + return title ; < nl > + } < nl > + < nl > + public View . OnClickListener getOnClickListener ( ) { < nl > + return onClickListener ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java < nl > new file mode 100644 < nl > index 0000000 . . b7d1e79 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java < nl > @ @ - 0 , 0 + 1 , 28 @ @ < nl > + package im . actor . sdk . view ; < nl > + < nl > + import android . content . Context ; < nl > + import android . graphics . PorterDuff ; < nl > + import android . graphics . PorterDuffColorFilter ; < nl > + import android . graphics . drawable . GradientDrawable ; < nl > + import android . graphics . drawable . StateListDrawable ; < nl > + import android . util . StateSet ; < nl > + < nl > + import im . actor . sdk . ActorStyle ; < nl > + import im . actor . sdk . R ; < nl > + < nl > + public class ShareMenuButtonFactory { < nl > + public static StateListDrawable get ( int color , Context context ) { < nl > + GradientDrawable bg = ( GradientDrawable ) context . getResources ( ) . getDrawable ( R . drawable . circle _ btn _ bg ) ; < nl > + bg . setColorFilter ( new PorterDuffColorFilter ( color , PorterDuff . Mode . MULTIPLY ) ) ; < nl > + bg . setColor ( color ) ; < nl > + GradientDrawable bgPressed = ( GradientDrawable ) context . getResources ( ) . getDrawable ( R . drawable . circle _ btn _ bg ) ; < nl > + bgPressed . setColorFilter ( new PorterDuffColorFilter ( ActorStyle . getDarkenArgb ( color , 0 . 95 ) , PorterDuff . Mode . MULTIPLY ) ) ; < nl > + bgPressed . setColor ( ActorStyle . getDarkenArgb ( color , 0 . 95 ) ) ; < nl > + StateListDrawable states = new StateListDrawable ( ) ; < nl > + states . addState ( new int [ ] { android . R . attr . state _ pressed } , < nl > + bgPressed ) ; < nl > + states . addState ( StateSet . WILD _ CARD , < nl > + bg ) ; < nl > + return states ; < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > index 59f2e45 . . d4304f4 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml < nl > @ @ - 31 , 7 + 31 , 7 @ @ < nl > android : gravity = " center _ vertical " < nl > android : stretchColumns = " * " > < nl > < nl > - < TableRow > < nl > + < TableRow android : id = " @ + id / share _ row _ one " > < nl > < nl > < LinearLayout < nl > android : gravity = " center _ horizontal " < nl > @ @ - 93 , 7 + 93 , 7 @ @ < nl > < nl > < / TableRow > < nl > < nl > - < TableRow > < nl > + < TableRow android : id = " @ + id / share _ row _ two " > < nl > < nl > < LinearLayout < nl > android : layout _ width = " 0dp " < nl > @ @ - 153 , 24 + 153 , 14 @ @ < nl > android : layout _ width = " @ dimen / share _ btn _ size " < nl > android : layout _ height = " @ dimen / share _ btn _ size " > < nl > < nl > - < Button < nl > + < ImageView < nl > + android : clickable = " true " < nl > android : layout _ width = " @ dimen / share _ btn _ size " < nl > android : layout _ height = " @ dimen / share _ btn _ size " < nl > android : id = " @ + id / share _ contact " < nl > android : background = " @ drawable / share _ contact _ selector " / > < nl > < nl > < nl > - < ImageButton < nl > - android : visibility = " invisible " < nl > - android : paddingLeft = " 10dp " < nl > - android : paddingRight = " 5dp " < nl > - android : scaleType = " fitCenter " < nl > - android : layout _ width = " @ dimen / share _ btn _ size " < nl > - android : layout _ height = " @ dimen / share _ btn _ size " < nl > - android : id = " @ + id / share _ send " < nl > - android : src = " @ drawable / conv _ send " < nl > - android : background = " @ drawable / share _ send _ selector " / > < nl > - < nl > < / FrameLayout > < nl > < nl > < TextView < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml < nl > new file mode 100644 < nl > index 0000000 . . 0ce85d8 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml < nl > @ @ - 0 , 0 + 1 , 3 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : shape = " oval " > < / shape > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . aa1e9e4 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml < nl > @ @ - 0 , 0 + 1 , 27 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ weight = " 1 " < nl > + android : gravity = " center _ horizontal " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " vertical " > < nl > + < nl > + < FrameLayout < nl > + android : padding = " 5dp " < nl > + android : layout _ width = " @ dimen / share _ btn _ size " < nl > + android : layout _ height = " @ dimen / share _ btn _ size " > < nl > + < nl > + < ImageView < nl > + android : id = " @ + id / icon " < nl > + android : clickable = " true " < nl > + android : scaleType = " centerInside " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " / > < nl > + < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / title " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > + < / LinearLayout > < nl > \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 7b89f42 . . 1a6196a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > } < nl > } < nl > + super . onActivityResult ( requestCode , resultCode , data ) ; < nl > } < nl > < nl > / / Mentions < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > index d8717e9 . . e177ecd 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java < nl > @ @ - 1 , 16 + 1 , 19 @ @ < nl > package im . actor . sdk . controllers . conversation . view ; < nl > < nl > import android . content . Context ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Canvas ; < nl > import android . graphics . drawable . Drawable ; < nl > import android . util . AttributeSet ; < nl > import android . view . View ; < nl > < nl > import im . actor . sdk . R ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > < nl > public class ChatBackgroundView extends View { < nl > < nl > private Drawable background ; < nl > + SharedPreferences shp ; < nl > < nl > public ChatBackgroundView ( Context context ) { < nl > super ( context ) ; < nl > @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { < nl > < nl > public void bind ( ) { < nl > if ( background = = null ) { < nl > - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; < nl > + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; < nl > } < nl > + < nl > } < nl > < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > index b88785e . . 50d64ca 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java < nl > @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { < nl > ViewUtils . showView ( view , isAnimated , isSlow ) ; < nl > } < nl > < nl > + public void elevateView ( View view ) { < nl > + ViewUtils . elevateView ( view ) ; < nl > + } < nl > + < nl > + public void elevateView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . elevateView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + public void demoteView ( View view ) { < nl > + ViewUtils . demoteView ( view ) ; < nl > + } < nl > + < nl > + public void demoteView ( final View view , boolean isAnimated ) { < nl > + ViewUtils . demoteView ( view , isAnimated ) ; < nl > + } < nl > + < nl > + < nl > public void onClick ( View view , int id , final View . OnClickListener listener ) { < nl > onClick ( view . findViewById ( id ) , listener ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > index 04e80fd . . 8eba614 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java < nl > @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { < nl > nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; < nl > TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; < nl > tintImageView . setVisibility ( View . INVISIBLE ) ; < nl > - String value = nick ; < nl > + String value = " @ " . concat ( nick ) ; < nl > String title = getString ( R . string . nickname ) ; < nl > recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; < nl > ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > index a659507 . . d70cba7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java < nl > @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; < nl > import android . content . Context ; < nl > import android . content . DialogInterface ; < nl > import android . content . Intent ; < nl > + import android . content . SharedPreferences ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . net . Uri ; < nl > @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > import im . actor . sdk . controllers . fragment . help . HelpActivity ; < nl > import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . BackgroundPreviewView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > import im . actor . sdk . view . TintImageView ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > private int baseColor ; < nl > private CoverAvatarView avatarView ; < nl > + SharedPreferences shp ; < nl > + SharedPreferences . Editor ed ; < nl > < nl > @ Override < nl > public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { < nl > View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; < nl > + < nl > + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; < nl > + ed = shp . edit ( ) ; < nl > + < nl > baseColor = getResources ( ) . getColor ( R . color . primary ) ; < nl > final ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > final UserVM userModel = users ( ) . get ( myUid ( ) ) ; < nl > @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > < nl > bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; < nl > < nl > + / / Wallpaper < nl > + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; < nl > + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; < nl > + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; < nl > + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; < nl > + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + final View [ ] elevated = new View [ ] { null } ; < nl > + View . OnClickListener ocl = new View . OnClickListener ( ) { < nl > + < nl > + @ Override < nl > + public void onClick ( final View v ) { < nl > + if ( v ! = elevated [ 0 ] ) { < nl > + if ( elevated [ 0 ] ! = null ) { < nl > + demoteView ( elevated [ 0 ] ) ; < nl > + } < nl > + elevated [ 0 ] = v ; < nl > + elevateView ( v ) ; < nl > + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; < nl > + ed . commit ( ) ; < nl > + } < nl > + } < nl > + } ; < nl > + for ( int i = 0 ; i < 4 ; i + + ) { < nl > + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; < nl > + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; < nl > + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; < nl > + bckgrnd . bind ( i ) ; < nl > + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; < nl > + frame . setTag ( i ) ; < nl > + frame . setOnClickListener ( ocl ) ; < nl > + frame . addView ( bckgrnd ) ; < nl > + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; < nl > + < nl > + if ( i = = selectedWallpaper ) { < nl > + elevateView ( frame , false ) ; < nl > + elevated [ 0 ] = frame ; < nl > + } < nl > + } < nl > + < nl > view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > public void onClick ( View v ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > index 43b6b07 . . 81b27d3 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java < nl > @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; < nl > import android . view . View ; < nl > import android . view . animation . AlphaAnimation ; < nl > import android . view . animation . Animation ; < nl > + import android . view . animation . ScaleAnimation ; < nl > import android . view . animation . Transformation ; < nl > import android . widget . AbsListView ; < nl > < nl > @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { < nl > < nl > < nl > } < nl > + < nl > + public static void elevateView ( final View view ) { < nl > + elevateView ( view , true ) ; < nl > + } < nl > + < nl > + public static void elevateView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + < nl > + } < nl > + < nl > + public static void demoteView ( final View view ) { < nl > + demoteView ( view , true ) ; < nl > + } < nl > + < nl > + public static void demoteView ( final View view , boolean isAnimated ) { < nl > + if ( view = = null ) { < nl > + return ; < nl > + } < nl > + < nl > + if ( isAnimated ) { < nl > + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; < nl > + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; < nl > + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; < nl > + scaleAnimation . setFillAfter ( true ) ; < nl > + view . clearAnimation ( ) ; < nl > + view . startAnimation ( scaleAnimation ) ; < nl > + } < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > new file mode 100644 < nl > index 0000000 . . fb7ae5c < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java < nl > @ @ - 0 , 0 + 1 , 79 @ @ < nl > + package im . actor . sdk . view ; < nl > + < nl > + import android . content . Context ; < nl > + import android . net . Uri ; < nl > + import android . util . AttributeSet ; < nl > + < nl > + import com . facebook . common . util . UriUtil ; < nl > + import com . facebook . drawee . backends . pipeline . Fresco ; < nl > + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchy ; < nl > + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; < nl > + import com . facebook . drawee . view . SimpleDraweeView ; < nl > + import com . facebook . imagepipeline . common . ResizeOptions ; < nl > + import com . facebook . imagepipeline . request . ImageRequest ; < nl > + import com . facebook . imagepipeline . request . ImageRequestBuilder ; < nl > + < nl > + import im . actor . sdk . R ; < nl > + < nl > + public class BackgroundPreviewView extends SimpleDraweeView { < nl > + < nl > + private int width ; < nl > + private int height ; < nl > + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; < nl > + < nl > + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { < nl > + super ( context , hierarchy ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context ) { < nl > + super ( context ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { < nl > + super ( context , attrs ) ; < nl > + } < nl > + < nl > + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { < nl > + super ( context , attrs , defStyle ) ; < nl > + } < nl > + < nl > + public void init ( int width , int height ) { < nl > + this . width = width ; < nl > + this . height = height ; < nl > + < nl > + GenericDraweeHierarchyBuilder builder = < nl > + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; < nl > + < nl > + GenericDraweeHierarchy hierarchy = builder < nl > + . setFadeDuration ( 200 ) < nl > + . build ( ) ; < nl > + setHierarchy ( hierarchy ) ; < nl > + } < nl > + < nl > + public void bind ( int i ) { < nl > + int bkgrnd = getBackground ( i ) ; < nl > + Uri uri = new Uri . Builder ( ) < nl > + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) < nl > + . path ( String . valueOf ( bkgrnd ) ) < nl > + . build ( ) ; < nl > + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) < nl > + . setResizeOptions ( new ResizeOptions ( width , height ) ) < nl > + . build ( ) ; < nl > + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) < nl > + . setOldController ( getController ( ) ) < nl > + . setImageRequest ( request ) < nl > + . build ( ) ; < nl > + setController ( controller ) ; < nl > + < nl > + } < nl > + < nl > + < nl > + public static int getBackground ( int i ) { < nl > + if ( i > = 0 & & BACKGROUNDS . length > i ) { < nl > + return BACKGROUNDS [ i ] ; < nl > + } else { < nl > + return R . drawable . img _ chat _ background _ default ; < nl > + } < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > index fa384b2 . . f688b72 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > @ @ - 282 , 6 + 282 , 56 @ @ < nl > < / LinearLayout > < nl > < nl > < FrameLayout < nl > + android : id = " @ + id / wallpaperDivider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 16dp " < nl > + android : background = " @ color / bg _ backyard " > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 4dp " < nl > + android : layout _ gravity = " top " < nl > + android : background = " @ drawable / card _ shadow _ bottom " / > < nl > + < nl > + < View < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 1dp " < nl > + android : layout _ gravity = " bottom " < nl > + android : background = " @ drawable / card _ shadow _ top " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / settings _ wallpaper _ title " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 48dp " < nl > + android : gravity = " center _ vertical | left " < nl > + android : paddingLeft = " 72dp " < nl > + android : text = " @ string / wallpaper " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < HorizontalScrollView < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : requiresFadingEdge = " none " < nl > + android : scrollbars = " none " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / background _ container " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " horizontal " > < nl > + < nl > + < View < nl > + android : layout _ width = " 72dp " < nl > + android : layout _ height = " 200dp " < nl > + android : background = " @ android : color / transparent " / > < nl > + < nl > + < nl > + < / LinearLayout > < nl > + < / HorizontalScrollView > < nl > + < nl > + < nl > + < FrameLayout < nl > android : id = " @ + id / settings _ bottom _ container " < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " / > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > index 3c3350b . . 9ad8001 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml < nl > @ @ - 153 , 6 + 153 , 7 @ @ < nl > < string name = " nickname _ change " > И з м е н и т ь н и к < / string > < nl > < string name = " about _ user _ me " > О б о м н е < / string > < nl > < string name = " about _ user " > О п о л ь з о в а т е л е < / string > < nl > + < string name = " wallpaper " > О б о и < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 2270a93 . . 3a7761d 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 157 , 6 + 157 , 7 @ @ < nl > < string name = " nickname _ edittext _ hint " > Enter your Username < / string > < nl > < string name = " about _ user _ me " > About me < / string > < nl > < string name = " about _ user " > About user < / string > < nl > + < string name = " wallpaper " > Wallpaper < / string > < nl > < nl > < ! - - Profile controls - - > < nl > < string name = " phone _ menu _ call " > Call { 0 } < / string >

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index 5347bc6 . . 702f6f7 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 5 , 11 + 5 , 15 @ @ import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . CheckBox ; 
 + import android . widget . Toast ; 
 + 
 + import java . util . ArrayList ; 
 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKApplication ; 
 import im . actor . sdk . ActorStyle ; 
 import im . actor . sdk . BaseActorSDKDelegate ; 
 + import im . actor . sdk . controllers . conversation . ShareMenuField ; 
 import im . actor . sdk . controllers . group . GroupInfoFragment ; 
 import im . actor . sdk . controllers . profile . ProfileFragment ; 
 import im . actor . sdk . controllers . settings . ActorSettingsCategory ; 
 @ @ - 24 , 7 + 28 , 7 @ @ public class Application extends ActorSDKApplication { 
 
 @ Override 
 public void onConfigureActorSDK ( ) { 
 - / / ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 + ActorSDK . sharedActor ( ) . setDelegate ( new ActorSDKDelegate ( ) ) ; 
 ActorSDK . sharedActor ( ) . setPushId ( 209133700967L ) ; 
 
 ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 @ @ - 71 , 6 + 75 , 19 @ @ public class Application extends ActorSDKApplication { 
 / / return null ; 
 / / } 
 
 + 
 + @ Override 
 + public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { 
 + ArrayList < ShareMenuField > shareMenuFields = new ArrayList < > ( ) ; 
 + shareMenuFields . add ( new ShareMenuField ( R . drawable . conv _ location _ icon , ActorSDK . sharedActor ( ) . style . getMainColor ( ) , " lol " , new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + Toast . makeText ( v . getContext ( ) , " Hey " , Toast . LENGTH _ LONG ) . show ( ) ; 
 + } 
 + } ) ) ; 
 + return shareMenuFields ; 
 + } 
 + 
 @ Override 
 public BaseActorProfileActivity getProfileIntent ( int uid ) { 
 return new BaseActorProfileActivity ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index 8670147 . . ee1612b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 5 , 9 + 5 , 12 @ @ import android . net . Uri ; 
 import android . view . ViewGroup ; 
 import android . widget . TableLayout ; 
 
 + import java . util . ArrayList ; 
 + 
 import im . actor . core . entity . Peer ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . conversation . ShareMenuField ; 
 import im . actor . sdk . controllers . root . MainPhoneController ; 
 import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 import im . actor . sdk . controllers . conversation . MessagesAdapter ; 
 @ @ - 178 , 4 + 181 , 6 @ @ public interface ActorSDKDelegate { 
 * @ param shareMenu share menu 
 * / 
 void onShareMenuCreated ( TableLayout shareMenu ) ; 
 + 
 + ArrayList < ShareMenuField > addCustomShareMenuFields ( ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 098dc0f . . 23f344c 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 6 , 10 + 6 , 13 @ @ import android . provider . Settings ; 
 import android . view . ViewGroup ; 
 import android . widget . TableLayout ; 
 
 + import java . util . ArrayList ; 
 + 
 import im . actor . core . AuthState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . conversation . ShareMenuField ; 
 import im . actor . sdk . controllers . root . MainPhoneController ; 
 import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 import im . actor . sdk . controllers . conversation . MessagesAdapter ; 
 @ @ - 206 , 6 + 209 , 11 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 
 } 
 
 + @ Override 
 + public ArrayList < ShareMenuField > addCustomShareMenuFields ( ) { 
 + return null ; 
 + } 
 + 
 / / 
 / / Notifications 
 / / 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index a1b8524 . . b77ffde 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 14 , 6 + 14 , 7 @ @ import android . graphics . Color ; 
 import android . graphics . PorterDuff ; 
 import android . graphics . PorterDuffColorFilter ; 
 import android . graphics . drawable . Drawable ; 
 + import android . graphics . drawable . StateListDrawable ; 
 import android . media . MediaScannerConnection ; 
 import android . net . Uri ; 
 import android . os . Build ; 
 @ @ - 39 , 6 + 40 , 7 @ @ import android . view . Menu ; 
 import android . view . MenuItem ; 
 import android . view . MotionEvent ; 
 import android . view . View ; 
 + import android . view . ViewGroup ; 
 import android . view . animation . AlphaAnimation ; 
 import android . view . animation . Animation ; 
 import android . view . animation . TranslateAnimation ; 
 @ @ - 46 , 7 + 48 , 9 @ @ import android . widget . AdapterView ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . LinearLayout ; 
 import android . widget . TableLayout ; 
 + import android . widget . TableRow ; 
 import android . widget . TextView ; 
 import android . widget . Toast ; 
 
 @ @ - 85 , 6 + 89 , 7 @ @ import im . actor . sdk . intents . ActorIntent ; 
 import im . actor . sdk . util . Randoms ; 
 import im . actor . sdk . util . Screen ; 
 import im . actor . core . utils . GalleryScannerActor ; 
 + import im . actor . sdk . view . ShareMenuButtonFactory ; 
 import im . actor . sdk . view . TintDrawable ; 
 import im . actor . sdk . view . adapters . HolderAdapter ; 
 import im . actor . sdk . view . adapters . RecyclerListView ; 
 @ @ - 230 , 6 + 235 , 10 @ @ public class ChatActivity extends ActorEditTextActivity { 
 private boolean isBot = false ; 
 private View emptyBotSend ; 
 private TextView emptyBotHint ; 
 + private ImageView menuIconToChange ; 
 + private TextView menuTitleToChange ; 
 + private View . OnClickListener shareSendOcl ; 
 + private View . OnClickListener defaultSendOcl ; 
 
 public static Intent build ( Peer peer , boolean compose , Context context ) { 
 final Intent intent = new Intent ( context , ChatActivity . class ) ; 
 @ @ - 348 , 7 + 357 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } ) ; 
 
 final TextView contactText = ( TextView ) findViewById ( R . id . contact _ text ) ; 
 - final View shareContact = findViewById ( R . id . share _ contact ) ; 
 + final ImageView shareContact = ( ImageView ) findViewById ( R . id . share _ contact ) ; 
 findViewById ( R . id . share _ hide ) . setVisibility ( View . GONE ) ; 
 
 View . OnClickListener shareMenuOCL = new View . OnClickListener ( ) { 
 @ @ - 409 , 6 + 418 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 hideShare ( ) ; 
 } 
 } ; 
 + defaultSendOcl = shareMenuOCL ; 
 
 findViewById ( R . id . share _ gallery ) . setOnClickListener ( shareMenuOCL ) ; 
 findViewById ( R . id . share _ video ) . setOnClickListener ( shareMenuOCL ) ; 
 @ @ - 420 , 6 + 430 , 77 @ @ public class ChatActivity extends ActorEditTextActivity { 
 shareLocation . setOnClickListener ( shareMenuOCL ) ; 
 ActorSDK . sharedActor ( ) . getDelegate ( ) . onShareMenuCreated ( shareMenu ) ; 
 
 + menuIconToChange = shareContact ; 
 + menuTitleToChange = contactText ; 
 + 
 + ArrayList < ShareMenuField > customFields = ActorSDK . sharedActor ( ) . getDelegate ( ) . addCustomShareMenuFields ( ) ; 
 + 
 + if ( customFields ! = null & & customFields . size ( ) > 0 ) { 
 + if ( customFields . size ( ) % 2 ! = 0 ) { 
 + customFields . add ( new ShareMenuField ( R . drawable . attach _ hide2 , 
 + / / ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) , 
 + Color . RED , 
 + " " , 
 + new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + 
 + } 
 + } ) ) ; 
 + } 
 + TableRow rowOne = ( TableRow ) shareMenu . findViewById ( R . id . share _ row _ one ) ; 
 + TableRow rowTwo = ( TableRow ) shareMenu . findViewById ( R . id . share _ row _ two ) ; 
 + boolean first = true ; 
 + TableRow row ; 
 + TableRow . LayoutParams params = new TableRow . LayoutParams ( 0 , ViewGroup . LayoutParams . WRAP _ CONTENT , 1 ) ; 
 + 
 + for ( int i = 0 ; i < customFields . size ( ) ; i + + ) { 
 + ShareMenuField f = customFields . get ( i ) ; 
 + row = first ? rowOne : rowTwo ; 
 + 
 + View shareItem = getLayoutInflater ( ) . inflate ( R . layout . share _ menu _ item , null ) ; 
 + 
 + TextView title = ( TextView ) shareItem . findViewById ( R . id . title ) ; 
 + title . setText ( f . getTitle ( ) ) ; 
 + 
 + ImageView icon = ( ImageView ) shareItem . findViewById ( R . id . icon ) ; 
 + icon . setClickable ( true ) ; 
 + if ( Build . VERSION . SDK _ INT > = Build . VERSION _ CODES . JELLY _ BEAN ) { 
 + icon . setBackground ( ShareMenuButtonFactory . get ( f . getColor ( ) , this ) ) ; 
 + } else { 
 + icon . setBackgroundDrawable ( ShareMenuButtonFactory . get ( f . getColor ( ) , this ) ) ; 
 + } 
 + icon . setImageResource ( f . getIcon ( ) ) ; 
 + 
 + View . OnClickListener l = new View . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( View v ) { 
 + hideShare ( ) ; 
 + f . getOnClickListener ( ) . onClick ( shareItem ) ; 
 + } 
 + } ; 
 + icon . setOnClickListener ( l ) ; 
 + 
 + if ( i = = customFields . size ( ) - 1 ) { 
 + menuIconToChange = icon ; 
 + menuTitleToChange = title ; 
 + defaultSendOcl = l ; 
 + } 
 + 
 + row . addView ( shareItem , params ) ; 
 + 
 + first = ! first ; 
 + } 
 + 
 + if ( menuIconToChange instanceof ImageView ) { 
 + menuIconToChange . setTag ( R . id . icon , ( ( ImageView ) menuIconToChange ) . getDrawable ( ) ) ; 
 + } 
 + menuIconToChange . setTag ( R . id . background , menuIconToChange . getBackground ( ) ) ; 
 + menuTitleToChange . setTag ( menuTitleToChange . getText ( ) . toString ( ) ) ; 
 + } 
 + 
 + 
 + 
 handleIntent ( ) ; 
 
 try { 
 @ @ - 431 , 9 + 512 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 
 - final ImageButton shareMenuSend = ( ImageButton ) findViewById ( R . id . share _ send ) ; 
 - shareMenuSend . setColorFilter ( Color . WHITE , PorterDuff . Mode . SRC _ IN ) ; 
 - shareMenuSend . setOnClickListener ( new View . OnClickListener ( ) { 
 + shareSendOcl = new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 Set < String > strings = fastShareAdapter . getSelectedVM ( ) . get ( ) ; 
 @ @ - 443 , 7 + 522 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 fastShareAdapter . clearSelected ( ) ; 
 hideShare ( ) ; 
 } 
 - } ) ; 
 + } ; 
 
 RecyclerView fastShare = ( RecyclerView ) findViewById ( R . id . fast _ share ) ; 
 if ( ActorSDK . sharedActor ( ) . isFastShareEnabled ( ) ) { 
 @ @ - 451 , 18 + 530 , 24 @ @ public class ChatActivity extends ActorEditTextActivity { 
 LinearLayoutManager layoutManager = new LinearLayoutManager ( this , LinearLayoutManager . HORIZONTAL , false ) ; 
 fastShare . setAdapter ( fastShareAdapter ) ; 
 fastShare . setLayoutManager ( layoutManager ) ; 
 + StateListDrawable background = ShareMenuButtonFactory . get ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) , ChatActivity . this ) ; 
 
 fastShareAdapter . getSelectedVM ( ) . subscribe ( new ValueChangedListener < Set < String > > ( ) { 
 @ Override 
 public void onChanged ( Set < String > val , Value < Set < String > > valueModel ) { 
 if ( val . size ( ) > 0 ) { 
 - shareContact . setVisibility ( View . INVISIBLE ) ; 
 - shareMenuSend . setVisibility ( View . VISIBLE ) ; 
 - contactText . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; 
 + menuIconToChange . setBackgroundDrawable ( background ) ; 
 + menuIconToChange . setImageResource ( R . drawable . conv _ send ) ; 
 + menuIconToChange . setColorFilter ( 0xffffffff , PorterDuff . Mode . MULTIPLY ) ; 
 + menuTitleToChange . setText ( getString ( R . string . chat _ doc _ send ) + " ( " + val . size ( ) + " ) " ) ; 
 + menuIconToChange . setOnClickListener ( shareSendOcl ) ; 
 } else { 
 - shareContact . setVisibility ( View . VISIBLE ) ; 
 - shareMenuSend . setVisibility ( View . INVISIBLE ) ; 
 - contactText . setText ( getString ( R . string . share _ menu _ contact ) ) ; 
 + 
 + menuIconToChange . setBackgroundDrawable ( ( Drawable ) menuIconToChange . getTag ( R . id . background ) ) ; 
 + menuIconToChange . setImageDrawable ( ( Drawable ) menuIconToChange . getTag ( R . id . icon ) ) ; 
 + menuIconToChange . setColorFilter ( null ) ; 
 + menuIconToChange . setOnClickListener ( defaultSendOcl ) ; 
 + menuTitleToChange . setText ( ( String ) menuTitleToChange . getTag ( ) ) ; 
 } 
 } 
 } ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java 
 new file mode 100644 
 index 0000000 . . 221df62 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ShareMenuField . java 
 @ @ - 0 , 0 + 1 , 33 @ @ 
 + package im . actor . sdk . controllers . conversation ; 
 + 
 + import android . view . View ; 
 + 
 + public class ShareMenuField { 
 + int icon ; 
 + int color ; 
 + String title ; 
 + View . OnClickListener onClickListener ; 
 + 
 + public ShareMenuField ( int icon , int color , String title , View . OnClickListener onClickListener ) { 
 + this . icon = icon ; 
 + this . color = color ; 
 + this . title = title ; 
 + this . onClickListener = onClickListener ; 
 + } 
 + 
 + public int getIcon ( ) { 
 + return icon ; 
 + } 
 + 
 + public int getColor ( ) { 
 + return color ; 
 + } 
 + 
 + public String getTitle ( ) { 
 + return title ; 
 + } 
 + 
 + public View . OnClickListener getOnClickListener ( ) { 
 + return onClickListener ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java 
 new file mode 100644 
 index 0000000 . . b7d1e79 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / ShareMenuButtonFactory . java 
 @ @ - 0 , 0 + 1 , 28 @ @ 
 + package im . actor . sdk . view ; 
 + 
 + import android . content . Context ; 
 + import android . graphics . PorterDuff ; 
 + import android . graphics . PorterDuffColorFilter ; 
 + import android . graphics . drawable . GradientDrawable ; 
 + import android . graphics . drawable . StateListDrawable ; 
 + import android . util . StateSet ; 
 + 
 + import im . actor . sdk . ActorStyle ; 
 + import im . actor . sdk . R ; 
 + 
 + public class ShareMenuButtonFactory { 
 + public static StateListDrawable get ( int color , Context context ) { 
 + GradientDrawable bg = ( GradientDrawable ) context . getResources ( ) . getDrawable ( R . drawable . circle _ btn _ bg ) ; 
 + bg . setColorFilter ( new PorterDuffColorFilter ( color , PorterDuff . Mode . MULTIPLY ) ) ; 
 + bg . setColor ( color ) ; 
 + GradientDrawable bgPressed = ( GradientDrawable ) context . getResources ( ) . getDrawable ( R . drawable . circle _ btn _ bg ) ; 
 + bgPressed . setColorFilter ( new PorterDuffColorFilter ( ActorStyle . getDarkenArgb ( color , 0 . 95 ) , PorterDuff . Mode . MULTIPLY ) ) ; 
 + bgPressed . setColor ( ActorStyle . getDarkenArgb ( color , 0 . 95 ) ) ; 
 + StateListDrawable states = new StateListDrawable ( ) ; 
 + states . addState ( new int [ ] { android . R . attr . state _ pressed } , 
 + bgPressed ) ; 
 + states . addState ( StateSet . WILD _ CARD , 
 + bg ) ; 
 + return states ; 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 index 59f2e45 . . d4304f4 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res - material / layout / share _ menu . xml 
 @ @ - 31 , 7 + 31 , 7 @ @ 
 android : gravity = " center _ vertical " 
 android : stretchColumns = " * " > 
 
 - < TableRow > 
 + < TableRow android : id = " @ + id / share _ row _ one " > 
 
 < LinearLayout 
 android : gravity = " center _ horizontal " 
 @ @ - 93 , 7 + 93 , 7 @ @ 
 
 < / TableRow > 
 
 - < TableRow > 
 + < TableRow android : id = " @ + id / share _ row _ two " > 
 
 < LinearLayout 
 android : layout _ width = " 0dp " 
 @ @ - 153 , 24 + 153 , 14 @ @ 
 android : layout _ width = " @ dimen / share _ btn _ size " 
 android : layout _ height = " @ dimen / share _ btn _ size " > 
 
 - < Button 
 + < ImageView 
 + android : clickable = " true " 
 android : layout _ width = " @ dimen / share _ btn _ size " 
 android : layout _ height = " @ dimen / share _ btn _ size " 
 android : id = " @ + id / share _ contact " 
 android : background = " @ drawable / share _ contact _ selector " / > 
 
 
 - < ImageButton 
 - android : visibility = " invisible " 
 - android : paddingLeft = " 10dp " 
 - android : paddingRight = " 5dp " 
 - android : scaleType = " fitCenter " 
 - android : layout _ width = " @ dimen / share _ btn _ size " 
 - android : layout _ height = " @ dimen / share _ btn _ size " 
 - android : id = " @ + id / share _ send " 
 - android : src = " @ drawable / conv _ send " 
 - android : background = " @ drawable / share _ send _ selector " / > 
 - 
 < / FrameLayout > 
 
 < TextView 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml 
 new file mode 100644 
 index 0000000 . . 0ce85d8 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / drawable / circle _ btn _ bg . xml 
 @ @ - 0 , 0 + 1 , 3 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < shape xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : shape = " oval " > < / shape > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml 
 new file mode 100644 
 index 0000000 . . aa1e9e4 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / share _ menu _ item . xml 
 @ @ - 0 , 0 + 1 , 27 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " 0dp " 
 + android : layout _ weight = " 1 " 
 + android : gravity = " center _ horizontal " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " vertical " > 
 + 
 + < FrameLayout 
 + android : padding = " 5dp " 
 + android : layout _ width = " @ dimen / share _ btn _ size " 
 + android : layout _ height = " @ dimen / share _ btn _ size " > 
 + 
 + < ImageView 
 + android : id = " @ + id / icon " 
 + android : clickable = " true " 
 + android : scaleType = " centerInside " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " / > 
 + 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / title " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 + < / LinearLayout > 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 7b89f42 . . 1a6196a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 605 , 6 + 605 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 } 
 } 
 + super . onActivityResult ( requestCode , resultCode , data ) ; 
 } 
 
 / / Mentions 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 index d8717e9 . . e177ecd 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / view / ChatBackgroundView . java 
 @ @ - 1 , 16 + 1 , 19 @ @ 
 package im . actor . sdk . controllers . conversation . view ; 
 
 import android . content . Context ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Canvas ; 
 import android . graphics . drawable . Drawable ; 
 import android . util . AttributeSet ; 
 import android . view . View ; 
 
 import im . actor . sdk . R ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 
 public class ChatBackgroundView extends View { 
 
 private Drawable background ; 
 + SharedPreferences shp ; 
 
 public ChatBackgroundView ( Context context ) { 
 super ( context ) ; 
 @ @ - 33 , 8 + 36 , 10 @ @ public class ChatBackgroundView extends View { 
 
 public void bind ( ) { 
 if ( background = = null ) { 
 - background = getResources ( ) . getDrawable ( R . drawable . img _ chat _ background _ default ) ; 
 + shp = getContext ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + background = getResources ( ) . getDrawable ( BackgroundPreviewView . getBackground ( shp . getInt ( " wallpaper " , R . drawable . img _ chat _ background _ default ) ) ) ; 
 } 
 + 
 } 
 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 index b88785e . . 50d64ca 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / BaseFragment . java 
 @ @ - 54 , 6 + 54 , 23 @ @ public class BaseFragment extends BinderCompatFragment { 
 ViewUtils . showView ( view , isAnimated , isSlow ) ; 
 } 
 
 + public void elevateView ( View view ) { 
 + ViewUtils . elevateView ( view ) ; 
 + } 
 + 
 + public void elevateView ( final View view , boolean isAnimated ) { 
 + ViewUtils . elevateView ( view , isAnimated ) ; 
 + } 
 + 
 + public void demoteView ( View view ) { 
 + ViewUtils . demoteView ( view ) ; 
 + } 
 + 
 + public void demoteView ( final View view , boolean isAnimated ) { 
 + ViewUtils . demoteView ( view , isAnimated ) ; 
 + } 
 + 
 + 
 public void onClick ( View view , int id , final View . OnClickListener listener ) { 
 onClick ( view . findViewById ( id ) , listener ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 index 04e80fd . . 8eba614 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / profile / ProfileFragment . java 
 @ @ - 127 , 7 + 127 , 7 @ @ public class ProfileFragment extends BaseFragment { 
 nickTitle . setTextColor ( style . getTextSecondaryColor ( ) ) ; 
 TintImageView tintImageView = ( TintImageView ) recordView . findViewById ( R . id . recordIcon ) ; 
 tintImageView . setVisibility ( View . INVISIBLE ) ; 
 - String value = nick ; 
 + String value = " @ " . concat ( nick ) ; 
 String title = getString ( R . string . nickname ) ; 
 recordView . findViewById ( R . id . divider ) . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getDividerColor ( ) ) ; 
 ( ( TextView ) recordView . findViewById ( R . id . value ) ) . setText ( value ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 index a659507 . . d70cba7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / fragment / settings / BaseActorSettingsFragment . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import android . content . ClipboardManager ; 
 import android . content . Context ; 
 import android . content . DialogInterface ; 
 import android . content . Intent ; 
 + import android . content . SharedPreferences ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . net . Uri ; 
 @ @ - 43 , 6 + 44 , 7 @ @ import im . actor . sdk . controllers . fragment . BaseFragment ; 
 import im . actor . sdk . controllers . fragment . help . HelpActivity ; 
 import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . BackgroundPreviewView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 import im . actor . sdk . view . TintImageView ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 @ @ - 56 , 10 + 58 , 16 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 private int baseColor ; 
 private CoverAvatarView avatarView ; 
 + SharedPreferences shp ; 
 + SharedPreferences . Editor ed ; 
 
 @ Override 
 public View onCreateView ( final LayoutInflater inflater , ViewGroup container , Bundle savedInstanceState ) { 
 View view = inflater . inflate ( R . layout . fragment _ settings , container , false ) ; 
 + 
 + shp = getActivity ( ) . getSharedPreferences ( " wallpaper " , Context . MODE _ PRIVATE ) ; 
 + ed = shp . edit ( ) ; 
 + 
 baseColor = getResources ( ) . getColor ( R . color . primary ) ; 
 final ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 final UserVM userModel = users ( ) . get ( myUid ( ) ) ; 
 @ @ - 343 , 6 + 351 , 45 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 
 bind ( avatarView , users ( ) . get ( myUid ( ) ) . getAvatar ( ) ) ; 
 
 + / / Wallpaper 
 + int selectedWallpaper = shp . getInt ( " wallpaper " , 0 ) ; 
 + LinearLayout wallpaperContainer = ( LinearLayout ) view . findViewById ( R . id . background _ container ) ; 
 + wallpaperContainer . setBackgroundColor ( style . getMainBackgroundColor ( ) ) ; 
 + ( ( TextView ) view . findViewById ( R . id . settings _ wallpaper _ title ) ) . setTextColor ( style . getSettingsCategoryTextColor ( ) ) ; 
 + view . findViewById ( R . id . wallpaperDivider ) . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + final View [ ] elevated = new View [ ] { null } ; 
 + View . OnClickListener ocl = new View . OnClickListener ( ) { 
 + 
 + @ Override 
 + public void onClick ( final View v ) { 
 + if ( v ! = elevated [ 0 ] ) { 
 + if ( elevated [ 0 ] ! = null ) { 
 + demoteView ( elevated [ 0 ] ) ; 
 + } 
 + elevated [ 0 ] = v ; 
 + elevateView ( v ) ; 
 + ed . putInt ( " wallpaper " , ( Integer ) v . getTag ( ) ) ; 
 + ed . commit ( ) ; 
 + } 
 + } 
 + } ; 
 + for ( int i = 0 ; i < 4 ; i + + ) { 
 + FrameLayout frame = new FrameLayout ( getActivity ( ) ) ; 
 + BackgroundPreviewView bckgrnd = new BackgroundPreviewView ( getActivity ( ) ) ; 
 + bckgrnd . init ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ; 
 + bckgrnd . bind ( i ) ; 
 + bckgrnd . setPadding ( Screen . dp ( 5 ) , Screen . dp ( 10 ) , Screen . dp ( 5 ) , Screen . dp ( 20 ) ) ; 
 + frame . setTag ( i ) ; 
 + frame . setOnClickListener ( ocl ) ; 
 + frame . addView ( bckgrnd ) ; 
 + wallpaperContainer . addView ( frame , new LinearLayout . LayoutParams ( Screen . dp ( 100 ) , Screen . dp ( 200 ) ) ) ; 
 + 
 + if ( i = = selectedWallpaper ) { 
 + elevateView ( frame , false ) ; 
 + elevated [ 0 ] = frame ; 
 + } 
 + } 
 + 
 view . findViewById ( R . id . avatar ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 public void onClick ( View v ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 index 43b6b07 . . 81b27d3 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / util / ViewUtils . java 
 @ @ - 3 , 6 + 3 , 7 @ @ package im . actor . sdk . util ; 
 import android . view . View ; 
 import android . view . animation . AlphaAnimation ; 
 import android . view . animation . Animation ; 
 + import android . view . animation . ScaleAnimation ; 
 import android . view . animation . Transformation ; 
 import android . widget . AbsListView ; 
 
 @ @ - 147 , 4 + 148 , 43 @ @ public class ViewUtils { 
 
 
 } 
 + 
 + public static void elevateView ( final View view ) { 
 + elevateView ( view , true ) ; 
 + } 
 + 
 + public static void elevateView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 0f , 1 . 1f , 1 . 0f , 1 . 1f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + 
 + } 
 + 
 + public static void demoteView ( final View view ) { 
 + demoteView ( view , true ) ; 
 + } 
 + 
 + public static void demoteView ( final View view , boolean isAnimated ) { 
 + if ( view = = null ) { 
 + return ; 
 + } 
 + 
 + if ( isAnimated ) { 
 + ScaleAnimation scaleAnimation = new ScaleAnimation ( 1 . 1f , 1 . 0f , 1 . 1f , 1 . 0f , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 , Animation . RELATIVE _ TO _ SELF , ( float ) 0 . 5 ) ; 
 + scaleAnimation . setDuration ( isAnimated ? 150 : 0 ) ; 
 + scaleAnimation . setInterpolator ( MaterialInterpolator . getInstance ( ) ) ; 
 + scaleAnimation . setFillAfter ( true ) ; 
 + view . clearAnimation ( ) ; 
 + view . startAnimation ( scaleAnimation ) ; 
 + } 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 new file mode 100644 
 index 0000000 . . fb7ae5c 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / view / BackgroundPreviewView . java 
 @ @ - 0 , 0 + 1 , 79 @ @ 
 + package im . actor . sdk . view ; 
 + 
 + import android . content . Context ; 
 + import android . net . Uri ; 
 + import android . util . AttributeSet ; 
 + 
 + import com . facebook . common . util . UriUtil ; 
 + import com . facebook . drawee . backends . pipeline . Fresco ; 
 + import com . facebook . drawee . backends . pipeline . PipelineDraweeController ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchy ; 
 + import com . facebook . drawee . generic . GenericDraweeHierarchyBuilder ; 
 + import com . facebook . drawee . view . SimpleDraweeView ; 
 + import com . facebook . imagepipeline . common . ResizeOptions ; 
 + import com . facebook . imagepipeline . request . ImageRequest ; 
 + import com . facebook . imagepipeline . request . ImageRequestBuilder ; 
 + 
 + import im . actor . sdk . R ; 
 + 
 + public class BackgroundPreviewView extends SimpleDraweeView { 
 + 
 + private int width ; 
 + private int height ; 
 + private static final int [ ] BACKGROUNDS = new int [ ] { R . drawable . img _ chat _ background _ default , R . drawable . bg _ 8 , R . drawable . bg _ 2 , R . drawable . bg _ 1 } ; 
 + 
 + public BackgroundPreviewView ( Context context , GenericDraweeHierarchy hierarchy ) { 
 + super ( context , hierarchy ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context ) { 
 + super ( context ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs ) { 
 + super ( context , attrs ) ; 
 + } 
 + 
 + public BackgroundPreviewView ( Context context , AttributeSet attrs , int defStyle ) { 
 + super ( context , attrs , defStyle ) ; 
 + } 
 + 
 + public void init ( int width , int height ) { 
 + this . width = width ; 
 + this . height = height ; 
 + 
 + GenericDraweeHierarchyBuilder builder = 
 + new GenericDraweeHierarchyBuilder ( getResources ( ) ) ; 
 + 
 + GenericDraweeHierarchy hierarchy = builder 
 + . setFadeDuration ( 200 ) 
 + . build ( ) ; 
 + setHierarchy ( hierarchy ) ; 
 + } 
 + 
 + public void bind ( int i ) { 
 + int bkgrnd = getBackground ( i ) ; 
 + Uri uri = new Uri . Builder ( ) 
 + . scheme ( UriUtil . LOCAL _ RESOURCE _ SCHEME ) 
 + . path ( String . valueOf ( bkgrnd ) ) 
 + . build ( ) ; 
 + ImageRequest request = ImageRequestBuilder . newBuilderWithSource ( uri ) 
 + . setResizeOptions ( new ResizeOptions ( width , height ) ) 
 + . build ( ) ; 
 + PipelineDraweeController controller = ( PipelineDraweeController ) Fresco . newDraweeControllerBuilder ( ) 
 + . setOldController ( getController ( ) ) 
 + . setImageRequest ( request ) 
 + . build ( ) ; 
 + setController ( controller ) ; 
 + 
 + } 
 + 
 + 
 + public static int getBackground ( int i ) { 
 + if ( i > = 0 & & BACKGROUNDS . length > i ) { 
 + return BACKGROUNDS [ i ] ; 
 + } else { 
 + return R . drawable . img _ chat _ background _ default ; 
 + } 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 index fa384b2 . . f688b72 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 @ @ - 282 , 6 + 282 , 56 @ @ 
 < / LinearLayout > 
 
 < FrameLayout 
 + android : id = " @ + id / wallpaperDivider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 16dp " 
 + android : background = " @ color / bg _ backyard " > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 4dp " 
 + android : layout _ gravity = " top " 
 + android : background = " @ drawable / card _ shadow _ bottom " / > 
 + 
 + < View 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 1dp " 
 + android : layout _ gravity = " bottom " 
 + android : background = " @ drawable / card _ shadow _ top " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / settings _ wallpaper _ title " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 48dp " 
 + android : gravity = " center _ vertical | left " 
 + android : paddingLeft = " 72dp " 
 + android : text = " @ string / wallpaper " 
 + android : textSize = " 16sp " / > 
 + 
 + < HorizontalScrollView 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : requiresFadingEdge = " none " 
 + android : scrollbars = " none " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / background _ container " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " horizontal " > 
 + 
 + < View 
 + android : layout _ width = " 72dp " 
 + android : layout _ height = " 200dp " 
 + android : background = " @ android : color / transparent " / > 
 + 
 + 
 + < / LinearLayout > 
 + < / HorizontalScrollView > 
 + 
 + 
 + < FrameLayout 
 android : id = " @ + id / settings _ bottom _ container " 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " / > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 index 3c3350b . . 9ad8001 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values - ru / ui _ text . xml 
 @ @ - 153 , 6 + 153 , 7 @ @ 
 < string name = " nickname _ change " > И з м е н и т ь н и к < / string > 
 < string name = " about _ user _ me " > О б о м н е < / string > 
 < string name = " about _ user " > О п о л ь з о в а т е л е < / string > 
 + < string name = " wallpaper " > О б о и < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > П о з в о н и т ь { 0 } < / string > 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 2270a93 . . 3a7761d 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 157 , 6 + 157 , 7 @ @ 
 < string name = " nickname _ edittext _ hint " > Enter your Username < / string > 
 < string name = " about _ user _ me " > About me < / string > 
 < string name = " about _ user " > About user < / string > 
 + < string name = " wallpaper " > Wallpaper < / string > 
 
 < ! - - Profile controls - - > 
 < string name = " phone _ menu _ call " > Call { 0 } < / string >
