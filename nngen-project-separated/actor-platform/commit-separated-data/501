BLEU SCORE: 0.06837203339116285

TEST MSG: fix ( android : ui ) : keep screen on when playing audio
GENERATED MSG: feat ( android ) call members list

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java < nl > index de71c64 . . 19ef2ff 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java < nl > @ @ - 4 , 8 + 4 , 10 @ @ import android . app . Activity ; < nl > import android . content . Context ; < nl > import android . graphics . Color ; < nl > import android . graphics . PorterDuff ; < nl > + import android . support . v4 . app . FragmentActivity ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > + import android . view . Window ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageView ; < nl > import android . widget . SeekBar ; < nl > @ @ - 181 , 6 + 183 , 7 @ @ public class AudioHolder extends MessageHolder { < nl > public void run ( ) { < nl > if ( currentAudio ! = null & & currentAudio . equals ( fileName ) ) { < nl > Toast . makeText ( activity , " error playing this file " , Toast . LENGTH _ SHORT ) . show ( ) ; < nl > + keepScreenOn ( false ) ; < nl > } < nl > } < nl > } ) ; < nl > @ @ - 194 , 6 + 197 , 7 @ @ public class AudioHolder extends MessageHolder { < nl > private void play ( String fileName ) { < nl > if ( currentAudio ! = null & & currentAudio . equals ( fileName ) ) { < nl > playBtn . setImageResource ( R . drawable . ic _ pause _ white _ 24dp ) ; < nl > + keepScreenOn ( true ) ; < nl > } else { < nl > stop ( ) ; < nl > } < nl > @ @ - 212 , 10 + 216 , 12 @ @ public class AudioHolder extends MessageHolder { < nl > duration . setText ( ActorSDK . sharedActor ( ) . getMessenger ( ) . getFormatter ( ) . formatDuration ( ( int ) ( currentDuration / 1000 ) ) ) ; < nl > } < nl > treckingTouch = false ; < nl > + keepScreenOn ( false ) ; < nl > } < nl > < nl > private void pause ( ) { < nl > playBtn . setImageResource ( R . drawable . ic _ play _ arrow _ white _ 24dp ) ; < nl > + keepScreenOn ( false ) ; < nl > } < nl > < nl > @ Override < nl > @ @ - 394 , 4 + 400 , 15 @ @ public class AudioHolder extends MessageHolder { < nl > audioActor . send ( new AudioPlayerActor . Stop ( ) ) ; < nl > } < nl > } < nl > + < nl > + private void keepScreenOn ( boolean on ) { < nl > + if ( context ! = null ) { < nl > + Window window = ( ( FragmentActivity ) context ) . getWindow ( ) ; < nl > + if ( on = = true ) < nl > + window . addFlags ( android . view . WindowManager . LayoutParams . FLAG _ KEEP _ SCREEN _ ON ) ; < nl > + else < nl > + window . clearFlags ( android . view . WindowManager . LayoutParams . FLAG _ KEEP _ SCREEN _ ON ) ; < nl > + < nl > + } < nl > + } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > index fa9298f . . 5bb61e2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java < nl > @ @ - 1 , 6 + 1 , 7 @ @ < nl > package im . actor . sdk . controllers . calls ; < nl > < nl > import android . Manifest ; < nl > + import android . app . Activity ; < nl > import android . app . Notification ; < nl > import android . app . NotificationManager ; < nl > import android . app . PendingIntent ; < nl > @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; < nl > import android . os . Vibrator ; < nl > import android . support . v4 . app . NotificationCompat ; < nl > import android . support . v4 . content . ContextCompat ; < nl > - import android . view . Gravity ; < nl > import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > import android . widget . ImageButton ; < nl > import android . widget . ImageView ; < nl > + import android . widget . ListView ; < nl > import android . widget . TextView ; < nl > - import android . widget . Toast ; < nl > < nl > import java . text . DateFormat ; < nl > import java . text . SimpleDateFormat ; < nl > + import java . util . ArrayList ; < nl > import java . util . Date ; < nl > import java . util . TimeZone ; < nl > < nl > + import im . actor . core . entity . PeerType ; < nl > + import im . actor . core . viewmodel . CallMember ; < nl > import im . actor . core . viewmodel . CallState ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . viewmodel . CallVM ; < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . actors . Actor ; < nl > @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; < nl > import im . actor . runtime . actors . messages . PoisonPill ; < nl > import im . actor . runtime . mvvm . Value ; < nl > import im . actor . runtime . mvvm . ValueChangedListener ; < nl > + import im . actor . runtime . mvvm . ValueModel ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . fragment . BaseFragment ; < nl > - import im . actor . sdk . core . audio . AndroidPlayerActor ; < nl > - import im . actor . sdk . core . audio . AudioPlayerActor ; < nl > + import im . actor . sdk . util . Screen ; < nl > + import im . actor . sdk . view . SearchHighlight ; < nl > + import im . actor . sdk . view . adapters . HolderAdapter ; < nl > + import im . actor . sdk . view . adapters . ViewHolder ; < nl > + import im . actor . sdk . view . avatar . AvatarView ; < nl > import im . actor . sdk . view . avatar . CoverAvatarView ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { < nl > / / < nl > CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; < nl > avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; < nl > - < nl > - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > - bind ( avatarView , user . getAvatar ( ) ) ; < nl > - < nl > TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; < nl > nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; < nl > - bind ( nameTV , user . getName ( ) ) ; < nl > + < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + < nl > + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , user . getAvatar ( ) ) ; < nl > + bind ( nameTV , user . getName ( ) ) ; < nl > + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { < nl > + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; < nl > + bind ( avatarView , g . getAvatar ( ) ) ; < nl > + bind ( nameTV , g . getName ( ) ) ; < nl > + } < nl > + < nl > + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; < nl > + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; < nl > + membersList . setAdapter ( membersAdapter ) ; < nl > < nl > timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; < nl > timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; < nl > @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { < nl > < nl > } < nl > < nl > - private void toastInCenter ( String s ) { < nl > - Toast t = Toast . makeText ( getActivity ( ) , < nl > - s , Toast . LENGTH _ SHORT ) ; < nl > - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; < nl > - t . show ( ) ; < nl > - } < nl > - < nl > @ Override < nl > public void onPause ( ) { < nl > super . onPause ( ) ; < nl > @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { < nl > super . onResume ( ) ; < nl > manager . cancel ( NOTIFICATION _ ID ) ; < nl > } < nl > + < nl > + class CallMembersAdapter extends HolderAdapter < CallMember > { < nl > + < nl > + < nl > + private ArrayList < CallMember > members ; < nl > + < nl > + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { < nl > + super ( context ) ; < nl > + this . members = members . get ( ) ; < nl > + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { < nl > + @ Override < nl > + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { < nl > + CallMembersAdapter . this . members = val ; < nl > + notifyDataSetChanged ( ) ; < nl > + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public int getCount ( ) { < nl > + return members . size ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public CallMember getItem ( int position ) { < nl > + return members . get ( position ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public long getItemId ( int position ) { < nl > + return members . get ( position ) . getUid ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { < nl > + return new MemberHolder ( ) ; < nl > + } < nl > + < nl > + private class MemberHolder extends ViewHolder < CallMember > { < nl > + < nl > + CallMember data ; < nl > + private TextView userName ; < nl > + private TextView status ; < nl > + private AvatarView avatarView ; < nl > + < nl > + @ Override < nl > + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { < nl > + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; < nl > + < nl > + userName = ( TextView ) res . findViewById ( R . id . name ) ; < nl > + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; < nl > + status = ( TextView ) res . findViewById ( R . id . status ) ; < nl > + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; < nl > + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; < nl > + this . data = data ; < nl > + < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void bind ( CallMember data , int position , Context context ) { < nl > + UserVM user = users ( ) . get ( data . getUid ( ) ) ; < nl > + this . data = data ; < nl > + avatarView . bind ( user ) ; < nl > + userName . setText ( user . getName ( ) . get ( ) ) ; < nl > + status . setText ( data . getState ( ) . name ( ) ) ; < nl > + } < nl > + < nl > + < nl > + @ Override < nl > + public void unbind ( ) { < nl > + avatarView . unbind ( ) ; < nl > + } < nl > + } < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > index 50aecee . . fe5738b 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java < nl > @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > menu . findItem ( R . id . call ) . setVisible ( false ) ; < nl > } < nl > < nl > @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > < nl > } < nl > < nl > - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { < nl > if ( item . getItemId ( ) = = R . id . call ) { < nl > if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | < nl > @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { < nl > } < nl > < nl > private void startCall ( ) { < nl > - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + Command < Long > cmd ; < nl > + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { < nl > + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; < nl > + < nl > + } else { < nl > + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; < nl > + } < nl > execute ( cmd , R . string . progress _ common ) ; < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > index 47ab3ad . . 6ce5969 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml < nl > @ @ - 37 , 6 + 37 , 11 @ @ < nl > android : layout _ width = " wrap _ content " < nl > android : layout _ height = " wrap _ content " < nl > android : textSize = " @ dimen / text _ secondary " / > < nl > + < nl > + < ListView < nl > + android : id = " @ + id / members _ list " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " / > < nl > < / LinearLayout > < nl > < nl > < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > new file mode 100644 < nl > index 0000000 . . fa1ed22 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml < nl > @ @ - 0 , 0 + 1 , 62 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < nl > + < ! - - < nl > + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > < nl > + - - > < nl > + < nl > + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : gravity = " center _ vertical " < nl > + android : orientation = " horizontal " < nl > + android : paddingRight = " 8dp " > < nl > + < nl > + < FrameLayout < nl > + android : layout _ width = " 59dp " < nl > + android : layout _ height = " 48dp " > < nl > + < nl > + < im . actor . sdk . view . avatar . AvatarView < nl > + android : id = " @ + id / avatar " < nl > + android : layout _ width = " 35dp " < nl > + android : layout _ height = " 35dp " < nl > + android : layout _ gravity = " center " / > < nl > + < / FrameLayout > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / name " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / status " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : ellipsize = " end " < nl > + android : gravity = " center _ vertical " < nl > + android : lines = " 1 " < nl > + android : paddingRight = " 8dp " < nl > + android : singleLine = " true " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < nl > + < View < nl > + android : id = " @ + id / divider " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " 0dp " < nl > + android : layout _ marginLeft = " 59dp " / > < nl > + < nl > + < / LinearLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > index 922d837 . . 09b3e47 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java < nl > @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { < nl > public CallMemberState getState ( ) { < nl > return state ; < nl > } < nl > + < nl > + @ Override < nl > + public String toString ( ) { < nl > + return uid + " | " + state . name ( ) ; < nl > + } < nl > } < nl > \ No newline at end of file

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java 
 index de71c64 . . 19ef2ff 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / AudioHolder . java 
 @ @ - 4 , 8 + 4 , 10 @ @ import android . app . Activity ; 
 import android . content . Context ; 
 import android . graphics . Color ; 
 import android . graphics . PorterDuff ; 
 + import android . support . v4 . app . FragmentActivity ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 + import android . view . Window ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageView ; 
 import android . widget . SeekBar ; 
 @ @ - 181 , 6 + 183 , 7 @ @ public class AudioHolder extends MessageHolder { 
 public void run ( ) { 
 if ( currentAudio ! = null & & currentAudio . equals ( fileName ) ) { 
 Toast . makeText ( activity , " error playing this file " , Toast . LENGTH _ SHORT ) . show ( ) ; 
 + keepScreenOn ( false ) ; 
 } 
 } 
 } ) ; 
 @ @ - 194 , 6 + 197 , 7 @ @ public class AudioHolder extends MessageHolder { 
 private void play ( String fileName ) { 
 if ( currentAudio ! = null & & currentAudio . equals ( fileName ) ) { 
 playBtn . setImageResource ( R . drawable . ic _ pause _ white _ 24dp ) ; 
 + keepScreenOn ( true ) ; 
 } else { 
 stop ( ) ; 
 } 
 @ @ - 212 , 10 + 216 , 12 @ @ public class AudioHolder extends MessageHolder { 
 duration . setText ( ActorSDK . sharedActor ( ) . getMessenger ( ) . getFormatter ( ) . formatDuration ( ( int ) ( currentDuration / 1000 ) ) ) ; 
 } 
 treckingTouch = false ; 
 + keepScreenOn ( false ) ; 
 } 
 
 private void pause ( ) { 
 playBtn . setImageResource ( R . drawable . ic _ play _ arrow _ white _ 24dp ) ; 
 + keepScreenOn ( false ) ; 
 } 
 
 @ Override 
 @ @ - 394 , 4 + 400 , 15 @ @ public class AudioHolder extends MessageHolder { 
 audioActor . send ( new AudioPlayerActor . Stop ( ) ) ; 
 } 
 } 
 + 
 + private void keepScreenOn ( boolean on ) { 
 + if ( context ! = null ) { 
 + Window window = ( ( FragmentActivity ) context ) . getWindow ( ) ; 
 + if ( on = = true ) 
 + window . addFlags ( android . view . WindowManager . LayoutParams . FLAG _ KEEP _ SCREEN _ ON ) ; 
 + else 
 + window . clearFlags ( android . view . WindowManager . LayoutParams . FLAG _ KEEP _ SCREEN _ ON ) ; 
 + 
 + } 
 + } 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 index fa9298f . . 5bb61e2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / calls / CallFragment . java 
 @ @ - 1 , 6 + 1 , 7 @ @ 
 package im . actor . sdk . controllers . calls ; 
 
 import android . Manifest ; 
 + import android . app . Activity ; 
 import android . app . Notification ; 
 import android . app . NotificationManager ; 
 import android . app . PendingIntent ; 
 @ @ - 15 , 24 + 16 , 27 @ @ import android . os . PowerManager ; 
 import android . os . Vibrator ; 
 import android . support . v4 . app . NotificationCompat ; 
 import android . support . v4 . content . ContextCompat ; 
 - import android . view . Gravity ; 
 import android . view . LayoutInflater ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 import android . widget . ImageButton ; 
 import android . widget . ImageView ; 
 + import android . widget . ListView ; 
 import android . widget . TextView ; 
 - import android . widget . Toast ; 
 
 import java . text . DateFormat ; 
 import java . text . SimpleDateFormat ; 
 + import java . util . ArrayList ; 
 import java . util . Date ; 
 import java . util . TimeZone ; 
 
 + import im . actor . core . entity . PeerType ; 
 + import im . actor . core . viewmodel . CallMember ; 
 import im . actor . core . viewmodel . CallState ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . viewmodel . CallVM ; 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . actors . Actor ; 
 @ @ - 43 , 13 + 47 , 18 @ @ import im . actor . runtime . actors . Props ; 
 import im . actor . runtime . actors . messages . PoisonPill ; 
 import im . actor . runtime . mvvm . Value ; 
 import im . actor . runtime . mvvm . ValueChangedListener ; 
 + import im . actor . runtime . mvvm . ValueModel ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . fragment . BaseFragment ; 
 - import im . actor . sdk . core . audio . AndroidPlayerActor ; 
 - import im . actor . sdk . core . audio . AudioPlayerActor ; 
 + import im . actor . sdk . util . Screen ; 
 + import im . actor . sdk . view . SearchHighlight ; 
 + import im . actor . sdk . view . adapters . HolderAdapter ; 
 + import im . actor . sdk . view . adapters . ViewHolder ; 
 + import im . actor . sdk . view . avatar . AvatarView ; 
 import im . actor . sdk . view . avatar . CoverAvatarView ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 @ @ - 121 , 13 + 130 , 23 @ @ public class CallFragment extends BaseFragment { 
 / / 
 CoverAvatarView avatarView = ( CoverAvatarView ) cont . findViewById ( R . id . avatar ) ; 
 avatarView . setBkgrnd ( ( ImageView ) cont . findViewById ( R . id . avatar _ bgrnd ) ) ; 
 - 
 - final UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 - bind ( avatarView , user . getAvatar ( ) ) ; 
 - 
 TextView nameTV = ( TextView ) cont . findViewById ( R . id . name ) ; 
 nameTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileTitleColor ( ) ) ; 
 - bind ( nameTV , user . getName ( ) ) ; 
 + 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + 
 + UserVM user = users ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , user . getAvatar ( ) ) ; 
 + bind ( nameTV , user . getName ( ) ) ; 
 + } else if ( peer . getPeerType ( ) = = PeerType . GROUP ) { 
 + GroupVM g = groups ( ) . get ( peer . getPeerId ( ) ) ; 
 + bind ( avatarView , g . getAvatar ( ) ) ; 
 + bind ( nameTV , g . getName ( ) ) ; 
 + } 
 + 
 + ListView membersList = ( ListView ) cont . findViewById ( R . id . members _ list ) ; 
 + CallMembersAdapter membersAdapter = new CallMembersAdapter ( getActivity ( ) , call . getMembers ( ) ) ; 
 + membersList . setAdapter ( membersAdapter ) ; 
 
 timerTV = ( TextView ) cont . findViewById ( R . id . timer ) ; 
 timerTV . setTextColor ( ActorSDK . sharedActor ( ) . style . getProfileSubtitleColor ( ) ) ; 
 @ @ - 301 , 13 + 320 , 6 @ @ public class CallFragment extends BaseFragment { 
 
 } 
 
 - private void toastInCenter ( String s ) { 
 - Toast t = Toast . makeText ( getActivity ( ) , 
 - s , Toast . LENGTH _ SHORT ) ; 
 - t . setGravity ( Gravity . CENTER , 0 , 0 ) ; 
 - t . show ( ) ; 
 - } 
 - 
 @ Override 
 public void onPause ( ) { 
 super . onPause ( ) ; 
 @ @ - 339 , 4 + 351 , 81 @ @ public class CallFragment extends BaseFragment { 
 super . onResume ( ) ; 
 manager . cancel ( NOTIFICATION _ ID ) ; 
 } 
 + 
 + class CallMembersAdapter extends HolderAdapter < CallMember > { 
 + 
 + 
 + private ArrayList < CallMember > members ; 
 + 
 + protected CallMembersAdapter ( Context context , final ValueModel < ArrayList < CallMember > > members ) { 
 + super ( context ) ; 
 + this . members = members . get ( ) ; 
 + members . subscribe ( new ValueChangedListener < ArrayList < CallMember > > ( ) { 
 + @ Override 
 + public void onChanged ( ArrayList < CallMember > val , Value < ArrayList < CallMember > > valueModel ) { 
 + CallMembersAdapter . this . members = val ; 
 + notifyDataSetChanged ( ) ; 
 + Log . d ( " STATUS CHANGED " , val . toString ( ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public int getCount ( ) { 
 + return members . size ( ) ; 
 + } 
 + 
 + @ Override 
 + public CallMember getItem ( int position ) { 
 + return members . get ( position ) ; 
 + } 
 + 
 + @ Override 
 + public long getItemId ( int position ) { 
 + return members . get ( position ) . getUid ( ) ; 
 + } 
 + 
 + @ Override 
 + protected ViewHolder < CallMember > createHolder ( CallMember obj ) { 
 + return new MemberHolder ( ) ; 
 + } 
 + 
 + private class MemberHolder extends ViewHolder < CallMember > { 
 + 
 + CallMember data ; 
 + private TextView userName ; 
 + private TextView status ; 
 + private AvatarView avatarView ; 
 + 
 + @ Override 
 + public View init ( final CallMember data , ViewGroup viewGroup , Context context ) { 
 + View res = ( ( Activity ) context ) . getLayoutInflater ( ) . inflate ( R . layout . fragment _ call _ member _ item , viewGroup , false ) ; 
 + 
 + userName = ( TextView ) res . findViewById ( R . id . name ) ; 
 + userName . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextPrimaryColor ( ) ) ; 
 + status = ( TextView ) res . findViewById ( R . id . status ) ; 
 + status . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + avatarView = ( AvatarView ) res . findViewById ( R . id . avatar ) ; 
 + avatarView . init ( Screen . dp ( 35 ) , 18 ) ; 
 + this . data = data ; 
 + 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void bind ( CallMember data , int position , Context context ) { 
 + UserVM user = users ( ) . get ( data . getUid ( ) ) ; 
 + this . data = data ; 
 + avatarView . bind ( user ) ; 
 + userName . setText ( user . getName ( ) . get ( ) ) ; 
 + status . setText ( data . getState ( ) . name ( ) ) ; 
 + } 
 + 
 + 
 + @ Override 
 + public void unbind ( ) { 
 + avatarView . unbind ( ) ; 
 + } 
 + } 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 index 50aecee . . fe5738b 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / ChatActivity . java 
 @ @ - 1028 , 7 + 1028 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 menu . findItem ( R . id . leaveGroup ) . setVisible ( false ) ; 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) ! = PeerType . PRIVATE | | ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ! ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 menu . findItem ( R . id . call ) . setVisible ( false ) ; 
 } 
 
 @ @ - 1083 , 7 + 1083 , 7 @ @ public class ChatActivity extends ActorEditTextActivity { 
 
 } 
 
 - if ( getPeer ( ) . getPeerType ( ) = = PeerType . PRIVATE & & ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 + if ( ActorSDK . sharedActor ( ) . isCallsEnabled ( ) ) { 
 if ( item . getItemId ( ) = = R . id . call ) { 
 if ( ContextCompat . checkSelfPermission ( this , Manifest . permission . RECORD _ AUDIO ) ! = PackageManager . PERMISSION _ GRANTED | | 
 ContextCompat . checkSelfPermission ( this , Manifest . permission . VIBRATE ) ! = PackageManager . PERMISSION _ GRANTED | | 
 @ @ - 1102 , 7 + 1102 , 13 @ @ public class ChatActivity extends ActorEditTextActivity { 
 } 
 
 private void startCall ( ) { 
 - Command < Long > cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + Command < Long > cmd ; 
 + if ( peer . getPeerType ( ) = = PeerType . PRIVATE ) { 
 + cmd = messenger ( ) . doCall ( peer . getPeerId ( ) ) ; 
 + 
 + } else { 
 + cmd = messenger ( ) . doGroupCall ( peer . getPeerId ( ) ) ; 
 + } 
 execute ( cmd , R . string . progress _ common ) ; 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 index 47ab3ad . . 6ce5969 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call . xml 
 @ @ - 37 , 6 + 37 , 11 @ @ 
 android : layout _ width = " wrap _ content " 
 android : layout _ height = " wrap _ content " 
 android : textSize = " @ dimen / text _ secondary " / > 
 + 
 + < ListView 
 + android : id = " @ + id / members _ list " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " / > 
 < / LinearLayout > 
 
 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 new file mode 100644 
 index 0000000 . . fa1ed22 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ call _ member _ item . xml 
 @ @ - 0 , 0 + 1 , 62 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + 
 + < ! - - 
 + ~ Copyright ( C ) 2015 Actor LLC . < https : / / actor . im > 
 + - - > 
 + 
 + < LinearLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : gravity = " center _ vertical " 
 + android : orientation = " horizontal " 
 + android : paddingRight = " 8dp " > 
 + 
 + < FrameLayout 
 + android : layout _ width = " 59dp " 
 + android : layout _ height = " 48dp " > 
 + 
 + < im . actor . sdk . view . avatar . AvatarView 
 + android : id = " @ + id / avatar " 
 + android : layout _ width = " 35dp " 
 + android : layout _ height = " 35dp " 
 + android : layout _ gravity = " center " / > 
 + < / FrameLayout > 
 + 
 + < TextView 
 + android : id = " @ + id / name " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / status " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : ellipsize = " end " 
 + android : gravity = " center _ vertical " 
 + android : lines = " 1 " 
 + android : paddingRight = " 8dp " 
 + android : singleLine = " true " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + 
 + < View 
 + android : id = " @ + id / divider " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " 0dp " 
 + android : layout _ marginLeft = " 59dp " / > 
 + 
 + < / LinearLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 index 922d837 . . 09b3e47 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / viewmodel / CallMember . java 
 @ @ - 21 , 4 + 21 , 9 @ @ public class CallMember { 
 public CallMemberState getState ( ) { 
 return state ; 
 } 
 + 
 + @ Override 
 + public String toString ( ) { 
 + return uid + " | " + state . name ( ) ; 
 + } 
 } 
 \ No newline at end of file
