BLEU SCORE: 0.020980574531482755

TEST MSG: feat ( android + core ) : Implemented permissions editing
GENERATED MSG: Merge commit ' 3c548d4f2e5b40a6254bb1ce5daf5e3dbf9af4f9 '

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > index 0e80107 . . 4f38c4f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml < nl > @ @ - 164 , 6 + 164 , 12 @ @ < nl > android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > < nl > < activity < nl > + android : name = " . controllers . group . GroupPermissionsActivity " < nl > + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > + android : theme = " @ style / CommonActivityTheme " < nl > + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > < nl > + < nl > + < activity < nl > android : name = " . controllers . group . MembersActivity " < nl > android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " < nl > android : theme = " @ style / CommonActivityTheme " < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > index b6d9a57 . . b41338e 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java < nl > @ @ - 112 , 16 + 112 , 15 @ @ public class GroupAdminFragment extends BaseFragment { < nl > } else { < nl > permissionsHint . setText ( R . string . group _ permissions _ hint ) ; < nl > } < nl > - / / if ( groupVM . getIsCanEditAdministration ( ) . get ( ) ) { < nl > - / / permissions . setOnClickListener ( v - > { < nl > - / / < nl > - / / } ) ; < nl > - / / } else { < nl > - / / permissions . setVisibility ( View . GONE ) ; < nl > - / / permissionsDiv . setVisibility ( View . GONE ) ; < nl > - / / } < nl > - permissions . setVisibility ( View . GONE ) ; < nl > - permissionsDiv . setVisibility ( View . GONE ) ; < nl > + if ( groupVM . getIsCanEditAdministration ( ) . get ( ) & & groupVM . getGroupType ( ) = = GroupType . GROUP ) { < nl > + permissions . setOnClickListener ( v - > { < nl > + startActivity ( new Intent ( getContext ( ) , GroupPermissionsActivity . class ) < nl > + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; < nl > + } ) ; < nl > + } else { < nl > + permissions . setVisibility ( View . GONE ) ; < nl > + permissionsDiv . setVisibility ( View . GONE ) ; < nl > + } < nl > < nl > / / Group Deletion < nl > TextView delete = ( TextView ) res . findViewById ( R . id . delete ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java < nl > new file mode 100644 < nl > index 0000000 . . cb2a61b < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java < nl > @ @ - 0 , 0 + 1 , 19 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . os . Bundle ; < nl > + < nl > + import im . actor . sdk . controllers . Intents ; < nl > + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + < nl > + public class GroupPermissionsActivity extends BaseFragmentActivity { < nl > + < nl > + @ Override < nl > + protected void onCreate ( Bundle savedInstanceState ) { < nl > + super . onCreate ( savedInstanceState ) ; < nl > + < nl > + if ( savedInstanceState = = null ) { < nl > + showFragment ( GroupPermissionsFragment . create ( < nl > + getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; < nl > + } < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java < nl > new file mode 100644 < nl > index 0000000 . . 25a23ad < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java < nl > @ @ - 0 , 0 + 1 , 119 @ @ < nl > + package im . actor . sdk . controllers . group ; < nl > + < nl > + import android . app . Activity ; < nl > + import android . os . Bundle ; < nl > + import android . support . annotation . Nullable ; < nl > + import android . view . LayoutInflater ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . widget . CheckBox ; < nl > + < nl > + import fr . castorflex . android . circularprogressbar . CircularProgressBar ; < nl > + import im . actor . core . entity . GroupPermissions ; < nl > + import im . actor . core . entity . GroupType ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . BaseFragment ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > + public class GroupPermissionsFragment extends BaseFragment { < nl > + < nl > + public static GroupPermissionsFragment create ( int chatId ) { < nl > + Bundle args = new Bundle ( ) ; < nl > + args . putInt ( " groupId " , chatId ) ; < nl > + GroupPermissionsFragment res = new GroupPermissionsFragment ( ) ; < nl > + res . setArguments ( args ) ; < nl > + return res ; < nl > + } < nl > + < nl > + private GroupPermissions permissions ; < nl > + private int groupId ; < nl > + < nl > + private CircularProgressBar progress ; < nl > + private View scrollContainer ; < nl > + private CheckBox canEditInfo ; < nl > + < nl > + public GroupPermissionsFragment ( ) { < nl > + setRootFragment ( true ) ; < nl > + setHomeAsUp ( true ) ; < nl > + setShowHome ( true ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onCreate ( Bundle saveInstance ) { < nl > + super . onCreate ( saveInstance ) ; < nl > + groupId = getArguments ( ) . getInt ( " groupId " ) ; < nl > + if ( messenger ( ) . getGroup ( groupId ) . getGroupType ( ) = = GroupType . CHANNEL ) { < nl > + setTitle ( R . string . channel _ admin _ title ) ; < nl > + } else { < nl > + setTitle ( R . string . group _ admin _ title ) ; < nl > + } < nl > + } < nl > + < nl > + @ Nullable < nl > + @ Override < nl > + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { < nl > + View res = inflater . inflate ( R . layout . fragment _ edit _ permissions , container , false ) ; < nl > + View rootContainer = res . findViewById ( R . id . rootContainer ) ; < nl > + rootContainer . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; < nl > + canEditInfo = ( CheckBox ) res . findViewById ( R . id . canEditValue ) ; < nl > + scrollContainer = res . findViewById ( R . id . scrollContainer ) ; < nl > + progress = ( CircularProgressBar ) res . findViewById ( R . id . progress ) ; < nl > + progress . setIndeterminate ( true ) ; < nl > + return res ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onResume ( ) { < nl > + super . onResume ( ) ; < nl > + if ( permissions = = null ) { < nl > + progress . setVisibility ( View . VISIBLE ) ; < nl > + scrollContainer . setVisibility ( View . GONE ) ; < nl > + wrap ( messenger ( ) . loadGroupPermissions ( groupId ) ) . then ( r - > { < nl > + goneView ( progress ) ; < nl > + showView ( scrollContainer ) ; < nl > + this . permissions = r ; < nl > + bindView ( ) ; < nl > + } ) ; < nl > + } else { < nl > + progress . setVisibility ( View . GONE ) ; < nl > + scrollContainer . setVisibility ( View . VISIBLE ) ; < nl > + } < nl > + } < nl > + < nl > + public void bindView ( ) { < nl > + Activity activity = getActivity ( ) ; < nl > + if ( activity ! = null ) { < nl > + activity . invalidateOptionsMenu ( ) ; < nl > + } < nl > + canEditInfo . setChecked ( permissions . isMembersCanEditInfo ( ) ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > + super . onCreateOptionsMenu ( menu , inflater ) ; < nl > + if ( permissions ! = null ) { < nl > + inflater . inflate ( R . menu . next , menu ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . next ) { < nl > + if ( permissions . isMembersCanEditInfo ( ) ! = canEditInfo . isChecked ( ) ) { < nl > + permissions . setMembersCanEditInfo ( canEditInfo . isChecked ( ) ) ; < nl > + execute ( messenger ( ) . saveGroupPermissions ( groupId , permissions ) . then ( r - > { < nl > + finishActivity ( ) ; < nl > + } ) ) ; < nl > + } else { < nl > + finishActivity ( ) ; < nl > + } < nl > + return true ; < nl > + } else { < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > + } < nl > + } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml < nl > new file mode 100644 < nl > index 0000000 . . 07cb8a6 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml < nl > @ @ - 0 , 0 + 1 , 63 @ @ < nl > + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > < nl > + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " < nl > + android : id = " @ + id / rootContainer " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " > < nl > + < nl > + < ScrollView < nl > + android : id = " @ + id / scrollContainer " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " match _ parent " < nl > + android : fillViewport = " true " > < nl > + < nl > + < LinearLayout < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / generalBlock " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ marginTop = " 8dp " < nl > + android : background = " @ drawable / card _ shadow " < nl > + android : orientation = " vertical " > < nl > + < nl > + < LinearLayout < nl > + android : id = " @ + id / canEditContainer " < nl > + android : layout _ width = " match _ parent " < nl > + android : layout _ height = " wrap _ content " < nl > + android : background = " @ drawable / selector " < nl > + android : minHeight = " 56dp " < nl > + android : orientation = " horizontal " < nl > + android : paddingLeft = " 16dp " < nl > + android : paddingRight = " 16dp " > < nl > + < nl > + < CheckBox < nl > + android : id = " @ + id / canEditValue " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center _ vertical " < nl > + android : layout _ marginRight = " 16dp " / > < nl > + < nl > + < TextView < nl > + android : id = " @ + id / canEditTitle " < nl > + android : layout _ width = " 0dp " < nl > + android : layout _ height = " match _ parent " < nl > + android : layout _ weight = " 1 " < nl > + android : gravity = " center _ vertical " < nl > + android : text = " @ string / group _ can _ edit _ info _ members " < nl > + android : textSize = " 16sp " / > < nl > + < nl > + < / LinearLayout > < nl > + < / LinearLayout > < nl > + < / LinearLayout > < nl > + < / ScrollView > < nl > + < nl > + < fr . castorflex . android . circularprogressbar . CircularProgressBar < nl > + android : id = " @ + id / progress " < nl > + android : layout _ width = " wrap _ content " < nl > + android : layout _ height = " wrap _ content " < nl > + android : layout _ gravity = " center " / > < nl > + < nl > + < / FrameLayout > < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > index 07cd199 . . 7290f30 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml < nl > @ @ - 381 , 6 + 381 , 9 @ @ < nl > < string name = " group _ share _ history _ enabled " > Shared < / string > < nl > < string name = " group _ share _ history _ hint " > All members will see all messages < / string > < nl > < nl > + < string name = " group _ can _ edit _ info _ members " > All members can edit group info < / string > < nl > + < string name = " channel _ can _ edit _ info _ members " > All members can edit group info < / string > < nl > + < nl > < string name = " group _ public _ group _ title " > Public Group < / string > < nl > < string name = " group _ public _ group _ text " > Public groups can be found in search , anyone can join them . < / string > < nl > < string name = " group _ private _ group _ title " > Private Group < / string > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > index 928a183 . . 6e47cd2 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java < nl > @ @ - 22 , 6 + 22 , 7 @ @ import im . actor . core . entity . AuthStartRes ; < nl > import im . actor . core . entity . FileReference ; < nl > import im . actor . core . entity . Group ; < nl > import im . actor . core . entity . GroupMembersSlice ; < nl > + import im . actor . core . entity . GroupPermissions ; < nl > import im . actor . core . entity . MentionFilterResult ; < nl > import im . actor . core . entity . MessageSearchEntity ; < nl > import im . actor . core . entity . Peer ; < nl > @ @ - 1437 , 6 + 1438 , 31 @ @ public class Messenger { < nl > } < nl > < nl > / * * < nl > + * Load Group ' s permissions < nl > + * < nl > + * @ param gid group ' s id < nl > + * @ return promise of permissions < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " loadGroupPermissionsWithGid : " ) < nl > + public Promise < GroupPermissions > loadGroupPermissions ( int gid ) { < nl > + return modules . getGroupsModule ( ) . loadAdminSettings ( gid ) ; < nl > + } < nl > + < nl > + / * * < nl > + * Save Group ' s permissions < nl > + * < nl > + * @ param gid group ' s id < nl > + * @ param adminSettings settings < nl > + * @ return promise of void < nl > + * / < nl > + @ NotNull < nl > + @ ObjectiveCName ( " saveGroupPermissionsWithGid : withSettings : " ) < nl > + public Promise < Void > saveGroupPermissions ( int gid , GroupPermissions adminSettings ) { < nl > + return modules . getGroupsModule ( ) . saveAdminSettings ( gid , adminSettings ) ; < nl > + } < nl > + < nl > + / * * < nl > * Change group avatar < nl > * < nl > * @ param gid group ' s id < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java < nl > new file mode 100644 < nl > index 0000000 . . 9c11d4c < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java < nl > @ @ - 0 , 0 + 1 , 36 @ @ < nl > + package im . actor . core . entity ; < nl > + < nl > + import com . google . j2objc . annotations . ObjectiveCName ; < nl > + < nl > + import im . actor . core . api . ApiAdminSettings ; < nl > + import im . actor . runtime . collections . SparseArray ; < nl > + < nl > + public class GroupPermissions { < nl > + < nl > + private ApiAdminSettings settings ; < nl > + < nl > + public GroupPermissions ( ApiAdminSettings settings ) { < nl > + this . settings = settings ; < nl > + } < nl > + < nl > + @ ObjectiveCName ( " isMembersCanEditInfo " ) < nl > + public boolean isMembersCanEditInfo ( ) { < nl > + return settings . canMembersEditGroupInfo ( ) ; < nl > + } < nl > + < nl > + @ ObjectiveCName ( " setMembersCanEditInfo : " ) < nl > + public void setMembersCanEditInfo ( boolean canEditInfo ) { < nl > + SparseArray < Object > unmapped = settings . getUnmappedObjects ( ) ; < nl > + settings = new ApiAdminSettings ( < nl > + settings . showAdminsToMembers ( ) , < nl > + settings . canMembersInvite ( ) , < nl > + canEditInfo , < nl > + settings . canAdminsEditGroupInfo ( ) < nl > + ) ; < nl > + settings . setUnmappedObjects ( unmapped ) ; < nl > + } < nl > + < nl > + public ApiAdminSettings getApiSettings ( ) { < nl > + return settings ; < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > index 57627ed . . ac3b047 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java < nl > @ @ - 8 , 6 + 8 , 7 @ @ import java . util . ArrayList ; < nl > import java . util . HashMap ; < nl > import java . util . List ; < nl > < nl > + import im . actor . core . api . ApiAdminSettings ; < nl > import im . actor . core . api . ApiGroupOutPeer ; < nl > import im . actor . core . api . ApiGroupType ; < nl > import im . actor . core . api . ApiOutPeer ; < nl > @ @ - 24 , 15 + 25 , 18 @ @ import im . actor . core . api . rpc . RequestInviteUser ; < nl > import im . actor . core . api . rpc . RequestJoinGroup ; < nl > import im . actor . core . api . rpc . RequestKickUser ; < nl > import im . actor . core . api . rpc . RequestLeaveGroup ; < nl > + import im . actor . core . api . rpc . RequestLoadAdminSettings ; < nl > import im . actor . core . api . rpc . RequestLoadMembers ; < nl > import im . actor . core . api . rpc . RequestMakeUserAdminObsolete ; < nl > import im . actor . core . api . rpc . RequestRevokeIntegrationToken ; < nl > import im . actor . core . api . rpc . RequestRevokeInviteUrl ; < nl > + import im . actor . core . api . rpc . RequestSaveAdminSettings ; < nl > import im . actor . core . api . rpc . RequestTransferOwnership ; < nl > import im . actor . core . api . rpc . ResponseIntegrationToken ; < nl > import im . actor . core . api . rpc . ResponseInviteUrl ; < nl > import im . actor . core . entity . Group ; < nl > import im . actor . core . entity . GroupMembersSlice ; < nl > + import im . actor . core . entity . GroupPermissions ; < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . PeerType ; < nl > import im . actor . core . entity . User ; < nl > @ @ - 239 , 6 + 243 , 20 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { < nl > . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; < nl > } < nl > < nl > + public Promise < GroupPermissions > loadAdminSettings ( int gid ) { < nl > + return getGroups ( ) . getValueAsync ( gid ) < nl > + . flatMap ( group - > api ( new RequestLoadAdminSettings ( new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) ) ) ) < nl > + . map ( r - > new GroupPermissions ( r . getSettings ( ) ) ) ; < nl > + } < nl > + < nl > + public Promise < Void > saveAdminSettings ( int gid , GroupPermissions adminSettings ) { < nl > + return getGroups ( ) . getValueAsync ( gid ) < nl > + . flatMap ( group - > api ( new RequestSaveAdminSettings ( < nl > + new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , < nl > + adminSettings . getApiSettings ( ) ) ) ) < nl > + . map ( r - > null ) ; < nl > + } < nl > + < nl > public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { < nl > return getGroups ( ) . getValueAsync ( gid ) < nl > . flatMap ( group - >
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index cbd1b86 . . 4d865cb 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 163 , 13 + 163 , 6 @ @ public interface ActorSDKDelegate { < nl > < nl > < nl > / * * < nl > - * Is Actor pushes used for this app - added for testing < nl > - * < nl > - * @ return is Actor push id used < nl > - * / < nl > - boolean useActorPush ( ) ; < nl > - < nl > - / * * < nl > * Method for hacking share menu in dialog < nl > * < nl > * @ param shareMenu share menu < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index f591d2a . . 63cd509 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 168 , 16 + 168 , 6 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > } < nl > < nl > / * * < nl > - * Is Actor pushes used for this app - added for testing < nl > - * < nl > - * @ return is Actor push id used < nl > - * / < nl > - @ Override < nl > - public boolean useActorPush ( ) { < nl > - return true ; < nl > - } < nl > - < nl > - / * * < nl > * Method for hacking share menu in dialog < nl > * < nl > * @ param shareMenu share menu < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > index 8edc540 . . 4907cd2 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java < nl > @ @ - 1 , 21 + 1 , 36 @ @ < nl > package im . actor . sdk . controllers . group ; < nl > < nl > + import android . app . AlertDialog ; < nl > + import android . content . DialogInterface ; < nl > + import android . content . Intent ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . os . Bundle ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuInflater ; < nl > + import android . view . MenuItem ; < nl > < nl > + import im . actor . core . viewmodel . GroupVM ; < nl > import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . groups ; < nl > + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; < nl > + < nl > public class GroupInfoActivity extends BaseFragmentActivity { < nl > < nl > + private GroupVM groupInfo ; < nl > + private int chatId ; < nl > + < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > super . onCreate ( savedInstanceState ) ; < nl > - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > - < nl > + chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; < nl > + groupInfo = groups ( ) . get ( chatId ) ; < nl > getSupportActionBar ( ) . setBackgroundDrawable ( new ColorDrawable ( Color . TRANSPARENT ) ) ; < nl > getSupportActionBar ( ) . setTitle ( null ) ; < nl > < nl > @ @ - 31 , 4 + 46 , 40 @ @ public class GroupInfoActivity extends BaseFragmentActivity { < nl > showFragment ( fragment , false , false ) ; < nl > } < nl > } < nl > + < nl > + @ Override < nl > + public boolean onCreateOptionsMenu ( Menu menu ) { < nl > + if ( groupInfo . isMember ( ) . get ( ) ) { < nl > + getMenuInflater ( ) . inflate ( R . menu . group _ info , menu ) ; < nl > + } < nl > + return true ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . leaveGroup ) { < nl > + new AlertDialog . Builder ( this ) < nl > + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > + groupInfo . getName ( ) . get ( ) ) ) < nl > + . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { < nl > + @ Override < nl > + public void onClick ( DialogInterface dialog2 , int which ) { < nl > + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > + } < nl > + } ) < nl > + . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > + . show ( ) < nl > + . setCanceledOnTouchOutside ( true ) ; < nl > + < nl > + return true ; < nl > + } else if ( item . getItemId ( ) = = R . id . addMember ) { < nl > + startActivity ( new Intent ( this , AddMemberActivity . class ) < nl > + . putExtra ( " GROUP _ ID " , chatId ) ) ; < nl > + } else if ( item . getItemId ( ) = = R . id . editTitle ) { < nl > + startActivity ( Intents . editGroupTitle ( chatId , this ) ) ; < nl > + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > + startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , this ) ) ; < nl > + } < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > index c58a224 . . 36170a7 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java < nl > @ @ - 424 , 42 + 424 , 6 @ @ public class GroupInfoFragment extends BaseFragment { < nl > } < nl > < nl > @ Override < nl > - public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { < nl > - super . onCreateOptionsMenu ( menu , menuInflater ) ; < nl > - if ( groupInfo . isMember ( ) . get ( ) ) { < nl > - menuInflater . inflate ( R . menu . group _ info , menu ) ; < nl > - } < nl > - } < nl > - < nl > - @ Override < nl > - public boolean onOptionsItemSelected ( MenuItem item ) { < nl > - if ( item . getItemId ( ) = = R . id . leaveGroup ) { < nl > - new AlertDialog . Builder ( getActivity ( ) ) < nl > - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , < nl > - groupInfo . getName ( ) . get ( ) ) ) < nl > - . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { < nl > - @ Override < nl > - public void onClick ( DialogInterface dialog2 , int which ) { < nl > - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; < nl > - } < nl > - } ) < nl > - . setNegativeButton ( R . string . dialog _ cancel , null ) < nl > - . show ( ) < nl > - . setCanceledOnTouchOutside ( true ) ; < nl > - < nl > - return true ; < nl > - } else if ( item . getItemId ( ) = = R . id . addMember ) { < nl > - startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) < nl > - . putExtra ( " GROUP _ ID " , chatId ) ) ; < nl > - } else if ( item . getItemId ( ) = = R . id . editTitle ) { < nl > - startActivity ( Intents . editGroupTitle ( chatId , getActivity ( ) ) ) ; < nl > - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > - startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , getActivity ( ) ) ) ; < nl > - } < nl > - return super . onOptionsItemSelected ( item ) ; < nl > - } < nl > - < nl > - @ Override < nl > public void onActivityResult ( int requestCode , int resultCode , Intent data ) { < nl > if ( resultCode = = Activity . RESULT _ OK & & requestCode = = 0 & & data ! = null & & data . hasExtra ( Intents . EXTRA _ UID ) ) { < nl > final UserVM userModel = users ( ) . get ( data . getIntExtra ( Intents . EXTRA _ UID , 0 ) ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > index 0efdef7 . . e9fa9ce 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java < nl > @ @ - 15 , 10 + 15 , 13 @ @ import android . view . MenuItem ; < nl > import android . view . View ; < nl > import android . view . ViewGroup ; < nl > import android . widget . FrameLayout ; < nl > + import android . widget . LinearLayout ; < nl > import android . widget . TextView ; < nl > < nl > import im . actor . core . entity . Peer ; < nl > import im . actor . core . entity . SearchEntity ; < nl > + import im . actor . core . viewmodel . CommandCallback ; < nl > + import im . actor . core . viewmodel . UserVM ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > import im . actor . runtime . generic . mvvm . DisplayList ; < nl > import im . actor . sdk . ActorSDK ; < nl > @ @ - 45 , 6 + 48 , 10 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > private BindedDisplayList < SearchEntity > searchDisplay ; < nl > private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; < nl > < nl > + SearchHolder footerSearchHolder ; < nl > + private String searchQuery ; < nl > + private LinearLayout footer ; < nl > + < nl > public GlobalSearchBaseFragment ( ) { < nl > setHasOptionsMenu ( true ) ; < nl > setUnbindOnPause ( true ) ; < nl > @ @ - 137 , 12 + 144 , 50 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > < nl > @ Override < nl > public boolean onQueryTextChange ( String s ) { < nl > + searchQuery = s . trim ( ) ; < nl > + < nl > if ( isSearchVisible ) { < nl > if ( s . trim ( ) . length ( ) > 0 ) { < nl > + String activeSearchQuery = searchQuery ; < nl > searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; < nl > searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; < nl > + messenger ( ) . findUsers ( s ) . start ( new CommandCallback < UserVM [ ] > ( ) { < nl > + @ Override < nl > + public void onResult ( UserVM [ ] res ) { < nl > + int footerVisability = footer . getVisibility ( ) ; < nl > + if ( searchQuery . equals ( activeSearchQuery ) ) { < nl > + boolean showResult = false ; < nl > + UserVM u = null ; < nl > + if ( res . length > 0 ) { < nl > + u = res [ 0 ] ; < nl > + showResult = true ; < nl > + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { < nl > + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( Peer . user ( u . getId ( ) ) ) ) < nl > + showResult = false ; < nl > + break ; < nl > + } < nl > + } < nl > + if ( showResult ) { < nl > + footerSearchHolder . bind ( new SearchEntity ( Peer . user ( u . getId ( ) ) , 0 , u . getAvatar ( ) . get ( ) , u . getName ( ) . get ( ) ) , activeSearchQuery , true ) ; < nl > + showView ( footer ) ; < nl > + } else { < nl > + goneView ( footer ) ; < nl > + } < nl > + } < nl > + if ( footerVisability ! = footer . getVisibility ( ) ) { < nl > + onSearchChanged ( ) ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + < nl > + } < nl > + } ) ; < nl > } else { < nl > searchDisplay . initEmpty ( ) ; < nl > + goneView ( footer ) ; < nl > + < nl > } < nl > } < nl > return false ; < nl > @ @ - 156 , 7 + 201 , 7 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > goneView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchHintView ) ; < nl > - if ( searchDisplay . getSize ( ) = = 0 ) { < nl > + if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { < nl > showView ( searchEmptyView ) ; < nl > } else { < nl > goneView ( searchEmptyView ) ; < nl > @ @ - 190 , 6 + 235 , 51 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { < nl > header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; < nl > recyclerAdapter . addHeaderView ( header ) ; < nl > < nl > + TextView footerTitle = new TextView ( getActivity ( ) ) ; < nl > + footerTitle . setText ( R . string . main _ search _ global _ header ) ; < nl > + footerTitle . setTextSize ( 16 ) ; < nl > + footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; < nl > + footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; < nl > + footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; < nl > + < nl > + footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { < nl > + @ Override < nl > + public void onClicked ( SearchEntity item ) { < nl > + int peerId = item . getPeer ( ) . getPeerId ( ) ; < nl > + execute ( messenger ( ) . addContact ( peerId ) , R . string . progress _ common , new CommandCallback < Boolean > ( ) { < nl > + @ Override < nl > + public void onResult ( Boolean res2 ) { < nl > + startActivity ( Intents . openPrivateDialog ( peerId , < nl > + true , < nl > + getActivity ( ) ) ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onError ( Exception e ) { < nl > + startActivity ( Intents . openPrivateDialog ( peerId , < nl > + true , < nl > + getActivity ( ) ) ) ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onLongClicked ( SearchEntity item ) { < nl > + return false ; < nl > + } < nl > + } ) ; < nl > + View footerGlobalSearchView = footerSearchHolder . itemView ; < nl > + < nl > + footer = new LinearLayout ( getActivity ( ) ) ; < nl > + footer . setOrientation ( LinearLayout . VERTICAL ) ; < nl > + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; < nl > + footer . addView ( footerTitle , params ) ; < nl > + footer . addView ( footerGlobalSearchView , params ) ; < nl > + < nl > + footer . setVisibility ( View . GONE ) ; < nl > + < nl > + recyclerAdapter . addFooterView ( footer ) ; < nl > + < nl > searchList . setAdapter ( recyclerAdapter ) ; < nl > searchDisplay . addListener ( searchListener ) ; < nl > showView ( searchHintView , false ) ; < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > index 57c9e38 . . f35bc06 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java < nl > @ @ - 345 , 10 + 345 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } ) ; < nl > < nl > - if ( noEmails & & noPhones ) { < nl > - contactsContainer . setVisibility ( View . GONE ) ; < nl > - about . findViewById ( R . id . divider ) . setVisibility ( View . INVISIBLE ) ; < nl > - } < nl > < nl > view . findViewById ( R . id . chatSettings ) . setOnClickListener ( new View . OnClickListener ( ) { < nl > @ Override < nl > @ @ - 601 , 7 + 597 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } ) ; < nl > < nl > - updateActionBar ( scrollView . getScrollY ( ) ) ; < nl > + / / updateActionBar ( scrollView . getScrollY ( ) ) ; < nl > < nl > return view ; < nl > } < nl > @ @ - 726 , 24 + 722 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements < nl > } < nl > } < nl > < nl > - @ Override < nl > - public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { < nl > - super . onCreateOptionsMenu ( menu , inflater ) ; < nl > - inflater . inflate ( R . menu . my _ profile , menu ) ; < nl > - } < nl > - < nl > - @ Override < nl > - public boolean onOptionsItemSelected ( MenuItem item ) { < nl > - if ( item . getItemId ( ) = = R . id . editProfile ) { < nl > - startActivity ( Intents . editMyName ( getActivity ( ) ) ) ; < nl > - return true ; < nl > - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > - startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , getActivity ( ) ) ) ; < nl > - return true ; < nl > - } < nl > - < nl > - return super . onOptionsItemSelected ( item ) ; < nl > - } < nl > < nl > @ Override < nl > public View getBeforeNickSettingsView ( ) { < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > index ab18972 . . a61a53f 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java < nl > @ @ - 3 , 11 + 3 , 18 @ @ package im . actor . sdk . controllers . settings ; < nl > import android . graphics . Color ; < nl > import android . graphics . drawable . ColorDrawable ; < nl > import android . os . Bundle ; < nl > + import android . view . Menu ; < nl > + import android . view . MenuItem ; < nl > < nl > import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . Intents ; < nl > import im . actor . sdk . controllers . activity . BaseFragmentActivity ; < nl > + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > < nl > + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; < nl > + < nl > public class MyProfileActivity extends BaseFragmentActivity { < nl > @ Override < nl > protected void onCreate ( Bundle savedInstanceState ) { < nl > @ @ - 33 , 4 + 40 , 23 @ @ public class MyProfileActivity extends BaseFragmentActivity { < nl > showFragment ( fragment , false , false ) ; < nl > } < nl > } < nl > + < nl > + @ Override < nl > + public boolean onCreateOptionsMenu ( Menu menu ) { < nl > + getMenuInflater ( ) . inflate ( R . menu . my _ profile , menu ) ; < nl > + return super . onCreateOptionsMenu ( menu ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public boolean onOptionsItemSelected ( MenuItem item ) { < nl > + if ( item . getItemId ( ) = = R . id . editProfile ) { < nl > + startActivity ( Intents . editMyName ( this ) ) ; < nl > + return true ; < nl > + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { < nl > + startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , this ) ) ; < nl > + return true ; < nl > + } < nl > + < nl > + return super . onOptionsItemSelected ( item ) ; < nl > + } < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > index 95264da . . 3a58f6a 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml < nl > @ @ - 18 , 6 + 18 , 7 @ @ < nl > < LinearLayout < nl > android : layout _ width = " match _ parent " < nl > android : layout _ height = " wrap _ content " < nl > + android : focusableInTouchMode = " true " < nl > android : orientation = " vertical " > < nl > < nl > < FrameLayout

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 index 0e80107 . . 4f38c4f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / AndroidManifest . xml 
 @ @ - 164 , 6 + 164 , 12 @ @ 
 android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 
 < activity 
 + android : name = " . controllers . group . GroupPermissionsActivity " 
 + android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 + android : theme = " @ style / CommonActivityTheme " 
 + android : windowSoftInputMode = " adjustNothing | stateAlwaysHidden " / > 
 + 
 + < activity 
 android : name = " . controllers . group . MembersActivity " 
 android : configChanges = " keyboard | keyboardHidden | orientation | screenSize " 
 android : theme = " @ style / CommonActivityTheme " 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 index b6d9a57 . . b41338e 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupAdminFragment . java 
 @ @ - 112 , 16 + 112 , 15 @ @ public class GroupAdminFragment extends BaseFragment { 
 } else { 
 permissionsHint . setText ( R . string . group _ permissions _ hint ) ; 
 } 
 - / / if ( groupVM . getIsCanEditAdministration ( ) . get ( ) ) { 
 - / / permissions . setOnClickListener ( v - > { 
 - / / 
 - / / } ) ; 
 - / / } else { 
 - / / permissions . setVisibility ( View . GONE ) ; 
 - / / permissionsDiv . setVisibility ( View . GONE ) ; 
 - / / } 
 - permissions . setVisibility ( View . GONE ) ; 
 - permissionsDiv . setVisibility ( View . GONE ) ; 
 + if ( groupVM . getIsCanEditAdministration ( ) . get ( ) & & groupVM . getGroupType ( ) = = GroupType . GROUP ) { 
 + permissions . setOnClickListener ( v - > { 
 + startActivity ( new Intent ( getContext ( ) , GroupPermissionsActivity . class ) 
 + . putExtra ( Intents . EXTRA _ GROUP _ ID , groupVM . getId ( ) ) ) ; 
 + } ) ; 
 + } else { 
 + permissions . setVisibility ( View . GONE ) ; 
 + permissionsDiv . setVisibility ( View . GONE ) ; 
 + } 
 
 / / Group Deletion 
 TextView delete = ( TextView ) res . findViewById ( R . id . delete ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java 
 new file mode 100644 
 index 0000000 . . cb2a61b 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsActivity . java 
 @ @ - 0 , 0 + 1 , 19 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . os . Bundle ; 
 + 
 + import im . actor . sdk . controllers . Intents ; 
 + import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + 
 + public class GroupPermissionsActivity extends BaseFragmentActivity { 
 + 
 + @ Override 
 + protected void onCreate ( Bundle savedInstanceState ) { 
 + super . onCreate ( savedInstanceState ) ; 
 + 
 + if ( savedInstanceState = = null ) { 
 + showFragment ( GroupPermissionsFragment . create ( 
 + getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ) , false ) ; 
 + } 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java 
 new file mode 100644 
 index 0000000 . . 25a23ad 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupPermissionsFragment . java 
 @ @ - 0 , 0 + 1 , 119 @ @ 
 + package im . actor . sdk . controllers . group ; 
 + 
 + import android . app . Activity ; 
 + import android . os . Bundle ; 
 + import android . support . annotation . Nullable ; 
 + import android . view . LayoutInflater ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . widget . CheckBox ; 
 + 
 + import fr . castorflex . android . circularprogressbar . CircularProgressBar ; 
 + import im . actor . core . entity . GroupPermissions ; 
 + import im . actor . core . entity . GroupType ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . BaseFragment ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 + public class GroupPermissionsFragment extends BaseFragment { 
 + 
 + public static GroupPermissionsFragment create ( int chatId ) { 
 + Bundle args = new Bundle ( ) ; 
 + args . putInt ( " groupId " , chatId ) ; 
 + GroupPermissionsFragment res = new GroupPermissionsFragment ( ) ; 
 + res . setArguments ( args ) ; 
 + return res ; 
 + } 
 + 
 + private GroupPermissions permissions ; 
 + private int groupId ; 
 + 
 + private CircularProgressBar progress ; 
 + private View scrollContainer ; 
 + private CheckBox canEditInfo ; 
 + 
 + public GroupPermissionsFragment ( ) { 
 + setRootFragment ( true ) ; 
 + setHomeAsUp ( true ) ; 
 + setShowHome ( true ) ; 
 + } 
 + 
 + @ Override 
 + public void onCreate ( Bundle saveInstance ) { 
 + super . onCreate ( saveInstance ) ; 
 + groupId = getArguments ( ) . getInt ( " groupId " ) ; 
 + if ( messenger ( ) . getGroup ( groupId ) . getGroupType ( ) = = GroupType . CHANNEL ) { 
 + setTitle ( R . string . channel _ admin _ title ) ; 
 + } else { 
 + setTitle ( R . string . group _ admin _ title ) ; 
 + } 
 + } 
 + 
 + @ Nullable 
 + @ Override 
 + public View onCreateView ( LayoutInflater inflater , @ Nullable ViewGroup container , @ Nullable Bundle savedInstanceState ) { 
 + View res = inflater . inflate ( R . layout . fragment _ edit _ permissions , container , false ) ; 
 + View rootContainer = res . findViewById ( R . id . rootContainer ) ; 
 + rootContainer . setBackgroundColor ( style . getBackyardBackgroundColor ( ) ) ; 
 + canEditInfo = ( CheckBox ) res . findViewById ( R . id . canEditValue ) ; 
 + scrollContainer = res . findViewById ( R . id . scrollContainer ) ; 
 + progress = ( CircularProgressBar ) res . findViewById ( R . id . progress ) ; 
 + progress . setIndeterminate ( true ) ; 
 + return res ; 
 + } 
 + 
 + @ Override 
 + public void onResume ( ) { 
 + super . onResume ( ) ; 
 + if ( permissions = = null ) { 
 + progress . setVisibility ( View . VISIBLE ) ; 
 + scrollContainer . setVisibility ( View . GONE ) ; 
 + wrap ( messenger ( ) . loadGroupPermissions ( groupId ) ) . then ( r - > { 
 + goneView ( progress ) ; 
 + showView ( scrollContainer ) ; 
 + this . permissions = r ; 
 + bindView ( ) ; 
 + } ) ; 
 + } else { 
 + progress . setVisibility ( View . GONE ) ; 
 + scrollContainer . setVisibility ( View . VISIBLE ) ; 
 + } 
 + } 
 + 
 + public void bindView ( ) { 
 + Activity activity = getActivity ( ) ; 
 + if ( activity ! = null ) { 
 + activity . invalidateOptionsMenu ( ) ; 
 + } 
 + canEditInfo . setChecked ( permissions . isMembersCanEditInfo ( ) ) ; 
 + } 
 + 
 + @ Override 
 + public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 + super . onCreateOptionsMenu ( menu , inflater ) ; 
 + if ( permissions ! = null ) { 
 + inflater . inflate ( R . menu . next , menu ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . next ) { 
 + if ( permissions . isMembersCanEditInfo ( ) ! = canEditInfo . isChecked ( ) ) { 
 + permissions . setMembersCanEditInfo ( canEditInfo . isChecked ( ) ) ; 
 + execute ( messenger ( ) . saveGroupPermissions ( groupId , permissions ) . then ( r - > { 
 + finishActivity ( ) ; 
 + } ) ) ; 
 + } else { 
 + finishActivity ( ) ; 
 + } 
 + return true ; 
 + } else { 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 + } 
 + } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml 
 new file mode 100644 
 index 0000000 . . 07cb8a6 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ edit _ permissions . xml 
 @ @ - 0 , 0 + 1 , 63 @ @ 
 + < ? xml version = " 1 . 0 " encoding = " utf - 8 " ? > 
 + < FrameLayout xmlns : android = " http : / / schemas . android . com / apk / res / android " 
 + android : id = " @ + id / rootContainer " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " > 
 + 
 + < ScrollView 
 + android : id = " @ + id / scrollContainer " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " match _ parent " 
 + android : fillViewport = " true " > 
 + 
 + < LinearLayout 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / generalBlock " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ marginTop = " 8dp " 
 + android : background = " @ drawable / card _ shadow " 
 + android : orientation = " vertical " > 
 + 
 + < LinearLayout 
 + android : id = " @ + id / canEditContainer " 
 + android : layout _ width = " match _ parent " 
 + android : layout _ height = " wrap _ content " 
 + android : background = " @ drawable / selector " 
 + android : minHeight = " 56dp " 
 + android : orientation = " horizontal " 
 + android : paddingLeft = " 16dp " 
 + android : paddingRight = " 16dp " > 
 + 
 + < CheckBox 
 + android : id = " @ + id / canEditValue " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center _ vertical " 
 + android : layout _ marginRight = " 16dp " / > 
 + 
 + < TextView 
 + android : id = " @ + id / canEditTitle " 
 + android : layout _ width = " 0dp " 
 + android : layout _ height = " match _ parent " 
 + android : layout _ weight = " 1 " 
 + android : gravity = " center _ vertical " 
 + android : text = " @ string / group _ can _ edit _ info _ members " 
 + android : textSize = " 16sp " / > 
 + 
 + < / LinearLayout > 
 + < / LinearLayout > 
 + < / LinearLayout > 
 + < / ScrollView > 
 + 
 + < fr . castorflex . android . circularprogressbar . CircularProgressBar 
 + android : id = " @ + id / progress " 
 + android : layout _ width = " wrap _ content " 
 + android : layout _ height = " wrap _ content " 
 + android : layout _ gravity = " center " / > 
 + 
 + < / FrameLayout > 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 index 07cd199 . . 7290f30 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / values / ui _ text . xml 
 @ @ - 381 , 6 + 381 , 9 @ @ 
 < string name = " group _ share _ history _ enabled " > Shared < / string > 
 < string name = " group _ share _ history _ hint " > All members will see all messages < / string > 
 
 + < string name = " group _ can _ edit _ info _ members " > All members can edit group info < / string > 
 + < string name = " channel _ can _ edit _ info _ members " > All members can edit group info < / string > 
 + 
 < string name = " group _ public _ group _ title " > Public Group < / string > 
 < string name = " group _ public _ group _ text " > Public groups can be found in search , anyone can join them . < / string > 
 < string name = " group _ private _ group _ title " > Private Group < / string > 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 index 928a183 . . 6e47cd2 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / Messenger . java 
 @ @ - 22 , 6 + 22 , 7 @ @ import im . actor . core . entity . AuthStartRes ; 
 import im . actor . core . entity . FileReference ; 
 import im . actor . core . entity . Group ; 
 import im . actor . core . entity . GroupMembersSlice ; 
 + import im . actor . core . entity . GroupPermissions ; 
 import im . actor . core . entity . MentionFilterResult ; 
 import im . actor . core . entity . MessageSearchEntity ; 
 import im . actor . core . entity . Peer ; 
 @ @ - 1437 , 6 + 1438 , 31 @ @ public class Messenger { 
 } 
 
 / * * 
 + * Load Group ' s permissions 
 + * 
 + * @ param gid group ' s id 
 + * @ return promise of permissions 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " loadGroupPermissionsWithGid : " ) 
 + public Promise < GroupPermissions > loadGroupPermissions ( int gid ) { 
 + return modules . getGroupsModule ( ) . loadAdminSettings ( gid ) ; 
 + } 
 + 
 + / * * 
 + * Save Group ' s permissions 
 + * 
 + * @ param gid group ' s id 
 + * @ param adminSettings settings 
 + * @ return promise of void 
 + * / 
 + @ NotNull 
 + @ ObjectiveCName ( " saveGroupPermissionsWithGid : withSettings : " ) 
 + public Promise < Void > saveGroupPermissions ( int gid , GroupPermissions adminSettings ) { 
 + return modules . getGroupsModule ( ) . saveAdminSettings ( gid , adminSettings ) ; 
 + } 
 + 
 + / * * 
 * Change group avatar 
 * 
 * @ param gid group ' s id 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java 
 new file mode 100644 
 index 0000000 . . 9c11d4c 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / GroupPermissions . java 
 @ @ - 0 , 0 + 1 , 36 @ @ 
 + package im . actor . core . entity ; 
 + 
 + import com . google . j2objc . annotations . ObjectiveCName ; 
 + 
 + import im . actor . core . api . ApiAdminSettings ; 
 + import im . actor . runtime . collections . SparseArray ; 
 + 
 + public class GroupPermissions { 
 + 
 + private ApiAdminSettings settings ; 
 + 
 + public GroupPermissions ( ApiAdminSettings settings ) { 
 + this . settings = settings ; 
 + } 
 + 
 + @ ObjectiveCName ( " isMembersCanEditInfo " ) 
 + public boolean isMembersCanEditInfo ( ) { 
 + return settings . canMembersEditGroupInfo ( ) ; 
 + } 
 + 
 + @ ObjectiveCName ( " setMembersCanEditInfo : " ) 
 + public void setMembersCanEditInfo ( boolean canEditInfo ) { 
 + SparseArray < Object > unmapped = settings . getUnmappedObjects ( ) ; 
 + settings = new ApiAdminSettings ( 
 + settings . showAdminsToMembers ( ) , 
 + settings . canMembersInvite ( ) , 
 + canEditInfo , 
 + settings . canAdminsEditGroupInfo ( ) 
 + ) ; 
 + settings . setUnmappedObjects ( unmapped ) ; 
 + } 
 + 
 + public ApiAdminSettings getApiSettings ( ) { 
 + return settings ; 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 index 57627ed . . ac3b047 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / modules / groups / GroupsModule . java 
 @ @ - 8 , 6 + 8 , 7 @ @ import java . util . ArrayList ; 
 import java . util . HashMap ; 
 import java . util . List ; 
 
 + import im . actor . core . api . ApiAdminSettings ; 
 import im . actor . core . api . ApiGroupOutPeer ; 
 import im . actor . core . api . ApiGroupType ; 
 import im . actor . core . api . ApiOutPeer ; 
 @ @ - 24 , 15 + 25 , 18 @ @ import im . actor . core . api . rpc . RequestInviteUser ; 
 import im . actor . core . api . rpc . RequestJoinGroup ; 
 import im . actor . core . api . rpc . RequestKickUser ; 
 import im . actor . core . api . rpc . RequestLeaveGroup ; 
 + import im . actor . core . api . rpc . RequestLoadAdminSettings ; 
 import im . actor . core . api . rpc . RequestLoadMembers ; 
 import im . actor . core . api . rpc . RequestMakeUserAdminObsolete ; 
 import im . actor . core . api . rpc . RequestRevokeIntegrationToken ; 
 import im . actor . core . api . rpc . RequestRevokeInviteUrl ; 
 + import im . actor . core . api . rpc . RequestSaveAdminSettings ; 
 import im . actor . core . api . rpc . RequestTransferOwnership ; 
 import im . actor . core . api . rpc . ResponseIntegrationToken ; 
 import im . actor . core . api . rpc . ResponseInviteUrl ; 
 import im . actor . core . entity . Group ; 
 import im . actor . core . entity . GroupMembersSlice ; 
 + import im . actor . core . entity . GroupPermissions ; 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . PeerType ; 
 import im . actor . core . entity . User ; 
 @ @ - 239 , 6 + 243 , 20 @ @ public class GroupsModule extends AbsModule implements BusSubscriber { 
 . flatMap ( r - > updates ( ) . waitForUpdate ( r . getSeq ( ) ) ) ; 
 } 
 
 + public Promise < GroupPermissions > loadAdminSettings ( int gid ) { 
 + return getGroups ( ) . getValueAsync ( gid ) 
 + . flatMap ( group - > api ( new RequestLoadAdminSettings ( new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) ) ) ) 
 + . map ( r - > new GroupPermissions ( r . getSettings ( ) ) ) ; 
 + } 
 + 
 + public Promise < Void > saveAdminSettings ( int gid , GroupPermissions adminSettings ) { 
 + return getGroups ( ) . getValueAsync ( gid ) 
 + . flatMap ( group - > api ( new RequestSaveAdminSettings ( 
 + new ApiGroupOutPeer ( group . getGroupId ( ) , group . getAccessHash ( ) ) , 
 + adminSettings . getApiSettings ( ) ) ) ) 
 + . map ( r - > null ) ; 
 + } 
 + 
 public Promise < GroupMembersSlice > loadMembers ( int gid , int limit , byte [ ] next ) { 
 return getGroups ( ) . getValueAsync ( gid ) 
 . flatMap ( group - >

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index cbd1b86 . . 4d865cb 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 163 , 13 + 163 , 6 @ @ public interface ActorSDKDelegate { 
 
 
 / * * 
 - * Is Actor pushes used for this app - added for testing 
 - * 
 - * @ return is Actor push id used 
 - * / 
 - boolean useActorPush ( ) ; 
 - 
 - / * * 
 * Method for hacking share menu in dialog 
 * 
 * @ param shareMenu share menu 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index f591d2a . . 63cd509 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 168 , 16 + 168 , 6 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 } 
 
 / * * 
 - * Is Actor pushes used for this app - added for testing 
 - * 
 - * @ return is Actor push id used 
 - * / 
 - @ Override 
 - public boolean useActorPush ( ) { 
 - return true ; 
 - } 
 - 
 - / * * 
 * Method for hacking share menu in dialog 
 * 
 * @ param shareMenu share menu 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 index 8edc540 . . 4907cd2 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoActivity . java 
 @ @ - 1 , 21 + 1 , 36 @ @ 
 package im . actor . sdk . controllers . group ; 
 
 + import android . app . AlertDialog ; 
 + import android . content . DialogInterface ; 
 + import android . content . Intent ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . os . Bundle ; 
 + import android . view . Menu ; 
 + import android . view . MenuInflater ; 
 + import android . view . MenuItem ; 
 
 + import im . actor . core . viewmodel . GroupVM ; 
 import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . controllers . settings . BaseGroupInfoActivity ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . groups ; 
 + import static im . actor . sdk . util . ActorSDKMessenger . messenger ; 
 + 
 public class GroupInfoActivity extends BaseFragmentActivity { 
 
 + private GroupVM groupInfo ; 
 + private int chatId ; 
 + 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 super . onCreate ( savedInstanceState ) ; 
 - int chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 - 
 + chatId = getIntent ( ) . getIntExtra ( Intents . EXTRA _ GROUP _ ID , 0 ) ; 
 + groupInfo = groups ( ) . get ( chatId ) ; 
 getSupportActionBar ( ) . setBackgroundDrawable ( new ColorDrawable ( Color . TRANSPARENT ) ) ; 
 getSupportActionBar ( ) . setTitle ( null ) ; 
 
 @ @ - 31 , 4 + 46 , 40 @ @ public class GroupInfoActivity extends BaseFragmentActivity { 
 showFragment ( fragment , false , false ) ; 
 } 
 } 
 + 
 + @ Override 
 + public boolean onCreateOptionsMenu ( Menu menu ) { 
 + if ( groupInfo . isMember ( ) . get ( ) ) { 
 + getMenuInflater ( ) . inflate ( R . menu . group _ info , menu ) ; 
 + } 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . leaveGroup ) { 
 + new AlertDialog . Builder ( this ) 
 + . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 + groupInfo . getName ( ) . get ( ) ) ) 
 + . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { 
 + @ Override 
 + public void onClick ( DialogInterface dialog2 , int which ) { 
 + execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 + } 
 + } ) 
 + . setNegativeButton ( R . string . dialog _ cancel , null ) 
 + . show ( ) 
 + . setCanceledOnTouchOutside ( true ) ; 
 + 
 + return true ; 
 + } else if ( item . getItemId ( ) = = R . id . addMember ) { 
 + startActivity ( new Intent ( this , AddMemberActivity . class ) 
 + . putExtra ( " GROUP _ ID " , chatId ) ) ; 
 + } else if ( item . getItemId ( ) = = R . id . editTitle ) { 
 + startActivity ( Intents . editGroupTitle ( chatId , this ) ) ; 
 + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 + startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , this ) ) ; 
 + } 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 index c58a224 . . 36170a7 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / group / GroupInfoFragment . java 
 @ @ - 424 , 42 + 424 , 6 @ @ public class GroupInfoFragment extends BaseFragment { 
 } 
 
 @ Override 
 - public void onCreateOptionsMenu ( Menu menu , MenuInflater menuInflater ) { 
 - super . onCreateOptionsMenu ( menu , menuInflater ) ; 
 - if ( groupInfo . isMember ( ) . get ( ) ) { 
 - menuInflater . inflate ( R . menu . group _ info , menu ) ; 
 - } 
 - } 
 - 
 - @ Override 
 - public boolean onOptionsItemSelected ( MenuItem item ) { 
 - if ( item . getItemId ( ) = = R . id . leaveGroup ) { 
 - new AlertDialog . Builder ( getActivity ( ) ) 
 - . setMessage ( getString ( R . string . alert _ leave _ group _ message ) . replace ( " % 1 $ s " , 
 - groupInfo . getName ( ) . get ( ) ) ) 
 - . setPositiveButton ( R . string . alert _ leave _ group _ yes , new DialogInterface . OnClickListener ( ) { 
 - @ Override 
 - public void onClick ( DialogInterface dialog2 , int which ) { 
 - execute ( messenger ( ) . leaveGroup ( chatId ) ) ; 
 - } 
 - } ) 
 - . setNegativeButton ( R . string . dialog _ cancel , null ) 
 - . show ( ) 
 - . setCanceledOnTouchOutside ( true ) ; 
 - 
 - return true ; 
 - } else if ( item . getItemId ( ) = = R . id . addMember ) { 
 - startActivity ( new Intent ( getActivity ( ) , AddMemberActivity . class ) 
 - . putExtra ( " GROUP _ ID " , chatId ) ) ; 
 - } else if ( item . getItemId ( ) = = R . id . editTitle ) { 
 - startActivity ( Intents . editGroupTitle ( chatId , getActivity ( ) ) ) ; 
 - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 - startActivity ( ViewAvatarActivity . viewGroupAvatar ( chatId , getActivity ( ) ) ) ; 
 - } 
 - return super . onOptionsItemSelected ( item ) ; 
 - } 
 - 
 - @ Override 
 public void onActivityResult ( int requestCode , int resultCode , Intent data ) { 
 if ( resultCode = = Activity . RESULT _ OK & & requestCode = = 0 & & data ! = null & & data . hasExtra ( Intents . EXTRA _ UID ) ) { 
 final UserVM userModel = users ( ) . get ( data . getIntExtra ( Intents . EXTRA _ UID , 0 ) ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 index 0efdef7 . . e9fa9ce 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / search / GlobalSearchBaseFragment . java 
 @ @ - 15 , 10 + 15 , 13 @ @ import android . view . MenuItem ; 
 import android . view . View ; 
 import android . view . ViewGroup ; 
 import android . widget . FrameLayout ; 
 + import android . widget . LinearLayout ; 
 import android . widget . TextView ; 
 
 import im . actor . core . entity . Peer ; 
 import im . actor . core . entity . SearchEntity ; 
 + import im . actor . core . viewmodel . CommandCallback ; 
 + import im . actor . core . viewmodel . UserVM ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 import im . actor . runtime . generic . mvvm . DisplayList ; 
 import im . actor . sdk . ActorSDK ; 
 @ @ - 45 , 6 + 48 , 10 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 private BindedDisplayList < SearchEntity > searchDisplay ; 
 private final DisplayList . Listener searchListener = ( ) - > onSearchChanged ( ) ; 
 
 + SearchHolder footerSearchHolder ; 
 + private String searchQuery ; 
 + private LinearLayout footer ; 
 + 
 public GlobalSearchBaseFragment ( ) { 
 setHasOptionsMenu ( true ) ; 
 setUnbindOnPause ( true ) ; 
 @ @ - 137 , 12 + 144 , 50 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 
 @ Override 
 public boolean onQueryTextChange ( String s ) { 
 + searchQuery = s . trim ( ) ; 
 + 
 if ( isSearchVisible ) { 
 if ( s . trim ( ) . length ( ) > 0 ) { 
 + String activeSearchQuery = searchQuery ; 
 searchDisplay . initSearch ( s . trim ( ) . toLowerCase ( ) , false ) ; 
 searchAdapter . setQuery ( s . trim ( ) . toLowerCase ( ) ) ; 
 + messenger ( ) . findUsers ( s ) . start ( new CommandCallback < UserVM [ ] > ( ) { 
 + @ Override 
 + public void onResult ( UserVM [ ] res ) { 
 + int footerVisability = footer . getVisibility ( ) ; 
 + if ( searchQuery . equals ( activeSearchQuery ) ) { 
 + boolean showResult = false ; 
 + UserVM u = null ; 
 + if ( res . length > 0 ) { 
 + u = res [ 0 ] ; 
 + showResult = true ; 
 + for ( int i = 0 ; i < searchDisplay . getSize ( ) ; i + + ) { 
 + if ( searchDisplay . getItem ( i ) . getPeer ( ) . equals ( Peer . user ( u . getId ( ) ) ) ) 
 + showResult = false ; 
 + break ; 
 + } 
 + } 
 + if ( showResult ) { 
 + footerSearchHolder . bind ( new SearchEntity ( Peer . user ( u . getId ( ) ) , 0 , u . getAvatar ( ) . get ( ) , u . getName ( ) . get ( ) ) , activeSearchQuery , true ) ; 
 + showView ( footer ) ; 
 + } else { 
 + goneView ( footer ) ; 
 + } 
 + } 
 + if ( footerVisability ! = footer . getVisibility ( ) ) { 
 + onSearchChanged ( ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + 
 + } 
 + } ) ; 
 } else { 
 searchDisplay . initEmpty ( ) ; 
 + goneView ( footer ) ; 
 + 
 } 
 } 
 return false ; 
 @ @ - 156 , 7 + 201 , 7 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 goneView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchHintView ) ; 
 - if ( searchDisplay . getSize ( ) = = 0 ) { 
 + if ( searchDisplay . getSize ( ) = = 0 & & footer . getVisibility ( ) ! = View . VISIBLE ) { 
 showView ( searchEmptyView ) ; 
 } else { 
 goneView ( searchEmptyView ) ; 
 @ @ - 190 , 6 + 235 , 51 @ @ public abstract class GlobalSearchBaseFragment extends BaseFragment { 
 header . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getMainBackgroundColor ( ) ) ; 
 recyclerAdapter . addHeaderView ( header ) ; 
 
 + TextView footerTitle = new TextView ( getActivity ( ) ) ; 
 + footerTitle . setText ( R . string . main _ search _ global _ header ) ; 
 + footerTitle . setTextSize ( 16 ) ; 
 + footerTitle . setPadding ( Screen . dp ( 12 ) , Screen . dp ( 8 ) , 0 , Screen . dp ( 8 ) ) ; 
 + footerTitle . setBackgroundColor ( ActorSDK . sharedActor ( ) . style . getBackyardBackgroundColor ( ) ) ; 
 + footerTitle . setTextColor ( ActorSDK . sharedActor ( ) . style . getTextSecondaryColor ( ) ) ; 
 + 
 + footerSearchHolder = new SearchHolder ( getActivity ( ) , new OnItemClickedListener < SearchEntity > ( ) { 
 + @ Override 
 + public void onClicked ( SearchEntity item ) { 
 + int peerId = item . getPeer ( ) . getPeerId ( ) ; 
 + execute ( messenger ( ) . addContact ( peerId ) , R . string . progress _ common , new CommandCallback < Boolean > ( ) { 
 + @ Override 
 + public void onResult ( Boolean res2 ) { 
 + startActivity ( Intents . openPrivateDialog ( peerId , 
 + true , 
 + getActivity ( ) ) ) ; 
 + } 
 + 
 + @ Override 
 + public void onError ( Exception e ) { 
 + startActivity ( Intents . openPrivateDialog ( peerId , 
 + true , 
 + getActivity ( ) ) ) ; 
 + } 
 + } ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onLongClicked ( SearchEntity item ) { 
 + return false ; 
 + } 
 + } ) ; 
 + View footerGlobalSearchView = footerSearchHolder . itemView ; 
 + 
 + footer = new LinearLayout ( getActivity ( ) ) ; 
 + footer . setOrientation ( LinearLayout . VERTICAL ) ; 
 + LinearLayout . LayoutParams params = new LinearLayout . LayoutParams ( Screen . getWidth ( ) , ViewGroup . LayoutParams . WRAP _ CONTENT ) ; 
 + footer . addView ( footerTitle , params ) ; 
 + footer . addView ( footerGlobalSearchView , params ) ; 
 + 
 + footer . setVisibility ( View . GONE ) ; 
 + 
 + recyclerAdapter . addFooterView ( footer ) ; 
 + 
 searchList . setAdapter ( recyclerAdapter ) ; 
 searchDisplay . addListener ( searchListener ) ; 
 showView ( searchHintView , false ) ; 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 index 57c9e38 . . f35bc06 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / BaseActorSettingsFragment . java 
 @ @ - 345 , 10 + 345 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } ) ; 
 
 - if ( noEmails & & noPhones ) { 
 - contactsContainer . setVisibility ( View . GONE ) ; 
 - about . findViewById ( R . id . divider ) . setVisibility ( View . INVISIBLE ) ; 
 - } 
 
 view . findViewById ( R . id . chatSettings ) . setOnClickListener ( new View . OnClickListener ( ) { 
 @ Override 
 @ @ - 601 , 7 + 597 , 7 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } ) ; 
 
 - updateActionBar ( scrollView . getScrollY ( ) ) ; 
 + / / updateActionBar ( scrollView . getScrollY ( ) ) ; 
 
 return view ; 
 } 
 @ @ - 726 , 24 + 722 , 6 @ @ public abstract class BaseActorSettingsFragment extends BaseFragment implements 
 } 
 } 
 
 - @ Override 
 - public void onCreateOptionsMenu ( Menu menu , MenuInflater inflater ) { 
 - super . onCreateOptionsMenu ( menu , inflater ) ; 
 - inflater . inflate ( R . menu . my _ profile , menu ) ; 
 - } 
 - 
 - @ Override 
 - public boolean onOptionsItemSelected ( MenuItem item ) { 
 - if ( item . getItemId ( ) = = R . id . editProfile ) { 
 - startActivity ( Intents . editMyName ( getActivity ( ) ) ) ; 
 - return true ; 
 - } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 - startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , getActivity ( ) ) ) ; 
 - return true ; 
 - } 
 - 
 - return super . onOptionsItemSelected ( item ) ; 
 - } 
 
 @ Override 
 public View getBeforeNickSettingsView ( ) { 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 index ab18972 . . a61a53f 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / settings / MyProfileActivity . java 
 @ @ - 3 , 11 + 3 , 18 @ @ package im . actor . sdk . controllers . settings ; 
 import android . graphics . Color ; 
 import android . graphics . drawable . ColorDrawable ; 
 import android . os . Bundle ; 
 + import android . view . Menu ; 
 + import android . view . MenuItem ; 
 
 import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . Intents ; 
 import im . actor . sdk . controllers . activity . BaseFragmentActivity ; 
 + import im . actor . sdk . controllers . fragment . preview . ViewAvatarActivity ; 
 import im . actor . sdk . intents . ActorIntent ; 
 
 + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; 
 + 
 public class MyProfileActivity extends BaseFragmentActivity { 
 @ Override 
 protected void onCreate ( Bundle savedInstanceState ) { 
 @ @ - 33 , 4 + 40 , 23 @ @ public class MyProfileActivity extends BaseFragmentActivity { 
 showFragment ( fragment , false , false ) ; 
 } 
 } 
 + 
 + @ Override 
 + public boolean onCreateOptionsMenu ( Menu menu ) { 
 + getMenuInflater ( ) . inflate ( R . menu . my _ profile , menu ) ; 
 + return super . onCreateOptionsMenu ( menu ) ; 
 + } 
 + 
 + @ Override 
 + public boolean onOptionsItemSelected ( MenuItem item ) { 
 + if ( item . getItemId ( ) = = R . id . editProfile ) { 
 + startActivity ( Intents . editMyName ( this ) ) ; 
 + return true ; 
 + } else if ( item . getItemId ( ) = = R . id . changePhoto ) { 
 + startActivity ( ViewAvatarActivity . viewAvatar ( myUid ( ) , this ) ) ; 
 + return true ; 
 + } 
 + 
 + return super . onOptionsItemSelected ( item ) ; 
 + } 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 index 95264da . . 3a58f6a 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / res / layout / fragment _ settings . xml 
 @ @ - 18 , 6 + 18 , 7 @ @ 
 < LinearLayout 
 android : layout _ width = " match _ parent " 
 android : layout _ height = " wrap _ content " 
 + android : focusableInTouchMode = " true " 
 android : orientation = " vertical " > 
 
 < FrameLayout
