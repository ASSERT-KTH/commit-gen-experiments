BLEU SCORE: 0.13485111859503685

TEST MSG: chore ( android ) : CensoredTextHolder example with spannable
GENERATED MSG: feat ( android - sdk ) : custom messages

TEST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java < nl > index d357271 . . bec7683 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java < nl > @ @ - 1 , 15 + 1 , 31 @ @ < nl > package im . actor ; < nl > < nl > + import android . graphics . Color ; < nl > + import android . graphics . Paint ; < nl > import android . text . Spannable ; < nl > + import android . text . SpannableString ; < nl > + import android . text . Spanned ; < nl > + import android . text . TextPaint ; < nl > import android . text . TextUtils ; < nl > + import android . text . style . ClickableSpan ; < nl > + import android . text . style . URLSpan ; < nl > import android . view . View ; < nl > < nl > import java . util . ArrayList ; < nl > + import java . util . regex . Matcher ; < nl > + import java . util . regex . Pattern ; < nl > < nl > + import im . actor . core . entity . GroupMember ; < nl > import im . actor . core . entity . Message ; < nl > import im . actor . core . entity . Peer ; < nl > + import im . actor . core . viewmodel . UserVM ; < nl > + import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > import im . actor . sdk . controllers . conversation . messages . content . TextHolder ; < nl > + import im . actor . sdk . controllers . conversation . view . MentionSpan ; < nl > + import im . actor . sdk . view . BaseUrlSpan ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . users ; < nl > < nl > public class CensoredTextHolderEx extends TextHolder { < nl > public CensoredTextHolderEx ( MessagesAdapter adapter , View itemView , Peer peer ) { < nl > @ @ - 27 , 11 + 43 , 34 @ @ public class CensoredTextHolderEx extends TextHolder { < nl > < nl > @ Override < nl > public void bindRawText ( CharSequence rawText , long readDate , long receiveDate , Spannable reactions , Message message , boolean isItalic ) { < nl > + Spannable res = new SpannableString ( rawText ) ; < nl > for ( String s : badWords ) { < nl > - rawText = rawText . toString ( ) . replaceAll ( " / * ( ? i ) " + s + " / * " , new String ( new char [ s . length ( ) ] ) . replace ( ' \ 0 ' , ' * ' ) ) ; < nl > + / / rawText = rawText . toString ( ) . replaceAll ( " / * ( ? i ) " + s + " / * " , new String ( new char [ s . length ( ) ] ) . replace ( ' \ 0 ' , ' * ' ) ) ; < nl > + Pattern p = Pattern . compile ( " / * ( ? i ) " + s + " / * " ) ; < nl > + Matcher m = p . matcher ( rawText . toString ( ) ) ; < nl > + while ( m . find ( ) ) { < nl > + CensorSpan span = new CensorSpan ( ) ; < nl > + res . setSpan ( span , m . start ( ) , m . end ( ) , Spanned . SPAN _ EXCLUSIVE _ EXCLUSIVE ) ; < nl > + } < nl > } < nl > - super . bindRawText ( rawText , readDate , receiveDate , reactions , message , isItalic ) ; < nl > + < nl > + < nl > + super . bindRawText ( res , readDate , receiveDate , reactions , message , isItalic ) ; < nl > } < nl > < nl > + private class CensorSpan extends ClickableSpan { < nl > + < nl > + @ Override < nl > + public void updateDrawState ( TextPaint ds ) { < nl > + super . updateDrawState ( ds ) ; < nl > + ds . setColor ( Color . BLACK ) ; < nl > + ds . bgColor = Color . BLACK ; < nl > + ds . setUnderlineText ( false ) ; < nl > + } < nl > + < nl > + @ Override < nl > + public void onClick ( View view ) { < nl > < nl > + } < nl > + } < nl > }
NEAREST DIFF (one line): diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > index ddc22a6 . . 56b5963 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java < nl > @ @ - 1 , 13 + 1 , 24 @ @ < nl > package im . actor ; < nl > < nl > import android . graphics . Color ; < nl > + import android . view . LayoutInflater ; < nl > import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > import android . widget . CheckBox ; < nl > < nl > + import im . actor . core . api . ApiMessage ; < nl > + import im . actor . core . api . ApiTextMessage ; < nl > + import im . actor . core . entity . content . AbsContent ; < nl > + import im . actor . core . entity . content . ContentConverter ; < nl > + import im . actor . core . entity . content . TextContent ; < nl > + import im . actor . core . entity . content . internal . AbsContentContainer ; < nl > + import im . actor . core . entity . content . internal . ContentRemoteContainer ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . ActorSDKApplication ; < nl > import im . actor . sdk . ActorStyle ; < nl > import im . actor . sdk . BaseActorSDKDelegate ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsField ; < nl > import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsActivity ; < nl > @ @ - 27 , 11 + 38 , 46 @ @ public class Application extends ActorSDKApplication { < nl > < nl > ActorStyle style = ActorSDK . sharedActor ( ) . style ; < nl > style . setMainColor ( Color . parseColor ( " # 529a88 " ) ) ; < nl > + AbsContent . registerConverter ( new ContentConverter ( ) { < nl > + @ Override < nl > + public AbsContent convert ( AbsContentContainer container ) { < nl > + if ( container instanceof ContentRemoteContainer ) { < nl > + ApiMessage msg = ( ( ContentRemoteContainer ) container ) . getMessage ( ) ; < nl > + if ( msg instanceof ApiTextMessage ) { < nl > + return new TextContent ( ( ContentRemoteContainer ) container ) ; < nl > + } < nl > + } < nl > + return null ; < nl > + } < nl > + < nl > + @ Override < nl > + public Class destinationType ( ) { < nl > + return TextExContent . class ; < nl > + } < nl > + } ) ; < nl > + } < nl > + < nl > + public class TextExContent extends TextContent { < nl > + < nl > + public TextExContent ( ContentRemoteContainer remoteContainer ) { < nl > + super ( remoteContainer ) ; < nl > + } < nl > } < nl > < nl > private class ActorSDKDelegate extends BaseActorSDKDelegate { < nl > < nl > @ Override < nl > + public MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { < nl > + if ( content . isAssignableFrom ( TextExContent . class ) ) { < nl > + return new TextExHolder ( messagesAdapter , LayoutInflater < nl > + . from ( viewGroup . getContext ( ) ) < nl > + . inflate ( R . layout . adapter _ dialog _ text , viewGroup , false ) ) ; < nl > + } else { < nl > + return null ; < nl > + } < nl > + } < nl > + < nl > + @ Override < nl > public ActorIntentFragmentActivity getSettingsIntent ( ) { < nl > return new BaseActorSettingsActivity ( ) { < nl > @ Override < nl > diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java < nl > new file mode 100644 < nl > index 0000000 . . ab2ccf6 < nl > - - - / dev / null < nl > + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java < nl > @ @ - 0 , 0 + 1 , 151 @ @ < nl > + package im . actor ; < nl > + < nl > + import android . graphics . Color ; < nl > + import android . text . Spannable ; < nl > + import android . text . method . LinkMovementMethod ; < nl > + import android . view . MotionEvent ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > + import android . widget . FrameLayout ; < nl > + import android . widget . TextView ; < nl > + < nl > + import java . util . Random ; < nl > + < nl > + import im . actor . core . entity . Message ; < nl > + import im . actor . sdk . ActorSDK ; < nl > + import im . actor . sdk . R ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > + import im . actor . sdk . controllers . conversation . messages . PreprocessedData ; < nl > + import im . actor . sdk . controllers . conversation . messages . PreprocessedTextData ; < nl > + import im . actor . sdk . util . Fonts ; < nl > + import im . actor . sdk . view . TintImageView ; < nl > + < nl > + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; < nl > + < nl > + public class TextExHolder extends MessageHolder { < nl > + < nl > + protected ViewGroup mainContainer ; < nl > + protected FrameLayout messageBubble ; < nl > + protected TextView text ; < nl > + protected TextView time ; < nl > + protected TintImageView status ; < nl > + < nl > + private int waitColor ; < nl > + private int sentColor ; < nl > + private int deliveredColor ; < nl > + private int readColor ; < nl > + private int errorColor ; < nl > + < nl > + public TextExHolder ( MessagesAdapter fragment , final View itemView ) { < nl > + super ( fragment , itemView , false ) ; < nl > + < nl > + mainContainer = ( ViewGroup ) itemView . findViewById ( R . id . mainContainer ) ; < nl > + messageBubble = ( FrameLayout ) itemView . findViewById ( R . id . fl _ bubble ) ; < nl > + text = ( TextView ) itemView . findViewById ( R . id . tv _ text ) ; < nl > + text . setTextColor ( ActorSDK . sharedActor ( ) . style . getConvTextColor ( ) ) ; < nl > + text . setTypeface ( Fonts . regular ( ) ) ; < nl > + < nl > + time = ( TextView ) itemView . findViewById ( R . id . tv _ time ) ; < nl > + ActorSDK . sharedActor ( ) . style . getConvTimeColor ( ) ; < nl > + time . setTypeface ( Fonts . regular ( ) ) ; < nl > + time . setTextColor ( ActorSDK . sharedActor ( ) . style . getConvTimeColor ( ) ) ; < nl > + status = ( TintImageView ) itemView . findViewById ( R . id . stateIcon ) ; < nl > + < nl > + waitColor = ActorSDK . sharedActor ( ) . style . getConvStatePendingColor ( ) ; < nl > + sentColor = ActorSDK . sharedActor ( ) . style . getConvStateSentColor ( ) ; < nl > + deliveredColor = ActorSDK . sharedActor ( ) . style . getConvStateDeliveredColor ( ) ; < nl > + readColor = ActorSDK . sharedActor ( ) . style . getConvStateReadColor ( ) ; < nl > + errorColor = ActorSDK . sharedActor ( ) . style . getConvStateErrorColor ( ) ; < nl > + < nl > + onConfigureViewHolder ( ) ; < nl > + } < nl > + < nl > + @ Override < nl > + protected void bindData ( final Message message , boolean isUpdated , PreprocessedData preprocessedData ) { < nl > + Random rnd = new Random ( ) ; < nl > + int color = Color . argb ( 255 , rnd . nextInt ( 256 ) , rnd . nextInt ( 256 ) , rnd . nextInt ( 256 ) ) ; < nl > + text . setBackgroundColor ( color ) ; < nl > + PreprocessedTextData textData = ( PreprocessedTextData ) preprocessedData ; < nl > + Spannable reactions = preprocessedData . getReactionsSpannable ( ) ; < nl > + CharSequence text ; < nl > + if ( textData . getSpannableString ( ) ! = null ) { < nl > + text = textData . getSpannableString ( ) ; < nl > + } else { < nl > + text = textData . getText ( ) ; < nl > + } < nl > + bindRawText ( text , reactions , message , false ) ; < nl > + } < nl > + < nl > + public void bindRawText ( CharSequence rawText , Spannable reactions , Message message , boolean isItalic ) { < nl > + if ( message . getSenderId ( ) = = myUid ( ) ) { < nl > + messageBubble . setBackgroundResource ( R . drawable . bubble _ text _ out ) ; < nl > + } else { < nl > + messageBubble . setBackgroundResource ( R . drawable . bubble _ text _ in ) ; < nl > + } < nl > + < nl > + if ( isItalic ) { < nl > + text . setTypeface ( Fonts . italic ( ) ) ; < nl > + } else { < nl > + text . setTypeface ( Fonts . regular ( ) ) ; < nl > + } < nl > + < nl > + text . setText ( rawText ) ; < nl > + < nl > + / / Fixing url long tap < nl > + text . setMovementMethod ( new CustomLinkMovementMethod ( ) ) ; < nl > + < nl > + / / Fixing span offsets < nl > + / / if ( rawText instanceof Spannable ) { < nl > + / / Spannable s = ( Spannable ) rawText ; < nl > + / / QuoteSpan [ ] qSpans = s . getSpans ( 0 , s . length ( ) , QuoteSpan . class ) ; < nl > + / / text . setMinimumWidth ( 0 ) ; < nl > + / / if ( qSpans . length > 0 ) { < nl > + / / text . measure ( 0 , 0 ) ; < nl > + / / text . setMinimumWidth ( text . getMeasuredWidth ( ) + qSpans [ 0 ] . getLeadingMargin ( true ) ) ; < nl > + / / } < nl > + / / } < nl > + < nl > + if ( message . getSenderId ( ) = = myUid ( ) ) { < nl > + status . setVisibility ( View . VISIBLE ) ; < nl > + < nl > + switch ( message . getMessageState ( ) ) { < nl > + case SENT : < nl > + status . setResource ( R . drawable . msg _ check _ 1 ) ; < nl > + status . setTint ( sentColor ) ; < nl > + break ; < nl > + case RECEIVED : < nl > + status . setResource ( R . drawable . msg _ check _ 2 ) ; < nl > + status . setTint ( deliveredColor ) ; < nl > + break ; < nl > + case READ : < nl > + status . setResource ( R . drawable . msg _ check _ 2 ) ; < nl > + status . setTint ( readColor ) ; < nl > + break ; < nl > + default : < nl > + case PENDING : < nl > + status . setResource ( R . drawable . msg _ clock ) ; < nl > + status . setTint ( waitColor ) ; < nl > + break ; < nl > + case ERROR : < nl > + status . setResource ( R . drawable . msg _ error ) ; < nl > + status . setTint ( errorColor ) ; < nl > + break ; < nl > + } < nl > + } else { < nl > + status . setVisibility ( View . GONE ) ; < nl > + } < nl > + < nl > + setTimeAndReactions ( time ) ; < nl > + } < nl > + < nl > + class CustomLinkMovementMethod extends LinkMovementMethod { < nl > + < nl > + @ Override < nl > + public boolean onTouchEvent ( TextView textView , Spannable spannable , MotionEvent event ) { < nl > + super . onTouchEvent ( textView , spannable , event ) ; < nl > + mainContainer . onTouchEvent ( event ) ; < nl > + return true ; < nl > + } < nl > + } < nl > + } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > index a2a54c2 . . 3c7b187 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java < nl > @ @ - 8 , 6 + 8 , 8 @ @ import android . content . Context ; < nl > import android . content . Intent ; < nl > import android . os . Build ; < nl > import android . os . Bundle ; < nl > + import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > < nl > import com . facebook . drawee . backends . pipeline . Fresco ; < nl > < nl > @ @ - 23 , 9 + 25 , 12 @ @ import im . actor . core . ApiConfiguration ; < nl > import im . actor . core . ConfigurationBuilder ; < nl > import im . actor . core . DeviceCategory ; < nl > import im . actor . core . PlatformType ; < nl > + import im . actor . core . entity . content . AbsContent ; < nl > import im . actor . runtime . Log ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > import im . actor . sdk . controllers . fragment . auth . AuthActivity ; < nl > import im . actor . sdk . controllers . fragment . dialogs . DialogHolder ; < nl > import im . actor . sdk . controllers . fragment . settings . MyProfileActivity ; < nl > @ @ - 448 , 9 + 453 , 24 @ @ public class ActorSDK { < nl > } < nl > } < nl > < nl > + public MessageHolder getDelegatedMessageViewHolder ( Class < AbsContent > base , OnDelegateViewHolder < MessageHolder > callback , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { < nl > + MessageHolder delegated = delegate . getCustomMessageViewHolder ( base , messagesAdapter , viewGroup ) ; < nl > + if ( delegated ! = null ) { < nl > + return delegated ; < nl > + } else { < nl > + return callback . onNotDelegated ( ) ; < nl > + } < nl > + } < nl > + < nl > public interface OnDelegateViewHolder < T > { < nl > T onNotDelegated ( ) ; < nl > < nl > } < nl > < nl > + public interface OnDeligateMessageHolder { < nl > + MessageHolder onNotDelegated ( ) ; < nl > + < nl > + View getItemView ( ) ; < nl > + } < nl > + < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > index cf595a6 . . 849fa08 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java < nl > @ @ - 2 , 11 + 2 , 15 @ @ package im . actor . sdk ; < nl > < nl > import android . content . Context ; < nl > import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . core . entity . content . AbsContent ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; < nl > import im . actor . sdk . intents . ActorIntent ; < nl > @ @ - 95 , 4 + 99 , 6 @ @ public interface ActorSDKDelegate { < nl > < nl > @ Deprecated < nl > ActorSettingsCategory [ ] getAfterSettingsCategories ( ) ; < nl > + < nl > + MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) ; < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > index 1360c6d . . 75680fe 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java < nl > @ @ - 2 , 11 + 2 , 15 @ @ package im . actor . sdk ; < nl > < nl > import android . content . Context ; < nl > import android . view . View ; < nl > + import android . view . ViewGroup ; < nl > < nl > import im . actor . core . AuthState ; < nl > + import im . actor . core . entity . content . AbsContent ; < nl > import im . actor . runtime . android . view . BindedViewHolder ; < nl > import im . actor . sdk . controllers . activity . ActorMainActivity ; < nl > import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; < nl > + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; < nl > import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; < nl > import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; < nl > import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; < nl > @ @ - 141 , 5 + 145 , 10 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { < nl > return null ; < nl > } < nl > < nl > + @ Override < nl > + public MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { < nl > + return null ; < nl > + } < nl > + < nl > < nl > } < nl > diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > index 0602ada . . 486ab94 100644 < nl > - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java < nl > @ @ - 10 , 6 + 10 , 7 @ @ import java . util . HashMap ; < nl > import im . actor . core . entity . Message ; < nl > import im . actor . core . entity . content . AbsContent ; < nl > import im . actor . core . entity . content . ContactContent ; < nl > + import im . actor . core . entity . content . ContentConverter ; < nl > import im . actor . core . entity . content . DocumentContent ; < nl > import im . actor . core . entity . content . LocationContent ; < nl > import im . actor . core . entity . content . PhotoContent ; < nl > @ @ - 18 , 6 + 19 , 7 @ @ import im . actor . core . entity . content . StickerContent ; < nl > import im . actor . core . entity . content . TextContent ; < nl > import im . actor . core . entity . content . VideoContent ; < nl > import im . actor . core . entity . content . VoiceContent ; < nl > + import im . actor . runtime . actors . Actor ; < nl > import im . actor . runtime . generic . mvvm . BindedDisplayList ; < nl > import im . actor . sdk . ActorSDK ; < nl > import im . actor . sdk . R ; < nl > @ @ - 81 , 6 + 83 , 12 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > @ Override < nl > public int getItemViewType ( int position ) { < nl > AbsContent content = getItem ( position ) . getContent ( ) ; < nl > + for ( int i = 0 ; i < AbsContent . getConverters ( ) . length ; i + + ) { < nl > + ContentConverter converter = AbsContent . getConverters ( ) [ i ] ; < nl > + if ( content . getClass ( ) . isAssignableFrom ( converter . destinationType ( ) ) ) { < nl > + return 8 + i ; < nl > + } < nl > + } < nl > if ( content instanceof TextContent ) { < nl > return 0 ; < nl > } else if ( content instanceof ServiceContent ) { < nl > @ @ - 99 , 9 + 107 , 8 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > return 6 ; < nl > } else if ( content instanceof StickerContent ) { < nl > return 7 ; < nl > - } else { < nl > - return 8 ; < nl > } < nl > + return - 1 ; < nl > } < nl > < nl > protected View inflate ( int id , ViewGroup viewGroup ) { < nl > @ @ - 170 , 7 + 177 , 12 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { < nl > } < nl > } , MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ sticker , viewGroup ) ) ; < nl > default : < nl > - return new UnsupportedHolder ( MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ text , viewGroup ) ) ; < nl > + return ActorSDK . sharedActor ( ) . getDelegatedMessageViewHolder ( AbsContent . getConverters ( ) [ viewType - 8 ] . destinationType ( ) , new ActorSDK . OnDelegateViewHolder < MessageHolder > ( ) { < nl > + @ Override < nl > + public MessageHolder onNotDelegated ( ) { < nl > + return new UnsupportedHolder ( MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ text , viewGroup ) ) ; < nl > + } < nl > + } , MessagesAdapter . this , viewGroup ) ; < nl > } < nl > } < nl > < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java < nl > index da3d7f3 . . 861c52a 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java < nl > @ @ - 191 , 4 + 191 , 8 @ @ public abstract class AbsContent { < nl > < nl > public void onIncoming ( Peer peer , ModuleContext context ) { < nl > } < nl > + < nl > + public static ContentConverter [ ] getConverters ( ) { < nl > + return converters ; < nl > + } < nl > } < nl > \ No newline at end of file < nl > diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java < nl > index fe2bfe8 . . 26614b4 100644 < nl > - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java < nl > + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java < nl > @ @ - 4 , 4 + 4 , 6 @ @ import im . actor . core . entity . content . internal . AbsContentContainer ; < nl > < nl > public interface ContentConverter { < nl > AbsContent convert ( AbsContentContainer container ) ; < nl > + < nl > + Class destinationType ( ) ; < nl > }

TEST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java 
 index d357271 . . bec7683 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / CensoredTextHolderEx . java 
 @ @ - 1 , 15 + 1 , 31 @ @ 
 package im . actor ; 
 
 + import android . graphics . Color ; 
 + import android . graphics . Paint ; 
 import android . text . Spannable ; 
 + import android . text . SpannableString ; 
 + import android . text . Spanned ; 
 + import android . text . TextPaint ; 
 import android . text . TextUtils ; 
 + import android . text . style . ClickableSpan ; 
 + import android . text . style . URLSpan ; 
 import android . view . View ; 
 
 import java . util . ArrayList ; 
 + import java . util . regex . Matcher ; 
 + import java . util . regex . Pattern ; 
 
 + import im . actor . core . entity . GroupMember ; 
 import im . actor . core . entity . Message ; 
 import im . actor . core . entity . Peer ; 
 + import im . actor . core . viewmodel . UserVM ; 
 + import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 import im . actor . sdk . controllers . conversation . messages . content . TextHolder ; 
 + import im . actor . sdk . controllers . conversation . view . MentionSpan ; 
 + import im . actor . sdk . view . BaseUrlSpan ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . users ; 
 
 public class CensoredTextHolderEx extends TextHolder { 
 public CensoredTextHolderEx ( MessagesAdapter adapter , View itemView , Peer peer ) { 
 @ @ - 27 , 11 + 43 , 34 @ @ public class CensoredTextHolderEx extends TextHolder { 
 
 @ Override 
 public void bindRawText ( CharSequence rawText , long readDate , long receiveDate , Spannable reactions , Message message , boolean isItalic ) { 
 + Spannable res = new SpannableString ( rawText ) ; 
 for ( String s : badWords ) { 
 - rawText = rawText . toString ( ) . replaceAll ( " / * ( ? i ) " + s + " / * " , new String ( new char [ s . length ( ) ] ) . replace ( ' \ 0 ' , ' * ' ) ) ; 
 + / / rawText = rawText . toString ( ) . replaceAll ( " / * ( ? i ) " + s + " / * " , new String ( new char [ s . length ( ) ] ) . replace ( ' \ 0 ' , ' * ' ) ) ; 
 + Pattern p = Pattern . compile ( " / * ( ? i ) " + s + " / * " ) ; 
 + Matcher m = p . matcher ( rawText . toString ( ) ) ; 
 + while ( m . find ( ) ) { 
 + CensorSpan span = new CensorSpan ( ) ; 
 + res . setSpan ( span , m . start ( ) , m . end ( ) , Spanned . SPAN _ EXCLUSIVE _ EXCLUSIVE ) ; 
 + } 
 } 
 - super . bindRawText ( rawText , readDate , receiveDate , reactions , message , isItalic ) ; 
 + 
 + 
 + super . bindRawText ( res , readDate , receiveDate , reactions , message , isItalic ) ; 
 } 
 
 + private class CensorSpan extends ClickableSpan { 
 + 
 + @ Override 
 + public void updateDrawState ( TextPaint ds ) { 
 + super . updateDrawState ( ds ) ; 
 + ds . setColor ( Color . BLACK ) ; 
 + ds . bgColor = Color . BLACK ; 
 + ds . setUnderlineText ( false ) ; 
 + } 
 + 
 + @ Override 
 + public void onClick ( View view ) { 
 
 + } 
 + } 
 }

NEAREST DIFF:
diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 index ddc22a6 . . 56b5963 100644 
 - - - a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / Application . java 
 @ @ - 1 , 13 + 1 , 24 @ @ 
 package im . actor ; 
 
 import android . graphics . Color ; 
 + import android . view . LayoutInflater ; 
 import android . view . View ; 
 + import android . view . ViewGroup ; 
 import android . widget . CheckBox ; 
 
 + import im . actor . core . api . ApiMessage ; 
 + import im . actor . core . api . ApiTextMessage ; 
 + import im . actor . core . entity . content . AbsContent ; 
 + import im . actor . core . entity . content . ContentConverter ; 
 + import im . actor . core . entity . content . TextContent ; 
 + import im . actor . core . entity . content . internal . AbsContentContainer ; 
 + import im . actor . core . entity . content . internal . ContentRemoteContainer ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . ActorSDKApplication ; 
 import im . actor . sdk . ActorStyle ; 
 import im . actor . sdk . BaseActorSDKDelegate ; 
 + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsField ; 
 import im . actor . sdk . controllers . fragment . settings . BaseActorSettingsActivity ; 
 @ @ - 27 , 11 + 38 , 46 @ @ public class Application extends ActorSDKApplication { 
 
 ActorStyle style = ActorSDK . sharedActor ( ) . style ; 
 style . setMainColor ( Color . parseColor ( " # 529a88 " ) ) ; 
 + AbsContent . registerConverter ( new ContentConverter ( ) { 
 + @ Override 
 + public AbsContent convert ( AbsContentContainer container ) { 
 + if ( container instanceof ContentRemoteContainer ) { 
 + ApiMessage msg = ( ( ContentRemoteContainer ) container ) . getMessage ( ) ; 
 + if ( msg instanceof ApiTextMessage ) { 
 + return new TextContent ( ( ContentRemoteContainer ) container ) ; 
 + } 
 + } 
 + return null ; 
 + } 
 + 
 + @ Override 
 + public Class destinationType ( ) { 
 + return TextExContent . class ; 
 + } 
 + } ) ; 
 + } 
 + 
 + public class TextExContent extends TextContent { 
 + 
 + public TextExContent ( ContentRemoteContainer remoteContainer ) { 
 + super ( remoteContainer ) ; 
 + } 
 } 
 
 private class ActorSDKDelegate extends BaseActorSDKDelegate { 
 
 @ Override 
 + public MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { 
 + if ( content . isAssignableFrom ( TextExContent . class ) ) { 
 + return new TextExHolder ( messagesAdapter , LayoutInflater 
 + . from ( viewGroup . getContext ( ) ) 
 + . inflate ( R . layout . adapter _ dialog _ text , viewGroup , false ) ) ; 
 + } else { 
 + return null ; 
 + } 
 + } 
 + 
 + @ Override 
 public ActorIntentFragmentActivity getSettingsIntent ( ) { 
 return new BaseActorSettingsActivity ( ) { 
 @ Override 
 diff - - git a / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java 
 new file mode 100644 
 index 0000000 . . ab2ccf6 
 - - - / dev / null 
 + + + b / actor - sdk / sdk - core - android / android - app / src / main / java / im / actor / TextExHolder . java 
 @ @ - 0 , 0 + 1 , 151 @ @ 
 + package im . actor ; 
 + 
 + import android . graphics . Color ; 
 + import android . text . Spannable ; 
 + import android . text . method . LinkMovementMethod ; 
 + import android . view . MotionEvent ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 + import android . widget . FrameLayout ; 
 + import android . widget . TextView ; 
 + 
 + import java . util . Random ; 
 + 
 + import im . actor . core . entity . Message ; 
 + import im . actor . sdk . ActorSDK ; 
 + import im . actor . sdk . R ; 
 + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 + import im . actor . sdk . controllers . conversation . messages . PreprocessedData ; 
 + import im . actor . sdk . controllers . conversation . messages . PreprocessedTextData ; 
 + import im . actor . sdk . util . Fonts ; 
 + import im . actor . sdk . view . TintImageView ; 
 + 
 + import static im . actor . sdk . util . ActorSDKMessenger . myUid ; 
 + 
 + public class TextExHolder extends MessageHolder { 
 + 
 + protected ViewGroup mainContainer ; 
 + protected FrameLayout messageBubble ; 
 + protected TextView text ; 
 + protected TextView time ; 
 + protected TintImageView status ; 
 + 
 + private int waitColor ; 
 + private int sentColor ; 
 + private int deliveredColor ; 
 + private int readColor ; 
 + private int errorColor ; 
 + 
 + public TextExHolder ( MessagesAdapter fragment , final View itemView ) { 
 + super ( fragment , itemView , false ) ; 
 + 
 + mainContainer = ( ViewGroup ) itemView . findViewById ( R . id . mainContainer ) ; 
 + messageBubble = ( FrameLayout ) itemView . findViewById ( R . id . fl _ bubble ) ; 
 + text = ( TextView ) itemView . findViewById ( R . id . tv _ text ) ; 
 + text . setTextColor ( ActorSDK . sharedActor ( ) . style . getConvTextColor ( ) ) ; 
 + text . setTypeface ( Fonts . regular ( ) ) ; 
 + 
 + time = ( TextView ) itemView . findViewById ( R . id . tv _ time ) ; 
 + ActorSDK . sharedActor ( ) . style . getConvTimeColor ( ) ; 
 + time . setTypeface ( Fonts . regular ( ) ) ; 
 + time . setTextColor ( ActorSDK . sharedActor ( ) . style . getConvTimeColor ( ) ) ; 
 + status = ( TintImageView ) itemView . findViewById ( R . id . stateIcon ) ; 
 + 
 + waitColor = ActorSDK . sharedActor ( ) . style . getConvStatePendingColor ( ) ; 
 + sentColor = ActorSDK . sharedActor ( ) . style . getConvStateSentColor ( ) ; 
 + deliveredColor = ActorSDK . sharedActor ( ) . style . getConvStateDeliveredColor ( ) ; 
 + readColor = ActorSDK . sharedActor ( ) . style . getConvStateReadColor ( ) ; 
 + errorColor = ActorSDK . sharedActor ( ) . style . getConvStateErrorColor ( ) ; 
 + 
 + onConfigureViewHolder ( ) ; 
 + } 
 + 
 + @ Override 
 + protected void bindData ( final Message message , boolean isUpdated , PreprocessedData preprocessedData ) { 
 + Random rnd = new Random ( ) ; 
 + int color = Color . argb ( 255 , rnd . nextInt ( 256 ) , rnd . nextInt ( 256 ) , rnd . nextInt ( 256 ) ) ; 
 + text . setBackgroundColor ( color ) ; 
 + PreprocessedTextData textData = ( PreprocessedTextData ) preprocessedData ; 
 + Spannable reactions = preprocessedData . getReactionsSpannable ( ) ; 
 + CharSequence text ; 
 + if ( textData . getSpannableString ( ) ! = null ) { 
 + text = textData . getSpannableString ( ) ; 
 + } else { 
 + text = textData . getText ( ) ; 
 + } 
 + bindRawText ( text , reactions , message , false ) ; 
 + } 
 + 
 + public void bindRawText ( CharSequence rawText , Spannable reactions , Message message , boolean isItalic ) { 
 + if ( message . getSenderId ( ) = = myUid ( ) ) { 
 + messageBubble . setBackgroundResource ( R . drawable . bubble _ text _ out ) ; 
 + } else { 
 + messageBubble . setBackgroundResource ( R . drawable . bubble _ text _ in ) ; 
 + } 
 + 
 + if ( isItalic ) { 
 + text . setTypeface ( Fonts . italic ( ) ) ; 
 + } else { 
 + text . setTypeface ( Fonts . regular ( ) ) ; 
 + } 
 + 
 + text . setText ( rawText ) ; 
 + 
 + / / Fixing url long tap 
 + text . setMovementMethod ( new CustomLinkMovementMethod ( ) ) ; 
 + 
 + / / Fixing span offsets 
 + / / if ( rawText instanceof Spannable ) { 
 + / / Spannable s = ( Spannable ) rawText ; 
 + / / QuoteSpan [ ] qSpans = s . getSpans ( 0 , s . length ( ) , QuoteSpan . class ) ; 
 + / / text . setMinimumWidth ( 0 ) ; 
 + / / if ( qSpans . length > 0 ) { 
 + / / text . measure ( 0 , 0 ) ; 
 + / / text . setMinimumWidth ( text . getMeasuredWidth ( ) + qSpans [ 0 ] . getLeadingMargin ( true ) ) ; 
 + / / } 
 + / / } 
 + 
 + if ( message . getSenderId ( ) = = myUid ( ) ) { 
 + status . setVisibility ( View . VISIBLE ) ; 
 + 
 + switch ( message . getMessageState ( ) ) { 
 + case SENT : 
 + status . setResource ( R . drawable . msg _ check _ 1 ) ; 
 + status . setTint ( sentColor ) ; 
 + break ; 
 + case RECEIVED : 
 + status . setResource ( R . drawable . msg _ check _ 2 ) ; 
 + status . setTint ( deliveredColor ) ; 
 + break ; 
 + case READ : 
 + status . setResource ( R . drawable . msg _ check _ 2 ) ; 
 + status . setTint ( readColor ) ; 
 + break ; 
 + default : 
 + case PENDING : 
 + status . setResource ( R . drawable . msg _ clock ) ; 
 + status . setTint ( waitColor ) ; 
 + break ; 
 + case ERROR : 
 + status . setResource ( R . drawable . msg _ error ) ; 
 + status . setTint ( errorColor ) ; 
 + break ; 
 + } 
 + } else { 
 + status . setVisibility ( View . GONE ) ; 
 + } 
 + 
 + setTimeAndReactions ( time ) ; 
 + } 
 + 
 + class CustomLinkMovementMethod extends LinkMovementMethod { 
 + 
 + @ Override 
 + public boolean onTouchEvent ( TextView textView , Spannable spannable , MotionEvent event ) { 
 + super . onTouchEvent ( textView , spannable , event ) ; 
 + mainContainer . onTouchEvent ( event ) ; 
 + return true ; 
 + } 
 + } 
 + } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 index a2a54c2 . . 3c7b187 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDK . java 
 @ @ - 8 , 6 + 8 , 8 @ @ import android . content . Context ; 
 import android . content . Intent ; 
 import android . os . Build ; 
 import android . os . Bundle ; 
 + import android . view . View ; 
 + import android . view . ViewGroup ; 
 
 import com . facebook . drawee . backends . pipeline . Fresco ; 
 
 @ @ - 23 , 9 + 25 , 12 @ @ import im . actor . core . ApiConfiguration ; 
 import im . actor . core . ConfigurationBuilder ; 
 import im . actor . core . DeviceCategory ; 
 import im . actor . core . PlatformType ; 
 + import im . actor . core . entity . content . AbsContent ; 
 import im . actor . runtime . Log ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 import im . actor . sdk . controllers . fragment . auth . AuthActivity ; 
 import im . actor . sdk . controllers . fragment . dialogs . DialogHolder ; 
 import im . actor . sdk . controllers . fragment . settings . MyProfileActivity ; 
 @ @ - 448 , 9 + 453 , 24 @ @ public class ActorSDK { 
 } 
 } 
 
 + public MessageHolder getDelegatedMessageViewHolder ( Class < AbsContent > base , OnDelegateViewHolder < MessageHolder > callback , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { 
 + MessageHolder delegated = delegate . getCustomMessageViewHolder ( base , messagesAdapter , viewGroup ) ; 
 + if ( delegated ! = null ) { 
 + return delegated ; 
 + } else { 
 + return callback . onNotDelegated ( ) ; 
 + } 
 + } 
 + 
 public interface OnDelegateViewHolder < T > { 
 T onNotDelegated ( ) ; 
 
 } 
 
 + public interface OnDeligateMessageHolder { 
 + MessageHolder onNotDelegated ( ) ; 
 + 
 + View getItemView ( ) ; 
 + } 
 + 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 index cf595a6 . . 849fa08 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / ActorSDKDelegate . java 
 @ @ - 2 , 11 + 2 , 15 @ @ package im . actor . sdk ; 
 
 import android . content . Context ; 
 import android . view . View ; 
 + import android . view . ViewGroup ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . core . entity . content . AbsContent ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; 
 + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; 
 import im . actor . sdk . intents . ActorIntent ; 
 @ @ - 95 , 4 + 99 , 6 @ @ public interface ActorSDKDelegate { 
 
 @ Deprecated 
 ActorSettingsCategory [ ] getAfterSettingsCategories ( ) ; 
 + 
 + MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) ; 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 index 1360c6d . . 75680fe 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / BaseActorSDKDelegate . java 
 @ @ - 2 , 11 + 2 , 15 @ @ package im . actor . sdk ; 
 
 import android . content . Context ; 
 import android . view . View ; 
 + import android . view . ViewGroup ; 
 
 import im . actor . core . AuthState ; 
 + import im . actor . core . entity . content . AbsContent ; 
 import im . actor . runtime . android . view . BindedViewHolder ; 
 import im . actor . sdk . controllers . activity . ActorMainActivity ; 
 import im . actor . sdk . controllers . activity . controllers . MainPhoneController ; 
 + import im . actor . sdk . controllers . conversation . messages . MessageHolder ; 
 + import im . actor . sdk . controllers . conversation . messages . MessagesAdapter ; 
 import im . actor . sdk . controllers . fragment . auth . BaseAuthFragment ; 
 import im . actor . sdk . controllers . fragment . auth . SignPhoneFragment ; 
 import im . actor . sdk . controllers . fragment . settings . ActorSettingsCategory ; 
 @ @ - 141 , 5 + 145 , 10 @ @ public class BaseActorSDKDelegate implements ActorSDKDelegate { 
 return null ; 
 } 
 
 + @ Override 
 + public MessageHolder getCustomMessageViewHolder ( Class < AbsContent > content , MessagesAdapter messagesAdapter , ViewGroup viewGroup ) { 
 + return null ; 
 + } 
 + 
 
 } 
 diff - - git a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 index 0602ada . . 486ab94 100644 
 - - - a / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 + + + b / actor - sdk / sdk - core - android / android - sdk / src / main / java / im / actor / sdk / controllers / conversation / messages / MessagesAdapter . java 
 @ @ - 10 , 6 + 10 , 7 @ @ import java . util . HashMap ; 
 import im . actor . core . entity . Message ; 
 import im . actor . core . entity . content . AbsContent ; 
 import im . actor . core . entity . content . ContactContent ; 
 + import im . actor . core . entity . content . ContentConverter ; 
 import im . actor . core . entity . content . DocumentContent ; 
 import im . actor . core . entity . content . LocationContent ; 
 import im . actor . core . entity . content . PhotoContent ; 
 @ @ - 18 , 6 + 19 , 7 @ @ import im . actor . core . entity . content . StickerContent ; 
 import im . actor . core . entity . content . TextContent ; 
 import im . actor . core . entity . content . VideoContent ; 
 import im . actor . core . entity . content . VoiceContent ; 
 + import im . actor . runtime . actors . Actor ; 
 import im . actor . runtime . generic . mvvm . BindedDisplayList ; 
 import im . actor . sdk . ActorSDK ; 
 import im . actor . sdk . R ; 
 @ @ - 81 , 6 + 83 , 12 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 @ Override 
 public int getItemViewType ( int position ) { 
 AbsContent content = getItem ( position ) . getContent ( ) ; 
 + for ( int i = 0 ; i < AbsContent . getConverters ( ) . length ; i + + ) { 
 + ContentConverter converter = AbsContent . getConverters ( ) [ i ] ; 
 + if ( content . getClass ( ) . isAssignableFrom ( converter . destinationType ( ) ) ) { 
 + return 8 + i ; 
 + } 
 + } 
 if ( content instanceof TextContent ) { 
 return 0 ; 
 } else if ( content instanceof ServiceContent ) { 
 @ @ - 99 , 9 + 107 , 8 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 return 6 ; 
 } else if ( content instanceof StickerContent ) { 
 return 7 ; 
 - } else { 
 - return 8 ; 
 } 
 + return - 1 ; 
 } 
 
 protected View inflate ( int id , ViewGroup viewGroup ) { 
 @ @ - 170 , 7 + 177 , 12 @ @ public class MessagesAdapter extends BindedListAdapter < Message , MessageHolder > { 
 } 
 } , MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ sticker , viewGroup ) ) ; 
 default : 
 - return new UnsupportedHolder ( MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ text , viewGroup ) ) ; 
 + return ActorSDK . sharedActor ( ) . getDelegatedMessageViewHolder ( AbsContent . getConverters ( ) [ viewType - 8 ] . destinationType ( ) , new ActorSDK . OnDelegateViewHolder < MessageHolder > ( ) { 
 + @ Override 
 + public MessageHolder onNotDelegated ( ) { 
 + return new UnsupportedHolder ( MessagesAdapter . this , inflate ( R . layout . adapter _ dialog _ text , viewGroup ) ) ; 
 + } 
 + } , MessagesAdapter . this , viewGroup ) ; 
 } 
 } 
 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java 
 index da3d7f3 . . 861c52a 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / AbsContent . java 
 @ @ - 191 , 4 + 191 , 8 @ @ public abstract class AbsContent { 
 
 public void onIncoming ( Peer peer , ModuleContext context ) { 
 } 
 + 
 + public static ContentConverter [ ] getConverters ( ) { 
 + return converters ; 
 + } 
 } 
 \ No newline at end of file 
 diff - - git a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java 
 index fe2bfe8 . . 26614b4 100644 
 - - - a / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java 
 + + + b / actor - sdk / sdk - core / core / core - shared / src / main / java / im / actor / core / entity / content / ContentConverter . java 
 @ @ - 4 , 4 + 4 , 6 @ @ import im . actor . core . entity . content . internal . AbsContentContainer ; 
 
 public interface ContentConverter { 
 AbsContent convert ( AbsContentContainer container ) ; 
 + 
 + Class destinationType ( ) ; 
 }
