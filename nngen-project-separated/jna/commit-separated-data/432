BLEU SCORE: 0.00882875838860343

TEST MSG: add test for GetLastError interception
GENERATED MSG: Ensure the NativeLibrary does not get prematurely garbage collected when using something like :

TEST DIFF (one line): diff - - git a / src / com / sun / jna / NativeLibrary . java b / src / com / sun / jna / NativeLibrary . java <nl> index 5645c0a . . 93989c0 100644 <nl> - - - a / src / com / sun / jna / NativeLibrary . java <nl> + + + b / src / com / sun / jna / NativeLibrary . java <nl> @ @ - 382 , 7 + 382 , 8 @ @ public class NativeLibrary { <nl> <nl> / * * <nl> * Add a path to search for the specified library , ahead of any system <nl> - * paths . <nl> + * paths . This is similar to setting < code > jna . library . path < / code > , but <nl> + * only extends the search path for a single library . <nl> * <nl> * @ param libraryName The name of the library to use the path for <nl> * @ param path The path to use when trying to load the library <nl> diff - - git a / test / com / sun / jna / NativeLibraryTest . java b / test / com / sun / jna / NativeLibraryTest . java <nl> index 72d5d1d . . 0c3906f 100644 <nl> - - - a / test / com / sun / jna / NativeLibraryTest . java <nl> + + + b / test / com / sun / jna / NativeLibraryTest . java <nl> @ @ - 18 , 6 + 18 , 7 @ @ import java . util . Arrays ; <nl> import java . util . HashMap ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> + import com . sun . jna . win32 . W32APIOptions ; <nl> <nl> import junit . framework . TestCase ; <nl> <nl> @ @ - 238 , 6 + 239 , 25 @ @ public class NativeLibraryTest extends TestCase { <nl> Native . loadLibrary ( " testlib " , TestLibrary . class , options ) ; <nl> } <nl> <nl> + public interface Kernel32 { <nl> + int GetLastError ( ) ; <nl> + void SetLastError ( int code ) ; <nl> + } <nl> + public void testInterceptLastError ( ) { <nl> + if ( ! Platform . isWindows ( ) ) { <nl> + return ; <nl> + } <nl> + NativeLibrary kernel32 = ( NativeLibrary ) NativeLibrary . getInstance ( " kernel32 " , W32APIOptions . DEFAULT _ OPTIONS ) ; <nl> + Function get = kernel32 . getFunction ( " GetLastError " ) ; <nl> + Function set = kernel32 . getFunction ( " SetLastError " ) ; <nl> + assertEquals ( " SetLastError should not be customized " , Function . class , set . getClass ( ) ) ; <nl> + assertTrue ( " GetLastError should be a Function " , Function . class . isAssignableFrom ( get . getClass ( ) ) ) ; <nl> + assertTrue ( " GetLastError should be a customized Function " , get . getClass ( ) ! = Function . class ) ; <nl> + final int EXPECTED = 42 ; <nl> + set . invokeVoid ( new Object [ ] { new Integer ( EXPECTED ) } ) ; <nl> + assertEquals ( " Wrong error " , EXPECTED , get . invokeInt ( null ) ) ; <nl> + } <nl> + <nl> public static void main ( String [ ] args ) { <nl> junit . textui . TestRunner . run ( NativeLibraryTest . class ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / jnalib / dist / sunos - sparc . jar b / jnalib / dist / sunos - sparc . jar <nl> index 53b5830 . . bcc560c 100644 <nl> Binary files a / jnalib / dist / sunos - sparc . jar and b / jnalib / dist / sunos - sparc . jar differ <nl> diff - - git a / jnalib / dist / sunos - sparcv9 . jar b / jnalib / dist / sunos - sparcv9 . jar <nl> index f7d0509 . . 2f0d38b 100644 <nl> Binary files a / jnalib / dist / sunos - sparcv9 . jar and b / jnalib / dist / sunos - sparcv9 . jar differ

TEST DIFF:
diff - - git a / src / com / sun / jna / NativeLibrary . java b / src / com / sun / jna / NativeLibrary . java 
 index 5645c0a . . 93989c0 100644 
 - - - a / src / com / sun / jna / NativeLibrary . java 
 + + + b / src / com / sun / jna / NativeLibrary . java 
 @ @ - 382 , 7 + 382 , 8 @ @ public class NativeLibrary { 
 
 / * * 
 * Add a path to search for the specified library , ahead of any system 
 - * paths . 
 + * paths . This is similar to setting < code > jna . library . path < / code > , but 
 + * only extends the search path for a single library . 
 * 
 * @ param libraryName The name of the library to use the path for 
 * @ param path The path to use when trying to load the library 
 diff - - git a / test / com / sun / jna / NativeLibraryTest . java b / test / com / sun / jna / NativeLibraryTest . java 
 index 72d5d1d . . 0c3906f 100644 
 - - - a / test / com / sun / jna / NativeLibraryTest . java 
 + + + b / test / com / sun / jna / NativeLibraryTest . java 
 @ @ - 18 , 6 + 18 , 7 @ @ import java . util . Arrays ; 
 import java . util . HashMap ; 
 import java . util . List ; 
 import java . util . Map ; 
 + import com . sun . jna . win32 . W32APIOptions ; 
 
 import junit . framework . TestCase ; 
 
 @ @ - 238 , 6 + 239 , 25 @ @ public class NativeLibraryTest extends TestCase { 
 Native . loadLibrary ( " testlib " , TestLibrary . class , options ) ; 
 } 
 
 + public interface Kernel32 { 
 + int GetLastError ( ) ; 
 + void SetLastError ( int code ) ; 
 + } 
 + public void testInterceptLastError ( ) { 
 + if ( ! Platform . isWindows ( ) ) { 
 + return ; 
 + } 
 + NativeLibrary kernel32 = ( NativeLibrary ) NativeLibrary . getInstance ( " kernel32 " , W32APIOptions . DEFAULT _ OPTIONS ) ; 
 + Function get = kernel32 . getFunction ( " GetLastError " ) ; 
 + Function set = kernel32 . getFunction ( " SetLastError " ) ; 
 + assertEquals ( " SetLastError should not be customized " , Function . class , set . getClass ( ) ) ; 
 + assertTrue ( " GetLastError should be a Function " , Function . class . isAssignableFrom ( get . getClass ( ) ) ) ; 
 + assertTrue ( " GetLastError should be a customized Function " , get . getClass ( ) ! = Function . class ) ; 
 + final int EXPECTED = 42 ; 
 + set . invokeVoid ( new Object [ ] { new Integer ( EXPECTED ) } ) ; 
 + assertEquals ( " Wrong error " , EXPECTED , get . invokeInt ( null ) ) ; 
 + } 
 + 
 public static void main ( String [ ] args ) { 
 junit . textui . TestRunner . run ( NativeLibraryTest . class ) ; 
 }

NEAREST DIFF:
diff - - git a / jnalib / dist / sunos - sparc . jar b / jnalib / dist / sunos - sparc . jar 
 index 53b5830 . . bcc560c 100644 
 Binary files a / jnalib / dist / sunos - sparc . jar and b / jnalib / dist / sunos - sparc . jar differ 
 diff - - git a / jnalib / dist / sunos - sparcv9 . jar b / jnalib / dist / sunos - sparcv9 . jar 
 index f7d0509 . . 2f0d38b 100644 
 Binary files a / jnalib / dist / sunos - sparcv9 . jar and b / jnalib / dist / sunos - sparcv9 . jar differ
