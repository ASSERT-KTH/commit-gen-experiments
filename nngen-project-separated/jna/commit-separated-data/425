BLEU SCORE: 0.16186478197091597

TEST MSG: fix broken test
GENERATED MSG: Provide optional library synchronization

TEST DIFF (one line): diff - - git a / src / com / sun / jna / Library . java b / src / com / sun / jna / Library . java <nl> index 621e4f3 . . 5928e79 100644 <nl> - - - a / src / com / sun / jna / Library . java <nl> + + + b / src / com / sun / jna / Library . java <nl> @ @ - 118 , 20 + 118 , 6 @ @ public interface Library { <nl> } <nl> } <nl> <nl> - private static class FunctionNameMap implements FunctionMapper { <nl> - private final Map map ; <nl> - public FunctionNameMap ( Map map ) { <nl> - this . map = new HashMap ( map ) ; <nl> - } <nl> - public String getFunctionName ( NativeLibrary library , Method method ) { <nl> - String name = method . getName ( ) ; <nl> - if ( map . containsKey ( name ) ) { <nl> - return ( String ) map . get ( name ) ; <nl> - } <nl> - return name ; <nl> - } <nl> - } <nl> - <nl> private final NativeLibrary nativeLibrary ; <nl> private final Class interfaceClass ; <nl> / / Library invocation options <nl> @ @ - 154 , 9 + 140 , 8 @ @ public interface Library { <nl> options . put ( OPTION _ CALLING _ CONVENTION , <nl> new Integer ( callingConvention ) ) ; <nl> } <nl> - if ( ! options . containsKey ( OPTION _ FUNCTION _ MAPPER ) ) { <nl> - / / Passed - in map is itself the name map <nl> - options . put ( OPTION _ FUNCTION _ MAPPER , new FunctionNameMap ( options ) ) ; <nl> + if ( options . get ( OPTION _ CLASSLOADER ) = = null ) { <nl> + options . put ( OPTION _ CLASSLOADER , interfaceClass . getClassLoader ( ) ) ; <nl> } <nl> this . options = options ; <nl> this . nativeLibrary = NativeLibrary . getInstance ( libname , options ) ; <nl> diff - - git a / src / com / sun / jna / Native . java b / src / com / sun / jna / Native . java <nl> index 8b73b16 . . 7c83c73 100644 <nl> - - - a / src / com / sun / jna / Native . java <nl> + + + b / src / com / sun / jna / Native . java <nl> @ @ - 1481 , 6 + 1481 , 7 @ @ public final class Native implements Version { <nl> looking them up later . <nl> * / <nl> private static void cacheOptions ( Class cls , Map libOptions , Object proxy ) { <nl> + libOptions = new HashMap ( libOptions ) ; <nl> synchronized ( libraries ) { <nl> options . put ( cls , libOptions ) ; <nl> if ( proxy ! = null ) { <nl> diff - - git a / test / com / sun / jna / NativeTest . java b / test / com / sun / jna / NativeTest . java <nl> index 521774d . . a946ca8 100644 <nl> - - - a / test / com / sun / jna / NativeTest . java <nl> + + + b / test / com / sun / jna / NativeTest . java <nl> @ @ - 111 , 7 + 111 , 7 @ @ public class NativeTest extends TestCase { <nl> } <nl> public void testSynchronizedAccess ( ) throws Exception { <nl> final boolean [ ] lockHeld = { false } ; <nl> - final NativeLibrary nlib = NativeLibrary . getInstance ( " testlib " ) ; <nl> + final NativeLibrary nlib = NativeLibrary . getInstance ( " testlib " , TestLib . class . getClassLoader ( ) ) ; <nl> final TestLib lib = ( TestLib ) Native . loadLibrary ( " testlib " , TestLib . class ) ; <nl> final TestLib synchlib = ( TestLib ) Native . synchronizedLibrary ( lib ) ; <nl> final TestLib . VoidCallback cb = new TestLib . VoidCallback ( ) { <nl> @ @ - 168 , 6 + 168 , 7 @ @ public class NativeTest extends TestCase { <nl> TypeMapper TEST _ MAPPER = new DefaultTypeMapper ( ) ; <nl> String TEST _ ENCODING = " test - encoding " ; <nl> Map TEST _ OPTS = new HashMap ( ) { { <nl> + put ( OPTION _ CLASSLOADER , TestInterfaceWithInstance . class . getClassLoader ( ) ) ; <nl> put ( OPTION _ TYPE _ MAPPER , TEST _ MAPPER ) ; <nl> put ( OPTION _ STRUCTURE _ ALIGNMENT , new Integer ( TEST _ ALIGNMENT ) ) ; <nl> put ( OPTION _ STRING _ ENCODING , TEST _ ENCODING ) ;
NEAREST DIFF (one line): diff - - git a / www / index . html b / www / index . html <nl> index 17bd37b . . 7cc8fe8 100644 <nl> - - - a / www / index . html <nl> + + + b / www / index . html <nl> @ @ - 3 , 7 + 3 , 7 @ @ <nl> < meta name = " author " content = " Timothy Wall " > <nl> < meta name = " keywords " content = " java , jna , jni , c / c + + , native , method , function , call , ctypes , ffi , foreign function interface , jdirect , jinvoke , pinvoke , platform invoke , native library access , native access , call native from java , java c library , easy jni , call c code from java , avoid jni " > <nl> < meta name = " description " content = " Java Native Access ( JNA ) : access native libraries with pure Java code . " > <nl> - < meta name = " date " content = " 2007 - 09 - 10 " > <nl> + < meta name = " date " content = " 2007 - 09 - 22 " > <nl> < title > Java Native Access ( JNA ) : Pure Java access to native libraries < / title > <nl> < meta http - equiv = " Content - Type " content = " text / html ; charset = iso - 8859 - 1 " > <nl> < / head > <nl> @ @ - 269 , 13 + 269 , 15 @ @ the JNA library ( and are pretty nifty utilities in and of themselves ) . <nl> < / ul > <nl> < h3 > Projects Using JNA < / h3 > <nl> < ul > <nl> - < li > < a href = " http : / / jruby . codehaus . org " > JRuby < / a > <nl> - < li > < a href = " http : / / glossitope . org " > Glossitope ( AKA ab5k ) < / a > <nl> - < li > < a href = " http : / / code . google . com / p / gstreamer - java " > gstreamer - java < / a > <nl> - < li > < a href = " http : / / fmj . sf . net " > Freedom for Media in Java ( FMJ ) < / a > <nl> - < li > < a href = " https : / / jna . dev . java . net / source / browse / jna / trunk / jnalib / contrib " > Miscellaneous contributed mappings and utilities < / a > <nl> + < li > < a href = " http : / / jruby . codehaus . org " > JRuby < / a > ( Charles Nutter ) <nl> + < li > < a href = " http : / / glossitope . org " > Glossitope ( AKA ab5k ) < / a > ( Josh Marinacci ) <nl> + < li > < a href = " http : / / code . google . com / p / gstreamer - java " > gstreamer for Java < / a > ( Wayne Meissner ) <nl> + < li > < a href = " http : / / fmj . sf . net " > Freedom for Media in Java ( FMJ ) < / a > ( Ken Larson / Dieter Krachtus ) <nl> + < li > < a href = " http : / / ochafik . free . fr / blog / ? p = 98 " > Detect User Inactivity < / a > ( Olivier Chafik ) <nl> + < li > < a href = " http : / / sellmic . com / blog / 2007 / 05 / 22 / javafx - clock - update - now - with - transparency " > A JavaFX Clock < / a > ( Augusto Sellhorn ) <nl> + < li > < a href = " https : / / jna . dev . java . net / source / browse / jna / trunk / jnalib / contrib " > Miscellaneous contributed mappings and utilities ( including Windows NT Service , Registry , and User Account libraries ) . < / a > <nl> < / ul > <nl> - Contact twall AT dev DOT java DOT net to include your project in this list , or if you ' d likely to contribute a library mapping you ' ve written . <nl> + Contact twalljava AT dev DOT java DOT net to include your project in this list , or if you ' d likely to contribute a library mapping you ' ve written . <nl> <nl> < h3 > Development Tasks < / h3 > <nl> < p > The library works fairly well now , but there are a number of tasks with which we ' d appreciate help : < / p >

TEST DIFF:
diff - - git a / src / com / sun / jna / Library . java b / src / com / sun / jna / Library . java 
 index 621e4f3 . . 5928e79 100644 
 - - - a / src / com / sun / jna / Library . java 
 + + + b / src / com / sun / jna / Library . java 
 @ @ - 118 , 20 + 118 , 6 @ @ public interface Library { 
 } 
 } 
 
 - private static class FunctionNameMap implements FunctionMapper { 
 - private final Map map ; 
 - public FunctionNameMap ( Map map ) { 
 - this . map = new HashMap ( map ) ; 
 - } 
 - public String getFunctionName ( NativeLibrary library , Method method ) { 
 - String name = method . getName ( ) ; 
 - if ( map . containsKey ( name ) ) { 
 - return ( String ) map . get ( name ) ; 
 - } 
 - return name ; 
 - } 
 - } 
 - 
 private final NativeLibrary nativeLibrary ; 
 private final Class interfaceClass ; 
 / / Library invocation options 
 @ @ - 154 , 9 + 140 , 8 @ @ public interface Library { 
 options . put ( OPTION _ CALLING _ CONVENTION , 
 new Integer ( callingConvention ) ) ; 
 } 
 - if ( ! options . containsKey ( OPTION _ FUNCTION _ MAPPER ) ) { 
 - / / Passed - in map is itself the name map 
 - options . put ( OPTION _ FUNCTION _ MAPPER , new FunctionNameMap ( options ) ) ; 
 + if ( options . get ( OPTION _ CLASSLOADER ) = = null ) { 
 + options . put ( OPTION _ CLASSLOADER , interfaceClass . getClassLoader ( ) ) ; 
 } 
 this . options = options ; 
 this . nativeLibrary = NativeLibrary . getInstance ( libname , options ) ; 
 diff - - git a / src / com / sun / jna / Native . java b / src / com / sun / jna / Native . java 
 index 8b73b16 . . 7c83c73 100644 
 - - - a / src / com / sun / jna / Native . java 
 + + + b / src / com / sun / jna / Native . java 
 @ @ - 1481 , 6 + 1481 , 7 @ @ public final class Native implements Version { 
 looking them up later . 
 * / 
 private static void cacheOptions ( Class cls , Map libOptions , Object proxy ) { 
 + libOptions = new HashMap ( libOptions ) ; 
 synchronized ( libraries ) { 
 options . put ( cls , libOptions ) ; 
 if ( proxy ! = null ) { 
 diff - - git a / test / com / sun / jna / NativeTest . java b / test / com / sun / jna / NativeTest . java 
 index 521774d . . a946ca8 100644 
 - - - a / test / com / sun / jna / NativeTest . java 
 + + + b / test / com / sun / jna / NativeTest . java 
 @ @ - 111 , 7 + 111 , 7 @ @ public class NativeTest extends TestCase { 
 } 
 public void testSynchronizedAccess ( ) throws Exception { 
 final boolean [ ] lockHeld = { false } ; 
 - final NativeLibrary nlib = NativeLibrary . getInstance ( " testlib " ) ; 
 + final NativeLibrary nlib = NativeLibrary . getInstance ( " testlib " , TestLib . class . getClassLoader ( ) ) ; 
 final TestLib lib = ( TestLib ) Native . loadLibrary ( " testlib " , TestLib . class ) ; 
 final TestLib synchlib = ( TestLib ) Native . synchronizedLibrary ( lib ) ; 
 final TestLib . VoidCallback cb = new TestLib . VoidCallback ( ) { 
 @ @ - 168 , 6 + 168 , 7 @ @ public class NativeTest extends TestCase { 
 TypeMapper TEST _ MAPPER = new DefaultTypeMapper ( ) ; 
 String TEST _ ENCODING = " test - encoding " ; 
 Map TEST _ OPTS = new HashMap ( ) { { 
 + put ( OPTION _ CLASSLOADER , TestInterfaceWithInstance . class . getClassLoader ( ) ) ; 
 put ( OPTION _ TYPE _ MAPPER , TEST _ MAPPER ) ; 
 put ( OPTION _ STRUCTURE _ ALIGNMENT , new Integer ( TEST _ ALIGNMENT ) ) ; 
 put ( OPTION _ STRING _ ENCODING , TEST _ ENCODING ) ;

NEAREST DIFF:
diff - - git a / www / index . html b / www / index . html 
 index 17bd37b . . 7cc8fe8 100644 
 - - - a / www / index . html 
 + + + b / www / index . html 
 @ @ - 3 , 7 + 3 , 7 @ @ 
 < meta name = " author " content = " Timothy Wall " > 
 < meta name = " keywords " content = " java , jna , jni , c / c + + , native , method , function , call , ctypes , ffi , foreign function interface , jdirect , jinvoke , pinvoke , platform invoke , native library access , native access , call native from java , java c library , easy jni , call c code from java , avoid jni " > 
 < meta name = " description " content = " Java Native Access ( JNA ) : access native libraries with pure Java code . " > 
 - < meta name = " date " content = " 2007 - 09 - 10 " > 
 + < meta name = " date " content = " 2007 - 09 - 22 " > 
 < title > Java Native Access ( JNA ) : Pure Java access to native libraries < / title > 
 < meta http - equiv = " Content - Type " content = " text / html ; charset = iso - 8859 - 1 " > 
 < / head > 
 @ @ - 269 , 13 + 269 , 15 @ @ the JNA library ( and are pretty nifty utilities in and of themselves ) . 
 < / ul > 
 < h3 > Projects Using JNA < / h3 > 
 < ul > 
 - < li > < a href = " http : / / jruby . codehaus . org " > JRuby < / a > 
 - < li > < a href = " http : / / glossitope . org " > Glossitope ( AKA ab5k ) < / a > 
 - < li > < a href = " http : / / code . google . com / p / gstreamer - java " > gstreamer - java < / a > 
 - < li > < a href = " http : / / fmj . sf . net " > Freedom for Media in Java ( FMJ ) < / a > 
 - < li > < a href = " https : / / jna . dev . java . net / source / browse / jna / trunk / jnalib / contrib " > Miscellaneous contributed mappings and utilities < / a > 
 + < li > < a href = " http : / / jruby . codehaus . org " > JRuby < / a > ( Charles Nutter ) 
 + < li > < a href = " http : / / glossitope . org " > Glossitope ( AKA ab5k ) < / a > ( Josh Marinacci ) 
 + < li > < a href = " http : / / code . google . com / p / gstreamer - java " > gstreamer for Java < / a > ( Wayne Meissner ) 
 + < li > < a href = " http : / / fmj . sf . net " > Freedom for Media in Java ( FMJ ) < / a > ( Ken Larson / Dieter Krachtus ) 
 + < li > < a href = " http : / / ochafik . free . fr / blog / ? p = 98 " > Detect User Inactivity < / a > ( Olivier Chafik ) 
 + < li > < a href = " http : / / sellmic . com / blog / 2007 / 05 / 22 / javafx - clock - update - now - with - transparency " > A JavaFX Clock < / a > ( Augusto Sellhorn ) 
 + < li > < a href = " https : / / jna . dev . java . net / source / browse / jna / trunk / jnalib / contrib " > Miscellaneous contributed mappings and utilities ( including Windows NT Service , Registry , and User Account libraries ) . < / a > 
 < / ul > 
 - Contact twall AT dev DOT java DOT net to include your project in this list , or if you ' d likely to contribute a library mapping you ' ve written . 
 + Contact twalljava AT dev DOT java DOT net to include your project in this list , or if you ' d likely to contribute a library mapping you ' ve written . 
 
 < h3 > Development Tasks < / h3 > 
 < p > The library works fairly well now , but there are a number of tasks with which we ' d appreciate help : < / p >
