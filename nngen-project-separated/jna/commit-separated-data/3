BLEU SCORE: 0.02383853510228548

TEST MSG: Fix usage of JDK internal APIs by using BouncyCastle
GENERATED MSG: added some test

TEST DIFF (one line): diff - - git a / contrib / platform / nbproject / project . properties b / contrib / platform / nbproject / project . properties <nl> index 0f17e61 . . fe6ceb7 100644 <nl> - - - a / contrib / platform / nbproject / project . properties <nl> + + + b / contrib / platform / nbproject / project . properties <nl> @ @ - 29 , 6 + 29 , 8 @ @ dist . jar = $ { dist . dir } / jna - platform . jar <nl> dist . javadoc . dir = $ { dist . dir } / javadoc <nl> endorsed . classpath = <nl> excludes = <nl> + file . reference . bcpkix - jdk15on - 161 . jar = . . / . . / lib / test / bcpkix - jdk15on - 161 . jar <nl> + file . reference . bcprov - jdk15on - 161 . jar = . . / . . / lib / test / bcprov - jdk15on - 161 . jar <nl> file . reference . hamcrest - core - 1 . 3 . jar = . . / . . / lib / hamcrest - core - 1 . 3 . jar <nl> file . reference . jna . jar = . . / . . / build / jna . jar <nl> file . reference . jna - test . jar = . . / . . / build / jna - test . jar <nl> @ @ - 57 , 7 + 59 , 9 @ @ javac . test . classpath = \ <nl> $ { file . reference . jna - test . jar } : \ <nl> $ { build . classes . dir } : \ <nl> $ { file . reference . junit . jar } : \ <nl> - $ { file . reference . hamcrest - core - 1 . 3 . jar } <nl> + $ { file . reference . hamcrest - core - 1 . 3 . jar } : \ <nl> + $ { file . reference . bcpkix - jdk15on - 161 . jar } : \ <nl> + $ { file . reference . bcprov - jdk15on - 161 . jar } <nl> javadoc . additionalparam = <nl> javadoc . author = false <nl> javadoc . encoding = <nl> diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java b / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java <nl> index d6f6ab2 . . 50f0b01 100644 <nl> - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java <nl> + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java <nl> @ @ - 25 , 8 + 25 , 6 @ @ package com . sun . jna . platform . win32 ; <nl> import java . security . * ; <nl> import java . security . cert . X509Certificate ; <nl> <nl> - import sun . security . tools . keytool . * ; <nl> - import sun . security . x509 . X500Name ; <nl> import com . sun . jna . Native ; <nl> import com . sun . jna . platform . win32 . WinCrypt . DATA _ BLOB ; <nl> import com . sun . jna . ptr . PointerByReference ; <nl> @ @ - 40 , 15 + 38 , 29 @ @ import com . sun . jna . platform . win32 . WinCryptUtil . MANAGED _ CRYPT _ SIGN _ MESSAGE _ PARA ; <nl> import java . io . ByteArrayOutputStream ; <nl> import java . io . IOException ; <nl> import java . io . InputStream ; <nl> + import java . math . BigInteger ; <nl> import java . util . Arrays ; <nl> + import java . util . Date ; <nl> import java . util . List ; <nl> + import java . util . logging . Level ; <nl> + import java . util . logging . Logger ; <nl> <nl> import junit . framework . TestCase ; <nl> + import org . bouncycastle . asn1 . x500 . X500Name ; <nl> + import org . bouncycastle . cert . X509v3CertificateBuilder ; <nl> + import org . bouncycastle . cert . jcajce . JcaX509CertificateConverter ; <nl> + import org . bouncycastle . cert . jcajce . JcaX509v3CertificateBuilder ; <nl> + import org . bouncycastle . jce . provider . BouncyCastleProvider ; <nl> + import org . bouncycastle . operator . ContentSigner ; <nl> + import org . bouncycastle . operator . jcajce . JcaContentSignerBuilder ; <nl> <nl> / * * <nl> * @ author dblock [ at ] dblock [ dot ] org <nl> * / <nl> public class Crypt32Test extends TestCase { <nl> + <nl> + private static final Logger LOG = Logger . getLogger ( Crypt32Test . class . getName ( ) ) ; <nl> + <nl> private static final String TESTCERT _ CN = " cryptsigntest " ; <nl> <nl> / * * <nl> @ @ - 391 , 14 + 403 , 30 @ @ public class Crypt32Test extends TestCase { <nl> KeyStore keyStore = KeyStore . getInstance ( " Windows - MY " , " SunMSCAPI " ) ; <nl> keyStore . load ( null , null ) ; <nl> <nl> - CertAndKeyGen certAndKeyGen = new CertAndKeyGen ( " RSA " , " SHA256WithRSA " , null ) ; <nl> - certAndKeyGen . generate ( 1024 ) ; <nl> + X500Name xx500Name = new X500Name ( " CN = cryptsigntest " ) ; <nl> + <nl> + KeyPairGenerator keyGen = KeyPairGenerator . getInstance ( " RSA " ) ; <nl> + keyGen . initialize ( 2048 ) ; <nl> + KeyPair key = keyGen . generateKeyPair ( ) ; <nl> + PrivateKey privKey = key . getPrivate ( ) ; <nl> + PublicKey pubKey = key . getPublic ( ) ; <nl> + <nl> + ContentSigner sigGen = new JcaContentSignerBuilder ( " SHA256withRSA " ) . build ( privKey ) ; <nl> + X509v3CertificateBuilder certGen = new JcaX509v3CertificateBuilder ( <nl> + xx500Name , <nl> + BigInteger . valueOf ( 1 ) , <nl> + new Date ( System . currentTimeMillis ( ) - 5 * 60 * 1000 ) , <nl> + new Date ( ( long ) ( System . currentTimeMillis ( ) + 24L * 60L * 60L * 1000L ) ) , <nl> + xx500Name , / / Subject <nl> + pubKey / / Publickey to be associated with the certificate <nl> + ) ; <nl> <nl> - X509Certificate certificate = certAndKeyGen . getSelfCertificate ( new X500Name ( " CN = cryptsigntest " ) , 24 * 60 * 60 ) ; <nl> + Provider BC = new BouncyCastleProvider ( ) ; <nl> + X509Certificate certificate = new JcaX509CertificateConverter ( ) . setProvider ( BC ) . getCertificate ( certGen . build ( sigGen ) ) ; <nl> <nl> - keyStore . setKeyEntry ( TESTCERT _ CN , certAndKeyGen . getPrivateKey ( ) , null , new X509Certificate [ ] { certificate } ) ; <nl> + keyStore . setKeyEntry ( TESTCERT _ CN , privKey , null , new X509Certificate [ ] { certificate } ) ; <nl> } catch ( Exception e ) { <nl> - System . out . println ( " Unable to complete test . Certificate creation failed . " ) ; <nl> + LOG . log ( Level . SEVERE , " Unable to complete test . Certificate creation failed . " , e ) ; <nl> return false ; <nl> } <nl> <nl> diff - - git a / lib / test / bcpkix - jdk15on - 161 . jar b / lib / test / bcpkix - jdk15on - 161 . jar <nl> new file mode 100644 <nl> index 0000000 . . c9657cd <nl> Binary files / dev / null and b / lib / test / bcpkix - jdk15on - 161 . jar differ <nl> diff - - git a / lib / test / bcprov - jdk15on - 161 . jar b / lib / test / bcprov - jdk15on - 161 . jar <nl> new file mode 100644 <nl> index 0000000 . . 1fdff38 <nl> Binary files / dev / null and b / lib / test / bcprov - jdk15on - 161 . jar differ
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / contrib / platform / nbproject / project . properties b / contrib / platform / nbproject / project . properties 
 index 0f17e61 . . fe6ceb7 100644 
 - - - a / contrib / platform / nbproject / project . properties 
 + + + b / contrib / platform / nbproject / project . properties 
 @ @ - 29 , 6 + 29 , 8 @ @ dist . jar = $ { dist . dir } / jna - platform . jar 
 dist . javadoc . dir = $ { dist . dir } / javadoc 
 endorsed . classpath = 
 excludes = 
 + file . reference . bcpkix - jdk15on - 161 . jar = . . / . . / lib / test / bcpkix - jdk15on - 161 . jar 
 + file . reference . bcprov - jdk15on - 161 . jar = . . / . . / lib / test / bcprov - jdk15on - 161 . jar 
 file . reference . hamcrest - core - 1 . 3 . jar = . . / . . / lib / hamcrest - core - 1 . 3 . jar 
 file . reference . jna . jar = . . / . . / build / jna . jar 
 file . reference . jna - test . jar = . . / . . / build / jna - test . jar 
 @ @ - 57 , 7 + 59 , 9 @ @ javac . test . classpath = \ 
 $ { file . reference . jna - test . jar } : \ 
 $ { build . classes . dir } : \ 
 $ { file . reference . junit . jar } : \ 
 - $ { file . reference . hamcrest - core - 1 . 3 . jar } 
 + $ { file . reference . hamcrest - core - 1 . 3 . jar } : \ 
 + $ { file . reference . bcpkix - jdk15on - 161 . jar } : \ 
 + $ { file . reference . bcprov - jdk15on - 161 . jar } 
 javadoc . additionalparam = 
 javadoc . author = false 
 javadoc . encoding = 
 diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java b / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java 
 index d6f6ab2 . . 50f0b01 100644 
 - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java 
 + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Crypt32Test . java 
 @ @ - 25 , 8 + 25 , 6 @ @ package com . sun . jna . platform . win32 ; 
 import java . security . * ; 
 import java . security . cert . X509Certificate ; 
 
 - import sun . security . tools . keytool . * ; 
 - import sun . security . x509 . X500Name ; 
 import com . sun . jna . Native ; 
 import com . sun . jna . platform . win32 . WinCrypt . DATA _ BLOB ; 
 import com . sun . jna . ptr . PointerByReference ; 
 @ @ - 40 , 15 + 38 , 29 @ @ import com . sun . jna . platform . win32 . WinCryptUtil . MANAGED _ CRYPT _ SIGN _ MESSAGE _ PARA ; 
 import java . io . ByteArrayOutputStream ; 
 import java . io . IOException ; 
 import java . io . InputStream ; 
 + import java . math . BigInteger ; 
 import java . util . Arrays ; 
 + import java . util . Date ; 
 import java . util . List ; 
 + import java . util . logging . Level ; 
 + import java . util . logging . Logger ; 
 
 import junit . framework . TestCase ; 
 + import org . bouncycastle . asn1 . x500 . X500Name ; 
 + import org . bouncycastle . cert . X509v3CertificateBuilder ; 
 + import org . bouncycastle . cert . jcajce . JcaX509CertificateConverter ; 
 + import org . bouncycastle . cert . jcajce . JcaX509v3CertificateBuilder ; 
 + import org . bouncycastle . jce . provider . BouncyCastleProvider ; 
 + import org . bouncycastle . operator . ContentSigner ; 
 + import org . bouncycastle . operator . jcajce . JcaContentSignerBuilder ; 
 
 / * * 
 * @ author dblock [ at ] dblock [ dot ] org 
 * / 
 public class Crypt32Test extends TestCase { 
 + 
 + private static final Logger LOG = Logger . getLogger ( Crypt32Test . class . getName ( ) ) ; 
 + 
 private static final String TESTCERT _ CN = " cryptsigntest " ; 
 
 / * * 
 @ @ - 391 , 14 + 403 , 30 @ @ public class Crypt32Test extends TestCase { 
 KeyStore keyStore = KeyStore . getInstance ( " Windows - MY " , " SunMSCAPI " ) ; 
 keyStore . load ( null , null ) ; 
 
 - CertAndKeyGen certAndKeyGen = new CertAndKeyGen ( " RSA " , " SHA256WithRSA " , null ) ; 
 - certAndKeyGen . generate ( 1024 ) ; 
 + X500Name xx500Name = new X500Name ( " CN = cryptsigntest " ) ; 
 + 
 + KeyPairGenerator keyGen = KeyPairGenerator . getInstance ( " RSA " ) ; 
 + keyGen . initialize ( 2048 ) ; 
 + KeyPair key = keyGen . generateKeyPair ( ) ; 
 + PrivateKey privKey = key . getPrivate ( ) ; 
 + PublicKey pubKey = key . getPublic ( ) ; 
 + 
 + ContentSigner sigGen = new JcaContentSignerBuilder ( " SHA256withRSA " ) . build ( privKey ) ; 
 + X509v3CertificateBuilder certGen = new JcaX509v3CertificateBuilder ( 
 + xx500Name , 
 + BigInteger . valueOf ( 1 ) , 
 + new Date ( System . currentTimeMillis ( ) - 5 * 60 * 1000 ) , 
 + new Date ( ( long ) ( System . currentTimeMillis ( ) + 24L * 60L * 60L * 1000L ) ) , 
 + xx500Name , / / Subject 
 + pubKey / / Publickey to be associated with the certificate 
 + ) ; 
 
 - X509Certificate certificate = certAndKeyGen . getSelfCertificate ( new X500Name ( " CN = cryptsigntest " ) , 24 * 60 * 60 ) ; 
 + Provider BC = new BouncyCastleProvider ( ) ; 
 + X509Certificate certificate = new JcaX509CertificateConverter ( ) . setProvider ( BC ) . getCertificate ( certGen . build ( sigGen ) ) ; 
 
 - keyStore . setKeyEntry ( TESTCERT _ CN , certAndKeyGen . getPrivateKey ( ) , null , new X509Certificate [ ] { certificate } ) ; 
 + keyStore . setKeyEntry ( TESTCERT _ CN , privKey , null , new X509Certificate [ ] { certificate } ) ; 
 } catch ( Exception e ) { 
 - System . out . println ( " Unable to complete test . Certificate creation failed . " ) ; 
 + LOG . log ( Level . SEVERE , " Unable to complete test . Certificate creation failed . " , e ) ; 
 return false ; 
 } 
 
 diff - - git a / lib / test / bcpkix - jdk15on - 161 . jar b / lib / test / bcpkix - jdk15on - 161 . jar 
 new file mode 100644 
 index 0000000 . . c9657cd 
 Binary files / dev / null and b / lib / test / bcpkix - jdk15on - 161 . jar differ 
 diff - - git a / lib / test / bcprov - jdk15on - 161 . jar b / lib / test / bcprov - jdk15on - 161 . jar 
 new file mode 100644 
 index 0000000 . . 1fdff38 
 Binary files / dev / null and b / lib / test / bcprov - jdk15on - 161 . jar differ

NEAREST DIFF:
ELIMINATEDSENTENCE
