BLEU SCORE: 0.10682175159905853

TEST MSG: Final changes based on feedback
GENERATED MSG: some changes

TEST DIFF (one line): diff - - git a / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java b / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java <nl> index f6b30dc . . ecb23c5 100755 <nl> - - - a / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java <nl> + + + b / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java <nl> @ @ - 2661 , 11 + 2661 , 10 @ @ public abstract class Advapi32Util { <nl> <nl> / * * <nl> * Construct and enable a set of privileges <nl> - * @ param privileges the name of the privileges in the form of SE _ * from Advapi32 . java <nl> - * @ enable if true , enable the privilege immediately . <nl> + * @ param privileges the names of the privileges in the form of SE _ * from Advapi32 . java <nl> * @ throws IllegalArgumentException <nl> * / <nl> - public Privilege ( String [ ] privileges , boolean enable ) throws IllegalArgumentException , Win32Exception { <nl> + public Privilege ( String . . . privileges ) throws IllegalArgumentException , Win32Exception { <nl> pLuids = new WinNT . LUID [ privileges . length ] ; <nl> int i = 0 ; <nl> for ( String p : privileges ) { <nl> @ @ - 2675 , 12 + 2674 , 10 @ @ public abstract class Advapi32Util { <nl> } <nl> i + + ; <nl> } <nl> - if ( enable ) <nl> - this . enable ( ) ; <nl> } <nl> <nl> / * * <nl> - * Calls { @ link # disable } to remove the privileges <nl> + * Calls disable ( ) to remove the privileges <nl> * @ see java . io . Closeable # close ( ) <nl> * / <nl> @ Override <nl> @ @ - 2695 , 10 + 2692 , 10 @ @ public abstract class Advapi32Util { <nl> * @ return pointer to self ( Privilege ) as a convenience for try with resources statements <nl> * @ throws Win32Exception <nl> * / <nl> - public void enable ( ) throws Win32Exception { <nl> + public Privilege enable ( ) throws Win32Exception { <nl> / / Ignore if already enabled . <nl> if ( privilegesEnabled ) <nl> - return ; <nl> + return this ; <nl> <nl> / / Get thread token <nl> final HANDLEByReference phThreadToken = new HANDLEByReference ( ) ; <nl> @ @ - 2740 , 6 + 2737 , 7 @ @ public abstract class Advapi32Util { <nl> phThreadToken . setValue ( null ) ; <nl> } <nl> } <nl> + return this ; <nl> } <nl> <nl> / * * <nl> diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java b / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java <nl> index 693e519 . . 6a60cde 100755 <nl> - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java <nl> + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java <nl> @ @ - 24 , 6 + 24 , 7 @ @ import java . util . TreeMap ; <nl> import com . sun . jna . platform . win32 . Advapi32Util . Account ; <nl> import com . sun . jna . platform . win32 . Advapi32Util . EventLogIterator ; <nl> import com . sun . jna . platform . win32 . Advapi32Util . EventLogRecord ; <nl> + import com . sun . jna . platform . win32 . Advapi32Util . Privilege ; <nl> import com . sun . jna . platform . win32 . LMAccess . USER _ INFO _ 1 ; <nl> import com . sun . jna . platform . win32 . WinNT . HANDLE ; <nl> import com . sun . jna . platform . win32 . WinNT . HANDLEByReference ; <nl> @ @ - 604 , 13 + 605 , 18 @ @ public class Advapi32UtilTest extends TestCase { <nl> * / <nl> public void testPrivilege ( ) { <nl> / / Test multiple known privileges <nl> - try ( Advapi32Util . Privilege p = new Advapi32Util . Privilege ( new String [ ] { WinNT . SE _ ASSIGNPRIMARYTOKEN _ NAME , WinNT . SE _ BACKUP _ NAME } , true ) ; ) { <nl> + Privilege privilege = new Privilege ( WinNT . SE _ ASSIGNPRIMARYTOKEN _ NAME , WinNT . SE _ BACKUP _ NAME ) ; <nl> + try { <nl> + privilege . enable ( ) ; <nl> / / Will throw if it fails p . enable ( ) fails <nl> } <nl> + finally { <nl> + privilege . close ( ) ; <nl> + } <nl> <nl> / / Test unknown privilege <nl> - try ( Advapi32Util . Privilege p = new Advapi32Util . Privilege ( new String [ ] { " NOT _ A _ PRIVILEGE " } , true ) ; ) { <nl> - / / Will throw if it fails p . enable ( ) fails <nl> + try { <nl> + privilege = new Privilege ( " NOT _ A _ PRIVILEGE " ) ; <nl> } <nl> catch ( IllegalArgumentException ex ) { <nl> / / Exception is expected <nl> @ @ - 618 , 6 + 624 , 9 @ @ public class Advapi32UtilTest extends TestCase { <nl> catch ( Exception ex ) { <nl> fail ( " Encountered unknown exception - " + ex . getMessage ( ) ) ; <nl> } <nl> + finally { <nl> + privilege . close ( ) ; <nl> + } <nl> } <nl> <nl> private File createTempFile ( ) throws Exception { <nl> diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java b / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java <nl> index 18f9f8e . . b0ca34c 100644 <nl> - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java <nl> + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java <nl> @ @ - 643 , 8 + 643 , 9 @ @ public class Kernel32Test extends TestCase { <nl> delLink . deleteOnExit ( ) ; <nl> <nl> / / Required for FSCTL _ SET _ REPARSE _ POINT <nl> - try ( Advapi32Util . Privilege restore = new Advapi32Util . Privilege ( new String [ ] { WinNT . SE _ RESTORE _ NAME } , true ) ) { <nl> - <nl> + Advapi32Util . Privilege restore = new Advapi32Util . Privilege ( WinNT . SE _ RESTORE _ NAME ) ; <nl> + try { <nl> + restore . enable ( ) ; <nl> HANDLE hFile = Kernel32 . INSTANCE . CreateFile ( link . toAbsolutePath ( ) . toString ( ) , <nl> WinNT . GENERIC _ READ | WinNT . FILE _ WRITE _ ATTRIBUTES | WinNT . FILE _ WRITE _ EA , <nl> WinNT . FILE _ SHARE _ READ | WinNT . FILE _ SHARE _ WRITE | WinNT . FILE _ SHARE _ DELETE , <nl> @ @ - 693 , 6 + 694 , 9 @ @ public class Kernel32Test extends TestCase { <nl> Kernel32Util . closeHandle ( hFile ) ; <nl> } <nl> } <nl> + finally { <nl> + restore . close ( ) ; <nl> + } <nl> } <nl> <nl> public void testCopyFile ( ) throws IOException {
NEAREST DIFF (one line): diff - - git a / ChangeLog b / ChangeLog <nl> index 289d195 . . ff76645 100644 <nl> - - - a / ChangeLog <nl> + + + b / ChangeLog <nl> @ @ - 1 , 3 + 1 , 13 @ @ <nl> + 2013 - 01 - 10 Anthony Green < green @ moxielogic . com > <nl> + <nl> + 	 * configure . ac : Put local . exp in the right place . <nl> + 	 * configure : Rebuilt . <nl> + <nl> + 	 * src / x86 / ffi . c : Update comment about regparm function attributes . <nl> + 	 * src / x86 / sysv . S ( ffi _ closure _ SYSV ) : The SUNPRO compiler requires <nl> + 	 that all function arguments be passed on the stack ( no regparm <nl> + 	 support ) . <nl> + <nl> 2013 - 01 - 08 Anthony Green < green @ moxielogic . com > <nl> <nl> 	 * configure . ac : Generate local . exp . This sets CC _ FOR _ TARGET <nl> diff - - git a / configure b / configure <nl> index 5876eb7 . . 4a12b96 100755 <nl> - - - a / configure <nl> + + + b / configure <nl> @ @ - 13068 , 10 + 13068 , 10 @ @ ac _ compiler _ gnu = $ ac _ cv _ c _ compiler _ gnu <nl> <nl> if test " x $ GCC " = " xyes " ; then <nl> CFLAGS = " $ CFLAGS - fexceptions " <nl> - touch testsuite / local . exp <nl> + touch local . exp <nl> else <nl> cat > local . exp < < EOF <nl> - set CC _ FOR _ TARGET $ CC <nl> + set CC _ FOR _ TARGET " $ CC " <nl> EOF <nl> fi <nl> <nl> diff - - git a / configure . ac b / configure . ac <nl> index 7ffb36c . . 13d5bc2 100644 <nl> - - - a / configure . ac <nl> + + + b / configure . ac <nl> @ @ - 40 , 10 + 40 , 10 @ @ AX _ CC _ MAXOPT <nl> AX _ CFLAGS _ WARN _ ALL <nl> if test " x $ GCC " = " xyes " ; then <nl> CFLAGS = " $ CFLAGS - fexceptions " <nl> - touch testsuite / local . exp <nl> + touch local . exp <nl> else <nl> cat > local . exp < < EOF <nl> - set CC _ FOR _ TARGET $ CC <nl> + set CC _ FOR _ TARGET " $ CC " <nl> EOF <nl> fi <nl> <nl> diff - - git a / src / x86 / ffi . c b / src / x86 / ffi . c <nl> index 611e221 . . 3f46693 100644 <nl> - - - a / src / x86 / ffi . c <nl> + + + b / src / x86 / ffi . c <nl> @ @ - 424 , 7 + 424 , 7 @ @ void ffi _ call ( ffi _ cif * cif , void ( * fn ) ( void ) , void * rvalue , void * * avalue ) <nl> / * * private members * * / <nl> <nl> / * The following _ _ attribute _ _ ( ( regparm ( 1 ) ) ) decorations will have no effect <nl> - on MSVC - standard cdecl convention applies . * / <nl> + on MSVC or SUNPRO _ C - - standard conventions apply . * / <nl> static void ffi _ prep _ incoming _ args _ SYSV ( char * stack , void * * ret , <nl> void * * args , ffi _ cif * cif ) ; <nl> void FFI _ HIDDEN ffi _ closure _ SYSV ( ffi _ closure * ) <nl> diff - - git a / src / x86 / sysv . S b / src / x86 / sysv . S <nl> index 69e7e8d . . 71502bb 100644 <nl> - - - a / src / x86 / sysv . S <nl> + + + b / src / x86 / sysv . S <nl> @ @ - 182 , 9 + 182 , 19 @ @ ffi _ closure _ SYSV : <nl> 	 leal 	 - 24 ( % ebp ) , % edx <nl> 	 movl 	 % edx , - 12 ( % ebp ) 	 / * resp * / <nl> 	 leal 	 8 ( % ebp ) , % edx <nl> + # ifdef _ _ SUNPRO _ C <nl> + 	 / * The SUNPRO compiler doesn ' t support GCC ' s regparm function <nl> + 	 attribute , so we have to pass all three arguments to <nl> + 	 ffi _ closure _ SYSV _ inner on the stack . * / <nl> + 	 movl 	 % edx , 8 ( % esp ) 	 / * args = _ _ builtin _ dwarf _ cfa ( ) * / <nl> + 	 leal 	 - 12 ( % ebp ) , % edx <nl> + 	 movl 	 % edx , 4 ( % esp ) 	 / * & resp * / <nl> + 	 movl % eax , ( % esp ) / * closure * / <nl> + # else <nl> 	 movl 	 % edx , 4 ( % esp ) 	 / * args = _ _ builtin _ dwarf _ cfa ( ) * / <nl> 	 leal 	 - 12 ( % ebp ) , % edx <nl> 	 movl 	 % edx , ( % esp ) 	 / * & resp * / <nl> + # endif <nl> # if defined HAVE _ HIDDEN _ VISIBILITY _ ATTRIBUTE | | ! defined _ _ PIC _ _ <nl> 	 call 	 ffi _ closure _ SYSV _ inner <nl> # else

TEST DIFF:
diff - - git a / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java b / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java 
 index f6b30dc . . ecb23c5 100755 
 - - - a / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java 
 + + + b / contrib / platform / src / com / sun / jna / platform / win32 / Advapi32Util . java 
 @ @ - 2661 , 11 + 2661 , 10 @ @ public abstract class Advapi32Util { 
 
 / * * 
 * Construct and enable a set of privileges 
 - * @ param privileges the name of the privileges in the form of SE _ * from Advapi32 . java 
 - * @ enable if true , enable the privilege immediately . 
 + * @ param privileges the names of the privileges in the form of SE _ * from Advapi32 . java 
 * @ throws IllegalArgumentException 
 * / 
 - public Privilege ( String [ ] privileges , boolean enable ) throws IllegalArgumentException , Win32Exception { 
 + public Privilege ( String . . . privileges ) throws IllegalArgumentException , Win32Exception { 
 pLuids = new WinNT . LUID [ privileges . length ] ; 
 int i = 0 ; 
 for ( String p : privileges ) { 
 @ @ - 2675 , 12 + 2674 , 10 @ @ public abstract class Advapi32Util { 
 } 
 i + + ; 
 } 
 - if ( enable ) 
 - this . enable ( ) ; 
 } 
 
 / * * 
 - * Calls { @ link # disable } to remove the privileges 
 + * Calls disable ( ) to remove the privileges 
 * @ see java . io . Closeable # close ( ) 
 * / 
 @ Override 
 @ @ - 2695 , 10 + 2692 , 10 @ @ public abstract class Advapi32Util { 
 * @ return pointer to self ( Privilege ) as a convenience for try with resources statements 
 * @ throws Win32Exception 
 * / 
 - public void enable ( ) throws Win32Exception { 
 + public Privilege enable ( ) throws Win32Exception { 
 / / Ignore if already enabled . 
 if ( privilegesEnabled ) 
 - return ; 
 + return this ; 
 
 / / Get thread token 
 final HANDLEByReference phThreadToken = new HANDLEByReference ( ) ; 
 @ @ - 2740 , 6 + 2737 , 7 @ @ public abstract class Advapi32Util { 
 phThreadToken . setValue ( null ) ; 
 } 
 } 
 + return this ; 
 } 
 
 / * * 
 diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java b / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java 
 index 693e519 . . 6a60cde 100755 
 - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java 
 + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Advapi32UtilTest . java 
 @ @ - 24 , 6 + 24 , 7 @ @ import java . util . TreeMap ; 
 import com . sun . jna . platform . win32 . Advapi32Util . Account ; 
 import com . sun . jna . platform . win32 . Advapi32Util . EventLogIterator ; 
 import com . sun . jna . platform . win32 . Advapi32Util . EventLogRecord ; 
 + import com . sun . jna . platform . win32 . Advapi32Util . Privilege ; 
 import com . sun . jna . platform . win32 . LMAccess . USER _ INFO _ 1 ; 
 import com . sun . jna . platform . win32 . WinNT . HANDLE ; 
 import com . sun . jna . platform . win32 . WinNT . HANDLEByReference ; 
 @ @ - 604 , 13 + 605 , 18 @ @ public class Advapi32UtilTest extends TestCase { 
 * / 
 public void testPrivilege ( ) { 
 / / Test multiple known privileges 
 - try ( Advapi32Util . Privilege p = new Advapi32Util . Privilege ( new String [ ] { WinNT . SE _ ASSIGNPRIMARYTOKEN _ NAME , WinNT . SE _ BACKUP _ NAME } , true ) ; ) { 
 + Privilege privilege = new Privilege ( WinNT . SE _ ASSIGNPRIMARYTOKEN _ NAME , WinNT . SE _ BACKUP _ NAME ) ; 
 + try { 
 + privilege . enable ( ) ; 
 / / Will throw if it fails p . enable ( ) fails 
 } 
 + finally { 
 + privilege . close ( ) ; 
 + } 
 
 / / Test unknown privilege 
 - try ( Advapi32Util . Privilege p = new Advapi32Util . Privilege ( new String [ ] { " NOT _ A _ PRIVILEGE " } , true ) ; ) { 
 - / / Will throw if it fails p . enable ( ) fails 
 + try { 
 + privilege = new Privilege ( " NOT _ A _ PRIVILEGE " ) ; 
 } 
 catch ( IllegalArgumentException ex ) { 
 / / Exception is expected 
 @ @ - 618 , 6 + 624 , 9 @ @ public class Advapi32UtilTest extends TestCase { 
 catch ( Exception ex ) { 
 fail ( " Encountered unknown exception - " + ex . getMessage ( ) ) ; 
 } 
 + finally { 
 + privilege . close ( ) ; 
 + } 
 } 
 
 private File createTempFile ( ) throws Exception { 
 diff - - git a / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java b / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java 
 index 18f9f8e . . b0ca34c 100644 
 - - - a / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java 
 + + + b / contrib / platform / test / com / sun / jna / platform / win32 / Kernel32Test . java 
 @ @ - 643 , 8 + 643 , 9 @ @ public class Kernel32Test extends TestCase { 
 delLink . deleteOnExit ( ) ; 
 
 / / Required for FSCTL _ SET _ REPARSE _ POINT 
 - try ( Advapi32Util . Privilege restore = new Advapi32Util . Privilege ( new String [ ] { WinNT . SE _ RESTORE _ NAME } , true ) ) { 
 - 
 + Advapi32Util . Privilege restore = new Advapi32Util . Privilege ( WinNT . SE _ RESTORE _ NAME ) ; 
 + try { 
 + restore . enable ( ) ; 
 HANDLE hFile = Kernel32 . INSTANCE . CreateFile ( link . toAbsolutePath ( ) . toString ( ) , 
 WinNT . GENERIC _ READ | WinNT . FILE _ WRITE _ ATTRIBUTES | WinNT . FILE _ WRITE _ EA , 
 WinNT . FILE _ SHARE _ READ | WinNT . FILE _ SHARE _ WRITE | WinNT . FILE _ SHARE _ DELETE , 
 @ @ - 693 , 6 + 694 , 9 @ @ public class Kernel32Test extends TestCase { 
 Kernel32Util . closeHandle ( hFile ) ; 
 } 
 } 
 + finally { 
 + restore . close ( ) ; 
 + } 
 } 
 
 public void testCopyFile ( ) throws IOException {

NEAREST DIFF:
diff - - git a / ChangeLog b / ChangeLog 
 index 289d195 . . ff76645 100644 
 - - - a / ChangeLog 
 + + + b / ChangeLog 
 @ @ - 1 , 3 + 1 , 13 @ @ 
 + 2013 - 01 - 10 Anthony Green < green @ moxielogic . com > 
 + 
 + 	 * configure . ac : Put local . exp in the right place . 
 + 	 * configure : Rebuilt . 
 + 
 + 	 * src / x86 / ffi . c : Update comment about regparm function attributes . 
 + 	 * src / x86 / sysv . S ( ffi _ closure _ SYSV ) : The SUNPRO compiler requires 
 + 	 that all function arguments be passed on the stack ( no regparm 
 + 	 support ) . 
 + 
 2013 - 01 - 08 Anthony Green < green @ moxielogic . com > 
 
 	 * configure . ac : Generate local . exp . This sets CC _ FOR _ TARGET 
 diff - - git a / configure b / configure 
 index 5876eb7 . . 4a12b96 100755 
 - - - a / configure 
 + + + b / configure 
 @ @ - 13068 , 10 + 13068 , 10 @ @ ac _ compiler _ gnu = $ ac _ cv _ c _ compiler _ gnu 
 
 if test " x $ GCC " = " xyes " ; then 
 CFLAGS = " $ CFLAGS - fexceptions " 
 - touch testsuite / local . exp 
 + touch local . exp 
 else 
 cat > local . exp < < EOF 
 - set CC _ FOR _ TARGET $ CC 
 + set CC _ FOR _ TARGET " $ CC " 
 EOF 
 fi 
 
 diff - - git a / configure . ac b / configure . ac 
 index 7ffb36c . . 13d5bc2 100644 
 - - - a / configure . ac 
 + + + b / configure . ac 
 @ @ - 40 , 10 + 40 , 10 @ @ AX _ CC _ MAXOPT 
 AX _ CFLAGS _ WARN _ ALL 
 if test " x $ GCC " = " xyes " ; then 
 CFLAGS = " $ CFLAGS - fexceptions " 
 - touch testsuite / local . exp 
 + touch local . exp 
 else 
 cat > local . exp < < EOF 
 - set CC _ FOR _ TARGET $ CC 
 + set CC _ FOR _ TARGET " $ CC " 
 EOF 
 fi 
 
 diff - - git a / src / x86 / ffi . c b / src / x86 / ffi . c 
 index 611e221 . . 3f46693 100644 
 - - - a / src / x86 / ffi . c 
 + + + b / src / x86 / ffi . c 
 @ @ - 424 , 7 + 424 , 7 @ @ void ffi _ call ( ffi _ cif * cif , void ( * fn ) ( void ) , void * rvalue , void * * avalue ) 
 / * * private members * * / 
 
 / * The following _ _ attribute _ _ ( ( regparm ( 1 ) ) ) decorations will have no effect 
 - on MSVC - standard cdecl convention applies . * / 
 + on MSVC or SUNPRO _ C - - standard conventions apply . * / 
 static void ffi _ prep _ incoming _ args _ SYSV ( char * stack , void * * ret , 
 void * * args , ffi _ cif * cif ) ; 
 void FFI _ HIDDEN ffi _ closure _ SYSV ( ffi _ closure * ) 
 diff - - git a / src / x86 / sysv . S b / src / x86 / sysv . S 
 index 69e7e8d . . 71502bb 100644 
 - - - a / src / x86 / sysv . S 
 + + + b / src / x86 / sysv . S 
 @ @ - 182 , 9 + 182 , 19 @ @ ffi _ closure _ SYSV : 
 	 leal 	 - 24 ( % ebp ) , % edx 
 	 movl 	 % edx , - 12 ( % ebp ) 	 / * resp * / 
 	 leal 	 8 ( % ebp ) , % edx 
 + # ifdef _ _ SUNPRO _ C 
 + 	 / * The SUNPRO compiler doesn ' t support GCC ' s regparm function 
 + 	 attribute , so we have to pass all three arguments to 
 + 	 ffi _ closure _ SYSV _ inner on the stack . * / 
 + 	 movl 	 % edx , 8 ( % esp ) 	 / * args = _ _ builtin _ dwarf _ cfa ( ) * / 
 + 	 leal 	 - 12 ( % ebp ) , % edx 
 + 	 movl 	 % edx , 4 ( % esp ) 	 / * & resp * / 
 + 	 movl % eax , ( % esp ) / * closure * / 
 + # else 
 	 movl 	 % edx , 4 ( % esp ) 	 / * args = _ _ builtin _ dwarf _ cfa ( ) * / 
 	 leal 	 - 12 ( % ebp ) , % edx 
 	 movl 	 % edx , ( % esp ) 	 / * & resp * / 
 + # endif 
 # if defined HAVE _ HIDDEN _ VISIBILITY _ ATTRIBUTE | | ! defined _ _ PIC _ _ 
 	 call 	 ffi _ closure _ SYSV _ inner 
 # else
