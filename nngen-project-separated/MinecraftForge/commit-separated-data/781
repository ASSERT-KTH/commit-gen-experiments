BLEU SCORE: 0.0367352656298894

TEST MSG: Pass exceptions thrown in mod event buses back to FML to handle apropriately
GENERATED MSG: Try harder to find a mod container .

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / fml / common / LoadController . java b / src / main / java / net / minecraftforge / fml / common / LoadController . java <nl> index 3a5a60a . . 59429b6 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / common / LoadController . java <nl> + + + b / src / main / java / net / minecraftforge / fml / common / LoadController . java <nl> @ @ - 44 , 6 + 44 , 8 @ @ import com . google . common . collect . Maps ; <nl> import com . google . common . collect . Multimap ; <nl> import com . google . common . eventbus . EventBus ; <nl> import com . google . common . eventbus . Subscribe ; <nl> + import com . google . common . eventbus . SubscriberExceptionHandler ; <nl> + import com . google . common . eventbus . SubscriberExceptionContext ; <nl> <nl> public class LoadController <nl> { <nl> @ @ - 88 , 10 + 90 , 18 @ @ public class LoadController <nl> { <nl> Builder < String , EventBus > eventBus = ImmutableMap . builder ( ) ; <nl> <nl> - for ( ModContainer mod : loader . getModList ( ) ) <nl> + for ( final ModContainer mod : loader . getModList ( ) ) <nl> { <nl> / / Create mod logger , and make the EventBus logger a child of it . <nl> - EventBus bus = new EventBus ( mod . getModId ( ) ) ; <nl> + EventBus bus = new EventBus ( new SubscriberExceptionHandler ( ) <nl> + { <nl> + @ Override <nl> + public void handleException ( final Throwable exception , final SubscriberExceptionContext context ) <nl> + { <nl> + LoadController . this . errorOccurred ( mod , exception ) ; <nl> + } <nl> + } ) ; <nl> + <nl> boolean isActive = mod . registerBus ( bus , this ) ; <nl> if ( isActive ) <nl> {
NEAREST DIFF (one line): diff - - git a / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java b / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java <nl> index 95bac54 . . b77e137 100644 <nl> - - - a / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java <nl> + + + b / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java <nl> @ @ - 19 , 6 + 19 , 7 @ @ import java . util . List ; <nl> import java . util . Map ; <nl> import java . util . Set ; <nl> <nl> + import com . google . common . collect . ImmutableList ; <nl> import com . google . common . eventbus . EventBus ; <nl> <nl> import cpw . mods . fml . common . versioning . ArtifactVersion ; <nl> @ @ - 193 , 4 + 194 , 10 @ @ public class DummyModContainer implements ModContainer <nl> { <nl> return null ; <nl> } <nl> + <nl> + @ Override <nl> + public List < String > getOwnedPackages ( ) <nl> + { <nl> + return ImmutableList . of ( ) ; <nl> + } <nl> } <nl> diff - - git a / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java b / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java <nl> index f2c6079 . . ff6ed96 100644 <nl> - - - a / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java <nl> + + + b / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java <nl> @ @ - 624 , 4 + 624 , 10 @ @ public class FMLModContainer implements ModContainer <nl> { <nl> return ( String ) descriptor . get ( " guiFactory " ) ; <nl> } <nl> + <nl> + @ Override <nl> + public List < String > getOwnedPackages ( ) <nl> + { <nl> + return candidate . getContainedPackages ( ) ; <nl> + } <nl> } <nl> diff - - git a / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java b / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java <nl> index 1907f43 . . 5da03c6 100644 <nl> - - - a / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java <nl> + + + b / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java <nl> @ @ - 195 , 4 + 195 , 10 @ @ public class InjectedModContainer implements ModContainer <nl> { <nl> return wrappedContainer . getGuiClassName ( ) ; <nl> } <nl> + <nl> + @ Override <nl> + public List < String > getOwnedPackages ( ) <nl> + { <nl> + return wrappedContainer . getOwnedPackages ( ) ; <nl> + } <nl> } <nl> diff - - git a / fml / src / main / java / cpw / mods / fml / common / LoadController . java b / fml / src / main / java / cpw / mods / fml / common / LoadController . java <nl> index 826cab7 . . 1f61310 100644 <nl> - - - a / fml / src / main / java / cpw / mods / fml / common / LoadController . java <nl> + + + b / fml / src / main / java / cpw / mods / fml / common / LoadController . java <nl> @ @ - 29 , 6 + 29 , 7 @ @ import com . google . common . collect . ImmutableBiMap ; <nl> import com . google . common . collect . ImmutableMap ; <nl> import com . google . common . collect . ImmutableMap . Builder ; <nl> import com . google . common . collect . Iterables ; <nl> + import com . google . common . collect . ListMultimap ; <nl> import com . google . common . collect . Lists ; <nl> import com . google . common . collect . Maps ; <nl> import com . google . common . collect . Multimap ; <nl> @ @ - 55 , 6 + 56 , 7 @ @ public class LoadController <nl> private List < ModContainer > activeModList = Lists . newArrayList ( ) ; <nl> private ModContainer activeContainer ; <nl> private BiMap < ModContainer , Object > modObjectList ; <nl> + private ListMultimap < String , ModContainer > packageOwners ; <nl> <nl> public LoadController ( Loader loader ) <nl> { <nl> @ @ - 63 , 7 + 65 , 7 @ @ public class LoadController <nl> this . masterChannel . register ( this ) ; <nl> <nl> state = LoaderState . NOINIT ; <nl> - <nl> + packageOwners = ArrayListMultimap . create ( ) ; <nl> <nl> } <nl> <nl> @ @ - 171 , 7 + 173 , 7 @ @ public class LoadController <nl> <nl> public ModContainer activeContainer ( ) <nl> { <nl> - return activeContainer ; <nl> + return activeContainer ! = null ? activeContainer : findActiveContainerFromStack ( ) ; <nl> } <nl> <nl> @ Subscribe <nl> @ @ - 229 , 6 + 231 , 11 @ @ public class LoadController <nl> if ( ! mc . isImmutable ( ) & & mc . getMod ( ) ! = null ) <nl> { <nl> builder . put ( mc , mc . getMod ( ) ) ; <nl> + List < String > packages = mc . getOwnedPackages ( ) ; <nl> + for ( String pkg : packages ) <nl> + { <nl> + packageOwners . put ( pkg , mc ) ; <nl> + } <nl> } <nl> if ( mc . getMod ( ) = = null & & ! mc . isImmutable ( ) & & state ! = LoaderState . CONSTRUCTING ) <nl> { <nl> @ @ - 309 , 4 + 316 , 37 @ @ public class LoadController <nl> { <nl> this . state = newState ; <nl> } <nl> + <nl> + private ModContainer findActiveContainerFromStack ( ) <nl> + { <nl> + for ( Class < ? > c : getCallingStack ( ) ) <nl> + { <nl> + int idx = c . getName ( ) . lastIndexOf ( ' . ' ) ; <nl> + if ( idx = = - 1 ) <nl> + { <nl> + continue ; <nl> + } <nl> + String pkg = c . getName ( ) . substring ( 0 , idx ) ; <nl> + if ( packageOwners . containsKey ( pkg ) ) <nl> + { <nl> + return packageOwners . get ( pkg ) . get ( 0 ) ; <nl> + } <nl> + } <nl> + <nl> + return null ; <nl> + } <nl> + private FMLSecurityManager accessibleManager = new FMLSecurityManager ( ) ; <nl> + <nl> + class FMLSecurityManager extends SecurityManager <nl> + { <nl> + Class < ? > [ ] getStackClasses ( ) <nl> + { <nl> + return getClassContext ( ) ; <nl> + } <nl> + } <nl> + <nl> + Class < ? > [ ] getCallingStack ( ) <nl> + { <nl> + return accessibleManager . getStackClasses ( ) ; <nl> + } <nl> } <nl> diff - - git a / fml / src / main / java / cpw / mods / fml / common / ModContainer . java b / fml / src / main / java / cpw / mods / fml / common / ModContainer . java <nl> index 1641788 . . abed85d 100644 <nl> - - - a / fml / src / main / java / cpw / mods / fml / common / ModContainer . java <nl> + + + b / fml / src / main / java / cpw / mods / fml / common / ModContainer . java <nl> @ @ - 145 , 4 + 145 , 6 @ @ public interface ModContainer <nl> Disableable canBeDisabled ( ) ; <nl> <nl> String getGuiClassName ( ) ; <nl> + <nl> + List < String > getOwnedPackages ( ) ; <nl> }

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / fml / common / LoadController . java b / src / main / java / net / minecraftforge / fml / common / LoadController . java 
 index 3a5a60a . . 59429b6 100644 
 - - - a / src / main / java / net / minecraftforge / fml / common / LoadController . java 
 + + + b / src / main / java / net / minecraftforge / fml / common / LoadController . java 
 @ @ - 44 , 6 + 44 , 8 @ @ import com . google . common . collect . Maps ; 
 import com . google . common . collect . Multimap ; 
 import com . google . common . eventbus . EventBus ; 
 import com . google . common . eventbus . Subscribe ; 
 + import com . google . common . eventbus . SubscriberExceptionHandler ; 
 + import com . google . common . eventbus . SubscriberExceptionContext ; 
 
 public class LoadController 
 { 
 @ @ - 88 , 10 + 90 , 18 @ @ public class LoadController 
 { 
 Builder < String , EventBus > eventBus = ImmutableMap . builder ( ) ; 
 
 - for ( ModContainer mod : loader . getModList ( ) ) 
 + for ( final ModContainer mod : loader . getModList ( ) ) 
 { 
 / / Create mod logger , and make the EventBus logger a child of it . 
 - EventBus bus = new EventBus ( mod . getModId ( ) ) ; 
 + EventBus bus = new EventBus ( new SubscriberExceptionHandler ( ) 
 + { 
 + @ Override 
 + public void handleException ( final Throwable exception , final SubscriberExceptionContext context ) 
 + { 
 + LoadController . this . errorOccurred ( mod , exception ) ; 
 + } 
 + } ) ; 
 + 
 boolean isActive = mod . registerBus ( bus , this ) ; 
 if ( isActive ) 
 {

NEAREST DIFF:
diff - - git a / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java b / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java 
 index 95bac54 . . b77e137 100644 
 - - - a / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java 
 + + + b / fml / src / main / java / cpw / mods / fml / common / DummyModContainer . java 
 @ @ - 19 , 6 + 19 , 7 @ @ import java . util . List ; 
 import java . util . Map ; 
 import java . util . Set ; 
 
 + import com . google . common . collect . ImmutableList ; 
 import com . google . common . eventbus . EventBus ; 
 
 import cpw . mods . fml . common . versioning . ArtifactVersion ; 
 @ @ - 193 , 4 + 194 , 10 @ @ public class DummyModContainer implements ModContainer 
 { 
 return null ; 
 } 
 + 
 + @ Override 
 + public List < String > getOwnedPackages ( ) 
 + { 
 + return ImmutableList . of ( ) ; 
 + } 
 } 
 diff - - git a / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java b / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java 
 index f2c6079 . . ff6ed96 100644 
 - - - a / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java 
 + + + b / fml / src / main / java / cpw / mods / fml / common / FMLModContainer . java 
 @ @ - 624 , 4 + 624 , 10 @ @ public class FMLModContainer implements ModContainer 
 { 
 return ( String ) descriptor . get ( " guiFactory " ) ; 
 } 
 + 
 + @ Override 
 + public List < String > getOwnedPackages ( ) 
 + { 
 + return candidate . getContainedPackages ( ) ; 
 + } 
 } 
 diff - - git a / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java b / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java 
 index 1907f43 . . 5da03c6 100644 
 - - - a / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java 
 + + + b / fml / src / main / java / cpw / mods / fml / common / InjectedModContainer . java 
 @ @ - 195 , 4 + 195 , 10 @ @ public class InjectedModContainer implements ModContainer 
 { 
 return wrappedContainer . getGuiClassName ( ) ; 
 } 
 + 
 + @ Override 
 + public List < String > getOwnedPackages ( ) 
 + { 
 + return wrappedContainer . getOwnedPackages ( ) ; 
 + } 
 } 
 diff - - git a / fml / src / main / java / cpw / mods / fml / common / LoadController . java b / fml / src / main / java / cpw / mods / fml / common / LoadController . java 
 index 826cab7 . . 1f61310 100644 
 - - - a / fml / src / main / java / cpw / mods / fml / common / LoadController . java 
 + + + b / fml / src / main / java / cpw / mods / fml / common / LoadController . java 
 @ @ - 29 , 6 + 29 , 7 @ @ import com . google . common . collect . ImmutableBiMap ; 
 import com . google . common . collect . ImmutableMap ; 
 import com . google . common . collect . ImmutableMap . Builder ; 
 import com . google . common . collect . Iterables ; 
 + import com . google . common . collect . ListMultimap ; 
 import com . google . common . collect . Lists ; 
 import com . google . common . collect . Maps ; 
 import com . google . common . collect . Multimap ; 
 @ @ - 55 , 6 + 56 , 7 @ @ public class LoadController 
 private List < ModContainer > activeModList = Lists . newArrayList ( ) ; 
 private ModContainer activeContainer ; 
 private BiMap < ModContainer , Object > modObjectList ; 
 + private ListMultimap < String , ModContainer > packageOwners ; 
 
 public LoadController ( Loader loader ) 
 { 
 @ @ - 63 , 7 + 65 , 7 @ @ public class LoadController 
 this . masterChannel . register ( this ) ; 
 
 state = LoaderState . NOINIT ; 
 - 
 + packageOwners = ArrayListMultimap . create ( ) ; 
 
 } 
 
 @ @ - 171 , 7 + 173 , 7 @ @ public class LoadController 
 
 public ModContainer activeContainer ( ) 
 { 
 - return activeContainer ; 
 + return activeContainer ! = null ? activeContainer : findActiveContainerFromStack ( ) ; 
 } 
 
 @ Subscribe 
 @ @ - 229 , 6 + 231 , 11 @ @ public class LoadController 
 if ( ! mc . isImmutable ( ) & & mc . getMod ( ) ! = null ) 
 { 
 builder . put ( mc , mc . getMod ( ) ) ; 
 + List < String > packages = mc . getOwnedPackages ( ) ; 
 + for ( String pkg : packages ) 
 + { 
 + packageOwners . put ( pkg , mc ) ; 
 + } 
 } 
 if ( mc . getMod ( ) = = null & & ! mc . isImmutable ( ) & & state ! = LoaderState . CONSTRUCTING ) 
 { 
 @ @ - 309 , 4 + 316 , 37 @ @ public class LoadController 
 { 
 this . state = newState ; 
 } 
 + 
 + private ModContainer findActiveContainerFromStack ( ) 
 + { 
 + for ( Class < ? > c : getCallingStack ( ) ) 
 + { 
 + int idx = c . getName ( ) . lastIndexOf ( ' . ' ) ; 
 + if ( idx = = - 1 ) 
 + { 
 + continue ; 
 + } 
 + String pkg = c . getName ( ) . substring ( 0 , idx ) ; 
 + if ( packageOwners . containsKey ( pkg ) ) 
 + { 
 + return packageOwners . get ( pkg ) . get ( 0 ) ; 
 + } 
 + } 
 + 
 + return null ; 
 + } 
 + private FMLSecurityManager accessibleManager = new FMLSecurityManager ( ) ; 
 + 
 + class FMLSecurityManager extends SecurityManager 
 + { 
 + Class < ? > [ ] getStackClasses ( ) 
 + { 
 + return getClassContext ( ) ; 
 + } 
 + } 
 + 
 + Class < ? > [ ] getCallingStack ( ) 
 + { 
 + return accessibleManager . getStackClasses ( ) ; 
 + } 
 } 
 diff - - git a / fml / src / main / java / cpw / mods / fml / common / ModContainer . java b / fml / src / main / java / cpw / mods / fml / common / ModContainer . java 
 index 1641788 . . abed85d 100644 
 - - - a / fml / src / main / java / cpw / mods / fml / common / ModContainer . java 
 + + + b / fml / src / main / java / cpw / mods / fml / common / ModContainer . java 
 @ @ - 145 , 4 + 145 , 6 @ @ public interface ModContainer 
 Disableable canBeDisabled ( ) ; 
 
 String getGuiClassName ( ) ; 
 + 
 + List < String > getOwnedPackages ( ) ; 
 }
