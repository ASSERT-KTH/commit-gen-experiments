BLEU SCORE: 0.024675789207681903

TEST MSG: Allow sending packets to client from ServerConnectionFromClientEvent
GENERATED MSG: Fixes for PlayerDestroyItemEvent being called with empty itemstacks .

TEST DIFF (one line): diff - - git a / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch b / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch <nl> index 4e34b56 . . 587dc6d 100644 <nl> - - - a / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch <nl> + + + b / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch <nl> @ @ - 27 , 18 + 27 , 19 @ @ <nl> p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73080 _ a ( ( WorldServer ) p _ 72355 _ 2 _ . field _ 70170 _ p ) ; <nl> String s1 = " local " ; <nl> <nl> - @ @ - 127 , 8 + 138 , 8 @ @ <nl> + @ @ - 127 , 8 + 138 , 9 @ @ <nl> WorldServer worldserver = this . field _ 72400 _ f . func _ 71218 _ a ( p _ 72355 _ 2 _ . field _ 71093 _ bK ) ; <nl> WorldInfo worldinfo = worldserver . func _ 72912 _ H ( ) ; <nl> this . func _ 72381 _ a ( p _ 72355 _ 2 _ , ( EntityPlayerMP ) null , worldserver ) ; <nl> - NetHandlerPlayServer nethandlerplayserver = new NetHandlerPlayServer ( this . field _ 72400 _ f , p _ 72355 _ 1 _ , p _ 72355 _ 2 _ ) ; <nl> - nethandlerplayserver . func _ 147359 _ a ( new SPacketJoinGame ( p _ 72355 _ 2 _ . func _ 145782 _ y ( ) , p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73081 _ b ( ) , worldinfo . func _ 76093 _ s ( ) , worldserver . field _ 73011 _ w . func _ 186058 _ p ( ) . func _ 186068 _ a ( ) , worldserver . func _ 175659 _ aa ( ) , this . func _ 72352 _ l ( ) , worldinfo . func _ 76067 _ t ( ) , worldserver . func _ 82736 _ K ( ) . func _ 82766 _ b ( " reducedDebugInfo " ) ) ) ; <nl> + p _ 72355 _ 2 _ . field _ 71135 _ a = nethandlerplayserver ; <nl> + + net . minecraftforge . fml . common . FMLCommonHandler . instance ( ) . fireServerConnectionEvent ( p _ 72355 _ 1 _ ) ; <nl> + nethandlerplayserver . func _ 147359 _ a ( new SPacketJoinGame ( p _ 72355 _ 2 _ . func _ 145782 _ y ( ) , p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73081 _ b ( ) , worldinfo . func _ 76093 _ s ( ) , worldserver . field _ 73011 _ w . getDimension ( ) , worldserver . func _ 175659 _ aa ( ) , this . func _ 72352 _ l ( ) , worldinfo . func _ 76067 _ t ( ) , worldserver . func _ 82736 _ K ( ) . func _ 82766 _ b ( " reducedDebugInfo " ) ) ) ; <nl> nethandlerplayserver . func _ 147359 _ a ( new SPacketCustomPayload ( " MC | Brand " , ( new PacketBuffer ( Unpooled . buffer ( ) ) ) . func _ 180714 _ a ( this . func _ 72365 _ p ( ) . getServerModName ( ) ) ) ) ; <nl> nethandlerplayserver . func _ 147359 _ a ( new SPacketServerDifficulty ( worldinfo . func _ 176130 _ y ( ) , worldinfo . func _ 176123 _ z ( ) ) ) ; <nl> nethandlerplayserver . func _ 147359 _ a ( new SPacketPlayerAbilities ( p _ 72355 _ 2 _ . field _ 71075 _ bZ ) ) ; <nl> - @ @ - 204 , 6 + 215 , 7 @ @ <nl> + @ @ - 204 , 6 + 216 , 7 @ @ <nl> } <nl> <nl> p _ 72355 _ 2 _ . func _ 71116 _ b ( ) ; <nl> @ @ - 46 , 7 + 47 , 7 @ @ <nl> } <nl> <nl> protected void func _ 96456 _ a ( ServerScoreboard p _ 96456 _ 1 _ , EntityPlayerMP p _ 96456 _ 2 _ ) <nl> - @ @ - 304 , 6 + 316 , 7 @ @ <nl> + @ @ - 304 , 6 + 317 , 7 @ @ <nl> nbttagcompound1 = nbttagcompound ; <nl> p _ 72380 _ 1 _ . func _ 70020 _ e ( nbttagcompound ) ; <nl> field _ 148546 _ d . debug ( " loading single player " ) ; <nl> @ @ - 54 , 7 + 55 , 7 @ @ <nl> } <nl> else <nl> { <nl> - @ @ - 313 , 8 + 326 , 24 @ @ <nl> + @ @ - 313 , 8 + 327 , 24 @ @ <nl> return nbttagcompound1 ; <nl> } <nl> <nl> @ @ - 79 , 7 + 80 , 7 @ @ <nl> this . field _ 72412 _ k . func _ 75753 _ a ( p _ 72391 _ 1 _ ) ; <nl> StatisticsManagerServer statisticsmanagerserver = this . field _ 148547 _ k . get ( p _ 72391 _ 1 _ . func _ 110124 _ au ( ) ) ; <nl> <nl> - @ @ - 343 , 6 + 372 , 7 @ @ <nl> + @ @ - 343 , 6 + 373 , 7 @ @ <nl> p _ 72377 _ 1 _ . field _ 71135 _ a . func _ 147359 _ a ( new SPacketPlayerListItem ( SPacketPlayerListItem . Action . ADD _ PLAYER , new EntityPlayerMP [ ] { this . field _ 72404 _ b . get ( i ) } ) ) ; <nl> } <nl> <nl> @ @ - 87 , 7 + 88 , 7 @ @ <nl> worldserver . func _ 72838 _ d ( p _ 72377 _ 1 _ ) ; <nl> this . func _ 72375 _ a ( p _ 72377 _ 1 _ , ( WorldServer ) null ) ; <nl> } <nl> - @ @ - 354 , 6 + 384 , 7 @ @ <nl> + @ @ - 354 , 6 + 385 , 7 @ @ <nl> <nl> public void func _ 72367 _ e ( EntityPlayerMP p _ 72367 _ 1 _ ) <nl> { <nl> @ @ - 95 , 7 + 96 , 7 @ @ <nl> WorldServer worldserver = p _ 72367 _ 1 _ . func _ 71121 _ q ( ) ; <nl> p _ 72367 _ 1 _ . func _ 71029 _ a ( StatList . field _ 75947 _ j ) ; <nl> this . func _ 72391 _ b ( p _ 72367 _ 1 _ ) ; <nl> - @ @ - 376 , 6 + 407 , 7 @ @ <nl> + @ @ - 376 , 6 + 408 , 7 @ @ <nl> worldserver . func _ 72964 _ e ( p _ 72367 _ 1 _ . field _ 70176 _ ah , p _ 72367 _ 1 _ . field _ 70164 _ aj ) . func _ 76630 _ e ( ) ; <nl> } <nl> } <nl> @ @ - 103 , 7 + 104 , 7 @ @ <nl> <nl> worldserver . func _ 72900 _ e ( p _ 72367 _ 1 _ ) ; <nl> worldserver . func _ 184164 _ w ( ) . func _ 72695 _ c ( p _ 72367 _ 1 _ ) ; <nl> - @ @ - 473 , 13 + 505 , 24 @ @ <nl> + @ @ - 473 , 13 + 506 , 24 @ @ <nl> <nl> public EntityPlayerMP func _ 72368 _ a ( EntityPlayerMP p _ 72368 _ 1 _ , int p _ 72368 _ 2 _ , boolean p _ 72368 _ 3 _ ) <nl> { <nl> @ @ - 130 , 7 + 131 , 7 @ @ <nl> p _ 72368 _ 1 _ . field _ 71093 _ bK = p _ 72368 _ 2 _ ; <nl> PlayerInteractionManager playerinteractionmanager ; <nl> <nl> - @ @ - 495 , 6 + 538 , 7 @ @ <nl> + @ @ - 495 , 6 + 539 , 7 @ @ <nl> EntityPlayerMP entityplayermp = new EntityPlayerMP ( this . field _ 72400 _ f , this . field _ 72400 _ f . func _ 71218 _ a ( p _ 72368 _ 1 _ . field _ 71093 _ bK ) , p _ 72368 _ 1 _ . func _ 146103 _ bH ( ) , playerinteractionmanager ) ; <nl> entityplayermp . field _ 71135 _ a = p _ 72368 _ 1 _ . field _ 71135 _ a ; <nl> entityplayermp . func _ 193104 _ a ( p _ 72368 _ 1 _ , p _ 72368 _ 3 _ ) ; <nl> @ @ - 138 , 7 + 139 , 7 @ @ <nl> entityplayermp . func _ 145769 _ d ( p _ 72368 _ 1 _ . func _ 145782 _ y ( ) ) ; <nl> entityplayermp . func _ 174817 _ o ( p _ 72368 _ 1 _ ) ; <nl> entityplayermp . func _ 184819 _ a ( p _ 72368 _ 1 _ . func _ 184591 _ cq ( ) ) ; <nl> - @ @ - 542 , 6 + 586 , 7 @ @ <nl> + @ @ - 542 , 6 + 587 , 7 @ @ <nl> this . field _ 177454 _ f . put ( entityplayermp . func _ 110124 _ au ( ) , entityplayermp ) ; <nl> entityplayermp . func _ 71116 _ b ( ) ; <nl> entityplayermp . func _ 70606 _ j ( entityplayermp . func _ 110143 _ aJ ( ) ) ; <nl> @ @ - 146 , 7 + 147 , 7 @ @ <nl> return entityplayermp ; <nl> } <nl> <nl> - @ @ - 556 , 15 + 601 , 26 @ @ <nl> + @ @ - 556 , 15 + 602 , 26 @ @ <nl> <nl> public void func _ 187242 _ a ( EntityPlayerMP p _ 187242 _ 1 _ , int p _ 187242 _ 2 _ ) <nl> { <nl> @ @ - 175 , 7 + 176 , 7 @ @ <nl> this . func _ 72375 _ a ( p _ 187242 _ 1 _ , worldserver ) ; <nl> p _ 187242 _ 1 _ . field _ 71135 _ a . func _ 147364 _ a ( p _ 187242 _ 1 _ . field _ 70165 _ t , p _ 187242 _ 1 _ . field _ 70163 _ u , p _ 187242 _ 1 _ . field _ 70161 _ v , p _ 187242 _ 1 _ . field _ 70177 _ z , p _ 187242 _ 1 _ . field _ 70125 _ A ) ; <nl> p _ 187242 _ 1 _ . field _ 71134 _ c . func _ 73080 _ a ( worldserver1 ) ; <nl> - @ @ - 576 , 17 + 632 , 34 @ @ <nl> + @ @ - 576 , 17 + 633 , 34 @ @ <nl> { <nl> p _ 187242 _ 1 _ . field _ 71135 _ a . func _ 147359 _ a ( new SPacketEntityEffect ( p _ 187242 _ 1 _ . func _ 145782 _ y ( ) , potioneffect ) ) ; <nl> } <nl> @ @ - 213 , 7 + 214 , 7 @ @ <nl> { <nl> d0 = MathHelper . func _ 151237 _ a ( d0 / 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177726 _ b ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177728 _ d ( ) - 16 . 0D ) ; <nl> d1 = MathHelper . func _ 151237 _ a ( d1 / 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177736 _ c ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177733 _ e ( ) - 16 . 0D ) ; <nl> - @ @ - 597 , 7 + 670 , 7 @ @ <nl> + @ @ - 597 , 7 + 671 , 7 @ @ <nl> p _ 82448 _ 3 _ . func _ 72866 _ a ( p _ 82448 _ 1 _ , false ) ; <nl> } <nl> } <nl> @ @ - 222 , 7 + 223 , 7 @ @ <nl> { <nl> d0 = MathHelper . func _ 151237 _ a ( d0 * 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177726 _ b ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177728 _ d ( ) - 16 . 0D ) ; <nl> d1 = MathHelper . func _ 151237 _ a ( d1 * 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177736 _ c ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177733 _ e ( ) - 16 . 0D ) ; <nl> - @ @ - 608 , 7 + 681 , 7 @ @ <nl> + @ @ - 608 , 7 + 682 , 7 @ @ <nl> p _ 82448 _ 3 _ . func _ 72866 _ a ( p _ 82448 _ 1 _ , false ) ; <nl> } <nl> } <nl> @ @ - 231 , 7 + 232 , 7 @ @ <nl> { <nl> BlockPos blockpos ; <nl> <nl> - @ @ - 634 , 7 + 707 , 7 @ @ <nl> + @ @ - 634 , 7 + 708 , 7 @ @ <nl> <nl> p _ 82448 _ 3 _ . field _ 72984 _ F . func _ 76319 _ b ( ) ; <nl> <nl> @ @ - 240 , 7 + 241 , 7 @ @ <nl> { <nl> p _ 82448 _ 3 _ . field _ 72984 _ F . func _ 76320 _ a ( " placing " ) ; <nl> d0 = ( double ) MathHelper . func _ 76125 _ a ( ( int ) d0 , - 29999872 , 29999872 ) ; <nl> - @ @ - 643 , 7 + 716 , 8 @ @ <nl> + @ @ - 643 , 7 + 717 , 8 @ @ <nl> if ( p _ 82448 _ 1 _ . func _ 70089 _ S ( ) ) <nl> { <nl> p _ 82448 _ 1 _ . func _ 70012 _ b ( d0 , p _ 82448 _ 1 _ . field _ 70163 _ u , d1 , p _ 82448 _ 1 _ . field _ 70177 _ z , p _ 82448 _ 1 _ . field _ 70125 _ A ) ; <nl> diff - - git a / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java b / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java <nl> index 21019f2 . . 3cc3adf 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java <nl> + + + b / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java <nl> @ @ - 67 , 6 + 67 , 7 @ @ import net . minecraftforge . fml . common . gameevent . InputEvent ; <nl> import net . minecraftforge . fml . common . gameevent . PlayerEvent ; <nl> import net . minecraftforge . fml . common . gameevent . TickEvent ; <nl> import net . minecraftforge . fml . common . gameevent . TickEvent . Phase ; <nl> + import net . minecraftforge . fml . common . network . FMLNetworkEvent ; <nl> import net . minecraftforge . fml . common . network . NetworkRegistry ; <nl> import net . minecraftforge . fml . common . thread . SidedThreadGroup ; <nl> import net . minecraftforge . fml . relauncher . CoreModManager ; <nl> @ @ - 614 , 6 + 615 , 11 @ @ public class FMLCommonHandler <nl> return sidedDelegate . shouldAllowPlayerLogins ( ) ; <nl> } <nl> <nl> + public void fireServerConnectionEvent ( NetworkManager manager ) <nl> + { <nl> + bus ( ) . post ( new FMLNetworkEvent . ServerConnectionFromClientEvent ( manager ) ) ; <nl> + } <nl> + <nl> / * * <nl> * Process initial Handshake packet , kicks players from the server if they are connecting while we are starting up . <nl> * Also verifies the client has the FML marker . <nl> diff - - git a / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java b / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java <nl> index 6734bac . . a04a36f 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java <nl> + + + b / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java <nl> @ @ - 250 , 7 + 250 , 6 @ @ public class NetworkDispatcher extends SimpleChannelInboundHandler < Packet < ? > > im <nl> this . connectionType = type ; <nl> FMLLog . log . info ( " [ { } ] Server side { } connection established " , Thread . currentThread ( ) . getName ( ) , this . connectionType . name ( ) . toLowerCase ( Locale . ENGLISH ) ) ; <nl> this . state = ConnectionState . CONNECTED ; <nl> - MinecraftForge . EVENT _ BUS . post ( new FMLNetworkEvent . ServerConnectionFromClientEvent ( manager ) ) ; <nl> if ( DEBUG _ HANDSHAKE ) <nl> manager . closeChannel ( new TextComponentString ( " Handshake Complete review log file for details . " ) ) ; <nl> scm . initializeConnectionToPlayer ( manager , player , serverHandler ) ; <nl> diff - - git a / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java b / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java <nl> index e15152f . . 0b680c0 100644 <nl> - - - a / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java <nl> + + + b / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java <nl> @ @ - 21 , 6 + 21 , 7 @ @ package net . minecraftforge . fml . test ; <nl> <nl> import io . netty . buffer . Unpooled ; <nl> import net . minecraft . entity . player . EntityPlayerMP ; <nl> + import net . minecraft . network . NetHandlerPlayServer ; <nl> import net . minecraft . network . PacketBuffer ; <nl> import net . minecraftforge . common . MinecraftForge ; <nl> import net . minecraftforge . fml . common . Mod ; <nl> @ @ - 29 , 25 + 30 , 40 @ @ import net . minecraftforge . fml . common . event . FMLPreInitializationEvent ; <nl> import net . minecraftforge . fml . common . eventhandler . SubscribeEvent ; <nl> import net . minecraftforge . fml . common . gameevent . PlayerEvent . PlayerLoggedInEvent ; <nl> import net . minecraftforge . fml . common . network . FMLEventChannel ; <nl> + import net . minecraftforge . fml . common . network . FMLNetworkEvent ; <nl> import net . minecraftforge . fml . common . network . NetworkRegistry ; <nl> import net . minecraftforge . fml . common . network . internal . FMLProxyPacket ; <nl> - import net . minecraftforge . fml . relauncher . Side ; <nl> + import org . apache . logging . log4j . Logger ; <nl> <nl> @ Mod ( modid = ForgeNetworkTestMod . MOD _ ID , name = ForgeNetworkTestMod . MOD _ ID , version = " 1 . 0 " , acceptableRemoteVersions = " * " ) <nl> public class ForgeNetworkTestMod <nl> { <nl> private static final boolean ENABLED = false ; <nl> - public static final String MOD _ ID = " forgenetworktest " ; <nl> + public static final String MOD _ ID = " forge _ network _ test " ; <nl> + <nl> private FMLEventChannel channel ; <nl> + private Logger logger ; <nl> <nl> @ EventHandler <nl> public void onPreInit ( FMLPreInitializationEvent e ) <nl> { <nl> - if ( ENABLED & & e . getSide ( ) = = Side . SERVER ) <nl> + if ( ENABLED ) <nl> { <nl> MinecraftForge . EVENT _ BUS . register ( this ) ; <nl> channel = NetworkRegistry . INSTANCE . newEventDrivenChannel ( MOD _ ID ) ; <nl> channel . register ( this ) ; <nl> + logger = e . getModLog ( ) ; <nl> + } <nl> + } <nl> + <nl> + @ SubscribeEvent <nl> + public void onConnectionFromClient ( FMLNetworkEvent . ServerConnectionFromClientEvent event ) <nl> + { <nl> + if ( channel ! = null & & event . getHandler ( ) instanceof NetHandlerPlayServer ) <nl> + { <nl> + PacketBuffer buffer = new PacketBuffer ( Unpooled . buffer ( ) ) ; <nl> + buffer . writeByte ( 0 ) ; <nl> + channel . sendTo ( new FMLProxyPacket ( buffer , MOD _ ID ) , ( ( NetHandlerPlayServer ) event . getHandler ( ) ) . player ) ; <nl> } <nl> } <nl> <nl> @ @ - 62 , 4 + 78 , 10 @ @ public class ForgeNetworkTestMod <nl> buffer . writeByte ( 0 ) ; <nl> channel . sendTo ( new FMLProxyPacket ( buffer , MOD _ ID ) , ( EntityPlayerMP ) e . player ) ; / / disconnects vanilla clients in 1 . 11 <nl> } <nl> + <nl> + @ SubscribeEvent <nl> + public void onClientRecievedPacket ( FMLNetworkEvent . ClientCustomPacketEvent event ) <nl> + { <nl> + logger . info ( " Received packet from server " ) ; <nl> + } <nl> }
NEAREST DIFF (one line): diff - - git a / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch b / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch <nl> index 1d0f089 . . fd71243 100644 <nl> - - - a / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch <nl> + + + b / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch <nl> @ @ - 197 , 15 + 197 , 22 @ @ <nl> if ( this . func _ 180431 _ b ( p _ 70097 _ 1 _ ) ) <nl> { <nl> return false ; <nl> - @ @ - 1006 , 6 + 1074 , 7 @ @ <nl> + @ @ - 1000 , 12 + 1068 , 14 @ @ <nl> + { <nl> + if ( p _ 184590 _ 1 _ > = 3 . 0F & & this . field _ 184627 _ bm . func _ 77973 _ b ( ) = = Items . field _ 185159 _ cQ ) <nl> + { <nl> + + ItemStack copyBeforeUse = this . field _ 184627 _ bm . func _ 77946 _ l ( ) ; <nl> + int i = 1 + MathHelper . func _ 76141 _ d ( p _ 184590 _ 1 _ ) ; <nl> + this . field _ 184627 _ bm . func _ 77972 _ a ( i , this ) ; <nl> + <nl> if ( this . field _ 184627 _ bm . func _ 190926 _ b ( ) ) <nl> { <nl> EnumHand enumhand = this . func _ 184600 _ cs ( ) ; <nl> - + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , this . field _ 184627 _ bm , enumhand ) ; <nl> + + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , copyBeforeUse , enumhand ) ; <nl> <nl> if ( enumhand = = EnumHand . MAIN _ HAND ) <nl> { <nl> - @ @ - 1041 , 7 + 1110 , 10 @ @ <nl> + @ @ - 1041 , 7 + 1111 , 10 @ @ <nl> { <nl> if ( ! this . func _ 180431 _ b ( p _ 70665 _ 1 _ ) ) <nl> { <nl> @ @ - 217 , 7 + 224 , 7 @ @ <nl> p _ 70665 _ 2 _ = this . func _ 70672 _ c ( p _ 70665 _ 1 _ , p _ 70665 _ 2 _ ) ; <nl> float f = p _ 70665 _ 2 _ ; <nl> p _ 70665 _ 2 _ = Math . max ( p _ 70665 _ 2 _ - this . func _ 110139 _ bj ( ) , 0 . 0F ) ; <nl> - @ @ - 1111 , 6 + 1183 , 8 @ @ <nl> + @ @ - 1111 , 6 + 1184 , 8 @ @ <nl> } <nl> else <nl> { <nl> @ @ - 226 , 7 + 233 , 7 @ @ <nl> ItemStack itemstack = this . func _ 184586 _ b ( p _ 190775 _ 2 _ ) ; <nl> ItemStack itemstack1 = itemstack . func _ 190926 _ b ( ) ? ItemStack . field _ 190927 _ a : itemstack . func _ 77946 _ l ( ) ; <nl> <nl> - @ @ - 1120 , 7 + 1194 , 10 @ @ <nl> + @ @ - 1120 , 7 + 1195 , 10 @ @ <nl> { <nl> itemstack . func _ 190920 _ e ( itemstack1 . func _ 190916 _ E ( ) ) ; <nl> } <nl> @ @ - 238 , 7 + 245 , 7 @ @ <nl> return EnumActionResult . SUCCESS ; <nl> } <nl> else <nl> - @ @ - 1136 , 6 + 1213 , 7 @ @ <nl> + @ @ - 1136 , 6 + 1214 , 7 @ @ <nl> { <nl> if ( itemstack . func _ 190926 _ b ( ) & & ! this . field _ 71075 _ bZ . field _ 75098 _ d ) <nl> { <nl> @ @ - 246 , 7 + 253 , 7 @ @ <nl> this . func _ 184611 _ a ( p _ 190775 _ 2 _ , ItemStack . field _ 190927 _ a ) ; <nl> } <nl> <nl> - @ @ - 1161 , 6 + 1239 , 7 @ @ <nl> + @ @ - 1161 , 6 + 1240 , 7 @ @ <nl> <nl> public void func _ 71059 _ n ( Entity p _ 71059 _ 1 _ ) <nl> { <nl> @ @ - 254 , 7 + 261 , 7 @ @ <nl> if ( p _ 71059 _ 1 _ . func _ 70075 _ an ( ) ) <nl> { <nl> if ( ! p _ 71059 _ 1 _ . func _ 85031 _ j ( this ) ) <nl> - @ @ - 1333 , 11 + 1412 , 13 @ @ <nl> + @ @ - 1333 , 10 + 1413 , 12 @ @ <nl> <nl> if ( ! itemstack1 . func _ 190926 _ b ( ) & & entity instanceof EntityLivingBase ) <nl> { <nl> @ @ - 263 , 12 + 270 , 11 @ @ <nl> <nl> if ( itemstack1 . func _ 190926 _ b ( ) ) <nl> { <nl> - this . func _ 184611 _ a ( EnumHand . MAIN _ HAND , ItemStack . field _ 190927 _ a ) ; <nl> + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , beforeHitCopy , EnumHand . MAIN _ HAND ) ; <nl> + this . func _ 184611 _ a ( EnumHand . MAIN _ HAND , ItemStack . field _ 190927 _ a ) ; <nl> } <nl> } <nl> - <nl> - @ @ - 1443 , 6 + 1524 , 8 @ @ <nl> + @ @ - 1443 , 6 + 1525 , 8 @ @ <nl> <nl> public EntityPlayer . SleepResult func _ 180469 _ a ( BlockPos p _ 180469 _ 1 _ ) <nl> { <nl> @ @ - 277 , 7 + 283 , 7 @ @ <nl> EnumFacing enumfacing = ( EnumFacing ) this . field _ 70170 _ p . func _ 180495 _ p ( p _ 180469 _ 1 _ ) . func _ 177229 _ b ( BlockHorizontal . field _ 185512 _ D ) ; <nl> <nl> if ( ! this . field _ 70170 _ p . field _ 72995 _ K ) <nl> - @ @ - 1484 , 8 + 1567 , 9 @ @ <nl> + @ @ - 1484 , 8 + 1568 , 9 @ @ <nl> <nl> this . func _ 70105 _ a ( 0 . 2F , 0 . 2F ) ; <nl> <nl> @ @ - 289 , 7 + 295 , 7 @ @ <nl> float f1 = 0 . 5F + ( float ) enumfacing . func _ 82601 _ c ( ) * 0 . 4F ; <nl> float f = 0 . 5F + ( float ) enumfacing . func _ 82599 _ e ( ) * 0 . 4F ; <nl> this . func _ 175139 _ a ( enumfacing ) ; <nl> - @ @ - 1532 , 13 + 1616 , 14 @ @ <nl> + @ @ - 1532 , 13 + 1617 , 14 @ @ <nl> <nl> public void func _ 70999 _ a ( boolean p _ 70999 _ 1 _ , boolean p _ 70999 _ 2 _ , boolean p _ 70999 _ 3 _ ) <nl> { <nl> @ @ - 307 , 7 + 313 , 7 @ @ <nl> <nl> if ( blockpos = = null ) <nl> { <nl> - @ @ - 1547 , 6 + 1632 , 10 @ @ <nl> + @ @ - 1547 , 6 + 1633 , 10 @ @ <nl> <nl> this . func _ 70107 _ b ( ( double ) ( ( float ) blockpos . func _ 177958 _ n ( ) + 0 . 5F ) , ( double ) ( ( float ) blockpos . func _ 177956 _ o ( ) + 0 . 1F ) , ( double ) ( ( float ) blockpos . func _ 177952 _ p ( ) + 0 . 5F ) ) ; <nl> } <nl> @ @ - 318 , 7 + 324 , 7 @ @ <nl> <nl> this . field _ 71083 _ bS = false ; <nl> <nl> - @ @ - 1565 , 15 + 1654 , 16 @ @ <nl> + @ @ - 1565 , 15 + 1655 , 16 @ @ <nl> <nl> private boolean func _ 175143 _ p ( ) <nl> { <nl> @ @ - 338 , 7 + 344 , 7 @ @ <nl> { <nl> if ( ! p _ 180467 _ 2 _ ) <nl> { <nl> - @ @ - 1588 , 16 + 1678 , 17 @ @ <nl> + @ @ - 1588 , 16 + 1679 , 17 @ @ <nl> } <nl> else <nl> { <nl> @ @ - 359 , 7 + 365 , 7 @ @ <nl> <nl> switch ( enumfacing ) <nl> { <nl> - @ @ - 1637 , 16 + 1728 , 24 @ @ <nl> + @ @ - 1637 , 16 + 1729 , 24 @ @ <nl> <nl> public BlockPos func _ 180470 _ cg ( ) <nl> { <nl> @ @ - 386 , 7 + 392 , 7 @ @ <nl> if ( p _ 180473 _ 1 _ ! = null ) <nl> { <nl> this . field _ 71077 _ c = p _ 180473 _ 1 _ ; <nl> - @ @ - 1841 , 6 + 1940 , 10 @ @ <nl> + @ @ - 1841 , 6 + 1941 , 10 @ @ <nl> <nl> super . func _ 180430 _ e ( p _ 180430 _ 1 _ , p _ 180430 _ 2 _ ) ; <nl> } <nl> @ @ - 397 , 7 + 403 , 7 @ @ <nl> } <nl> <nl> protected void func _ 71061 _ d _ ( ) <nl> - @ @ - 2041 , 6 + 2144 , 18 @ @ <nl> + @ @ - 2041 , 6 + 2145 , 18 @ @ <nl> this . field _ 175152 _ f = p _ 71049 _ 1 _ . field _ 175152 _ f ; <nl> this . field _ 71078 _ a = p _ 71049 _ 1 _ . field _ 71078 _ a ; <nl> this . func _ 184212 _ Q ( ) . func _ 187227 _ b ( field _ 184827 _ bp , p _ 71049 _ 1 _ . func _ 184212 _ Q ( ) . func _ 187225 _ a ( field _ 184827 _ bp ) ) ; <nl> @ @ - 416 , 7 + 422 , 7 @ @ <nl> } <nl> <nl> protected boolean func _ 70041 _ e _ ( ) <nl> - @ @ - 2145 , 7 + 2260 , 10 @ @ <nl> + @ @ - 2145 , 7 + 2261 , 10 @ @ <nl> <nl> public ITextComponent func _ 145748 _ c _ ( ) <nl> { <nl> @ @ - 428 , 7 + 434 , 7 @ @ <nl> itextcomponent . func _ 150256 _ b ( ) . func _ 150241 _ a ( new ClickEvent ( ClickEvent . Action . SUGGEST _ COMMAND , " / msg " + this . func _ 70005 _ c _ ( ) + " " ) ) ; <nl> itextcomponent . func _ 150256 _ b ( ) . func _ 150209 _ a ( this . func _ 174823 _ aP ( ) ) ; <nl> itextcomponent . func _ 150256 _ b ( ) . func _ 179989 _ a ( this . func _ 70005 _ c _ ( ) ) ; <nl> - @ @ - 2154 , 7 + 2272 , 7 @ @ <nl> + @ @ - 2154 , 7 + 2273 , 7 @ @ <nl> <nl> public float func _ 70047 _ e ( ) <nl> { <nl> @ @ - 437 , 7 + 443 , 7 @ @ <nl> <nl> if ( this . func _ 70608 _ bn ( ) ) <nl> { <nl> - @ @ - 2370 , 6 + 2488 , 168 @ @ <nl> + @ @ - 2370 , 6 + 2489 , 168 @ @ <nl> return this . field _ 71075 _ bZ . field _ 75098 _ d & & this . func _ 70003 _ b ( 2 , " " ) ; <nl> } <nl> <nl> diff - - git a / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch b / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch <nl> index df28ae3 . . 4dfdfc8 100644 <nl> - - - a / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch <nl> + + + b / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch <nl> @ @ - 134 , 7 + 134 , 7 @ @ <nl> { <nl> return false ; <nl> } <nl> - @ @ - 266 , 53 + 301 , 40 @ @ <nl> + @ @ - 266 , 53 + 301 , 41 @ @ <nl> } <nl> else <nl> { <nl> @ @ - 182 , 6 + 182 , 7 @ @ <nl> if ( ! itemstack1 . func _ 190926 _ b ( ) ) <nl> { <nl> itemstack1 . func _ 179548 _ a ( this . field _ 73092 _ a , iblockstate , p _ 180237 _ 1 _ , this . field _ 73090 _ b ) ; <nl> + + if ( itemstack1 . func _ 190926 _ b ( ) ) net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this . field _ 73090 _ b , itemstack2 , EnumHand . MAIN _ HAND ) ; <nl> } <nl> <nl> + flag1 = this . removeBlock ( p _ 180237 _ 1 _ , flag ) ; <nl> @ @ - 199 , 7 + 200 , 7 @ @ <nl> return flag1 ; <nl> } <nl> } <nl> - @ @ - 330 , 8 + 352 , 11 @ @ <nl> + @ @ - 330 , 8 + 353 , 11 @ @ <nl> } <nl> else <nl> { <nl> @ @ - 211 , 15 + 212 , 15 @ @ <nl> ActionResult < ItemStack > actionresult = p _ 187250 _ 3 _ . func _ 77957 _ a ( p _ 187250 _ 2 _ , p _ 187250 _ 1 _ , p _ 187250 _ 4 _ ) ; <nl> ItemStack itemstack = ( ItemStack ) actionresult . func _ 188398 _ b ( ) ; <nl> <nl> - @ @ - 360 , 6 + 385 , 7 @ @ <nl> + @ @ - 359 , 6 + 385 , 7 @ @ <nl> + <nl> if ( itemstack . func _ 190926 _ b ( ) ) <nl> { <nl> - p _ 187250 _ 1 _ . func _ 184611 _ a ( p _ 187250 _ 4 _ , ItemStack . field _ 190927 _ a ) ; <nl> + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( p _ 187250 _ 1 _ , copyBeforeUse , p _ 187250 _ 4 _ ) ; <nl> + p _ 187250 _ 1 _ . func _ 184611 _ a ( p _ 187250 _ 4 _ , ItemStack . field _ 190927 _ a ) ; <nl> } <nl> <nl> - if ( ! p _ 187250 _ 1 _ . func _ 184587 _ cr ( ) ) <nl> - @ @ - 404 , 13 + 430 , 23 @ @ <nl> + @ @ - 404 , 13 + 431 , 23 @ @ <nl> } <nl> else <nl> { <nl> @ @ - 246 , 7 + 247 , 7 @ @ <nl> } <nl> } <nl> <nl> - @ @ - 438 , 14 + 474 , 20 @ @ <nl> + @ @ - 438 , 14 + 475 , 22 @ @ <nl> { <nl> int j = p _ 187251 _ 3 _ . func _ 77960 _ j ( ) ; <nl> int i = p _ 187251 _ 3 _ . func _ 190916 _ E ( ) ; <nl> @ @ - 260 , 14 + 261 , 17 @ @ <nl> } <nl> else <nl> { <nl> + - return p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; <nl> + if ( result ! = EnumActionResult . SUCCESS & & event . getUseItem ( ) ! = net . minecraftforge . fml . common . eventhandler . Event . Result . DENY <nl> - + | | result = = EnumActionResult . SUCCESS & & event . getUseItem ( ) = = net . minecraftforge . fml . common . eventhandler . Event . Result . ALLOW ) <nl> - return p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; <nl> - + else return result ; <nl> + + | | result = = EnumActionResult . SUCCESS & & event . getUseItem ( ) = = net . minecraftforge . fml . common . eventhandler . Event . Result . ALLOW ) { <nl> + + ItemStack copyBeforeUse = p _ 187251 _ 3 _ . func _ 77946 _ l ( ) ; <nl> + + result = p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; <nl> + + if ( p _ 187251 _ 3 _ . func _ 190926 _ b ( ) ) net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( p _ 187251 _ 1 _ , copyBeforeUse , p _ 187251 _ 4 _ ) ; <nl> + + } return result ; <nl> } <nl> } <nl> } <nl> - @ @ - 455 , 4 + 497 , 13 @ @ <nl> + @ @ - 455 , 4 + 500 , 13 @ @ <nl> { <nl> this . field _ 73092 _ a = p _ 73080 _ 1 _ ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java b / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java <nl> index a25f7e9 . . f539c8d 100644 <nl> - - - a / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java <nl> + + + b / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java <nl> @ @ - 22 , 9 + 22 , 7 @ @ package net . minecraftforge . event . entity . player ; <nl> import net . minecraft . client . entity . EntityPlayerSP ; <nl> import net . minecraft . client . multiplayer . PlayerControllerMP ; <nl> import net . minecraft . client . multiplayer . WorldClient ; <nl> - import net . minecraft . network . NetHandlerPlayServer ; <nl> - import net . minecraft . network . play . client . CPacketPlayerTryUseItemOnBlock ; <nl> - import net . minecraft . network . play . client . CPacketPlayerTryUseItem ; <nl> + import net . minecraft . entity . Entity ; <nl> import net . minecraft . server . management . PlayerInteractionManager ; <nl> import net . minecraft . util . EnumFacing ; <nl> import net . minecraft . util . math . BlockPos ; <nl> @ @ - 44 , 13 + 42 , 16 @ @ import javax . annotation . Nullable ; <nl> / * * <nl> * PlayerDestroyItemEvent is fired when a player destroys an item . < br > <nl> * This event is fired whenever a player destroys an item in <nl> - * { @ link PlayerControllerMP # processRightClick ( EntityPlayer , World , ItemStack , EnumHand ) } , <nl> - * { @ link PlayerControllerMP # processRightClickBlock ( EntityPlayerSP , WorldClient , ItemStack , BlockPos , EnumFacing , Vec3d , EnumHand ) } , <nl> + * { @ link PlayerControllerMP # onPlayerDestroyBlock ( BlockPos ) } , <nl> + * { @ link PlayerControllerMP # processRightClick ( EntityPlayer , World , EnumHand ) } , <nl> + * { @ link PlayerControllerMP # processRightClickBlock ( EntityPlayerSP , WorldClient , BlockPos , EnumFacing , Vec3d , EnumHand ) } , <nl> + * { @ link EntityPlayer # attackTargetEntityWithCurrentItem ( Entity ) } , <nl> * { @ link EntityPlayer # damageShield ( float ) } , <nl> + * { @ link EntityPlayer # interactOn ( Entity , EnumHand ) } , <nl> * { @ link ForgeHooks # getContainerItem ( ItemStack ) } , <nl> * { @ link PlayerInteractionManager # processRightClick ( EntityPlayer , World , ItemStack , EnumHand ) } , <nl> - * { @ link NetHandlerPlayServer # processPlayerBlockPlacement ( CPacketPlayerTryUseItem ) } <nl> - * and { @ link NetHandlerPlayServer # processRightClickBlock ( CPacketPlayerTryUseItemOnBlock ) } . < br > <nl> + * { @ link PlayerInteractionManager # processRightClickBlock ( EntityPlayer , World , ItemStack , EnumHand , BlockPos , EnumFacing , float , float , float ) } <nl> + * and { @ link PlayerInteractionManager # tryHarvestBlock ( BlockPos ) } . < br > <nl> * < br > <nl> * { @ link # original } contains the original ItemStack before the item was destroyed . < br > <nl> * ( @ link # hand ) contains the hand that the current item was held in . < br >

TEST DIFF:
diff - - git a / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch b / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch 
 index 4e34b56 . . 587dc6d 100644 
 - - - a / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch 
 + + + b / patches / minecraft / net / minecraft / server / management / PlayerList . java . patch 
 @ @ - 27 , 18 + 27 , 19 @ @ 
 p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73080 _ a ( ( WorldServer ) p _ 72355 _ 2 _ . field _ 70170 _ p ) ; 
 String s1 = " local " ; 
 
 - @ @ - 127 , 8 + 138 , 8 @ @ 
 + @ @ - 127 , 8 + 138 , 9 @ @ 
 WorldServer worldserver = this . field _ 72400 _ f . func _ 71218 _ a ( p _ 72355 _ 2 _ . field _ 71093 _ bK ) ; 
 WorldInfo worldinfo = worldserver . func _ 72912 _ H ( ) ; 
 this . func _ 72381 _ a ( p _ 72355 _ 2 _ , ( EntityPlayerMP ) null , worldserver ) ; 
 - NetHandlerPlayServer nethandlerplayserver = new NetHandlerPlayServer ( this . field _ 72400 _ f , p _ 72355 _ 1 _ , p _ 72355 _ 2 _ ) ; 
 - nethandlerplayserver . func _ 147359 _ a ( new SPacketJoinGame ( p _ 72355 _ 2 _ . func _ 145782 _ y ( ) , p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73081 _ b ( ) , worldinfo . func _ 76093 _ s ( ) , worldserver . field _ 73011 _ w . func _ 186058 _ p ( ) . func _ 186068 _ a ( ) , worldserver . func _ 175659 _ aa ( ) , this . func _ 72352 _ l ( ) , worldinfo . func _ 76067 _ t ( ) , worldserver . func _ 82736 _ K ( ) . func _ 82766 _ b ( " reducedDebugInfo " ) ) ) ; 
 + p _ 72355 _ 2 _ . field _ 71135 _ a = nethandlerplayserver ; 
 + + net . minecraftforge . fml . common . FMLCommonHandler . instance ( ) . fireServerConnectionEvent ( p _ 72355 _ 1 _ ) ; 
 + nethandlerplayserver . func _ 147359 _ a ( new SPacketJoinGame ( p _ 72355 _ 2 _ . func _ 145782 _ y ( ) , p _ 72355 _ 2 _ . field _ 71134 _ c . func _ 73081 _ b ( ) , worldinfo . func _ 76093 _ s ( ) , worldserver . field _ 73011 _ w . getDimension ( ) , worldserver . func _ 175659 _ aa ( ) , this . func _ 72352 _ l ( ) , worldinfo . func _ 76067 _ t ( ) , worldserver . func _ 82736 _ K ( ) . func _ 82766 _ b ( " reducedDebugInfo " ) ) ) ; 
 nethandlerplayserver . func _ 147359 _ a ( new SPacketCustomPayload ( " MC | Brand " , ( new PacketBuffer ( Unpooled . buffer ( ) ) ) . func _ 180714 _ a ( this . func _ 72365 _ p ( ) . getServerModName ( ) ) ) ) ; 
 nethandlerplayserver . func _ 147359 _ a ( new SPacketServerDifficulty ( worldinfo . func _ 176130 _ y ( ) , worldinfo . func _ 176123 _ z ( ) ) ) ; 
 nethandlerplayserver . func _ 147359 _ a ( new SPacketPlayerAbilities ( p _ 72355 _ 2 _ . field _ 71075 _ bZ ) ) ; 
 - @ @ - 204 , 6 + 215 , 7 @ @ 
 + @ @ - 204 , 6 + 216 , 7 @ @ 
 } 
 
 p _ 72355 _ 2 _ . func _ 71116 _ b ( ) ; 
 @ @ - 46 , 7 + 47 , 7 @ @ 
 } 
 
 protected void func _ 96456 _ a ( ServerScoreboard p _ 96456 _ 1 _ , EntityPlayerMP p _ 96456 _ 2 _ ) 
 - @ @ - 304 , 6 + 316 , 7 @ @ 
 + @ @ - 304 , 6 + 317 , 7 @ @ 
 nbttagcompound1 = nbttagcompound ; 
 p _ 72380 _ 1 _ . func _ 70020 _ e ( nbttagcompound ) ; 
 field _ 148546 _ d . debug ( " loading single player " ) ; 
 @ @ - 54 , 7 + 55 , 7 @ @ 
 } 
 else 
 { 
 - @ @ - 313 , 8 + 326 , 24 @ @ 
 + @ @ - 313 , 8 + 327 , 24 @ @ 
 return nbttagcompound1 ; 
 } 
 
 @ @ - 79 , 7 + 80 , 7 @ @ 
 this . field _ 72412 _ k . func _ 75753 _ a ( p _ 72391 _ 1 _ ) ; 
 StatisticsManagerServer statisticsmanagerserver = this . field _ 148547 _ k . get ( p _ 72391 _ 1 _ . func _ 110124 _ au ( ) ) ; 
 
 - @ @ - 343 , 6 + 372 , 7 @ @ 
 + @ @ - 343 , 6 + 373 , 7 @ @ 
 p _ 72377 _ 1 _ . field _ 71135 _ a . func _ 147359 _ a ( new SPacketPlayerListItem ( SPacketPlayerListItem . Action . ADD _ PLAYER , new EntityPlayerMP [ ] { this . field _ 72404 _ b . get ( i ) } ) ) ; 
 } 
 
 @ @ - 87 , 7 + 88 , 7 @ @ 
 worldserver . func _ 72838 _ d ( p _ 72377 _ 1 _ ) ; 
 this . func _ 72375 _ a ( p _ 72377 _ 1 _ , ( WorldServer ) null ) ; 
 } 
 - @ @ - 354 , 6 + 384 , 7 @ @ 
 + @ @ - 354 , 6 + 385 , 7 @ @ 
 
 public void func _ 72367 _ e ( EntityPlayerMP p _ 72367 _ 1 _ ) 
 { 
 @ @ - 95 , 7 + 96 , 7 @ @ 
 WorldServer worldserver = p _ 72367 _ 1 _ . func _ 71121 _ q ( ) ; 
 p _ 72367 _ 1 _ . func _ 71029 _ a ( StatList . field _ 75947 _ j ) ; 
 this . func _ 72391 _ b ( p _ 72367 _ 1 _ ) ; 
 - @ @ - 376 , 6 + 407 , 7 @ @ 
 + @ @ - 376 , 6 + 408 , 7 @ @ 
 worldserver . func _ 72964 _ e ( p _ 72367 _ 1 _ . field _ 70176 _ ah , p _ 72367 _ 1 _ . field _ 70164 _ aj ) . func _ 76630 _ e ( ) ; 
 } 
 } 
 @ @ - 103 , 7 + 104 , 7 @ @ 
 
 worldserver . func _ 72900 _ e ( p _ 72367 _ 1 _ ) ; 
 worldserver . func _ 184164 _ w ( ) . func _ 72695 _ c ( p _ 72367 _ 1 _ ) ; 
 - @ @ - 473 , 13 + 505 , 24 @ @ 
 + @ @ - 473 , 13 + 506 , 24 @ @ 
 
 public EntityPlayerMP func _ 72368 _ a ( EntityPlayerMP p _ 72368 _ 1 _ , int p _ 72368 _ 2 _ , boolean p _ 72368 _ 3 _ ) 
 { 
 @ @ - 130 , 7 + 131 , 7 @ @ 
 p _ 72368 _ 1 _ . field _ 71093 _ bK = p _ 72368 _ 2 _ ; 
 PlayerInteractionManager playerinteractionmanager ; 
 
 - @ @ - 495 , 6 + 538 , 7 @ @ 
 + @ @ - 495 , 6 + 539 , 7 @ @ 
 EntityPlayerMP entityplayermp = new EntityPlayerMP ( this . field _ 72400 _ f , this . field _ 72400 _ f . func _ 71218 _ a ( p _ 72368 _ 1 _ . field _ 71093 _ bK ) , p _ 72368 _ 1 _ . func _ 146103 _ bH ( ) , playerinteractionmanager ) ; 
 entityplayermp . field _ 71135 _ a = p _ 72368 _ 1 _ . field _ 71135 _ a ; 
 entityplayermp . func _ 193104 _ a ( p _ 72368 _ 1 _ , p _ 72368 _ 3 _ ) ; 
 @ @ - 138 , 7 + 139 , 7 @ @ 
 entityplayermp . func _ 145769 _ d ( p _ 72368 _ 1 _ . func _ 145782 _ y ( ) ) ; 
 entityplayermp . func _ 174817 _ o ( p _ 72368 _ 1 _ ) ; 
 entityplayermp . func _ 184819 _ a ( p _ 72368 _ 1 _ . func _ 184591 _ cq ( ) ) ; 
 - @ @ - 542 , 6 + 586 , 7 @ @ 
 + @ @ - 542 , 6 + 587 , 7 @ @ 
 this . field _ 177454 _ f . put ( entityplayermp . func _ 110124 _ au ( ) , entityplayermp ) ; 
 entityplayermp . func _ 71116 _ b ( ) ; 
 entityplayermp . func _ 70606 _ j ( entityplayermp . func _ 110143 _ aJ ( ) ) ; 
 @ @ - 146 , 7 + 147 , 7 @ @ 
 return entityplayermp ; 
 } 
 
 - @ @ - 556 , 15 + 601 , 26 @ @ 
 + @ @ - 556 , 15 + 602 , 26 @ @ 
 
 public void func _ 187242 _ a ( EntityPlayerMP p _ 187242 _ 1 _ , int p _ 187242 _ 2 _ ) 
 { 
 @ @ - 175 , 7 + 176 , 7 @ @ 
 this . func _ 72375 _ a ( p _ 187242 _ 1 _ , worldserver ) ; 
 p _ 187242 _ 1 _ . field _ 71135 _ a . func _ 147364 _ a ( p _ 187242 _ 1 _ . field _ 70165 _ t , p _ 187242 _ 1 _ . field _ 70163 _ u , p _ 187242 _ 1 _ . field _ 70161 _ v , p _ 187242 _ 1 _ . field _ 70177 _ z , p _ 187242 _ 1 _ . field _ 70125 _ A ) ; 
 p _ 187242 _ 1 _ . field _ 71134 _ c . func _ 73080 _ a ( worldserver1 ) ; 
 - @ @ - 576 , 17 + 632 , 34 @ @ 
 + @ @ - 576 , 17 + 633 , 34 @ @ 
 { 
 p _ 187242 _ 1 _ . field _ 71135 _ a . func _ 147359 _ a ( new SPacketEntityEffect ( p _ 187242 _ 1 _ . func _ 145782 _ y ( ) , potioneffect ) ) ; 
 } 
 @ @ - 213 , 7 + 214 , 7 @ @ 
 { 
 d0 = MathHelper . func _ 151237 _ a ( d0 / 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177726 _ b ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177728 _ d ( ) - 16 . 0D ) ; 
 d1 = MathHelper . func _ 151237 _ a ( d1 / 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177736 _ c ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177733 _ e ( ) - 16 . 0D ) ; 
 - @ @ - 597 , 7 + 670 , 7 @ @ 
 + @ @ - 597 , 7 + 671 , 7 @ @ 
 p _ 82448 _ 3 _ . func _ 72866 _ a ( p _ 82448 _ 1 _ , false ) ; 
 } 
 } 
 @ @ - 222 , 7 + 223 , 7 @ @ 
 { 
 d0 = MathHelper . func _ 151237 _ a ( d0 * 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177726 _ b ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177728 _ d ( ) - 16 . 0D ) ; 
 d1 = MathHelper . func _ 151237 _ a ( d1 * 8 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177736 _ c ( ) + 16 . 0D , p _ 82448 _ 4 _ . func _ 175723 _ af ( ) . func _ 177733 _ e ( ) - 16 . 0D ) ; 
 - @ @ - 608 , 7 + 681 , 7 @ @ 
 + @ @ - 608 , 7 + 682 , 7 @ @ 
 p _ 82448 _ 3 _ . func _ 72866 _ a ( p _ 82448 _ 1 _ , false ) ; 
 } 
 } 
 @ @ - 231 , 7 + 232 , 7 @ @ 
 { 
 BlockPos blockpos ; 
 
 - @ @ - 634 , 7 + 707 , 7 @ @ 
 + @ @ - 634 , 7 + 708 , 7 @ @ 
 
 p _ 82448 _ 3 _ . field _ 72984 _ F . func _ 76319 _ b ( ) ; 
 
 @ @ - 240 , 7 + 241 , 7 @ @ 
 { 
 p _ 82448 _ 3 _ . field _ 72984 _ F . func _ 76320 _ a ( " placing " ) ; 
 d0 = ( double ) MathHelper . func _ 76125 _ a ( ( int ) d0 , - 29999872 , 29999872 ) ; 
 - @ @ - 643 , 7 + 716 , 8 @ @ 
 + @ @ - 643 , 7 + 717 , 8 @ @ 
 if ( p _ 82448 _ 1 _ . func _ 70089 _ S ( ) ) 
 { 
 p _ 82448 _ 1 _ . func _ 70012 _ b ( d0 , p _ 82448 _ 1 _ . field _ 70163 _ u , d1 , p _ 82448 _ 1 _ . field _ 70177 _ z , p _ 82448 _ 1 _ . field _ 70125 _ A ) ; 
 diff - - git a / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java b / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java 
 index 21019f2 . . 3cc3adf 100644 
 - - - a / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java 
 + + + b / src / main / java / net / minecraftforge / fml / common / FMLCommonHandler . java 
 @ @ - 67 , 6 + 67 , 7 @ @ import net . minecraftforge . fml . common . gameevent . InputEvent ; 
 import net . minecraftforge . fml . common . gameevent . PlayerEvent ; 
 import net . minecraftforge . fml . common . gameevent . TickEvent ; 
 import net . minecraftforge . fml . common . gameevent . TickEvent . Phase ; 
 + import net . minecraftforge . fml . common . network . FMLNetworkEvent ; 
 import net . minecraftforge . fml . common . network . NetworkRegistry ; 
 import net . minecraftforge . fml . common . thread . SidedThreadGroup ; 
 import net . minecraftforge . fml . relauncher . CoreModManager ; 
 @ @ - 614 , 6 + 615 , 11 @ @ public class FMLCommonHandler 
 return sidedDelegate . shouldAllowPlayerLogins ( ) ; 
 } 
 
 + public void fireServerConnectionEvent ( NetworkManager manager ) 
 + { 
 + bus ( ) . post ( new FMLNetworkEvent . ServerConnectionFromClientEvent ( manager ) ) ; 
 + } 
 + 
 / * * 
 * Process initial Handshake packet , kicks players from the server if they are connecting while we are starting up . 
 * Also verifies the client has the FML marker . 
 diff - - git a / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java b / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java 
 index 6734bac . . a04a36f 100644 
 - - - a / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java 
 + + + b / src / main / java / net / minecraftforge / fml / common / network / handshake / NetworkDispatcher . java 
 @ @ - 250 , 7 + 250 , 6 @ @ public class NetworkDispatcher extends SimpleChannelInboundHandler < Packet < ? > > im 
 this . connectionType = type ; 
 FMLLog . log . info ( " [ { } ] Server side { } connection established " , Thread . currentThread ( ) . getName ( ) , this . connectionType . name ( ) . toLowerCase ( Locale . ENGLISH ) ) ; 
 this . state = ConnectionState . CONNECTED ; 
 - MinecraftForge . EVENT _ BUS . post ( new FMLNetworkEvent . ServerConnectionFromClientEvent ( manager ) ) ; 
 if ( DEBUG _ HANDSHAKE ) 
 manager . closeChannel ( new TextComponentString ( " Handshake Complete review log file for details . " ) ) ; 
 scm . initializeConnectionToPlayer ( manager , player , serverHandler ) ; 
 diff - - git a / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java b / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java 
 index e15152f . . 0b680c0 100644 
 - - - a / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java 
 + + + b / src / test / java / net / minecraftforge / fml / test / ForgeNetworkTestMod . java 
 @ @ - 21 , 6 + 21 , 7 @ @ package net . minecraftforge . fml . test ; 
 
 import io . netty . buffer . Unpooled ; 
 import net . minecraft . entity . player . EntityPlayerMP ; 
 + import net . minecraft . network . NetHandlerPlayServer ; 
 import net . minecraft . network . PacketBuffer ; 
 import net . minecraftforge . common . MinecraftForge ; 
 import net . minecraftforge . fml . common . Mod ; 
 @ @ - 29 , 25 + 30 , 40 @ @ import net . minecraftforge . fml . common . event . FMLPreInitializationEvent ; 
 import net . minecraftforge . fml . common . eventhandler . SubscribeEvent ; 
 import net . minecraftforge . fml . common . gameevent . PlayerEvent . PlayerLoggedInEvent ; 
 import net . minecraftforge . fml . common . network . FMLEventChannel ; 
 + import net . minecraftforge . fml . common . network . FMLNetworkEvent ; 
 import net . minecraftforge . fml . common . network . NetworkRegistry ; 
 import net . minecraftforge . fml . common . network . internal . FMLProxyPacket ; 
 - import net . minecraftforge . fml . relauncher . Side ; 
 + import org . apache . logging . log4j . Logger ; 
 
 @ Mod ( modid = ForgeNetworkTestMod . MOD _ ID , name = ForgeNetworkTestMod . MOD _ ID , version = " 1 . 0 " , acceptableRemoteVersions = " * " ) 
 public class ForgeNetworkTestMod 
 { 
 private static final boolean ENABLED = false ; 
 - public static final String MOD _ ID = " forgenetworktest " ; 
 + public static final String MOD _ ID = " forge _ network _ test " ; 
 + 
 private FMLEventChannel channel ; 
 + private Logger logger ; 
 
 @ EventHandler 
 public void onPreInit ( FMLPreInitializationEvent e ) 
 { 
 - if ( ENABLED & & e . getSide ( ) = = Side . SERVER ) 
 + if ( ENABLED ) 
 { 
 MinecraftForge . EVENT _ BUS . register ( this ) ; 
 channel = NetworkRegistry . INSTANCE . newEventDrivenChannel ( MOD _ ID ) ; 
 channel . register ( this ) ; 
 + logger = e . getModLog ( ) ; 
 + } 
 + } 
 + 
 + @ SubscribeEvent 
 + public void onConnectionFromClient ( FMLNetworkEvent . ServerConnectionFromClientEvent event ) 
 + { 
 + if ( channel ! = null & & event . getHandler ( ) instanceof NetHandlerPlayServer ) 
 + { 
 + PacketBuffer buffer = new PacketBuffer ( Unpooled . buffer ( ) ) ; 
 + buffer . writeByte ( 0 ) ; 
 + channel . sendTo ( new FMLProxyPacket ( buffer , MOD _ ID ) , ( ( NetHandlerPlayServer ) event . getHandler ( ) ) . player ) ; 
 } 
 } 
 
 @ @ - 62 , 4 + 78 , 10 @ @ public class ForgeNetworkTestMod 
 buffer . writeByte ( 0 ) ; 
 channel . sendTo ( new FMLProxyPacket ( buffer , MOD _ ID ) , ( EntityPlayerMP ) e . player ) ; / / disconnects vanilla clients in 1 . 11 
 } 
 + 
 + @ SubscribeEvent 
 + public void onClientRecievedPacket ( FMLNetworkEvent . ClientCustomPacketEvent event ) 
 + { 
 + logger . info ( " Received packet from server " ) ; 
 + } 
 }

NEAREST DIFF:
diff - - git a / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch b / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch 
 index 1d0f089 . . fd71243 100644 
 - - - a / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch 
 + + + b / patches / minecraft / net / minecraft / entity / player / EntityPlayer . java . patch 
 @ @ - 197 , 15 + 197 , 22 @ @ 
 if ( this . func _ 180431 _ b ( p _ 70097 _ 1 _ ) ) 
 { 
 return false ; 
 - @ @ - 1006 , 6 + 1074 , 7 @ @ 
 + @ @ - 1000 , 12 + 1068 , 14 @ @ 
 + { 
 + if ( p _ 184590 _ 1 _ > = 3 . 0F & & this . field _ 184627 _ bm . func _ 77973 _ b ( ) = = Items . field _ 185159 _ cQ ) 
 + { 
 + + ItemStack copyBeforeUse = this . field _ 184627 _ bm . func _ 77946 _ l ( ) ; 
 + int i = 1 + MathHelper . func _ 76141 _ d ( p _ 184590 _ 1 _ ) ; 
 + this . field _ 184627 _ bm . func _ 77972 _ a ( i , this ) ; 
 + 
 if ( this . field _ 184627 _ bm . func _ 190926 _ b ( ) ) 
 { 
 EnumHand enumhand = this . func _ 184600 _ cs ( ) ; 
 - + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , this . field _ 184627 _ bm , enumhand ) ; 
 + + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , copyBeforeUse , enumhand ) ; 
 
 if ( enumhand = = EnumHand . MAIN _ HAND ) 
 { 
 - @ @ - 1041 , 7 + 1110 , 10 @ @ 
 + @ @ - 1041 , 7 + 1111 , 10 @ @ 
 { 
 if ( ! this . func _ 180431 _ b ( p _ 70665 _ 1 _ ) ) 
 { 
 @ @ - 217 , 7 + 224 , 7 @ @ 
 p _ 70665 _ 2 _ = this . func _ 70672 _ c ( p _ 70665 _ 1 _ , p _ 70665 _ 2 _ ) ; 
 float f = p _ 70665 _ 2 _ ; 
 p _ 70665 _ 2 _ = Math . max ( p _ 70665 _ 2 _ - this . func _ 110139 _ bj ( ) , 0 . 0F ) ; 
 - @ @ - 1111 , 6 + 1183 , 8 @ @ 
 + @ @ - 1111 , 6 + 1184 , 8 @ @ 
 } 
 else 
 { 
 @ @ - 226 , 7 + 233 , 7 @ @ 
 ItemStack itemstack = this . func _ 184586 _ b ( p _ 190775 _ 2 _ ) ; 
 ItemStack itemstack1 = itemstack . func _ 190926 _ b ( ) ? ItemStack . field _ 190927 _ a : itemstack . func _ 77946 _ l ( ) ; 
 
 - @ @ - 1120 , 7 + 1194 , 10 @ @ 
 + @ @ - 1120 , 7 + 1195 , 10 @ @ 
 { 
 itemstack . func _ 190920 _ e ( itemstack1 . func _ 190916 _ E ( ) ) ; 
 } 
 @ @ - 238 , 7 + 245 , 7 @ @ 
 return EnumActionResult . SUCCESS ; 
 } 
 else 
 - @ @ - 1136 , 6 + 1213 , 7 @ @ 
 + @ @ - 1136 , 6 + 1214 , 7 @ @ 
 { 
 if ( itemstack . func _ 190926 _ b ( ) & & ! this . field _ 71075 _ bZ . field _ 75098 _ d ) 
 { 
 @ @ - 246 , 7 + 253 , 7 @ @ 
 this . func _ 184611 _ a ( p _ 190775 _ 2 _ , ItemStack . field _ 190927 _ a ) ; 
 } 
 
 - @ @ - 1161 , 6 + 1239 , 7 @ @ 
 + @ @ - 1161 , 6 + 1240 , 7 @ @ 
 
 public void func _ 71059 _ n ( Entity p _ 71059 _ 1 _ ) 
 { 
 @ @ - 254 , 7 + 261 , 7 @ @ 
 if ( p _ 71059 _ 1 _ . func _ 70075 _ an ( ) ) 
 { 
 if ( ! p _ 71059 _ 1 _ . func _ 85031 _ j ( this ) ) 
 - @ @ - 1333 , 11 + 1412 , 13 @ @ 
 + @ @ - 1333 , 10 + 1413 , 12 @ @ 
 
 if ( ! itemstack1 . func _ 190926 _ b ( ) & & entity instanceof EntityLivingBase ) 
 { 
 @ @ - 263 , 12 + 270 , 11 @ @ 
 
 if ( itemstack1 . func _ 190926 _ b ( ) ) 
 { 
 - this . func _ 184611 _ a ( EnumHand . MAIN _ HAND , ItemStack . field _ 190927 _ a ) ; 
 + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this , beforeHitCopy , EnumHand . MAIN _ HAND ) ; 
 + this . func _ 184611 _ a ( EnumHand . MAIN _ HAND , ItemStack . field _ 190927 _ a ) ; 
 } 
 } 
 - 
 - @ @ - 1443 , 6 + 1524 , 8 @ @ 
 + @ @ - 1443 , 6 + 1525 , 8 @ @ 
 
 public EntityPlayer . SleepResult func _ 180469 _ a ( BlockPos p _ 180469 _ 1 _ ) 
 { 
 @ @ - 277 , 7 + 283 , 7 @ @ 
 EnumFacing enumfacing = ( EnumFacing ) this . field _ 70170 _ p . func _ 180495 _ p ( p _ 180469 _ 1 _ ) . func _ 177229 _ b ( BlockHorizontal . field _ 185512 _ D ) ; 
 
 if ( ! this . field _ 70170 _ p . field _ 72995 _ K ) 
 - @ @ - 1484 , 8 + 1567 , 9 @ @ 
 + @ @ - 1484 , 8 + 1568 , 9 @ @ 
 
 this . func _ 70105 _ a ( 0 . 2F , 0 . 2F ) ; 
 
 @ @ - 289 , 7 + 295 , 7 @ @ 
 float f1 = 0 . 5F + ( float ) enumfacing . func _ 82601 _ c ( ) * 0 . 4F ; 
 float f = 0 . 5F + ( float ) enumfacing . func _ 82599 _ e ( ) * 0 . 4F ; 
 this . func _ 175139 _ a ( enumfacing ) ; 
 - @ @ - 1532 , 13 + 1616 , 14 @ @ 
 + @ @ - 1532 , 13 + 1617 , 14 @ @ 
 
 public void func _ 70999 _ a ( boolean p _ 70999 _ 1 _ , boolean p _ 70999 _ 2 _ , boolean p _ 70999 _ 3 _ ) 
 { 
 @ @ - 307 , 7 + 313 , 7 @ @ 
 
 if ( blockpos = = null ) 
 { 
 - @ @ - 1547 , 6 + 1632 , 10 @ @ 
 + @ @ - 1547 , 6 + 1633 , 10 @ @ 
 
 this . func _ 70107 _ b ( ( double ) ( ( float ) blockpos . func _ 177958 _ n ( ) + 0 . 5F ) , ( double ) ( ( float ) blockpos . func _ 177956 _ o ( ) + 0 . 1F ) , ( double ) ( ( float ) blockpos . func _ 177952 _ p ( ) + 0 . 5F ) ) ; 
 } 
 @ @ - 318 , 7 + 324 , 7 @ @ 
 
 this . field _ 71083 _ bS = false ; 
 
 - @ @ - 1565 , 15 + 1654 , 16 @ @ 
 + @ @ - 1565 , 15 + 1655 , 16 @ @ 
 
 private boolean func _ 175143 _ p ( ) 
 { 
 @ @ - 338 , 7 + 344 , 7 @ @ 
 { 
 if ( ! p _ 180467 _ 2 _ ) 
 { 
 - @ @ - 1588 , 16 + 1678 , 17 @ @ 
 + @ @ - 1588 , 16 + 1679 , 17 @ @ 
 } 
 else 
 { 
 @ @ - 359 , 7 + 365 , 7 @ @ 
 
 switch ( enumfacing ) 
 { 
 - @ @ - 1637 , 16 + 1728 , 24 @ @ 
 + @ @ - 1637 , 16 + 1729 , 24 @ @ 
 
 public BlockPos func _ 180470 _ cg ( ) 
 { 
 @ @ - 386 , 7 + 392 , 7 @ @ 
 if ( p _ 180473 _ 1 _ ! = null ) 
 { 
 this . field _ 71077 _ c = p _ 180473 _ 1 _ ; 
 - @ @ - 1841 , 6 + 1940 , 10 @ @ 
 + @ @ - 1841 , 6 + 1941 , 10 @ @ 
 
 super . func _ 180430 _ e ( p _ 180430 _ 1 _ , p _ 180430 _ 2 _ ) ; 
 } 
 @ @ - 397 , 7 + 403 , 7 @ @ 
 } 
 
 protected void func _ 71061 _ d _ ( ) 
 - @ @ - 2041 , 6 + 2144 , 18 @ @ 
 + @ @ - 2041 , 6 + 2145 , 18 @ @ 
 this . field _ 175152 _ f = p _ 71049 _ 1 _ . field _ 175152 _ f ; 
 this . field _ 71078 _ a = p _ 71049 _ 1 _ . field _ 71078 _ a ; 
 this . func _ 184212 _ Q ( ) . func _ 187227 _ b ( field _ 184827 _ bp , p _ 71049 _ 1 _ . func _ 184212 _ Q ( ) . func _ 187225 _ a ( field _ 184827 _ bp ) ) ; 
 @ @ - 416 , 7 + 422 , 7 @ @ 
 } 
 
 protected boolean func _ 70041 _ e _ ( ) 
 - @ @ - 2145 , 7 + 2260 , 10 @ @ 
 + @ @ - 2145 , 7 + 2261 , 10 @ @ 
 
 public ITextComponent func _ 145748 _ c _ ( ) 
 { 
 @ @ - 428 , 7 + 434 , 7 @ @ 
 itextcomponent . func _ 150256 _ b ( ) . func _ 150241 _ a ( new ClickEvent ( ClickEvent . Action . SUGGEST _ COMMAND , " / msg " + this . func _ 70005 _ c _ ( ) + " " ) ) ; 
 itextcomponent . func _ 150256 _ b ( ) . func _ 150209 _ a ( this . func _ 174823 _ aP ( ) ) ; 
 itextcomponent . func _ 150256 _ b ( ) . func _ 179989 _ a ( this . func _ 70005 _ c _ ( ) ) ; 
 - @ @ - 2154 , 7 + 2272 , 7 @ @ 
 + @ @ - 2154 , 7 + 2273 , 7 @ @ 
 
 public float func _ 70047 _ e ( ) 
 { 
 @ @ - 437 , 7 + 443 , 7 @ @ 
 
 if ( this . func _ 70608 _ bn ( ) ) 
 { 
 - @ @ - 2370 , 6 + 2488 , 168 @ @ 
 + @ @ - 2370 , 6 + 2489 , 168 @ @ 
 return this . field _ 71075 _ bZ . field _ 75098 _ d & & this . func _ 70003 _ b ( 2 , " " ) ; 
 } 
 
 diff - - git a / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch b / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch 
 index df28ae3 . . 4dfdfc8 100644 
 - - - a / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch 
 + + + b / patches / minecraft / net / minecraft / server / management / PlayerInteractionManager . java . patch 
 @ @ - 134 , 7 + 134 , 7 @ @ 
 { 
 return false ; 
 } 
 - @ @ - 266 , 53 + 301 , 40 @ @ 
 + @ @ - 266 , 53 + 301 , 41 @ @ 
 } 
 else 
 { 
 @ @ - 182 , 6 + 182 , 7 @ @ 
 if ( ! itemstack1 . func _ 190926 _ b ( ) ) 
 { 
 itemstack1 . func _ 179548 _ a ( this . field _ 73092 _ a , iblockstate , p _ 180237 _ 1 _ , this . field _ 73090 _ b ) ; 
 + + if ( itemstack1 . func _ 190926 _ b ( ) ) net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( this . field _ 73090 _ b , itemstack2 , EnumHand . MAIN _ HAND ) ; 
 } 
 
 + flag1 = this . removeBlock ( p _ 180237 _ 1 _ , flag ) ; 
 @ @ - 199 , 7 + 200 , 7 @ @ 
 return flag1 ; 
 } 
 } 
 - @ @ - 330 , 8 + 352 , 11 @ @ 
 + @ @ - 330 , 8 + 353 , 11 @ @ 
 } 
 else 
 { 
 @ @ - 211 , 15 + 212 , 15 @ @ 
 ActionResult < ItemStack > actionresult = p _ 187250 _ 3 _ . func _ 77957 _ a ( p _ 187250 _ 2 _ , p _ 187250 _ 1 _ , p _ 187250 _ 4 _ ) ; 
 ItemStack itemstack = ( ItemStack ) actionresult . func _ 188398 _ b ( ) ; 
 
 - @ @ - 360 , 6 + 385 , 7 @ @ 
 + @ @ - 359 , 6 + 385 , 7 @ @ 
 + 
 if ( itemstack . func _ 190926 _ b ( ) ) 
 { 
 - p _ 187250 _ 1 _ . func _ 184611 _ a ( p _ 187250 _ 4 _ , ItemStack . field _ 190927 _ a ) ; 
 + net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( p _ 187250 _ 1 _ , copyBeforeUse , p _ 187250 _ 4 _ ) ; 
 + p _ 187250 _ 1 _ . func _ 184611 _ a ( p _ 187250 _ 4 _ , ItemStack . field _ 190927 _ a ) ; 
 } 
 
 - if ( ! p _ 187250 _ 1 _ . func _ 184587 _ cr ( ) ) 
 - @ @ - 404 , 13 + 430 , 23 @ @ 
 + @ @ - 404 , 13 + 431 , 23 @ @ 
 } 
 else 
 { 
 @ @ - 246 , 7 + 247 , 7 @ @ 
 } 
 } 
 
 - @ @ - 438 , 14 + 474 , 20 @ @ 
 + @ @ - 438 , 14 + 475 , 22 @ @ 
 { 
 int j = p _ 187251 _ 3 _ . func _ 77960 _ j ( ) ; 
 int i = p _ 187251 _ 3 _ . func _ 190916 _ E ( ) ; 
 @ @ - 260 , 14 + 261 , 17 @ @ 
 } 
 else 
 { 
 + - return p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; 
 + if ( result ! = EnumActionResult . SUCCESS & & event . getUseItem ( ) ! = net . minecraftforge . fml . common . eventhandler . Event . Result . DENY 
 - + | | result = = EnumActionResult . SUCCESS & & event . getUseItem ( ) = = net . minecraftforge . fml . common . eventhandler . Event . Result . ALLOW ) 
 - return p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; 
 - + else return result ; 
 + + | | result = = EnumActionResult . SUCCESS & & event . getUseItem ( ) = = net . minecraftforge . fml . common . eventhandler . Event . Result . ALLOW ) { 
 + + ItemStack copyBeforeUse = p _ 187251 _ 3 _ . func _ 77946 _ l ( ) ; 
 + + result = p _ 187251 _ 3 _ . func _ 179546 _ a ( p _ 187251 _ 1 _ , p _ 187251 _ 2 _ , p _ 187251 _ 5 _ , p _ 187251 _ 4 _ , p _ 187251 _ 6 _ , p _ 187251 _ 7 _ , p _ 187251 _ 8 _ , p _ 187251 _ 9 _ ) ; 
 + + if ( p _ 187251 _ 3 _ . func _ 190926 _ b ( ) ) net . minecraftforge . event . ForgeEventFactory . onPlayerDestroyItem ( p _ 187251 _ 1 _ , copyBeforeUse , p _ 187251 _ 4 _ ) ; 
 + + } return result ; 
 } 
 } 
 } 
 - @ @ - 455 , 4 + 497 , 13 @ @ 
 + @ @ - 455 , 4 + 500 , 13 @ @ 
 { 
 this . field _ 73092 _ a = p _ 73080 _ 1 _ ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java b / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java 
 index a25f7e9 . . f539c8d 100644 
 - - - a / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java 
 + + + b / src / main / java / net / minecraftforge / event / entity / player / PlayerDestroyItemEvent . java 
 @ @ - 22 , 9 + 22 , 7 @ @ package net . minecraftforge . event . entity . player ; 
 import net . minecraft . client . entity . EntityPlayerSP ; 
 import net . minecraft . client . multiplayer . PlayerControllerMP ; 
 import net . minecraft . client . multiplayer . WorldClient ; 
 - import net . minecraft . network . NetHandlerPlayServer ; 
 - import net . minecraft . network . play . client . CPacketPlayerTryUseItemOnBlock ; 
 - import net . minecraft . network . play . client . CPacketPlayerTryUseItem ; 
 + import net . minecraft . entity . Entity ; 
 import net . minecraft . server . management . PlayerInteractionManager ; 
 import net . minecraft . util . EnumFacing ; 
 import net . minecraft . util . math . BlockPos ; 
 @ @ - 44 , 13 + 42 , 16 @ @ import javax . annotation . Nullable ; 
 / * * 
 * PlayerDestroyItemEvent is fired when a player destroys an item . < br > 
 * This event is fired whenever a player destroys an item in 
 - * { @ link PlayerControllerMP # processRightClick ( EntityPlayer , World , ItemStack , EnumHand ) } , 
 - * { @ link PlayerControllerMP # processRightClickBlock ( EntityPlayerSP , WorldClient , ItemStack , BlockPos , EnumFacing , Vec3d , EnumHand ) } , 
 + * { @ link PlayerControllerMP # onPlayerDestroyBlock ( BlockPos ) } , 
 + * { @ link PlayerControllerMP # processRightClick ( EntityPlayer , World , EnumHand ) } , 
 + * { @ link PlayerControllerMP # processRightClickBlock ( EntityPlayerSP , WorldClient , BlockPos , EnumFacing , Vec3d , EnumHand ) } , 
 + * { @ link EntityPlayer # attackTargetEntityWithCurrentItem ( Entity ) } , 
 * { @ link EntityPlayer # damageShield ( float ) } , 
 + * { @ link EntityPlayer # interactOn ( Entity , EnumHand ) } , 
 * { @ link ForgeHooks # getContainerItem ( ItemStack ) } , 
 * { @ link PlayerInteractionManager # processRightClick ( EntityPlayer , World , ItemStack , EnumHand ) } , 
 - * { @ link NetHandlerPlayServer # processPlayerBlockPlacement ( CPacketPlayerTryUseItem ) } 
 - * and { @ link NetHandlerPlayServer # processRightClickBlock ( CPacketPlayerTryUseItemOnBlock ) } . < br > 
 + * { @ link PlayerInteractionManager # processRightClickBlock ( EntityPlayer , World , ItemStack , EnumHand , BlockPos , EnumFacing , float , float , float ) } 
 + * and { @ link PlayerInteractionManager # tryHarvestBlock ( BlockPos ) } . < br > 
 * < br > 
 * { @ link # original } contains the original ItemStack before the item was destroyed . < br > 
 * ( @ link # hand ) contains the hand that the current item was held in . < br >
