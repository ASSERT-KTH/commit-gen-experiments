BLEU SCORE: 0.020980574531482755

TEST MSG: Access Transformer . Starting to try and launch things .
GENERATED MSG: Early signs of modloading

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / fml / LaunchTesting . java b / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> index 020c5e7 . . 0dc90b9 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> + + + b / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> @ @ - 19 , 16 + 19 , 44 @ @ <nl> <nl> package net . minecraftforge . fml ; <nl> <nl> + import com . google . common . base . Strings ; <nl> import cpw . mods . modlauncher . Launcher ; <nl> import org . apache . logging . log4j . Level ; <nl> import org . apache . logging . log4j . core . config . Configurator ; <nl> <nl> + import java . io . File ; <nl> + import java . lang . reflect . Field ; <nl> + <nl> public class LaunchTesting <nl> { <nl> public static void main ( String . . . args ) throws InterruptedException <nl> { <nl> Configurator . setRootLevel ( Level . DEBUG ) ; <nl> - Launcher . main ( " - - launchTarget " , " fml " , " - - gameDir " , " projects / run " ) ; <nl> + hackNatives ( ) ; <nl> + Launcher . main ( " - - launchTarget " , " devfml " , " - - gameDir " , " projects / run " , " - - accessToken " , " blah " , " - - version " , " FMLDev " ) ; <nl> Thread . sleep ( 10000 ) ; <nl> } <nl> + <nl> + private static void hackNatives ( ) <nl> + { <nl> + String paths = System . getProperty ( " java . library . path " ) ; <nl> + String nativesDir = " / home / cpw / . gradle / caches / minecraft / net / minecraft / natives / 1 . 12 . 2 " ; <nl> + <nl> + if ( Strings . isNullOrEmpty ( paths ) ) <nl> + paths = nativesDir ; <nl> + else <nl> + paths + = File . pathSeparator + nativesDir ; <nl> + <nl> + System . setProperty ( " java . library . path " , paths ) ; <nl> + <nl> + / / hack the classloader now . <nl> + try <nl> + { <nl> + final Field sysPathsField = ClassLoader . class . getDeclaredField ( " sys _ paths " ) ; <nl> + sysPathsField . setAccessible ( true ) ; <nl> + sysPathsField . set ( null , null ) ; <nl> + } <nl> + catch ( Throwable t ) { } <nl> + } <nl> + <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java <nl> new file mode 100644 <nl> index 0000000 . . 050a126 <nl> - - - / dev / null <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java <nl> @ @ - 0 , 0 + 1 , 61 @ @ <nl> + / * <nl> + * Minecraft Forge <nl> + * Copyright ( c ) 2018 . <nl> + * <nl> + * This library is free software ; you can redistribute it and / or <nl> + * modify it under the terms of the GNU Lesser General Public <nl> + * License as published by the Free Software Foundation version 2 . 1 <nl> + * of the License . <nl> + * <nl> + * This library is distributed in the hope that it will be useful , <nl> + * but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> + * Lesser General Public License for more details . <nl> + * <nl> + * You should have received a copy of the GNU Lesser General Public <nl> + * License along with this library ; if not , write to the Free Software <nl> + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA <nl> + * / <nl> + <nl> + package net . minecraftforge . fml . loading ; <nl> + <nl> + import cpw . mods . modlauncher . api . ILaunchHandlerService ; <nl> + import net . minecraft . client . main . Main ; <nl> + <nl> + import java . net . URISyntaxException ; <nl> + import java . nio . file . Path ; <nl> + import java . nio . file . Paths ; <nl> + import java . util . concurrent . Callable ; <nl> + <nl> + public class FMLDevLaunchProvider implements ILaunchHandlerService <nl> + { <nl> + @ Override <nl> + public String name ( ) <nl> + { <nl> + return " devfml " ; <nl> + } <nl> + <nl> + @ Override <nl> + public Path [ ] identifyTransformationTargets ( ) <nl> + { <nl> + try <nl> + { <nl> + return new Path [ ] { <nl> + Paths . get ( getClass ( ) . getProtectionDomain ( ) . getCodeSource ( ) . getLocation ( ) . toURI ( ) ) <nl> + } ; <nl> + } <nl> + catch ( URISyntaxException e ) <nl> + { <nl> + throw new RuntimeException ( " I can ' t find myself ! " ) ; <nl> + } <nl> + } <nl> + <nl> + @ Override <nl> + public Callable < Void > launchService ( String [ ] arguments , ClassLoader launchClassLoader ) <nl> + { <nl> + return ( ) - > { <nl> + Main . main ( arguments ) ; <nl> + return null ; <nl> + } ; <nl> + } <nl> + } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java <nl> index 09fd12e . . 484ac2a 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java <nl> @ @ - 20 , 6 + 20 , 7 @ @ <nl> package net . minecraftforge . fml . loading ; <nl> <nl> import cpw . mods . modlauncher . api . ILaunchHandlerService ; <nl> + import net . minecraft . client . main . Main ; <nl> <nl> import java . nio . file . Path ; <nl> import java . util . concurrent . Callable ; <nl> @ @ - 41 , 6 + 42 , 8 @ @ public class FMLLaunchProvider implements ILaunchHandlerService <nl> @ Override <nl> public Callable < Void > launchService ( String [ ] arguments , ClassLoader launchClassLoader ) <nl> { <nl> - return ( ) - > { return null ; } ; <nl> + return ( ) - > { <nl> + return null ; <nl> + } ; <nl> } <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> index 0255021 . . c46a222 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> @ @ - 24 , 10 + 24 , 18 @ @ import cpw . mods . modlauncher . api . ITransformationService ; <nl> import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; <nl> import cpw . mods . modlauncher . serviceapi . ILaunchPluginService ; <nl> import net . minecraftforge . common . ForgeVersion ; <nl> + import net . minecraftforge . fml . common . FMLPaths ; <nl> import net . minecraftforge . fml . loading . moddiscovery . ModDiscoverer ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; <nl> import net . minecraftforge . forgespi . ICoreModProvider ; <nl> <nl> + import java . net . URI ; <nl> + import java . net . URISyntaxException ; <nl> + import java . net . URL ; <nl> + import java . nio . file . Path ; <nl> + import java . nio . file . Paths ; <nl> import java . util . ArrayList ; <nl> + import java . util . Optional ; <nl> import java . util . ServiceLoader ; <nl> import java . util . Set ; <nl> import java . util . stream . Collectors ; <nl> @ @ - 81 , 7 + 89 , 7 @ @ public class FMLLoader <nl> languageLoadingProvider = new LanguageLoadingProvider ( ) ; <nl> } <nl> <nl> - public static void load ( ) <nl> + public static void beginModScan ( ) <nl> { <nl> fmlLog . debug ( SCAN , " Scanning for Mod Locators " ) ; <nl> modDiscoverer = new ModDiscoverer ( ) ; <nl> @ @ - 96 , 4 + 104 , 28 @ @ public class FMLLoader <nl> { <nl> return languageLoadingProvider ; <nl> } <nl> + <nl> + public static void loadAccessTransformer ( ) <nl> + { <nl> + final URL resource = FMLLoader . class . getClassLoader ( ) . getResource ( " forge _ at . cfg " ) ; <nl> + if ( resource = = null ) { <nl> + throw new RuntimeException ( " Missing forge _ at . cfg file " ) ; <nl> + } <nl> + try <nl> + { <nl> + fmlLog . debug ( CORE , " Loading forge _ at . cfg into access transformer " ) ; <nl> + accessTransformer . addResource ( Paths . get ( resource . toURI ( ) ) , " forge _ at . cfg " ) ; <nl> + } <nl> + catch ( URISyntaxException e ) <nl> + { <nl> + fmlLog . error ( " Error loading forge _ at . cfg file " , e ) ; <nl> + throw new RuntimeException ( e ) ; <nl> + } <nl> + } <nl> + <nl> + public static void addAccessTransformer ( Path atPath , ModFile modName ) <nl> + { <nl> + fmlLog . debug ( SCAN , " Adding Access Transformer in { } " , modName . getFilePath ( ) ) ; <nl> + accessTransformer . addResource ( atPath , modName . getFileName ( ) ) ; <nl> + } <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> index 0d1c070 . . 8c613ed 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> @ @ - 25 , 17 + 25 , 14 @ @ import cpw . mods . modlauncher . api . ITransformer ; <nl> import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; <nl> import joptsimple . ArgumentAcceptingOptionSpec ; <nl> import joptsimple . OptionSpecBuilder ; <nl> - import net . minecraftforge . coremod . CoreModEngine ; <nl> import net . minecraftforge . fml . FMLConfig ; <nl> import net . minecraftforge . fml . common . FMLPaths ; <nl> <nl> import javax . annotation . Nonnull ; <nl> import java . util . ArrayList ; <nl> - import java . util . Collections ; <nl> import java . util . List ; <nl> import java . util . Set ; <nl> import java . util . function . BiFunction ; <nl> - import java . util . stream . Collectors ; <nl> <nl> import static net . minecraftforge . fml . Logging . CORE ; <nl> import static net . minecraftforge . fml . Logging . fmlLog ; <nl> @ @ - 62 , 7 + 59 , 9 @ @ public class FMLServiceProvider implements ITransformationService <nl> fmlLog . debug ( CORE , " Loading configuration " ) ; <nl> FMLConfig . load ( ) ; <nl> fmlLog . debug ( CORE , " Initiating mod scan " ) ; <nl> - FMLLoader . load ( ) ; <nl> + FMLLoader . beginModScan ( ) ; <nl> + fmlLog . debug ( CORE , " Loading access transformers " ) ; <nl> + FMLLoader . loadAccessTransformer ( ) ; <nl> } <nl> <nl> @ Override <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> index de71a15 . . 931d9ad 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> @ @ - 23 , 9 + 23 , 11 @ @ import cpw . mods . modlauncher . ServiceLoaderStreamUtils ; <nl> import net . minecraftforge . fml . loading . FMLLoader ; <nl> import net . minecraftforge . fml . loading . LanguageLoadingProvider ; <nl> <nl> + import java . nio . file . Path ; <nl> import java . util . Collection ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> + import java . util . Optional ; <nl> import java . util . ServiceLoader ; <nl> import java . util . stream . Collectors ; <nl> <nl> @ @ - 62 , 6 + 64 , 7 @ @ public class ModDiscoverer { <nl> mods . forEach ( ModFile : : identifyMods ) ; <nl> fmlLog . debug ( SCAN , " Found { } mod files with { } mods " , mods : : size , ( ) - > mods . stream ( ) . mapToInt ( mf - > mf . getModInfos ( ) . size ( ) ) . sum ( ) ) ; <nl> mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( FMLLoader . getCoreModProvider ( ) : : addCoreMod ) ; <nl> + mods . forEach ( mod - > mod . getAccessTransformer ( ) . ifPresent ( path - > FMLLoader . addAccessTransformer ( path , mod ) ) ) ; <nl> mods . forEach ( backgroundScanHandler : : submitForScanning ) ; <nl> return backgroundScanHandler ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> index 8f57bae . . 67659a7 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> @ @ - 22 , 6 + 22 , 7 @ @ package net . minecraftforge . fml . loading . moddiscovery ; <nl> import net . minecraftforge . fml . loading . IModLanguageProvider ; <nl> <nl> import javax . swing . text . html . Option ; <nl> + import java . nio . file . Files ; <nl> import java . nio . file . Path ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> @ @ - 47 , 6 + 48 , 7 @ @ public class ModFile <nl> DEFAULTMANIFEST . getMainAttributes ( ) . putValue ( " FMLModType " , " MOD " ) ; <nl> } <nl> <nl> + <nl> public void claimLanguage ( String modId , IModLanguageProvider . IModLanguageLoader loader ) <nl> { <nl> this . modInfoMap . get ( modId ) . setLoader ( loader ) ; <nl> @ @ - 64 , 6 + 66 , 7 @ @ public class ModFile <nl> private ScanResult fileScanResult ; <nl> private CompletableFuture < ScanResult > futureScanResult ; <nl> private List < CoreModFile > coreMods ; <nl> + private Path accessTransformer ; <nl> <nl> private static final Attributes . Name TYPE = new Attributes . Name ( " FMLModType " ) ; <nl> <nl> @ @ - 89 , 12 + 92 , 16 @ @ public class ModFile <nl> return modInfos ; <nl> } <nl> <nl> + public Optional < Path > getAccessTransformer ( ) { <nl> + return Optional . ofNullable ( Files . exists ( accessTransformer ) ? accessTransformer : null ) ; <nl> + } <nl> public void identifyMods ( ) { <nl> this . modInfos = ModFileParser . readModList ( this ) ; <nl> this . modInfos . forEach ( mi - > fmlLog . debug ( LOADING , " Found mod { } for language { } " , mi . getModId ( ) , mi . getModLoader ( ) ) ) ; <nl> this . modInfoMap = this . modInfos . stream ( ) . collect ( Collectors . toMap ( ModInfo : : getModId , Function . identity ( ) ) ) ; <nl> this . coreMods = ModFileParser . getCoreMods ( this ) ; <nl> this . coreMods . forEach ( mi - > fmlLog . debug ( LOADING , " Found coremod { } " , mi . getPath ( ) ) ) ; <nl> + this . accessTransformer = locator . findPath ( this , " META - INF " , " accesstransformer . cfg " ) ; <nl> } <nl> <nl> <nl> @ @ - 112 , 7 + 119 , 6 @ @ public class ModFile <nl> public void scanFile ( Consumer < Path > pathConsumer ) { <nl> locator . scanFile ( this , pathConsumer ) ; <nl> } <nl> - <nl> public void setFutureScanResult ( CompletableFuture < ScanResult > future ) <nl> { <nl> this . futureScanResult = future ; <nl> diff - - git a / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService b / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService <nl> index 6b6ff62 . . 4d7e898 100644 <nl> - - - a / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService <nl> + + + b / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService <nl> @ @ - 1 + 1 , 2 @ @ <nl> - net . minecraftforge . fml . loading . FMLLaunchProvider <nl> \ No newline at end of file <nl> + net . minecraftforge . fml . loading . FMLLaunchProvider <nl> + net . minecraftforge . fml . loading . FMLDevLaunchProvider <nl> \ No newline at end of file
NEAREST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / fml / LaunchTesting . java b / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> index c34b865 . . 020c5e7 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> + + + b / src / main / java / net / minecraftforge / fml / LaunchTesting . java <nl> @ @ - 25 , 9 + 25 , 10 @ @ import org . apache . logging . log4j . core . config . Configurator ; <nl> <nl> public class LaunchTesting <nl> { <nl> - public static void main ( String . . . args ) <nl> + public static void main ( String . . . args ) throws InterruptedException <nl> { <nl> Configurator . setRootLevel ( Level . DEBUG ) ; <nl> Launcher . main ( " - - launchTarget " , " fml " , " - - gameDir " , " projects / run " ) ; <nl> + Thread . sleep ( 10000 ) ; <nl> } <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java <nl> new file mode 100644 <nl> index 0000000 . . fe23461 <nl> - - - / dev / null <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java <nl> @ @ - 0 , 0 + 1 , 86 @ @ <nl> + / * <nl> + * Minecraft Forge <nl> + * Copyright ( c ) 2018 . <nl> + * <nl> + * This library is free software ; you can redistribute it and / or <nl> + * modify it under the terms of the GNU Lesser General Public <nl> + * License as published by the Free Software Foundation version 2 . 1 <nl> + * of the License . <nl> + * <nl> + * This library is distributed in the hope that it will be useful , <nl> + * but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> + * Lesser General Public License for more details . <nl> + * <nl> + * You should have received a copy of the GNU Lesser General Public <nl> + * License along with this library ; if not , write to the Free Software <nl> + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA <nl> + * / <nl> + <nl> + package net . minecraftforge . fml . loading ; <nl> + <nl> + import net . minecraftforge . fml . common . ModContainer ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModInfo ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ScanResult ; <nl> + import org . objectweb . asm . Type ; <nl> + <nl> + import java . util . List ; <nl> + import java . util . Map ; <nl> + import java . util . function . Consumer ; <nl> + import java . util . function . Function ; <nl> + import java . util . stream . Collectors ; <nl> + <nl> + import static net . minecraftforge . fml . Logging . SCAN ; <nl> + import static net . minecraftforge . fml . Logging . fmlLog ; <nl> + <nl> + public class FMLJavaModLanguageProvider implements IModLanguageProvider <nl> + { <nl> + private static class FMLModTarget implements IModLanguageProvider . IModLanguageLoader { <nl> + private final String className ; <nl> + private final String modId ; <nl> + <nl> + private FMLModTarget ( String className , String modId ) <nl> + { <nl> + this . className = className ; <nl> + this . modId = modId ; <nl> + } <nl> + <nl> + public String getModId ( ) <nl> + { <nl> + return modId ; <nl> + } <nl> + <nl> + @ Override <nl> + public ModContainer loadMod ( ModFile file , ClassLoader modClassLoader ) <nl> + { <nl> + return null ; <nl> + } <nl> + } <nl> + <nl> + public static final Type MODANNOTATION = Type . getType ( " Lnet / minecraftforge / fml / common / Mod ; " ) ; <nl> + <nl> + @ Override <nl> + public String name ( ) <nl> + { <nl> + return " javafml " ; <nl> + } <nl> + <nl> + @ Override <nl> + public Consumer < ScanResult > getFileVisitor ( ) { <nl> + return scanResult - > { <nl> + final Map < String , FMLModTarget > modTargetMap = scanResult . getAnnotations ( ) . stream ( ) <nl> + . filter ( ad - > ad . getAnnotationType ( ) . equals ( MODANNOTATION ) ) <nl> + . peek ( ad - > fmlLog . debug ( SCAN , " Found @ Mod class { } with id { } " , ad . getClassType ( ) . getClassName ( ) , ad . getAnnotationData ( ) . get ( " modid " ) ) ) <nl> + . map ( ad - > new FMLModTarget ( ad . getClassType ( ) . getClassName ( ) , ( String ) ad . getAnnotationData ( ) . get ( " modid " ) ) ) <nl> + . collect ( Collectors . toMap ( FMLModTarget : : getModId , Function . identity ( ) ) ) ; <nl> + modTargetMap . forEach ( ( key , value ) - > scanResult . getFile ( ) . claimLanguage ( key , value ) ) ; <nl> + } ; <nl> + } <nl> + <nl> + @ Override <nl> + public List < ModContainer > buildModContainers ( List < ModInfo > modFiles , ClassLoader modClassLoader ) <nl> + { <nl> + return null ; <nl> + } <nl> + } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> index 5aecb99 . . 0255021 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java <nl> @ @ - 28 , 25 + 28 , 20 @ @ import net . minecraftforge . fml . loading . moddiscovery . ModDiscoverer ; <nl> import net . minecraftforge . forgespi . ICoreModProvider ; <nl> <nl> import java . util . ArrayList ; <nl> - import java . util . Arrays ; <nl> - import java . util . HashSet ; <nl> - import java . util . Iterator ; <nl> - import java . util . List ; <nl> import java . util . ServiceLoader ; <nl> import java . util . Set ; <nl> import java . util . stream . Collectors ; <nl> <nl> import static net . minecraftforge . fml . Logging . CORE ; <nl> - import static net . minecraftforge . fml . Logging . LOADING ; <nl> import static net . minecraftforge . fml . Logging . SCAN ; <nl> import static net . minecraftforge . fml . Logging . fmlLog ; <nl> <nl> public class FMLLoader <nl> { <nl> - <nl> private static ILaunchPluginService accessTransformer ; <nl> private static ModDiscoverer modDiscoverer ; <nl> - private static ICoreModProvider coreMod ; <nl> + private static ICoreModProvider coreModProvider ; <nl> + private static LanguageLoadingProvider languageLoadingProvider ; <nl> <nl> static void onInitialLoad ( IEnvironment environment , Set < String > otherServices ) throws IncompatibleEnvironmentException <nl> { <nl> @ @ - 79 , 9 + 74 , 11 @ @ public class FMLLoader <nl> throw new IncompatibleEnvironmentException ( " Multiple coremod libraries found " ) ; <nl> } <nl> <nl> - coreMod = coreModProviders . get ( 0 ) ; <nl> - final Package coremodPackage = coreMod . getClass ( ) . getPackage ( ) ; <nl> + coreModProvider = coreModProviders . get ( 0 ) ; <nl> + final Package coremodPackage = coreModProvider . getClass ( ) . getPackage ( ) ; <nl> fmlLog . debug ( CORE , " FML found CoreMod version : { } " , coremodPackage . getImplementationVersion ( ) ) ; <nl> + <nl> + languageLoadingProvider = new LanguageLoadingProvider ( ) ; <nl> } <nl> <nl> public static void load ( ) <nl> @ @ - 90 , 4 + 87 , 13 @ @ public class FMLLoader <nl> modDiscoverer = new ModDiscoverer ( ) ; <nl> modDiscoverer . discoverMods ( ) ; <nl> } <nl> + <nl> + public static ICoreModProvider getCoreModProvider ( ) { <nl> + return coreModProvider ; <nl> + } <nl> + <nl> + public static LanguageLoadingProvider getLanguageLoadingProvider ( ) <nl> + { <nl> + return languageLoadingProvider ; <nl> + } <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> index 3ceec55 . . 0d1c070 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java <nl> @ @ - 25 , 14 + 25 , 17 @ @ import cpw . mods . modlauncher . api . ITransformer ; <nl> import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; <nl> import joptsimple . ArgumentAcceptingOptionSpec ; <nl> import joptsimple . OptionSpecBuilder ; <nl> + import net . minecraftforge . coremod . CoreModEngine ; <nl> import net . minecraftforge . fml . FMLConfig ; <nl> import net . minecraftforge . fml . common . FMLPaths ; <nl> <nl> import javax . annotation . Nonnull ; <nl> + import java . util . ArrayList ; <nl> import java . util . Collections ; <nl> import java . util . List ; <nl> import java . util . Set ; <nl> import java . util . function . BiFunction ; <nl> + import java . util . stream . Collectors ; <nl> <nl> import static net . minecraftforge . fml . Logging . CORE ; <nl> import static net . minecraftforge . fml . Logging . fmlLog ; <nl> @ @ - 86 , 7 + 89 , 8 @ @ public class FMLServiceProvider implements ITransformationService <nl> @ Override <nl> public List < ITransformer > transformers ( ) <nl> { <nl> - return Collections . emptyList ( ) ; <nl> + fmlLog . debug ( CORE , " Loading coremod transformers " ) ; <nl> + return new ArrayList < > ( FMLLoader . getCoreModProvider ( ) . getCoreModTransformers ( ) ) ; <nl> } <nl> <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java b / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java <nl> new file mode 100644 <nl> index 0000000 . . cceb903 <nl> - - - / dev / null <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java <nl> @ @ - 0 , 0 + 1 , 47 @ @ <nl> + / * <nl> + * Minecraft Forge <nl> + * Copyright ( c ) 2018 . <nl> + * <nl> + * This library is free software ; you can redistribute it and / or <nl> + * modify it under the terms of the GNU Lesser General Public <nl> + * License as published by the Free Software Foundation version 2 . 1 <nl> + * of the License . <nl> + * <nl> + * This library is distributed in the hope that it will be useful , <nl> + * but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> + * Lesser General Public License for more details . <nl> + * <nl> + * You should have received a copy of the GNU Lesser General Public <nl> + * License along with this library ; if not , write to the Free Software <nl> + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA <nl> + * / <nl> + <nl> + package net . minecraftforge . fml . loading ; <nl> + <nl> + import net . minecraftforge . fml . common . ModContainer ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModInfo ; <nl> + import net . minecraftforge . fml . loading . moddiscovery . ScanResult ; <nl> + <nl> + import java . util . List ; <nl> + import java . util . function . Consumer ; <nl> + <nl> + / * * <nl> + * Loaded as a ServiceLoader , from the classpath . Extensions are loaded from <nl> + * the mods directory , with the FMLType META - INF of LANGPROVIDER . <nl> + * <nl> + * Version data is read from the manifest ' s implementation version . <nl> + * / <nl> + public interface IModLanguageProvider <nl> + { <nl> + String name ( ) ; <nl> + <nl> + Consumer < ScanResult > getFileVisitor ( ) ; <nl> + <nl> + interface IModLanguageLoader { <nl> + ModContainer loadMod ( ModFile file , ClassLoader modClassLoader ) ; <nl> + } <nl> + <nl> + List < ModContainer > buildModContainers ( List < ModInfo > modFiles , ClassLoader modClassLoader ) ; <nl> + } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java b / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java <nl> new file mode 100644 <nl> index 0000000 . . 5b7c7f9 <nl> - - - / dev / null <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java <nl> @ @ - 0 , 0 + 1 , 64 @ @ <nl> + / * <nl> + * Minecraft Forge <nl> + * Copyright ( c ) 2018 . <nl> + * <nl> + * This library is free software ; you can redistribute it and / or <nl> + * modify it under the terms of the GNU Lesser General Public <nl> + * License as published by the Free Software Foundation version 2 . 1 <nl> + * of the License . <nl> + * <nl> + * This library is distributed in the hope that it will be useful , <nl> + * but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> + * Lesser General Public License for more details . <nl> + * <nl> + * You should have received a copy of the GNU Lesser General Public <nl> + * License along with this library ; if not , write to the Free Software <nl> + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA <nl> + * / <nl> + <nl> + package net . minecraftforge . fml . loading ; <nl> + <nl> + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; <nl> + <nl> + import java . nio . file . Path ; <nl> + import java . util . ArrayList ; <nl> + import java . util . HashMap ; <nl> + import java . util . List ; <nl> + import java . util . Map ; <nl> + import java . util . ServiceLoader ; <nl> + import java . util . stream . Stream ; <nl> + <nl> + import static net . minecraftforge . fml . Logging . CORE ; <nl> + import static net . minecraftforge . fml . Logging . fmlLog ; <nl> + <nl> + public class LanguageLoadingProvider <nl> + { <nl> + private final List < IModLanguageProvider > languageProviders = new ArrayList < > ( ) ; <nl> + private final ServiceLoader < IModLanguageProvider > serviceLoader ; <nl> + private final Map < String , IModLanguageProvider > languageProviderMap = new HashMap < > ( ) ; <nl> + <nl> + LanguageLoadingProvider ( ) { <nl> + serviceLoader = ServiceLoader . load ( IModLanguageProvider . class ) ; <nl> + serviceLoader . forEach ( languageProviders : : add ) ; <nl> + <nl> + languageProviders . forEach ( lp - > { <nl> + final Package pkg = lp . getClass ( ) . getPackage ( ) ; <nl> + fmlLog . debug ( CORE , " Found system classpath language provider { } , version { } " , lp . name ( ) , pkg . getImplementationVersion ( ) ) ; <nl> + } ) ; <nl> + <nl> + languageProviders . forEach ( lp - > languageProviderMap . put ( lp . name ( ) , lp ) ) ; <nl> + } <nl> + <nl> + public void addAdditionalLanguages ( List < ModFile > modFiles ) <nl> + { <nl> + if ( modFiles = = null ) return ; <nl> + Stream < Path > langPaths = modFiles . stream ( ) . map ( ModFile : : getFilePath ) ; <nl> + serviceLoader . reload ( ) ; <nl> + } <nl> + <nl> + public IModLanguageProvider getLanguage ( String name ) <nl> + { <nl> + return languageProviderMap . get ( name ) ; <nl> + } <nl> + } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java <nl> index 93694a4 . . 42a754f 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java <nl> @ @ - 19 , 11 + 19 , 14 @ @ <nl> <nl> package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> + import com . google . common . util . concurrent . MoreExecutors ; <nl> + <nl> import java . util . ArrayList ; <nl> import java . util . List ; <nl> import java . util . concurrent . CompletableFuture ; <nl> import java . util . concurrent . ExecutorService ; <nl> import java . util . concurrent . Executors ; <nl> + import java . util . concurrent . ThreadFactory ; <nl> import java . util . concurrent . TimeUnit ; <nl> <nl> import static net . minecraftforge . fml . Logging . SCAN ; <nl> @ @ - 37 , 7 + 40 , 11 @ @ public class BackgroundScanHandler <nl> private final List < ModFile > allFiles ; <nl> <nl> public BackgroundScanHandler ( ) { <nl> - modContentScanner = Executors . newCachedThreadPool ( ) ; <nl> + modContentScanner = Executors . newSingleThreadExecutor ( r - > { <nl> + final Thread thread = Executors . defaultThreadFactory ( ) . newThread ( r ) ; <nl> + thread . setDaemon ( true ) ; <nl> + return thread ; <nl> + } ) ; <nl> scannedFiles = new ArrayList < > ( ) ; <nl> pendingFiles = new ArrayList < > ( ) ; <nl> allFiles = new ArrayList < > ( ) ; <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> index 27dc4f0 . . de71a15 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java <nl> @ @ - 20 , 6 + 20 , 8 @ @ <nl> package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> import cpw . mods . modlauncher . ServiceLoaderStreamUtils ; <nl> + import net . minecraftforge . fml . loading . FMLLoader ; <nl> + import net . minecraftforge . fml . loading . LanguageLoadingProvider ; <nl> <nl> import java . util . Collection ; <nl> import java . util . List ; <nl> @ @ - 54 , 12 + 56 , 12 @ @ public class ModDiscoverer { <nl> . peek ( mf - > fmlLog . debug ( SCAN , " Found mod file { } of type { } with locator { } " , mf . getFileName ( ) , mf . getType ( ) , mf . getLocator ( ) ) ) <nl> . collect ( Collectors . groupingBy ( ModFile : : getType ) ) ; <nl> <nl> - / / ModLanguageProvider . loadAdditionalLanguages ( modFiles . get ( ModFile . Type . LANGPROVIDER ) ) ; <nl> + FMLLoader . getLanguageLoadingProvider ( ) . addAdditionalLanguages ( modFiles . get ( ModFile . Type . LANGPROVIDER ) ) ; <nl> BackgroundScanHandler backgroundScanHandler = new BackgroundScanHandler ( ) ; <nl> final List < ModFile > mods = modFiles . get ( ModFile . Type . MOD ) ; <nl> mods . forEach ( ModFile : : identifyMods ) ; <nl> fmlLog . debug ( SCAN , " Found { } mod files with { } mods " , mods : : size , ( ) - > mods . stream ( ) . mapToInt ( mf - > mf . getModInfos ( ) . size ( ) ) . sum ( ) ) ; <nl> - / / mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( ServiceProviders . getCoreModProvider ( ) : : addCoreMod ) ; <nl> + mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( FMLLoader . getCoreModProvider ( ) : : addCoreMod ) ; <nl> mods . forEach ( backgroundScanHandler : : submitForScanning ) ; <nl> return backgroundScanHandler ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> index 8733035 . . 8f57bae 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java <nl> @ @ - 19 , 14 + 19 , 21 @ @ <nl> <nl> package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> + import net . minecraftforge . fml . loading . IModLanguageProvider ; <nl> + <nl> + import javax . swing . text . html . Option ; <nl> import java . nio . file . Path ; <nl> import java . util . List ; <nl> + import java . util . Map ; <nl> import java . util . Objects ; <nl> + import java . util . Optional ; <nl> import java . util . concurrent . CompletableFuture ; <nl> import java . util . concurrent . ExecutionException ; <nl> import java . util . function . Consumer ; <nl> + import java . util . function . Function ; <nl> import java . util . jar . Attributes ; <nl> import java . util . jar . Manifest ; <nl> + import java . util . stream . Collectors ; <nl> <nl> import static net . minecraftforge . fml . Logging . LOADING ; <nl> import static net . minecraftforge . fml . Logging . SCAN ; <nl> @ @ - 40 , 6 + 47 , 11 @ @ public class ModFile <nl> DEFAULTMANIFEST . getMainAttributes ( ) . putValue ( " FMLModType " , " MOD " ) ; <nl> } <nl> <nl> + public void claimLanguage ( String modId , IModLanguageProvider . IModLanguageLoader loader ) <nl> + { <nl> + this . modInfoMap . get ( modId ) . setLoader ( loader ) ; <nl> + } <nl> + <nl> public enum Type { <nl> MOD , LIBRARY , LANGPROVIDER <nl> } <nl> @ @ - 47 , 6 + 59 , 7 @ @ public class ModFile <nl> private final Type modFileType ; <nl> private final Manifest manifest ; <nl> private List < ModInfo > modInfos ; <nl> + private Map < String , ModInfo > modInfoMap ; <nl> private final IModLocator locator ; <nl> private ScanResult fileScanResult ; <nl> private CompletableFuture < ScanResult > futureScanResult ; <nl> @ @ - 60 , 7 + 73 , 8 @ @ public class ModFile <nl> manifest = locator . findManifest ( file ) . orElse ( DEFAULTMANIFEST ) ; <nl> if ( manifest ! = DEFAULTMANIFEST ) fmlLog . debug ( SCAN , " Mod file { } has a manifest " , file ) ; <nl> else fmlLog . debug ( SCAN , " Mod file { } is missing a manifest " , file ) ; <nl> - modFileType = Type . valueOf ( manifest . getMainAttributes ( ) . getValue ( TYPE ) ) ; <nl> + final Optional < String > value = Optional . ofNullable ( manifest . getMainAttributes ( ) . getValue ( TYPE ) ) ; <nl> + modFileType = Type . valueOf ( value . orElse ( " MOD " ) ) ; <nl> } <nl> <nl> public Type getType ( ) { <nl> @ @ - 78 , 6 + 92 , 7 @ @ public class ModFile <nl> public void identifyMods ( ) { <nl> this . modInfos = ModFileParser . readModList ( this ) ; <nl> this . modInfos . forEach ( mi - > fmlLog . debug ( LOADING , " Found mod { } for language { } " , mi . getModId ( ) , mi . getModLoader ( ) ) ) ; <nl> + this . modInfoMap = this . modInfos . stream ( ) . collect ( Collectors . toMap ( ModInfo : : getModId , Function . identity ( ) ) ) ; <nl> this . coreMods = ModFileParser . getCoreMods ( this ) ; <nl> this . coreMods . forEach ( mi - > fmlLog . debug ( LOADING , " Found coremod { } " , mi . getPath ( ) ) ) ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java <nl> index 2a3c1de . . 7910600 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java <nl> @ @ - 20 , 6 + 20 , 10 @ @ <nl> package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> import net . minecraftforge . fml . common . versioning . ArtifactVersion ; <nl> + import net . minecraftforge . fml . loading . IModLanguageProvider ; <nl> + <nl> + import java . net . URL ; <nl> + import java . util . List ; <nl> <nl> public class ModInfo { <nl> private final ModFile owningFile ; <nl> @ @ - 27 , 11 + 31 , 12 @ @ public class ModInfo { <nl> private final ArtifactVersion version ; <nl> private final String displayName ; <nl> private final String description ; <nl> - private final java . net . URL updateJSONURL ; <nl> + private final URL updateJSONURL ; <nl> private final String modLoader ; <nl> - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ModInfo . ModVersion > dependencies ; <nl> + private final List < ModInfo . ModVersion > dependencies ; <nl> + private IModLanguageProvider . IModLanguageLoader loader ; <nl> <nl> - public ModInfo ( final ModFile owningFile , final String modLoader , final String modId , final String displayName , final ArtifactVersion version , final String description , final java . net . URL updateJSONURL , final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ModInfo . ModVersion > dependencies ) { <nl> + public ModInfo ( final ModFile owningFile , final String modLoader , final String modId , final String displayName , final ArtifactVersion version , final String description , final URL updateJSONURL , final List < ModInfo . ModVersion > dependencies ) { <nl> this . owningFile = owningFile ; <nl> this . modLoader = modLoader ; <nl> this . modId = modId ; <nl> @ @ - 58 , 6 + 63 , 11 @ @ public class ModInfo { <nl> return version ; <nl> } <nl> <nl> + public void setLoader ( IModLanguageProvider . IModLanguageLoader loader ) <nl> + { <nl> + this . loader = loader ; <nl> + } <nl> + <nl> public enum Ordering { <nl> BEFORE , AFTER , NONE ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java <nl> index f35f626 . . cd75eaa 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java <nl> @ @ - 22 , 27 + 22 , 33 @ @ package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> import org . objectweb . asm . Type ; <nl> <nl> + import java . util . ArrayList ; <nl> + import java . util . List ; <nl> import java . util . Map ; <nl> import java . util . Set ; <nl> <nl> public class ScanResult { <nl> private final ModFile file ; <nl> - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . AnnotationData > annotations = new java . util . ArrayList < > ( ) ; <nl> - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . ClassData > classes = new java . util . ArrayList < > ( ) ; <nl> + private final List < ScanResult . AnnotationData > annotations = new ArrayList < > ( ) ; <nl> + private final List < ScanResult . ClassData > classes = new ArrayList < > ( ) ; <nl> <nl> public ScanResult ( final ModFile file ) { <nl> this . file = file ; <nl> } <nl> <nl> + public ModFile getFile ( ) { <nl> + return file ; <nl> + } <nl> + <nl> public static boolean interestingAnnotations ( final ModAnnotation annotation ) { <nl> return true ; <nl> } <nl> <nl> - public java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . ClassData > getClasses ( ) { <nl> + public List < ScanResult . ClassData > getClasses ( ) { <nl> return classes ; <nl> } <nl> <nl> - public java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . AnnotationData > getAnnotations ( ) { <nl> + public List < ScanResult . AnnotationData > getAnnotations ( ) { <nl> return annotations ; <nl> } <nl> <nl> diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java <nl> index 0770426 . . 92fdab3 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java <nl> + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java <nl> @ @ - 19 , 8 + 19 , 19 @ @ <nl> <nl> package net . minecraftforge . fml . loading . moddiscovery ; <nl> <nl> + import net . minecraftforge . fml . loading . FMLLoader ; <nl> + import net . minecraftforge . fml . loading . IModLanguageProvider ; <nl> + import net . minecraftforge . fml . loading . LanguageLoadingProvider ; <nl> import org . objectweb . asm . ClassReader ; <nl> <nl> + import java . io . IOException ; <nl> + import java . nio . file . Files ; <nl> + import java . nio . file . Path ; <nl> + import java . util . Set ; <nl> + import java . util . function . Consumer ; <nl> + import java . util . stream . Collectors ; <nl> + <nl> + import static net . minecraftforge . fml . Logging . LOADING ; <nl> import static net . minecraftforge . fml . Logging . SCAN ; <nl> import static net . minecraftforge . fml . Logging . fmlLog ; <nl> <nl> @ @ - 34 , 17 + 45 , 20 @ @ public class Scanner { <nl> public ScanResult scan ( ) { <nl> ScanResult result = new ScanResult ( fileToScan ) ; <nl> fileToScan . scanFile ( p - > fileVisitor ( p , result ) ) ; <nl> + final Set < IModLanguageProvider > modLoaders = fileToScan . getModInfos ( ) . stream ( ) . map ( ModInfo : : getModLoader ) . map ( FMLLoader . getLanguageLoadingProvider ( ) : : getLanguage ) . collect ( Collectors . toSet ( ) ) ; <nl> + modLoaders . stream ( ) . peek ( ml - > fmlLog . debug ( SCAN , " Scanning { } with language loader { } " , fileToScan . getFilePath ( ) , ml . name ( ) ) ) <nl> + . map ( IModLanguageProvider : : getFileVisitor ) . forEach ( c - > c . accept ( result ) ) ; <nl> return result ; <nl> } <nl> <nl> - private void fileVisitor ( final java . nio . file . Path path , final ScanResult result ) { <nl> + private void fileVisitor ( final Path path , final ScanResult result ) { <nl> try { <nl> fmlLog . debug ( SCAN , " Scanning { } path { } " , fileToScan , path ) ; <nl> ModClassVisitor mcv = new ModClassVisitor ( ) ; <nl> - org . objectweb . asm . ClassReader cr = new ClassReader ( java . nio . file . Files . newInputStream ( path ) ) ; <nl> + ClassReader cr = new ClassReader ( Files . newInputStream ( path ) ) ; <nl> cr . accept ( mcv , 0 ) ; <nl> mcv . buildData ( result . getClasses ( ) , result . getAnnotations ( ) ) ; <nl> - } catch ( java . io . IOException e ) { <nl> + } catch ( IOException e ) { <nl> / / mark path bad <nl> } <nl> } <nl> diff - - git a / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider b / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider <nl> new file mode 100644 <nl> index 0000000 . . dc3f902 <nl> - - - / dev / null <nl> + + + b / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider <nl> @ @ - 0 , 0 + 1 @ @ <nl> + net . minecraftforge . fml . loading . FMLJavaModLanguageProvider <nl> \ No newline at end of file

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / fml / LaunchTesting . java b / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 index 020c5e7 . . 0dc90b9 100644 
 - - - a / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 + + + b / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 @ @ - 19 , 16 + 19 , 44 @ @ 
 
 package net . minecraftforge . fml ; 
 
 + import com . google . common . base . Strings ; 
 import cpw . mods . modlauncher . Launcher ; 
 import org . apache . logging . log4j . Level ; 
 import org . apache . logging . log4j . core . config . Configurator ; 
 
 + import java . io . File ; 
 + import java . lang . reflect . Field ; 
 + 
 public class LaunchTesting 
 { 
 public static void main ( String . . . args ) throws InterruptedException 
 { 
 Configurator . setRootLevel ( Level . DEBUG ) ; 
 - Launcher . main ( " - - launchTarget " , " fml " , " - - gameDir " , " projects / run " ) ; 
 + hackNatives ( ) ; 
 + Launcher . main ( " - - launchTarget " , " devfml " , " - - gameDir " , " projects / run " , " - - accessToken " , " blah " , " - - version " , " FMLDev " ) ; 
 Thread . sleep ( 10000 ) ; 
 } 
 + 
 + private static void hackNatives ( ) 
 + { 
 + String paths = System . getProperty ( " java . library . path " ) ; 
 + String nativesDir = " / home / cpw / . gradle / caches / minecraft / net / minecraft / natives / 1 . 12 . 2 " ; 
 + 
 + if ( Strings . isNullOrEmpty ( paths ) ) 
 + paths = nativesDir ; 
 + else 
 + paths + = File . pathSeparator + nativesDir ; 
 + 
 + System . setProperty ( " java . library . path " , paths ) ; 
 + 
 + / / hack the classloader now . 
 + try 
 + { 
 + final Field sysPathsField = ClassLoader . class . getDeclaredField ( " sys _ paths " ) ; 
 + sysPathsField . setAccessible ( true ) ; 
 + sysPathsField . set ( null , null ) ; 
 + } 
 + catch ( Throwable t ) { } 
 + } 
 + 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java 
 new file mode 100644 
 index 0000000 . . 050a126 
 - - - / dev / null 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLDevLaunchProvider . java 
 @ @ - 0 , 0 + 1 , 61 @ @ 
 + / * 
 + * Minecraft Forge 
 + * Copyright ( c ) 2018 . 
 + * 
 + * This library is free software ; you can redistribute it and / or 
 + * modify it under the terms of the GNU Lesser General Public 
 + * License as published by the Free Software Foundation version 2 . 1 
 + * of the License . 
 + * 
 + * This library is distributed in the hope that it will be useful , 
 + * but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 + * Lesser General Public License for more details . 
 + * 
 + * You should have received a copy of the GNU Lesser General Public 
 + * License along with this library ; if not , write to the Free Software 
 + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA 
 + * / 
 + 
 + package net . minecraftforge . fml . loading ; 
 + 
 + import cpw . mods . modlauncher . api . ILaunchHandlerService ; 
 + import net . minecraft . client . main . Main ; 
 + 
 + import java . net . URISyntaxException ; 
 + import java . nio . file . Path ; 
 + import java . nio . file . Paths ; 
 + import java . util . concurrent . Callable ; 
 + 
 + public class FMLDevLaunchProvider implements ILaunchHandlerService 
 + { 
 + @ Override 
 + public String name ( ) 
 + { 
 + return " devfml " ; 
 + } 
 + 
 + @ Override 
 + public Path [ ] identifyTransformationTargets ( ) 
 + { 
 + try 
 + { 
 + return new Path [ ] { 
 + Paths . get ( getClass ( ) . getProtectionDomain ( ) . getCodeSource ( ) . getLocation ( ) . toURI ( ) ) 
 + } ; 
 + } 
 + catch ( URISyntaxException e ) 
 + { 
 + throw new RuntimeException ( " I can ' t find myself ! " ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public Callable < Void > launchService ( String [ ] arguments , ClassLoader launchClassLoader ) 
 + { 
 + return ( ) - > { 
 + Main . main ( arguments ) ; 
 + return null ; 
 + } ; 
 + } 
 + } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java 
 index 09fd12e . . 484ac2a 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLaunchProvider . java 
 @ @ - 20 , 6 + 20 , 7 @ @ 
 package net . minecraftforge . fml . loading ; 
 
 import cpw . mods . modlauncher . api . ILaunchHandlerService ; 
 + import net . minecraft . client . main . Main ; 
 
 import java . nio . file . Path ; 
 import java . util . concurrent . Callable ; 
 @ @ - 41 , 6 + 42 , 8 @ @ public class FMLLaunchProvider implements ILaunchHandlerService 
 @ Override 
 public Callable < Void > launchService ( String [ ] arguments , ClassLoader launchClassLoader ) 
 { 
 - return ( ) - > { return null ; } ; 
 + return ( ) - > { 
 + return null ; 
 + } ; 
 } 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 index 0255021 . . c46a222 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 @ @ - 24 , 10 + 24 , 18 @ @ import cpw . mods . modlauncher . api . ITransformationService ; 
 import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; 
 import cpw . mods . modlauncher . serviceapi . ILaunchPluginService ; 
 import net . minecraftforge . common . ForgeVersion ; 
 + import net . minecraftforge . fml . common . FMLPaths ; 
 import net . minecraftforge . fml . loading . moddiscovery . ModDiscoverer ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; 
 import net . minecraftforge . forgespi . ICoreModProvider ; 
 
 + import java . net . URI ; 
 + import java . net . URISyntaxException ; 
 + import java . net . URL ; 
 + import java . nio . file . Path ; 
 + import java . nio . file . Paths ; 
 import java . util . ArrayList ; 
 + import java . util . Optional ; 
 import java . util . ServiceLoader ; 
 import java . util . Set ; 
 import java . util . stream . Collectors ; 
 @ @ - 81 , 7 + 89 , 7 @ @ public class FMLLoader 
 languageLoadingProvider = new LanguageLoadingProvider ( ) ; 
 } 
 
 - public static void load ( ) 
 + public static void beginModScan ( ) 
 { 
 fmlLog . debug ( SCAN , " Scanning for Mod Locators " ) ; 
 modDiscoverer = new ModDiscoverer ( ) ; 
 @ @ - 96 , 4 + 104 , 28 @ @ public class FMLLoader 
 { 
 return languageLoadingProvider ; 
 } 
 + 
 + public static void loadAccessTransformer ( ) 
 + { 
 + final URL resource = FMLLoader . class . getClassLoader ( ) . getResource ( " forge _ at . cfg " ) ; 
 + if ( resource = = null ) { 
 + throw new RuntimeException ( " Missing forge _ at . cfg file " ) ; 
 + } 
 + try 
 + { 
 + fmlLog . debug ( CORE , " Loading forge _ at . cfg into access transformer " ) ; 
 + accessTransformer . addResource ( Paths . get ( resource . toURI ( ) ) , " forge _ at . cfg " ) ; 
 + } 
 + catch ( URISyntaxException e ) 
 + { 
 + fmlLog . error ( " Error loading forge _ at . cfg file " , e ) ; 
 + throw new RuntimeException ( e ) ; 
 + } 
 + } 
 + 
 + public static void addAccessTransformer ( Path atPath , ModFile modName ) 
 + { 
 + fmlLog . debug ( SCAN , " Adding Access Transformer in { } " , modName . getFilePath ( ) ) ; 
 + accessTransformer . addResource ( atPath , modName . getFileName ( ) ) ; 
 + } 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 index 0d1c070 . . 8c613ed 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 @ @ - 25 , 17 + 25 , 14 @ @ import cpw . mods . modlauncher . api . ITransformer ; 
 import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; 
 import joptsimple . ArgumentAcceptingOptionSpec ; 
 import joptsimple . OptionSpecBuilder ; 
 - import net . minecraftforge . coremod . CoreModEngine ; 
 import net . minecraftforge . fml . FMLConfig ; 
 import net . minecraftforge . fml . common . FMLPaths ; 
 
 import javax . annotation . Nonnull ; 
 import java . util . ArrayList ; 
 - import java . util . Collections ; 
 import java . util . List ; 
 import java . util . Set ; 
 import java . util . function . BiFunction ; 
 - import java . util . stream . Collectors ; 
 
 import static net . minecraftforge . fml . Logging . CORE ; 
 import static net . minecraftforge . fml . Logging . fmlLog ; 
 @ @ - 62 , 7 + 59 , 9 @ @ public class FMLServiceProvider implements ITransformationService 
 fmlLog . debug ( CORE , " Loading configuration " ) ; 
 FMLConfig . load ( ) ; 
 fmlLog . debug ( CORE , " Initiating mod scan " ) ; 
 - FMLLoader . load ( ) ; 
 + FMLLoader . beginModScan ( ) ; 
 + fmlLog . debug ( CORE , " Loading access transformers " ) ; 
 + FMLLoader . loadAccessTransformer ( ) ; 
 } 
 
 @ Override 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 index de71a15 . . 931d9ad 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 @ @ - 23 , 9 + 23 , 11 @ @ import cpw . mods . modlauncher . ServiceLoaderStreamUtils ; 
 import net . minecraftforge . fml . loading . FMLLoader ; 
 import net . minecraftforge . fml . loading . LanguageLoadingProvider ; 
 
 + import java . nio . file . Path ; 
 import java . util . Collection ; 
 import java . util . List ; 
 import java . util . Map ; 
 + import java . util . Optional ; 
 import java . util . ServiceLoader ; 
 import java . util . stream . Collectors ; 
 
 @ @ - 62 , 6 + 64 , 7 @ @ public class ModDiscoverer { 
 mods . forEach ( ModFile : : identifyMods ) ; 
 fmlLog . debug ( SCAN , " Found { } mod files with { } mods " , mods : : size , ( ) - > mods . stream ( ) . mapToInt ( mf - > mf . getModInfos ( ) . size ( ) ) . sum ( ) ) ; 
 mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( FMLLoader . getCoreModProvider ( ) : : addCoreMod ) ; 
 + mods . forEach ( mod - > mod . getAccessTransformer ( ) . ifPresent ( path - > FMLLoader . addAccessTransformer ( path , mod ) ) ) ; 
 mods . forEach ( backgroundScanHandler : : submitForScanning ) ; 
 return backgroundScanHandler ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 index 8f57bae . . 67659a7 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 @ @ - 22 , 6 + 22 , 7 @ @ package net . minecraftforge . fml . loading . moddiscovery ; 
 import net . minecraftforge . fml . loading . IModLanguageProvider ; 
 
 import javax . swing . text . html . Option ; 
 + import java . nio . file . Files ; 
 import java . nio . file . Path ; 
 import java . util . List ; 
 import java . util . Map ; 
 @ @ - 47 , 6 + 48 , 7 @ @ public class ModFile 
 DEFAULTMANIFEST . getMainAttributes ( ) . putValue ( " FMLModType " , " MOD " ) ; 
 } 
 
 + 
 public void claimLanguage ( String modId , IModLanguageProvider . IModLanguageLoader loader ) 
 { 
 this . modInfoMap . get ( modId ) . setLoader ( loader ) ; 
 @ @ - 64 , 6 + 66 , 7 @ @ public class ModFile 
 private ScanResult fileScanResult ; 
 private CompletableFuture < ScanResult > futureScanResult ; 
 private List < CoreModFile > coreMods ; 
 + private Path accessTransformer ; 
 
 private static final Attributes . Name TYPE = new Attributes . Name ( " FMLModType " ) ; 
 
 @ @ - 89 , 12 + 92 , 16 @ @ public class ModFile 
 return modInfos ; 
 } 
 
 + public Optional < Path > getAccessTransformer ( ) { 
 + return Optional . ofNullable ( Files . exists ( accessTransformer ) ? accessTransformer : null ) ; 
 + } 
 public void identifyMods ( ) { 
 this . modInfos = ModFileParser . readModList ( this ) ; 
 this . modInfos . forEach ( mi - > fmlLog . debug ( LOADING , " Found mod { } for language { } " , mi . getModId ( ) , mi . getModLoader ( ) ) ) ; 
 this . modInfoMap = this . modInfos . stream ( ) . collect ( Collectors . toMap ( ModInfo : : getModId , Function . identity ( ) ) ) ; 
 this . coreMods = ModFileParser . getCoreMods ( this ) ; 
 this . coreMods . forEach ( mi - > fmlLog . debug ( LOADING , " Found coremod { } " , mi . getPath ( ) ) ) ; 
 + this . accessTransformer = locator . findPath ( this , " META - INF " , " accesstransformer . cfg " ) ; 
 } 
 
 
 @ @ - 112 , 7 + 119 , 6 @ @ public class ModFile 
 public void scanFile ( Consumer < Path > pathConsumer ) { 
 locator . scanFile ( this , pathConsumer ) ; 
 } 
 - 
 public void setFutureScanResult ( CompletableFuture < ScanResult > future ) 
 { 
 this . futureScanResult = future ; 
 diff - - git a / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService b / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService 
 index 6b6ff62 . . 4d7e898 100644 
 - - - a / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService 
 + + + b / src / main / resources / META - INF / services / cpw . mods . modlauncher . api . ILaunchHandlerService 
 @ @ - 1 + 1 , 2 @ @ 
 - net . minecraftforge . fml . loading . FMLLaunchProvider 
 \ No newline at end of file 
 + net . minecraftforge . fml . loading . FMLLaunchProvider 
 + net . minecraftforge . fml . loading . FMLDevLaunchProvider 
 \ No newline at end of file

NEAREST DIFF:
diff - - git a / src / main / java / net / minecraftforge / fml / LaunchTesting . java b / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 index c34b865 . . 020c5e7 100644 
 - - - a / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 + + + b / src / main / java / net / minecraftforge / fml / LaunchTesting . java 
 @ @ - 25 , 9 + 25 , 10 @ @ import org . apache . logging . log4j . core . config . Configurator ; 
 
 public class LaunchTesting 
 { 
 - public static void main ( String . . . args ) 
 + public static void main ( String . . . args ) throws InterruptedException 
 { 
 Configurator . setRootLevel ( Level . DEBUG ) ; 
 Launcher . main ( " - - launchTarget " , " fml " , " - - gameDir " , " projects / run " ) ; 
 + Thread . sleep ( 10000 ) ; 
 } 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java 
 new file mode 100644 
 index 0000000 . . fe23461 
 - - - / dev / null 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLJavaModLanguageProvider . java 
 @ @ - 0 , 0 + 1 , 86 @ @ 
 + / * 
 + * Minecraft Forge 
 + * Copyright ( c ) 2018 . 
 + * 
 + * This library is free software ; you can redistribute it and / or 
 + * modify it under the terms of the GNU Lesser General Public 
 + * License as published by the Free Software Foundation version 2 . 1 
 + * of the License . 
 + * 
 + * This library is distributed in the hope that it will be useful , 
 + * but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 + * Lesser General Public License for more details . 
 + * 
 + * You should have received a copy of the GNU Lesser General Public 
 + * License along with this library ; if not , write to the Free Software 
 + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA 
 + * / 
 + 
 + package net . minecraftforge . fml . loading ; 
 + 
 + import net . minecraftforge . fml . common . ModContainer ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ModInfo ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ScanResult ; 
 + import org . objectweb . asm . Type ; 
 + 
 + import java . util . List ; 
 + import java . util . Map ; 
 + import java . util . function . Consumer ; 
 + import java . util . function . Function ; 
 + import java . util . stream . Collectors ; 
 + 
 + import static net . minecraftforge . fml . Logging . SCAN ; 
 + import static net . minecraftforge . fml . Logging . fmlLog ; 
 + 
 + public class FMLJavaModLanguageProvider implements IModLanguageProvider 
 + { 
 + private static class FMLModTarget implements IModLanguageProvider . IModLanguageLoader { 
 + private final String className ; 
 + private final String modId ; 
 + 
 + private FMLModTarget ( String className , String modId ) 
 + { 
 + this . className = className ; 
 + this . modId = modId ; 
 + } 
 + 
 + public String getModId ( ) 
 + { 
 + return modId ; 
 + } 
 + 
 + @ Override 
 + public ModContainer loadMod ( ModFile file , ClassLoader modClassLoader ) 
 + { 
 + return null ; 
 + } 
 + } 
 + 
 + public static final Type MODANNOTATION = Type . getType ( " Lnet / minecraftforge / fml / common / Mod ; " ) ; 
 + 
 + @ Override 
 + public String name ( ) 
 + { 
 + return " javafml " ; 
 + } 
 + 
 + @ Override 
 + public Consumer < ScanResult > getFileVisitor ( ) { 
 + return scanResult - > { 
 + final Map < String , FMLModTarget > modTargetMap = scanResult . getAnnotations ( ) . stream ( ) 
 + . filter ( ad - > ad . getAnnotationType ( ) . equals ( MODANNOTATION ) ) 
 + . peek ( ad - > fmlLog . debug ( SCAN , " Found @ Mod class { } with id { } " , ad . getClassType ( ) . getClassName ( ) , ad . getAnnotationData ( ) . get ( " modid " ) ) ) 
 + . map ( ad - > new FMLModTarget ( ad . getClassType ( ) . getClassName ( ) , ( String ) ad . getAnnotationData ( ) . get ( " modid " ) ) ) 
 + . collect ( Collectors . toMap ( FMLModTarget : : getModId , Function . identity ( ) ) ) ; 
 + modTargetMap . forEach ( ( key , value ) - > scanResult . getFile ( ) . claimLanguage ( key , value ) ) ; 
 + } ; 
 + } 
 + 
 + @ Override 
 + public List < ModContainer > buildModContainers ( List < ModInfo > modFiles , ClassLoader modClassLoader ) 
 + { 
 + return null ; 
 + } 
 + } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 index 5aecb99 . . 0255021 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLLoader . java 
 @ @ - 28 , 25 + 28 , 20 @ @ import net . minecraftforge . fml . loading . moddiscovery . ModDiscoverer ; 
 import net . minecraftforge . forgespi . ICoreModProvider ; 
 
 import java . util . ArrayList ; 
 - import java . util . Arrays ; 
 - import java . util . HashSet ; 
 - import java . util . Iterator ; 
 - import java . util . List ; 
 import java . util . ServiceLoader ; 
 import java . util . Set ; 
 import java . util . stream . Collectors ; 
 
 import static net . minecraftforge . fml . Logging . CORE ; 
 - import static net . minecraftforge . fml . Logging . LOADING ; 
 import static net . minecraftforge . fml . Logging . SCAN ; 
 import static net . minecraftforge . fml . Logging . fmlLog ; 
 
 public class FMLLoader 
 { 
 - 
 private static ILaunchPluginService accessTransformer ; 
 private static ModDiscoverer modDiscoverer ; 
 - private static ICoreModProvider coreMod ; 
 + private static ICoreModProvider coreModProvider ; 
 + private static LanguageLoadingProvider languageLoadingProvider ; 
 
 static void onInitialLoad ( IEnvironment environment , Set < String > otherServices ) throws IncompatibleEnvironmentException 
 { 
 @ @ - 79 , 9 + 74 , 11 @ @ public class FMLLoader 
 throw new IncompatibleEnvironmentException ( " Multiple coremod libraries found " ) ; 
 } 
 
 - coreMod = coreModProviders . get ( 0 ) ; 
 - final Package coremodPackage = coreMod . getClass ( ) . getPackage ( ) ; 
 + coreModProvider = coreModProviders . get ( 0 ) ; 
 + final Package coremodPackage = coreModProvider . getClass ( ) . getPackage ( ) ; 
 fmlLog . debug ( CORE , " FML found CoreMod version : { } " , coremodPackage . getImplementationVersion ( ) ) ; 
 + 
 + languageLoadingProvider = new LanguageLoadingProvider ( ) ; 
 } 
 
 public static void load ( ) 
 @ @ - 90 , 4 + 87 , 13 @ @ public class FMLLoader 
 modDiscoverer = new ModDiscoverer ( ) ; 
 modDiscoverer . discoverMods ( ) ; 
 } 
 + 
 + public static ICoreModProvider getCoreModProvider ( ) { 
 + return coreModProvider ; 
 + } 
 + 
 + public static LanguageLoadingProvider getLanguageLoadingProvider ( ) 
 + { 
 + return languageLoadingProvider ; 
 + } 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 index 3ceec55 . . 0d1c070 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / FMLServiceProvider . java 
 @ @ - 25 , 14 + 25 , 17 @ @ import cpw . mods . modlauncher . api . ITransformer ; 
 import cpw . mods . modlauncher . api . IncompatibleEnvironmentException ; 
 import joptsimple . ArgumentAcceptingOptionSpec ; 
 import joptsimple . OptionSpecBuilder ; 
 + import net . minecraftforge . coremod . CoreModEngine ; 
 import net . minecraftforge . fml . FMLConfig ; 
 import net . minecraftforge . fml . common . FMLPaths ; 
 
 import javax . annotation . Nonnull ; 
 + import java . util . ArrayList ; 
 import java . util . Collections ; 
 import java . util . List ; 
 import java . util . Set ; 
 import java . util . function . BiFunction ; 
 + import java . util . stream . Collectors ; 
 
 import static net . minecraftforge . fml . Logging . CORE ; 
 import static net . minecraftforge . fml . Logging . fmlLog ; 
 @ @ - 86 , 7 + 89 , 8 @ @ public class FMLServiceProvider implements ITransformationService 
 @ Override 
 public List < ITransformer > transformers ( ) 
 { 
 - return Collections . emptyList ( ) ; 
 + fmlLog . debug ( CORE , " Loading coremod transformers " ) ; 
 + return new ArrayList < > ( FMLLoader . getCoreModProvider ( ) . getCoreModTransformers ( ) ) ; 
 } 
 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java b / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java 
 new file mode 100644 
 index 0000000 . . cceb903 
 - - - / dev / null 
 + + + b / src / main / java / net / minecraftforge / fml / loading / IModLanguageProvider . java 
 @ @ - 0 , 0 + 1 , 47 @ @ 
 + / * 
 + * Minecraft Forge 
 + * Copyright ( c ) 2018 . 
 + * 
 + * This library is free software ; you can redistribute it and / or 
 + * modify it under the terms of the GNU Lesser General Public 
 + * License as published by the Free Software Foundation version 2 . 1 
 + * of the License . 
 + * 
 + * This library is distributed in the hope that it will be useful , 
 + * but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 + * Lesser General Public License for more details . 
 + * 
 + * You should have received a copy of the GNU Lesser General Public 
 + * License along with this library ; if not , write to the Free Software 
 + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA 
 + * / 
 + 
 + package net . minecraftforge . fml . loading ; 
 + 
 + import net . minecraftforge . fml . common . ModContainer ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ModInfo ; 
 + import net . minecraftforge . fml . loading . moddiscovery . ScanResult ; 
 + 
 + import java . util . List ; 
 + import java . util . function . Consumer ; 
 + 
 + / * * 
 + * Loaded as a ServiceLoader , from the classpath . Extensions are loaded from 
 + * the mods directory , with the FMLType META - INF of LANGPROVIDER . 
 + * 
 + * Version data is read from the manifest ' s implementation version . 
 + * / 
 + public interface IModLanguageProvider 
 + { 
 + String name ( ) ; 
 + 
 + Consumer < ScanResult > getFileVisitor ( ) ; 
 + 
 + interface IModLanguageLoader { 
 + ModContainer loadMod ( ModFile file , ClassLoader modClassLoader ) ; 
 + } 
 + 
 + List < ModContainer > buildModContainers ( List < ModInfo > modFiles , ClassLoader modClassLoader ) ; 
 + } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java b / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java 
 new file mode 100644 
 index 0000000 . . 5b7c7f9 
 - - - / dev / null 
 + + + b / src / main / java / net / minecraftforge / fml / loading / LanguageLoadingProvider . java 
 @ @ - 0 , 0 + 1 , 64 @ @ 
 + / * 
 + * Minecraft Forge 
 + * Copyright ( c ) 2018 . 
 + * 
 + * This library is free software ; you can redistribute it and / or 
 + * modify it under the terms of the GNU Lesser General Public 
 + * License as published by the Free Software Foundation version 2 . 1 
 + * of the License . 
 + * 
 + * This library is distributed in the hope that it will be useful , 
 + * but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 + * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 + * Lesser General Public License for more details . 
 + * 
 + * You should have received a copy of the GNU Lesser General Public 
 + * License along with this library ; if not , write to the Free Software 
 + * Foundation , Inc . , 51 Franklin Street , Fifth Floor , Boston , MA 02110 - 1301 USA 
 + * / 
 + 
 + package net . minecraftforge . fml . loading ; 
 + 
 + import net . minecraftforge . fml . loading . moddiscovery . ModFile ; 
 + 
 + import java . nio . file . Path ; 
 + import java . util . ArrayList ; 
 + import java . util . HashMap ; 
 + import java . util . List ; 
 + import java . util . Map ; 
 + import java . util . ServiceLoader ; 
 + import java . util . stream . Stream ; 
 + 
 + import static net . minecraftforge . fml . Logging . CORE ; 
 + import static net . minecraftforge . fml . Logging . fmlLog ; 
 + 
 + public class LanguageLoadingProvider 
 + { 
 + private final List < IModLanguageProvider > languageProviders = new ArrayList < > ( ) ; 
 + private final ServiceLoader < IModLanguageProvider > serviceLoader ; 
 + private final Map < String , IModLanguageProvider > languageProviderMap = new HashMap < > ( ) ; 
 + 
 + LanguageLoadingProvider ( ) { 
 + serviceLoader = ServiceLoader . load ( IModLanguageProvider . class ) ; 
 + serviceLoader . forEach ( languageProviders : : add ) ; 
 + 
 + languageProviders . forEach ( lp - > { 
 + final Package pkg = lp . getClass ( ) . getPackage ( ) ; 
 + fmlLog . debug ( CORE , " Found system classpath language provider { } , version { } " , lp . name ( ) , pkg . getImplementationVersion ( ) ) ; 
 + } ) ; 
 + 
 + languageProviders . forEach ( lp - > languageProviderMap . put ( lp . name ( ) , lp ) ) ; 
 + } 
 + 
 + public void addAdditionalLanguages ( List < ModFile > modFiles ) 
 + { 
 + if ( modFiles = = null ) return ; 
 + Stream < Path > langPaths = modFiles . stream ( ) . map ( ModFile : : getFilePath ) ; 
 + serviceLoader . reload ( ) ; 
 + } 
 + 
 + public IModLanguageProvider getLanguage ( String name ) 
 + { 
 + return languageProviderMap . get ( name ) ; 
 + } 
 + } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java 
 index 93694a4 . . 42a754f 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / BackgroundScanHandler . java 
 @ @ - 19 , 11 + 19 , 14 @ @ 
 
 package net . minecraftforge . fml . loading . moddiscovery ; 
 
 + import com . google . common . util . concurrent . MoreExecutors ; 
 + 
 import java . util . ArrayList ; 
 import java . util . List ; 
 import java . util . concurrent . CompletableFuture ; 
 import java . util . concurrent . ExecutorService ; 
 import java . util . concurrent . Executors ; 
 + import java . util . concurrent . ThreadFactory ; 
 import java . util . concurrent . TimeUnit ; 
 
 import static net . minecraftforge . fml . Logging . SCAN ; 
 @ @ - 37 , 7 + 40 , 11 @ @ public class BackgroundScanHandler 
 private final List < ModFile > allFiles ; 
 
 public BackgroundScanHandler ( ) { 
 - modContentScanner = Executors . newCachedThreadPool ( ) ; 
 + modContentScanner = Executors . newSingleThreadExecutor ( r - > { 
 + final Thread thread = Executors . defaultThreadFactory ( ) . newThread ( r ) ; 
 + thread . setDaemon ( true ) ; 
 + return thread ; 
 + } ) ; 
 scannedFiles = new ArrayList < > ( ) ; 
 pendingFiles = new ArrayList < > ( ) ; 
 allFiles = new ArrayList < > ( ) ; 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 index 27dc4f0 . . de71a15 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModDiscoverer . java 
 @ @ - 20 , 6 + 20 , 8 @ @ 
 package net . minecraftforge . fml . loading . moddiscovery ; 
 
 import cpw . mods . modlauncher . ServiceLoaderStreamUtils ; 
 + import net . minecraftforge . fml . loading . FMLLoader ; 
 + import net . minecraftforge . fml . loading . LanguageLoadingProvider ; 
 
 import java . util . Collection ; 
 import java . util . List ; 
 @ @ - 54 , 12 + 56 , 12 @ @ public class ModDiscoverer { 
 . peek ( mf - > fmlLog . debug ( SCAN , " Found mod file { } of type { } with locator { } " , mf . getFileName ( ) , mf . getType ( ) , mf . getLocator ( ) ) ) 
 . collect ( Collectors . groupingBy ( ModFile : : getType ) ) ; 
 
 - / / ModLanguageProvider . loadAdditionalLanguages ( modFiles . get ( ModFile . Type . LANGPROVIDER ) ) ; 
 + FMLLoader . getLanguageLoadingProvider ( ) . addAdditionalLanguages ( modFiles . get ( ModFile . Type . LANGPROVIDER ) ) ; 
 BackgroundScanHandler backgroundScanHandler = new BackgroundScanHandler ( ) ; 
 final List < ModFile > mods = modFiles . get ( ModFile . Type . MOD ) ; 
 mods . forEach ( ModFile : : identifyMods ) ; 
 fmlLog . debug ( SCAN , " Found { } mod files with { } mods " , mods : : size , ( ) - > mods . stream ( ) . mapToInt ( mf - > mf . getModInfos ( ) . size ( ) ) . sum ( ) ) ; 
 - / / mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( ServiceProviders . getCoreModProvider ( ) : : addCoreMod ) ; 
 + mods . stream ( ) . map ( ModFile : : getCoreMods ) . flatMap ( List : : stream ) . forEach ( FMLLoader . getCoreModProvider ( ) : : addCoreMod ) ; 
 mods . forEach ( backgroundScanHandler : : submitForScanning ) ; 
 return backgroundScanHandler ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 index 8733035 . . 8f57bae 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModFile . java 
 @ @ - 19 , 14 + 19 , 21 @ @ 
 
 package net . minecraftforge . fml . loading . moddiscovery ; 
 
 + import net . minecraftforge . fml . loading . IModLanguageProvider ; 
 + 
 + import javax . swing . text . html . Option ; 
 import java . nio . file . Path ; 
 import java . util . List ; 
 + import java . util . Map ; 
 import java . util . Objects ; 
 + import java . util . Optional ; 
 import java . util . concurrent . CompletableFuture ; 
 import java . util . concurrent . ExecutionException ; 
 import java . util . function . Consumer ; 
 + import java . util . function . Function ; 
 import java . util . jar . Attributes ; 
 import java . util . jar . Manifest ; 
 + import java . util . stream . Collectors ; 
 
 import static net . minecraftforge . fml . Logging . LOADING ; 
 import static net . minecraftforge . fml . Logging . SCAN ; 
 @ @ - 40 , 6 + 47 , 11 @ @ public class ModFile 
 DEFAULTMANIFEST . getMainAttributes ( ) . putValue ( " FMLModType " , " MOD " ) ; 
 } 
 
 + public void claimLanguage ( String modId , IModLanguageProvider . IModLanguageLoader loader ) 
 + { 
 + this . modInfoMap . get ( modId ) . setLoader ( loader ) ; 
 + } 
 + 
 public enum Type { 
 MOD , LIBRARY , LANGPROVIDER 
 } 
 @ @ - 47 , 6 + 59 , 7 @ @ public class ModFile 
 private final Type modFileType ; 
 private final Manifest manifest ; 
 private List < ModInfo > modInfos ; 
 + private Map < String , ModInfo > modInfoMap ; 
 private final IModLocator locator ; 
 private ScanResult fileScanResult ; 
 private CompletableFuture < ScanResult > futureScanResult ; 
 @ @ - 60 , 7 + 73 , 8 @ @ public class ModFile 
 manifest = locator . findManifest ( file ) . orElse ( DEFAULTMANIFEST ) ; 
 if ( manifest ! = DEFAULTMANIFEST ) fmlLog . debug ( SCAN , " Mod file { } has a manifest " , file ) ; 
 else fmlLog . debug ( SCAN , " Mod file { } is missing a manifest " , file ) ; 
 - modFileType = Type . valueOf ( manifest . getMainAttributes ( ) . getValue ( TYPE ) ) ; 
 + final Optional < String > value = Optional . ofNullable ( manifest . getMainAttributes ( ) . getValue ( TYPE ) ) ; 
 + modFileType = Type . valueOf ( value . orElse ( " MOD " ) ) ; 
 } 
 
 public Type getType ( ) { 
 @ @ - 78 , 6 + 92 , 7 @ @ public class ModFile 
 public void identifyMods ( ) { 
 this . modInfos = ModFileParser . readModList ( this ) ; 
 this . modInfos . forEach ( mi - > fmlLog . debug ( LOADING , " Found mod { } for language { } " , mi . getModId ( ) , mi . getModLoader ( ) ) ) ; 
 + this . modInfoMap = this . modInfos . stream ( ) . collect ( Collectors . toMap ( ModInfo : : getModId , Function . identity ( ) ) ) ; 
 this . coreMods = ModFileParser . getCoreMods ( this ) ; 
 this . coreMods . forEach ( mi - > fmlLog . debug ( LOADING , " Found coremod { } " , mi . getPath ( ) ) ) ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java 
 index 2a3c1de . . 7910600 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ModInfo . java 
 @ @ - 20 , 6 + 20 , 10 @ @ 
 package net . minecraftforge . fml . loading . moddiscovery ; 
 
 import net . minecraftforge . fml . common . versioning . ArtifactVersion ; 
 + import net . minecraftforge . fml . loading . IModLanguageProvider ; 
 + 
 + import java . net . URL ; 
 + import java . util . List ; 
 
 public class ModInfo { 
 private final ModFile owningFile ; 
 @ @ - 27 , 11 + 31 , 12 @ @ public class ModInfo { 
 private final ArtifactVersion version ; 
 private final String displayName ; 
 private final String description ; 
 - private final java . net . URL updateJSONURL ; 
 + private final URL updateJSONURL ; 
 private final String modLoader ; 
 - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ModInfo . ModVersion > dependencies ; 
 + private final List < ModInfo . ModVersion > dependencies ; 
 + private IModLanguageProvider . IModLanguageLoader loader ; 
 
 - public ModInfo ( final ModFile owningFile , final String modLoader , final String modId , final String displayName , final ArtifactVersion version , final String description , final java . net . URL updateJSONURL , final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ModInfo . ModVersion > dependencies ) { 
 + public ModInfo ( final ModFile owningFile , final String modLoader , final String modId , final String displayName , final ArtifactVersion version , final String description , final URL updateJSONURL , final List < ModInfo . ModVersion > dependencies ) { 
 this . owningFile = owningFile ; 
 this . modLoader = modLoader ; 
 this . modId = modId ; 
 @ @ - 58 , 6 + 63 , 11 @ @ public class ModInfo { 
 return version ; 
 } 
 
 + public void setLoader ( IModLanguageProvider . IModLanguageLoader loader ) 
 + { 
 + this . loader = loader ; 
 + } 
 + 
 public enum Ordering { 
 BEFORE , AFTER , NONE ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java 
 index f35f626 . . cd75eaa 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / ScanResult . java 
 @ @ - 22 , 27 + 22 , 33 @ @ package net . minecraftforge . fml . loading . moddiscovery ; 
 
 import org . objectweb . asm . Type ; 
 
 + import java . util . ArrayList ; 
 + import java . util . List ; 
 import java . util . Map ; 
 import java . util . Set ; 
 
 public class ScanResult { 
 private final ModFile file ; 
 - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . AnnotationData > annotations = new java . util . ArrayList < > ( ) ; 
 - private final java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . ClassData > classes = new java . util . ArrayList < > ( ) ; 
 + private final List < ScanResult . AnnotationData > annotations = new ArrayList < > ( ) ; 
 + private final List < ScanResult . ClassData > classes = new ArrayList < > ( ) ; 
 
 public ScanResult ( final ModFile file ) { 
 this . file = file ; 
 } 
 
 + public ModFile getFile ( ) { 
 + return file ; 
 + } 
 + 
 public static boolean interestingAnnotations ( final ModAnnotation annotation ) { 
 return true ; 
 } 
 
 - public java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . ClassData > getClasses ( ) { 
 + public List < ScanResult . ClassData > getClasses ( ) { 
 return classes ; 
 } 
 
 - public java . util . List < net . minecraftforge . fml . loading . moddiscovery . ScanResult . AnnotationData > getAnnotations ( ) { 
 + public List < ScanResult . AnnotationData > getAnnotations ( ) { 
 return annotations ; 
 } 
 
 diff - - git a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java 
 index 0770426 . . 92fdab3 100644 
 - - - a / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java 
 + + + b / src / main / java / net / minecraftforge / fml / loading / moddiscovery / Scanner . java 
 @ @ - 19 , 8 + 19 , 19 @ @ 
 
 package net . minecraftforge . fml . loading . moddiscovery ; 
 
 + import net . minecraftforge . fml . loading . FMLLoader ; 
 + import net . minecraftforge . fml . loading . IModLanguageProvider ; 
 + import net . minecraftforge . fml . loading . LanguageLoadingProvider ; 
 import org . objectweb . asm . ClassReader ; 
 
 + import java . io . IOException ; 
 + import java . nio . file . Files ; 
 + import java . nio . file . Path ; 
 + import java . util . Set ; 
 + import java . util . function . Consumer ; 
 + import java . util . stream . Collectors ; 
 + 
 + import static net . minecraftforge . fml . Logging . LOADING ; 
 import static net . minecraftforge . fml . Logging . SCAN ; 
 import static net . minecraftforge . fml . Logging . fmlLog ; 
 
 @ @ - 34 , 17 + 45 , 20 @ @ public class Scanner { 
 public ScanResult scan ( ) { 
 ScanResult result = new ScanResult ( fileToScan ) ; 
 fileToScan . scanFile ( p - > fileVisitor ( p , result ) ) ; 
 + final Set < IModLanguageProvider > modLoaders = fileToScan . getModInfos ( ) . stream ( ) . map ( ModInfo : : getModLoader ) . map ( FMLLoader . getLanguageLoadingProvider ( ) : : getLanguage ) . collect ( Collectors . toSet ( ) ) ; 
 + modLoaders . stream ( ) . peek ( ml - > fmlLog . debug ( SCAN , " Scanning { } with language loader { } " , fileToScan . getFilePath ( ) , ml . name ( ) ) ) 
 + . map ( IModLanguageProvider : : getFileVisitor ) . forEach ( c - > c . accept ( result ) ) ; 
 return result ; 
 } 
 
 - private void fileVisitor ( final java . nio . file . Path path , final ScanResult result ) { 
 + private void fileVisitor ( final Path path , final ScanResult result ) { 
 try { 
 fmlLog . debug ( SCAN , " Scanning { } path { } " , fileToScan , path ) ; 
 ModClassVisitor mcv = new ModClassVisitor ( ) ; 
 - org . objectweb . asm . ClassReader cr = new ClassReader ( java . nio . file . Files . newInputStream ( path ) ) ; 
 + ClassReader cr = new ClassReader ( Files . newInputStream ( path ) ) ; 
 cr . accept ( mcv , 0 ) ; 
 mcv . buildData ( result . getClasses ( ) , result . getAnnotations ( ) ) ; 
 - } catch ( java . io . IOException e ) { 
 + } catch ( IOException e ) { 
 / / mark path bad 
 } 
 } 
 diff - - git a / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider b / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider 
 new file mode 100644 
 index 0000000 . . dc3f902 
 - - - / dev / null 
 + + + b / src / main / resources / META - INF / services / net . minecraftforge . fml . loading . IModLanguageProvider 
 @ @ - 0 , 0 + 1 @ @ 
 + net . minecraftforge . fml . loading . FMLJavaModLanguageProvider 
 \ No newline at end of file
