BLEU SCORE: 0.037550011571774476

TEST MSG: Fixed ( hopefully ) perspective transformations for custom models too .
GENERATED MSG: Implemented face culling for item models , improves performance slightly . Closes # 2326

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> index 7fc1226 . . dac0b71 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> + + + b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> @ @ - 382 , 20 + 382 , 34 @ @ public class ForgeHooksClient <nl> return m ; <nl> } <nl> <nl> + private static final Matrix4f flipX ; <nl> + static { <nl> + flipX = new Matrix4f ( ) ; <nl> + flipX . setIdentity ( ) ; <nl> + flipX . m00 = - 1 ; <nl> + } <nl> + <nl> @ SuppressWarnings ( " deprecation " ) <nl> public static IBakedModel handleCameraTransforms ( IBakedModel model , ItemCameraTransforms . TransformType cameraTransformType , boolean leftHandHackery ) <nl> { <nl> if ( model instanceof IPerspectiveAwareModel ) <nl> { <nl> - / / FIXME : left hand hackery <nl> Pair < ? extends IBakedModel , Matrix4f > pair = ( ( IPerspectiveAwareModel ) model ) . handlePerspective ( cameraTransformType ) ; <nl> <nl> + Matrix4f matrix = new Matrix4f ( pair . getRight ( ) ) ; <nl> + if ( leftHandHackery ) <nl> + { <nl> + matrix . mul ( flipX , matrix ) ; <nl> + matrix . mul ( matrix , flipX ) ; <nl> + } <nl> if ( pair . getRight ( ) ! = null ) multiplyCurrentGlMatrix ( pair . getRight ( ) ) ; <nl> return pair . getLeft ( ) ; <nl> } <nl> else <nl> { <nl> + / / if ( leftHandHackery ) GlStateManager . scale ( - 1 , 1 , 1 ) ; <nl> ItemCameraTransforms . func _ 188034 _ a ( model . getItemCameraTransforms ( ) . getTransform ( cameraTransformType ) , leftHandHackery ) ; <nl> + / / if ( leftHandHackery ) GlStateManager . scale ( - 1 , 1 , 1 ) ; <nl> } <nl> return model ; <nl> }
NEAREST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java b / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java <nl> index 71309f7 . . 16fd01d 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java <nl> @ @ - 72 , 7 + 72 , 7 @ @ public interface IPerspectiveAwareModel extends IFlexibleBakedModel <nl> { <nl> TRSRTransformation tr = transforms . get ( cameraTransformType ) ; <nl> Matrix4f mat = null ; <nl> - if ( tr ! = null & & tr ! = TRSRTransformation . identity ( ) ) mat = TRSRTransformation . blockCornerToCenter ( tr ) . getMatrix ( ) ; <nl> + if ( tr ! = null & & ! tr . equals ( TRSRTransformation . identity ( ) ) ) mat = TRSRTransformation . blockCornerToCenter ( tr ) . getMatrix ( ) ; <nl> return Pair . of ( model , mat ) ; <nl> } <nl> <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java b / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java <nl> index 87100ee . . 119092e 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java <nl> @ @ - 5 , 8 + 5 , 11 @ @ import java . util . BitSet ; <nl> import java . util . Collection ; <nl> import java . util . List ; <nl> <nl> + import javax . vecmath . Matrix4f ; <nl> import javax . vecmath . Vector4f ; <nl> <nl> + import org . apache . commons . lang3 . tuple . Pair ; <nl> + <nl> import net . minecraft . client . renderer . block . model . BakedQuad ; <nl> import net . minecraft . client . renderer . block . model . ItemCameraTransforms ; <nl> import net . minecraft . client . renderer . block . model . ItemCameraTransforms . TransformType ; <nl> @ @ - 93 , 14 + 96 , 10 @ @ public class ItemLayerModel implements IRetexturableModel <nl> } <nl> TextureAtlasSprite particle = bakedTextureGetter . apply ( textures . isEmpty ( ) ? new ResourceLocation ( " missingno " ) : textures . get ( 0 ) ) ; <nl> ImmutableMap < TransformType , TRSRTransformation > map = IPerspectiveAwareModel . MapWrapper . getTransforms ( state ) ; <nl> - IFlexibleBakedModel ret = new BakedModel ( builder . build ( ) , particle , format ) ; <nl> - if ( map . isEmpty ( ) ) <nl> - { <nl> - return ret ; <nl> - } <nl> - return new IPerspectiveAwareModel . MapWrapper ( ret , map ) ; <nl> + return new BakedItemModel ( builder . build ( ) , particle , format , map , null ) ; <nl> } <nl> <nl> + @ Deprecated / / remove 1 . 9 <nl> public static class BakedModel implements IFlexibleBakedModel <nl> { <nl> private final ImmutableList < BakedQuad > quads ; <nl> @ @ - 124 , 6 + 123 , 65 @ @ public class ItemLayerModel implements IRetexturableModel <nl> public VertexFormat getFormat ( ) { return format ; } <nl> } <nl> <nl> + private static class BakedItemModel implements IFlexibleBakedModel , IPerspectiveAwareModel <nl> + { <nl> + private final ImmutableList < BakedQuad > quads ; <nl> + private final TextureAtlasSprite particle ; <nl> + private final VertexFormat format ; <nl> + private final ImmutableMap < TransformType , TRSRTransformation > transforms ; <nl> + private final IFlexibleBakedModel otherModel ; <nl> + private final boolean isCulled ; <nl> + <nl> + public BakedItemModel ( ImmutableList < BakedQuad > quads , TextureAtlasSprite particle , VertexFormat format , ImmutableMap < TransformType , TRSRTransformation > transforms , IFlexibleBakedModel otherModel ) <nl> + { <nl> + this . quads = quads ; <nl> + this . particle = particle ; <nl> + this . format = format ; <nl> + this . transforms = transforms ; <nl> + if ( otherModel ! = null ) <nl> + { <nl> + this . otherModel = otherModel ; <nl> + this . isCulled = true ; <nl> + } <nl> + else <nl> + { <nl> + ImmutableList . Builder < BakedQuad > builder = ImmutableList . builder ( ) ; <nl> + for ( BakedQuad quad : quads ) <nl> + { <nl> + if ( quad . getFace ( ) = = EnumFacing . SOUTH ) <nl> + { <nl> + builder . add ( quad ) ; <nl> + } <nl> + } <nl> + this . otherModel = new BakedItemModel ( builder . build ( ) , particle , format , transforms , this ) ; <nl> + isCulled = false ; <nl> + } <nl> + } <nl> + <nl> + public boolean isAmbientOcclusion ( ) { return true ; } <nl> + public boolean isGui3d ( ) { return false ; } <nl> + public boolean isBuiltInRenderer ( ) { return false ; } <nl> + public TextureAtlasSprite getParticleTexture ( ) { return particle ; } <nl> + public ItemCameraTransforms getItemCameraTransforms ( ) { return ItemCameraTransforms . DEFAULT ; } <nl> + public List < BakedQuad > getFaceQuads ( EnumFacing side ) { return ImmutableList . of ( ) ; } <nl> + public List < BakedQuad > getGeneralQuads ( ) { return quads ; } <nl> + public VertexFormat getFormat ( ) { return format ; } <nl> + <nl> + public Pair < ? extends IFlexibleBakedModel , Matrix4f > handlePerspective ( TransformType type ) <nl> + { <nl> + Pair < ? extends IFlexibleBakedModel , Matrix4f > pair = IPerspectiveAwareModel . MapWrapper . handlePerspective ( this , transforms , type ) ; <nl> + if ( type = = TransformType . GUI & & ! isCulled & & pair . getRight ( ) = = null ) <nl> + { <nl> + return Pair . of ( otherModel , null ) ; <nl> + } <nl> + else if ( type ! = TransformType . GUI & & isCulled ) <nl> + { <nl> + return Pair . of ( otherModel , pair . getRight ( ) ) ; <nl> + } <nl> + return pair ; <nl> + } <nl> + } <nl> + <nl> public ImmutableList < BakedQuad > getQuadsForSprite ( int tint , TextureAtlasSprite sprite , VertexFormat format , Optional < TRSRTransformation > transform ) <nl> { <nl> ImmutableList . Builder < BakedQuad > builder = ImmutableList . builder ( ) ;

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 index 7fc1226 . . dac0b71 100644 
 - - - a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 + + + b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 @ @ - 382 , 20 + 382 , 34 @ @ public class ForgeHooksClient 
 return m ; 
 } 
 
 + private static final Matrix4f flipX ; 
 + static { 
 + flipX = new Matrix4f ( ) ; 
 + flipX . setIdentity ( ) ; 
 + flipX . m00 = - 1 ; 
 + } 
 + 
 @ SuppressWarnings ( " deprecation " ) 
 public static IBakedModel handleCameraTransforms ( IBakedModel model , ItemCameraTransforms . TransformType cameraTransformType , boolean leftHandHackery ) 
 { 
 if ( model instanceof IPerspectiveAwareModel ) 
 { 
 - / / FIXME : left hand hackery 
 Pair < ? extends IBakedModel , Matrix4f > pair = ( ( IPerspectiveAwareModel ) model ) . handlePerspective ( cameraTransformType ) ; 
 
 + Matrix4f matrix = new Matrix4f ( pair . getRight ( ) ) ; 
 + if ( leftHandHackery ) 
 + { 
 + matrix . mul ( flipX , matrix ) ; 
 + matrix . mul ( matrix , flipX ) ; 
 + } 
 if ( pair . getRight ( ) ! = null ) multiplyCurrentGlMatrix ( pair . getRight ( ) ) ; 
 return pair . getLeft ( ) ; 
 } 
 else 
 { 
 + / / if ( leftHandHackery ) GlStateManager . scale ( - 1 , 1 , 1 ) ; 
 ItemCameraTransforms . func _ 188034 _ a ( model . getItemCameraTransforms ( ) . getTransform ( cameraTransformType ) , leftHandHackery ) ; 
 + / / if ( leftHandHackery ) GlStateManager . scale ( - 1 , 1 , 1 ) ; 
 } 
 return model ; 
 }

NEAREST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java b / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java 
 index 71309f7 . . 16fd01d 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java 
 + + + b / src / main / java / net / minecraftforge / client / model / IPerspectiveAwareModel . java 
 @ @ - 72 , 7 + 72 , 7 @ @ public interface IPerspectiveAwareModel extends IFlexibleBakedModel 
 { 
 TRSRTransformation tr = transforms . get ( cameraTransformType ) ; 
 Matrix4f mat = null ; 
 - if ( tr ! = null & & tr ! = TRSRTransformation . identity ( ) ) mat = TRSRTransformation . blockCornerToCenter ( tr ) . getMatrix ( ) ; 
 + if ( tr ! = null & & ! tr . equals ( TRSRTransformation . identity ( ) ) ) mat = TRSRTransformation . blockCornerToCenter ( tr ) . getMatrix ( ) ; 
 return Pair . of ( model , mat ) ; 
 } 
 
 diff - - git a / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java b / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java 
 index 87100ee . . 119092e 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java 
 + + + b / src / main / java / net / minecraftforge / client / model / ItemLayerModel . java 
 @ @ - 5 , 8 + 5 , 11 @ @ import java . util . BitSet ; 
 import java . util . Collection ; 
 import java . util . List ; 
 
 + import javax . vecmath . Matrix4f ; 
 import javax . vecmath . Vector4f ; 
 
 + import org . apache . commons . lang3 . tuple . Pair ; 
 + 
 import net . minecraft . client . renderer . block . model . BakedQuad ; 
 import net . minecraft . client . renderer . block . model . ItemCameraTransforms ; 
 import net . minecraft . client . renderer . block . model . ItemCameraTransforms . TransformType ; 
 @ @ - 93 , 14 + 96 , 10 @ @ public class ItemLayerModel implements IRetexturableModel 
 } 
 TextureAtlasSprite particle = bakedTextureGetter . apply ( textures . isEmpty ( ) ? new ResourceLocation ( " missingno " ) : textures . get ( 0 ) ) ; 
 ImmutableMap < TransformType , TRSRTransformation > map = IPerspectiveAwareModel . MapWrapper . getTransforms ( state ) ; 
 - IFlexibleBakedModel ret = new BakedModel ( builder . build ( ) , particle , format ) ; 
 - if ( map . isEmpty ( ) ) 
 - { 
 - return ret ; 
 - } 
 - return new IPerspectiveAwareModel . MapWrapper ( ret , map ) ; 
 + return new BakedItemModel ( builder . build ( ) , particle , format , map , null ) ; 
 } 
 
 + @ Deprecated / / remove 1 . 9 
 public static class BakedModel implements IFlexibleBakedModel 
 { 
 private final ImmutableList < BakedQuad > quads ; 
 @ @ - 124 , 6 + 123 , 65 @ @ public class ItemLayerModel implements IRetexturableModel 
 public VertexFormat getFormat ( ) { return format ; } 
 } 
 
 + private static class BakedItemModel implements IFlexibleBakedModel , IPerspectiveAwareModel 
 + { 
 + private final ImmutableList < BakedQuad > quads ; 
 + private final TextureAtlasSprite particle ; 
 + private final VertexFormat format ; 
 + private final ImmutableMap < TransformType , TRSRTransformation > transforms ; 
 + private final IFlexibleBakedModel otherModel ; 
 + private final boolean isCulled ; 
 + 
 + public BakedItemModel ( ImmutableList < BakedQuad > quads , TextureAtlasSprite particle , VertexFormat format , ImmutableMap < TransformType , TRSRTransformation > transforms , IFlexibleBakedModel otherModel ) 
 + { 
 + this . quads = quads ; 
 + this . particle = particle ; 
 + this . format = format ; 
 + this . transforms = transforms ; 
 + if ( otherModel ! = null ) 
 + { 
 + this . otherModel = otherModel ; 
 + this . isCulled = true ; 
 + } 
 + else 
 + { 
 + ImmutableList . Builder < BakedQuad > builder = ImmutableList . builder ( ) ; 
 + for ( BakedQuad quad : quads ) 
 + { 
 + if ( quad . getFace ( ) = = EnumFacing . SOUTH ) 
 + { 
 + builder . add ( quad ) ; 
 + } 
 + } 
 + this . otherModel = new BakedItemModel ( builder . build ( ) , particle , format , transforms , this ) ; 
 + isCulled = false ; 
 + } 
 + } 
 + 
 + public boolean isAmbientOcclusion ( ) { return true ; } 
 + public boolean isGui3d ( ) { return false ; } 
 + public boolean isBuiltInRenderer ( ) { return false ; } 
 + public TextureAtlasSprite getParticleTexture ( ) { return particle ; } 
 + public ItemCameraTransforms getItemCameraTransforms ( ) { return ItemCameraTransforms . DEFAULT ; } 
 + public List < BakedQuad > getFaceQuads ( EnumFacing side ) { return ImmutableList . of ( ) ; } 
 + public List < BakedQuad > getGeneralQuads ( ) { return quads ; } 
 + public VertexFormat getFormat ( ) { return format ; } 
 + 
 + public Pair < ? extends IFlexibleBakedModel , Matrix4f > handlePerspective ( TransformType type ) 
 + { 
 + Pair < ? extends IFlexibleBakedModel , Matrix4f > pair = IPerspectiveAwareModel . MapWrapper . handlePerspective ( this , transforms , type ) ; 
 + if ( type = = TransformType . GUI & & ! isCulled & & pair . getRight ( ) = = null ) 
 + { 
 + return Pair . of ( otherModel , null ) ; 
 + } 
 + else if ( type ! = TransformType . GUI & & isCulled ) 
 + { 
 + return Pair . of ( otherModel , pair . getRight ( ) ) ; 
 + } 
 + return pair ; 
 + } 
 + } 
 + 
 public ImmutableList < BakedQuad > getQuadsForSprite ( int tint , TextureAtlasSprite sprite , VertexFormat format , Optional < TRSRTransformation > transform ) 
 { 
 ImmutableList . Builder < BakedQuad > builder = ImmutableList . builder ( ) ;
