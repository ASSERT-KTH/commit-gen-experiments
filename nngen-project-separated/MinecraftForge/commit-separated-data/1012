BLEU SCORE: 0.0114347838903095

TEST MSG: Fixup model loading errors not being printed by making ICustomModelLoader . loadModel propogate IOExceptions as needed .
GENERATED MSG: B3D Improvements

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java b / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java <nl> index 015372d . . 858c3a0 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java <nl> @ @ - 14 , 6 + 14 , 7 @ @ import javax . vecmath . Matrix4f ; <nl> import net . minecraft . client . renderer . block . model . ModelBlockDefinition ; <nl> import net . minecraft . client . resources . model . ModelRotation ; <nl> import net . minecraft . util . ResourceLocation ; <nl> + import net . minecraftforge . fml . common . FMLLog ; <nl> <nl> import org . apache . commons . io . Charsets ; <nl> import org . apache . commons . io . IOUtils ; <nl> @ @ - 186 , 7 + 187 , 18 @ @ public class BlockStateLoader <nl> IModelState partState = new TRSRTransformation ( matrix ) ; <nl> if ( part . isUVLock ( ) ) partState = new ModelLoader . UVLock ( partState ) ; <nl> <nl> - models . put ( entry . getKey ( ) , Pair . of ( runModelHooks ( loader . getModel ( part . getModelLocation ( ) ) , part . getTextures ( ) , part . getCustomData ( ) ) , partState ) ) ; <nl> + IModel model = null ; <nl> + try <nl> + { <nl> + model = loader . getModel ( part . getModelLocation ( ) ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + FMLLog . warning ( " Unable to load block sub - model : \ ' " + part . getModelLocation ( ) / * + " \ ' for variant : \ ' " + parent * / + " \ ' : " + e . toString ( ) ) ; <nl> + model = loader . getMissingModel ( ) ; / / Will make it look weird , but that is good . <nl> + } <nl> + <nl> + models . put ( entry . getKey ( ) , Pair . of ( runModelHooks ( model , part . getTextures ( ) , part . getCustomData ( ) ) , partState ) ) ; <nl> } <nl> <nl> return new MultiModel ( hasBase ? base : null , baseRot , models . build ( ) ) ; <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java b / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java <nl> index 6dd7466 . . beeaecb 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java <nl> @ @ - 1 , 5 + 1 , 7 @ @ <nl> package net . minecraftforge . client . model ; <nl> <nl> + import java . io . IOException ; <nl> + <nl> import net . minecraft . client . resources . IResourceManagerReloadListener ; <nl> import net . minecraft . util . ResourceLocation ; <nl> <nl> @ @ - 14 , 5 + 16 , 5 @ @ public interface ICustomModelLoader extends IResourceManagerReloadListener <nl> / * <nl> * loads ( or reloads ) specified model <nl> * / <nl> - public IModel loadModel ( ResourceLocation modelLocation ) ; <nl> + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / ModelLoader . java b / src / main / java / net / minecraftforge / client / model / ModelLoader . java <nl> index 47ab1a7 . . da4b7da 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / ModelLoader . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / ModelLoader . java <nl> @ @ - 58 , 6 + 58 , 7 @ @ import org . apache . logging . log4j . Level ; <nl> <nl> import com . google . common . base . Function ; <nl> import com . google . common . base . Functions ; <nl> + import com . google . common . base . Throwables ; <nl> import com . google . common . collect . ImmutableList ; <nl> import com . google . common . collect . ImmutableMap ; <nl> import com . google . common . collect . ImmutableSet ; <nl> @ @ - 71 , 6 + 72 , 7 @ @ public class ModelLoader extends ModelBakery <nl> private final Set < ResourceLocation > textures = new HashSet < ResourceLocation > ( ) ; <nl> private final Set < ResourceLocation > loadingModels = new HashSet < ResourceLocation > ( ) ; <nl> private final Set < ModelResourceLocation > missingVariants = Sets . newHashSet ( ) ; <nl> + private IModel missingModel = null ; <nl> <nl> private boolean isLoading = false ; <nl> public boolean isLoading ( ) <nl> @ @ - 91 , 8 + 93 , 16 @ @ public class ModelLoader extends ModelBakery <nl> isLoading = true ; <nl> loadBlocks ( ) ; <nl> loadItems ( ) ; <nl> - IModel missing = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; <nl> - stateModels . put ( MODEL _ MISSING , missing ) ; <nl> + try <nl> + { <nl> + missingModel = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + / / If this ever happens things are bad . Should never NOT be able to load the missing model . <nl> + Throwables . propagate ( e ) ; <nl> + } <nl> + stateModels . put ( MODEL _ MISSING , missingModel ) ; <nl> textures . remove ( TextureMap . LOCATION _ MISSING _ TEXTURE ) ; <nl> textures . addAll ( LOCATIONS _ BUILTIN _ TEXTURES ) ; <nl> textureMap . loadSprites ( resourceManager , new IIconCreator ( ) <nl> @ @ - 107 , 8 + 117 , 8 @ @ public class ModelLoader extends ModelBakery <nl> } ) ; <nl> sprites . put ( new ResourceLocation ( " missingno " ) , textureMap . getMissingSprite ( ) ) ; <nl> Function < ResourceLocation , TextureAtlasSprite > textureGetter = Functions . forMap ( sprites , textureMap . getMissingSprite ( ) ) ; <nl> - IFlexibleBakedModel missingBaked = missing . bake ( missing . getDefaultState ( ) , Attributes . DEFAULT _ BAKED _ FORMAT , textureGetter ) ; <nl> - for ( Entry < ModelResourceLocation , IModel > e : stateModels . entrySet ( ) ) <nl> + IFlexibleBakedModel missingBaked = missingModel . bake ( missingModel . getDefaultState ( ) , Attributes . DEFAULT _ BAKED _ FORMAT , textureGetter ) ; <nl> + for ( Entry < ModelResourceLocation , IModel > e : stateModels . entrySet ( ) ) <nl> { <nl> if ( e . getValue ( ) = = getMissingModel ( ) ) <nl> { <nl> @ @ - 143 , 11 + 153 , 11 @ @ public class ModelLoader extends ModelBakery <nl> { <nl> missingVariants . add ( location ) ; <nl> } <nl> - if ( variants ! = null & & ! variants . getVariants ( ) . isEmpty ( ) ) <nl> + if ( variants ! = null & & ! variants . getVariants ( ) . isEmpty ( ) ) <nl> { <nl> try <nl> { <nl> - stateModels . put ( location , new WeightedRandomModel ( variants ) ) ; <nl> + stateModels . put ( location , new WeightedRandomModel ( location , variants ) ) ; <nl> } <nl> catch ( Throwable e ) <nl> { <nl> @ @ - 165 , 18 + 175 , 29 @ @ public class ModelLoader extends ModelBakery <nl> { <nl> ResourceLocation file = getItemLocation ( s ) ; <nl> ModelResourceLocation memory = new ModelResourceLocation ( s , " inventory " ) ; <nl> - IModel model = getModel ( file ) ; <nl> - if ( model = = null | | model = = getMissingModel ( ) ) <nl> + IModel model = null ; <nl> + try <nl> { <nl> - FMLLog . fine ( " Item json isn ' t found for ' " + memory + " ' , trying to load the variant from the blockstate json " ) ; <nl> - registerVariant ( getModelBlockDefinition ( memory ) , memory ) ; <nl> + model = getModel ( file ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + / / Handled by our finally block . <nl> + } <nl> + finally <nl> + { <nl> + if ( model = = null | | model = = getMissingModel ( ) ) <nl> + { <nl> + FMLLog . fine ( " Item json isn ' t found for ' " + memory + " ' , trying to load the variant from the blockstate json " ) ; <nl> + registerVariant ( getModelBlockDefinition ( memory ) , memory ) ; <nl> + } <nl> + else stateModels . put ( memory , model ) ; <nl> } <nl> - else stateModels . put ( memory , model ) ; <nl> } <nl> } <nl> } <nl> <nl> - public IModel getModel ( ResourceLocation location ) <nl> + public IModel getModel ( ResourceLocation location ) throws IOException <nl> { <nl> if ( ! ModelLoaderRegistry . loaded ( location ) ) loadAnyModel ( location ) ; <nl> return ModelLoaderRegistry . getModel ( location ) ; <nl> @ @ - 188 , 7 + 209 , 7 @ @ public class ModelLoader extends ModelBakery <nl> return new ResourceLocation ( model . getResourceDomain ( ) , model . getResourcePath ( ) + " . json " ) ; <nl> } <nl> <nl> - private void loadAnyModel ( ResourceLocation location ) <nl> + private void loadAnyModel ( ResourceLocation location ) throws IOException <nl> { <nl> if ( loadingModels . contains ( location ) ) <nl> { <nl> @ @ - 226 , 14 + 247 , 30 @ @ public class ModelLoader extends ModelBakery <nl> / / setting parent here to make textures resolve properly <nl> if ( model . getParentLocation ( ) ! = null ) <nl> { <nl> - IModel parent = getModel ( model . getParentLocation ( ) ) ; <nl> - if ( parent instanceof VanillaModelWrapper ) <nl> + try <nl> { <nl> - model . parent = ( ( VanillaModelWrapper ) parent ) . model ; <nl> + IModel parent = getModel ( model . getParentLocation ( ) ) ; <nl> + if ( parent instanceof VanillaModelWrapper ) <nl> + { <nl> + model . parent = ( ( VanillaModelWrapper ) parent ) . model ; <nl> + } <nl> + else <nl> + { <nl> + throw new IllegalStateException ( " vanilla model ' " + model + " ' can ' t have non - vanilla parent " ) ; <nl> + } <nl> } <nl> - else <nl> + catch ( IOException e ) <nl> { <nl> - throw new IllegalStateException ( " vanilla model " + model + " can ' t have non - vanilla parent " ) ; <nl> + FMLLog . warning ( " Could not load vanilla model parent ' " + model . getParentLocation ( ) + " ' for ' " + model + " ' : " + e . toString ( ) ) ; <nl> + IModel missing = ModelLoader . this . getMissingModel ( ) ; <nl> + if ( missing instanceof VanillaModelWrapper ) <nl> + { <nl> + model . parent = ( ( VanillaModelWrapper ) missing ) . model ; <nl> + } <nl> + else <nl> + { <nl> + throw new IllegalStateException ( " vanilla model ' " + model + " ' has missing parent , and missing model is not a vanilla model " ) ; <nl> + } <nl> } <nl> } <nl> <nl> @ @ - 403 , 16 + 440 , 32 @ @ public class ModelLoader extends ModelBakery <nl> private final List < IModel > models = new ArrayList < IModel > ( ) ; <nl> private final IModelState defaultState ; <nl> <nl> - public WeightedRandomModel ( Variants variants ) <nl> + @ Deprecated public WeightedRandomModel ( Variants variants ) { this ( null , variants ) ; } / / Remove 1 . 9 <nl> + public WeightedRandomModel ( ModelResourceLocation parent , Variants variants ) <nl> { <nl> this . variants = variants . getVariants ( ) ; <nl> ImmutableMap . Builder < IModelPart , TRSRTransformation > builder = ImmutableMap . builder ( ) ; <nl> - for ( Variant v : ( List < Variant > ) variants . getVariants ( ) ) <nl> + for ( Variant v : ( List < Variant > ) variants . getVariants ( ) ) <nl> { <nl> ResourceLocation loc = v . getModelLocation ( ) ; <nl> locations . add ( loc ) ; <nl> <nl> - IModel model = getModel ( loc ) ; <nl> + IModel model = null ; <nl> + try <nl> + { <nl> + model = getModel ( loc ) ; <nl> + } <nl> + catch ( Exception e ) <nl> + { <nl> + / * <nl> + * Vanilla eats this , which makes it only show variants that have models . <nl> + * But that doesn ' t help debugging , so we maintain the missing model <nl> + * so that resource pack makers have a hint that their states are broken . <nl> + * / <nl> + FMLLog . warning ( " Unable to load block model : \ ' " + loc + " \ ' for variant : \ ' " + parent + " \ ' : " + e . toString ( ) ) ; <nl> + model = getMissingModel ( ) ; <nl> + } <nl> + <nl> if ( v instanceof ISmartVariant ) <nl> { <nl> model = ( ( ISmartVariant ) v ) . process ( model , ModelLoader . this ) ; <nl> @ @ - 423 , 7 + 476 , 16 @ @ public class ModelLoader extends ModelBakery <nl> models . add ( model ) ; <nl> builder . put ( model , new TRSRTransformation ( v . getRotation ( ) ) ) ; <nl> } <nl> + <nl> + if ( models . size ( ) = = 0 ) / / If all variants are missing , add one with the missing model and default rotation . <nl> + { <nl> + IModel missing = getMissingModel ( ) ; <nl> + models . add ( missing ) ; <nl> + builder . put ( missing , new TRSRTransformation ( ModelRotation . X0 _ Y0 ) ) ; <nl> + } <nl> + <nl> defaultState = new MapModelState ( builder . build ( ) ) ; <nl> + <nl> } <nl> <nl> public Collection < ResourceLocation > getDependencies ( ) <nl> @ @ - 495 , 7 + 557 , 19 @ @ public class ModelLoader extends ModelBakery <nl> <nl> public IModel getMissingModel ( ) <nl> { <nl> - return getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; <nl> + if ( missingModel = = null ) <nl> + { <nl> + try <nl> + { <nl> + missingModel = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + / / If this ever happens things are bad . Should never NOT be able to load the missing model . <nl> + Throwables . propagate ( e ) ; <nl> + } <nl> + } <nl> + return missingModel ; <nl> } <nl> <nl> static enum VanillaLoader implements ICustomModelLoader <nl> @ @ - 524 , 21 + 598 , 9 @ @ public class ModelLoader extends ModelBakery <nl> return true ; <nl> } <nl> <nl> - public IModel loadModel ( ResourceLocation modelLocation ) <nl> + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException <nl> { <nl> - try <nl> - { <nl> - return loader . new VanillaModelWrapper ( modelLocation , loader . loadModel ( modelLocation ) ) ; <nl> - } <nl> - catch ( IOException e ) <nl> - { <nl> - if ( loader . isLoading ) / / ToDo : Make this less gaging , hides missing models . . <nl> - { <nl> - / / holding error until onPostBakeEvent <nl> - } <nl> - else FMLLog . log ( Level . ERROR , e , " Exception loading model % s with vanilla loader , skipping " , modelLocation ) ; <nl> - return loader . getMissingModel ( ) ; <nl> - } <nl> + return loader . new VanillaModelWrapper ( modelLocation , loader . loadModel ( modelLocation ) ) ; <nl> } <nl> } <nl> <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java b / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java <nl> index db24104 . . 3ee3948 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java <nl> @ @ - 1 , 5 + 1 , 7 @ @ <nl> package net . minecraftforge . client . model ; <nl> <nl> + import java . io . FileNotFoundException ; <nl> + import java . io . IOException ; <nl> import java . util . HashMap ; <nl> import java . util . HashSet ; <nl> import java . util . Map ; <nl> @ @ - 15 , 6 + 17 , 8 @ @ import net . minecraftforge . fml . common . FMLLog ; <nl> <nl> import org . apache . logging . log4j . Level ; <nl> <nl> + import com . google . common . base . Throwables ; <nl> + <nl> / * <nl> * Central hub for custom model loaders . <nl> * / <nl> @ @ - 50 , 7 + 54 , 7 @ @ public class ModelLoaderRegistry <nl> return new ResourceLocation ( location . getResourceDomain ( ) , " models / " + location . getResourcePath ( ) ) ; <nl> } <nl> <nl> - public static IModel getModel ( ResourceLocation location ) <nl> + public static IModel getModel ( ResourceLocation location ) throws IOException <nl> { <nl> ResourceLocation actual = getActualLocation ( location ) ; <nl> if ( cache . containsKey ( location ) ) return cache . get ( location ) ; <nl> @ @ - 87 , 14 + 91 , 21 @ @ public class ModelLoaderRegistry <nl> FMLLog . severe ( " no suitable loader found for the model % s , skipping " , location ) ; <nl> model = getMissingModel ( ) ; <nl> } <nl> - else try <nl> - { <nl> - model = accepted . loadModel ( actual ) ; <nl> - } <nl> - catch ( Exception e ) <nl> + else <nl> { <nl> - FMLLog . log ( Level . ERROR , e , " Exception loading model % s with loader % s , skipping " , location , accepted ) ; <nl> - model = getMissingModel ( ) ; <nl> + try <nl> + { <nl> + model = accepted . loadModel ( actual ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + throw e ; <nl> + } <nl> + catch ( Exception e ) <nl> + { <nl> + FMLLog . log ( Level . ERROR , e , " Exception loading model % s with loader % s , skipping " , location , accepted ) ; <nl> + model = getMissingModel ( ) ; <nl> + } <nl> } <nl> cache . put ( location , model ) ; <nl> return model ; <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> index 46f1c46 . . e8d4f11 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> @ @ - 104 , 7 + 104 , 7 @ @ public class B3DLoader implements ICustomModelLoader <nl> } <nl> <nl> @ SuppressWarnings ( " unchecked " ) <nl> - public IModel loadModel ( ResourceLocation modelLocation ) <nl> + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException <nl> { <nl> ResourceLocation file = new ResourceLocation ( modelLocation . getResourceDomain ( ) , modelLocation . getResourcePath ( ) ) ; <nl> if ( ! cache . containsKey ( file ) ) <nl> @ @ - 130 , 8 + 130 , 9 @ @ public class B3DLoader implements ICustomModelLoader <nl> } <nl> catch ( IOException e ) <nl> { <nl> - FMLLog . log ( Level . ERROR , e , " Exception loading model % s with B3D loader , skipping " , modelLocation ) ; <nl> + / / FMLLog . log ( Level . ERROR , e , " Exception loading model % s with B3D loader , skipping " , modelLocation ) ; <nl> cache . put ( modelLocation , null ) ; <nl> + throw e ; <nl> } <nl> } <nl> B3DModel model = cache . get ( file ) ;
NEAREST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> index ca6ab30 . . 46f1c46 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java <nl> @ @ - 30 , 8 + 30 , 10 @ @ import net . minecraftforge . client . model . IColoredBakedQuad . ColoredBakedQuad ; <nl> import net . minecraftforge . client . model . ICustomModelLoader ; <nl> import net . minecraftforge . client . model . IFlexibleBakedModel ; <nl> import net . minecraftforge . client . model . IModel ; <nl> + import net . minecraftforge . client . model . IModelCustomData ; <nl> import net . minecraftforge . client . model . IModelPart ; <nl> import net . minecraftforge . client . model . IModelState ; <nl> + import net . minecraftforge . client . model . IRetexturableModel ; <nl> import net . minecraftforge . client . model . ISmartBlockModel ; <nl> import net . minecraftforge . client . model . ISmartItemModel ; <nl> import net . minecraftforge . client . model . ModelLoader ; <nl> @ @ - 56 , 11 + 58 , 14 @ @ import org . apache . logging . log4j . Level ; <nl> import org . lwjgl . BufferUtils ; <nl> <nl> import com . google . common . base . Function ; <nl> + import com . google . common . base . Predicate ; <nl> import com . google . common . cache . CacheBuilder ; <nl> import com . google . common . cache . CacheLoader ; <nl> import com . google . common . cache . LoadingCache ; <nl> + import com . google . common . collect . Collections2 ; <nl> import com . google . common . collect . ImmutableList ; <nl> import com . google . common . collect . ImmutableMap ; <nl> + import com . google . common . collect . Maps ; <nl> import com . google . common . collect . Multimap ; <nl> <nl> / * <nl> @ @ - 238 , 24 + 243 , 28 @ @ public class B3DLoader implements ICustomModelLoader <nl> public static TRSRTransformation getNodeMatrix ( Animation animation , Node < ? > node , int frame ) <nl> { <nl> TRSRTransformation ret = TRSRTransformation . identity ( ) ; <nl> - if ( node . getParent ( ) ! = null ) <nl> - { <nl> - TRSRTransformation pm = cache . getUnchecked ( Triple . < Animation , Node < ? > , Integer > of ( animation , node . getParent ( ) , frame ) ) ; <nl> - ret = ret . compose ( pm ) ; <nl> - } <nl> Key key = null ; <nl> if ( animation ! = null ) key = animation . getKeys ( ) . get ( frame , node ) ; <nl> else if ( key = = null & & node . getAnimation ( ) ! = null & & node . getAnimation ( ) ! = animation ) key = node . getAnimation ( ) . getKeys ( ) . get ( frame , node ) ; <nl> - if ( key = = null ) <nl> - { <nl> - FMLLog . severe ( " invalid key index : " + frame ) ; <nl> - } <nl> - else <nl> + if ( key ! = null ) <nl> { <nl> + Node < ? > parent = node . getParent ( ) ; <nl> + if ( parent ! = null ) <nl> + { <nl> + TRSRTransformation pm = cache . getUnchecked ( Triple . < Animation , Node < ? > , Integer > of ( animation , node . getParent ( ) , frame ) ) ; <nl> + ret = ret . compose ( pm ) ; <nl> + ret = ret . compose ( new TRSRTransformation ( parent . getPos ( ) , parent . getRot ( ) , parent . getScale ( ) , null ) ) ; <nl> + } <nl> ret = ret . compose ( new TRSRTransformation ( key . getPos ( ) , key . getRot ( ) , key . getScale ( ) , null ) ) ; <nl> Matrix4f rm = new TRSRTransformation ( node . getPos ( ) , node . getRot ( ) , node . getScale ( ) , null ) . getMatrix ( ) ; <nl> rm . invert ( ) ; <nl> ret = ret . compose ( new TRSRTransformation ( rm ) ) ; <nl> + if ( parent ! = null ) <nl> + { <nl> + rm = new TRSRTransformation ( parent . getPos ( ) , parent . getRot ( ) , parent . getScale ( ) , null ) . getMatrix ( ) ; <nl> + rm . invert ( ) ; <nl> + ret = ret . compose ( new TRSRTransformation ( rm ) ) ; <nl> + } <nl> } <nl> return ret ; <nl> } <nl> @ @ - 305 , 14 + 314 , 14 @ @ public class B3DLoader implements ICustomModelLoader <nl> } <nl> } <nl> <nl> - public static class Wrapper extends PartWrapper < Mesh > implements IModel <nl> + public static class Wrapper extends PartWrapper < Mesh > implements IRetexturableModel , IModelCustomData <nl> { <nl> private final ResourceLocation location ; <nl> private final ImmutableMap < String , ResourceLocation > textures ; <nl> <nl> public Wrapper ( ResourceLocation location , List < Texture > textures , B3DModel . Node < Mesh > mesh ) <nl> { <nl> - this ( location , buildTextures ( location , textures ) , mesh ) ; <nl> + this ( location , buildTextures ( textures ) , mesh ) ; <nl> } <nl> <nl> public Wrapper ( ResourceLocation location , ImmutableMap < String , ResourceLocation > textures , B3DModel . Node < Mesh > mesh ) <nl> @ @ - 322 , 19 + 331 , 24 @ @ public class B3DLoader implements ICustomModelLoader <nl> this . textures = textures ; <nl> } <nl> <nl> - private static ImmutableMap < String , ResourceLocation > buildTextures ( ResourceLocation location , List < Texture > textures ) <nl> + private static ImmutableMap < String , ResourceLocation > buildTextures ( List < Texture > textures ) <nl> { <nl> ImmutableMap . Builder < String , ResourceLocation > builder = ImmutableMap . builder ( ) ; <nl> <nl> for ( Texture t : textures ) <nl> { <nl> String path = t . getPath ( ) ; <nl> - if ( path . endsWith ( " . png " ) ) path = path . substring ( 0 , path . length ( ) - " . png " . length ( ) ) ; <nl> - builder . put ( t . getPath ( ) , new ResourceLocation ( location . getResourceDomain ( ) , path ) ) ; <nl> + builder . put ( path , new ResourceLocation ( getLocation ( path ) ) ) ; <nl> } <nl> return builder . build ( ) ; <nl> } <nl> <nl> + private static String getLocation ( String path ) <nl> + { <nl> + if ( path . endsWith ( " . png " ) ) path = path . substring ( 0 , path . length ( ) - " . png " . length ( ) ) ; <nl> + return path ; <nl> + } <nl> + <nl> public Collection < ResourceLocation > getDependencies ( ) <nl> { <nl> / / no dependencies for in - file models <nl> @ @ - 344 , 17 + 358 , 32 @ @ public class B3DLoader implements ICustomModelLoader <nl> <nl> public Collection < ResourceLocation > getTextures ( ) <nl> { <nl> - return textures . values ( ) ; <nl> + return Collections2 . filter ( textures . values ( ) , new Predicate < ResourceLocation > ( ) <nl> + { <nl> + public boolean apply ( ResourceLocation loc ) <nl> + { <nl> + return ! loc . getResourcePath ( ) . startsWith ( " # " ) ; <nl> + } <nl> + } ) ; <nl> } <nl> <nl> public IFlexibleBakedModel bake ( IModelState state , VertexFormat format , Function < ResourceLocation , TextureAtlasSprite > bakedTextureGetter ) <nl> { <nl> ImmutableMap . Builder < String , TextureAtlasSprite > builder = ImmutableMap . builder ( ) ; <nl> - for ( String path : textures . keySet ( ) ) <nl> + TextureAtlasSprite missing = bakedTextureGetter . apply ( new ResourceLocation ( " missingno " ) ) ; <nl> + for ( Map . Entry < String , ResourceLocation > e : textures . entrySet ( ) ) <nl> { <nl> - builder . put ( path , bakedTextureGetter . apply ( textures . get ( path ) ) ) ; <nl> + if ( e . getValue ( ) . getResourcePath ( ) . startsWith ( " # " ) ) <nl> + { <nl> + FMLLog . severe ( " unresolved texture ' % s ' for b3d model ' % s ' " , e . getValue ( ) . getResourcePath ( ) , location ) ; <nl> + builder . put ( e . getKey ( ) , missing ) ; <nl> + } <nl> + else <nl> + { <nl> + builder . put ( e . getKey ( ) , bakedTextureGetter . apply ( e . getValue ( ) ) ) ; <nl> + } <nl> } <nl> - builder . put ( " missingno " , bakedTextureGetter . apply ( new ResourceLocation ( " missingno " ) ) ) ; <nl> + builder . put ( " missingno " , missing ) ; <nl> return new BakedWrapper ( this , state , format , builder . build ( ) ) ; <nl> } <nl> <nl> @ @ - 396 , 6 + 425 , 35 @ @ public class B3DLoader implements ICustomModelLoader <nl> else if ( ! location . equals ( other . location ) ) return false ; <nl> return true ; <nl> } <nl> + <nl> + @ Override <nl> + public IModel retexture ( ImmutableMap < String , String > textures ) <nl> + { <nl> + ImmutableMap . Builder < String , ResourceLocation > builder = ImmutableMap . builder ( ) ; <nl> + for ( Map . Entry < String , ResourceLocation > e : this . textures . entrySet ( ) ) <nl> + { <nl> + String path = e . getKey ( ) ; <nl> + String loc = getLocation ( path ) ; <nl> + if ( textures . containsKey ( loc ) ) <nl> + { <nl> + String newLoc = textures . get ( loc ) ; <nl> + if ( newLoc = = null ) newLoc = getLocation ( path ) ; <nl> + builder . put ( e . getKey ( ) , new ResourceLocation ( newLoc ) ) ; <nl> + } <nl> + else <nl> + { <nl> + builder . put ( e ) ; <nl> + } <nl> + } <nl> + return new Wrapper ( location , builder . build ( ) , getNode ( ) ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public IModel process ( ImmutableMap < String , String > customData ) <nl> + { <nl> + / / TODO keyframe <nl> + return null ; <nl> + } <nl> } <nl> <nl> private static class BakedWrapper implements IFlexibleBakedModel , ISmartBlockModel , ISmartItemModel <nl> @ @ - 454 , 9 + 512 , 10 @ @ public class B3DLoader implements ICustomModelLoader <nl> for ( Face f : faces ) <nl> { <nl> buf . clear ( ) ; <nl> - List < Texture > textures = f . getBrush ( ) . getTextures ( ) ; <nl> + List < Texture > textures = null ; <nl> + if ( f . getBrush ( ) ! = null ) textures = f . getBrush ( ) . getTextures ( ) ; <nl> TextureAtlasSprite sprite ; <nl> - if ( textures . isEmpty ( ) ) sprite = this . textures . get ( " missingno " ) ; <nl> + if ( textures = = null | | textures . isEmpty ( ) ) sprite = this . textures . get ( " missingno " ) ; <nl> else if ( textures . get ( 0 ) = = B3DModel . Texture . White ) sprite = ModelLoader . White . instance ; <nl> else sprite = this . textures . get ( textures . get ( 0 ) . getPath ( ) ) ; <nl> putVertexData ( f . getV1 ( ) , sprite ) ; <nl> diff - - git a / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java b / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java <nl> index 3fe304b . . 2358b93 100644 <nl> - - - a / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java <nl> + + + b / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java <nl> @ @ - 64 , 14 + 64 , 9 @ @ public class ModelLoaderRegistryDebug <nl> <nl> private void clientPreInit ( ) <nl> { <nl> - / / ModelLoaderRegistry . registerLoader ( DummyModelLoader . instance ) ; <nl> B3DLoader . instance . addDomain ( MODID . toLowerCase ( ) ) ; <nl> - / / ModelBakery . addVariantName ( Item . getItemFromBlock ( CustomModelBlock . instance ) , " forgedebug : dummymodel " ) ; <nl> - String modelLocation = MODID . toLowerCase ( ) + " : untitled2 . b3d " ; <nl> - ModelBakery . addVariantName ( Item . getItemFromBlock ( CustomModelBlock . instance ) , modelLocation ) ; <nl> Item item = Item . getItemFromBlock ( CustomModelBlock . instance ) ; <nl> - ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( modelLocation , " inventory " ) ) ; <nl> - / / ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( " forgedebug : dummymodel " , " inventory " ) ) ; <nl> + ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( MODID . toLowerCase ( ) + " : " + CustomModelBlock . name , " inventory " ) ) ; <nl> } <nl> <nl> public static class CustomModelBlock extends Block <nl> @ @ - 100 , 9 + 95 , 7 @ @ public class ModelLoaderRegistryDebug <nl> @ Override <nl> public IBlockState getExtendedState ( IBlockState state , IBlockAccess world , BlockPos pos ) <nl> { <nl> - IModel model = ModelLoaderRegistry . getModel ( new ResourceLocation ( MODID . toLowerCase ( ) , " block / untitled2 . b3d " ) ) ; <nl> - B3DLoader . B3DState defaultState = ( ( B3DLoader . Wrapper ) model ) . getDefaultState ( ) ; <nl> - B3DLoader . B3DState newState = new B3DLoader . B3DState ( defaultState . getAnimation ( ) , counter ) ; <nl> + B3DLoader . B3DState newState = new B3DLoader . B3DState ( null , counter ) ; <nl> return ( ( IExtendedBlockState ) this . state . getBaseState ( ) ) . withProperty ( B3DLoader . B3DFrameProperty . instance , newState ) ; <nl> } <nl> <nl> @ @ - 120 , 106 + 113 , 4 @ @ public class ModelLoaderRegistryDebug <nl> return false ; <nl> } <nl> } <nl> - <nl> - public static class DummyModelLoader implements ICustomModelLoader <nl> - { <nl> - public static final DummyModelLoader instance = new DummyModelLoader ( ) ; <nl> - public static final ResourceLocation dummyTexture = new ResourceLocation ( " minecraft : blocks / dirt " ) ; <nl> - <nl> - public boolean accepts ( ResourceLocation modelLocation ) <nl> - { <nl> - return modelLocation . getResourceDomain ( ) . equals ( " forgedebug " ) & & modelLocation . getResourcePath ( ) . contains ( " dummymodel " ) ; <nl> - } <nl> - <nl> - public IModel loadModel ( ResourceLocation model ) <nl> - { <nl> - return DummyModel . instance ; <nl> - } <nl> - <nl> - public static enum DummyModel implements IModel <nl> - { <nl> - instance ; <nl> - <nl> - public Collection < ResourceLocation > getDependencies ( ) <nl> - { <nl> - return Collections . emptyList ( ) ; <nl> - } <nl> - <nl> - public Collection < ResourceLocation > getTextures ( ) <nl> - { <nl> - return Collections . singletonList ( dummyTexture ) ; <nl> - } <nl> - <nl> - public IFlexibleBakedModel bake ( IModelState state , VertexFormat format , Function < ResourceLocation , TextureAtlasSprite > textures ) <nl> - { <nl> - return new DummyBakedModel ( textures . apply ( dummyTexture ) ) ; <nl> - } <nl> - <nl> - public IModelState getDefaultState ( ) <nl> - { <nl> - return ModelRotation . X0 _ Y0 ; <nl> - } <nl> - } <nl> - <nl> - public static class DummyBakedModel implements IFlexibleBakedModel <nl> - { <nl> - private final TextureAtlasSprite texture ; <nl> - <nl> - public DummyBakedModel ( TextureAtlasSprite texture ) <nl> - { <nl> - this . texture = texture ; <nl> - } <nl> - <nl> - public List < BakedQuad > getFaceQuads ( EnumFacing side ) <nl> - { <nl> - return Collections . emptyList ( ) ; <nl> - } <nl> - <nl> - private int [ ] vertexToInts ( float x , float y , float z , int color , float u , float v ) <nl> - { <nl> - return new int [ ] { <nl> - Float . floatToRawIntBits ( x ) , <nl> - Float . floatToRawIntBits ( y ) , <nl> - Float . floatToRawIntBits ( z ) , <nl> - color , <nl> - Float . floatToRawIntBits ( texture . getInterpolatedU ( u ) ) , <nl> - Float . floatToRawIntBits ( texture . getInterpolatedV ( v ) ) , <nl> - 0 <nl> - } ; <nl> - } <nl> - <nl> - public List < BakedQuad > getGeneralQuads ( ) <nl> - { <nl> - List < BakedQuad > ret = new ArrayList < BakedQuad > ( ) ; <nl> - / / 1 half - way rotated quad looking UP <nl> - ret . add ( new BakedQuad ( Ints . concat ( <nl> - vertexToInts ( 0 , . 5f , . 5f , - 1 , 0 , 0 ) , <nl> - vertexToInts ( . 5f , . 5f , 1 , - 1 , 0 , 16 ) , <nl> - vertexToInts ( 1 , . 5f , . 5f , - 1 , 16 , 16 ) , <nl> - vertexToInts ( . 5f , . 5f , 0 , - 1 , 16 , 0 ) <nl> - ) , - 1 , EnumFacing . UP ) ) ; <nl> - return ret ; <nl> - } <nl> - <nl> - public boolean isGui3d ( ) { return true ; } <nl> - <nl> - public boolean isAmbientOcclusion ( ) { return true ; } <nl> - <nl> - public boolean isBuiltInRenderer ( ) { return false ; } <nl> - <nl> - public TextureAtlasSprite getTexture ( ) { return this . texture ; } <nl> - <nl> - public ItemCameraTransforms getItemCameraTransforms ( ) <nl> - { <nl> - return ItemCameraTransforms . DEFAULT ; <nl> - } <nl> - <nl> - public VertexFormat getFormat ( ) <nl> - { <nl> - return Attributes . DEFAULT _ BAKED _ FORMAT ; <nl> - } <nl> - } <nl> - <nl> - public void onResourceManagerReload ( IResourceManager resourceManager ) { } <nl> - } <nl> } <nl> diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> index 1ebdfc8 . . c6db8d8 100644 <nl> - - - a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> + + + b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> @ @ - 1 , 5 + 1 , 18 @ @ <nl> { <nl> + " forge _ marker " : 1 , <nl> + " defaults " : { <nl> + " textures " : { <nl> + " # texture " : " forgedebugmodelloaderregistry : texture " , <nl> + " # chest " : " entity / chest / normal " <nl> + } , <nl> + " model " : " forgedebugmodelloaderregistry : chest . b3d " <nl> + } , <nl> " variants " : { <nl> - " normal " : { " model " : " forgedebugmodelloaderregistry : untitled2 . b3d " } <nl> + " normal " : { <nl> + " dummy " : " " <nl> + } , <nl> + " inventory " : { <nl> + " dummy " : " " <nl> + } <nl> } <nl> } <nl> diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d <nl> new file mode 100644 <nl> index 0000000 . . b070d7a <nl> Binary files / dev / null and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d differ <nl> diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d <nl> index 14e9c4d . . 8f4bd09 100644 <nl> Binary files a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d differ

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java b / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java 
 index 015372d . . 858c3a0 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java 
 + + + b / src / main / java / net / minecraftforge / client / model / BlockStateLoader . java 
 @ @ - 14 , 6 + 14 , 7 @ @ import javax . vecmath . Matrix4f ; 
 import net . minecraft . client . renderer . block . model . ModelBlockDefinition ; 
 import net . minecraft . client . resources . model . ModelRotation ; 
 import net . minecraft . util . ResourceLocation ; 
 + import net . minecraftforge . fml . common . FMLLog ; 
 
 import org . apache . commons . io . Charsets ; 
 import org . apache . commons . io . IOUtils ; 
 @ @ - 186 , 7 + 187 , 18 @ @ public class BlockStateLoader 
 IModelState partState = new TRSRTransformation ( matrix ) ; 
 if ( part . isUVLock ( ) ) partState = new ModelLoader . UVLock ( partState ) ; 
 
 - models . put ( entry . getKey ( ) , Pair . of ( runModelHooks ( loader . getModel ( part . getModelLocation ( ) ) , part . getTextures ( ) , part . getCustomData ( ) ) , partState ) ) ; 
 + IModel model = null ; 
 + try 
 + { 
 + model = loader . getModel ( part . getModelLocation ( ) ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + FMLLog . warning ( " Unable to load block sub - model : \ ' " + part . getModelLocation ( ) / * + " \ ' for variant : \ ' " + parent * / + " \ ' : " + e . toString ( ) ) ; 
 + model = loader . getMissingModel ( ) ; / / Will make it look weird , but that is good . 
 + } 
 + 
 + models . put ( entry . getKey ( ) , Pair . of ( runModelHooks ( model , part . getTextures ( ) , part . getCustomData ( ) ) , partState ) ) ; 
 } 
 
 return new MultiModel ( hasBase ? base : null , baseRot , models . build ( ) ) ; 
 diff - - git a / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java b / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java 
 index 6dd7466 . . beeaecb 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java 
 + + + b / src / main / java / net / minecraftforge / client / model / ICustomModelLoader . java 
 @ @ - 1 , 5 + 1 , 7 @ @ 
 package net . minecraftforge . client . model ; 
 
 + import java . io . IOException ; 
 + 
 import net . minecraft . client . resources . IResourceManagerReloadListener ; 
 import net . minecraft . util . ResourceLocation ; 
 
 @ @ - 14 , 5 + 16 , 5 @ @ public interface ICustomModelLoader extends IResourceManagerReloadListener 
 / * 
 * loads ( or reloads ) specified model 
 * / 
 - public IModel loadModel ( ResourceLocation modelLocation ) ; 
 + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / client / model / ModelLoader . java b / src / main / java / net / minecraftforge / client / model / ModelLoader . java 
 index 47ab1a7 . . da4b7da 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / ModelLoader . java 
 + + + b / src / main / java / net / minecraftforge / client / model / ModelLoader . java 
 @ @ - 58 , 6 + 58 , 7 @ @ import org . apache . logging . log4j . Level ; 
 
 import com . google . common . base . Function ; 
 import com . google . common . base . Functions ; 
 + import com . google . common . base . Throwables ; 
 import com . google . common . collect . ImmutableList ; 
 import com . google . common . collect . ImmutableMap ; 
 import com . google . common . collect . ImmutableSet ; 
 @ @ - 71 , 6 + 72 , 7 @ @ public class ModelLoader extends ModelBakery 
 private final Set < ResourceLocation > textures = new HashSet < ResourceLocation > ( ) ; 
 private final Set < ResourceLocation > loadingModels = new HashSet < ResourceLocation > ( ) ; 
 private final Set < ModelResourceLocation > missingVariants = Sets . newHashSet ( ) ; 
 + private IModel missingModel = null ; 
 
 private boolean isLoading = false ; 
 public boolean isLoading ( ) 
 @ @ - 91 , 8 + 93 , 16 @ @ public class ModelLoader extends ModelBakery 
 isLoading = true ; 
 loadBlocks ( ) ; 
 loadItems ( ) ; 
 - IModel missing = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; 
 - stateModels . put ( MODEL _ MISSING , missing ) ; 
 + try 
 + { 
 + missingModel = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + / / If this ever happens things are bad . Should never NOT be able to load the missing model . 
 + Throwables . propagate ( e ) ; 
 + } 
 + stateModels . put ( MODEL _ MISSING , missingModel ) ; 
 textures . remove ( TextureMap . LOCATION _ MISSING _ TEXTURE ) ; 
 textures . addAll ( LOCATIONS _ BUILTIN _ TEXTURES ) ; 
 textureMap . loadSprites ( resourceManager , new IIconCreator ( ) 
 @ @ - 107 , 8 + 117 , 8 @ @ public class ModelLoader extends ModelBakery 
 } ) ; 
 sprites . put ( new ResourceLocation ( " missingno " ) , textureMap . getMissingSprite ( ) ) ; 
 Function < ResourceLocation , TextureAtlasSprite > textureGetter = Functions . forMap ( sprites , textureMap . getMissingSprite ( ) ) ; 
 - IFlexibleBakedModel missingBaked = missing . bake ( missing . getDefaultState ( ) , Attributes . DEFAULT _ BAKED _ FORMAT , textureGetter ) ; 
 - for ( Entry < ModelResourceLocation , IModel > e : stateModels . entrySet ( ) ) 
 + IFlexibleBakedModel missingBaked = missingModel . bake ( missingModel . getDefaultState ( ) , Attributes . DEFAULT _ BAKED _ FORMAT , textureGetter ) ; 
 + for ( Entry < ModelResourceLocation , IModel > e : stateModels . entrySet ( ) ) 
 { 
 if ( e . getValue ( ) = = getMissingModel ( ) ) 
 { 
 @ @ - 143 , 11 + 153 , 11 @ @ public class ModelLoader extends ModelBakery 
 { 
 missingVariants . add ( location ) ; 
 } 
 - if ( variants ! = null & & ! variants . getVariants ( ) . isEmpty ( ) ) 
 + if ( variants ! = null & & ! variants . getVariants ( ) . isEmpty ( ) ) 
 { 
 try 
 { 
 - stateModels . put ( location , new WeightedRandomModel ( variants ) ) ; 
 + stateModels . put ( location , new WeightedRandomModel ( location , variants ) ) ; 
 } 
 catch ( Throwable e ) 
 { 
 @ @ - 165 , 18 + 175 , 29 @ @ public class ModelLoader extends ModelBakery 
 { 
 ResourceLocation file = getItemLocation ( s ) ; 
 ModelResourceLocation memory = new ModelResourceLocation ( s , " inventory " ) ; 
 - IModel model = getModel ( file ) ; 
 - if ( model = = null | | model = = getMissingModel ( ) ) 
 + IModel model = null ; 
 + try 
 { 
 - FMLLog . fine ( " Item json isn ' t found for ' " + memory + " ' , trying to load the variant from the blockstate json " ) ; 
 - registerVariant ( getModelBlockDefinition ( memory ) , memory ) ; 
 + model = getModel ( file ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + / / Handled by our finally block . 
 + } 
 + finally 
 + { 
 + if ( model = = null | | model = = getMissingModel ( ) ) 
 + { 
 + FMLLog . fine ( " Item json isn ' t found for ' " + memory + " ' , trying to load the variant from the blockstate json " ) ; 
 + registerVariant ( getModelBlockDefinition ( memory ) , memory ) ; 
 + } 
 + else stateModels . put ( memory , model ) ; 
 } 
 - else stateModels . put ( memory , model ) ; 
 } 
 } 
 } 
 
 - public IModel getModel ( ResourceLocation location ) 
 + public IModel getModel ( ResourceLocation location ) throws IOException 
 { 
 if ( ! ModelLoaderRegistry . loaded ( location ) ) loadAnyModel ( location ) ; 
 return ModelLoaderRegistry . getModel ( location ) ; 
 @ @ - 188 , 7 + 209 , 7 @ @ public class ModelLoader extends ModelBakery 
 return new ResourceLocation ( model . getResourceDomain ( ) , model . getResourcePath ( ) + " . json " ) ; 
 } 
 
 - private void loadAnyModel ( ResourceLocation location ) 
 + private void loadAnyModel ( ResourceLocation location ) throws IOException 
 { 
 if ( loadingModels . contains ( location ) ) 
 { 
 @ @ - 226 , 14 + 247 , 30 @ @ public class ModelLoader extends ModelBakery 
 / / setting parent here to make textures resolve properly 
 if ( model . getParentLocation ( ) ! = null ) 
 { 
 - IModel parent = getModel ( model . getParentLocation ( ) ) ; 
 - if ( parent instanceof VanillaModelWrapper ) 
 + try 
 { 
 - model . parent = ( ( VanillaModelWrapper ) parent ) . model ; 
 + IModel parent = getModel ( model . getParentLocation ( ) ) ; 
 + if ( parent instanceof VanillaModelWrapper ) 
 + { 
 + model . parent = ( ( VanillaModelWrapper ) parent ) . model ; 
 + } 
 + else 
 + { 
 + throw new IllegalStateException ( " vanilla model ' " + model + " ' can ' t have non - vanilla parent " ) ; 
 + } 
 } 
 - else 
 + catch ( IOException e ) 
 { 
 - throw new IllegalStateException ( " vanilla model " + model + " can ' t have non - vanilla parent " ) ; 
 + FMLLog . warning ( " Could not load vanilla model parent ' " + model . getParentLocation ( ) + " ' for ' " + model + " ' : " + e . toString ( ) ) ; 
 + IModel missing = ModelLoader . this . getMissingModel ( ) ; 
 + if ( missing instanceof VanillaModelWrapper ) 
 + { 
 + model . parent = ( ( VanillaModelWrapper ) missing ) . model ; 
 + } 
 + else 
 + { 
 + throw new IllegalStateException ( " vanilla model ' " + model + " ' has missing parent , and missing model is not a vanilla model " ) ; 
 + } 
 } 
 } 
 
 @ @ - 403 , 16 + 440 , 32 @ @ public class ModelLoader extends ModelBakery 
 private final List < IModel > models = new ArrayList < IModel > ( ) ; 
 private final IModelState defaultState ; 
 
 - public WeightedRandomModel ( Variants variants ) 
 + @ Deprecated public WeightedRandomModel ( Variants variants ) { this ( null , variants ) ; } / / Remove 1 . 9 
 + public WeightedRandomModel ( ModelResourceLocation parent , Variants variants ) 
 { 
 this . variants = variants . getVariants ( ) ; 
 ImmutableMap . Builder < IModelPart , TRSRTransformation > builder = ImmutableMap . builder ( ) ; 
 - for ( Variant v : ( List < Variant > ) variants . getVariants ( ) ) 
 + for ( Variant v : ( List < Variant > ) variants . getVariants ( ) ) 
 { 
 ResourceLocation loc = v . getModelLocation ( ) ; 
 locations . add ( loc ) ; 
 
 - IModel model = getModel ( loc ) ; 
 + IModel model = null ; 
 + try 
 + { 
 + model = getModel ( loc ) ; 
 + } 
 + catch ( Exception e ) 
 + { 
 + / * 
 + * Vanilla eats this , which makes it only show variants that have models . 
 + * But that doesn ' t help debugging , so we maintain the missing model 
 + * so that resource pack makers have a hint that their states are broken . 
 + * / 
 + FMLLog . warning ( " Unable to load block model : \ ' " + loc + " \ ' for variant : \ ' " + parent + " \ ' : " + e . toString ( ) ) ; 
 + model = getMissingModel ( ) ; 
 + } 
 + 
 if ( v instanceof ISmartVariant ) 
 { 
 model = ( ( ISmartVariant ) v ) . process ( model , ModelLoader . this ) ; 
 @ @ - 423 , 7 + 476 , 16 @ @ public class ModelLoader extends ModelBakery 
 models . add ( model ) ; 
 builder . put ( model , new TRSRTransformation ( v . getRotation ( ) ) ) ; 
 } 
 + 
 + if ( models . size ( ) = = 0 ) / / If all variants are missing , add one with the missing model and default rotation . 
 + { 
 + IModel missing = getMissingModel ( ) ; 
 + models . add ( missing ) ; 
 + builder . put ( missing , new TRSRTransformation ( ModelRotation . X0 _ Y0 ) ) ; 
 + } 
 + 
 defaultState = new MapModelState ( builder . build ( ) ) ; 
 + 
 } 
 
 public Collection < ResourceLocation > getDependencies ( ) 
 @ @ - 495 , 7 + 557 , 19 @ @ public class ModelLoader extends ModelBakery 
 
 public IModel getMissingModel ( ) 
 { 
 - return getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; 
 + if ( missingModel = = null ) 
 + { 
 + try 
 + { 
 + missingModel = getModel ( new ResourceLocation ( MODEL _ MISSING . getResourceDomain ( ) , MODEL _ MISSING . getResourcePath ( ) ) ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + / / If this ever happens things are bad . Should never NOT be able to load the missing model . 
 + Throwables . propagate ( e ) ; 
 + } 
 + } 
 + return missingModel ; 
 } 
 
 static enum VanillaLoader implements ICustomModelLoader 
 @ @ - 524 , 21 + 598 , 9 @ @ public class ModelLoader extends ModelBakery 
 return true ; 
 } 
 
 - public IModel loadModel ( ResourceLocation modelLocation ) 
 + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException 
 { 
 - try 
 - { 
 - return loader . new VanillaModelWrapper ( modelLocation , loader . loadModel ( modelLocation ) ) ; 
 - } 
 - catch ( IOException e ) 
 - { 
 - if ( loader . isLoading ) / / ToDo : Make this less gaging , hides missing models . . 
 - { 
 - / / holding error until onPostBakeEvent 
 - } 
 - else FMLLog . log ( Level . ERROR , e , " Exception loading model % s with vanilla loader , skipping " , modelLocation ) ; 
 - return loader . getMissingModel ( ) ; 
 - } 
 + return loader . new VanillaModelWrapper ( modelLocation , loader . loadModel ( modelLocation ) ) ; 
 } 
 } 
 
 diff - - git a / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java b / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java 
 index db24104 . . 3ee3948 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java 
 + + + b / src / main / java / net / minecraftforge / client / model / ModelLoaderRegistry . java 
 @ @ - 1 , 5 + 1 , 7 @ @ 
 package net . minecraftforge . client . model ; 
 
 + import java . io . FileNotFoundException ; 
 + import java . io . IOException ; 
 import java . util . HashMap ; 
 import java . util . HashSet ; 
 import java . util . Map ; 
 @ @ - 15 , 6 + 17 , 8 @ @ import net . minecraftforge . fml . common . FMLLog ; 
 
 import org . apache . logging . log4j . Level ; 
 
 + import com . google . common . base . Throwables ; 
 + 
 / * 
 * Central hub for custom model loaders . 
 * / 
 @ @ - 50 , 7 + 54 , 7 @ @ public class ModelLoaderRegistry 
 return new ResourceLocation ( location . getResourceDomain ( ) , " models / " + location . getResourcePath ( ) ) ; 
 } 
 
 - public static IModel getModel ( ResourceLocation location ) 
 + public static IModel getModel ( ResourceLocation location ) throws IOException 
 { 
 ResourceLocation actual = getActualLocation ( location ) ; 
 if ( cache . containsKey ( location ) ) return cache . get ( location ) ; 
 @ @ - 87 , 14 + 91 , 21 @ @ public class ModelLoaderRegistry 
 FMLLog . severe ( " no suitable loader found for the model % s , skipping " , location ) ; 
 model = getMissingModel ( ) ; 
 } 
 - else try 
 - { 
 - model = accepted . loadModel ( actual ) ; 
 - } 
 - catch ( Exception e ) 
 + else 
 { 
 - FMLLog . log ( Level . ERROR , e , " Exception loading model % s with loader % s , skipping " , location , accepted ) ; 
 - model = getMissingModel ( ) ; 
 + try 
 + { 
 + model = accepted . loadModel ( actual ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + throw e ; 
 + } 
 + catch ( Exception e ) 
 + { 
 + FMLLog . log ( Level . ERROR , e , " Exception loading model % s with loader % s , skipping " , location , accepted ) ; 
 + model = getMissingModel ( ) ; 
 + } 
 } 
 cache . put ( location , model ) ; 
 return model ; 
 diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 index 46f1c46 . . e8d4f11 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 @ @ - 104 , 7 + 104 , 7 @ @ public class B3DLoader implements ICustomModelLoader 
 } 
 
 @ SuppressWarnings ( " unchecked " ) 
 - public IModel loadModel ( ResourceLocation modelLocation ) 
 + public IModel loadModel ( ResourceLocation modelLocation ) throws IOException 
 { 
 ResourceLocation file = new ResourceLocation ( modelLocation . getResourceDomain ( ) , modelLocation . getResourcePath ( ) ) ; 
 if ( ! cache . containsKey ( file ) ) 
 @ @ - 130 , 8 + 130 , 9 @ @ public class B3DLoader implements ICustomModelLoader 
 } 
 catch ( IOException e ) 
 { 
 - FMLLog . log ( Level . ERROR , e , " Exception loading model % s with B3D loader , skipping " , modelLocation ) ; 
 + / / FMLLog . log ( Level . ERROR , e , " Exception loading model % s with B3D loader , skipping " , modelLocation ) ; 
 cache . put ( modelLocation , null ) ; 
 + throw e ; 
 } 
 } 
 B3DModel model = cache . get ( file ) ;

NEAREST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 index ca6ab30 . . 46f1c46 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DLoader . java 
 @ @ - 30 , 8 + 30 , 10 @ @ import net . minecraftforge . client . model . IColoredBakedQuad . ColoredBakedQuad ; 
 import net . minecraftforge . client . model . ICustomModelLoader ; 
 import net . minecraftforge . client . model . IFlexibleBakedModel ; 
 import net . minecraftforge . client . model . IModel ; 
 + import net . minecraftforge . client . model . IModelCustomData ; 
 import net . minecraftforge . client . model . IModelPart ; 
 import net . minecraftforge . client . model . IModelState ; 
 + import net . minecraftforge . client . model . IRetexturableModel ; 
 import net . minecraftforge . client . model . ISmartBlockModel ; 
 import net . minecraftforge . client . model . ISmartItemModel ; 
 import net . minecraftforge . client . model . ModelLoader ; 
 @ @ - 56 , 11 + 58 , 14 @ @ import org . apache . logging . log4j . Level ; 
 import org . lwjgl . BufferUtils ; 
 
 import com . google . common . base . Function ; 
 + import com . google . common . base . Predicate ; 
 import com . google . common . cache . CacheBuilder ; 
 import com . google . common . cache . CacheLoader ; 
 import com . google . common . cache . LoadingCache ; 
 + import com . google . common . collect . Collections2 ; 
 import com . google . common . collect . ImmutableList ; 
 import com . google . common . collect . ImmutableMap ; 
 + import com . google . common . collect . Maps ; 
 import com . google . common . collect . Multimap ; 
 
 / * 
 @ @ - 238 , 24 + 243 , 28 @ @ public class B3DLoader implements ICustomModelLoader 
 public static TRSRTransformation getNodeMatrix ( Animation animation , Node < ? > node , int frame ) 
 { 
 TRSRTransformation ret = TRSRTransformation . identity ( ) ; 
 - if ( node . getParent ( ) ! = null ) 
 - { 
 - TRSRTransformation pm = cache . getUnchecked ( Triple . < Animation , Node < ? > , Integer > of ( animation , node . getParent ( ) , frame ) ) ; 
 - ret = ret . compose ( pm ) ; 
 - } 
 Key key = null ; 
 if ( animation ! = null ) key = animation . getKeys ( ) . get ( frame , node ) ; 
 else if ( key = = null & & node . getAnimation ( ) ! = null & & node . getAnimation ( ) ! = animation ) key = node . getAnimation ( ) . getKeys ( ) . get ( frame , node ) ; 
 - if ( key = = null ) 
 - { 
 - FMLLog . severe ( " invalid key index : " + frame ) ; 
 - } 
 - else 
 + if ( key ! = null ) 
 { 
 + Node < ? > parent = node . getParent ( ) ; 
 + if ( parent ! = null ) 
 + { 
 + TRSRTransformation pm = cache . getUnchecked ( Triple . < Animation , Node < ? > , Integer > of ( animation , node . getParent ( ) , frame ) ) ; 
 + ret = ret . compose ( pm ) ; 
 + ret = ret . compose ( new TRSRTransformation ( parent . getPos ( ) , parent . getRot ( ) , parent . getScale ( ) , null ) ) ; 
 + } 
 ret = ret . compose ( new TRSRTransformation ( key . getPos ( ) , key . getRot ( ) , key . getScale ( ) , null ) ) ; 
 Matrix4f rm = new TRSRTransformation ( node . getPos ( ) , node . getRot ( ) , node . getScale ( ) , null ) . getMatrix ( ) ; 
 rm . invert ( ) ; 
 ret = ret . compose ( new TRSRTransformation ( rm ) ) ; 
 + if ( parent ! = null ) 
 + { 
 + rm = new TRSRTransformation ( parent . getPos ( ) , parent . getRot ( ) , parent . getScale ( ) , null ) . getMatrix ( ) ; 
 + rm . invert ( ) ; 
 + ret = ret . compose ( new TRSRTransformation ( rm ) ) ; 
 + } 
 } 
 return ret ; 
 } 
 @ @ - 305 , 14 + 314 , 14 @ @ public class B3DLoader implements ICustomModelLoader 
 } 
 } 
 
 - public static class Wrapper extends PartWrapper < Mesh > implements IModel 
 + public static class Wrapper extends PartWrapper < Mesh > implements IRetexturableModel , IModelCustomData 
 { 
 private final ResourceLocation location ; 
 private final ImmutableMap < String , ResourceLocation > textures ; 
 
 public Wrapper ( ResourceLocation location , List < Texture > textures , B3DModel . Node < Mesh > mesh ) 
 { 
 - this ( location , buildTextures ( location , textures ) , mesh ) ; 
 + this ( location , buildTextures ( textures ) , mesh ) ; 
 } 
 
 public Wrapper ( ResourceLocation location , ImmutableMap < String , ResourceLocation > textures , B3DModel . Node < Mesh > mesh ) 
 @ @ - 322 , 19 + 331 , 24 @ @ public class B3DLoader implements ICustomModelLoader 
 this . textures = textures ; 
 } 
 
 - private static ImmutableMap < String , ResourceLocation > buildTextures ( ResourceLocation location , List < Texture > textures ) 
 + private static ImmutableMap < String , ResourceLocation > buildTextures ( List < Texture > textures ) 
 { 
 ImmutableMap . Builder < String , ResourceLocation > builder = ImmutableMap . builder ( ) ; 
 
 for ( Texture t : textures ) 
 { 
 String path = t . getPath ( ) ; 
 - if ( path . endsWith ( " . png " ) ) path = path . substring ( 0 , path . length ( ) - " . png " . length ( ) ) ; 
 - builder . put ( t . getPath ( ) , new ResourceLocation ( location . getResourceDomain ( ) , path ) ) ; 
 + builder . put ( path , new ResourceLocation ( getLocation ( path ) ) ) ; 
 } 
 return builder . build ( ) ; 
 } 
 
 + private static String getLocation ( String path ) 
 + { 
 + if ( path . endsWith ( " . png " ) ) path = path . substring ( 0 , path . length ( ) - " . png " . length ( ) ) ; 
 + return path ; 
 + } 
 + 
 public Collection < ResourceLocation > getDependencies ( ) 
 { 
 / / no dependencies for in - file models 
 @ @ - 344 , 17 + 358 , 32 @ @ public class B3DLoader implements ICustomModelLoader 
 
 public Collection < ResourceLocation > getTextures ( ) 
 { 
 - return textures . values ( ) ; 
 + return Collections2 . filter ( textures . values ( ) , new Predicate < ResourceLocation > ( ) 
 + { 
 + public boolean apply ( ResourceLocation loc ) 
 + { 
 + return ! loc . getResourcePath ( ) . startsWith ( " # " ) ; 
 + } 
 + } ) ; 
 } 
 
 public IFlexibleBakedModel bake ( IModelState state , VertexFormat format , Function < ResourceLocation , TextureAtlasSprite > bakedTextureGetter ) 
 { 
 ImmutableMap . Builder < String , TextureAtlasSprite > builder = ImmutableMap . builder ( ) ; 
 - for ( String path : textures . keySet ( ) ) 
 + TextureAtlasSprite missing = bakedTextureGetter . apply ( new ResourceLocation ( " missingno " ) ) ; 
 + for ( Map . Entry < String , ResourceLocation > e : textures . entrySet ( ) ) 
 { 
 - builder . put ( path , bakedTextureGetter . apply ( textures . get ( path ) ) ) ; 
 + if ( e . getValue ( ) . getResourcePath ( ) . startsWith ( " # " ) ) 
 + { 
 + FMLLog . severe ( " unresolved texture ' % s ' for b3d model ' % s ' " , e . getValue ( ) . getResourcePath ( ) , location ) ; 
 + builder . put ( e . getKey ( ) , missing ) ; 
 + } 
 + else 
 + { 
 + builder . put ( e . getKey ( ) , bakedTextureGetter . apply ( e . getValue ( ) ) ) ; 
 + } 
 } 
 - builder . put ( " missingno " , bakedTextureGetter . apply ( new ResourceLocation ( " missingno " ) ) ) ; 
 + builder . put ( " missingno " , missing ) ; 
 return new BakedWrapper ( this , state , format , builder . build ( ) ) ; 
 } 
 
 @ @ - 396 , 6 + 425 , 35 @ @ public class B3DLoader implements ICustomModelLoader 
 else if ( ! location . equals ( other . location ) ) return false ; 
 return true ; 
 } 
 + 
 + @ Override 
 + public IModel retexture ( ImmutableMap < String , String > textures ) 
 + { 
 + ImmutableMap . Builder < String , ResourceLocation > builder = ImmutableMap . builder ( ) ; 
 + for ( Map . Entry < String , ResourceLocation > e : this . textures . entrySet ( ) ) 
 + { 
 + String path = e . getKey ( ) ; 
 + String loc = getLocation ( path ) ; 
 + if ( textures . containsKey ( loc ) ) 
 + { 
 + String newLoc = textures . get ( loc ) ; 
 + if ( newLoc = = null ) newLoc = getLocation ( path ) ; 
 + builder . put ( e . getKey ( ) , new ResourceLocation ( newLoc ) ) ; 
 + } 
 + else 
 + { 
 + builder . put ( e ) ; 
 + } 
 + } 
 + return new Wrapper ( location , builder . build ( ) , getNode ( ) ) ; 
 + } 
 + 
 + @ Override 
 + public IModel process ( ImmutableMap < String , String > customData ) 
 + { 
 + / / TODO keyframe 
 + return null ; 
 + } 
 } 
 
 private static class BakedWrapper implements IFlexibleBakedModel , ISmartBlockModel , ISmartItemModel 
 @ @ - 454 , 9 + 512 , 10 @ @ public class B3DLoader implements ICustomModelLoader 
 for ( Face f : faces ) 
 { 
 buf . clear ( ) ; 
 - List < Texture > textures = f . getBrush ( ) . getTextures ( ) ; 
 + List < Texture > textures = null ; 
 + if ( f . getBrush ( ) ! = null ) textures = f . getBrush ( ) . getTextures ( ) ; 
 TextureAtlasSprite sprite ; 
 - if ( textures . isEmpty ( ) ) sprite = this . textures . get ( " missingno " ) ; 
 + if ( textures = = null | | textures . isEmpty ( ) ) sprite = this . textures . get ( " missingno " ) ; 
 else if ( textures . get ( 0 ) = = B3DModel . Texture . White ) sprite = ModelLoader . White . instance ; 
 else sprite = this . textures . get ( textures . get ( 0 ) . getPath ( ) ) ; 
 putVertexData ( f . getV1 ( ) , sprite ) ; 
 diff - - git a / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java b / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java 
 index 3fe304b . . 2358b93 100644 
 - - - a / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java 
 + + + b / src / test / java / net / minecraftforge / debug / ModelLoaderRegistryDebug . java 
 @ @ - 64 , 14 + 64 , 9 @ @ public class ModelLoaderRegistryDebug 
 
 private void clientPreInit ( ) 
 { 
 - / / ModelLoaderRegistry . registerLoader ( DummyModelLoader . instance ) ; 
 B3DLoader . instance . addDomain ( MODID . toLowerCase ( ) ) ; 
 - / / ModelBakery . addVariantName ( Item . getItemFromBlock ( CustomModelBlock . instance ) , " forgedebug : dummymodel " ) ; 
 - String modelLocation = MODID . toLowerCase ( ) + " : untitled2 . b3d " ; 
 - ModelBakery . addVariantName ( Item . getItemFromBlock ( CustomModelBlock . instance ) , modelLocation ) ; 
 Item item = Item . getItemFromBlock ( CustomModelBlock . instance ) ; 
 - ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( modelLocation , " inventory " ) ) ; 
 - / / ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( " forgedebug : dummymodel " , " inventory " ) ) ; 
 + ModelLoader . setCustomModelResourceLocation ( item , 0 , new ModelResourceLocation ( MODID . toLowerCase ( ) + " : " + CustomModelBlock . name , " inventory " ) ) ; 
 } 
 
 public static class CustomModelBlock extends Block 
 @ @ - 100 , 9 + 95 , 7 @ @ public class ModelLoaderRegistryDebug 
 @ Override 
 public IBlockState getExtendedState ( IBlockState state , IBlockAccess world , BlockPos pos ) 
 { 
 - IModel model = ModelLoaderRegistry . getModel ( new ResourceLocation ( MODID . toLowerCase ( ) , " block / untitled2 . b3d " ) ) ; 
 - B3DLoader . B3DState defaultState = ( ( B3DLoader . Wrapper ) model ) . getDefaultState ( ) ; 
 - B3DLoader . B3DState newState = new B3DLoader . B3DState ( defaultState . getAnimation ( ) , counter ) ; 
 + B3DLoader . B3DState newState = new B3DLoader . B3DState ( null , counter ) ; 
 return ( ( IExtendedBlockState ) this . state . getBaseState ( ) ) . withProperty ( B3DLoader . B3DFrameProperty . instance , newState ) ; 
 } 
 
 @ @ - 120 , 106 + 113 , 4 @ @ public class ModelLoaderRegistryDebug 
 return false ; 
 } 
 } 
 - 
 - public static class DummyModelLoader implements ICustomModelLoader 
 - { 
 - public static final DummyModelLoader instance = new DummyModelLoader ( ) ; 
 - public static final ResourceLocation dummyTexture = new ResourceLocation ( " minecraft : blocks / dirt " ) ; 
 - 
 - public boolean accepts ( ResourceLocation modelLocation ) 
 - { 
 - return modelLocation . getResourceDomain ( ) . equals ( " forgedebug " ) & & modelLocation . getResourcePath ( ) . contains ( " dummymodel " ) ; 
 - } 
 - 
 - public IModel loadModel ( ResourceLocation model ) 
 - { 
 - return DummyModel . instance ; 
 - } 
 - 
 - public static enum DummyModel implements IModel 
 - { 
 - instance ; 
 - 
 - public Collection < ResourceLocation > getDependencies ( ) 
 - { 
 - return Collections . emptyList ( ) ; 
 - } 
 - 
 - public Collection < ResourceLocation > getTextures ( ) 
 - { 
 - return Collections . singletonList ( dummyTexture ) ; 
 - } 
 - 
 - public IFlexibleBakedModel bake ( IModelState state , VertexFormat format , Function < ResourceLocation , TextureAtlasSprite > textures ) 
 - { 
 - return new DummyBakedModel ( textures . apply ( dummyTexture ) ) ; 
 - } 
 - 
 - public IModelState getDefaultState ( ) 
 - { 
 - return ModelRotation . X0 _ Y0 ; 
 - } 
 - } 
 - 
 - public static class DummyBakedModel implements IFlexibleBakedModel 
 - { 
 - private final TextureAtlasSprite texture ; 
 - 
 - public DummyBakedModel ( TextureAtlasSprite texture ) 
 - { 
 - this . texture = texture ; 
 - } 
 - 
 - public List < BakedQuad > getFaceQuads ( EnumFacing side ) 
 - { 
 - return Collections . emptyList ( ) ; 
 - } 
 - 
 - private int [ ] vertexToInts ( float x , float y , float z , int color , float u , float v ) 
 - { 
 - return new int [ ] { 
 - Float . floatToRawIntBits ( x ) , 
 - Float . floatToRawIntBits ( y ) , 
 - Float . floatToRawIntBits ( z ) , 
 - color , 
 - Float . floatToRawIntBits ( texture . getInterpolatedU ( u ) ) , 
 - Float . floatToRawIntBits ( texture . getInterpolatedV ( v ) ) , 
 - 0 
 - } ; 
 - } 
 - 
 - public List < BakedQuad > getGeneralQuads ( ) 
 - { 
 - List < BakedQuad > ret = new ArrayList < BakedQuad > ( ) ; 
 - / / 1 half - way rotated quad looking UP 
 - ret . add ( new BakedQuad ( Ints . concat ( 
 - vertexToInts ( 0 , . 5f , . 5f , - 1 , 0 , 0 ) , 
 - vertexToInts ( . 5f , . 5f , 1 , - 1 , 0 , 16 ) , 
 - vertexToInts ( 1 , . 5f , . 5f , - 1 , 16 , 16 ) , 
 - vertexToInts ( . 5f , . 5f , 0 , - 1 , 16 , 0 ) 
 - ) , - 1 , EnumFacing . UP ) ) ; 
 - return ret ; 
 - } 
 - 
 - public boolean isGui3d ( ) { return true ; } 
 - 
 - public boolean isAmbientOcclusion ( ) { return true ; } 
 - 
 - public boolean isBuiltInRenderer ( ) { return false ; } 
 - 
 - public TextureAtlasSprite getTexture ( ) { return this . texture ; } 
 - 
 - public ItemCameraTransforms getItemCameraTransforms ( ) 
 - { 
 - return ItemCameraTransforms . DEFAULT ; 
 - } 
 - 
 - public VertexFormat getFormat ( ) 
 - { 
 - return Attributes . DEFAULT _ BAKED _ FORMAT ; 
 - } 
 - } 
 - 
 - public void onResourceManagerReload ( IResourceManager resourceManager ) { } 
 - } 
 } 
 diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 index 1ebdfc8 . . c6db8d8 100644 
 - - - a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 + + + b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 @ @ - 1 , 5 + 1 , 18 @ @ 
 { 
 + " forge _ marker " : 1 , 
 + " defaults " : { 
 + " textures " : { 
 + " # texture " : " forgedebugmodelloaderregistry : texture " , 
 + " # chest " : " entity / chest / normal " 
 + } , 
 + " model " : " forgedebugmodelloaderregistry : chest . b3d " 
 + } , 
 " variants " : { 
 - " normal " : { " model " : " forgedebugmodelloaderregistry : untitled2 . b3d " } 
 + " normal " : { 
 + " dummy " : " " 
 + } , 
 + " inventory " : { 
 + " dummy " : " " 
 + } 
 } 
 } 
 diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d 
 new file mode 100644 
 index 0000000 . . b070d7a 
 Binary files / dev / null and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d differ 
 diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d 
 index 14e9c4d . . 8f4bd09 100644 
 Binary files a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / untitled2 . b3d differ
