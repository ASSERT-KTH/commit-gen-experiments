BLEU SCORE: 0.009077715544186328

TEST MSG: Added hook to add entity spectator shader
GENERATED MSG: Try and fix invalid framebuffer depth / stencil setup , Thanks Ivoforce . Closes # 1032

TEST DIFF (one line): diff - - git a / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch b / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch <nl> index ea7e488 . . 35a1f9c 100644 <nl> - - - a / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch <nl> + + + b / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch <nl> @ @ - 1 , 6 + 1 , 14 @ @ <nl> - - - . . / src - base / minecraft / net / minecraft / client / renderer / EntityRenderer . java <nl> + + + . . / src - work / minecraft / net / minecraft / client / renderer / EntityRenderer . java <nl> - @ @ - 419 , 7 + 419 , 7 @ @ <nl> + @ @ - 200 , 6 + 200 , 7 @ @ <nl> + { <nl> + this . func _ 175069 _ a ( new ResourceLocation ( " shaders / post / invert . json " ) ) ; <nl> + } <nl> + + else net . minecraftforge . client . ForgeHooksClient . loadEntityShader ( p _ 175066 _ 1 _ . getClass ( ) , this ) ; <nl> + } <nl> + } <nl> + <nl> + @ @ - 419 , 7 + 420 , 7 @ @ <nl> <nl> if ( d3 < d2 | | d2 = = 0 . 0D ) <nl> { <nl> @ @ - 9 , 7 + 17 , 7 @ @ <nl> { <nl> if ( d2 = = 0 . 0D ) <nl> { <nl> - @ @ - 576 , 14 + 576 , 8 @ @ <nl> + @ @ - 576 , 14 + 577 , 8 @ @ <nl> { <nl> BlockPos blockpos = new BlockPos ( entity ) ; <nl> IBlockState iblockstate = this . field _ 78531 _ r . field _ 71441 _ e . func _ 180495 _ p ( blockpos ) ; <nl> @ @ - 25 , 7 + 33 , 7 @ @ <nl> GlStateManager . func _ 179114 _ b ( entity . field _ 70126 _ B + ( entity . field _ 70177 _ z - entity . field _ 70126 _ B ) * p _ 78467 _ 1 _ + 180 . 0F , 0 . 0F , - 1 . 0F , 0 . 0F ) ; <nl> GlStateManager . func _ 179114 _ b ( entity . field _ 70127 _ C + ( entity . field _ 70125 _ A - entity . field _ 70127 _ C ) * p _ 78467 _ 1 _ , - 1 . 0F , 0 . 0F , 0 . 0F ) ; <nl> } <nl> - @ @ - 650 , 17 + 644 , 20 @ @ <nl> + @ @ - 650 , 17 + 645 , 20 @ @ <nl> <nl> if ( ! this . field _ 78531 _ r . field _ 71474 _ y . field _ 74325 _ U ) <nl> { <nl> @ @ - 53 , 7 + 61 , 7 @ @ <nl> } <nl> <nl> GlStateManager . func _ 179109 _ b ( 0 . 0F , - f , 0 . 0F ) ; <nl> - @ @ - 1103 , 7 + 1100 , 7 @ @ <nl> + @ @ - 1103 , 7 + 1101 , 7 @ @ <nl> <nl> try <nl> { <nl> @ @ - 62 , 7 + 70 , 7 @ @ <nl> } <nl> catch ( Throwable throwable ) <nl> { <nl> - @ @ - 1164 , 7 + 1161 , 7 @ @ <nl> + @ @ - 1164 , 7 + 1162 , 7 @ @ <nl> <nl> if ( this . field _ 78531 _ r . field _ 71442 _ b . func _ 178889 _ l ( ) = = WorldSettings . GameType . SPECTATOR ) <nl> { <nl> @ @ - 71 , 7 + 79 , 7 @ @ <nl> } <nl> else <nl> { <nl> - @ @ - 1314 , 7 + 1311 , 9 @ @ <nl> + @ @ - 1314 , 7 + 1312 , 9 @ @ <nl> GlStateManager . func _ 179094 _ E ( ) ; <nl> RenderHelper . func _ 74519 _ b ( ) ; <nl> this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " entities " ) ; <nl> @ @ - 81 , 7 + 89 , 7 @ @ <nl> RenderHelper . func _ 74518 _ a ( ) ; <nl> this . func _ 175072 _ h ( ) ; <nl> GlStateManager . func _ 179128 _ n ( 5888 ) ; <nl> - @ @ - 1326 , 6 + 1325 , 7 @ @ <nl> + @ @ - 1326 , 6 + 1326 , 7 @ @ <nl> EntityPlayer entityplayer = ( EntityPlayer ) entity ; <nl> GlStateManager . func _ 179118 _ c ( ) ; <nl> this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " outline " ) ; <nl> @ @ - 89 , 7 + 97 , 7 @ @ <nl> renderglobal . func _ 72731 _ b ( entityplayer , this . field _ 78531 _ r . field _ 71476 _ x , 0 , p _ 175068 _ 2 _ ) ; <nl> GlStateManager . func _ 179141 _ d ( ) ; <nl> } <nl> - @ @ - 1339 , 6 + 1339 , 7 @ @ <nl> + @ @ - 1339 , 6 + 1340 , 7 @ @ <nl> EntityPlayer entityplayer1 = ( EntityPlayer ) entity ; <nl> GlStateManager . func _ 179118 _ c ( ) ; <nl> this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " outline " ) ; <nl> @ @ - 97 , 7 + 105 , 7 @ @ <nl> renderglobal . func _ 72731 _ b ( entityplayer1 , this . field _ 78531 _ r . field _ 71476 _ x , 0 , p _ 175068 _ 2 _ ) ; <nl> GlStateManager . func _ 179141 _ d ( ) ; <nl> } <nl> - @ @ - 1380 , 6 + 1381 , 15 @ @ <nl> + @ @ - 1380 , 6 + 1382 , 15 @ @ <nl> GlStateManager . func _ 179103 _ j ( 7425 ) ; <nl> this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " translucent " ) ; <nl> renderglobal . func _ 174977 _ a ( EnumWorldBlockLayer . TRANSLUCENT , ( double ) p _ 175068 _ 2 _ , p _ 175068 _ 1 _ , entity ) ; <nl> @ @ - 113 , 7 + 121 , 7 @ @ <nl> GlStateManager . func _ 179103 _ j ( 7424 ) ; <nl> GlStateManager . func _ 179132 _ a ( true ) ; <nl> GlStateManager . func _ 179089 _ o ( ) ; <nl> - @ @ - 1392 , 8 + 1402 , 12 @ @ <nl> + @ @ - 1392 , 8 + 1403 , 12 @ @ <nl> this . func _ 180437 _ a ( renderglobal , p _ 175068 _ 2 _ , p _ 175068 _ 1 _ ) ; <nl> } <nl> <nl> @ @ - 126 , 7 + 134 , 7 @ @ <nl> if ( this . field _ 175074 _ C ) <nl> { <nl> GlStateManager . func _ 179086 _ m ( 256 ) ; <nl> - @ @ - 1505 , 6 + 1519 , 13 @ @ <nl> + @ @ - 1505 , 6 + 1520 , 13 @ @ <nl> <nl> protected void func _ 78474 _ d ( float p _ 78474 _ 1 _ ) <nl> { <nl> @ @ - 140 , 7 + 148 , 7 @ @ <nl> float f = this . field _ 78531 _ r . field _ 71441 _ e . func _ 72867 _ j ( p _ 78474 _ 1 _ ) ; <nl> <nl> if ( f > 0 . 0F ) <nl> - @ @ - 1830 , 6 + 1851 , 13 @ @ <nl> + @ @ - 1830 , 6 + 1852 , 13 @ @ <nl> this . field _ 175081 _ S = f7 ; <nl> } <nl> <nl> @ @ - 154 , 7 + 162 , 7 @ @ <nl> GlStateManager . func _ 179082 _ a ( this . field _ 175080 _ Q , this . field _ 175082 _ R , this . field _ 175081 _ S , 0 . 0F ) ; <nl> } <nl> <nl> - @ @ - 1848 , 6 + 1876 , 10 @ @ <nl> + @ @ - 1848 , 6 + 1877 , 10 @ @ <nl> GlStateManager . func _ 179131 _ c ( 1 . 0F , 1 . 0F , 1 . 0F , 1 . 0F ) ; <nl> Block block = ActiveRenderInfo . func _ 180786 _ a ( this . field _ 78531 _ r . field _ 71441 _ e , entity , p _ 78468 _ 2 _ ) ; <nl> <nl> @ @ - 165 , 7 + 173 , 7 @ @ <nl> if ( entity instanceof EntityLivingBase & & ( ( EntityLivingBase ) entity ) . func _ 70644 _ a ( Potion . field _ 76440 _ q ) ) <nl> { <nl> float f1 = 5 . 0F ; <nl> - @ @ - 1925 , 6 + 1957 , 7 @ @ <nl> + @ @ - 1925 , 6 + 1958 , 7 @ @ <nl> GlStateManager . func _ 179102 _ b ( f * 0 . 05F ) ; <nl> GlStateManager . func _ 179153 _ c ( Math . min ( f , 192 . 0F ) * 0 . 5F ) ; <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> index a4bcd44 . . 1641e96 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> + + + b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java <nl> @ @ - 51 , 12 + 51 , 7 @ @ import net . minecraft . entity . player . EntityPlayer ; <nl> import net . minecraft . item . Item ; <nl> import net . minecraft . item . ItemStack ; <nl> import net . minecraft . tileentity . TileEntity ; <nl> - import net . minecraft . util . BlockPos ; <nl> - import net . minecraft . util . EnumChatFormatting ; <nl> - import net . minecraft . util . EnumFacing ; <nl> - import net . minecraft . util . EnumWorldBlockLayer ; <nl> - import net . minecraft . util . IRegistry ; <nl> - import net . minecraft . util . MovingObjectPosition ; <nl> + import net . minecraft . util . * ; <nl> import net . minecraft . world . IBlockAccess ; <nl> import net . minecraft . world . World ; <nl> import net . minecraft . world . biome . BiomeGenBase ; <nl> @ @ - 80 , 6 + 75 , 7 @ @ import net . minecraftforge . common . ForgeVersion ; <nl> import net . minecraftforge . common . ForgeVersion . Status ; <nl> import net . minecraftforge . common . MinecraftForge ; <nl> import net . minecraftforge . fml . client . FMLClientHandler ; <nl> + import net . minecraftforge . fml . client . registry . ClientRegistry ; <nl> import net . minecraftforge . fml . common . FMLLog ; <nl> <nl> import org . apache . commons . lang3 . tuple . Pair ; <nl> @ @ - 578 , 4 + 574 , 13 @ @ public class ForgeHooksClient <nl> if ( part . isPresent ( ) ) return Optional . absent ( ) ; <nl> return Optional . of ( new TRSRTransformation ( matrix ) ) ; <nl> } <nl> + <nl> + public static void loadEntityShader ( Class < ? extends Entity > entityClass , EntityRenderer entityRenderer ) <nl> + { <nl> + ResourceLocation shader = ClientRegistry . getEntityShader ( entityClass ) ; <nl> + if ( shader ! = null ) <nl> + { <nl> + entityRenderer . loadShader ( shader ) ; <nl> + } <nl> + } <nl> } <nl> diff - - git a / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java b / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java <nl> index 205837e . . 94490d3 100644 <nl> - - - a / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java <nl> + + + b / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java <nl> @ @ - 12 , 6 + 12 , 9 @ @ <nl> <nl> package net . minecraftforge . fml . client . registry ; <nl> <nl> + import com . google . common . collect . Maps ; <nl> + import net . minecraft . entity . Entity ; <nl> + import net . minecraft . util . ResourceLocation ; <nl> import org . apache . commons . lang3 . ArrayUtils ; <nl> <nl> import net . minecraft . client . Minecraft ; <nl> @ @ - 21 , 8 + 24 , 12 @ @ import net . minecraft . client . settings . KeyBinding ; <nl> import net . minecraft . tileentity . TileEntity ; <nl> import net . minecraftforge . fml . common . registry . GameRegistry ; <nl> <nl> + import java . util . Map ; <nl> + <nl> public class ClientRegistry <nl> { <nl> + private static Map < Class < ? extends Entity > , ResourceLocation > entityShaderMap = Maps . newHashMap ( ) ; <nl> + <nl> / * * <nl> * <nl> * Utility method for registering a tile entity and it ' s renderer at once - generally you should register them separately <nl> @ @ - 47 , 4 + 54 , 21 @ @ public class ClientRegistry <nl> { <nl> Minecraft . getMinecraft ( ) . gameSettings . keyBindings = ArrayUtils . add ( Minecraft . getMinecraft ( ) . gameSettings . keyBindings , key ) ; <nl> } <nl> + <nl> + / * * <nl> + * Register a shader for an entity . This shader gets activated when a spectator begins spectating an entity . <nl> + * Vanilla examples of this are the green effect for creepers and the invert effect for endermans . <nl> + * <nl> + * @ param entityClass <nl> + * @ param shader <nl> + * / <nl> + public static void registerEntityShader ( Class < ? extends Entity > entityClass , ResourceLocation shader ) <nl> + { <nl> + entityShaderMap . put ( entityClass , shader ) ; <nl> + } <nl> + <nl> + public static ResourceLocation getEntityShader ( Class < ? extends Entity > entityClass ) <nl> + { <nl> + return entityShaderMap . get ( entityClass ) ; <nl> + } <nl> } <nl> diff - - git a / src / main / resources / forge _ at . cfg b / src / main / resources / forge _ at . cfg <nl> index 29b45a6 . . f53e403 100644 <nl> - - - a / src / main / resources / forge _ at . cfg <nl> + + + b / src / main / resources / forge _ at . cfg <nl> @ @ - 164 , 6 + 164 , 8 @ @ public net . minecraft . entity . EntityList field _ 75623 _ d # idToClassMap <nl> public net . minecraft . client . renderer . entity . RenderManager field _ 78729 _ o # renderers <nl> # # TileEntityRendererDispatcher <nl> public net . minecraft . client . renderer . tileentity . TileEntityRendererDispatcher field _ 147559 _ m <nl> + # # EntityRenderer <nl> + public net . minecraft . client . renderer . EntityRenderer func _ 175069 _ a ( Lnet / minecraft / util / ResourceLocation ; ) V # loadShader <nl> # # WeightedRandomItem <nl> public net . minecraft . util . WeightedRandom $ Item field _ 76292 _ a # probability <nl> # # EntityPlayerMP getNextWindowId
NEAREST DIFF (one line): diff - - git a / patches / minecraft / net / minecraft / client / Minecraft . java . patch b / patches / minecraft / net / minecraft / client / Minecraft . java . patch <nl> index b69cba7 . . b1c023d 100644 <nl> - - - a / patches / minecraft / net / minecraft / client / Minecraft . java . patch <nl> + + + b / patches / minecraft / net / minecraft / client / Minecraft . java . patch <nl> @ @ - 1 , 6 + 1 , 6 @ @ <nl> - - - . . / src - base / minecraft / net / minecraft / client / Minecraft . java <nl> + + + . . / src - work / minecraft / net / minecraft / client / Minecraft . java <nl> - @ @ - 134 , 6 + 134 , 14 @ @ <nl> + @ @ - 135 , 6 + 135 , 14 @ @ <nl> import net . minecraft . world . storage . ISaveFormat ; <nl> import net . minecraft . world . storage . ISaveHandler ; <nl> import net . minecraft . world . storage . WorldInfo ; <nl> @ @ - 15 , 7 + 15 , 7 @ @ <nl> import org . apache . logging . log4j . LogManager ; <nl> import org . apache . logging . log4j . Logger ; <nl> import org . lwjgl . LWJGLException ; <nl> - @ @ - 245 , 7 + 253 , 7 @ @ <nl> + @ @ - 246 , 7 + 254 , 7 @ @ <nl> this . func _ 71389 _ H ( ) ; <nl> this . field _ 71449 _ j = p _ i1014 _ 1 _ ; <nl> field _ 147123 _ G . info ( " Setting user : " + p _ i1014 _ 1 _ . func _ 111285 _ a ( ) ) ; <nl> @ @ - 24 , 7 + 24 , 7 @ @ <nl> this . field _ 71459 _ aj = p _ i1014 _ 5 _ ; <nl> this . field _ 71443 _ c = p _ i1014 _ 2 _ ; <nl> this . field _ 71440 _ d = p _ i1014 _ 3 _ ; <nl> - @ @ - 419 , 7 + 427 , 7 @ @ <nl> + @ @ - 417 , 7 + 425 , 7 @ @ <nl> <nl> try <nl> { <nl> @ @ - 33 , 7 + 33 , 7 @ @ <nl> } <nl> catch ( LWJGLException lwjglexception ) <nl> { <nl> - @ @ - 518 , 7 + 526 , 7 @ @ <nl> + @ @ - 516 , 7 + 524 , 7 @ @ <nl> this . field _ 71452 _ i = new EffectRenderer ( this . field _ 71441 _ e , this . field _ 71446 _ o ) ; <nl> FMLClientHandler . instance ( ) . finishMinecraftLoading ( ) ; <nl> this . func _ 71361 _ d ( " Post startup " ) ; <nl> @ @ - 42 , 7 + 42 , 7 @ @ <nl> <nl> if ( this . field _ 71475 _ ae ! = null ) <nl> { <nl> - @ @ - 701 , 11 + 709 , 6 @ @ <nl> + @ @ - 699 , 11 + 707 , 6 @ @ <nl> <nl> public void func _ 147108 _ a ( GuiScreen p _ 147108 _ 1 _ ) <nl> { <nl> @ @ - 54 , 7 + 54 , 7 @ @ <nl> if ( p _ 147108 _ 1 _ = = null & & this . field _ 71441 _ e = = null ) <nl> { <nl> p _ 147108 _ 1 _ = new GuiMainMenu ( ) ; <nl> - @ @ - 715 , 6 + 718 , 17 @ @ <nl> + @ @ - 713 , 6 + 716 , 17 @ @ <nl> p _ 147108 _ 1 _ = new GuiGameOver ( ) ; <nl> } <nl> <nl> @ @ - 72 , 7 + 72 , 7 @ @ <nl> if ( p _ 147108 _ 1 _ instanceof GuiMainMenu ) <nl> { <nl> this . field _ 71474 _ y . field _ 74330 _ P = false ; <nl> - @ @ - 1297 , 7 + 1311 , 7 @ @ <nl> + @ @ - 1295 , 7 + 1309 , 7 @ @ <nl> <nl> if ( this . field _ 71439 _ g . func _ 82246 _ f ( i , j , k ) ) <nl> { <nl> @ @ - 81 , 7 + 81 , 7 @ @ <nl> this . field _ 71439 _ g . func _ 71038 _ i ( ) ; <nl> } <nl> } <nl> - @ @ - 1378 , 11 + 1392 , 12 @ @ <nl> + @ @ - 1376 , 11 + 1390 , 12 @ @ <nl> int j = this . field _ 71476 _ x . field _ 72312 _ c ; <nl> int k = this . field _ 71476 _ x . field _ 72309 _ d ; <nl> <nl> @ @ - 96 , 7 + 96 , 7 @ @ <nl> { <nl> flag = false ; <nl> this . field _ 71439 _ g . func _ 71038 _ i ( ) ; <nl> - @ @ - 1409 , 7 + 1424 , 8 @ @ <nl> + @ @ - 1407 , 7 + 1422 , 8 @ @ <nl> { <nl> ItemStack itemstack1 = this . field _ 71439 _ g . field _ 71071 _ by . func _ 70448 _ g ( ) ; <nl> <nl> @ @ - 106 , 7 + 106 , 7 @ @ <nl> { <nl> this . field _ 71460 _ t . field _ 78516 _ c . func _ 78445 _ c ( ) ; <nl> } <nl> - @ @ - 1608 , 6 + 1624 , 8 @ @ <nl> + @ @ - 1606 , 6 + 1622 , 8 @ @ <nl> <nl> while ( Mouse . next ( ) ) <nl> { <nl> @ @ - 115 , 7 + 115 , 7 @ @ <nl> i = Mouse . getEventButton ( ) ; <nl> <nl> if ( field _ 142025 _ a & & i = = 0 & & ( Keyboard . isKeyDown ( 29 ) | | Keyboard . isKeyDown ( 157 ) ) ) <nl> - @ @ - 2075 , 6 + 2093 , 11 @ @ <nl> + @ @ - 2079 , 6 + 2097 , 11 @ @ <nl> <nl> public void func _ 71353 _ a ( WorldClient p _ 71353 _ 1 _ , String p _ 71353 _ 2 _ ) <nl> { <nl> @ @ - 127 , 7 + 127 , 7 @ @ <nl> if ( p _ 71353 _ 1 _ = = null ) <nl> { <nl> NetHandlerPlayClient nethandlerplayclient = this . func _ 147114 _ u ( ) ; <nl> - @ @ - 2087 , 6 + 2110 , 18 @ @ <nl> + @ @ - 2091 , 6 + 2114 , 18 @ @ <nl> if ( this . field _ 71437 _ Z ! = null ) <nl> { <nl> this . field _ 71437 _ Z . func _ 71263 _ m ( ) ; <nl> @ @ - 146 , 7 + 146 , 7 @ @ <nl> } <nl> <nl> this . field _ 71437 _ Z = null ; <nl> - @ @ - 2235 , 113 + 2270 , 10 @ @ <nl> + @ @ - 2239 , 113 + 2274 , 10 @ @ <nl> if ( this . field _ 71476 _ x ! = null ) <nl> { <nl> boolean flag = this . field _ 71439 _ g . field _ 71075 _ bZ . field _ 75098 _ d ; <nl> @ @ - 262 , 7 + 262 , 7 @ @ <nl> if ( flag ) <nl> { <nl> j = this . field _ 71439 _ g . field _ 71069 _ bz . field _ 75151 _ b . size ( ) - 9 + this . field _ 71439 _ g . field _ 71071 _ by . field _ 70461 _ c ; <nl> - @ @ - 2508 , 8 + 2440 , 15 @ @ <nl> + @ @ - 2512 , 8 + 2444 , 15 @ @ <nl> p _ 70001 _ 1 _ . func _ 76472 _ a ( " gl _ max _ texture _ size " , Integer . valueOf ( func _ 71369 _ N ( ) ) ) ; <nl> } <nl> <nl> @ @ - 278 , 7 + 278 , 7 @ @ <nl> for ( int i = 16384 ; i > 0 ; i > > = 1 ) <nl> { <nl> GL11 . glTexImage2D ( GL11 . GL _ PROXY _ TEXTURE _ 2D , 0 , GL11 . GL _ RGBA , i , i , 0 , GL11 . GL _ RGBA , GL11 . GL _ UNSIGNED _ BYTE , ( ByteBuffer ) null ) ; <nl> - @ @ - 2517 , 6 + 2456 , 7 @ @ <nl> + @ @ - 2521 , 6 + 2460 , 7 @ @ <nl> <nl> if ( j ! = 0 ) <nl> { <nl> diff - - git a / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch b / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch <nl> index a17617b . . bf256e0 100644 <nl> - - - a / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch <nl> + + + b / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch <nl> @ @ - 1 , 21 + 1 , 29 @ @ <nl> - - - . . / src - base / minecraft / net / minecraft / client / shader / Framebuffer . java <nl> + + + . . / src - work / minecraft / net / minecraft / client / shader / Framebuffer . java <nl> - @ @ - 6 , 6 + 6 , 7 @ @ <nl> + @ @ - 6 , 6 + 6 , 9 @ @ <nl> import net . minecraft . client . renderer . OpenGlHelper ; <nl> import net . minecraft . client . renderer . Tessellator ; <nl> import net . minecraft . client . renderer . texture . TextureUtil ; <nl> + import net . minecraftforge . client . MinecraftForgeClient ; <nl> + + import static org . lwjgl . opengl . EXTPackedDepthStencil . * ; <nl> + + import static org . lwjgl . opengl . EXTFramebufferObject . * ; <nl> import org . lwjgl . opengl . EXTFramebufferObject ; <nl> import org . lwjgl . opengl . GL11 ; <nl> <nl> - @ @ - 120 , 6 + 121 , 11 @ @ <nl> + @ @ - 118 , 8 + 121 , 17 @ @ <nl> + if ( this . field _ 147619 _ e ) <nl> + { <nl> EXTFramebufferObject . glBindRenderbufferEXT ( 36161 , this . field _ 147624 _ h ) ; <nl> + + if ( MinecraftForgeClient . getStencilBits ( ) = = 0 ) <nl> + + { <nl> EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , 33190 , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; <nl> EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , 36096 , 36161 , this . field _ 147624 _ h ) ; <nl> - + if ( MinecraftForgeClient . getStencilBits ( ) > 0 ) <nl> + + } <nl> + + else <nl> + { <nl> - + EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , EXTFramebufferObject . GL _ STENCIL _ INDEX8 _ EXT , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; <nl> - + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , EXTFramebufferObject . GL _ STENCIL _ ATTACHMENT _ EXT , 36161 , this . field _ 147624 _ h ) ; <nl> + + EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , GL _ DEPTH24 _ STENCIL8 _ EXT , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; <nl> + + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , GL _ DEPTH _ ATTACHMENT _ EXT , GL _ RENDERBUFFER _ EXT , this . field _ 147624 _ h ) ; <nl> + + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , GL _ STENCIL _ ATTACHMENT _ EXT , GL _ RENDERBUFFER _ EXT , this . field _ 147624 _ h ) ; <nl> + } <nl> } <nl> <nl> diff - - git a / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch b / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch <nl> index 3082905 . . fafd4c8 100644 <nl> - - - a / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch <nl> + + + b / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch <nl> @ @ - 1 , 6 + 1 , 6 @ @ <nl> - - - . . / src - base / minecraft / net / minecraft / server / MinecraftServer . java <nl> + + + . . / src - work / minecraft / net / minecraft / server / MinecraftServer . java <nl> - @ @ - 25 , 6 + 25 , 7 @ @ <nl> + @ @ - 26 , 6 + 26 , 7 @ @ <nl> import java . util . Arrays ; <nl> import java . util . Collections ; <nl> import java . util . Date ; <nl> @ @ - 8 , 7 + 8 , 7 @ @ <nl> import java . util . Iterator ; <nl> import java . util . List ; <nl> import java . util . Random ; <nl> - @ @ - 73 , 6 + 74 , 10 @ @ <nl> + @ @ - 74 , 6 + 75 , 10 @ @ <nl> import org . apache . logging . log4j . LogManager ; <nl> import org . apache . logging . log4j . Logger ; <nl> <nl> @ @ - 19 , 7 + 19 , 7 @ @ <nl> public abstract class MinecraftServer implements ICommandSender , Runnable , IPlayerUsage <nl> { <nl> private static final Logger field _ 147145 _ h = LogManager . getLogger ( ) ; <nl> - @ @ - 89 , 7 + 94 , 7 @ @ <nl> + @ @ - 90 , 7 + 95 , 7 @ @ <nl> @ SideOnly ( Side . SERVER ) <nl> private String field _ 71320 _ r ; <nl> private int field _ 71319 _ s = - 1 ; <nl> @ @ - 28 , 7 + 28 , 7 @ @ <nl> private ServerConfigurationManager field _ 71318 _ t ; <nl> private boolean field _ 71317 _ u = true ; <nl> private boolean field _ 71316 _ v ; <nl> - @ @ - 106 , 7 + 111 , 8 @ @ <nl> + @ @ - 107 , 7 + 112 , 8 @ @ <nl> private int field _ 71280 _ D ; <nl> private int field _ 143008 _ E = 0 ; <nl> public final long [ ] field _ 71311 _ j = new long [ 100 ] ; <nl> @ @ - 38 , 7 + 38 , 7 @ @ <nl> private KeyPair field _ 71292 _ I ; <nl> private String field _ 71293 _ J ; <nl> private String field _ 71294 _ K ; <nl> - @ @ - 182 , 8 + 188 , 6 @ @ <nl> + @ @ - 183 , 8 + 189 , 6 @ @ <nl> { <nl> this . func _ 71237 _ c ( p _ 71247 _ 1 _ ) ; <nl> this . func _ 71192 _ d ( " menu . loadingLevel " ) ; <nl> @ @ - 47 , 7 + 47 , 7 @ @ <nl> ISaveHandler isavehandler = this . field _ 71310 _ m . func _ 75804 _ a ( p _ 71247 _ 1 _ , true ) ; <nl> WorldInfo worldinfo = isavehandler . func _ 75757 _ d ( ) ; <nl> WorldSettings worldsettings ; <nl> - @ @ - 203 , 46 + 207 , 21 @ @ <nl> + @ @ - 204 , 46 + 208 , 21 @ @ <nl> worldsettings . func _ 77159 _ a ( ) ; <nl> } <nl> <nl> @ @ - 101 , 7 + 101 , 7 @ @ <nl> this . func _ 147139 _ a ( this . func _ 147135 _ j ( ) ) ; <nl> this . func _ 71222 _ d ( ) ; <nl> } <nl> - @ @ - 309 , 6 + 288 , 7 @ @ <nl> + @ @ - 310 , 6 + 289 , 7 @ @ <nl> if ( ! this . field _ 71290 _ O ) <nl> { <nl> WorldServer [ ] aworldserver = this . field _ 71305 _ c ; <nl> @ @ - 109 , 7 + 109 , 7 @ @ <nl> int i = aworldserver . length ; <nl> <nl> for ( int j = 0 ; j < i ; + + j ) <nl> - @ @ - 359 , 9 + 339 , 16 @ @ <nl> + @ @ - 360 , 9 + 340 , 16 @ @ <nl> for ( int i = 0 ; i < this . field _ 71305 _ c . length ; + + i ) <nl> { <nl> WorldServer worldserver = this . field _ 71305 _ c [ i ] ; <nl> @ @ - 126 , 7 + 126 , 7 @ @ <nl> if ( this . field _ 71307 _ n . func _ 76468 _ d ( ) ) <nl> { <nl> this . field _ 71307 _ n . func _ 76470 _ e ( ) ; <nl> - @ @ - 586 , 13 + 573 , 15 @ @ <nl> + @ @ - 588 , 13 + 575 , 15 @ @ <nl> this . field _ 71304 _ b . func _ 76320 _ a ( " levels " ) ; <nl> int i ; <nl> <nl> @ @ - 145 , 7 + 145 , 7 @ @ <nl> this . field _ 71304 _ b . func _ 76320 _ a ( worldserver . func _ 72912 _ H ( ) . func _ 76065 _ j ( ) ) ; <nl> this . field _ 71304 _ b . func _ 76320 _ a ( " pools " ) ; <nl> worldserver . func _ 82732 _ R ( ) . func _ 72343 _ a ( ) ; <nl> - @ @ - 639 , 9 + 628 , 11 @ @ <nl> + @ @ - 641 , 9 + 630 , 11 @ @ <nl> this . field _ 71304 _ b . func _ 76319 _ b ( ) ; <nl> } <nl> <nl> @ @ - 158 , 7 + 158 , 7 @ @ <nl> this . field _ 71304 _ b . func _ 76318 _ c ( " connection " ) ; <nl> this . func _ 147137 _ ag ( ) . func _ 151269 _ c ( ) ; <nl> this . field _ 71304 _ b . func _ 76318 _ c ( " players " ) ; <nl> - @ @ - 685 , 7 + 676 , 13 @ @ <nl> + @ @ - 688 , 7 + 679 , 13 @ @ <nl> <nl> public WorldServer func _ 71218 _ a ( int p _ 71218 _ 1 _ ) <nl> { <nl> @ @ - 173 , 7 + 173 , 7 @ @ <nl> } <nl> <nl> public String func _ 71249 _ w ( ) <nl> - @ @ - 944 , 6 + 941 , 7 @ @ <nl> + @ @ - 947 , 6 + 944 , 7 @ @ <nl> <nl> if ( worldserver ! = null ) <nl> { <nl> @ @ - 181 , 7 + 181 , 7 @ @ <nl> worldserver . func _ 73041 _ k ( ) ; <nl> } <nl> } <nl> - @ @ - 1414 , 7 + 1412 , 6 @ @ <nl> + @ @ - 1417 , 7 + 1415 , 6 @ @ <nl> this . field _ 147141 _ M = p _ 155759 _ 1 _ ; <nl> } <nl>

TEST DIFF:
diff - - git a / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch b / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch 
 index ea7e488 . . 35a1f9c 100644 
 - - - a / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch 
 + + + b / patches / minecraft / net / minecraft / client / renderer / EntityRenderer . java . patch 
 @ @ - 1 , 6 + 1 , 14 @ @ 
 - - - . . / src - base / minecraft / net / minecraft / client / renderer / EntityRenderer . java 
 + + + . . / src - work / minecraft / net / minecraft / client / renderer / EntityRenderer . java 
 - @ @ - 419 , 7 + 419 , 7 @ @ 
 + @ @ - 200 , 6 + 200 , 7 @ @ 
 + { 
 + this . func _ 175069 _ a ( new ResourceLocation ( " shaders / post / invert . json " ) ) ; 
 + } 
 + + else net . minecraftforge . client . ForgeHooksClient . loadEntityShader ( p _ 175066 _ 1 _ . getClass ( ) , this ) ; 
 + } 
 + } 
 + 
 + @ @ - 419 , 7 + 420 , 7 @ @ 
 
 if ( d3 < d2 | | d2 = = 0 . 0D ) 
 { 
 @ @ - 9 , 7 + 17 , 7 @ @ 
 { 
 if ( d2 = = 0 . 0D ) 
 { 
 - @ @ - 576 , 14 + 576 , 8 @ @ 
 + @ @ - 576 , 14 + 577 , 8 @ @ 
 { 
 BlockPos blockpos = new BlockPos ( entity ) ; 
 IBlockState iblockstate = this . field _ 78531 _ r . field _ 71441 _ e . func _ 180495 _ p ( blockpos ) ; 
 @ @ - 25 , 7 + 33 , 7 @ @ 
 GlStateManager . func _ 179114 _ b ( entity . field _ 70126 _ B + ( entity . field _ 70177 _ z - entity . field _ 70126 _ B ) * p _ 78467 _ 1 _ + 180 . 0F , 0 . 0F , - 1 . 0F , 0 . 0F ) ; 
 GlStateManager . func _ 179114 _ b ( entity . field _ 70127 _ C + ( entity . field _ 70125 _ A - entity . field _ 70127 _ C ) * p _ 78467 _ 1 _ , - 1 . 0F , 0 . 0F , 0 . 0F ) ; 
 } 
 - @ @ - 650 , 17 + 644 , 20 @ @ 
 + @ @ - 650 , 17 + 645 , 20 @ @ 
 
 if ( ! this . field _ 78531 _ r . field _ 71474 _ y . field _ 74325 _ U ) 
 { 
 @ @ - 53 , 7 + 61 , 7 @ @ 
 } 
 
 GlStateManager . func _ 179109 _ b ( 0 . 0F , - f , 0 . 0F ) ; 
 - @ @ - 1103 , 7 + 1100 , 7 @ @ 
 + @ @ - 1103 , 7 + 1101 , 7 @ @ 
 
 try 
 { 
 @ @ - 62 , 7 + 70 , 7 @ @ 
 } 
 catch ( Throwable throwable ) 
 { 
 - @ @ - 1164 , 7 + 1161 , 7 @ @ 
 + @ @ - 1164 , 7 + 1162 , 7 @ @ 
 
 if ( this . field _ 78531 _ r . field _ 71442 _ b . func _ 178889 _ l ( ) = = WorldSettings . GameType . SPECTATOR ) 
 { 
 @ @ - 71 , 7 + 79 , 7 @ @ 
 } 
 else 
 { 
 - @ @ - 1314 , 7 + 1311 , 9 @ @ 
 + @ @ - 1314 , 7 + 1312 , 9 @ @ 
 GlStateManager . func _ 179094 _ E ( ) ; 
 RenderHelper . func _ 74519 _ b ( ) ; 
 this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " entities " ) ; 
 @ @ - 81 , 7 + 89 , 7 @ @ 
 RenderHelper . func _ 74518 _ a ( ) ; 
 this . func _ 175072 _ h ( ) ; 
 GlStateManager . func _ 179128 _ n ( 5888 ) ; 
 - @ @ - 1326 , 6 + 1325 , 7 @ @ 
 + @ @ - 1326 , 6 + 1326 , 7 @ @ 
 EntityPlayer entityplayer = ( EntityPlayer ) entity ; 
 GlStateManager . func _ 179118 _ c ( ) ; 
 this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " outline " ) ; 
 @ @ - 89 , 7 + 97 , 7 @ @ 
 renderglobal . func _ 72731 _ b ( entityplayer , this . field _ 78531 _ r . field _ 71476 _ x , 0 , p _ 175068 _ 2 _ ) ; 
 GlStateManager . func _ 179141 _ d ( ) ; 
 } 
 - @ @ - 1339 , 6 + 1339 , 7 @ @ 
 + @ @ - 1339 , 6 + 1340 , 7 @ @ 
 EntityPlayer entityplayer1 = ( EntityPlayer ) entity ; 
 GlStateManager . func _ 179118 _ c ( ) ; 
 this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " outline " ) ; 
 @ @ - 97 , 7 + 105 , 7 @ @ 
 renderglobal . func _ 72731 _ b ( entityplayer1 , this . field _ 78531 _ r . field _ 71476 _ x , 0 , p _ 175068 _ 2 _ ) ; 
 GlStateManager . func _ 179141 _ d ( ) ; 
 } 
 - @ @ - 1380 , 6 + 1381 , 15 @ @ 
 + @ @ - 1380 , 6 + 1382 , 15 @ @ 
 GlStateManager . func _ 179103 _ j ( 7425 ) ; 
 this . field _ 78531 _ r . field _ 71424 _ I . func _ 76318 _ c ( " translucent " ) ; 
 renderglobal . func _ 174977 _ a ( EnumWorldBlockLayer . TRANSLUCENT , ( double ) p _ 175068 _ 2 _ , p _ 175068 _ 1 _ , entity ) ; 
 @ @ - 113 , 7 + 121 , 7 @ @ 
 GlStateManager . func _ 179103 _ j ( 7424 ) ; 
 GlStateManager . func _ 179132 _ a ( true ) ; 
 GlStateManager . func _ 179089 _ o ( ) ; 
 - @ @ - 1392 , 8 + 1402 , 12 @ @ 
 + @ @ - 1392 , 8 + 1403 , 12 @ @ 
 this . func _ 180437 _ a ( renderglobal , p _ 175068 _ 2 _ , p _ 175068 _ 1 _ ) ; 
 } 
 
 @ @ - 126 , 7 + 134 , 7 @ @ 
 if ( this . field _ 175074 _ C ) 
 { 
 GlStateManager . func _ 179086 _ m ( 256 ) ; 
 - @ @ - 1505 , 6 + 1519 , 13 @ @ 
 + @ @ - 1505 , 6 + 1520 , 13 @ @ 
 
 protected void func _ 78474 _ d ( float p _ 78474 _ 1 _ ) 
 { 
 @ @ - 140 , 7 + 148 , 7 @ @ 
 float f = this . field _ 78531 _ r . field _ 71441 _ e . func _ 72867 _ j ( p _ 78474 _ 1 _ ) ; 
 
 if ( f > 0 . 0F ) 
 - @ @ - 1830 , 6 + 1851 , 13 @ @ 
 + @ @ - 1830 , 6 + 1852 , 13 @ @ 
 this . field _ 175081 _ S = f7 ; 
 } 
 
 @ @ - 154 , 7 + 162 , 7 @ @ 
 GlStateManager . func _ 179082 _ a ( this . field _ 175080 _ Q , this . field _ 175082 _ R , this . field _ 175081 _ S , 0 . 0F ) ; 
 } 
 
 - @ @ - 1848 , 6 + 1876 , 10 @ @ 
 + @ @ - 1848 , 6 + 1877 , 10 @ @ 
 GlStateManager . func _ 179131 _ c ( 1 . 0F , 1 . 0F , 1 . 0F , 1 . 0F ) ; 
 Block block = ActiveRenderInfo . func _ 180786 _ a ( this . field _ 78531 _ r . field _ 71441 _ e , entity , p _ 78468 _ 2 _ ) ; 
 
 @ @ - 165 , 7 + 173 , 7 @ @ 
 if ( entity instanceof EntityLivingBase & & ( ( EntityLivingBase ) entity ) . func _ 70644 _ a ( Potion . field _ 76440 _ q ) ) 
 { 
 float f1 = 5 . 0F ; 
 - @ @ - 1925 , 6 + 1957 , 7 @ @ 
 + @ @ - 1925 , 6 + 1958 , 7 @ @ 
 GlStateManager . func _ 179102 _ b ( f * 0 . 05F ) ; 
 GlStateManager . func _ 179153 _ c ( Math . min ( f , 192 . 0F ) * 0 . 5F ) ; 
 } 
 diff - - git a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 index a4bcd44 . . 1641e96 100644 
 - - - a / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 + + + b / src / main / java / net / minecraftforge / client / ForgeHooksClient . java 
 @ @ - 51 , 12 + 51 , 7 @ @ import net . minecraft . entity . player . EntityPlayer ; 
 import net . minecraft . item . Item ; 
 import net . minecraft . item . ItemStack ; 
 import net . minecraft . tileentity . TileEntity ; 
 - import net . minecraft . util . BlockPos ; 
 - import net . minecraft . util . EnumChatFormatting ; 
 - import net . minecraft . util . EnumFacing ; 
 - import net . minecraft . util . EnumWorldBlockLayer ; 
 - import net . minecraft . util . IRegistry ; 
 - import net . minecraft . util . MovingObjectPosition ; 
 + import net . minecraft . util . * ; 
 import net . minecraft . world . IBlockAccess ; 
 import net . minecraft . world . World ; 
 import net . minecraft . world . biome . BiomeGenBase ; 
 @ @ - 80 , 6 + 75 , 7 @ @ import net . minecraftforge . common . ForgeVersion ; 
 import net . minecraftforge . common . ForgeVersion . Status ; 
 import net . minecraftforge . common . MinecraftForge ; 
 import net . minecraftforge . fml . client . FMLClientHandler ; 
 + import net . minecraftforge . fml . client . registry . ClientRegistry ; 
 import net . minecraftforge . fml . common . FMLLog ; 
 
 import org . apache . commons . lang3 . tuple . Pair ; 
 @ @ - 578 , 4 + 574 , 13 @ @ public class ForgeHooksClient 
 if ( part . isPresent ( ) ) return Optional . absent ( ) ; 
 return Optional . of ( new TRSRTransformation ( matrix ) ) ; 
 } 
 + 
 + public static void loadEntityShader ( Class < ? extends Entity > entityClass , EntityRenderer entityRenderer ) 
 + { 
 + ResourceLocation shader = ClientRegistry . getEntityShader ( entityClass ) ; 
 + if ( shader ! = null ) 
 + { 
 + entityRenderer . loadShader ( shader ) ; 
 + } 
 + } 
 } 
 diff - - git a / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java b / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java 
 index 205837e . . 94490d3 100644 
 - - - a / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java 
 + + + b / src / main / java / net / minecraftforge / fml / client / registry / ClientRegistry . java 
 @ @ - 12 , 6 + 12 , 9 @ @ 
 
 package net . minecraftforge . fml . client . registry ; 
 
 + import com . google . common . collect . Maps ; 
 + import net . minecraft . entity . Entity ; 
 + import net . minecraft . util . ResourceLocation ; 
 import org . apache . commons . lang3 . ArrayUtils ; 
 
 import net . minecraft . client . Minecraft ; 
 @ @ - 21 , 8 + 24 , 12 @ @ import net . minecraft . client . settings . KeyBinding ; 
 import net . minecraft . tileentity . TileEntity ; 
 import net . minecraftforge . fml . common . registry . GameRegistry ; 
 
 + import java . util . Map ; 
 + 
 public class ClientRegistry 
 { 
 + private static Map < Class < ? extends Entity > , ResourceLocation > entityShaderMap = Maps . newHashMap ( ) ; 
 + 
 / * * 
 * 
 * Utility method for registering a tile entity and it ' s renderer at once - generally you should register them separately 
 @ @ - 47 , 4 + 54 , 21 @ @ public class ClientRegistry 
 { 
 Minecraft . getMinecraft ( ) . gameSettings . keyBindings = ArrayUtils . add ( Minecraft . getMinecraft ( ) . gameSettings . keyBindings , key ) ; 
 } 
 + 
 + / * * 
 + * Register a shader for an entity . This shader gets activated when a spectator begins spectating an entity . 
 + * Vanilla examples of this are the green effect for creepers and the invert effect for endermans . 
 + * 
 + * @ param entityClass 
 + * @ param shader 
 + * / 
 + public static void registerEntityShader ( Class < ? extends Entity > entityClass , ResourceLocation shader ) 
 + { 
 + entityShaderMap . put ( entityClass , shader ) ; 
 + } 
 + 
 + public static ResourceLocation getEntityShader ( Class < ? extends Entity > entityClass ) 
 + { 
 + return entityShaderMap . get ( entityClass ) ; 
 + } 
 } 
 diff - - git a / src / main / resources / forge _ at . cfg b / src / main / resources / forge _ at . cfg 
 index 29b45a6 . . f53e403 100644 
 - - - a / src / main / resources / forge _ at . cfg 
 + + + b / src / main / resources / forge _ at . cfg 
 @ @ - 164 , 6 + 164 , 8 @ @ public net . minecraft . entity . EntityList field _ 75623 _ d # idToClassMap 
 public net . minecraft . client . renderer . entity . RenderManager field _ 78729 _ o # renderers 
 # # TileEntityRendererDispatcher 
 public net . minecraft . client . renderer . tileentity . TileEntityRendererDispatcher field _ 147559 _ m 
 + # # EntityRenderer 
 + public net . minecraft . client . renderer . EntityRenderer func _ 175069 _ a ( Lnet / minecraft / util / ResourceLocation ; ) V # loadShader 
 # # WeightedRandomItem 
 public net . minecraft . util . WeightedRandom $ Item field _ 76292 _ a # probability 
 # # EntityPlayerMP getNextWindowId

NEAREST DIFF:
diff - - git a / patches / minecraft / net / minecraft / client / Minecraft . java . patch b / patches / minecraft / net / minecraft / client / Minecraft . java . patch 
 index b69cba7 . . b1c023d 100644 
 - - - a / patches / minecraft / net / minecraft / client / Minecraft . java . patch 
 + + + b / patches / minecraft / net / minecraft / client / Minecraft . java . patch 
 @ @ - 1 , 6 + 1 , 6 @ @ 
 - - - . . / src - base / minecraft / net / minecraft / client / Minecraft . java 
 + + + . . / src - work / minecraft / net / minecraft / client / Minecraft . java 
 - @ @ - 134 , 6 + 134 , 14 @ @ 
 + @ @ - 135 , 6 + 135 , 14 @ @ 
 import net . minecraft . world . storage . ISaveFormat ; 
 import net . minecraft . world . storage . ISaveHandler ; 
 import net . minecraft . world . storage . WorldInfo ; 
 @ @ - 15 , 7 + 15 , 7 @ @ 
 import org . apache . logging . log4j . LogManager ; 
 import org . apache . logging . log4j . Logger ; 
 import org . lwjgl . LWJGLException ; 
 - @ @ - 245 , 7 + 253 , 7 @ @ 
 + @ @ - 246 , 7 + 254 , 7 @ @ 
 this . func _ 71389 _ H ( ) ; 
 this . field _ 71449 _ j = p _ i1014 _ 1 _ ; 
 field _ 147123 _ G . info ( " Setting user : " + p _ i1014 _ 1 _ . func _ 111285 _ a ( ) ) ; 
 @ @ - 24 , 7 + 24 , 7 @ @ 
 this . field _ 71459 _ aj = p _ i1014 _ 5 _ ; 
 this . field _ 71443 _ c = p _ i1014 _ 2 _ ; 
 this . field _ 71440 _ d = p _ i1014 _ 3 _ ; 
 - @ @ - 419 , 7 + 427 , 7 @ @ 
 + @ @ - 417 , 7 + 425 , 7 @ @ 
 
 try 
 { 
 @ @ - 33 , 7 + 33 , 7 @ @ 
 } 
 catch ( LWJGLException lwjglexception ) 
 { 
 - @ @ - 518 , 7 + 526 , 7 @ @ 
 + @ @ - 516 , 7 + 524 , 7 @ @ 
 this . field _ 71452 _ i = new EffectRenderer ( this . field _ 71441 _ e , this . field _ 71446 _ o ) ; 
 FMLClientHandler . instance ( ) . finishMinecraftLoading ( ) ; 
 this . func _ 71361 _ d ( " Post startup " ) ; 
 @ @ - 42 , 7 + 42 , 7 @ @ 
 
 if ( this . field _ 71475 _ ae ! = null ) 
 { 
 - @ @ - 701 , 11 + 709 , 6 @ @ 
 + @ @ - 699 , 11 + 707 , 6 @ @ 
 
 public void func _ 147108 _ a ( GuiScreen p _ 147108 _ 1 _ ) 
 { 
 @ @ - 54 , 7 + 54 , 7 @ @ 
 if ( p _ 147108 _ 1 _ = = null & & this . field _ 71441 _ e = = null ) 
 { 
 p _ 147108 _ 1 _ = new GuiMainMenu ( ) ; 
 - @ @ - 715 , 6 + 718 , 17 @ @ 
 + @ @ - 713 , 6 + 716 , 17 @ @ 
 p _ 147108 _ 1 _ = new GuiGameOver ( ) ; 
 } 
 
 @ @ - 72 , 7 + 72 , 7 @ @ 
 if ( p _ 147108 _ 1 _ instanceof GuiMainMenu ) 
 { 
 this . field _ 71474 _ y . field _ 74330 _ P = false ; 
 - @ @ - 1297 , 7 + 1311 , 7 @ @ 
 + @ @ - 1295 , 7 + 1309 , 7 @ @ 
 
 if ( this . field _ 71439 _ g . func _ 82246 _ f ( i , j , k ) ) 
 { 
 @ @ - 81 , 7 + 81 , 7 @ @ 
 this . field _ 71439 _ g . func _ 71038 _ i ( ) ; 
 } 
 } 
 - @ @ - 1378 , 11 + 1392 , 12 @ @ 
 + @ @ - 1376 , 11 + 1390 , 12 @ @ 
 int j = this . field _ 71476 _ x . field _ 72312 _ c ; 
 int k = this . field _ 71476 _ x . field _ 72309 _ d ; 
 
 @ @ - 96 , 7 + 96 , 7 @ @ 
 { 
 flag = false ; 
 this . field _ 71439 _ g . func _ 71038 _ i ( ) ; 
 - @ @ - 1409 , 7 + 1424 , 8 @ @ 
 + @ @ - 1407 , 7 + 1422 , 8 @ @ 
 { 
 ItemStack itemstack1 = this . field _ 71439 _ g . field _ 71071 _ by . func _ 70448 _ g ( ) ; 
 
 @ @ - 106 , 7 + 106 , 7 @ @ 
 { 
 this . field _ 71460 _ t . field _ 78516 _ c . func _ 78445 _ c ( ) ; 
 } 
 - @ @ - 1608 , 6 + 1624 , 8 @ @ 
 + @ @ - 1606 , 6 + 1622 , 8 @ @ 
 
 while ( Mouse . next ( ) ) 
 { 
 @ @ - 115 , 7 + 115 , 7 @ @ 
 i = Mouse . getEventButton ( ) ; 
 
 if ( field _ 142025 _ a & & i = = 0 & & ( Keyboard . isKeyDown ( 29 ) | | Keyboard . isKeyDown ( 157 ) ) ) 
 - @ @ - 2075 , 6 + 2093 , 11 @ @ 
 + @ @ - 2079 , 6 + 2097 , 11 @ @ 
 
 public void func _ 71353 _ a ( WorldClient p _ 71353 _ 1 _ , String p _ 71353 _ 2 _ ) 
 { 
 @ @ - 127 , 7 + 127 , 7 @ @ 
 if ( p _ 71353 _ 1 _ = = null ) 
 { 
 NetHandlerPlayClient nethandlerplayclient = this . func _ 147114 _ u ( ) ; 
 - @ @ - 2087 , 6 + 2110 , 18 @ @ 
 + @ @ - 2091 , 6 + 2114 , 18 @ @ 
 if ( this . field _ 71437 _ Z ! = null ) 
 { 
 this . field _ 71437 _ Z . func _ 71263 _ m ( ) ; 
 @ @ - 146 , 7 + 146 , 7 @ @ 
 } 
 
 this . field _ 71437 _ Z = null ; 
 - @ @ - 2235 , 113 + 2270 , 10 @ @ 
 + @ @ - 2239 , 113 + 2274 , 10 @ @ 
 if ( this . field _ 71476 _ x ! = null ) 
 { 
 boolean flag = this . field _ 71439 _ g . field _ 71075 _ bZ . field _ 75098 _ d ; 
 @ @ - 262 , 7 + 262 , 7 @ @ 
 if ( flag ) 
 { 
 j = this . field _ 71439 _ g . field _ 71069 _ bz . field _ 75151 _ b . size ( ) - 9 + this . field _ 71439 _ g . field _ 71071 _ by . field _ 70461 _ c ; 
 - @ @ - 2508 , 8 + 2440 , 15 @ @ 
 + @ @ - 2512 , 8 + 2444 , 15 @ @ 
 p _ 70001 _ 1 _ . func _ 76472 _ a ( " gl _ max _ texture _ size " , Integer . valueOf ( func _ 71369 _ N ( ) ) ) ; 
 } 
 
 @ @ - 278 , 7 + 278 , 7 @ @ 
 for ( int i = 16384 ; i > 0 ; i > > = 1 ) 
 { 
 GL11 . glTexImage2D ( GL11 . GL _ PROXY _ TEXTURE _ 2D , 0 , GL11 . GL _ RGBA , i , i , 0 , GL11 . GL _ RGBA , GL11 . GL _ UNSIGNED _ BYTE , ( ByteBuffer ) null ) ; 
 - @ @ - 2517 , 6 + 2456 , 7 @ @ 
 + @ @ - 2521 , 6 + 2460 , 7 @ @ 
 
 if ( j ! = 0 ) 
 { 
 diff - - git a / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch b / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch 
 index a17617b . . bf256e0 100644 
 - - - a / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch 
 + + + b / patches / minecraft / net / minecraft / client / shader / Framebuffer . java . patch 
 @ @ - 1 , 21 + 1 , 29 @ @ 
 - - - . . / src - base / minecraft / net / minecraft / client / shader / Framebuffer . java 
 + + + . . / src - work / minecraft / net / minecraft / client / shader / Framebuffer . java 
 - @ @ - 6 , 6 + 6 , 7 @ @ 
 + @ @ - 6 , 6 + 6 , 9 @ @ 
 import net . minecraft . client . renderer . OpenGlHelper ; 
 import net . minecraft . client . renderer . Tessellator ; 
 import net . minecraft . client . renderer . texture . TextureUtil ; 
 + import net . minecraftforge . client . MinecraftForgeClient ; 
 + + import static org . lwjgl . opengl . EXTPackedDepthStencil . * ; 
 + + import static org . lwjgl . opengl . EXTFramebufferObject . * ; 
 import org . lwjgl . opengl . EXTFramebufferObject ; 
 import org . lwjgl . opengl . GL11 ; 
 
 - @ @ - 120 , 6 + 121 , 11 @ @ 
 + @ @ - 118 , 8 + 121 , 17 @ @ 
 + if ( this . field _ 147619 _ e ) 
 + { 
 EXTFramebufferObject . glBindRenderbufferEXT ( 36161 , this . field _ 147624 _ h ) ; 
 + + if ( MinecraftForgeClient . getStencilBits ( ) = = 0 ) 
 + + { 
 EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , 33190 , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; 
 EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , 36096 , 36161 , this . field _ 147624 _ h ) ; 
 - + if ( MinecraftForgeClient . getStencilBits ( ) > 0 ) 
 + + } 
 + + else 
 + { 
 - + EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , EXTFramebufferObject . GL _ STENCIL _ INDEX8 _ EXT , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; 
 - + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , EXTFramebufferObject . GL _ STENCIL _ ATTACHMENT _ EXT , 36161 , this . field _ 147624 _ h ) ; 
 + + EXTFramebufferObject . glRenderbufferStorageEXT ( 36161 , GL _ DEPTH24 _ STENCIL8 _ EXT , this . field _ 147622 _ a , this . field _ 147620 _ b ) ; 
 + + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , GL _ DEPTH _ ATTACHMENT _ EXT , GL _ RENDERBUFFER _ EXT , this . field _ 147624 _ h ) ; 
 + + EXTFramebufferObject . glFramebufferRenderbufferEXT ( 36160 , GL _ STENCIL _ ATTACHMENT _ EXT , GL _ RENDERBUFFER _ EXT , this . field _ 147624 _ h ) ; 
 + } 
 } 
 
 diff - - git a / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch b / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch 
 index 3082905 . . fafd4c8 100644 
 - - - a / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch 
 + + + b / patches / minecraft / net / minecraft / server / MinecraftServer . java . patch 
 @ @ - 1 , 6 + 1 , 6 @ @ 
 - - - . . / src - base / minecraft / net / minecraft / server / MinecraftServer . java 
 + + + . . / src - work / minecraft / net / minecraft / server / MinecraftServer . java 
 - @ @ - 25 , 6 + 25 , 7 @ @ 
 + @ @ - 26 , 6 + 26 , 7 @ @ 
 import java . util . Arrays ; 
 import java . util . Collections ; 
 import java . util . Date ; 
 @ @ - 8 , 7 + 8 , 7 @ @ 
 import java . util . Iterator ; 
 import java . util . List ; 
 import java . util . Random ; 
 - @ @ - 73 , 6 + 74 , 10 @ @ 
 + @ @ - 74 , 6 + 75 , 10 @ @ 
 import org . apache . logging . log4j . LogManager ; 
 import org . apache . logging . log4j . Logger ; 
 
 @ @ - 19 , 7 + 19 , 7 @ @ 
 public abstract class MinecraftServer implements ICommandSender , Runnable , IPlayerUsage 
 { 
 private static final Logger field _ 147145 _ h = LogManager . getLogger ( ) ; 
 - @ @ - 89 , 7 + 94 , 7 @ @ 
 + @ @ - 90 , 7 + 95 , 7 @ @ 
 @ SideOnly ( Side . SERVER ) 
 private String field _ 71320 _ r ; 
 private int field _ 71319 _ s = - 1 ; 
 @ @ - 28 , 7 + 28 , 7 @ @ 
 private ServerConfigurationManager field _ 71318 _ t ; 
 private boolean field _ 71317 _ u = true ; 
 private boolean field _ 71316 _ v ; 
 - @ @ - 106 , 7 + 111 , 8 @ @ 
 + @ @ - 107 , 7 + 112 , 8 @ @ 
 private int field _ 71280 _ D ; 
 private int field _ 143008 _ E = 0 ; 
 public final long [ ] field _ 71311 _ j = new long [ 100 ] ; 
 @ @ - 38 , 7 + 38 , 7 @ @ 
 private KeyPair field _ 71292 _ I ; 
 private String field _ 71293 _ J ; 
 private String field _ 71294 _ K ; 
 - @ @ - 182 , 8 + 188 , 6 @ @ 
 + @ @ - 183 , 8 + 189 , 6 @ @ 
 { 
 this . func _ 71237 _ c ( p _ 71247 _ 1 _ ) ; 
 this . func _ 71192 _ d ( " menu . loadingLevel " ) ; 
 @ @ - 47 , 7 + 47 , 7 @ @ 
 ISaveHandler isavehandler = this . field _ 71310 _ m . func _ 75804 _ a ( p _ 71247 _ 1 _ , true ) ; 
 WorldInfo worldinfo = isavehandler . func _ 75757 _ d ( ) ; 
 WorldSettings worldsettings ; 
 - @ @ - 203 , 46 + 207 , 21 @ @ 
 + @ @ - 204 , 46 + 208 , 21 @ @ 
 worldsettings . func _ 77159 _ a ( ) ; 
 } 
 
 @ @ - 101 , 7 + 101 , 7 @ @ 
 this . func _ 147139 _ a ( this . func _ 147135 _ j ( ) ) ; 
 this . func _ 71222 _ d ( ) ; 
 } 
 - @ @ - 309 , 6 + 288 , 7 @ @ 
 + @ @ - 310 , 6 + 289 , 7 @ @ 
 if ( ! this . field _ 71290 _ O ) 
 { 
 WorldServer [ ] aworldserver = this . field _ 71305 _ c ; 
 @ @ - 109 , 7 + 109 , 7 @ @ 
 int i = aworldserver . length ; 
 
 for ( int j = 0 ; j < i ; + + j ) 
 - @ @ - 359 , 9 + 339 , 16 @ @ 
 + @ @ - 360 , 9 + 340 , 16 @ @ 
 for ( int i = 0 ; i < this . field _ 71305 _ c . length ; + + i ) 
 { 
 WorldServer worldserver = this . field _ 71305 _ c [ i ] ; 
 @ @ - 126 , 7 + 126 , 7 @ @ 
 if ( this . field _ 71307 _ n . func _ 76468 _ d ( ) ) 
 { 
 this . field _ 71307 _ n . func _ 76470 _ e ( ) ; 
 - @ @ - 586 , 13 + 573 , 15 @ @ 
 + @ @ - 588 , 13 + 575 , 15 @ @ 
 this . field _ 71304 _ b . func _ 76320 _ a ( " levels " ) ; 
 int i ; 
 
 @ @ - 145 , 7 + 145 , 7 @ @ 
 this . field _ 71304 _ b . func _ 76320 _ a ( worldserver . func _ 72912 _ H ( ) . func _ 76065 _ j ( ) ) ; 
 this . field _ 71304 _ b . func _ 76320 _ a ( " pools " ) ; 
 worldserver . func _ 82732 _ R ( ) . func _ 72343 _ a ( ) ; 
 - @ @ - 639 , 9 + 628 , 11 @ @ 
 + @ @ - 641 , 9 + 630 , 11 @ @ 
 this . field _ 71304 _ b . func _ 76319 _ b ( ) ; 
 } 
 
 @ @ - 158 , 7 + 158 , 7 @ @ 
 this . field _ 71304 _ b . func _ 76318 _ c ( " connection " ) ; 
 this . func _ 147137 _ ag ( ) . func _ 151269 _ c ( ) ; 
 this . field _ 71304 _ b . func _ 76318 _ c ( " players " ) ; 
 - @ @ - 685 , 7 + 676 , 13 @ @ 
 + @ @ - 688 , 7 + 679 , 13 @ @ 
 
 public WorldServer func _ 71218 _ a ( int p _ 71218 _ 1 _ ) 
 { 
 @ @ - 173 , 7 + 173 , 7 @ @ 
 } 
 
 public String func _ 71249 _ w ( ) 
 - @ @ - 944 , 6 + 941 , 7 @ @ 
 + @ @ - 947 , 6 + 944 , 7 @ @ 
 
 if ( worldserver ! = null ) 
 { 
 @ @ - 181 , 7 + 181 , 7 @ @ 
 worldserver . func _ 73041 _ k ( ) ; 
 } 
 } 
 - @ @ - 1414 , 7 + 1412 , 6 @ @ 
 + @ @ - 1417 , 7 + 1415 , 6 @ @ 
 this . field _ 147141 _ M = p _ 155759 _ 1 _ ; 
 } 

