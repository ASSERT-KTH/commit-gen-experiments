BLEU SCORE: 0.015061893230938676

TEST MSG: Added check for quad builder to always have the particle texture set , and fixed where that wasn ' t true . Fixes # 3653
GENERATED MSG: Fixed forge lighting working incorrectly outside 0x1000000 coordinates .

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java b / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java <nl> index 31e2c2d . . ca7a2e2 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java <nl> @ @ - 71 , 6 + 71 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { <nl> float ht = h / 128f ; <nl> <nl> UnpackedBakedQuad . Builder quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; <nl> + quadBuilder . setTexture ( sprite ) ; <nl> quadBuilder . setQuadOrientation ( orientation ) ; <nl> <nl> addVertex ( quadBuilder , posX + sh , posY , x , y ) ; <nl> @ @ - 84 , 6 + 85 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { <nl> float cuv = 15f / 16f ; <nl> <nl> quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; <nl> + quadBuilder . setTexture ( sprite ) ; <nl> quadBuilder . setQuadOrientation ( orientation ) ; <nl> <nl> addVertex ( quadBuilder , posX + w + sh , posY , cuv , cuv ) ; <nl> @ @ - 93 , 6 + 95 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { <nl> builder . add ( quadBuilder . build ( ) ) ; <nl> <nl> quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; <nl> + quadBuilder . setTexture ( sprite ) ; <nl> quadBuilder . setQuadOrientation ( orientation ) ; <nl> <nl> addVertex ( quadBuilder , posX + sh , posY + h , cuv , cuv ) ; <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java b / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java <nl> index dfd3a58 . . 6999c45 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java <nl> @ @ - 124 , 6 + 124 , 7 @ @ public class UnpackedBakedQuad extends BakedQuad <nl> this . orientation = orientation ; <nl> } <nl> <nl> + / / FIXME : move ( or at least add ) into constructor <nl> public void setTexture ( TextureAtlasSprite texture ) <nl> { <nl> this . texture = texture ; <nl> @ @ - 167 , 6 + 168 , 10 @ @ public class UnpackedBakedQuad extends BakedQuad <nl> { <nl> throw new IllegalStateException ( " not enough data " ) ; <nl> } <nl> + if ( texture = = null ) <nl> + { <nl> + throw new IllegalStateException ( " texture not set " ) ; <nl> + } <nl> if ( contractUVs ) <nl> { <nl> float tX = texture . getOriginX ( ) / texture . getMinU ( ) ;
NEAREST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java b / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java <nl> index 7c8e638 . . f7c7cf1 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java <nl> @ @ - 22 , 6 + 22 , 7 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer <nl> return new VertexLighterFlat ( ) ; <nl> } <nl> } ; <nl> + <nl> private final ThreadLocal < VertexLighterSmoothAo > lighterSmooth = new ThreadLocal < VertexLighterSmoothAo > ( ) <nl> { <nl> @ Override <nl> @ @ - 31 , 6 + 32 , 8 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer <nl> } <nl> } ; <nl> <nl> + private final ThreadLocal < WorldRendererConsumer > wrFlat = new ThreadLocal < WorldRendererConsumer > ( ) ; <nl> + private final ThreadLocal < WorldRendererConsumer > wrSmooth = new ThreadLocal < WorldRendererConsumer > ( ) ; <nl> private final ThreadLocal < WorldRenderer > lastRendererFlat = new ThreadLocal < WorldRenderer > ( ) ; <nl> private final ThreadLocal < WorldRenderer > lastRendererSmooth = new ThreadLocal < WorldRenderer > ( ) ; <nl> <nl> @ @ - 42 , 8 + 45 , 11 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer <nl> if ( wr ! = lastRendererFlat . get ( ) ) <nl> { <nl> lastRendererFlat . set ( wr ) ; <nl> - lighterFlat . get ( ) . setParent ( new WorldRendererConsumer ( wr ) ) ; <nl> + WorldRendererConsumer newCons = new WorldRendererConsumer ( wr ) ; <nl> + wrFlat . set ( newCons ) ; <nl> + lighterFlat . get ( ) . setParent ( newCons ) ; <nl> } <nl> + wrFlat . get ( ) . setOffset ( pos ) ; <nl> return render ( lighterFlat . get ( ) , world , model , block , pos , wr , checkSides ) ; <nl> } <nl> else <nl> @ @ - 60 , 8 + 66 , 11 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer <nl> if ( wr ! = lastRendererSmooth . get ( ) ) <nl> { <nl> lastRendererSmooth . set ( wr ) ; <nl> - lighterSmooth . get ( ) . setParent ( new WorldRendererConsumer ( wr ) ) ; <nl> + WorldRendererConsumer newCons = new WorldRendererConsumer ( wr ) ; <nl> + wrSmooth . set ( newCons ) ; <nl> + lighterSmooth . get ( ) . setParent ( newCons ) ; <nl> } <nl> + wrSmooth . get ( ) . setOffset ( pos ) ; <nl> return render ( lighterSmooth . get ( ) , world , model , block , pos , wr , checkSides ) ; <nl> } <nl> else <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java b / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java <nl> index 72d005a . . 954215f 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java <nl> @ @ - 144 , 12 + 144 , 13 @ @ public class VertexLighterFlat extends QuadGatheringTransformer <nl> switch ( parent . getVertexFormat ( ) . getElement ( e ) . getUsage ( ) ) <nl> { <nl> case POSITION : <nl> - float [ ] pos = new float [ 4 ] ; <nl> + / / position adding moved to WorldRendererConsumer due to x and z not fitting completely into a float <nl> + / * float [ ] pos = new float [ 4 ] ; <nl> System . arraycopy ( position [ v ] , 0 , pos , 0 , position [ v ] . length ) ; <nl> pos [ 0 ] + = blockInfo . getBlockPos ( ) . getX ( ) ; <nl> pos [ 1 ] + = blockInfo . getBlockPos ( ) . getY ( ) ; <nl> - pos [ 2 ] + = blockInfo . getBlockPos ( ) . getZ ( ) ; <nl> - parent . put ( e , pos ) ; <nl> + pos [ 2 ] + = blockInfo . getBlockPos ( ) . getZ ( ) ; * / <nl> + parent . put ( e , position [ v ] ) ; <nl> break ; <nl> case NORMAL : if ( normalIndex ! = - 1 ) <nl> { <nl> diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java b / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java <nl> index 2e9ee09 . . fea7dff 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java <nl> @ @ - 4 , 6 + 4 , 7 @ @ import java . util . Arrays ; <nl> <nl> import net . minecraft . client . renderer . WorldRenderer ; <nl> import net . minecraft . client . renderer . vertex . VertexFormat ; <nl> + import net . minecraft . util . BlockPos ; <nl> import net . minecraft . util . EnumFacing ; <nl> <nl> / * * <nl> @ @ - 14 , 6 + 15 , 7 @ @ public class WorldRendererConsumer implements IVertexConsumer <nl> private final WorldRenderer renderer ; <nl> private final int [ ] quadData ; <nl> private int v = 0 ; <nl> + private BlockPos offset = BlockPos . ORIGIN ; <nl> <nl> public WorldRendererConsumer ( WorldRenderer renderer ) <nl> { <nl> @ @ - 36 , 13 + 38 , 18 @ @ public class WorldRendererConsumer implements IVertexConsumer <nl> if ( v = = 4 ) <nl> { <nl> renderer . addVertexData ( quadData ) ; <nl> - renderer . putPosition ( 0 , 0 , 0 ) ; <nl> + renderer . putPosition ( offset . getX ( ) , offset . getY ( ) , offset . getZ ( ) ) ; <nl> Arrays . fill ( quadData , 0 ) ; <nl> v = 0 ; <nl> } <nl> } <nl> } <nl> <nl> + public void setOffset ( BlockPos offset ) <nl> + { <nl> + this . offset = new BlockPos ( offset ) ; <nl> + } <nl> + <nl> public void setQuadTint ( int tint ) { } <nl> public void setQuadOrientation ( EnumFacing orientation ) { } <nl> public void setQuadColored ( ) { }

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java b / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java 
 index 31e2c2d . . ca7a2e2 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java 
 + + + b / src / main / java / net / minecraftforge / client / model / SimpleModelFontRenderer . java 
 @ @ - 71 , 6 + 71 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { 
 float ht = h / 128f ; 
 
 UnpackedBakedQuad . Builder quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; 
 + quadBuilder . setTexture ( sprite ) ; 
 quadBuilder . setQuadOrientation ( orientation ) ; 
 
 addVertex ( quadBuilder , posX + sh , posY , x , y ) ; 
 @ @ - 84 , 6 + 85 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { 
 float cuv = 15f / 16f ; 
 
 quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; 
 + quadBuilder . setTexture ( sprite ) ; 
 quadBuilder . setQuadOrientation ( orientation ) ; 
 
 addVertex ( quadBuilder , posX + w + sh , posY , cuv , cuv ) ; 
 @ @ - 93 , 6 + 95 , 7 @ @ public abstract class SimpleModelFontRenderer extends FontRenderer { 
 builder . add ( quadBuilder . build ( ) ) ; 
 
 quadBuilder = new UnpackedBakedQuad . Builder ( format ) ; 
 + quadBuilder . setTexture ( sprite ) ; 
 quadBuilder . setQuadOrientation ( orientation ) ; 
 
 addVertex ( quadBuilder , posX + sh , posY + h , cuv , cuv ) ; 
 diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java b / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java 
 index dfd3a58 . . 6999c45 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java 
 + + + b / src / main / java / net / minecraftforge / client / model / pipeline / UnpackedBakedQuad . java 
 @ @ - 124 , 6 + 124 , 7 @ @ public class UnpackedBakedQuad extends BakedQuad 
 this . orientation = orientation ; 
 } 
 
 + / / FIXME : move ( or at least add ) into constructor 
 public void setTexture ( TextureAtlasSprite texture ) 
 { 
 this . texture = texture ; 
 @ @ - 167 , 6 + 168 , 10 @ @ public class UnpackedBakedQuad extends BakedQuad 
 { 
 throw new IllegalStateException ( " not enough data " ) ; 
 } 
 + if ( texture = = null ) 
 + { 
 + throw new IllegalStateException ( " texture not set " ) ; 
 + } 
 if ( contractUVs ) 
 { 
 float tX = texture . getOriginX ( ) / texture . getMinU ( ) ;

NEAREST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java b / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java 
 index 7c8e638 . . f7c7cf1 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java 
 + + + b / src / main / java / net / minecraftforge / client / model / pipeline / ForgeBlockModelRenderer . java 
 @ @ - 22 , 6 + 22 , 7 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer 
 return new VertexLighterFlat ( ) ; 
 } 
 } ; 
 + 
 private final ThreadLocal < VertexLighterSmoothAo > lighterSmooth = new ThreadLocal < VertexLighterSmoothAo > ( ) 
 { 
 @ Override 
 @ @ - 31 , 6 + 32 , 8 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer 
 } 
 } ; 
 
 + private final ThreadLocal < WorldRendererConsumer > wrFlat = new ThreadLocal < WorldRendererConsumer > ( ) ; 
 + private final ThreadLocal < WorldRendererConsumer > wrSmooth = new ThreadLocal < WorldRendererConsumer > ( ) ; 
 private final ThreadLocal < WorldRenderer > lastRendererFlat = new ThreadLocal < WorldRenderer > ( ) ; 
 private final ThreadLocal < WorldRenderer > lastRendererSmooth = new ThreadLocal < WorldRenderer > ( ) ; 
 
 @ @ - 42 , 8 + 45 , 11 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer 
 if ( wr ! = lastRendererFlat . get ( ) ) 
 { 
 lastRendererFlat . set ( wr ) ; 
 - lighterFlat . get ( ) . setParent ( new WorldRendererConsumer ( wr ) ) ; 
 + WorldRendererConsumer newCons = new WorldRendererConsumer ( wr ) ; 
 + wrFlat . set ( newCons ) ; 
 + lighterFlat . get ( ) . setParent ( newCons ) ; 
 } 
 + wrFlat . get ( ) . setOffset ( pos ) ; 
 return render ( lighterFlat . get ( ) , world , model , block , pos , wr , checkSides ) ; 
 } 
 else 
 @ @ - 60 , 8 + 66 , 11 @ @ public class ForgeBlockModelRenderer extends BlockModelRenderer 
 if ( wr ! = lastRendererSmooth . get ( ) ) 
 { 
 lastRendererSmooth . set ( wr ) ; 
 - lighterSmooth . get ( ) . setParent ( new WorldRendererConsumer ( wr ) ) ; 
 + WorldRendererConsumer newCons = new WorldRendererConsumer ( wr ) ; 
 + wrSmooth . set ( newCons ) ; 
 + lighterSmooth . get ( ) . setParent ( newCons ) ; 
 } 
 + wrSmooth . get ( ) . setOffset ( pos ) ; 
 return render ( lighterSmooth . get ( ) , world , model , block , pos , wr , checkSides ) ; 
 } 
 else 
 diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java b / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java 
 index 72d005a . . 954215f 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java 
 + + + b / src / main / java / net / minecraftforge / client / model / pipeline / VertexLighterFlat . java 
 @ @ - 144 , 12 + 144 , 13 @ @ public class VertexLighterFlat extends QuadGatheringTransformer 
 switch ( parent . getVertexFormat ( ) . getElement ( e ) . getUsage ( ) ) 
 { 
 case POSITION : 
 - float [ ] pos = new float [ 4 ] ; 
 + / / position adding moved to WorldRendererConsumer due to x and z not fitting completely into a float 
 + / * float [ ] pos = new float [ 4 ] ; 
 System . arraycopy ( position [ v ] , 0 , pos , 0 , position [ v ] . length ) ; 
 pos [ 0 ] + = blockInfo . getBlockPos ( ) . getX ( ) ; 
 pos [ 1 ] + = blockInfo . getBlockPos ( ) . getY ( ) ; 
 - pos [ 2 ] + = blockInfo . getBlockPos ( ) . getZ ( ) ; 
 - parent . put ( e , pos ) ; 
 + pos [ 2 ] + = blockInfo . getBlockPos ( ) . getZ ( ) ; * / 
 + parent . put ( e , position [ v ] ) ; 
 break ; 
 case NORMAL : if ( normalIndex ! = - 1 ) 
 { 
 diff - - git a / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java b / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java 
 index 2e9ee09 . . fea7dff 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java 
 + + + b / src / main / java / net / minecraftforge / client / model / pipeline / WorldRendererConsumer . java 
 @ @ - 4 , 6 + 4 , 7 @ @ import java . util . Arrays ; 
 
 import net . minecraft . client . renderer . WorldRenderer ; 
 import net . minecraft . client . renderer . vertex . VertexFormat ; 
 + import net . minecraft . util . BlockPos ; 
 import net . minecraft . util . EnumFacing ; 
 
 / * * 
 @ @ - 14 , 6 + 15 , 7 @ @ public class WorldRendererConsumer implements IVertexConsumer 
 private final WorldRenderer renderer ; 
 private final int [ ] quadData ; 
 private int v = 0 ; 
 + private BlockPos offset = BlockPos . ORIGIN ; 
 
 public WorldRendererConsumer ( WorldRenderer renderer ) 
 { 
 @ @ - 36 , 13 + 38 , 18 @ @ public class WorldRendererConsumer implements IVertexConsumer 
 if ( v = = 4 ) 
 { 
 renderer . addVertexData ( quadData ) ; 
 - renderer . putPosition ( 0 , 0 , 0 ) ; 
 + renderer . putPosition ( offset . getX ( ) , offset . getY ( ) , offset . getZ ( ) ) ; 
 Arrays . fill ( quadData , 0 ) ; 
 v = 0 ; 
 } 
 } 
 } 
 
 + public void setOffset ( BlockPos offset ) 
 + { 
 + this . offset = new BlockPos ( offset ) ; 
 + } 
 + 
 public void setQuadTint ( int tint ) { } 
 public void setQuadOrientation ( EnumFacing orientation ) { } 
 public void setQuadColored ( ) { }
