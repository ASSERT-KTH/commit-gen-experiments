BLEU SCORE: 0.008010354164744191

TEST MSG: Fixed NPE is B3D loader caused by the missing vertex normal ; updated the example chest model - it ' s now has 2 meshes ; Updated ModelAnimationDebug - it now uses the new chest model , renders the base with the static world renderer , and only the lid with the TESR .
GENERATED MSG: Added Breaking Animation for Smart Models , Checking each layer .

TEST DIFF (one line): diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java <nl> index 60af648 . . 06c2970 100644 <nl> - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java <nl> + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java <nl> @ @ - 636 , 13 + 636 , 19 @ @ public class B3DModel <nl> Vector3f rPos = new Vector3f ( newPos . x / newPos . w , newPos . y / newPos . w , newPos . z / newPos . w ) ; <nl> <nl> / / normal <nl> - Matrix3f tm = new Matrix3f ( ) ; <nl> - t . getRotationScale ( tm ) ; <nl> - tm . invert ( ) ; <nl> - tm . transpose ( ) ; <nl> - Vector3f normal = new Vector3f ( this . normal ) , rNormal = new Vector3f ( ) ; <nl> - tm . transform ( normal , rNormal ) ; <nl> - rNormal . normalize ( ) ; <nl> + Vector3f rNormal = null ; <nl> + <nl> + if ( this . normal ! = null ) <nl> + { <nl> + Matrix3f tm = new Matrix3f ( ) ; <nl> + t . getRotationScale ( tm ) ; <nl> + tm . invert ( ) ; <nl> + tm . transpose ( ) ; <nl> + Vector3f normal = new Vector3f ( this . normal ) ; <nl> + rNormal = new Vector3f ( ) ; <nl> + tm . transform ( normal , rNormal ) ; <nl> + rNormal . normalize ( ) ; <nl> + } <nl> <nl> / / texCoords TODO <nl> return new Vertex ( rPos , rNormal , color , texCoords ) ; <nl> diff - - git a / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java b / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java <nl> index 48b8ec2 . . fbdb0e2 100644 <nl> - - - a / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java <nl> + + + b / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java <nl> @ @ - 4 , 6 + 4 , 7 @ @ import net . minecraft . block . Block ; <nl> import net . minecraft . block . BlockPistonBase ; <nl> import net . minecraft . block . material . Material ; <nl> import net . minecraft . block . properties . IProperty ; <nl> + import net . minecraft . block . properties . PropertyBool ; <nl> import net . minecraft . block . properties . PropertyDirection ; <nl> import net . minecraft . block . state . IBlockState ; <nl> import net . minecraft . client . Minecraft ; <nl> @ @ - 25 , 6 + 26 , 7 @ @ import net . minecraft . tileentity . TileEntity ; <nl> import net . minecraft . util . BlockPos ; <nl> import net . minecraft . util . EnumFacing ; <nl> import net . minecraft . util . ITickable ; <nl> + import net . minecraft . world . IBlockAccess ; <nl> import net . minecraft . world . World ; <nl> import net . minecraftforge . client . model . ISmartBlockModel ; <nl> import net . minecraftforge . client . model . ModelLoader ; <nl> @ @ - 52 , 6 + 54 , 7 @ @ public class ModelAnimationDebug <nl> <nl> public static String blockName = " test _ animation _ block " ; <nl> public static final PropertyDirection FACING = PropertyDirection . create ( " facing " ) ; <nl> + public static final PropertyBool STATIC = PropertyBool . create ( " static " ) ; ; <nl> <nl> @ SidedProxy ( serverSide = " net . minecraftforge . debug . ModelAnimationDebug $ CommonProxy " , clientSide = " net . minecraftforge . debug . ModelAnimationDebug $ ClientProxy " ) <nl> public static CommonProxy proxy ; <nl> @ @ - 71 , 13 + 74 , 10 @ @ public class ModelAnimationDebug <nl> @ Override <nl> public ExtendedBlockState createBlockState ( ) <nl> { <nl> - return new ExtendedBlockState ( this , new IProperty [ ] { FACING } , new IUnlistedProperty [ ] { B3DFrameProperty . instance } ) ; <nl> + return new ExtendedBlockState ( this , new IProperty [ ] { FACING , STATIC } , new IUnlistedProperty [ ] { B3DFrameProperty . instance } ) ; <nl> } <nl> <nl> @ Override <nl> - public int getRenderType ( ) { return - 1 ; } <nl> - <nl> - @ Override <nl> public boolean isOpaqueCube ( ) { return false ; } <nl> <nl> @ Override <nl> @ @ - 109 , 6 + 109 , 11 @ @ public class ModelAnimationDebug <nl> return new Chest ( state ) ; <nl> } <nl> <nl> + @ Override <nl> + public IBlockState getActualState ( IBlockState state , IBlockAccess world , BlockPos pos ) { <nl> + return state . withProperty ( STATIC , true ) ; <nl> + } <nl> + <nl> / * @ Override <nl> public IBlockState getExtendedState ( IBlockState state , IBlockAccess world , BlockPos pos ) { <nl> TileEntity te = world . getTileEntity ( pos ) ; <nl> @ @ - 239 , 7 + 244 , 8 @ @ public class ModelAnimationDebug <nl> public void renderTileEntityAt ( Chest te , double x , double y , double z , float partialTick , int breakStage ) <nl> { <nl> IBlockState state = te . getWorld ( ) . getBlockState ( te . getPos ( ) ) ; <nl> - IBakedModel model = this . blockRenderer . getModelFromBlockState ( state , te . getWorld ( ) , te . getPos ( ) ) ; <nl> + state = state . withProperty ( STATIC , false ) ; <nl> + IBakedModel model = this . blockRenderer . getBlockModelShapes ( ) . getModelForState ( state ) ; <nl> if ( state instanceof IExtendedBlockState ) <nl> { <nl> IExtendedBlockState exState = ( IExtendedBlockState ) state ; <nl> diff - - git a / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json b / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json <nl> index b12b091 . . 2b46abd 100644 <nl> - - - a / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json <nl> + + + b / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json <nl> @ @ - 6 , 13 + 6 , 20 @ @ <nl> } , <nl> " model " : " forgedebugmodelloaderregistry : chest . b3d " , <nl> " custom " : { <nl> - " mesh " : [ " Cube . 001 " ] <nl> + " mesh " : [ " Base " , " Lid " ] <nl> } <nl> } , <nl> " variants " : { <nl> " normal " : [ { } ] , <nl> " inventory " : [ { <nl> - " transform " : " forge : default - block " <nl> + " transform " : { <nl> + " rotation " : { " y " : 180 } , <nl> + " thirdperson " : { <nl> + " rotation " : [ { " z " : 170 } , { " y " : - 45 } , { " z " : 20 } ] , <nl> + 	 	 " translation " : [ 0 , 0 . 09375 , - 0 . 171875 ] , <nl> + 	 	 " scale " : 0 . 375 <nl> + } <nl> + } <nl> } ] , <nl> " facing " : { <nl> " down " : { " transform " : { " rotation " : { " x " : 90 } } } , <nl> @ @ - 21 , 6 + 28 , 18 @ @ <nl> " south " : { " transform " : " identity " } , <nl> " west " : { " transform " : { " rotation " : { " y " : 90 } } } , <nl> " east " : { " transform " : { " rotation " : { " y " : 270 } } } <nl> + } , <nl> + " static " : { <nl> + " true " : { <nl> + " custom " : { <nl> + " mesh " : [ " Base " ] <nl> + } <nl> + } , <nl> + " false " : { <nl> + " custom " : { <nl> + " mesh " : [ " Lid " ] <nl> + } <nl> + } <nl> } <nl> } <nl> } <nl> diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> index b192639 . . d8e22b4 100644 <nl> - - - a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> + + + b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json <nl> @ @ - 6 , 7 + 6 , 10 @ @ <nl> " # chest " : " entity / chest / normal " <nl> } , <nl> " model " : " forgedebugmodelloaderregistry : chest . b3d " , <nl> - " transform " : " forge : default - block " <nl> + " transform " : " forge : default - block " , <nl> + " custom " : { <nl> + " mesh " : [ " Base " , " Lid " ] <nl> + } <nl> } , <nl> " variants " : { <nl> " normal " : [ { } ] , <nl> diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d <nl> index b070d7a . . 5e5b658 100644 <nl> Binary files a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d differ
NEAREST DIFF (one line): diff - - git a / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch b / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch <nl> index a24be3d . . 2eef166 100644 <nl> - - - a / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch <nl> + + + b / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch <nl> @ @ - 1 , 6 + 1 , 31 @ @ <nl> - - - . . / src - base / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java <nl> + + + . . / src - work / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java <nl> - @ @ - 129 , 6 + 129 , 12 @ @ <nl> + @ @ - 49 , 6 + 49 , 24 @ @ <nl> + { <nl> + p _ 175020 _ 1 _ = block . func _ 176221 _ a ( p _ 175020 _ 1 _ , p _ 175020 _ 4 _ , p _ 175020 _ 2 _ ) ; <nl> + IBakedModel ibakedmodel = this . field _ 175028 _ a . func _ 178125 _ b ( p _ 175020 _ 1 _ ) ; <nl> + + <nl> + + if ( ibakedmodel instanceof net . minecraftforge . client . model . ISmartBlockModel ) <nl> + + { <nl> + + IBlockState extendedState = block . getExtendedState ( p _ 175020 _ 1 _ , p _ 175020 _ 4 _ , p _ 175020 _ 2 _ ) ; <nl> + + for ( net . minecraft . util . EnumWorldBlockLayer layer : net . minecraft . util . EnumWorldBlockLayer . values ( ) ) <nl> + + { <nl> + + if ( block . canRenderInLayer ( layer ) ) <nl> + + { <nl> + + net . minecraftforge . client . ForgeHooksClient . setRenderLayer ( layer ) ; <nl> + + <nl> + + IBakedModel targetLayer = ( ( net . minecraftforge . client . model . ISmartBlockModel ) ibakedmodel ) . handleBlockState ( extendedState ) ; <nl> + + IBakedModel damageModel = ( new SimpleBakedModel . Builder ( targetLayer , p _ 175020 _ 3 _ ) ) . func _ 177645 _ b ( ) ; <nl> + + this . field _ 175027 _ c . func _ 178259 _ a ( p _ 175020 _ 4 _ , damageModel , p _ 175020 _ 1 _ , p _ 175020 _ 2 _ , Tessellator . func _ 178181 _ a ( ) . func _ 178180 _ c ( ) ) ; <nl> + + } <nl> + + } <nl> + + return ; <nl> + + } <nl> + + <nl> + IBakedModel ibakedmodel1 = ( new SimpleBakedModel . Builder ( ibakedmodel , p _ 175020 _ 3 _ ) ) . func _ 177645 _ b ( ) ; <nl> + this . field _ 175027 _ c . func _ 178259 _ a ( p _ 175020 _ 4 _ , ibakedmodel1 , p _ 175020 _ 1 _ , p _ 175020 _ 2 _ , Tessellator . func _ 178181 _ a ( ) . func _ 178180 _ c ( ) ) ; <nl> + } <nl> + @ @ - 129 , 6 + 147 , 12 @ @ <nl> ibakedmodel = ( ( WeightedBakedModel ) ibakedmodel ) . func _ 177564 _ a ( MathHelper . func _ 180186 _ a ( p _ 175022 _ 3 _ ) ) ; <nl> } <nl> <nl> diff - - git a / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java b / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java <nl> new file mode 100644 <nl> index 0000000 . . 593101c <nl> - - - / dev / null <nl> + + + b / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java <nl> @ @ - 0 , 0 + 1 , 265 @ @ <nl> + <nl> + package net . minecraftforge . debug ; <nl> + <nl> + import java . util . ArrayList ; <nl> + import java . util . Collections ; <nl> + import java . util . List ; <nl> + <nl> + import com . google . common . primitives . Ints ; <nl> + <nl> + import net . minecraft . block . Block ; <nl> + import net . minecraft . block . material . Material ; <nl> + import net . minecraft . block . state . IBlockState ; <nl> + import net . minecraft . client . Minecraft ; <nl> + import net . minecraft . client . renderer . block . model . BakedQuad ; <nl> + import net . minecraft . client . renderer . block . model . ItemCameraTransforms ; <nl> + import net . minecraft . client . renderer . texture . TextureAtlasSprite ; <nl> + import net . minecraft . client . renderer . vertex . VertexFormat ; <nl> + import net . minecraft . client . resources . model . IBakedModel ; <nl> + import net . minecraft . client . resources . model . ModelResourceLocation ; <nl> + import net . minecraft . creativetab . CreativeTabs ; <nl> + import net . minecraft . init . Blocks ; <nl> + import net . minecraft . util . EnumFacing ; <nl> + import net . minecraft . util . EnumWorldBlockLayer ; <nl> + import net . minecraftforge . client . event . ModelBakeEvent ; <nl> + import net . minecraftforge . client . model . IFlexibleBakedModel ; <nl> + import net . minecraftforge . client . model . IModelPart ; <nl> + import net . minecraftforge . client . model . IModelState ; <nl> + import net . minecraftforge . client . model . ISmartBlockModel ; <nl> + import net . minecraftforge . client . model . TRSRTransformation ; <nl> + import net . minecraftforge . common . MinecraftForge ; <nl> + import net . minecraftforge . fml . common . Mod ; <nl> + import net . minecraftforge . fml . common . Mod . EventHandler ; <nl> + import net . minecraftforge . fml . common . event . FMLInitializationEvent ; <nl> + import net . minecraftforge . fml . common . eventhandler . SubscribeEvent ; <nl> + import net . minecraftforge . fml . common . registry . GameRegistry ; <nl> + import net . minecraftforge . fml . relauncher . Side ; <nl> + <nl> + <nl> + @ SuppressWarnings ( " deprecation " ) <nl> + @ Mod ( modid = " LayerBreakingTest " , name = " LayerBreakingTest " , version = " 0 . 0 . 0 " ) <nl> + public class LayerBreakingTest <nl> + { <nl> + <nl> + public static final boolean ENABLE = true ; <nl> + public static TestBlock testBlock ; <nl> + <nl> + class TestBakedModel implements IFlexibleBakedModel <nl> + { <nl> + <nl> + TextureAtlasSprite texture ; <nl> + List < BakedQuad > list = new ArrayList < BakedQuad > ( ) ; <nl> + <nl> + private int [ ] vertexToInts ( <nl> + float x , <nl> + float y , <nl> + float z , <nl> + int color , <nl> + TextureAtlasSprite texture , <nl> + int u , <nl> + int v ) <nl> + { <nl> + return new int [ ] { Float . floatToRawIntBits ( x ) , Float . floatToRawIntBits ( y ) , Float . floatToRawIntBits ( z ) , color , Float . floatToRawIntBits ( texture . getInterpolatedU ( u ) ) , Float . floatToRawIntBits ( texture . getInterpolatedV ( v ) ) , 0 } ; <nl> + } <nl> + <nl> + public TestBakedModel ( <nl> + TextureAtlasSprite sprite , <nl> + boolean top ) <nl> + { <nl> + texture = sprite ; <nl> + if ( top ) <nl> + { <nl> + list . add ( new BakedQuad ( Ints . concat ( vertexToInts ( 0 . 5f , 1 . 0f , 0 , - 1 , texture , 8 , 0 ) , vertexToInts ( 0 . 5f , 1 . 0f , 1 , - 1 , texture , 8 , 16 ) , vertexToInts ( 1 , 1 . 0f , 1 , - 1 , texture , 16 , 16 ) , vertexToInts ( 1 , 1 . 0f , 0 , - 1 , texture , 16 , 0 ) ) , - 1 , EnumFacing . UP ) ) ; <nl> + } <nl> + else <nl> + { <nl> + list . add ( new BakedQuad ( Ints . concat ( vertexToInts ( 0 , 1 . 0f , 0 , - 1 , texture , 0 , 0 ) , vertexToInts ( 0 , 1 . 0f , 1 , - 1 , texture , 0 , 16 ) , vertexToInts ( 0 . 5f , 1 . 0f , 1 , - 1 , texture , 8 , 16 ) , vertexToInts ( 0 . 5f , 1 . 0f , 0 , - 1 , texture , 8 , 0 ) ) , - 1 , EnumFacing . DOWN ) ) ; <nl> + } <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isAmbientOcclusion ( ) <nl> + { <nl> + return true ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isGui3d ( ) <nl> + { <nl> + return true ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isBuiltInRenderer ( ) <nl> + { <nl> + return false ; <nl> + } <nl> + <nl> + @ Override <nl> + public TextureAtlasSprite getTexture ( ) <nl> + { <nl> + return texture ; <nl> + } <nl> + <nl> + @ Override <nl> + public ItemCameraTransforms getItemCameraTransforms ( ) <nl> + { <nl> + return ItemCameraTransforms . DEFAULT ; <nl> + } <nl> + <nl> + @ Override <nl> + public List < BakedQuad > getFaceQuads ( <nl> + EnumFacing side ) <nl> + { <nl> + return Collections . emptyList ( ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public List < BakedQuad > getGeneralQuads ( ) <nl> + { <nl> + return list ; <nl> + } <nl> + <nl> + @ Override <nl> + public VertexFormat getFormat ( ) <nl> + { <nl> + return null ; <nl> + } <nl> + <nl> + } ; <nl> + <nl> + class TestBlock extends Block <nl> + { <nl> + <nl> + protected TestBlock ( ) <nl> + { <nl> + super ( Material . glass ) ; <nl> + setHardness ( 7 ) ; <nl> + setCreativeTab ( CreativeTabs . tabBlock ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isOpaqueCube ( ) <nl> + { <nl> + return false ; <nl> + } <nl> + <nl> + public boolean isFullCube ( ) <nl> + { <nl> + return false ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean canRenderInLayer ( <nl> + EnumWorldBlockLayer layer ) <nl> + { <nl> + return layer = = EnumWorldBlockLayer . SOLID | | layer = = EnumWorldBlockLayer . TRANSLUCENT ; <nl> + } <nl> + <nl> + } ; <nl> + <nl> + class SmartModel implements IBakedModel , ISmartBlockModel <nl> + { <nl> + <nl> + IFlexibleBakedModel solid ; <nl> + IFlexibleBakedModel translucent ; <nl> + <nl> + private class DefState implements IModelState <nl> + { <nl> + <nl> + @ Override <nl> + public TRSRTransformation apply ( <nl> + IModelPart part ) <nl> + { <nl> + return TRSRTransformation . identity ( ) ; <nl> + } <nl> + <nl> + } ; <nl> + <nl> + @ Override <nl> + public List getFaceQuads ( <nl> + EnumFacing p _ 177551 _ 1 _ ) <nl> + { <nl> + return Collections . emptyList ( ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public List getGeneralQuads ( ) <nl> + { <nl> + return Collections . emptyList ( ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isAmbientOcclusion ( ) <nl> + { <nl> + return true ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isGui3d ( ) <nl> + { <nl> + return true ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean isBuiltInRenderer ( ) <nl> + { <nl> + return false ; <nl> + } <nl> + <nl> + @ Override <nl> + public TextureAtlasSprite getTexture ( ) <nl> + { <nl> + return null ; <nl> + } <nl> + <nl> + @ Override <nl> + public ItemCameraTransforms getItemCameraTransforms ( ) <nl> + { <nl> + return ItemCameraTransforms . DEFAULT ; <nl> + } <nl> + <nl> + @ Override <nl> + public IBakedModel handleBlockState ( <nl> + IBlockState state ) <nl> + { <nl> + if ( solid = = null ) <nl> + { <nl> + TextureAtlasSprite a = Minecraft . getMinecraft ( ) . getBlockRendererDispatcher ( ) . getBlockModelShapes ( ) . getModelForState ( Blocks . stained _ glass . getStateFromMeta ( 3 ) ) . getTexture ( ) ; <nl> + TextureAtlasSprite b = Minecraft . getMinecraft ( ) . getBlockRendererDispatcher ( ) . getBlockModelShapes ( ) . getModelForState ( Blocks . cobblestone . getDefaultState ( ) ) . getTexture ( ) ; <nl> + <nl> + translucent = new TestBakedModel ( a , true ) ; <nl> + solid = new TestBakedModel ( b , false ) ; <nl> + } <nl> + <nl> + if ( net . minecraftforge . client . MinecraftForgeClient . getRenderLayer ( ) = = EnumWorldBlockLayer . SOLID ) <nl> + { <nl> + return solid ; <nl> + } <nl> + else <nl> + { <nl> + return translucent ; <nl> + } <nl> + } <nl> + <nl> + } ; <nl> + <nl> + @ SubscribeEvent <nl> + public void onModelBakeEvent ( <nl> + ModelBakeEvent event ) <nl> + { <nl> + event . modelRegistry . putObject ( new ModelResourceLocation ( " LayerBreakingTest : LayerBreakingTest " ) , new SmartModel ( ) ) ; <nl> + } <nl> + <nl> + @ EventHandler <nl> + public void init ( <nl> + FMLInitializationEvent event ) <nl> + { <nl> + if ( ENABLE & & event . getSide ( ) = = Side . CLIENT ) <nl> + { <nl> + MinecraftForge . EVENT _ BUS . register ( this ) ; <nl> + GameRegistry . registerBlock ( testBlock = new TestBlock ( ) , " LayerBreakingTest " ) ; <nl> + } <nl> + } <nl> + <nl> + }

TEST DIFF:
diff - - git a / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java b / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java 
 index 60af648 . . 06c2970 100644 
 - - - a / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java 
 + + + b / src / main / java / net / minecraftforge / client / model / b3d / B3DModel . java 
 @ @ - 636 , 13 + 636 , 19 @ @ public class B3DModel 
 Vector3f rPos = new Vector3f ( newPos . x / newPos . w , newPos . y / newPos . w , newPos . z / newPos . w ) ; 
 
 / / normal 
 - Matrix3f tm = new Matrix3f ( ) ; 
 - t . getRotationScale ( tm ) ; 
 - tm . invert ( ) ; 
 - tm . transpose ( ) ; 
 - Vector3f normal = new Vector3f ( this . normal ) , rNormal = new Vector3f ( ) ; 
 - tm . transform ( normal , rNormal ) ; 
 - rNormal . normalize ( ) ; 
 + Vector3f rNormal = null ; 
 + 
 + if ( this . normal ! = null ) 
 + { 
 + Matrix3f tm = new Matrix3f ( ) ; 
 + t . getRotationScale ( tm ) ; 
 + tm . invert ( ) ; 
 + tm . transpose ( ) ; 
 + Vector3f normal = new Vector3f ( this . normal ) ; 
 + rNormal = new Vector3f ( ) ; 
 + tm . transform ( normal , rNormal ) ; 
 + rNormal . normalize ( ) ; 
 + } 
 
 / / texCoords TODO 
 return new Vertex ( rPos , rNormal , color , texCoords ) ; 
 diff - - git a / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java b / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java 
 index 48b8ec2 . . fbdb0e2 100644 
 - - - a / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java 
 + + + b / src / test / java / net / minecraftforge / debug / ModelAnimationDebug . java 
 @ @ - 4 , 6 + 4 , 7 @ @ import net . minecraft . block . Block ; 
 import net . minecraft . block . BlockPistonBase ; 
 import net . minecraft . block . material . Material ; 
 import net . minecraft . block . properties . IProperty ; 
 + import net . minecraft . block . properties . PropertyBool ; 
 import net . minecraft . block . properties . PropertyDirection ; 
 import net . minecraft . block . state . IBlockState ; 
 import net . minecraft . client . Minecraft ; 
 @ @ - 25 , 6 + 26 , 7 @ @ import net . minecraft . tileentity . TileEntity ; 
 import net . minecraft . util . BlockPos ; 
 import net . minecraft . util . EnumFacing ; 
 import net . minecraft . util . ITickable ; 
 + import net . minecraft . world . IBlockAccess ; 
 import net . minecraft . world . World ; 
 import net . minecraftforge . client . model . ISmartBlockModel ; 
 import net . minecraftforge . client . model . ModelLoader ; 
 @ @ - 52 , 6 + 54 , 7 @ @ public class ModelAnimationDebug 
 
 public static String blockName = " test _ animation _ block " ; 
 public static final PropertyDirection FACING = PropertyDirection . create ( " facing " ) ; 
 + public static final PropertyBool STATIC = PropertyBool . create ( " static " ) ; ; 
 
 @ SidedProxy ( serverSide = " net . minecraftforge . debug . ModelAnimationDebug $ CommonProxy " , clientSide = " net . minecraftforge . debug . ModelAnimationDebug $ ClientProxy " ) 
 public static CommonProxy proxy ; 
 @ @ - 71 , 13 + 74 , 10 @ @ public class ModelAnimationDebug 
 @ Override 
 public ExtendedBlockState createBlockState ( ) 
 { 
 - return new ExtendedBlockState ( this , new IProperty [ ] { FACING } , new IUnlistedProperty [ ] { B3DFrameProperty . instance } ) ; 
 + return new ExtendedBlockState ( this , new IProperty [ ] { FACING , STATIC } , new IUnlistedProperty [ ] { B3DFrameProperty . instance } ) ; 
 } 
 
 @ Override 
 - public int getRenderType ( ) { return - 1 ; } 
 - 
 - @ Override 
 public boolean isOpaqueCube ( ) { return false ; } 
 
 @ Override 
 @ @ - 109 , 6 + 109 , 11 @ @ public class ModelAnimationDebug 
 return new Chest ( state ) ; 
 } 
 
 + @ Override 
 + public IBlockState getActualState ( IBlockState state , IBlockAccess world , BlockPos pos ) { 
 + return state . withProperty ( STATIC , true ) ; 
 + } 
 + 
 / * @ Override 
 public IBlockState getExtendedState ( IBlockState state , IBlockAccess world , BlockPos pos ) { 
 TileEntity te = world . getTileEntity ( pos ) ; 
 @ @ - 239 , 7 + 244 , 8 @ @ public class ModelAnimationDebug 
 public void renderTileEntityAt ( Chest te , double x , double y , double z , float partialTick , int breakStage ) 
 { 
 IBlockState state = te . getWorld ( ) . getBlockState ( te . getPos ( ) ) ; 
 - IBakedModel model = this . blockRenderer . getModelFromBlockState ( state , te . getWorld ( ) , te . getPos ( ) ) ; 
 + state = state . withProperty ( STATIC , false ) ; 
 + IBakedModel model = this . blockRenderer . getBlockModelShapes ( ) . getModelForState ( state ) ; 
 if ( state instanceof IExtendedBlockState ) 
 { 
 IExtendedBlockState exState = ( IExtendedBlockState ) state ; 
 diff - - git a / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json b / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json 
 index b12b091 . . 2b46abd 100644 
 - - - a / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json 
 + + + b / src / test / resources / assets / forgedebugmodelanimation / blockstates / test _ animation _ block . json 
 @ @ - 6 , 13 + 6 , 20 @ @ 
 } , 
 " model " : " forgedebugmodelloaderregistry : chest . b3d " , 
 " custom " : { 
 - " mesh " : [ " Cube . 001 " ] 
 + " mesh " : [ " Base " , " Lid " ] 
 } 
 } , 
 " variants " : { 
 " normal " : [ { } ] , 
 " inventory " : [ { 
 - " transform " : " forge : default - block " 
 + " transform " : { 
 + " rotation " : { " y " : 180 } , 
 + " thirdperson " : { 
 + " rotation " : [ { " z " : 170 } , { " y " : - 45 } , { " z " : 20 } ] , 
 + 	 	 " translation " : [ 0 , 0 . 09375 , - 0 . 171875 ] , 
 + 	 	 " scale " : 0 . 375 
 + } 
 + } 
 } ] , 
 " facing " : { 
 " down " : { " transform " : { " rotation " : { " x " : 90 } } } , 
 @ @ - 21 , 6 + 28 , 18 @ @ 
 " south " : { " transform " : " identity " } , 
 " west " : { " transform " : { " rotation " : { " y " : 90 } } } , 
 " east " : { " transform " : { " rotation " : { " y " : 270 } } } 
 + } , 
 + " static " : { 
 + " true " : { 
 + " custom " : { 
 + " mesh " : [ " Base " ] 
 + } 
 + } , 
 + " false " : { 
 + " custom " : { 
 + " mesh " : [ " Lid " ] 
 + } 
 + } 
 } 
 } 
 } 
 diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 index b192639 . . d8e22b4 100644 
 - - - a / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 + + + b / src / test / resources / assets / forgedebugmodelloaderregistry / blockstates / CustomModelBlock . json 
 @ @ - 6 , 7 + 6 , 10 @ @ 
 " # chest " : " entity / chest / normal " 
 } , 
 " model " : " forgedebugmodelloaderregistry : chest . b3d " , 
 - " transform " : " forge : default - block " 
 + " transform " : " forge : default - block " , 
 + " custom " : { 
 + " mesh " : [ " Base " , " Lid " ] 
 + } 
 } , 
 " variants " : { 
 " normal " : [ { } ] , 
 diff - - git a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d 
 index b070d7a . . 5e5b658 100644 
 Binary files a / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d and b / src / test / resources / assets / forgedebugmodelloaderregistry / models / block / chest . b3d differ

NEAREST DIFF:
diff - - git a / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch b / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch 
 index a24be3d . . 2eef166 100644 
 - - - a / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch 
 + + + b / patches / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java . patch 
 @ @ - 1 , 6 + 1 , 31 @ @ 
 - - - . . / src - base / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java 
 + + + . . / src - work / minecraft / net / minecraft / client / renderer / BlockRendererDispatcher . java 
 - @ @ - 129 , 6 + 129 , 12 @ @ 
 + @ @ - 49 , 6 + 49 , 24 @ @ 
 + { 
 + p _ 175020 _ 1 _ = block . func _ 176221 _ a ( p _ 175020 _ 1 _ , p _ 175020 _ 4 _ , p _ 175020 _ 2 _ ) ; 
 + IBakedModel ibakedmodel = this . field _ 175028 _ a . func _ 178125 _ b ( p _ 175020 _ 1 _ ) ; 
 + + 
 + + if ( ibakedmodel instanceof net . minecraftforge . client . model . ISmartBlockModel ) 
 + + { 
 + + IBlockState extendedState = block . getExtendedState ( p _ 175020 _ 1 _ , p _ 175020 _ 4 _ , p _ 175020 _ 2 _ ) ; 
 + + for ( net . minecraft . util . EnumWorldBlockLayer layer : net . minecraft . util . EnumWorldBlockLayer . values ( ) ) 
 + + { 
 + + if ( block . canRenderInLayer ( layer ) ) 
 + + { 
 + + net . minecraftforge . client . ForgeHooksClient . setRenderLayer ( layer ) ; 
 + + 
 + + IBakedModel targetLayer = ( ( net . minecraftforge . client . model . ISmartBlockModel ) ibakedmodel ) . handleBlockState ( extendedState ) ; 
 + + IBakedModel damageModel = ( new SimpleBakedModel . Builder ( targetLayer , p _ 175020 _ 3 _ ) ) . func _ 177645 _ b ( ) ; 
 + + this . field _ 175027 _ c . func _ 178259 _ a ( p _ 175020 _ 4 _ , damageModel , p _ 175020 _ 1 _ , p _ 175020 _ 2 _ , Tessellator . func _ 178181 _ a ( ) . func _ 178180 _ c ( ) ) ; 
 + + } 
 + + } 
 + + return ; 
 + + } 
 + + 
 + IBakedModel ibakedmodel1 = ( new SimpleBakedModel . Builder ( ibakedmodel , p _ 175020 _ 3 _ ) ) . func _ 177645 _ b ( ) ; 
 + this . field _ 175027 _ c . func _ 178259 _ a ( p _ 175020 _ 4 _ , ibakedmodel1 , p _ 175020 _ 1 _ , p _ 175020 _ 2 _ , Tessellator . func _ 178181 _ a ( ) . func _ 178180 _ c ( ) ) ; 
 + } 
 + @ @ - 129 , 6 + 147 , 12 @ @ 
 ibakedmodel = ( ( WeightedBakedModel ) ibakedmodel ) . func _ 177564 _ a ( MathHelper . func _ 180186 _ a ( p _ 175022 _ 3 _ ) ) ; 
 } 
 
 diff - - git a / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java b / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java 
 new file mode 100644 
 index 0000000 . . 593101c 
 - - - / dev / null 
 + + + b / src / test / java / net / minecraftforge / debug / LayerBreakingTest . java 
 @ @ - 0 , 0 + 1 , 265 @ @ 
 + 
 + package net . minecraftforge . debug ; 
 + 
 + import java . util . ArrayList ; 
 + import java . util . Collections ; 
 + import java . util . List ; 
 + 
 + import com . google . common . primitives . Ints ; 
 + 
 + import net . minecraft . block . Block ; 
 + import net . minecraft . block . material . Material ; 
 + import net . minecraft . block . state . IBlockState ; 
 + import net . minecraft . client . Minecraft ; 
 + import net . minecraft . client . renderer . block . model . BakedQuad ; 
 + import net . minecraft . client . renderer . block . model . ItemCameraTransforms ; 
 + import net . minecraft . client . renderer . texture . TextureAtlasSprite ; 
 + import net . minecraft . client . renderer . vertex . VertexFormat ; 
 + import net . minecraft . client . resources . model . IBakedModel ; 
 + import net . minecraft . client . resources . model . ModelResourceLocation ; 
 + import net . minecraft . creativetab . CreativeTabs ; 
 + import net . minecraft . init . Blocks ; 
 + import net . minecraft . util . EnumFacing ; 
 + import net . minecraft . util . EnumWorldBlockLayer ; 
 + import net . minecraftforge . client . event . ModelBakeEvent ; 
 + import net . minecraftforge . client . model . IFlexibleBakedModel ; 
 + import net . minecraftforge . client . model . IModelPart ; 
 + import net . minecraftforge . client . model . IModelState ; 
 + import net . minecraftforge . client . model . ISmartBlockModel ; 
 + import net . minecraftforge . client . model . TRSRTransformation ; 
 + import net . minecraftforge . common . MinecraftForge ; 
 + import net . minecraftforge . fml . common . Mod ; 
 + import net . minecraftforge . fml . common . Mod . EventHandler ; 
 + import net . minecraftforge . fml . common . event . FMLInitializationEvent ; 
 + import net . minecraftforge . fml . common . eventhandler . SubscribeEvent ; 
 + import net . minecraftforge . fml . common . registry . GameRegistry ; 
 + import net . minecraftforge . fml . relauncher . Side ; 
 + 
 + 
 + @ SuppressWarnings ( " deprecation " ) 
 + @ Mod ( modid = " LayerBreakingTest " , name = " LayerBreakingTest " , version = " 0 . 0 . 0 " ) 
 + public class LayerBreakingTest 
 + { 
 + 
 + public static final boolean ENABLE = true ; 
 + public static TestBlock testBlock ; 
 + 
 + class TestBakedModel implements IFlexibleBakedModel 
 + { 
 + 
 + TextureAtlasSprite texture ; 
 + List < BakedQuad > list = new ArrayList < BakedQuad > ( ) ; 
 + 
 + private int [ ] vertexToInts ( 
 + float x , 
 + float y , 
 + float z , 
 + int color , 
 + TextureAtlasSprite texture , 
 + int u , 
 + int v ) 
 + { 
 + return new int [ ] { Float . floatToRawIntBits ( x ) , Float . floatToRawIntBits ( y ) , Float . floatToRawIntBits ( z ) , color , Float . floatToRawIntBits ( texture . getInterpolatedU ( u ) ) , Float . floatToRawIntBits ( texture . getInterpolatedV ( v ) ) , 0 } ; 
 + } 
 + 
 + public TestBakedModel ( 
 + TextureAtlasSprite sprite , 
 + boolean top ) 
 + { 
 + texture = sprite ; 
 + if ( top ) 
 + { 
 + list . add ( new BakedQuad ( Ints . concat ( vertexToInts ( 0 . 5f , 1 . 0f , 0 , - 1 , texture , 8 , 0 ) , vertexToInts ( 0 . 5f , 1 . 0f , 1 , - 1 , texture , 8 , 16 ) , vertexToInts ( 1 , 1 . 0f , 1 , - 1 , texture , 16 , 16 ) , vertexToInts ( 1 , 1 . 0f , 0 , - 1 , texture , 16 , 0 ) ) , - 1 , EnumFacing . UP ) ) ; 
 + } 
 + else 
 + { 
 + list . add ( new BakedQuad ( Ints . concat ( vertexToInts ( 0 , 1 . 0f , 0 , - 1 , texture , 0 , 0 ) , vertexToInts ( 0 , 1 . 0f , 1 , - 1 , texture , 0 , 16 ) , vertexToInts ( 0 . 5f , 1 . 0f , 1 , - 1 , texture , 8 , 16 ) , vertexToInts ( 0 . 5f , 1 . 0f , 0 , - 1 , texture , 8 , 0 ) ) , - 1 , EnumFacing . DOWN ) ) ; 
 + } 
 + } 
 + 
 + @ Override 
 + public boolean isAmbientOcclusion ( ) 
 + { 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean isGui3d ( ) 
 + { 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean isBuiltInRenderer ( ) 
 + { 
 + return false ; 
 + } 
 + 
 + @ Override 
 + public TextureAtlasSprite getTexture ( ) 
 + { 
 + return texture ; 
 + } 
 + 
 + @ Override 
 + public ItemCameraTransforms getItemCameraTransforms ( ) 
 + { 
 + return ItemCameraTransforms . DEFAULT ; 
 + } 
 + 
 + @ Override 
 + public List < BakedQuad > getFaceQuads ( 
 + EnumFacing side ) 
 + { 
 + return Collections . emptyList ( ) ; 
 + } 
 + 
 + @ Override 
 + public List < BakedQuad > getGeneralQuads ( ) 
 + { 
 + return list ; 
 + } 
 + 
 + @ Override 
 + public VertexFormat getFormat ( ) 
 + { 
 + return null ; 
 + } 
 + 
 + } ; 
 + 
 + class TestBlock extends Block 
 + { 
 + 
 + protected TestBlock ( ) 
 + { 
 + super ( Material . glass ) ; 
 + setHardness ( 7 ) ; 
 + setCreativeTab ( CreativeTabs . tabBlock ) ; 
 + } 
 + 
 + @ Override 
 + public boolean isOpaqueCube ( ) 
 + { 
 + return false ; 
 + } 
 + 
 + public boolean isFullCube ( ) 
 + { 
 + return false ; 
 + } 
 + 
 + @ Override 
 + public boolean canRenderInLayer ( 
 + EnumWorldBlockLayer layer ) 
 + { 
 + return layer = = EnumWorldBlockLayer . SOLID | | layer = = EnumWorldBlockLayer . TRANSLUCENT ; 
 + } 
 + 
 + } ; 
 + 
 + class SmartModel implements IBakedModel , ISmartBlockModel 
 + { 
 + 
 + IFlexibleBakedModel solid ; 
 + IFlexibleBakedModel translucent ; 
 + 
 + private class DefState implements IModelState 
 + { 
 + 
 + @ Override 
 + public TRSRTransformation apply ( 
 + IModelPart part ) 
 + { 
 + return TRSRTransformation . identity ( ) ; 
 + } 
 + 
 + } ; 
 + 
 + @ Override 
 + public List getFaceQuads ( 
 + EnumFacing p _ 177551 _ 1 _ ) 
 + { 
 + return Collections . emptyList ( ) ; 
 + } 
 + 
 + @ Override 
 + public List getGeneralQuads ( ) 
 + { 
 + return Collections . emptyList ( ) ; 
 + } 
 + 
 + @ Override 
 + public boolean isAmbientOcclusion ( ) 
 + { 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean isGui3d ( ) 
 + { 
 + return true ; 
 + } 
 + 
 + @ Override 
 + public boolean isBuiltInRenderer ( ) 
 + { 
 + return false ; 
 + } 
 + 
 + @ Override 
 + public TextureAtlasSprite getTexture ( ) 
 + { 
 + return null ; 
 + } 
 + 
 + @ Override 
 + public ItemCameraTransforms getItemCameraTransforms ( ) 
 + { 
 + return ItemCameraTransforms . DEFAULT ; 
 + } 
 + 
 + @ Override 
 + public IBakedModel handleBlockState ( 
 + IBlockState state ) 
 + { 
 + if ( solid = = null ) 
 + { 
 + TextureAtlasSprite a = Minecraft . getMinecraft ( ) . getBlockRendererDispatcher ( ) . getBlockModelShapes ( ) . getModelForState ( Blocks . stained _ glass . getStateFromMeta ( 3 ) ) . getTexture ( ) ; 
 + TextureAtlasSprite b = Minecraft . getMinecraft ( ) . getBlockRendererDispatcher ( ) . getBlockModelShapes ( ) . getModelForState ( Blocks . cobblestone . getDefaultState ( ) ) . getTexture ( ) ; 
 + 
 + translucent = new TestBakedModel ( a , true ) ; 
 + solid = new TestBakedModel ( b , false ) ; 
 + } 
 + 
 + if ( net . minecraftforge . client . MinecraftForgeClient . getRenderLayer ( ) = = EnumWorldBlockLayer . SOLID ) 
 + { 
 + return solid ; 
 + } 
 + else 
 + { 
 + return translucent ; 
 + } 
 + } 
 + 
 + } ; 
 + 
 + @ SubscribeEvent 
 + public void onModelBakeEvent ( 
 + ModelBakeEvent event ) 
 + { 
 + event . modelRegistry . putObject ( new ModelResourceLocation ( " LayerBreakingTest : LayerBreakingTest " ) , new SmartModel ( ) ) ; 
 + } 
 + 
 + @ EventHandler 
 + public void init ( 
 + FMLInitializationEvent event ) 
 + { 
 + if ( ENABLE & & event . getSide ( ) = = Side . CLIENT ) 
 + { 
 + MinecraftForge . EVENT _ BUS . register ( this ) ; 
 + GameRegistry . registerBlock ( testBlock = new TestBlock ( ) , " LayerBreakingTest " ) ; 
 + } 
 + } 
 + 
 + }
