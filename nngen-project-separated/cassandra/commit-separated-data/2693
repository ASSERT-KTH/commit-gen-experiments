BLEU SCORE: 0.028465126651392333

TEST MSG: Fix ClassCastException for compact table with composites
GENERATED MSG: Pool CqlRecordWriter clients by inetaddress rather than Range

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 4f91a0e . . 2bb67dd 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 6 , 6 + 6 , 7 @ @ <nl> * Fix assertion error in ALTER TYPE RENAME ( CASSANDRA - 6705 ) <nl> * Scrub should not always clear out repaired status ( CASSANDRA - 5351 ) <nl> * Improve handling of range tombstone for wide partitions ( CASSANDRA - 6446 ) <nl> + * Fix ClassCastException for compact table with composites ( CASSANDRA - 6738 ) <nl> <nl> 2 . 1 . 0 - beta1 <nl> * Add flush directory distinct from compaction directories ( CASSANDRA - 6357 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundComposite . java b / src / java / org / apache / cassandra / db / composites / CompoundComposite . java <nl> index 9475cc0 . . cae1c9e 100644 <nl> - - - a / src / java / org / apache / cassandra / db / composites / CompoundComposite . java <nl> + + + b / src / java / org / apache / cassandra / db / composites / CompoundComposite . java <nl> @ @ - 50 , 7 + 50 , 11 @ @ public class CompoundComposite extends AbstractComposite <nl> <nl> public ByteBuffer get ( int i ) <nl> { <nl> - return elements [ i ] ; <nl> + / / Note : most consumer should validate that i is within bounds . However , for backward compatibility <nl> + / / reasons , composite dense tables can have names that don ' t have all their component of the clustering <nl> + / / columns , which may end up here with i > size ( ) . For those calls , it ' s actually simpler to return null <nl> + / / than to force the caller to special case . <nl> + return i > = size ( ) ? null : elements [ i ] ; <nl> } <nl> <nl> @ Override <nl> diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java <nl> index e16e390 . . 0f5b2f5 100644 <nl> - - - a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java <nl> + + + b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java <nl> @ @ - 34 , 6 + 34 , 11 @ @ public class CompoundDenseCellName extends CompoundComposite implements CellName <nl> super ( elements , elements . length , false ) ; <nl> } <nl> <nl> + CompoundDenseCellName ( ByteBuffer [ ] elements , int size ) <nl> + { <nl> + super ( elements , size , false ) ; <nl> + } <nl> + <nl> public int clusteringSize ( ) <nl> { <nl> return size ; <nl> diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java <nl> index 06b25b0 . . 635b997 100644 <nl> - - - a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java <nl> + + + b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java <nl> @ @ - 69 , 8 + 69 , 7 @ @ public class CompoundDenseCellNameType extends AbstractCompoundCellNameType <nl> if ( size < fullSize | | eoc ! = Composite . EOC . NONE ) <nl> return new CompoundComposite ( components , size , false ) . withEOC ( eoc ) ; <nl> <nl> - assert components . length = = size ; <nl> - return new CompoundDenseCellName ( components ) ; <nl> + return new CompoundDenseCellName ( components , size ) ; <nl> } <nl> <nl> protected Composite copyAndMakeWith ( ByteBuffer [ ] components , int size , Composite . EOC eoc , boolean isStatic )
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 4f91a0e . . 2bb67dd 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 6 , 6 + 6 , 7 @ @ 
 * Fix assertion error in ALTER TYPE RENAME ( CASSANDRA - 6705 ) 
 * Scrub should not always clear out repaired status ( CASSANDRA - 5351 ) 
 * Improve handling of range tombstone for wide partitions ( CASSANDRA - 6446 ) 
 + * Fix ClassCastException for compact table with composites ( CASSANDRA - 6738 ) 
 
 2 . 1 . 0 - beta1 
 * Add flush directory distinct from compaction directories ( CASSANDRA - 6357 ) 
 diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundComposite . java b / src / java / org / apache / cassandra / db / composites / CompoundComposite . java 
 index 9475cc0 . . cae1c9e 100644 
 - - - a / src / java / org / apache / cassandra / db / composites / CompoundComposite . java 
 + + + b / src / java / org / apache / cassandra / db / composites / CompoundComposite . java 
 @ @ - 50 , 7 + 50 , 11 @ @ public class CompoundComposite extends AbstractComposite 
 
 public ByteBuffer get ( int i ) 
 { 
 - return elements [ i ] ; 
 + / / Note : most consumer should validate that i is within bounds . However , for backward compatibility 
 + / / reasons , composite dense tables can have names that don ' t have all their component of the clustering 
 + / / columns , which may end up here with i > size ( ) . For those calls , it ' s actually simpler to return null 
 + / / than to force the caller to special case . 
 + return i > = size ( ) ? null : elements [ i ] ; 
 } 
 
 @ Override 
 diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java 
 index e16e390 . . 0f5b2f5 100644 
 - - - a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java 
 + + + b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellName . java 
 @ @ - 34 , 6 + 34 , 11 @ @ public class CompoundDenseCellName extends CompoundComposite implements CellName 
 super ( elements , elements . length , false ) ; 
 } 
 
 + CompoundDenseCellName ( ByteBuffer [ ] elements , int size ) 
 + { 
 + super ( elements , size , false ) ; 
 + } 
 + 
 public int clusteringSize ( ) 
 { 
 return size ; 
 diff - - git a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java 
 index 06b25b0 . . 635b997 100644 
 - - - a / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java 
 + + + b / src / java / org / apache / cassandra / db / composites / CompoundDenseCellNameType . java 
 @ @ - 69 , 8 + 69 , 7 @ @ public class CompoundDenseCellNameType extends AbstractCompoundCellNameType 
 if ( size < fullSize | | eoc ! = Composite . EOC . NONE ) 
 return new CompoundComposite ( components , size , false ) . withEOC ( eoc ) ; 
 
 - assert components . length = = size ; 
 - return new CompoundDenseCellName ( components ) ; 
 + return new CompoundDenseCellName ( components , size ) ; 
 } 
 
 protected Composite copyAndMakeWith ( ByteBuffer [ ] components , int size , Composite . EOC eoc , boolean isStatic )

NEAREST DIFF:
ELIMINATEDSENTENCE
