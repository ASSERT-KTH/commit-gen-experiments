BLEU SCORE: 0.05087641220727392

TEST MSG: Add nodetool taketoken to relocate vnodes .
GENERATED MSG: Add properties to adjust FD initial value and max interval

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index ceb25c3 . . 6e3c2c2 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 6 <nl> + * Add nodetool taketoken to relocate vnodes ( CASSANDRA - 4445 ) <nl> * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) <nl> * Improve nodetool cfhistograms formatting ( CASSANDRA - 6360 ) <nl> * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 26846e7 . . e181c44 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 3098 , 6 + 3098 , 9 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> for ( String srcT : srcTokens ) <nl> { <nl> getPartitioner ( ) . getTokenFactory ( ) . validate ( srcT ) ; <nl> + Token token = getPartitioner ( ) . getTokenFactory ( ) . fromString ( srcT ) ; <nl> + if ( tokenMetadata . getTokens ( tokenMetadata . getEndpoint ( token ) ) . size ( ) < 2 ) <nl> + throw new IOException ( " Cannot relocate " + srcT + " ; source node would have no tokens left " ) ; <nl> tokens . add ( getPartitioner ( ) . getTokenFactory ( ) . fromString ( srcT ) ) ; <nl> } <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> index fd7b69b . . f3cd563 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> @ @ - 169 , 6 + 169 , 7 @ @ public class NodeCmd <nl> STATUSTHRIFT , <nl> STOP , <nl> STOPDAEMON , <nl> + TAKETOKEN , <nl> TPSTATS , <nl> TRUNCATEHINTS , <nl> UPGRADESSTABLES , <nl> @ @ - 1315 , 6 + 1316 , 11 @ @ public class NodeCmd <nl> probe . setTraceProbability ( Double . parseDouble ( arguments [ 0 ] ) ) ; <nl> break ; <nl> <nl> + case TAKETOKEN : <nl> + if ( arguments . length < 1 ) { badUse ( " Must supply at least one token to take " ) ; } <nl> + probe . takeTokens ( arguments ) ; <nl> + break ; <nl> + <nl> case REBUILD : <nl> if ( arguments . length > 1 ) { badUse ( " Too many arguments . " ) ; } <nl> probe . rebuild ( arguments . length = = 1 ? arguments [ 0 ] : null ) ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 0fbb12a . . ffd6203 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 471 , 6 + 471 , 11 @ @ public class NodeProbe <nl> ssProxy . move ( newToken ) ; <nl> } <nl> <nl> + public void takeTokens ( String [ ] tokens ) throws IOException <nl> + { <nl> + ssProxy . relocate ( Arrays . asList ( tokens ) ) ; <nl> + } <nl> + <nl> public void removeNode ( String token ) <nl> { <nl> ssProxy . removeNode ( token ) ; <nl> diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> index b28e300 . . 8eacf2f 100644 <nl> - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> @ @ - 115 , 6 + 115 , 9 @ @ commands : <nl> - name : move < new token > <nl> help : | <nl> Move node on the token ring to a new token . ( for negative tokens , use \ \ to escape , Example : move \ \ - 123 ) <nl> + - name : taketoken < token , . . . > <nl> + help : | <nl> + Move the token ( s ) from the existing owner ( s ) to this node . For vnodes only . Use \ \ to escape negative tokens . <nl> - name : removenode status | force | < ID > <nl> help : | <nl> Show status of current node removal , force completion of pending removal or remove provided ID
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index ceb25c3 . . 6e3c2c2 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 6 
 + * Add nodetool taketoken to relocate vnodes ( CASSANDRA - 4445 ) 
 * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) 
 * Improve nodetool cfhistograms formatting ( CASSANDRA - 6360 ) 
 * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 26846e7 . . e181c44 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 3098 , 6 + 3098 , 9 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 for ( String srcT : srcTokens ) 
 { 
 getPartitioner ( ) . getTokenFactory ( ) . validate ( srcT ) ; 
 + Token token = getPartitioner ( ) . getTokenFactory ( ) . fromString ( srcT ) ; 
 + if ( tokenMetadata . getTokens ( tokenMetadata . getEndpoint ( token ) ) . size ( ) < 2 ) 
 + throw new IOException ( " Cannot relocate " + srcT + " ; source node would have no tokens left " ) ; 
 tokens . add ( getPartitioner ( ) . getTokenFactory ( ) . fromString ( srcT ) ) ; 
 } 
 } 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 index fd7b69b . . f3cd563 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 @ @ - 169 , 6 + 169 , 7 @ @ public class NodeCmd 
 STATUSTHRIFT , 
 STOP , 
 STOPDAEMON , 
 + TAKETOKEN , 
 TPSTATS , 
 TRUNCATEHINTS , 
 UPGRADESSTABLES , 
 @ @ - 1315 , 6 + 1316 , 11 @ @ public class NodeCmd 
 probe . setTraceProbability ( Double . parseDouble ( arguments [ 0 ] ) ) ; 
 break ; 
 
 + case TAKETOKEN : 
 + if ( arguments . length < 1 ) { badUse ( " Must supply at least one token to take " ) ; } 
 + probe . takeTokens ( arguments ) ; 
 + break ; 
 + 
 case REBUILD : 
 if ( arguments . length > 1 ) { badUse ( " Too many arguments . " ) ; } 
 probe . rebuild ( arguments . length = = 1 ? arguments [ 0 ] : null ) ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 0fbb12a . . ffd6203 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 471 , 6 + 471 , 11 @ @ public class NodeProbe 
 ssProxy . move ( newToken ) ; 
 } 
 
 + public void takeTokens ( String [ ] tokens ) throws IOException 
 + { 
 + ssProxy . relocate ( Arrays . asList ( tokens ) ) ; 
 + } 
 + 
 public void removeNode ( String token ) 
 { 
 ssProxy . removeNode ( token ) ; 
 diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 index b28e300 . . 8eacf2f 100644 
 - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 @ @ - 115 , 6 + 115 , 9 @ @ commands : 
 - name : move < new token > 
 help : | 
 Move node on the token ring to a new token . ( for negative tokens , use \ \ to escape , Example : move \ \ - 123 ) 
 + - name : taketoken < token , . . . > 
 + help : | 
 + Move the token ( s ) from the existing owner ( s ) to this node . For vnodes only . Use \ \ to escape negative tokens . 
 - name : removenode status | force | < ID > 
 help : | 
 Show status of current node removal , force completion of pending removal or remove provided ID

NEAREST DIFF:
ELIMINATEDSENTENCE
