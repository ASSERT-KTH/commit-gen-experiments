BLEU SCORE: 0.029079340872079116

TEST MSG: merge fixes for CASSANDRA - 8452
GENERATED MSG: Clean up IsWindows check , add hasProc check

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index c34c6ea . . 958cf8c 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 177 , 7 + 177 , 15 @ @ public class DatabaseDescriptor <nl> if ( conf . commitlog _ total _ space _ in _ mb = = null ) <nl> conf . commitlog _ total _ space _ in _ mb = hasLargeAddressSpace ( ) ? 8192 : 32 ; <nl> <nl> - if ( FBUtilities . isUnix ( ) ) <nl> + / / Always force standard mode access on Windows - CASSANDRA - 6993 . Windows won ' t allow deletion of hard - links to files that <nl> + / / are memory - mapped which causes trouble with snapshots . <nl> + if ( FBUtilities . isWindows ( ) ) <nl> + { <nl> + conf . disk _ access _ mode = Config . DiskAccessMode . standard ; <nl> + indexAccessMode = conf . disk _ access _ mode ; <nl> + logger . info ( " Non - unix environment detected . DiskAccessMode set to { } , indexAccessMode { } " , conf . disk _ access _ mode , indexAccessMode ) ; <nl> + } <nl> + else <nl> { <nl> / * evaluate the DiskAccessMode Config directive , which also affects indexAccessMode selection * / <nl> if ( conf . disk _ access _ mode = = Config . DiskAccessMode . auto ) <nl> @ @ - 198 , 14 + 206 , 6 @ @ public class DatabaseDescriptor <nl> logger . info ( " DiskAccessMode is { } , indexAccessMode is { } " , conf . disk _ access _ mode , indexAccessMode ) ; <nl> } <nl> } <nl> - / / Always force standard mode access on Windows - CASSANDRA - 6993 . Windows won ' t allow deletion of hard - links to files that <nl> - / / are memory - mapped which causes trouble with snapshots . <nl> - else <nl> - { <nl> - conf . disk _ access _ mode = Config . DiskAccessMode . standard ; <nl> - indexAccessMode = conf . disk _ access _ mode ; <nl> - logger . info ( " Non - unix environment detected . DiskAccessMode set to { } , indexAccessMode { } " , conf . disk _ access _ mode , indexAccessMode ) ; <nl> - } <nl> <nl> / * Authentication and authorization backend , implementing IAuthenticator and IAuthorizer * / <nl> if ( conf . authenticator ! = null ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index f646d87 . . 999d6b6 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2536 , 6 + 2536 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> boolean fullRepair , <nl> String . . . columnFamilies ) <nl> { <nl> + if ( FBUtilities . isWindows ( ) & & parallelismDegree ! = RepairParallelism . PARALLEL ) <nl> { <nl> logger . warn ( " Snapshot - based repair is not yet supported on Windows . Reverting to parallel repair . " ) ; <nl> parallelismDegree = RepairParallelism . PARALLEL ; <nl> diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> index c41a6c0 . . 8077df8 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> @ @ - 70 , 8 + 70 , 8 @ @ public class FBUtilities <nl> public static final BigInteger TWO = new BigInteger ( " 2 " ) ; <nl> private static final String DEFAULT _ TRIGGER _ DIR = " triggers " ; <nl> <nl> + private static final String OPERATING _ SYSTEM = System . getProperty ( " os . name " ) . toLowerCase ( ) ; <nl> private static final boolean IS _ WINDOWS = OPERATING _ SYSTEM . contains ( " windows " ) ; <nl> - <nl> private static final boolean HAS _ PROCFS = ! IS _ WINDOWS & & ( new File ( File . separator + " proc " ) ) . exists ( ) ; <nl> <nl> private static volatile InetAddress localInetAddress ; <nl> diff - - git a / src / java / org / apache / cassandra / utils / SigarLibrary . java b / src / java / org / apache / cassandra / utils / SigarLibrary . java <nl> index bcfa58e . . fb3d3ae 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / SigarLibrary . java <nl> + + + b / src / java / org / apache / cassandra / utils / SigarLibrary . java <nl> @ @ - 110 , 7 + 110 , 7 @ @ public class SigarLibrary <nl> private boolean hasAcceptableAddressSpace ( ) <nl> { <nl> / / Check is invalid on Windows <nl> - if ( ! FBUtilities . isUnix ( ) ) <nl> + if ( FBUtilities . isWindows ( ) ) <nl> return true ; <nl> <nl> try <nl> diff - - git a / test / pig / org / apache / pig / test / MiniCluster . java b / test / pig / org / apache / pig / test / MiniCluster . java <nl> index ad50f69 . . aa03861 100644 <nl> - - - a / test / pig / org / apache / pig / test / MiniCluster . java <nl> + + + b / test / pig / org / apache / pig / test / MiniCluster . java <nl> @ @ - 50 , 7 + 50 , 7 @ @ public class MiniCluster extends MiniGenericCluster { <nl> <nl> / / Builds and starts the mini dfs and mapreduce clusters <nl> Configuration config = new Configuration ( ) ; <nl> - if ( ! FBUtilities . isUnix ( ) ) <nl> + if ( FBUtilities . isWindows ( ) ) <nl> config . set ( " fs . file . impl " , WindowsLocalFileSystem . class . getName ( ) ) ; <nl> m _ dfs = new MiniDFSCluster ( config , dataNodes , true , null ) ; <nl> m _ fileSys = m _ dfs . getFileSystem ( ) ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index c34c6ea . . 958cf8c 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 177 , 7 + 177 , 15 @ @ public class DatabaseDescriptor 
 if ( conf . commitlog _ total _ space _ in _ mb = = null ) 
 conf . commitlog _ total _ space _ in _ mb = hasLargeAddressSpace ( ) ? 8192 : 32 ; 
 
 - if ( FBUtilities . isUnix ( ) ) 
 + / / Always force standard mode access on Windows - CASSANDRA - 6993 . Windows won ' t allow deletion of hard - links to files that 
 + / / are memory - mapped which causes trouble with snapshots . 
 + if ( FBUtilities . isWindows ( ) ) 
 + { 
 + conf . disk _ access _ mode = Config . DiskAccessMode . standard ; 
 + indexAccessMode = conf . disk _ access _ mode ; 
 + logger . info ( " Non - unix environment detected . DiskAccessMode set to { } , indexAccessMode { } " , conf . disk _ access _ mode , indexAccessMode ) ; 
 + } 
 + else 
 { 
 / * evaluate the DiskAccessMode Config directive , which also affects indexAccessMode selection * / 
 if ( conf . disk _ access _ mode = = Config . DiskAccessMode . auto ) 
 @ @ - 198 , 14 + 206 , 6 @ @ public class DatabaseDescriptor 
 logger . info ( " DiskAccessMode is { } , indexAccessMode is { } " , conf . disk _ access _ mode , indexAccessMode ) ; 
 } 
 } 
 - / / Always force standard mode access on Windows - CASSANDRA - 6993 . Windows won ' t allow deletion of hard - links to files that 
 - / / are memory - mapped which causes trouble with snapshots . 
 - else 
 - { 
 - conf . disk _ access _ mode = Config . DiskAccessMode . standard ; 
 - indexAccessMode = conf . disk _ access _ mode ; 
 - logger . info ( " Non - unix environment detected . DiskAccessMode set to { } , indexAccessMode { } " , conf . disk _ access _ mode , indexAccessMode ) ; 
 - } 
 
 / * Authentication and authorization backend , implementing IAuthenticator and IAuthorizer * / 
 if ( conf . authenticator ! = null ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index f646d87 . . 999d6b6 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2536 , 6 + 2536 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 boolean fullRepair , 
 String . . . columnFamilies ) 
 { 
 + if ( FBUtilities . isWindows ( ) & & parallelismDegree ! = RepairParallelism . PARALLEL ) 
 { 
 logger . warn ( " Snapshot - based repair is not yet supported on Windows . Reverting to parallel repair . " ) ; 
 parallelismDegree = RepairParallelism . PARALLEL ; 
 diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 index c41a6c0 . . 8077df8 100644 
 - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java 
 + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 @ @ - 70 , 8 + 70 , 8 @ @ public class FBUtilities 
 public static final BigInteger TWO = new BigInteger ( " 2 " ) ; 
 private static final String DEFAULT _ TRIGGER _ DIR = " triggers " ; 
 
 + private static final String OPERATING _ SYSTEM = System . getProperty ( " os . name " ) . toLowerCase ( ) ; 
 private static final boolean IS _ WINDOWS = OPERATING _ SYSTEM . contains ( " windows " ) ; 
 - 
 private static final boolean HAS _ PROCFS = ! IS _ WINDOWS & & ( new File ( File . separator + " proc " ) ) . exists ( ) ; 
 
 private static volatile InetAddress localInetAddress ; 
 diff - - git a / src / java / org / apache / cassandra / utils / SigarLibrary . java b / src / java / org / apache / cassandra / utils / SigarLibrary . java 
 index bcfa58e . . fb3d3ae 100644 
 - - - a / src / java / org / apache / cassandra / utils / SigarLibrary . java 
 + + + b / src / java / org / apache / cassandra / utils / SigarLibrary . java 
 @ @ - 110 , 7 + 110 , 7 @ @ public class SigarLibrary 
 private boolean hasAcceptableAddressSpace ( ) 
 { 
 / / Check is invalid on Windows 
 - if ( ! FBUtilities . isUnix ( ) ) 
 + if ( FBUtilities . isWindows ( ) ) 
 return true ; 
 
 try 
 diff - - git a / test / pig / org / apache / pig / test / MiniCluster . java b / test / pig / org / apache / pig / test / MiniCluster . java 
 index ad50f69 . . aa03861 100644 
 - - - a / test / pig / org / apache / pig / test / MiniCluster . java 
 + + + b / test / pig / org / apache / pig / test / MiniCluster . java 
 @ @ - 50 , 7 + 50 , 7 @ @ public class MiniCluster extends MiniGenericCluster { 
 
 / / Builds and starts the mini dfs and mapreduce clusters 
 Configuration config = new Configuration ( ) ; 
 - if ( ! FBUtilities . isUnix ( ) ) 
 + if ( FBUtilities . isWindows ( ) ) 
 config . set ( " fs . file . impl " , WindowsLocalFileSystem . class . getName ( ) ) ; 
 m _ dfs = new MiniDFSCluster ( config , dataNodes , true , null ) ; 
 m _ fileSys = m _ dfs . getFileSystem ( ) ;

NEAREST DIFF:
ELIMINATEDSENTENCE
