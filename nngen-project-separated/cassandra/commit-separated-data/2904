BLEU SCORE: 0.04767707020457096

TEST MSG: Expose a total memtable size metric for a CF
GENERATED MSG: Allow specifying datacentersto participate in a repair

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index bd8dd1c . . 644c6b3 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 2 , 6 + 2 , 7 @ @ <nl> * Fix divide - by - zero in PCI ( CASSANDRA - 6403 ) <nl> * Fix setting last compacted key in the wrong level for LCS ( CASSANDRA - 6284 ) <nl> * Add sub - ms precision formats to the timestamp parser ( CASSANDRA - 6395 ) <nl> + * Expose a total memtable size metric for a CF ( CASSANDRA - 6391 ) <nl> Merged from 1 . 2 : <nl> * Fix thundering herd on endpoint cache invalidation ( CASSANDRA - 6345 ) <nl> * cqlsh : quote single quotes in strings inside collections ( CASSANDRA - 6172 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index 137d597 . . eb715ac 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 1114 , 6 + 1114 , 18 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> return size ; <nl> } <nl> <nl> + / * * <nl> + * @ return the size of all the memtables , including the pending flush ones and 2i memtables , if any . <nl> + * / <nl> + public long getTotalAllMemtablesLiveSize ( ) <nl> + { <nl> + long size = getAllMemtablesLiveSize ( ) ; <nl> + if ( indexManager . hasIndexes ( ) ) <nl> + for ( ColumnFamilyStore index : indexManager . getIndexesBackedByCfs ( ) ) <nl> + size + = index . getAllMemtablesLiveSize ( ) ; <nl> + return size ; <nl> + } <nl> + <nl> public int getMemtableSwitchCount ( ) <nl> { <nl> return ( int ) metric . memtableSwitchCount . count ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java b / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java <nl> index aabf373 . . 30f01de 100644 <nl> - - - a / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java <nl> + + + b / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java <nl> @ @ - 36 , 6 + 36 , 8 @ @ public class ColumnFamilyMetrics <nl> { <nl> / * * Total amount of data stored in the memtable , including column related overhead . * / <nl> public final Gauge < Long > memtableDataSize ; <nl> + / * * Total amount of data stored in the memtables ( 2i and pending flush memtables included ) . * / <nl> + public final Gauge < Long > allMemtablesDataSize ; <nl> / * * Total number of columns present in the memtable . * / <nl> public final Gauge < Long > memtableColumnsCount ; <nl> / * * Number of times flush has resulted in the memtable being switched out . * / <nl> @ @ - 117 , 6 + 119 , 13 @ @ public class ColumnFamilyMetrics <nl> return cfs . getDataTracker ( ) . getMemtable ( ) . getLiveSize ( ) ; <nl> } <nl> } ) ; <nl> + allMemtablesDataSize = Metrics . newGauge ( factory . createMetricName ( " AllMemtablesDataSize " ) , new Gauge < Long > ( ) <nl> + { <nl> + public Long value ( ) <nl> + { <nl> + return cfs . getTotalAllMemtablesLiveSize ( ) ; <nl> + } <nl> + } ) ; <nl> memtableSwitchCount = Metrics . newCounter ( factory . createMetricName ( " MemtableSwitchCount " ) ) ; <nl> estimatedRowSizeHistogram = Metrics . newGauge ( factory . createMetricName ( " EstimatedRowSizeHistogram " ) , new Gauge < long [ ] > ( ) <nl> {
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index bd8dd1c . . 644c6b3 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 2 , 6 + 2 , 7 @ @ 
 * Fix divide - by - zero in PCI ( CASSANDRA - 6403 ) 
 * Fix setting last compacted key in the wrong level for LCS ( CASSANDRA - 6284 ) 
 * Add sub - ms precision formats to the timestamp parser ( CASSANDRA - 6395 ) 
 + * Expose a total memtable size metric for a CF ( CASSANDRA - 6391 ) 
 Merged from 1 . 2 : 
 * Fix thundering herd on endpoint cache invalidation ( CASSANDRA - 6345 ) 
 * cqlsh : quote single quotes in strings inside collections ( CASSANDRA - 6172 ) 
 diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index 137d597 . . eb715ac 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 1114 , 6 + 1114 , 18 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 return size ; 
 } 
 
 + / * * 
 + * @ return the size of all the memtables , including the pending flush ones and 2i memtables , if any . 
 + * / 
 + public long getTotalAllMemtablesLiveSize ( ) 
 + { 
 + long size = getAllMemtablesLiveSize ( ) ; 
 + if ( indexManager . hasIndexes ( ) ) 
 + for ( ColumnFamilyStore index : indexManager . getIndexesBackedByCfs ( ) ) 
 + size + = index . getAllMemtablesLiveSize ( ) ; 
 + return size ; 
 + } 
 + 
 public int getMemtableSwitchCount ( ) 
 { 
 return ( int ) metric . memtableSwitchCount . count ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java b / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java 
 index aabf373 . . 30f01de 100644 
 - - - a / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java 
 + + + b / src / java / org / apache / cassandra / metrics / ColumnFamilyMetrics . java 
 @ @ - 36 , 6 + 36 , 8 @ @ public class ColumnFamilyMetrics 
 { 
 / * * Total amount of data stored in the memtable , including column related overhead . * / 
 public final Gauge < Long > memtableDataSize ; 
 + / * * Total amount of data stored in the memtables ( 2i and pending flush memtables included ) . * / 
 + public final Gauge < Long > allMemtablesDataSize ; 
 / * * Total number of columns present in the memtable . * / 
 public final Gauge < Long > memtableColumnsCount ; 
 / * * Number of times flush has resulted in the memtable being switched out . * / 
 @ @ - 117 , 6 + 119 , 13 @ @ public class ColumnFamilyMetrics 
 return cfs . getDataTracker ( ) . getMemtable ( ) . getLiveSize ( ) ; 
 } 
 } ) ; 
 + allMemtablesDataSize = Metrics . newGauge ( factory . createMetricName ( " AllMemtablesDataSize " ) , new Gauge < Long > ( ) 
 + { 
 + public Long value ( ) 
 + { 
 + return cfs . getTotalAllMemtablesLiveSize ( ) ; 
 + } 
 + } ) ; 
 memtableSwitchCount = Metrics . newCounter ( factory . createMetricName ( " MemtableSwitchCount " ) ) ; 
 estimatedRowSizeHistogram = Metrics . newGauge ( factory . createMetricName ( " EstimatedRowSizeHistogram " ) , new Gauge < long [ ] > ( ) 
 {

NEAREST DIFF:
ELIMINATEDSENTENCE
