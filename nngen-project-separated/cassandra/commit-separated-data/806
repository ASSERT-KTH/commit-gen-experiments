BLEU SCORE: 0.015445276590783498

TEST MSG: Don ' t try to get sstables for non - repairing column families
GENERATED MSG: Fix AE when SSTable is closed without releasing reference

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 03246ae . . 620568d 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 15 <nl> + * Don ' t try to get sstables for non - repairing column families ( CASSANDRA - 12077 ) <nl> * Prevent select statements with clustering key > 64k ( CASSANDRA - 11882 ) <nl> * Avoid marking too many sstables as repaired ( CASSANDRA - 11696 ) <nl> * Fix clock skew corrupting other nodes with paxos ( CASSANDRA - 11991 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> index bab244d . . 4ca1e42 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> @ @ - 528 , 7 + 528 , 10 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> { <nl> assert marked . contains ( cfId ) ; <nl> ImmutableMap . Builder < SSTableReader , Ref < SSTableReader > > references = ImmutableMap . builder ( ) ; <nl> - for ( SSTableReader sstable : getActiveSSTables ( cfId ) ) <nl> + Iterable < SSTableReader > sstables = getActiveSSTables ( cfId ) ; <nl> + if ( sstables = = null ) <nl> + throw new RuntimeException ( " Not possible to get sstables for anticompaction for " + cfId ) ; <nl> + for ( SSTableReader sstable : sstables ) <nl> { <nl> Ref < SSTableReader > ref = sstable . tryRef ( ) ; <nl> if ( ref = = null ) <nl> @ @ - 567 , 6 + 570 , 9 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> { <nl> if ( failed ) <nl> return Collections . emptySet ( ) ; <nl> + if ( ! columnFamilyStores . containsKey ( cfId ) ) <nl> + return null ; <nl> + <nl> Set < String > repairedSSTables = sstableMap . get ( cfId ) ; <nl> Set < SSTableReader > activeSSTables = new HashSet < > ( ) ; <nl> Set < String > activeSSTableNames = new HashSet < > ( ) ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 03246ae . . 620568d 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 15 
 + * Don ' t try to get sstables for non - repairing column families ( CASSANDRA - 12077 ) 
 * Prevent select statements with clustering key > 64k ( CASSANDRA - 11882 ) 
 * Avoid marking too many sstables as repaired ( CASSANDRA - 11696 ) 
 * Fix clock skew corrupting other nodes with paxos ( CASSANDRA - 11991 ) 
 diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 index bab244d . . 4ca1e42 100644 
 - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 @ @ - 528 , 7 + 528 , 10 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 { 
 assert marked . contains ( cfId ) ; 
 ImmutableMap . Builder < SSTableReader , Ref < SSTableReader > > references = ImmutableMap . builder ( ) ; 
 - for ( SSTableReader sstable : getActiveSSTables ( cfId ) ) 
 + Iterable < SSTableReader > sstables = getActiveSSTables ( cfId ) ; 
 + if ( sstables = = null ) 
 + throw new RuntimeException ( " Not possible to get sstables for anticompaction for " + cfId ) ; 
 + for ( SSTableReader sstable : sstables ) 
 { 
 Ref < SSTableReader > ref = sstable . tryRef ( ) ; 
 if ( ref = = null ) 
 @ @ - 567 , 6 + 570 , 9 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 { 
 if ( failed ) 
 return Collections . emptySet ( ) ; 
 + if ( ! columnFamilyStores . containsKey ( cfId ) ) 
 + return null ; 
 + 
 Set < String > repairedSSTables = sstableMap . get ( cfId ) ; 
 Set < SSTableReader > activeSSTables = new HashSet < > ( ) ; 
 Set < String > activeSSTableNames = new HashSet < > ( ) ;

NEAREST DIFF:
ELIMINATEDSENTENCE
