BLEU SCORE: 0.018738883683389617

TEST MSG: Slice . isEmpty ( ) returns false for some empty slices
GENERATED MSG: Fix handling of clustering key > 64K

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 0979852 . . 1876922 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 . 13 <nl> + * Slice . isEmpty ( ) returns false for some empty slices ( CASSANDRA - 13305 ) <nl> * Add formatted row output to assertEmpty in CQL Tester ( CASSANDRA - 13238 ) <nl> Merged from 2 . 2 : <nl> * Fix GRANT / REVOKE when keyspace isn ' t specified ( CASSANDRA - 13053 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / Slice . java b / src / java / org / apache / cassandra / db / Slice . java <nl> index 7fde45e . . 3c645dc 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Slice . java <nl> + + + b / src / java / org / apache / cassandra / db / Slice . java <nl> @ @ - 160 , 7 + 160 , 7 @ @ public class Slice <nl> public static boolean isEmpty ( ClusteringComparator comparator , Slice . Bound start , Slice . Bound end ) <nl> { <nl> assert start . isStart ( ) & & end . isEnd ( ) ; <nl> - return comparator . compare ( end , start ) < 0 ; <nl> + return comparator . compare ( end , start ) < = 0 ; <nl> } <nl> <nl> / * * <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java b / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java <nl> index 09098ac . . 9d7d4a3 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java <nl> @ @ - 1292 , 6 + 1292 , 24 @ @ public class DeleteTest extends CQLTester <nl> } <nl> <nl> / * * <nl> + * Test for CASSANDRA - 13305 <nl> + * / <nl> + @ Test <nl> + public void testWithEmptyRange ( ) throws Throwable <nl> + { <nl> + createTable ( " CREATE TABLE % s ( k text , a int , b int , PRIMARY KEY ( k , a , b ) ) " ) ; <nl> + <nl> + / / Both of the following should be doing nothing , but before # 13305 this inserted broken ranges . We do it twice <nl> + / / and the follow - up delete mainly as a way to show the bug as the combination of this will trigger an assertion <nl> + / / in RangeTombstoneList pre - # 13305 showing that something wrong happened . <nl> + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 1 , 1 ) ; <nl> + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 1 , 1 ) ; <nl> + <nl> + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 0 , 2 ) ; <nl> + } <nl> + <nl> + <nl> + / * * <nl> * Checks if the memtable is empty or not <nl> * @ return { @ code true } if the memtable is empty , { @ code false } otherwise . <nl> * /
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 0979852 . . 1876922 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 . 13 
 + * Slice . isEmpty ( ) returns false for some empty slices ( CASSANDRA - 13305 ) 
 * Add formatted row output to assertEmpty in CQL Tester ( CASSANDRA - 13238 ) 
 Merged from 2 . 2 : 
 * Fix GRANT / REVOKE when keyspace isn ' t specified ( CASSANDRA - 13053 ) 
 diff - - git a / src / java / org / apache / cassandra / db / Slice . java b / src / java / org / apache / cassandra / db / Slice . java 
 index 7fde45e . . 3c645dc 100644 
 - - - a / src / java / org / apache / cassandra / db / Slice . java 
 + + + b / src / java / org / apache / cassandra / db / Slice . java 
 @ @ - 160 , 7 + 160 , 7 @ @ public class Slice 
 public static boolean isEmpty ( ClusteringComparator comparator , Slice . Bound start , Slice . Bound end ) 
 { 
 assert start . isStart ( ) & & end . isEnd ( ) ; 
 - return comparator . compare ( end , start ) < 0 ; 
 + return comparator . compare ( end , start ) < = 0 ; 
 } 
 
 / * * 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java b / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java 
 index 09098ac . . 9d7d4a3 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / validation / operations / DeleteTest . java 
 @ @ - 1292 , 6 + 1292 , 24 @ @ public class DeleteTest extends CQLTester 
 } 
 
 / * * 
 + * Test for CASSANDRA - 13305 
 + * / 
 + @ Test 
 + public void testWithEmptyRange ( ) throws Throwable 
 + { 
 + createTable ( " CREATE TABLE % s ( k text , a int , b int , PRIMARY KEY ( k , a , b ) ) " ) ; 
 + 
 + / / Both of the following should be doing nothing , but before # 13305 this inserted broken ranges . We do it twice 
 + / / and the follow - up delete mainly as a way to show the bug as the combination of this will trigger an assertion 
 + / / in RangeTombstoneList pre - # 13305 showing that something wrong happened . 
 + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 1 , 1 ) ; 
 + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 1 , 1 ) ; 
 + 
 + execute ( " DELETE FROM % s WHERE k = ? AND a > = ? AND a < ? " , " a " , 0 , 2 ) ; 
 + } 
 + 
 + 
 + / * * 
 * Checks if the memtable is empty or not 
 * @ return { @ code true } if the memtable is empty , { @ code false } otherwise . 
 * /

NEAREST DIFF:
ELIMINATEDSENTENCE
