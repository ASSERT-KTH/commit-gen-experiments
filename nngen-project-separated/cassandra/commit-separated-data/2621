BLEU SCORE: 0.0023896850342985314

TEST MSG: Remove sync repair JMX interface
GENERATED MSG: Skip repair on system _ trace and keyspaces with RF = 1 ; patch by yukim reviewed by Sylvain Lebresne for CASSANDRA - 4956

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 21d4d5a . . 1b39e30 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 28 , 6 + 28 , 7 @ @ <nl> * Update native server to Netty 4 ( CASSANDRA - 6236 ) <nl> * Fix off - by - one error in stress ( CASSANDRA - 6883 ) <nl> * Make OpOrder AutoCloseable ( CASSANDRA - 6901 ) <nl> + * Remove sync repair JMX interface ( CASSANDRA - 6900 ) <nl> Merged from 2 . 0 : <nl> * Allow deleting snapshots from dropped keyspaces ( CASSANDRA - 6821 ) <nl> * Add uuid ( ) function ( CASSANDRA - 6473 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 16d8628 . . 57fbaf0 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2531 , 40 + 2531 , 6 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> return forceRepairAsync ( keyspaceName , isSequential , isLocal , Collections . singleton ( new Range < Token > ( parsedBeginToken , parsedEndToken ) ) , fullRepair , columnFamilies ) ; <nl> } <nl> <nl> - <nl> - / * * <nl> - * Trigger proactive repair for a keyspace and column families . <nl> - * @ param keyspaceName <nl> - * @ param columnFamilies <nl> - * @ throws IOException <nl> - * / <nl> - public void forceKeyspaceRepair ( final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException <nl> - { <nl> - forceKeyspaceRepairRange ( keyspaceName , getLocalRanges ( keyspaceName ) , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> - public void forceKeyspaceRepairPrimaryRange ( final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException <nl> - { <nl> - forceKeyspaceRepairRange ( keyspaceName , getLocalPrimaryRanges ( keyspaceName ) , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> - public void forceKeyspaceRepairRange ( String beginToken , String endToken , final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException <nl> - { <nl> - Token parsedBeginToken = getPartitioner ( ) . getTokenFactory ( ) . fromString ( beginToken ) ; <nl> - Token parsedEndToken = getPartitioner ( ) . getTokenFactory ( ) . fromString ( endToken ) ; <nl> - <nl> - logger . info ( " starting user - requested repair of range ( { } , { } ] for keyspace { } and column families { } " , <nl> - parsedBeginToken , parsedEndToken , keyspaceName , columnFamilies ) ; <nl> - forceKeyspaceRepairRange ( keyspaceName , Collections . singleton ( new Range < Token > ( parsedBeginToken , parsedEndToken ) ) , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> - public void forceKeyspaceRepairRange ( final String keyspaceName , final Collection < Range < Token > > ranges , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException <nl> - { <nl> - if ( Keyspace . SYSTEM _ KS . equalsIgnoreCase ( keyspaceName ) ) <nl> - return ; <nl> - createRepairTask ( nextRepairCommand . incrementAndGet ( ) , keyspaceName , ranges , isSequential , isLocal , fullRepair , columnFamilies ) . run ( ) ; <nl> - } <nl> - <nl> private FutureTask < Object > createRepairTask ( final int cmd , <nl> final String keyspace , <nl> final Collection < Range < Token > > ranges , <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index efe7b06 . . aab8dcb 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 279 , 7 + 279 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> * / <nl> public int forceRepairRangeAsync ( String beginToken , String endToken , String keyspaceName , boolean isSequential , Collection < String > dataCenters , Collection < String > hosts , boolean repairedAt , String . . . columnFamilies ) throws IOException ; <nl> <nl> - <nl> / * * <nl> * Invoke repair asynchronously . <nl> * You can track repair progress by subscribing JMX notification sent from this StorageServiceMBean . <nl> @ @ - 288 , 7 + 287 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> * userObject : int array of length 2 , [ 0 ] = command number , [ 1 ] = ordinal of AntiEntropyService . Status <nl> * <nl> * @ return Repair command number , or 0 if nothing to repair <nl> - * @ see # forceKeyspaceRepair ( String , boolean , boolean , boolean , String . . . ) <nl> * / <nl> public int forceRepairAsync ( String keyspace , boolean isSequential , boolean isLocal , boolean primaryRange , boolean fullRepair , String . . . columnFamilies ) ; <nl> <nl> @ @ - 297 , 28 + 295 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> * / <nl> public int forceRepairRangeAsync ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) ; <nl> <nl> - / * * <nl> - * Triggers proactive repair for given column families , or all columnfamilies for the given keyspace <nl> - * if none are explicitly listed . <nl> - * @ param keyspaceName <nl> - * @ param columnFamilies <nl> - * @ throws IOException <nl> - * / <nl> - public void forceKeyspaceRepair ( String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; <nl> - <nl> - / * * <nl> - * Triggers proactive repair but only for the node primary range . <nl> - * / <nl> - public void forceKeyspaceRepairPrimaryRange ( String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; <nl> - <nl> - / * * <nl> - * Perform repair of a specific range . <nl> - * <nl> - * This allows incremental repair to be performed by having an external controller submitting repair jobs . <nl> - * Note that the provided range much be a subset of one of the node local range . <nl> - * / <nl> - public void forceKeyspaceRepairRange ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; <nl> - <nl> public void forceTerminateAllRepairSessions ( ) ; <nl> <nl> / * * <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 5cca56e . . d4cef15 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 245 , 11 + 245 , 6 @ @ public class NodeProbe implements AutoCloseable <nl> ssProxy . forceKeyspaceFlush ( keyspaceName , columnFamilies ) ; <nl> } <nl> <nl> - public void forceKeyspaceRepair ( String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException <nl> - { <nl> - ssProxy . forceKeyspaceRepair ( keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> public void forceRepairAsync ( final PrintStream out , final String keyspaceName , boolean isSequential , Collection < String > dataCenters , Collection < String > hosts , boolean primaryRange , boolean fullRepair , String . . . columnFamilies ) throws IOException <nl> { <nl> RepairRunner runner = new RepairRunner ( out , keyspaceName , columnFamilies ) ; <nl> @ @ - 306 , 16 + 301 , 6 @ @ public class NodeProbe implements AutoCloseable <nl> } <nl> } <nl> <nl> - public void forceKeyspaceRepairPrimaryRange ( String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException <nl> - { <nl> - ssProxy . forceKeyspaceRepairPrimaryRange ( keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> - public void forceKeyspaceRepairRange ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException <nl> - { <nl> - ssProxy . forceKeyspaceRepairRange ( beginToken , endToken , keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; <nl> - } <nl> - <nl> public void invalidateCounterCache ( ) <nl> { <nl> cacheService . invalidateCounterCache ( ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index a8b14b2 . . 476af88 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 279 , 7 + 279 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> / / 5 . Do major compaction to clean up all deletes etc . <nl> <nl> / / find the hints for the node using its token . <nl> - UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( endpoint ) ; <nl> + UUID hostId = Gossiper . instance . getHostId ( endpoint ) ; <nl> logger . info ( " Started hinted handoff for host : { } with IP : { } " , hostId , endpoint ) ; <nl> final ByteBuffer hostIdBytes = ByteBuffer . wrap ( UUIDGen . decompose ( hostId ) ) ; <nl> DecoratedKey epkey = StorageService . getPartitioner ( ) . decorateKey ( hostIdBytes ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 21d4d5a . . 1b39e30 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 28 , 6 + 28 , 7 @ @ 
 * Update native server to Netty 4 ( CASSANDRA - 6236 ) 
 * Fix off - by - one error in stress ( CASSANDRA - 6883 ) 
 * Make OpOrder AutoCloseable ( CASSANDRA - 6901 ) 
 + * Remove sync repair JMX interface ( CASSANDRA - 6900 ) 
 Merged from 2 . 0 : 
 * Allow deleting snapshots from dropped keyspaces ( CASSANDRA - 6821 ) 
 * Add uuid ( ) function ( CASSANDRA - 6473 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 16d8628 . . 57fbaf0 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2531 , 40 + 2531 , 6 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 return forceRepairAsync ( keyspaceName , isSequential , isLocal , Collections . singleton ( new Range < Token > ( parsedBeginToken , parsedEndToken ) ) , fullRepair , columnFamilies ) ; 
 } 
 
 - 
 - / * * 
 - * Trigger proactive repair for a keyspace and column families . 
 - * @ param keyspaceName 
 - * @ param columnFamilies 
 - * @ throws IOException 
 - * / 
 - public void forceKeyspaceRepair ( final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException 
 - { 
 - forceKeyspaceRepairRange ( keyspaceName , getLocalRanges ( keyspaceName ) , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 - public void forceKeyspaceRepairPrimaryRange ( final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException 
 - { 
 - forceKeyspaceRepairRange ( keyspaceName , getLocalPrimaryRanges ( keyspaceName ) , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 - public void forceKeyspaceRepairRange ( String beginToken , String endToken , final String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException 
 - { 
 - Token parsedBeginToken = getPartitioner ( ) . getTokenFactory ( ) . fromString ( beginToken ) ; 
 - Token parsedEndToken = getPartitioner ( ) . getTokenFactory ( ) . fromString ( endToken ) ; 
 - 
 - logger . info ( " starting user - requested repair of range ( { } , { } ] for keyspace { } and column families { } " , 
 - parsedBeginToken , parsedEndToken , keyspaceName , columnFamilies ) ; 
 - forceKeyspaceRepairRange ( keyspaceName , Collections . singleton ( new Range < Token > ( parsedBeginToken , parsedEndToken ) ) , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 - public void forceKeyspaceRepairRange ( final String keyspaceName , final Collection < Range < Token > > ranges , boolean isSequential , boolean isLocal , boolean fullRepair , final String . . . columnFamilies ) throws IOException 
 - { 
 - if ( Keyspace . SYSTEM _ KS . equalsIgnoreCase ( keyspaceName ) ) 
 - return ; 
 - createRepairTask ( nextRepairCommand . incrementAndGet ( ) , keyspaceName , ranges , isSequential , isLocal , fullRepair , columnFamilies ) . run ( ) ; 
 - } 
 - 
 private FutureTask < Object > createRepairTask ( final int cmd , 
 final String keyspace , 
 final Collection < Range < Token > > ranges , 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index efe7b06 . . aab8dcb 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 279 , 7 + 279 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 * / 
 public int forceRepairRangeAsync ( String beginToken , String endToken , String keyspaceName , boolean isSequential , Collection < String > dataCenters , Collection < String > hosts , boolean repairedAt , String . . . columnFamilies ) throws IOException ; 
 
 - 
 / * * 
 * Invoke repair asynchronously . 
 * You can track repair progress by subscribing JMX notification sent from this StorageServiceMBean . 
 @ @ - 288 , 7 + 287 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 * userObject : int array of length 2 , [ 0 ] = command number , [ 1 ] = ordinal of AntiEntropyService . Status 
 * 
 * @ return Repair command number , or 0 if nothing to repair 
 - * @ see # forceKeyspaceRepair ( String , boolean , boolean , boolean , String . . . ) 
 * / 
 public int forceRepairAsync ( String keyspace , boolean isSequential , boolean isLocal , boolean primaryRange , boolean fullRepair , String . . . columnFamilies ) ; 
 
 @ @ - 297 , 28 + 295 , 6 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 * / 
 public int forceRepairRangeAsync ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) ; 
 
 - / * * 
 - * Triggers proactive repair for given column families , or all columnfamilies for the given keyspace 
 - * if none are explicitly listed . 
 - * @ param keyspaceName 
 - * @ param columnFamilies 
 - * @ throws IOException 
 - * / 
 - public void forceKeyspaceRepair ( String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; 
 - 
 - / * * 
 - * Triggers proactive repair but only for the node primary range . 
 - * / 
 - public void forceKeyspaceRepairPrimaryRange ( String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; 
 - 
 - / * * 
 - * Perform repair of a specific range . 
 - * 
 - * This allows incremental repair to be performed by having an external controller submitting repair jobs . 
 - * Note that the provided range much be a subset of one of the node local range . 
 - * / 
 - public void forceKeyspaceRepairRange ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean repairedAt , String . . . columnFamilies ) throws IOException ; 
 - 
 public void forceTerminateAllRepairSessions ( ) ; 
 
 / * * 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 5cca56e . . d4cef15 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 245 , 11 + 245 , 6 @ @ public class NodeProbe implements AutoCloseable 
 ssProxy . forceKeyspaceFlush ( keyspaceName , columnFamilies ) ; 
 } 
 
 - public void forceKeyspaceRepair ( String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException 
 - { 
 - ssProxy . forceKeyspaceRepair ( keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 public void forceRepairAsync ( final PrintStream out , final String keyspaceName , boolean isSequential , Collection < String > dataCenters , Collection < String > hosts , boolean primaryRange , boolean fullRepair , String . . . columnFamilies ) throws IOException 
 { 
 RepairRunner runner = new RepairRunner ( out , keyspaceName , columnFamilies ) ; 
 @ @ - 306 , 16 + 301 , 6 @ @ public class NodeProbe implements AutoCloseable 
 } 
 } 
 
 - public void forceKeyspaceRepairPrimaryRange ( String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException 
 - { 
 - ssProxy . forceKeyspaceRepairPrimaryRange ( keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 - public void forceKeyspaceRepairRange ( String beginToken , String endToken , String keyspaceName , boolean isSequential , boolean isLocal , boolean fullRepair , String . . . columnFamilies ) throws IOException 
 - { 
 - ssProxy . forceKeyspaceRepairRange ( beginToken , endToken , keyspaceName , isSequential , isLocal , fullRepair , columnFamilies ) ; 
 - } 
 - 
 public void invalidateCounterCache ( ) 
 { 
 cacheService . invalidateCounterCache ( ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index a8b14b2 . . 476af88 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 279 , 7 + 279 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 / / 5 . Do major compaction to clean up all deletes etc . 
 
 / / find the hints for the node using its token . 
 - UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( endpoint ) ; 
 + UUID hostId = Gossiper . instance . getHostId ( endpoint ) ; 
 logger . info ( " Started hinted handoff for host : { } with IP : { } " , hostId , endpoint ) ; 
 final ByteBuffer hostIdBytes = ByteBuffer . wrap ( UUIDGen . decompose ( hostId ) ) ; 
 DecoratedKey epkey = StorageService . getPartitioner ( ) . decorateKey ( hostIdBytes ) ;
