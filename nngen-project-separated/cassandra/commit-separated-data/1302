BLEU SCORE: 0.02132081946882163

TEST MSG: Print versions for gossip states in gossipinfo .
GENERATED MSG: expose endpoint states to jmx . patch by gdusbabek , reviewed by jbellis . CASSANDRA - 1467

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / gms / FailureDetector . java b / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> index 8fdd99f . . edbe578 100644 <nl> - - - a / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> + + + b / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> @ @ - 148 , 7 + 148 , 15 @ @ public class FailureDetector implements IFailureDetector , FailureDetectorMBean <nl> { <nl> if ( state . getKey ( ) = = ApplicationState . TOKENS ) <nl> continue ; <nl> - sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . value ) . append ( " \ n " ) ; <nl> + sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . version ) . append ( " : " ) . append ( state . getValue ( ) . value ) . append ( " \ n " ) ; <nl> + } <nl> + if ( endpointState . applicationState . containsKey ( ApplicationState . TOKENS ) ) <nl> + { <nl> + sb . append ( " TOKENS : " ) . append ( endpointState . applicationState . get ( ApplicationState . TOKENS ) . version ) . append ( " : < hidden > \ n " ) ; <nl> + } <nl> + else <nl> + { <nl> + sb . append ( " TOKENS : not present " ) ; <nl> } <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / gms / FailureDetector . java b / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> index 20d0276 . . c7924ea 100644 <nl> - - - a / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> + + + b / src / java / org / apache / cassandra / gms / FailureDetector . java <nl> @ @ - 70 , 6 + 70 , 18 @ @ public class FailureDetector implements IFailureDetector , FailureDetectorMBean <nl> } <nl> } <nl> <nl> + public String getAllEndpointStates ( ) <nl> + { <nl> + StringBuilder sb = new StringBuilder ( ) ; <nl> + for ( Map . Entry < InetAddress , EndpointState > entry : Gossiper . instance . endpointStateMap _ . entrySet ( ) ) <nl> + { <nl> + sb . append ( entry . getKey ( ) ) . append ( " \ n " ) ; <nl> + for ( Map . Entry < String , ApplicationState > state : entry . getValue ( ) . applicationState _ . entrySet ( ) ) <nl> + sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . getValue ( ) ) . append ( " \ n " ) ; <nl> + } <nl> + return sb . toString ( ) ; <nl> + } <nl> + <nl> / * * <nl> * Dump the inter arrival times for examination if necessary . <nl> * / <nl> diff - - git a / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java b / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java <nl> index d7411fc . . 557fc3c 100644 <nl> - - - a / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java <nl> + + + b / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java <nl> @ @ - 25 , 4 + 25 , 6 @ @ public interface FailureDetectorMBean <nl> public void setPhiConvictThreshold ( int phi ) ; <nl> <nl> public int getPhiConvictThreshold ( ) ; <nl> + <nl> + public String getAllEndpointStates ( ) ; <nl> }

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / gms / FailureDetector . java b / src / java / org / apache / cassandra / gms / FailureDetector . java 
 index 8fdd99f . . edbe578 100644 
 - - - a / src / java / org / apache / cassandra / gms / FailureDetector . java 
 + + + b / src / java / org / apache / cassandra / gms / FailureDetector . java 
 @ @ - 148 , 7 + 148 , 15 @ @ public class FailureDetector implements IFailureDetector , FailureDetectorMBean 
 { 
 if ( state . getKey ( ) = = ApplicationState . TOKENS ) 
 continue ; 
 - sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . value ) . append ( " \ n " ) ; 
 + sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . version ) . append ( " : " ) . append ( state . getValue ( ) . value ) . append ( " \ n " ) ; 
 + } 
 + if ( endpointState . applicationState . containsKey ( ApplicationState . TOKENS ) ) 
 + { 
 + sb . append ( " TOKENS : " ) . append ( endpointState . applicationState . get ( ApplicationState . TOKENS ) . version ) . append ( " : < hidden > \ n " ) ; 
 + } 
 + else 
 + { 
 + sb . append ( " TOKENS : not present " ) ; 
 } 
 } 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / gms / FailureDetector . java b / src / java / org / apache / cassandra / gms / FailureDetector . java 
 index 20d0276 . . c7924ea 100644 
 - - - a / src / java / org / apache / cassandra / gms / FailureDetector . java 
 + + + b / src / java / org / apache / cassandra / gms / FailureDetector . java 
 @ @ - 70 , 6 + 70 , 18 @ @ public class FailureDetector implements IFailureDetector , FailureDetectorMBean 
 } 
 } 
 
 + public String getAllEndpointStates ( ) 
 + { 
 + StringBuilder sb = new StringBuilder ( ) ; 
 + for ( Map . Entry < InetAddress , EndpointState > entry : Gossiper . instance . endpointStateMap _ . entrySet ( ) ) 
 + { 
 + sb . append ( entry . getKey ( ) ) . append ( " \ n " ) ; 
 + for ( Map . Entry < String , ApplicationState > state : entry . getValue ( ) . applicationState _ . entrySet ( ) ) 
 + sb . append ( " " ) . append ( state . getKey ( ) ) . append ( " : " ) . append ( state . getValue ( ) . getValue ( ) ) . append ( " \ n " ) ; 
 + } 
 + return sb . toString ( ) ; 
 + } 
 + 
 / * * 
 * Dump the inter arrival times for examination if necessary . 
 * / 
 diff - - git a / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java b / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java 
 index d7411fc . . 557fc3c 100644 
 - - - a / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java 
 + + + b / src / java / org / apache / cassandra / gms / FailureDetectorMBean . java 
 @ @ - 25 , 4 + 25 , 6 @ @ public interface FailureDetectorMBean 
 public void setPhiConvictThreshold ( int phi ) ; 
 
 public int getPhiConvictThreshold ( ) ; 
 + 
 + public String getAllEndpointStates ( ) ; 
 }
