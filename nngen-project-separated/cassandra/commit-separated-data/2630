BLEU SCORE: 0.020998444584734318

TEST MSG: Omit tombstones from schema digests
GENERATED MSG: fix temporarily missing schema after upgrade from pre - 1 . 1 . 5

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7eebd5b . . 650f12c 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 7 <nl> + * Omit tombstones from schema digests ( CASSANDRA - 6862 ) <nl> * Include correct consistencyLevel in LWT timeout ( CASSANDRA - 6884 ) <nl> * Lower chances for losing new SSTables during nodetool refresh and <nl> ColumnFamilyStore . loadNewSSTables ( CASSANDRA - 6514 ) <nl> diff - - git a / src / java / org / apache / cassandra / config / Schema . java b / src / java / org / apache / cassandra / config / Schema . java <nl> index 0907177 . . f0a49dc 100644 <nl> - - - a / src / java / org / apache / cassandra / config / Schema . java <nl> + + + b / src / java / org / apache / cassandra / config / Schema . java <nl> @ @ - 387 , 6 + 387 , 10 @ @ public class Schema <nl> if ( invalidSchemaRow ( row ) | | ignoredSchemaRow ( row ) ) <nl> continue ; <nl> <nl> + / / we want to digest only live columns <nl> + ColumnFamilyStore . removeDeletedColumnsOnly ( row . cf , Integer . MAX _ VALUE ) ; <nl> + row . cf . purgeTombstones ( Integer . MAX _ VALUE ) ; <nl> + <nl> row . cf . updateDigest ( versionDigest ) ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d73849c . . e09e925 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 5 + 1 , 7 @ @ <nl> 1 . 2 . 0 <nl> * cqlsh : add DESCRIBE KEYSPACES command ( CASSANDRA - 5060 ) <nl> + Merged from 1 . 1 : <nl> + * fix temporarily missing schema after upgrade from pre - 1 . 1 . 5 ( CASSANDRA - 5061 ) <nl> <nl> <nl> 1 . 2 - rc1 <nl> @ @ - 13 , 7 + 15 , 7 @ @ <nl> * Update IAuthenticator to match the new IAuthorizer ( CASSANDRA - 5003 ) <nl> * Fix inserting only a key in CQL3 ( CASSANDRA - 5040 ) <nl> * Fix CQL3 token ( ) function when used with strings ( CASSANDRA - 5050 ) <nl> - Merged from 1 . 1 <nl> + Merged from 1 . 1 : <nl> * reduce log spam from invalid counter shards ( CASSANDRA - 5026 ) <nl> * Improve schema propagation performance ( CASSANDRA - 5025 ) <nl> * Fix for IndexHelper . IndexFor throws OOB Exception ( CASSANDRA - 5030 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / DefsTable . java b / src / java / org / apache / cassandra / db / DefsTable . java <nl> index 8569553 . . a9f6427 100644 <nl> - - - a / src / java / org / apache / cassandra / db / DefsTable . java <nl> + + + b / src / java / org / apache / cassandra / db / DefsTable . java <nl> @ @ - 241 , 6 + 241 , 19 @ @ public class DefsTable <nl> <nl> mutation . apply ( ) ; <nl> } <nl> + / / flush immediately because we read schema before replaying the commitlog <nl> + try <nl> + { <nl> + cfs . forceBlockingFlush ( ) ; <nl> + } <nl> + catch ( ExecutionException e ) <nl> + { <nl> + throw new RuntimeException ( " Could not flush after fixing schema timestamps " , e ) ; <nl> + } <nl> + catch ( InterruptedException e ) <nl> + { <nl> + throw new AssertionError ( e ) ; <nl> + } <nl> } <nl> <nl> public static ByteBuffer searchComposite ( String name , boolean start )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7eebd5b . . 650f12c 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 7 
 + * Omit tombstones from schema digests ( CASSANDRA - 6862 ) 
 * Include correct consistencyLevel in LWT timeout ( CASSANDRA - 6884 ) 
 * Lower chances for losing new SSTables during nodetool refresh and 
 ColumnFamilyStore . loadNewSSTables ( CASSANDRA - 6514 ) 
 diff - - git a / src / java / org / apache / cassandra / config / Schema . java b / src / java / org / apache / cassandra / config / Schema . java 
 index 0907177 . . f0a49dc 100644 
 - - - a / src / java / org / apache / cassandra / config / Schema . java 
 + + + b / src / java / org / apache / cassandra / config / Schema . java 
 @ @ - 387 , 6 + 387 , 10 @ @ public class Schema 
 if ( invalidSchemaRow ( row ) | | ignoredSchemaRow ( row ) ) 
 continue ; 
 
 + / / we want to digest only live columns 
 + ColumnFamilyStore . removeDeletedColumnsOnly ( row . cf , Integer . MAX _ VALUE ) ; 
 + row . cf . purgeTombstones ( Integer . MAX _ VALUE ) ; 
 + 
 row . cf . updateDigest ( versionDigest ) ; 
 } 


NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d73849c . . e09e925 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 5 + 1 , 7 @ @ 
 1 . 2 . 0 
 * cqlsh : add DESCRIBE KEYSPACES command ( CASSANDRA - 5060 ) 
 + Merged from 1 . 1 : 
 + * fix temporarily missing schema after upgrade from pre - 1 . 1 . 5 ( CASSANDRA - 5061 ) 
 
 
 1 . 2 - rc1 
 @ @ - 13 , 7 + 15 , 7 @ @ 
 * Update IAuthenticator to match the new IAuthorizer ( CASSANDRA - 5003 ) 
 * Fix inserting only a key in CQL3 ( CASSANDRA - 5040 ) 
 * Fix CQL3 token ( ) function when used with strings ( CASSANDRA - 5050 ) 
 - Merged from 1 . 1 
 + Merged from 1 . 1 : 
 * reduce log spam from invalid counter shards ( CASSANDRA - 5026 ) 
 * Improve schema propagation performance ( CASSANDRA - 5025 ) 
 * Fix for IndexHelper . IndexFor throws OOB Exception ( CASSANDRA - 5030 ) 
 diff - - git a / src / java / org / apache / cassandra / db / DefsTable . java b / src / java / org / apache / cassandra / db / DefsTable . java 
 index 8569553 . . a9f6427 100644 
 - - - a / src / java / org / apache / cassandra / db / DefsTable . java 
 + + + b / src / java / org / apache / cassandra / db / DefsTable . java 
 @ @ - 241 , 6 + 241 , 19 @ @ public class DefsTable 
 
 mutation . apply ( ) ; 
 } 
 + / / flush immediately because we read schema before replaying the commitlog 
 + try 
 + { 
 + cfs . forceBlockingFlush ( ) ; 
 + } 
 + catch ( ExecutionException e ) 
 + { 
 + throw new RuntimeException ( " Could not flush after fixing schema timestamps " , e ) ; 
 + } 
 + catch ( InterruptedException e ) 
 + { 
 + throw new AssertionError ( e ) ; 
 + } 
 } 
 
 public static ByteBuffer searchComposite ( String name , boolean start )
