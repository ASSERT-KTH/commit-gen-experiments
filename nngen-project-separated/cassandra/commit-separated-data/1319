BLEU SCORE: 0.03089055318156698

TEST MSG: Cancel the transaction for sstables that we wont redistribute index summary for .
GENERATED MSG: merge from 2 . 0 . 0

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d49ab3d . . e1365b5 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 6 @ @ <nl> 2 . 2 . 2 <nl> + * Cancel transaction for sstables we wont redistribute index summary <nl> + for ( CASSANDRA - 10270 ) <nl> * Handle missing RoleManager in config after upgrade to 2 . 2 ( CASSANDRA - 10209 ) <nl> * Retry snapshot deletion after compaction and gc on Windows ( CASSANDRA - 10222 ) <nl> * Fix failure to start with space in directory path on Windows ( CASSANDRA - 10239 ) <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java b / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java <nl> index 6f66fd3 . . b07b2f5 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java <nl> @ @ - 253 , 6 + 253 , 7 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean <nl> @ VisibleForTesting <nl> public static List < SSTableReader > redistributeSummaries ( List < SSTableReader > compacting , Map < UUID , LifecycleTransaction > transactions , long memoryPoolBytes ) throws IOException <nl> { <nl> + logger . info ( " Redistributing index summaries " ) ; <nl> List < SSTableReader > oldFormatSSTables = new ArrayList < > ( ) ; <nl> List < SSTableReader > redistribute = new ArrayList < > ( ) ; <nl> for ( LifecycleTransaction txn : transactions . values ( ) ) <nl> @ @ - 402 , 6 + 403 , 7 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean <nl> logger . trace ( " SSTable { } is within thresholds of ideal sampling " , sstable ) ; <nl> remainingSpace - = sstable . getIndexSummaryOffHeapSize ( ) ; <nl> newSSTables . add ( sstable ) ; <nl> + transactions . get ( sstable . metadata . cfId ) . cancel ( sstable ) ; <nl> } <nl> totalReadsPerSec - = readsPerSec ; <nl> } <nl> @ @ - 411 , 6 + 413 , 8 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean <nl> Pair < List < SSTableReader > , List < ResampleEntry > > result = distributeRemainingSpace ( toDownsample , remainingSpace ) ; <nl> toDownsample = result . right ; <nl> newSSTables . addAll ( result . left ) ; <nl> + for ( SSTableReader sstable : result . left ) <nl> + transactions . get ( sstable . metadata . cfId ) . cancel ( sstable ) ; <nl> } <nl> <nl> / / downsample first , then upsample
NEAREST DIFF (one line): diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py <nl> index c83c94d . . ca95766 100644 <nl> - - - a / pylib / cqlshlib / cql3handling . py <nl> + + + b / pylib / cqlshlib / cql3handling . py <nl> @ @ - 503 , 10 + 503 , 6 @ @ def cf _ new _ prop _ val _ completer ( ctxt , cass ) : <nl> if this _ opt in ( ' min _ compaction _ threshold ' , ' max _ compaction _ threshold ' , <nl> ' gc _ grace _ seconds ' ) : <nl> return [ Hint ( ' < integer > ' ) ] <nl> - if this _ opt = = ' default _ read _ consistency ' : <nl> - return [ cl for cl in CqlRuleSet . consistency _ levels if cl ! = ' ANY ' ] <nl> - if this _ opt = = ' default _ write _ consistency ' : <nl> - return CqlRuleSet . consistency _ levels <nl> return [ Hint ( ' < option _ value > ' ) ] <nl> <nl> def cf _ new _ prop _ val _ mapkey _ completer ( ctxt , cass ) : <nl> diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> index f3b235d . . 33e3f00 100644 <nl> - - - a / src / java / org / apache / cassandra / config / CFMetaData . java <nl> + + + b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> @ @ - 136 , 8 + 136 , 6 @ @ public final class CFMetaData <nl> + " value _ alias text , " <nl> + " column _ aliases text , " <nl> + " compaction _ strategy _ options text , " <nl> - + " default _ read _ consistency text , " <nl> - + " default _ write _ consistency text , " <nl> + " PRIMARY KEY ( keyspace _ name , columnfamily _ name ) " <nl> + " ) WITH COMMENT = ' ColumnFamily definitions ' AND gc _ grace _ seconds = 8640 " ) ; <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d49ab3d . . e1365b5 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 6 @ @ 
 2 . 2 . 2 
 + * Cancel transaction for sstables we wont redistribute index summary 
 + for ( CASSANDRA - 10270 ) 
 * Handle missing RoleManager in config after upgrade to 2 . 2 ( CASSANDRA - 10209 ) 
 * Retry snapshot deletion after compaction and gc on Windows ( CASSANDRA - 10222 ) 
 * Fix failure to start with space in directory path on Windows ( CASSANDRA - 10239 ) 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java b / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java 
 index 6f66fd3 . . b07b2f5 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / IndexSummaryManager . java 
 @ @ - 253 , 6 + 253 , 7 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean 
 @ VisibleForTesting 
 public static List < SSTableReader > redistributeSummaries ( List < SSTableReader > compacting , Map < UUID , LifecycleTransaction > transactions , long memoryPoolBytes ) throws IOException 
 { 
 + logger . info ( " Redistributing index summaries " ) ; 
 List < SSTableReader > oldFormatSSTables = new ArrayList < > ( ) ; 
 List < SSTableReader > redistribute = new ArrayList < > ( ) ; 
 for ( LifecycleTransaction txn : transactions . values ( ) ) 
 @ @ - 402 , 6 + 403 , 7 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean 
 logger . trace ( " SSTable { } is within thresholds of ideal sampling " , sstable ) ; 
 remainingSpace - = sstable . getIndexSummaryOffHeapSize ( ) ; 
 newSSTables . add ( sstable ) ; 
 + transactions . get ( sstable . metadata . cfId ) . cancel ( sstable ) ; 
 } 
 totalReadsPerSec - = readsPerSec ; 
 } 
 @ @ - 411 , 6 + 413 , 8 @ @ public class IndexSummaryManager implements IndexSummaryManagerMBean 
 Pair < List < SSTableReader > , List < ResampleEntry > > result = distributeRemainingSpace ( toDownsample , remainingSpace ) ; 
 toDownsample = result . right ; 
 newSSTables . addAll ( result . left ) ; 
 + for ( SSTableReader sstable : result . left ) 
 + transactions . get ( sstable . metadata . cfId ) . cancel ( sstable ) ; 
 } 
 
 / / downsample first , then upsample

NEAREST DIFF:
diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py 
 index c83c94d . . ca95766 100644 
 - - - a / pylib / cqlshlib / cql3handling . py 
 + + + b / pylib / cqlshlib / cql3handling . py 
 @ @ - 503 , 10 + 503 , 6 @ @ def cf _ new _ prop _ val _ completer ( ctxt , cass ) : 
 if this _ opt in ( ' min _ compaction _ threshold ' , ' max _ compaction _ threshold ' , 
 ' gc _ grace _ seconds ' ) : 
 return [ Hint ( ' < integer > ' ) ] 
 - if this _ opt = = ' default _ read _ consistency ' : 
 - return [ cl for cl in CqlRuleSet . consistency _ levels if cl ! = ' ANY ' ] 
 - if this _ opt = = ' default _ write _ consistency ' : 
 - return CqlRuleSet . consistency _ levels 
 return [ Hint ( ' < option _ value > ' ) ] 
 
 def cf _ new _ prop _ val _ mapkey _ completer ( ctxt , cass ) : 
 diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java 
 index f3b235d . . 33e3f00 100644 
 - - - a / src / java / org / apache / cassandra / config / CFMetaData . java 
 + + + b / src / java / org / apache / cassandra / config / CFMetaData . java 
 @ @ - 136 , 8 + 136 , 6 @ @ public final class CFMetaData 
 + " value _ alias text , " 
 + " column _ aliases text , " 
 + " compaction _ strategy _ options text , " 
 - + " default _ read _ consistency text , " 
 - + " default _ write _ consistency text , " 
 + " PRIMARY KEY ( keyspace _ name , columnfamily _ name ) " 
 + " ) WITH COMMENT = ' ColumnFamily definitions ' AND gc _ grace _ seconds = 8640 " ) ; 

