BLEU SCORE: 0.05341087579952926

TEST MSG: Fix rare NPE in KeyCacheSerializer
GENERATED MSG: merge from 1 . 2

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 76c2e10 . . a90dd48 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 4 <nl> + * Fix rare NPE in KeyCacheSerializer ( CASSANDRA - 8067 ) <nl> * Pick sstables for validation as late as possible inc repairs ( CASSANDRA - 8366 ) <nl> * Fix commitlog getPendingTasks to not increment ( CASSANDRA - 8856 ) <nl> * Fix parallelism adjustment in range and secondary index queries <nl> diff - - git a / src / java / org / apache / cassandra / service / CacheService . java b / src / java / org / apache / cassandra / service / CacheService . java <nl> index 1b93c2c . . 48c0941 100644 <nl> - - - a / src / java / org / apache / cassandra / service / CacheService . java <nl> + + + b / src / java / org / apache / cassandra / service / CacheService . java <nl> @ @ - 467 , 11 + 467 , 14 @ @ public class CacheService implements CacheServiceMBean <nl> RowIndexEntry entry = CacheService . instance . keyCache . get ( key ) ; <nl> if ( entry = = null ) <nl> return ; <nl> + <nl> + CFMetaData cfm = Schema . instance . getCFMetaData ( key . cfId ) ; <nl> + if ( cfm = = null ) <nl> + return ; / / the table no longer exists . <nl> + <nl> ByteBufferUtil . writeWithLength ( key . key , out ) ; <nl> - Descriptor desc = key . desc ; <nl> - out . writeInt ( desc . generation ) ; <nl> + out . writeInt ( key . desc . generation ) ; <nl> out . writeBoolean ( true ) ; <nl> - CFMetaData cfm = Schema . instance . getCFMetaData ( key . desc . ksname , key . desc . cfname ) ; <nl> cfm . comparator . rowIndexEntrySerializer ( ) . serialize ( entry , out ) ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b935425 . . 7f5a487 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 - rc1 <nl> + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) <nl> * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) <nl> * save truncation position in system table ( CASSANDRA - 4906 ) <nl> * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) <nl> diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py <nl> index d15c083 . . bab3506 100644 <nl> - - - a / pylib / cqlshlib / formatting . py <nl> + + + b / pylib / cqlshlib / formatting . py <nl> @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : <nl> return f <nl> return registrator <nl> <nl> - @ formatter _ for ( ' bytes ' ) <nl> - def format _ value _ bytes ( val , colormap , * * _ ) : <nl> + @ formatter _ for ( ' blob ' ) <nl> + def format _ value _ blob ( val , colormap , * * _ ) : <nl> bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) <nl> return colorme ( bval , colormap , ' hex ' ) <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 76c2e10 . . a90dd48 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 4 
 + * Fix rare NPE in KeyCacheSerializer ( CASSANDRA - 8067 ) 
 * Pick sstables for validation as late as possible inc repairs ( CASSANDRA - 8366 ) 
 * Fix commitlog getPendingTasks to not increment ( CASSANDRA - 8856 ) 
 * Fix parallelism adjustment in range and secondary index queries 
 diff - - git a / src / java / org / apache / cassandra / service / CacheService . java b / src / java / org / apache / cassandra / service / CacheService . java 
 index 1b93c2c . . 48c0941 100644 
 - - - a / src / java / org / apache / cassandra / service / CacheService . java 
 + + + b / src / java / org / apache / cassandra / service / CacheService . java 
 @ @ - 467 , 11 + 467 , 14 @ @ public class CacheService implements CacheServiceMBean 
 RowIndexEntry entry = CacheService . instance . keyCache . get ( key ) ; 
 if ( entry = = null ) 
 return ; 
 + 
 + CFMetaData cfm = Schema . instance . getCFMetaData ( key . cfId ) ; 
 + if ( cfm = = null ) 
 + return ; / / the table no longer exists . 
 + 
 ByteBufferUtil . writeWithLength ( key . key , out ) ; 
 - Descriptor desc = key . desc ; 
 - out . writeInt ( desc . generation ) ; 
 + out . writeInt ( key . desc . generation ) ; 
 out . writeBoolean ( true ) ; 
 - CFMetaData cfm = Schema . instance . getCFMetaData ( key . desc . ksname , key . desc . cfname ) ; 
 cfm . comparator . rowIndexEntrySerializer ( ) . serialize ( entry , out ) ; 
 } 


NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b935425 . . 7f5a487 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 - rc1 
 + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) 
 * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) 
 * save truncation position in system table ( CASSANDRA - 4906 ) 
 * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) 
 diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py 
 index d15c083 . . bab3506 100644 
 - - - a / pylib / cqlshlib / formatting . py 
 + + + b / pylib / cqlshlib / formatting . py 
 @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : 
 return f 
 return registrator 
 
 - @ formatter _ for ( ' bytes ' ) 
 - def format _ value _ bytes ( val , colormap , * * _ ) : 
 + @ formatter _ for ( ' blob ' ) 
 + def format _ value _ blob ( val , colormap , * * _ ) : 
 bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) 
 return colorme ( bval , colormap , ' hex ' ) 

