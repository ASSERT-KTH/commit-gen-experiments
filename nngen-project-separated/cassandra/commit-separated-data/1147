BLEU SCORE: 0.13976396370981378

TEST MSG: Normalize all scripts
GENERATED MSG: scripts fail when paths contain whitespace

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 2940960 . . cc79512 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 2 <nl> + * Normalize all scripts ( CASSANDRA - 10679 ) <nl> * Make compression ratio much more accurate ( CASSANDRA - 10225 ) <nl> * Optimize building of Clustering object when only one is created ( CASSANDRA - 10409 ) <nl> * Make index building pluggable ( CASSANDRA - 10681 ) <nl> diff - - git a / bin / nodetool b / bin / nodetool <nl> index d211459 . . 0ea078f 100755 <nl> - - - a / bin / nodetool <nl> + + + b / bin / nodetool <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> # ! / bin / sh <nl> + <nl> # Licensed to the Apache Software Foundation ( ASF ) under one <nl> # or more contributor license agreements . See the NOTICE file <nl> # distributed with this work for additional information <nl> @ @ - 22 , 11 + 23 , 11 @ @ if [ " ` basename " $ 0 " ` " = ' nodeprobe ' ] ; then <nl> fi <nl> <nl> if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> break <nl> @ @ - 43 , 6 + 44 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CASSANDRA _ CONF " - o - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CASSANDRA _ CONF and CLASSPATH vars " > & 2 <nl> exit 1 <nl> @ @ - 50 , 7 + 56 , 9 @ @ fi <nl> <nl> # Run cassandra - env . sh to pick up JMX _ PORT <nl> if [ - f " $ CASSANDRA _ CONF / cassandra - env . sh " ] ; then <nl> + JVM _ OPTS _ SAVE = $ JVM _ OPTS <nl> . " $ CASSANDRA _ CONF / cassandra - env . sh " <nl> + JVM _ OPTS = $ JVM _ OPTS _ SAVE <nl> fi <nl> <nl> # JMX Port passed via cmd line args ( - p 9999 / - - port 9999 / - - port = 9999 ) <nl> @ @ - 90 , 20 + 98 , 14 @ @ do <nl> shift <nl> done <nl> <nl> - # Special - case path variables . <nl> - case " ` uname ` " in <nl> - CYGWIN * ) <nl> - CLASSPATH = " ` cygpath - p - w " $ CLASSPATH " ` " <nl> - CASSANDRA _ CONF = " ` cygpath - p - w " $ CASSANDRA _ CONF " ` " <nl> - ; ; <nl> - esac <nl> + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> + MAX _ HEAP _ SIZE = " 128m " <nl> + fi <nl> <nl> - " $ JAVA " $ JAVA _ AGENT - cp " $ CLASSPATH " \ <nl> - - Xmx128m \ <nl> - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - - Dlogback . configurationFile = logback - tools . xml \ <nl> - - Dstorage - config = " $ CASSANDRA _ CONF " \ <nl> - $ JVM _ ARGS \ <nl> - org . apache . cassandra . tools . NodeTool - p $ JMX _ PORT $ ARGS <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> + - Dlogback . configurationFile = logback - tools . xml \ <nl> + $ JVM _ ARGS \ <nl> + org . apache . cassandra . tools . NodeTool - p $ JMX _ PORT $ ARGS <nl> <nl> # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / bin / sstableloader b / bin / sstableloader <nl> index 67829b8 . . b6a6d83 100755 <nl> - - - a / bin / sstableloader <nl> + + + b / bin / sstableloader <nl> @ @ - 17 , 11 + 17 , 11 @ @ <nl> # limitations under the License . <nl> <nl> if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> break <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> diff - - git a / bin / sstablescrub b / bin / sstablescrub <nl> index ea784ef . . 58bd21b 100755 <nl> - - - a / bin / sstablescrub <nl> + + + b / bin / sstablescrub <nl> @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> diff - - git a / bin / sstableupgrade b / bin / sstableupgrade <nl> index 91fa422 . . a722cdc 100755 <nl> - - - a / bin / sstableupgrade <nl> + + + b / bin / sstableupgrade <nl> @ @ - 20 , 22 + 20 , 27 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> - ` dirname $ 0 ` / cassandra . in . sh ; do <nl> - if [ - r $ include ] ; then <nl> - . $ include <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> break <nl> fi <nl> done <nl> - elif [ - r $ CASSANDRA _ INCLUDE ] ; then <nl> - . $ CASSANDRA _ INCLUDE <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> + fi <nl> + <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> fi <nl> <nl> if [ - z " $ CLASSPATH " ] ; then <nl> @ @ - 53 , 4 + 58 , 3 @ @ fi <nl> org . apache . cassandra . tools . StandaloneUpgrader " $ @ " <nl> <nl> # vi : ai sw = 4 ts = 4 tw = 0 et <nl> - <nl> diff - - git a / bin / sstableutil b / bin / sstableutil <nl> index 2860729 . . 9f07785 100755 <nl> - - - a / bin / sstableutil <nl> + + + b / bin / sstableutil <nl> @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> diff - - git a / bin / sstableverify b / bin / sstableverify <nl> index c3e40c7 . . 892750b 100755 <nl> - - - a / bin / sstableverify <nl> + + + b / bin / sstableverify <nl> @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> @ @ - 47 , 7 + 52 , 7 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> MAX _ HEAP _ SIZE = " 256M " <nl> fi <nl> <nl> - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . StandaloneVerifier " $ @ " <nl> diff - - git a / tools / bin / cassandra - stress b / tools / bin / cassandra - stress <nl> index 14fbd09 . . 1ffb598 100755 <nl> - - - a / tools / bin / cassandra - stress <nl> + + + b / tools / bin / cassandra - stress <nl> @ @ - 17 , 24 + 17 , 25 @ @ <nl> # limitations under the License . <nl> <nl> if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> - if [ - r $ include ] ; then <nl> - . $ include <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> break <nl> fi <nl> done <nl> - elif [ - r $ CASSANDRA _ INCLUDE ] ; then <nl> - . $ CASSANDRA _ INCLUDE <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> fi <nl> <nl> if [ " x $ JAVA " = " x " ] ; then <nl> @ @ - 42 , 6 + 43 , 14 @ @ if [ " x $ JAVA " = " x " ] ; then <nl> exit 1 <nl> fi <nl> <nl> - " $ JAVA " - server - ea - cp " $ CLASSPATH " \ <nl> - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - org . apache . cassandra . stress . Stress $ @ <nl> + if [ - z " $ CLASSPATH " ] ; then <nl> + echo " You must set the CLASSPATH var " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> + " $ JAVA " - server - ea - cp " $ CLASSPATH " $ JVM _ OPTS \ <nl> + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> + - Dlogback . configurationFile = logback - tools . xml \ <nl> + org . apache . cassandra . stress . Stress $ @ <nl> + <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / cassandra - stressd b / tools / bin / cassandra - stressd <nl> index 50dedee . . 229ba0b 100755 <nl> - - - a / tools / bin / cassandra - stressd <nl> + + + b / tools / bin / cassandra - stressd <nl> @ @ - 17 , 31 + 17 , 26 @ @ <nl> # limitations under the License . <nl> <nl> DESC = " Cassandra Stress Test Daemon " <nl> - if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> - if [ - r $ include ] ; then <nl> - . $ include <nl> - break <nl> - fi <nl> - done <nl> - elif [ - r $ CASSANDRA _ INCLUDE ] ; then <nl> - . $ CASSANDRA _ INCLUDE <nl> - fi <nl> - <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> - else <nl> - JAVA = ` which java ` <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> + break <nl> + fi <nl> + done <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> fi <nl> <nl> if [ " x $ JAVA " = " x " ] ; then <nl> @ @ - 49 , 12 + 44 , 18 @ @ if [ " x $ JAVA " = " x " ] ; then <nl> exit 1 <nl> fi <nl> <nl> + if [ - z " $ CLASSPATH " ] ; then <nl> + echo " You must set the CLASSPATH var " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> case " $ 1 " in <nl> start ) <nl> echo " Starting $ DESC : " <nl> - " $ JAVA " - server - cp " $ CLASSPATH " \ <nl> - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - org . apache . cassandra . stress . StressServer $ @ 1 > . / stressd . out . log 2 > . / stressd . err . log & <nl> + " $ JAVA " - server - cp " $ CLASSPATH " $ JVM _ OPTS \ <nl> + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> + - Dlogback . configurationFile = logback - tools . xml \ <nl> + org . apache . cassandra . stress . StressServer $ @ 1 > . / stressd . out . log 2 > . / stressd . err . log & <nl> echo $ ! > . / stressd . pid <nl> echo " done . " <nl> ; ; <nl> @ @ - 86 , 3 + 87 , 4 @ @ case " $ 1 " in <nl> ; ; <nl> esac <nl> <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstableexpiredblockers b / tools / bin / sstableexpiredblockers <nl> index 0027208 . . cefdfe3 100755 <nl> - - - a / tools / bin / sstableexpiredblockers <nl> + + + b / tools / bin / sstableexpiredblockers <nl> @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> @ @ - 47 , 8 + 52 , 9 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> MAX _ HEAP _ SIZE = " 256M " <nl> fi <nl> <nl> - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . SSTableExpiredBlockers " $ @ " <nl> <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstablelevelreset b / tools / bin / sstablelevelreset <nl> index 1756a21 . . 8191f3d 100755 <nl> - - - a / tools / bin / sstablelevelreset <nl> + + + b / tools / bin / sstablelevelreset <nl> @ @ - 17 , 26 + 17 , 30 @ @ <nl> # limitations under the License . <nl> <nl> if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> - if [ - r $ include ] ; then <nl> - . $ include <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> break <nl> fi <nl> done <nl> - elif [ - r $ CASSANDRA _ INCLUDE ] ; then <nl> - . $ CASSANDRA _ INCLUDE <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> - <nl> # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> + fi <nl> + <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> fi <nl> <nl> if [ - z " $ CLASSPATH " ] ; then <nl> @ @ - 44 , 7 + 48 , 13 @ @ if [ - z " $ CLASSPATH " ] ; then <nl> exit 1 <nl> fi <nl> <nl> - " $ JAVA " - cp " $ CLASSPATH " - Dstorage - config = $ CASSANDRA _ CONF \ <nl> + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> + MAX _ HEAP _ SIZE = " 256M " <nl> + fi <nl> + <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . SSTableLevelResetter " $ @ " <nl> + <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstablemetadata b / tools / bin / sstablemetadata <nl> index c5ff832 . . 5316869 100755 <nl> - - - a / tools / bin / sstablemetadata <nl> + + + b / tools / bin / sstablemetadata <nl> @ @ - 17 , 11 + 17 , 11 @ @ <nl> # limitations under the License . <nl> <nl> if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ <nl> - " $ HOME / . cassandra . in . sh " \ <nl> - / usr / share / cassandra / cassandra . in . sh \ <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> - / opt / cassandra / cassandra . in . sh ; do <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> break <nl> @ @ - 31 , 7 + 31 , 6 @ @ elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> - <nl> # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> JAVA = " $ JAVA _ HOME / bin / java " <nl> @ @ - 39 , 12 + 38 , 23 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> fi <nl> <nl> - " $ JAVA " - cp " $ CLASSPATH " \ <nl> + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> + MAX _ HEAP _ SIZE = " 256M " <nl> + fi <nl> + <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . SSTableMetadataViewer " $ @ " <nl> + <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstableofflinerelevel b / tools / bin / sstableofflinerelevel <nl> index bfe28a0 . . a4ba6cb 100755 <nl> - - - a / tools / bin / sstableofflinerelevel <nl> + + + b / tools / bin / sstableofflinerelevel <nl> @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> if [ - r " $ include " ] ; then <nl> . " $ include " <nl> @ @ - 38 , 6 + 38 , 11 @ @ else <nl> JAVA = " ` which java ` " <nl> fi <nl> <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> if [ - z " $ CLASSPATH " ] ; then <nl> echo " You must set the CLASSPATH var " > & 2 <nl> exit 1 <nl> @ @ - 47 , 8 + 52 , 9 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> MAX _ HEAP _ SIZE = " 256M " <nl> fi <nl> <nl> - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . SSTableOfflineRelevel " $ @ " <nl> <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstablerepairedset b / tools / bin / sstablerepairedset <nl> index 1aa30a3 . . efb8a70 100755 <nl> - - - a / tools / bin / sstablerepairedset <nl> + + + b / tools / bin / sstablerepairedset <nl> @ @ - 16 , 32 + 16 , 45 @ @ <nl> # See the License for the specific language governing permissions and <nl> # limitations under the License . <nl> <nl> - if [ " x $ CLASSPATH " = " x " ] ; then <nl> - <nl> - # execute from the build dir . <nl> - if [ - d ` dirname $ 0 ` / . . / . . / build / classes ] ; then <nl> - for directory in ` dirname $ 0 ` / . . / . . / build / classes / * ; do <nl> - CLASSPATH = $ CLASSPATH : $ directory <nl> - done <nl> - else <nl> - if [ - f ` dirname $ 0 ` / . . / lib / stress . jar ] ; then <nl> - CLASSPATH = ` dirname $ 0 ` / . . / lib / stress . jar <nl> + if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> + for include in / usr / share / cassandra / cassandra . in . sh \ <nl> + / usr / local / share / cassandra / cassandra . in . sh \ <nl> + / opt / cassandra / cassandra . in . sh \ <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> + break <nl> fi <nl> - fi <nl> - <nl> - for jar in ` dirname $ 0 ` / . . / . . / lib / * . jar ; do <nl> - CLASSPATH = $ CLASSPATH : $ jar <nl> done <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> + fi <nl> + <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> + if [ - z " $ CLASSPATH " ] ; then <nl> + echo " You must set the CLASSPATH var " > & 2 <nl> + exit 1 <nl> + fi <nl> + <nl> + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> + MAX _ HEAP _ SIZE = " 256M " <nl> fi <nl> <nl> - $ JAVA - cp $ CLASSPATH \ <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . SSTableRepairedAtSetter " $ @ " <nl> + <nl> + # vi : ai sw = 4 ts = 4 tw = 0 et <nl> diff - - git a / tools / bin / sstablesplit b / tools / bin / sstablesplit <nl> index 51da481 . . 90d91ce 100755 <nl> - - - a / tools / bin / sstablesplit <nl> + + + b / tools / bin / sstablesplit <nl> @ @ - 20 , 22 + 20 , 27 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then <nl> for include in / usr / share / cassandra / cassandra . in . sh \ <nl> / usr / local / share / cassandra / cassandra . in . sh \ <nl> / opt / cassandra / cassandra . in . sh \ <nl> - ~ / . cassandra . in . sh \ <nl> - ` dirname $ 0 ` / cassandra . in . sh ; do <nl> - if [ - r $ include ] ; then <nl> - . $ include <nl> + " $ HOME / . cassandra . in . sh " \ <nl> + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do <nl> + if [ - r " $ include " ] ; then <nl> + . " $ include " <nl> break <nl> fi <nl> done <nl> - elif [ - r $ CASSANDRA _ INCLUDE ] ; then <nl> - . $ CASSANDRA _ INCLUDE <nl> + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then <nl> + . " $ CASSANDRA _ INCLUDE " <nl> fi <nl> <nl> # Use JAVA _ HOME if set , otherwise look for java in PATH <nl> - if [ - x $ JAVA _ HOME / bin / java ] ; then <nl> - JAVA = $ JAVA _ HOME / bin / java <nl> + if [ - x " $ JAVA _ HOME / bin / java " ] ; then <nl> + JAVA = " $ JAVA _ HOME / bin / java " <nl> else <nl> - JAVA = ` which java ` <nl> + JAVA = " ` which java ` " <nl> + fi <nl> + <nl> + if [ " x $ JAVA " = " x " ] ; then <nl> + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 <nl> + exit 1 <nl> fi <nl> <nl> if [ - z " $ CLASSPATH " ] ; then <nl> @ @ - 43 , 7 + 48 , 11 @ @ if [ - z " $ CLASSPATH " ] ; then <nl> exit 1 <nl> fi <nl> <nl> - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx256M \ <nl> + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then <nl> + MAX _ HEAP _ SIZE = " 256M " <nl> + fi <nl> + <nl> + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ <nl> - Dcassandra . storagedir = " $ cassandra _ storagedir " \ <nl> - Dlogback . configurationFile = logback - tools . xml \ <nl> org . apache . cassandra . tools . StandaloneSplitter " $ @ "
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7c16cd0 . . 65dd404 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 9 , 6 + 9 , 7 @ @ <nl> * Fix skipping range tombstones with reverse queries ( CASSANDRA - 5712 ) <nl> * Expire entries out of ThriftSessionManager ( CASSANRDA - 5719 ) <nl> * Don ' t keep ancestor information in memory ( CASSANDRA - 5342 ) <nl> + * cqlsh : fix handling of semicolons inside BATCH queries ( CASSANDRA - 5697 ) <nl> <nl> <nl> 1 . 2 . 6 <nl> diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py <nl> index 0e631ea . . 92701d6 100644 <nl> - - - a / pylib / cqlshlib / cql3handling . py <nl> + + + b / pylib / cqlshlib / cql3handling . py <nl> @ @ - 986 , 8 + 986 , 8 @ @ syntax _ rules + = r ' ' ' <nl> < batchStatement > : : = " BEGIN " ( " UNLOGGED " | " COUNTER " ) ? " BATCH " <nl> ( " USING " [ batchopt ] = < usingOption > <nl> ( " AND " [ batchopt ] = < usingOption > ) * ) ? <nl> - [ batchstmt ] = < batchStatementMember > " ; " <nl> - ( [ batchstmt ] = < batchStatementMember > " ; " ) * <nl> + [ batchstmt ] = < batchStatementMember > " ; " ? <nl> + ( [ batchstmt ] = < batchStatementMember > " ; " ? ) * <nl> " APPLY " " BATCH " <nl> ; <nl> < batchStatementMember > : : = < insertStatement > <nl> diff - - git a / pylib / cqlshlib / cqlhandling . py b / pylib / cqlshlib / cqlhandling . py <nl> index 83e1dc2 . . 7d36301 100644 <nl> - - - a / pylib / cqlshlib / cqlhandling . py <nl> + + + b / pylib / cqlshlib / cqlhandling . py <nl> @ @ - 189 , 13 + 189 , 11 @ @ class CqlParsingRuleSet ( pylexotron . ParsingRuleSet ) : <nl> output [ - 1 ] . extend ( stmt ) <nl> else : <nl> output . append ( stmt ) <nl> - if len ( stmt ) > 1 \ <nl> - and stmt [ 0 ] [ 0 ] = = ' identifier ' and stmt [ 1 ] [ 0 ] = = ' identifier ' \ <nl> - and stmt [ 1 ] [ 1 ] . lower ( ) = = ' batch ' : <nl> - if stmt [ 0 ] [ 1 ] . lower ( ) = = ' begin ' : <nl> - in _ batch = True <nl> - elif stmt [ 0 ] [ 1 ] . lower ( ) = = ' apply ' : <nl> + if len ( stmt ) > 2 : <nl> + if stmt [ - 3 ] [ 0 ] = = ' K _ APPLY ' : <nl> in _ batch = False <nl> + elif stmt [ 0 ] [ 0 ] = = ' K _ BEGIN ' : <nl> + in _ batch = True <nl> return output , in _ batch <nl> <nl> def cql _ complete _ single ( self , text , partial , init _ bindings = { } , ignore _ case = True ,

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 2940960 . . cc79512 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 2 
 + * Normalize all scripts ( CASSANDRA - 10679 ) 
 * Make compression ratio much more accurate ( CASSANDRA - 10225 ) 
 * Optimize building of Clustering object when only one is created ( CASSANDRA - 10409 ) 
 * Make index building pluggable ( CASSANDRA - 10681 ) 
 diff - - git a / bin / nodetool b / bin / nodetool 
 index d211459 . . 0ea078f 100755 
 - - - a / bin / nodetool 
 + + + b / bin / nodetool 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 # ! / bin / sh 
 + 
 # Licensed to the Apache Software Foundation ( ASF ) under one 
 # or more contributor license agreements . See the NOTICE file 
 # distributed with this work for additional information 
 @ @ - 22 , 11 + 23 , 11 @ @ if [ " ` basename " $ 0 " ` " = ' nodeprobe ' ] ; then 
 fi 
 
 if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 break 
 @ @ - 43 , 6 + 44 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CASSANDRA _ CONF " - o - z " $ CLASSPATH " ] ; then 
 echo " You must set the CASSANDRA _ CONF and CLASSPATH vars " > & 2 
 exit 1 
 @ @ - 50 , 7 + 56 , 9 @ @ fi 
 
 # Run cassandra - env . sh to pick up JMX _ PORT 
 if [ - f " $ CASSANDRA _ CONF / cassandra - env . sh " ] ; then 
 + JVM _ OPTS _ SAVE = $ JVM _ OPTS 
 . " $ CASSANDRA _ CONF / cassandra - env . sh " 
 + JVM _ OPTS = $ JVM _ OPTS _ SAVE 
 fi 
 
 # JMX Port passed via cmd line args ( - p 9999 / - - port 9999 / - - port = 9999 ) 
 @ @ - 90 , 20 + 98 , 14 @ @ do 
 shift 
 done 
 
 - # Special - case path variables . 
 - case " ` uname ` " in 
 - CYGWIN * ) 
 - CLASSPATH = " ` cygpath - p - w " $ CLASSPATH " ` " 
 - CASSANDRA _ CONF = " ` cygpath - p - w " $ CASSANDRA _ CONF " ` " 
 - ; ; 
 - esac 
 + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 + MAX _ HEAP _ SIZE = " 128m " 
 + fi 
 
 - " $ JAVA " $ JAVA _ AGENT - cp " $ CLASSPATH " \ 
 - - Xmx128m \ 
 - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - - Dlogback . configurationFile = logback - tools . xml \ 
 - - Dstorage - config = " $ CASSANDRA _ CONF " \ 
 - $ JVM _ ARGS \ 
 - org . apache . cassandra . tools . NodeTool - p $ JMX _ PORT $ ARGS 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 + - Dlogback . configurationFile = logback - tools . xml \ 
 + $ JVM _ ARGS \ 
 + org . apache . cassandra . tools . NodeTool - p $ JMX _ PORT $ ARGS 
 
 # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / bin / sstableloader b / bin / sstableloader 
 index 67829b8 . . b6a6d83 100755 
 - - - a / bin / sstableloader 
 + + + b / bin / sstableloader 
 @ @ - 17 , 11 + 17 , 11 @ @ 
 # limitations under the License . 
 
 if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 break 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 diff - - git a / bin / sstablescrub b / bin / sstablescrub 
 index ea784ef . . 58bd21b 100755 
 - - - a / bin / sstablescrub 
 + + + b / bin / sstablescrub 
 @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 diff - - git a / bin / sstableupgrade b / bin / sstableupgrade 
 index 91fa422 . . a722cdc 100755 
 - - - a / bin / sstableupgrade 
 + + + b / bin / sstableupgrade 
 @ @ - 20 , 22 + 20 , 27 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 - ` dirname $ 0 ` / cassandra . in . sh ; do 
 - if [ - r $ include ] ; then 
 - . $ include 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 break 
 fi 
 done 
 - elif [ - r $ CASSANDRA _ INCLUDE ] ; then 
 - . $ CASSANDRA _ INCLUDE 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 # Use JAVA _ HOME if set , otherwise look for java in PATH 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 + fi 
 + 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 fi 
 
 if [ - z " $ CLASSPATH " ] ; then 
 @ @ - 53 , 4 + 58 , 3 @ @ fi 
 org . apache . cassandra . tools . StandaloneUpgrader " $ @ " 
 
 # vi : ai sw = 4 ts = 4 tw = 0 et 
 - 
 diff - - git a / bin / sstableutil b / bin / sstableutil 
 index 2860729 . . 9f07785 100755 
 - - - a / bin / sstableutil 
 + + + b / bin / sstableutil 
 @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 diff - - git a / bin / sstableverify b / bin / sstableverify 
 index c3e40c7 . . 892750b 100755 
 - - - a / bin / sstableverify 
 + + + b / bin / sstableverify 
 @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 @ @ - 47 , 7 + 52 , 7 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 MAX _ HEAP _ SIZE = " 256M " 
 fi 
 
 - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . StandaloneVerifier " $ @ " 
 diff - - git a / tools / bin / cassandra - stress b / tools / bin / cassandra - stress 
 index 14fbd09 . . 1ffb598 100755 
 - - - a / tools / bin / cassandra - stress 
 + + + b / tools / bin / cassandra - stress 
 @ @ - 17 , 24 + 17 , 25 @ @ 
 # limitations under the License . 
 
 if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 - if [ - r $ include ] ; then 
 - . $ include 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 break 
 fi 
 done 
 - elif [ - r $ CASSANDRA _ INCLUDE ] ; then 
 - . $ CASSANDRA _ INCLUDE 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + # Use JAVA _ HOME if set , otherwise look for java in PATH 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 fi 
 
 if [ " x $ JAVA " = " x " ] ; then 
 @ @ - 42 , 6 + 43 , 14 @ @ if [ " x $ JAVA " = " x " ] ; then 
 exit 1 
 fi 
 
 - " $ JAVA " - server - ea - cp " $ CLASSPATH " \ 
 - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - org . apache . cassandra . stress . Stress $ @ 
 + if [ - z " $ CLASSPATH " ] ; then 
 + echo " You must set the CLASSPATH var " > & 2 
 + exit 1 
 + fi 
 + 
 + " $ JAVA " - server - ea - cp " $ CLASSPATH " $ JVM _ OPTS \ 
 + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 + - Dlogback . configurationFile = logback - tools . xml \ 
 + org . apache . cassandra . stress . Stress $ @ 
 + 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / cassandra - stressd b / tools / bin / cassandra - stressd 
 index 50dedee . . 229ba0b 100755 
 - - - a / tools / bin / cassandra - stressd 
 + + + b / tools / bin / cassandra - stressd 
 @ @ - 17 , 31 + 17 , 26 @ @ 
 # limitations under the License . 
 
 DESC = " Cassandra Stress Test Daemon " 
 - if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 - if [ - r $ include ] ; then 
 - . $ include 
 - break 
 - fi 
 - done 
 - elif [ - r $ CASSANDRA _ INCLUDE ] ; then 
 - . $ CASSANDRA _ INCLUDE 
 - fi 
 - 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 - else 
 - JAVA = ` which java ` 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 + break 
 + fi 
 + done 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + # Use JAVA _ HOME if set , otherwise look for java in PATH 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 fi 
 
 if [ " x $ JAVA " = " x " ] ; then 
 @ @ - 49 , 12 + 44 , 18 @ @ if [ " x $ JAVA " = " x " ] ; then 
 exit 1 
 fi 
 
 + if [ - z " $ CLASSPATH " ] ; then 
 + echo " You must set the CLASSPATH var " > & 2 
 + exit 1 
 + fi 
 + 
 case " $ 1 " in 
 start ) 
 echo " Starting $ DESC : " 
 - " $ JAVA " - server - cp " $ CLASSPATH " \ 
 - - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - org . apache . cassandra . stress . StressServer $ @ 1 > . / stressd . out . log 2 > . / stressd . err . log & 
 + " $ JAVA " - server - cp " $ CLASSPATH " $ JVM _ OPTS \ 
 + - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 + - Dlogback . configurationFile = logback - tools . xml \ 
 + org . apache . cassandra . stress . StressServer $ @ 1 > . / stressd . out . log 2 > . / stressd . err . log & 
 echo $ ! > . / stressd . pid 
 echo " done . " 
 ; ; 
 @ @ - 86 , 3 + 87 , 4 @ @ case " $ 1 " in 
 ; ; 
 esac 
 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstableexpiredblockers b / tools / bin / sstableexpiredblockers 
 index 0027208 . . cefdfe3 100755 
 - - - a / tools / bin / sstableexpiredblockers 
 + + + b / tools / bin / sstableexpiredblockers 
 @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 @ @ - 47 , 8 + 52 , 9 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 MAX _ HEAP _ SIZE = " 256M " 
 fi 
 
 - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . SSTableExpiredBlockers " $ @ " 
 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstablelevelreset b / tools / bin / sstablelevelreset 
 index 1756a21 . . 8191f3d 100755 
 - - - a / tools / bin / sstablelevelreset 
 + + + b / tools / bin / sstablelevelreset 
 @ @ - 17 , 26 + 17 , 30 @ @ 
 # limitations under the License . 
 
 if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname $ 0 ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 - if [ - r $ include ] ; then 
 - . $ include 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 break 
 fi 
 done 
 - elif [ - r $ CASSANDRA _ INCLUDE ] ; then 
 - . $ CASSANDRA _ INCLUDE 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 - 
 # Use JAVA _ HOME if set , otherwise look for java in PATH 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 + fi 
 + 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 fi 
 
 if [ - z " $ CLASSPATH " ] ; then 
 @ @ - 44 , 7 + 48 , 13 @ @ if [ - z " $ CLASSPATH " ] ; then 
 exit 1 
 fi 
 
 - " $ JAVA " - cp " $ CLASSPATH " - Dstorage - config = $ CASSANDRA _ CONF \ 
 + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 + MAX _ HEAP _ SIZE = " 256M " 
 + fi 
 + 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . SSTableLevelResetter " $ @ " 
 + 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstablemetadata b / tools / bin / sstablemetadata 
 index c5ff832 . . 5316869 100755 
 - - - a / tools / bin / sstablemetadata 
 + + + b / tools / bin / sstablemetadata 
 @ @ - 17 , 11 + 17 , 11 @ @ 
 # limitations under the License . 
 
 if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 - for include in " ` dirname " $ 0 " ` / cassandra . in . sh " \ 
 - " $ HOME / . cassandra . in . sh " \ 
 - / usr / share / cassandra / cassandra . in . sh \ 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 - / opt / cassandra / cassandra . in . sh ; do 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 break 
 @ @ - 31 , 7 + 31 , 6 @ @ elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 - 
 # Use JAVA _ HOME if set , otherwise look for java in PATH 
 if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 JAVA = " $ JAVA _ HOME / bin / java " 
 @ @ - 39 , 12 + 38 , 23 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 fi 
 
 - " $ JAVA " - cp " $ CLASSPATH " \ 
 + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 + MAX _ HEAP _ SIZE = " 256M " 
 + fi 
 + 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . SSTableMetadataViewer " $ @ " 
 + 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstableofflinerelevel b / tools / bin / sstableofflinerelevel 
 index bfe28a0 . . a4ba6cb 100755 
 - - - a / tools / bin / sstableofflinerelevel 
 + + + b / tools / bin / sstableofflinerelevel 
 @ @ - 20 , 7 + 20 , 7 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 if [ - r " $ include " ] ; then 
 . " $ include " 
 @ @ - 38 , 6 + 38 , 11 @ @ else 
 JAVA = " ` which java ` " 
 fi 
 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 if [ - z " $ CLASSPATH " ] ; then 
 echo " You must set the CLASSPATH var " > & 2 
 exit 1 
 @ @ - 47 , 8 + 52 , 9 @ @ if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 MAX _ HEAP _ SIZE = " 256M " 
 fi 
 
 - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " - Xmx $ MAX _ HEAP _ SIZE \ 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . SSTableOfflineRelevel " $ @ " 
 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstablerepairedset b / tools / bin / sstablerepairedset 
 index 1aa30a3 . . efb8a70 100755 
 - - - a / tools / bin / sstablerepairedset 
 + + + b / tools / bin / sstablerepairedset 
 @ @ - 16 , 32 + 16 , 45 @ @ 
 # See the License for the specific language governing permissions and 
 # limitations under the License . 
 
 - if [ " x $ CLASSPATH " = " x " ] ; then 
 - 
 - # execute from the build dir . 
 - if [ - d ` dirname $ 0 ` / . . / . . / build / classes ] ; then 
 - for directory in ` dirname $ 0 ` / . . / . . / build / classes / * ; do 
 - CLASSPATH = $ CLASSPATH : $ directory 
 - done 
 - else 
 - if [ - f ` dirname $ 0 ` / . . / lib / stress . jar ] ; then 
 - CLASSPATH = ` dirname $ 0 ` / . . / lib / stress . jar 
 + if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 + for include in / usr / share / cassandra / cassandra . in . sh \ 
 + / usr / local / share / cassandra / cassandra . in . sh \ 
 + / opt / cassandra / cassandra . in . sh \ 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 + break 
 fi 
 - fi 
 - 
 - for jar in ` dirname $ 0 ` / . . / . . / lib / * . jar ; do 
 - CLASSPATH = $ CLASSPATH : $ jar 
 done 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 # Use JAVA _ HOME if set , otherwise look for java in PATH 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 + fi 
 + 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 + fi 
 + 
 + if [ - z " $ CLASSPATH " ] ; then 
 + echo " You must set the CLASSPATH var " > & 2 
 + exit 1 
 + fi 
 + 
 + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 + MAX _ HEAP _ SIZE = " 256M " 
 fi 
 
 - $ JAVA - cp $ CLASSPATH \ 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . SSTableRepairedAtSetter " $ @ " 
 + 
 + # vi : ai sw = 4 ts = 4 tw = 0 et 
 diff - - git a / tools / bin / sstablesplit b / tools / bin / sstablesplit 
 index 51da481 . . 90d91ce 100755 
 - - - a / tools / bin / sstablesplit 
 + + + b / tools / bin / sstablesplit 
 @ @ - 20 , 22 + 20 , 27 @ @ if [ " x $ CASSANDRA _ INCLUDE " = " x " ] ; then 
 for include in / usr / share / cassandra / cassandra . in . sh \ 
 / usr / local / share / cassandra / cassandra . in . sh \ 
 / opt / cassandra / cassandra . in . sh \ 
 - ~ / . cassandra . in . sh \ 
 - ` dirname $ 0 ` / cassandra . in . sh ; do 
 - if [ - r $ include ] ; then 
 - . $ include 
 + " $ HOME / . cassandra . in . sh " \ 
 + " ` dirname " $ 0 " ` / cassandra . in . sh " ; do 
 + if [ - r " $ include " ] ; then 
 + . " $ include " 
 break 
 fi 
 done 
 - elif [ - r $ CASSANDRA _ INCLUDE ] ; then 
 - . $ CASSANDRA _ INCLUDE 
 + elif [ - r " $ CASSANDRA _ INCLUDE " ] ; then 
 + . " $ CASSANDRA _ INCLUDE " 
 fi 
 
 # Use JAVA _ HOME if set , otherwise look for java in PATH 
 - if [ - x $ JAVA _ HOME / bin / java ] ; then 
 - JAVA = $ JAVA _ HOME / bin / java 
 + if [ - x " $ JAVA _ HOME / bin / java " ] ; then 
 + JAVA = " $ JAVA _ HOME / bin / java " 
 else 
 - JAVA = ` which java ` 
 + JAVA = " ` which java ` " 
 + fi 
 + 
 + if [ " x $ JAVA " = " x " ] ; then 
 + echo " Java executable not found ( hint : set JAVA _ HOME ) " > & 2 
 + exit 1 
 fi 
 
 if [ - z " $ CLASSPATH " ] ; then 
 @ @ - 43 , 7 + 48 , 11 @ @ if [ - z " $ CLASSPATH " ] ; then 
 exit 1 
 fi 
 
 - " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx256M \ 
 + if [ " x $ MAX _ HEAP _ SIZE " = " x " ] ; then 
 + MAX _ HEAP _ SIZE = " 256M " 
 + fi 
 + 
 + " $ JAVA " $ JAVA _ AGENT - ea - cp " $ CLASSPATH " $ JVM _ OPTS - Xmx $ MAX _ HEAP _ SIZE \ 
 - Dcassandra . storagedir = " $ cassandra _ storagedir " \ 
 - Dlogback . configurationFile = logback - tools . xml \ 
 org . apache . cassandra . tools . StandaloneSplitter " $ @ "

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7c16cd0 . . 65dd404 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 9 , 6 + 9 , 7 @ @ 
 * Fix skipping range tombstones with reverse queries ( CASSANDRA - 5712 ) 
 * Expire entries out of ThriftSessionManager ( CASSANRDA - 5719 ) 
 * Don ' t keep ancestor information in memory ( CASSANDRA - 5342 ) 
 + * cqlsh : fix handling of semicolons inside BATCH queries ( CASSANDRA - 5697 ) 
 
 
 1 . 2 . 6 
 diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py 
 index 0e631ea . . 92701d6 100644 
 - - - a / pylib / cqlshlib / cql3handling . py 
 + + + b / pylib / cqlshlib / cql3handling . py 
 @ @ - 986 , 8 + 986 , 8 @ @ syntax _ rules + = r ' ' ' 
 < batchStatement > : : = " BEGIN " ( " UNLOGGED " | " COUNTER " ) ? " BATCH " 
 ( " USING " [ batchopt ] = < usingOption > 
 ( " AND " [ batchopt ] = < usingOption > ) * ) ? 
 - [ batchstmt ] = < batchStatementMember > " ; " 
 - ( [ batchstmt ] = < batchStatementMember > " ; " ) * 
 + [ batchstmt ] = < batchStatementMember > " ; " ? 
 + ( [ batchstmt ] = < batchStatementMember > " ; " ? ) * 
 " APPLY " " BATCH " 
 ; 
 < batchStatementMember > : : = < insertStatement > 
 diff - - git a / pylib / cqlshlib / cqlhandling . py b / pylib / cqlshlib / cqlhandling . py 
 index 83e1dc2 . . 7d36301 100644 
 - - - a / pylib / cqlshlib / cqlhandling . py 
 + + + b / pylib / cqlshlib / cqlhandling . py 
 @ @ - 189 , 13 + 189 , 11 @ @ class CqlParsingRuleSet ( pylexotron . ParsingRuleSet ) : 
 output [ - 1 ] . extend ( stmt ) 
 else : 
 output . append ( stmt ) 
 - if len ( stmt ) > 1 \ 
 - and stmt [ 0 ] [ 0 ] = = ' identifier ' and stmt [ 1 ] [ 0 ] = = ' identifier ' \ 
 - and stmt [ 1 ] [ 1 ] . lower ( ) = = ' batch ' : 
 - if stmt [ 0 ] [ 1 ] . lower ( ) = = ' begin ' : 
 - in _ batch = True 
 - elif stmt [ 0 ] [ 1 ] . lower ( ) = = ' apply ' : 
 + if len ( stmt ) > 2 : 
 + if stmt [ - 3 ] [ 0 ] = = ' K _ APPLY ' : 
 in _ batch = False 
 + elif stmt [ 0 ] [ 0 ] = = ' K _ BEGIN ' : 
 + in _ batch = True 
 return output , in _ batch 
 
 def cql _ complete _ single ( self , text , partial , init _ bindings = { } , ignore _ case = True ,
