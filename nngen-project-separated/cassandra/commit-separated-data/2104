BLEU SCORE: 1.2806835371715532E-8

TEST MSG: comment
GENERATED MSG: announce version early during startup . Patch by Gary Dusbabek , reviewed by Jonathan Ellis . CASSANDRA - 962

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java b / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java <nl> index ece9289 . . 72e5b9c 100644 <nl> - - - a / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java <nl> + + + b / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java <nl> @ @ - 86 , 7 + 86 , 7 @ @ public abstract class AbstractWriteResponseHandler implements IAsyncCallback <nl> int blockedFor = totalBlockFor ( ) ; <nl> / / It ' s pretty unlikely , but we can race between exiting await above and here , so <nl> / / that we could now have enough acks . In that case , we " lie " on the acks count to <nl> - / / avoid sending confusing info to the user ( see CASSANDRA - ) . <nl> + / / avoid sending confusing info to the user ( see CASSANDRA - 6491 ) . <nl> if ( acks > = blockedFor ) <nl> acks = blockedFor - 1 ; <nl> throw new WriteTimeoutException ( writeType , consistencyLevel , acks , blockedFor ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 6d69e6e . . 3604bde 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 336 , 6 + 336 , 8 @ @ public class StorageService implements IEndPointStateChangeSubscriber , StorageSe <nl> MessagingService . instance . listen ( FBUtilities . getLocalAddress ( ) ) ; <nl> <nl> StorageLoadBalancer . instance . startBroadcasting ( ) ; <nl> + <nl> + MigrationManager . announce ( DatabaseDescriptor . getDefsVersion ( ) , DatabaseDescriptor . getSeeds ( ) ) ; <nl> <nl> / / have to start the gossip service before we can see any info on other nodes . this is necessary <nl> / / for bootstrap to get the load info it needs .

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java b / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java 
 index ece9289 . . 72e5b9c 100644 
 - - - a / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java 
 + + + b / src / java / org / apache / cassandra / service / AbstractWriteResponseHandler . java 
 @ @ - 86 , 7 + 86 , 7 @ @ public abstract class AbstractWriteResponseHandler implements IAsyncCallback 
 int blockedFor = totalBlockFor ( ) ; 
 / / It ' s pretty unlikely , but we can race between exiting await above and here , so 
 / / that we could now have enough acks . In that case , we " lie " on the acks count to 
 - / / avoid sending confusing info to the user ( see CASSANDRA - ) . 
 + / / avoid sending confusing info to the user ( see CASSANDRA - 6491 ) . 
 if ( acks > = blockedFor ) 
 acks = blockedFor - 1 ; 
 throw new WriteTimeoutException ( writeType , consistencyLevel , acks , blockedFor ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 6d69e6e . . 3604bde 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 336 , 6 + 336 , 8 @ @ public class StorageService implements IEndPointStateChangeSubscriber , StorageSe 
 MessagingService . instance . listen ( FBUtilities . getLocalAddress ( ) ) ; 
 
 StorageLoadBalancer . instance . startBroadcasting ( ) ; 
 + 
 + MigrationManager . announce ( DatabaseDescriptor . getDefsVersion ( ) , DatabaseDescriptor . getSeeds ( ) ) ; 
 
 / / have to start the gossip service before we can see any info on other nodes . this is necessary 
 / / for bootstrap to get the load info it needs .
