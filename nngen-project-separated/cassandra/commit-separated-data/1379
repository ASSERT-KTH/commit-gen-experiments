BLEU SCORE: 0.05341087579952926

TEST MSG: Update CQL docs with DateTieredCompactionStrategy
GENERATED MSG: Fix CQL3 doc

TEST DIFF (one line): diff - - git a / doc / cql3 / CQL . textile b / doc / cql3 / CQL . textile <nl> index 6db52d2 . . add0df8 100644 <nl> - - - a / doc / cql3 / CQL . textile <nl> + + + b / doc / cql3 / CQL . textile <nl> @ @ - 336 , 19 + 336 , 22 @ @ Table creation supports the following other @ < property > @ : <nl> <nl> h4 ( # compactionOptions ) . @ compaction @ options <nl> <nl> - The @ compaction @ property must at least define the @ ' class ' @ sub - option , that defines the compaction strategy class to use . The default supported class are @ ' SizeTieredCompactionStrategy ' @ and @ ' LeveledCompactionStrategy ' @ . Custom strategy can be provided by specifying the full class name as a " string constant " : # constants . The rest of the sub - options depends on the chosen class . The sub - options supported by the default classes are : <nl> - <nl> - | _ . option | _ . supported compaction strategy | _ . default | _ . description | <nl> - | @ enabled @ | _ all _ | true | A boolean denoting whether compaction should be enabled or not . | <nl> - | @ tombstone _ threshold @ | _ all _ | 0 . 2 | A ratio such that if a sstable has more than this ratio of gcable tombstones over all contained columns , the sstable will be compacted ( with no other sstables ) for the purpose of purging those tombstones . | <nl> - | @ tombstone _ compaction _ interval @ | _ all _ | 1 day | The minimum time to wait after an sstable creation time before considering it for " tombstone compaction " , where " tombstone compaction " is the compaction triggered if the sstable has more gcable tombstones than @ tombstone _ threshold @ . | <nl> - | @ unchecked _ tombstone _ compaction @ | _ all _ | false | Setting this to true enables more aggressive tombstone compactions - single sstable tombstone compactions will run without checking how likely it is that they will be successful . | <nl> - | @ min _ sstable _ size @ | SizeTieredCompactionStrategy | 50MB | The size tiered strategy groups SSTables to compact in buckets . A bucket groups SSTables that differs from less than 50 % in size . However , for small sizes , this would result in a bucketing that is too fine grained . @ min _ sstable _ size @ defines a size threshold ( in bytes ) below which all SSTables belong to one unique bucket | <nl> - | @ min _ threshold @ | SizeTieredCompactionStrategy | 4 | Minimum number of SSTables needed to start a minor compaction . | <nl> - | @ max _ threshold @ | SizeTieredCompactionStrategy | 32 | Maximum number of SSTables processed by one minor compaction . | <nl> - | @ bucket _ low @ | SizeTieredCompactionStrategy | 0 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) | <nl> - | @ bucket _ high @ | SizeTieredCompactionStrategy | 1 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) . | <nl> - | @ sstable _ size _ in _ mb @ | LeveledCompactionStrategy | 5MB | The target size ( in MB ) for sstables in the leveled strategy . Note that while sstable sizes should stay less or equal to @ sstable _ size _ in _ mb @ , it is possible to exceptionally have a larger sstable as during compaction , data for a given partition key are never split into 2 sstables | <nl> + The @ compaction @ property must at least define the @ ' class ' @ sub - option , that defines the compaction strategy class to use . The default supported class are @ ' SizeTieredCompactionStrategy ' @ , @ ' LeveledCompactionStrategy ' @ and @ ' DateTieredCompactionStrategy ' @ . Custom strategy can be provided by specifying the full class name as a " string constant " : # constants . The rest of the sub - options depends on the chosen class . The sub - options supported by the default classes are : <nl> + <nl> + | _ . option | _ . supported compaction strategy | _ . default | _ . description | <nl> + | @ enabled @ | _ all _ | true | A boolean denoting whether compaction should be enabled or not . | <nl> + | @ tombstone _ threshold @ | _ all _ | 0 . 2 | A ratio such that if a sstable has more than this ratio of gcable tombstones over all contained columns , the sstable will be compacted ( with no other sstables ) for the purpose of purging those tombstones . | <nl> + | @ tombstone _ compaction _ interval @ | _ all _ | 1 day | The minimum time to wait after an sstable creation time before considering it for " tombstone compaction " , where " tombstone compaction " is the compaction triggered if the sstable has more gcable tombstones than @ tombstone _ threshold @ . | <nl> + | @ unchecked _ tombstone _ compaction @ | _ all _ | false | Setting this to true enables more aggressive tombstone compactions - single sstable tombstone compactions will run without checking how likely it is that they will be successful . | <nl> + | @ min _ sstable _ size @ | SizeTieredCompactionStrategy | 50MB | The size tiered strategy groups SSTables to compact in buckets . A bucket groups SSTables that differs from less than 50 % in size . However , for small sizes , this would result in a bucketing that is too fine grained . @ min _ sstable _ size @ defines a size threshold ( in bytes ) below which all SSTables belong to one unique bucket | <nl> + | @ min _ threshold @ | SizeTieredCompactionStrategy | 4 | Minimum number of SSTables needed to start a minor compaction . | <nl> + | @ max _ threshold @ | SizeTieredCompactionStrategy | 32 | Maximum number of SSTables processed by one minor compaction . | <nl> + | @ bucket _ low @ | SizeTieredCompactionStrategy | 0 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) | <nl> + | @ bucket _ high @ | SizeTieredCompactionStrategy | 1 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) . | <nl> + | @ sstable _ size _ in _ mb @ | LeveledCompactionStrategy | 5MB | The target size ( in MB ) for sstables in the leveled strategy . Note that while sstable sizes should stay less or equal to @ sstable _ size _ in _ mb @ , it is possible to exceptionally have a larger sstable as during compaction , data for a given partition key are never split into 2 sstables | <nl> + | @ timestamp _ resolution @ | DateTieredCompactionStrategy | MICROSECONDS | The timestamp resolution used when inserting data , could be MILLISECONDS , MICROSECONDS etc ( should be understandable by Java TimeUnit ) | <nl> + | @ base _ time _ seconds @ | DateTieredCompactionStrategy | 60 | The base size of the time windows . | <nl> + | @ max _ sstable _ age _ days @ | DateTieredCompactionStrategy | 365 | SSTables only containing data that is older than this will never be compacted . | <nl> <nl> <nl> For the @ compression @ property , the following default sub - options are available :
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d4c6697 . . 2346993 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 . 1 <nl> + * nodetool methods to enable / disable hint storage / delivery ( CASSANDRA - 4750 ) <nl> * disallow bloom filter false positive chance of 0 ( CASSANDRA - 5013 ) <nl> * add threadpool size adjustment methods to JMXEnabledThreadPoolExecutor and <nl> CompactionManagerMBean ( CASSANDRA - 5044 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index 476af88 . . 8ca0281 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 87 , 12 + 87 , 15 @ @ import org . cliffc . high _ scale _ lib . NonBlockingHashSet ; <nl> <nl> public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> { <nl> + public static final String MBEAN _ NAME = " org . apache . cassandra . db : type = HintedHandoffManager " ; <nl> public static final HintedHandOffManager instance = new HintedHandOffManager ( ) ; <nl> <nl> private static final Logger logger = LoggerFactory . getLogger ( HintedHandOffManager . class ) ; <nl> private static final int PAGE _ SIZE = 128 ; <nl> private static final int LARGE _ NUMBER = 65536 ; / / 64k nodes ought to be enough for anybody . <nl> <nl> + private volatile boolean hintedHandOffPaused = false ; <nl> + <nl> static final CompositeType comparator = CompositeType . getInstance ( Arrays . < AbstractType < ? > > asList ( UUIDType . instance , Int32Type . instance ) ) ; <nl> <nl> private final NonBlockingHashSet < InetAddress > queuedDeliveries = new NonBlockingHashSet < InetAddress > ( ) ; <nl> @ @ - 108 , 7 + 111 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> MBeanServer mbs = ManagementFactory . getPlatformMBeanServer ( ) ; <nl> try <nl> { <nl> - mbs . registerMBean ( this , new ObjectName ( " org . apache . cassandra . db : type = HintedHandoffManager " ) ) ; <nl> + mbs . registerMBean ( this , new ObjectName ( MBEAN _ NAME ) ) ; <nl> } <nl> catch ( Exception e ) <nl> { <nl> @ @ - 256 , 6 + 259 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> if ( hintStore . isEmpty ( ) ) <nl> return ; / / nothing to do , don ' t confuse users by logging a no - op handoff <nl> <nl> + / / check if hints delivery has been paused <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + return ; <nl> + } <nl> + <nl> logger . debug ( " Checking remote ( { } ) schema before delivering hints " , endpoint ) ; <nl> try <nl> { <nl> @ @ - 303 , 6 + 313 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> <nl> while ( true ) <nl> { <nl> + / / check if hints delivery has been paused during the process <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + break ; <nl> + } <nl> + <nl> QueryFilter filter = QueryFilter . getSliceFilter ( epkey , new QueryPath ( SystemTable . HINTS _ CF ) , startColumn , ByteBufferUtil . EMPTY _ BYTE _ BUFFER , false , pageSize ) ; <nl> ColumnFamily hintsPage = ColumnFamilyStore . removeDeleted ( hintStore . getColumnFamily ( filter ) , ( int ) ( System . currentTimeMillis ( ) / 1000 ) ) ; <nl> if ( pagingFinished ( hintsPage , startColumn ) ) <nl> @ @ - 332 , 6 + 349 , 11 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> if ( ! hint . isLive ( ) ) <nl> continue ; <nl> <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + break ; <nl> + } <nl> startColumn = hint . name ( ) ; <nl> <nl> ByteBuffer [ ] components = comparator . split ( hint . name ( ) ) ; <nl> @ @ - 384 , 6 + 406 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> } <nl> <nl> logger . info ( String . format ( " Finished hinted handoff of % s rows to endpoint % s " , rowsReplayed , endpoint ) ) ; <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . info ( " Hints delivery process is paused , not delivering further hints " ) ; <nl> + } <nl> } <nl> <nl> / * * <nl> @ @ - 440 , 6 + 466 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> scheduleHintDelivery ( InetAddress . getByName ( to ) ) ; <nl> } <nl> <nl> + public void pauseHintsDelivery ( boolean b ) { <nl> + hintedHandOffPaused = b ; <nl> + } <nl> + <nl> public List < String > listEndpointsPendingHints ( ) <nl> { <nl> Token . TokenFactory tokenFactory = StorageService . getPartitioner ( ) . getTokenFactory ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> index 1ba70c4 . . 690a3eb 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> @ @ - 45 , 5 + 45 , 8 @ @ public interface HintedHandOffManagerMBean <nl> <nl> / * * force hint delivery to an endpoint * * / <nl> public void scheduleHintDelivery ( String host ) throws UnknownHostException ; <nl> + <nl> + / * * pause hints delivery process * * / <nl> + public void pauseHintsDelivery ( boolean b ) ; <nl> } <nl> <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> index d72f3d3 . . dddc98c 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> @ @ - 102 , 9 + 102 , 11 @ @ public class NodeCmd <nl> COMPACTIONSTATS , <nl> DECOMMISSION , <nl> DISABLEGOSSIP , <nl> + DISABLEHANDOFF , <nl> DISABLETHRIFT , <nl> DRAIN , <nl> ENABLEGOSSIP , <nl> + ENABLEHANDOFF , <nl> ENABLETHRIFT , <nl> FLUSH , <nl> GETCOMPACTIONTHRESHOLD , <nl> @ @ - 118 , 12 + 120 , 14 @ @ public class NodeCmd <nl> JOIN , <nl> MOVE , <nl> NETSTATS , <nl> + PAUSEHANDOFF , <nl> PROXYHISTOGRAMS , <nl> REBUILD , <nl> REFRESH , <nl> REMOVETOKEN , <nl> REMOVENODE , <nl> REPAIR , <nl> + RESUMEHANDOFF , <nl> RING , <nl> SCRUB , <nl> SETCACHECAPACITY , <nl> @ @ - 1006 , 6 + 1010 , 10 @ @ public class NodeCmd <nl> case COMPACTIONSTATS : nodeCmd . printCompactionStats ( System . out ) ; break ; <nl> case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; <nl> case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; <nl> + case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; <nl> + case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; <nl> + case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; <nl> + case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; <nl> case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; <nl> case ENABLETHRIFT : probe . startThriftServer ( ) ; break ; <nl> case STATUSTHRIFT : nodeCmd . printIsThriftServerRunning ( System . out ) ; break ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 021a40f . . 7a7c60c 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 40 , 6 + 40 , 8 @ @ import com . google . common . collect . Iterables ; <nl> <nl> import org . apache . cassandra . concurrent . JMXEnabledThreadPoolExecutorMBean ; <nl> import org . apache . cassandra . db . ColumnFamilyStoreMBean ; <nl> + import org . apache . cassandra . db . HintedHandOffManager ; <nl> + import org . apache . cassandra . db . HintedHandOffManagerMBean ; <nl> import org . apache . cassandra . db . compaction . CompactionManager ; <nl> import org . apache . cassandra . db . compaction . CompactionManagerMBean ; <nl> import org . apache . cassandra . gms . FailureDetector ; <nl> @ @ - 77 , 6 + 79 , 7 @ @ public class NodeProbe <nl> private CacheServiceMBean cacheService ; <nl> private PBSPredictorMBean PBSPredictorProxy ; <nl> private StorageProxyMBean spProxy ; <nl> + private HintedHandOffManagerMBean hhProxy ; <nl> <nl> / * * <nl> * Creates a NodeProbe using the specified JMX host , port , username , and password . <nl> @ @ - 159 , 6 + 162 , 8 @ @ public class NodeProbe <nl> cacheService = JMX . newMBeanProxy ( mbeanServerConn , name , CacheServiceMBean . class ) ; <nl> name = new ObjectName ( StorageProxy . MBEAN _ NAME ) ; <nl> spProxy = JMX . newMBeanProxy ( mbeanServerConn , name , StorageProxyMBean . class ) ; <nl> + name = new ObjectName ( HintedHandOffManager . MBEAN _ NAME ) ; <nl> + hhProxy = JMX . newMBeanProxy ( mbeanServerConn , name , HintedHandOffManagerMBean . class ) ; <nl> } catch ( MalformedObjectNameException e ) <nl> { <nl> throw new RuntimeException ( <nl> @ @ - 647 , 6 + 652 , 26 @ @ public class NodeProbe <nl> return ssProxy . getKeyspaces ( ) ; <nl> } <nl> <nl> + public void disableHintedHandoff ( ) <nl> + { <nl> + spProxy . setHintedHandoffEnabled ( false ) ; <nl> + } <nl> + <nl> + public void enableHintedHandoff ( ) <nl> + { <nl> + spProxy . setHintedHandoffEnabled ( true ) ; <nl> + } <nl> + <nl> + public void pauseHintsDelivery ( ) <nl> + { <nl> + hhProxy . pauseHintsDelivery ( true ) ; <nl> + } <nl> + <nl> + public void resumeHintsDelivery ( ) <nl> + { <nl> + hhProxy . pauseHintsDelivery ( false ) ; <nl> + } <nl> + <nl> public void stopGossiping ( ) <nl> { <nl> ssProxy . stopGossiping ( ) ; <nl> diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> index 677b689 . . 2398f01 100644 <nl> - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> @ @ - 1 , 4 + 1 , 3 @ @ <nl> - <nl> # Licensed to the Apache Software Foundation ( ASF ) under one <nl> # or more contributor license agreements . See the NOTICE file <nl> # distributed with this work for additional information <nl> @ @ - 50 , 6 + 49 , 18 @ @ commands : <nl> - name : compactionstats <nl> help : | <nl> Print statistics on compactions <nl> + - name : disablehandoff <nl> + help : | <nl> + Disable the future hints storing on the current node <nl> + - name : enablehandoff <nl> + help : | <nl> + Reenable the future hints storing on the current node <nl> + - name : resumehandoff <nl> + help : | <nl> + Resume hints delivery process <nl> + - name : pausehandoff <nl> + help : | <nl> + Pause hints delivery process <nl> - name : disablegossip <nl> help : | <nl> Disable gossip ( effectively marking the node dead )

TEST DIFF:
diff - - git a / doc / cql3 / CQL . textile b / doc / cql3 / CQL . textile 
 index 6db52d2 . . add0df8 100644 
 - - - a / doc / cql3 / CQL . textile 
 + + + b / doc / cql3 / CQL . textile 
 @ @ - 336 , 19 + 336 , 22 @ @ Table creation supports the following other @ < property > @ : 
 
 h4 ( # compactionOptions ) . @ compaction @ options 
 
 - The @ compaction @ property must at least define the @ ' class ' @ sub - option , that defines the compaction strategy class to use . The default supported class are @ ' SizeTieredCompactionStrategy ' @ and @ ' LeveledCompactionStrategy ' @ . Custom strategy can be provided by specifying the full class name as a " string constant " : # constants . The rest of the sub - options depends on the chosen class . The sub - options supported by the default classes are : 
 - 
 - | _ . option | _ . supported compaction strategy | _ . default | _ . description | 
 - | @ enabled @ | _ all _ | true | A boolean denoting whether compaction should be enabled or not . | 
 - | @ tombstone _ threshold @ | _ all _ | 0 . 2 | A ratio such that if a sstable has more than this ratio of gcable tombstones over all contained columns , the sstable will be compacted ( with no other sstables ) for the purpose of purging those tombstones . | 
 - | @ tombstone _ compaction _ interval @ | _ all _ | 1 day | The minimum time to wait after an sstable creation time before considering it for " tombstone compaction " , where " tombstone compaction " is the compaction triggered if the sstable has more gcable tombstones than @ tombstone _ threshold @ . | 
 - | @ unchecked _ tombstone _ compaction @ | _ all _ | false | Setting this to true enables more aggressive tombstone compactions - single sstable tombstone compactions will run without checking how likely it is that they will be successful . | 
 - | @ min _ sstable _ size @ | SizeTieredCompactionStrategy | 50MB | The size tiered strategy groups SSTables to compact in buckets . A bucket groups SSTables that differs from less than 50 % in size . However , for small sizes , this would result in a bucketing that is too fine grained . @ min _ sstable _ size @ defines a size threshold ( in bytes ) below which all SSTables belong to one unique bucket | 
 - | @ min _ threshold @ | SizeTieredCompactionStrategy | 4 | Minimum number of SSTables needed to start a minor compaction . | 
 - | @ max _ threshold @ | SizeTieredCompactionStrategy | 32 | Maximum number of SSTables processed by one minor compaction . | 
 - | @ bucket _ low @ | SizeTieredCompactionStrategy | 0 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) | 
 - | @ bucket _ high @ | SizeTieredCompactionStrategy | 1 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) . | 
 - | @ sstable _ size _ in _ mb @ | LeveledCompactionStrategy | 5MB | The target size ( in MB ) for sstables in the leveled strategy . Note that while sstable sizes should stay less or equal to @ sstable _ size _ in _ mb @ , it is possible to exceptionally have a larger sstable as during compaction , data for a given partition key are never split into 2 sstables | 
 + The @ compaction @ property must at least define the @ ' class ' @ sub - option , that defines the compaction strategy class to use . The default supported class are @ ' SizeTieredCompactionStrategy ' @ , @ ' LeveledCompactionStrategy ' @ and @ ' DateTieredCompactionStrategy ' @ . Custom strategy can be provided by specifying the full class name as a " string constant " : # constants . The rest of the sub - options depends on the chosen class . The sub - options supported by the default classes are : 
 + 
 + | _ . option | _ . supported compaction strategy | _ . default | _ . description | 
 + | @ enabled @ | _ all _ | true | A boolean denoting whether compaction should be enabled or not . | 
 + | @ tombstone _ threshold @ | _ all _ | 0 . 2 | A ratio such that if a sstable has more than this ratio of gcable tombstones over all contained columns , the sstable will be compacted ( with no other sstables ) for the purpose of purging those tombstones . | 
 + | @ tombstone _ compaction _ interval @ | _ all _ | 1 day | The minimum time to wait after an sstable creation time before considering it for " tombstone compaction " , where " tombstone compaction " is the compaction triggered if the sstable has more gcable tombstones than @ tombstone _ threshold @ . | 
 + | @ unchecked _ tombstone _ compaction @ | _ all _ | false | Setting this to true enables more aggressive tombstone compactions - single sstable tombstone compactions will run without checking how likely it is that they will be successful . | 
 + | @ min _ sstable _ size @ | SizeTieredCompactionStrategy | 50MB | The size tiered strategy groups SSTables to compact in buckets . A bucket groups SSTables that differs from less than 50 % in size . However , for small sizes , this would result in a bucketing that is too fine grained . @ min _ sstable _ size @ defines a size threshold ( in bytes ) below which all SSTables belong to one unique bucket | 
 + | @ min _ threshold @ | SizeTieredCompactionStrategy | 4 | Minimum number of SSTables needed to start a minor compaction . | 
 + | @ max _ threshold @ | SizeTieredCompactionStrategy | 32 | Maximum number of SSTables processed by one minor compaction . | 
 + | @ bucket _ low @ | SizeTieredCompactionStrategy | 0 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) | 
 + | @ bucket _ high @ | SizeTieredCompactionStrategy | 1 . 5 | Size tiered consider sstables to be within the same bucket if their size is within [ average _ size * @ bucket _ low @ , average _ size * @ bucket _ high @ ] ( i . e the default groups sstable whose sizes diverges by at most 50 % ) . | 
 + | @ sstable _ size _ in _ mb @ | LeveledCompactionStrategy | 5MB | The target size ( in MB ) for sstables in the leveled strategy . Note that while sstable sizes should stay less or equal to @ sstable _ size _ in _ mb @ , it is possible to exceptionally have a larger sstable as during compaction , data for a given partition key are never split into 2 sstables | 
 + | @ timestamp _ resolution @ | DateTieredCompactionStrategy | MICROSECONDS | The timestamp resolution used when inserting data , could be MILLISECONDS , MICROSECONDS etc ( should be understandable by Java TimeUnit ) | 
 + | @ base _ time _ seconds @ | DateTieredCompactionStrategy | 60 | The base size of the time windows . | 
 + | @ max _ sstable _ age _ days @ | DateTieredCompactionStrategy | 365 | SSTables only containing data that is older than this will never be compacted . | 
 
 
 For the @ compression @ property , the following default sub - options are available :

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d4c6697 . . 2346993 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 . 1 
 + * nodetool methods to enable / disable hint storage / delivery ( CASSANDRA - 4750 ) 
 * disallow bloom filter false positive chance of 0 ( CASSANDRA - 5013 ) 
 * add threadpool size adjustment methods to JMXEnabledThreadPoolExecutor and 
 CompactionManagerMBean ( CASSANDRA - 5044 ) 
 diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index 476af88 . . 8ca0281 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 87 , 12 + 87 , 15 @ @ import org . cliffc . high _ scale _ lib . NonBlockingHashSet ; 
 
 public class HintedHandOffManager implements HintedHandOffManagerMBean 
 { 
 + public static final String MBEAN _ NAME = " org . apache . cassandra . db : type = HintedHandoffManager " ; 
 public static final HintedHandOffManager instance = new HintedHandOffManager ( ) ; 
 
 private static final Logger logger = LoggerFactory . getLogger ( HintedHandOffManager . class ) ; 
 private static final int PAGE _ SIZE = 128 ; 
 private static final int LARGE _ NUMBER = 65536 ; / / 64k nodes ought to be enough for anybody . 
 
 + private volatile boolean hintedHandOffPaused = false ; 
 + 
 static final CompositeType comparator = CompositeType . getInstance ( Arrays . < AbstractType < ? > > asList ( UUIDType . instance , Int32Type . instance ) ) ; 
 
 private final NonBlockingHashSet < InetAddress > queuedDeliveries = new NonBlockingHashSet < InetAddress > ( ) ; 
 @ @ - 108 , 7 + 111 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 MBeanServer mbs = ManagementFactory . getPlatformMBeanServer ( ) ; 
 try 
 { 
 - mbs . registerMBean ( this , new ObjectName ( " org . apache . cassandra . db : type = HintedHandoffManager " ) ) ; 
 + mbs . registerMBean ( this , new ObjectName ( MBEAN _ NAME ) ) ; 
 } 
 catch ( Exception e ) 
 { 
 @ @ - 256 , 6 + 259 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 if ( hintStore . isEmpty ( ) ) 
 return ; / / nothing to do , don ' t confuse users by logging a no - op handoff 
 
 + / / check if hints delivery has been paused 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + return ; 
 + } 
 + 
 logger . debug ( " Checking remote ( { } ) schema before delivering hints " , endpoint ) ; 
 try 
 { 
 @ @ - 303 , 6 + 313 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 
 while ( true ) 
 { 
 + / / check if hints delivery has been paused during the process 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + break ; 
 + } 
 + 
 QueryFilter filter = QueryFilter . getSliceFilter ( epkey , new QueryPath ( SystemTable . HINTS _ CF ) , startColumn , ByteBufferUtil . EMPTY _ BYTE _ BUFFER , false , pageSize ) ; 
 ColumnFamily hintsPage = ColumnFamilyStore . removeDeleted ( hintStore . getColumnFamily ( filter ) , ( int ) ( System . currentTimeMillis ( ) / 1000 ) ) ; 
 if ( pagingFinished ( hintsPage , startColumn ) ) 
 @ @ - 332 , 6 + 349 , 11 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 if ( ! hint . isLive ( ) ) 
 continue ; 
 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + break ; 
 + } 
 startColumn = hint . name ( ) ; 
 
 ByteBuffer [ ] components = comparator . split ( hint . name ( ) ) ; 
 @ @ - 384 , 6 + 406 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 } 
 
 logger . info ( String . format ( " Finished hinted handoff of % s rows to endpoint % s " , rowsReplayed , endpoint ) ) ; 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . info ( " Hints delivery process is paused , not delivering further hints " ) ; 
 + } 
 } 
 
 / * * 
 @ @ - 440 , 6 + 466 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 scheduleHintDelivery ( InetAddress . getByName ( to ) ) ; 
 } 
 
 + public void pauseHintsDelivery ( boolean b ) { 
 + hintedHandOffPaused = b ; 
 + } 
 + 
 public List < String > listEndpointsPendingHints ( ) 
 { 
 Token . TokenFactory tokenFactory = StorageService . getPartitioner ( ) . getTokenFactory ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 index 1ba70c4 . . 690a3eb 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 @ @ - 45 , 5 + 45 , 8 @ @ public interface HintedHandOffManagerMBean 
 
 / * * force hint delivery to an endpoint * * / 
 public void scheduleHintDelivery ( String host ) throws UnknownHostException ; 
 + 
 + / * * pause hints delivery process * * / 
 + public void pauseHintsDelivery ( boolean b ) ; 
 } 
 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 index d72f3d3 . . dddc98c 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 @ @ - 102 , 9 + 102 , 11 @ @ public class NodeCmd 
 COMPACTIONSTATS , 
 DECOMMISSION , 
 DISABLEGOSSIP , 
 + DISABLEHANDOFF , 
 DISABLETHRIFT , 
 DRAIN , 
 ENABLEGOSSIP , 
 + ENABLEHANDOFF , 
 ENABLETHRIFT , 
 FLUSH , 
 GETCOMPACTIONTHRESHOLD , 
 @ @ - 118 , 12 + 120 , 14 @ @ public class NodeCmd 
 JOIN , 
 MOVE , 
 NETSTATS , 
 + PAUSEHANDOFF , 
 PROXYHISTOGRAMS , 
 REBUILD , 
 REFRESH , 
 REMOVETOKEN , 
 REMOVENODE , 
 REPAIR , 
 + RESUMEHANDOFF , 
 RING , 
 SCRUB , 
 SETCACHECAPACITY , 
 @ @ - 1006 , 6 + 1010 , 10 @ @ public class NodeCmd 
 case COMPACTIONSTATS : nodeCmd . printCompactionStats ( System . out ) ; break ; 
 case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; 
 case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; 
 + case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; 
 + case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; 
 + case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; 
 + case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; 
 case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; 
 case ENABLETHRIFT : probe . startThriftServer ( ) ; break ; 
 case STATUSTHRIFT : nodeCmd . printIsThriftServerRunning ( System . out ) ; break ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 021a40f . . 7a7c60c 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 40 , 6 + 40 , 8 @ @ import com . google . common . collect . Iterables ; 
 
 import org . apache . cassandra . concurrent . JMXEnabledThreadPoolExecutorMBean ; 
 import org . apache . cassandra . db . ColumnFamilyStoreMBean ; 
 + import org . apache . cassandra . db . HintedHandOffManager ; 
 + import org . apache . cassandra . db . HintedHandOffManagerMBean ; 
 import org . apache . cassandra . db . compaction . CompactionManager ; 
 import org . apache . cassandra . db . compaction . CompactionManagerMBean ; 
 import org . apache . cassandra . gms . FailureDetector ; 
 @ @ - 77 , 6 + 79 , 7 @ @ public class NodeProbe 
 private CacheServiceMBean cacheService ; 
 private PBSPredictorMBean PBSPredictorProxy ; 
 private StorageProxyMBean spProxy ; 
 + private HintedHandOffManagerMBean hhProxy ; 
 
 / * * 
 * Creates a NodeProbe using the specified JMX host , port , username , and password . 
 @ @ - 159 , 6 + 162 , 8 @ @ public class NodeProbe 
 cacheService = JMX . newMBeanProxy ( mbeanServerConn , name , CacheServiceMBean . class ) ; 
 name = new ObjectName ( StorageProxy . MBEAN _ NAME ) ; 
 spProxy = JMX . newMBeanProxy ( mbeanServerConn , name , StorageProxyMBean . class ) ; 
 + name = new ObjectName ( HintedHandOffManager . MBEAN _ NAME ) ; 
 + hhProxy = JMX . newMBeanProxy ( mbeanServerConn , name , HintedHandOffManagerMBean . class ) ; 
 } catch ( MalformedObjectNameException e ) 
 { 
 throw new RuntimeException ( 
 @ @ - 647 , 6 + 652 , 26 @ @ public class NodeProbe 
 return ssProxy . getKeyspaces ( ) ; 
 } 
 
 + public void disableHintedHandoff ( ) 
 + { 
 + spProxy . setHintedHandoffEnabled ( false ) ; 
 + } 
 + 
 + public void enableHintedHandoff ( ) 
 + { 
 + spProxy . setHintedHandoffEnabled ( true ) ; 
 + } 
 + 
 + public void pauseHintsDelivery ( ) 
 + { 
 + hhProxy . pauseHintsDelivery ( true ) ; 
 + } 
 + 
 + public void resumeHintsDelivery ( ) 
 + { 
 + hhProxy . pauseHintsDelivery ( false ) ; 
 + } 
 + 
 public void stopGossiping ( ) 
 { 
 ssProxy . stopGossiping ( ) ; 
 diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 index 677b689 . . 2398f01 100644 
 - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 @ @ - 1 , 4 + 1 , 3 @ @ 
 - 
 # Licensed to the Apache Software Foundation ( ASF ) under one 
 # or more contributor license agreements . See the NOTICE file 
 # distributed with this work for additional information 
 @ @ - 50 , 6 + 49 , 18 @ @ commands : 
 - name : compactionstats 
 help : | 
 Print statistics on compactions 
 + - name : disablehandoff 
 + help : | 
 + Disable the future hints storing on the current node 
 + - name : enablehandoff 
 + help : | 
 + Reenable the future hints storing on the current node 
 + - name : resumehandoff 
 + help : | 
 + Resume hints delivery process 
 + - name : pausehandoff 
 + help : | 
 + Pause hints delivery process 
 - name : disablegossip 
 help : | 
 Disable gossip ( effectively marking the node dead )
