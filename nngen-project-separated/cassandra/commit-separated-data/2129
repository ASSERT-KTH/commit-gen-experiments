BLEU SCORE: 0.05522397783539471

TEST MSG: Dont try to set repairedAt on old sstables
GENERATED MSG: allow sstable2json on 2i CFs

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7030570 . . fdf6fbe 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 1 <nl> + * Don ' t try to set repairedAt on old sstables ( CASSANDRA - 7913 ) <nl> * Add metrics for tracking PreparedStatement use ( CASSANDRA - 7719 ) <nl> * ( cqlsh ) tab - completion for triggers ( CASSANDRA - 7824 ) <nl> * ( cqlsh ) Support for query paging ( CASSANDRA - 7514 ) <nl> diff - - git a / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java b / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java <nl> index 623e71b . . 4dec32c 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java <nl> + + + b / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java <nl> @ @ - 78 , 14 + 78 , 21 @ @ public class SSTableRepairedAtSetter <nl> <nl> String fname = args [ 2 ] ; <nl> Descriptor descriptor = Descriptor . fromFilename ( fname ) ; <nl> - if ( setIsRepaired ) <nl> + if ( descriptor . version . hasRepairedAt ) <nl> { <nl> - FileTime f = Files . getLastModifiedTime ( new File ( descriptor . filenameFor ( Component . DATA ) ) . toPath ( ) ) ; <nl> - descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , f . toMillis ( ) ) ; <nl> + if ( setIsRepaired ) <nl> + { <nl> + FileTime f = Files . getLastModifiedTime ( new File ( descriptor . filenameFor ( Component . DATA ) ) . toPath ( ) ) ; <nl> + descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , f . toMillis ( ) ) ; <nl> + } <nl> + else <nl> + { <nl> + descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , ActiveRepairService . UNREPAIRED _ SSTABLE ) ; <nl> + } <nl> } <nl> else <nl> { <nl> - descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , ActiveRepairService . UNREPAIRED _ SSTABLE ) ; <nl> + out . println ( " SSTable " + fname + " does not have repaired property , run upgradesstables " ) ; <nl> } <nl> <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / tools / SSTableExport . java b / src / java / org / apache / cassandra / tools / SSTableExport . java <nl> index c407ca1 . . fc64da6 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / SSTableExport . java <nl> + + + b / src / java / org / apache / cassandra / tools / SSTableExport . java <nl> @ @ - 17 , 56 + 17 , 29 @ @ <nl> * / <nl> package org . apache . cassandra . tools ; <nl> <nl> - import static org . apache . cassandra . utils . ByteBufferUtil . bytesToHex ; <nl> - import static org . apache . cassandra . utils . ByteBufferUtil . hexToBytes ; <nl> - <nl> import java . io . File ; <nl> import java . io . IOException ; <nl> import java . io . PrintStream ; <nl> import java . nio . ByteBuffer ; <nl> - import java . util . ArrayList ; <nl> - import java . util . Arrays ; <nl> - import java . util . Collection ; <nl> - import java . util . HashSet ; <nl> - import java . util . Iterator ; <nl> - import java . util . List ; <nl> - import java . util . Set ; <nl> - <nl> - import com . google . common . util . concurrent . RateLimiter ; <nl> - import org . apache . commons . cli . CommandLine ; <nl> - import org . apache . commons . cli . CommandLineParser ; <nl> - import org . apache . commons . cli . Option ; <nl> - import org . apache . commons . cli . Options ; <nl> - import org . apache . commons . cli . ParseException ; <nl> - import org . apache . commons . cli . PosixParser ; <nl> + import java . util . * ; <nl> + <nl> + import org . apache . commons . cli . * ; <nl> <nl> import org . apache . cassandra . config . CFMetaData ; <nl> - import org . apache . cassandra . exceptions . ConfigurationException ; <nl> import org . apache . cassandra . config . DatabaseDescriptor ; <nl> import org . apache . cassandra . config . Schema ; <nl> - import org . apache . cassandra . db . AbstractColumnContainer ; <nl> - import org . apache . cassandra . db . ColumnFamily ; <nl> - import org . apache . cassandra . db . CounterColumn ; <nl> - import org . apache . cassandra . db . DecoratedKey ; <nl> - import org . apache . cassandra . db . DeletedColumn ; <nl> - import org . apache . cassandra . db . DeletionInfo ; <nl> - import org . apache . cassandra . db . DeletionTime ; <nl> - import org . apache . cassandra . db . ExpiringColumn ; <nl> - import org . apache . cassandra . db . IColumn ; <nl> - import org . apache . cassandra . db . OnDiskAtom ; <nl> - import org . apache . cassandra . db . RangeTombstone ; <nl> - import org . apache . cassandra . db . SuperColumn ; <nl> + import org . apache . cassandra . db . * ; <nl> import org . apache . cassandra . db . marshal . AbstractType ; <nl> import org . apache . cassandra . dht . IPartitioner ; <nl> - import org . apache . cassandra . io . sstable . Descriptor ; <nl> - import org . apache . cassandra . io . sstable . KeyIterator ; <nl> - import org . apache . cassandra . io . sstable . SSTableIdentityIterator ; <nl> - import org . apache . cassandra . io . sstable . SSTableReader ; <nl> - import org . apache . cassandra . io . sstable . SSTableScanner ; <nl> + import org . apache . cassandra . exceptions . ConfigurationException ; <nl> + import org . apache . cassandra . io . sstable . * ; <nl> import org . apache . cassandra . utils . ByteBufferUtil ; <nl> import org . codehaus . jackson . JsonGenerator ; <nl> import org . codehaus . jackson . map . ObjectMapper ; <nl> <nl> + import static org . apache . cassandra . utils . ByteBufferUtil . bytesToHex ; <nl> + import static org . apache . cassandra . utils . ByteBufferUtil . hexToBytes ; <nl> + <nl> / * * <nl> * Export SSTables to JSON format . <nl> * /

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7030570 . . fdf6fbe 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 1 
 + * Don ' t try to set repairedAt on old sstables ( CASSANDRA - 7913 ) 
 * Add metrics for tracking PreparedStatement use ( CASSANDRA - 7719 ) 
 * ( cqlsh ) tab - completion for triggers ( CASSANDRA - 7824 ) 
 * ( cqlsh ) Support for query paging ( CASSANDRA - 7514 ) 
 diff - - git a / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java b / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java 
 index 623e71b . . 4dec32c 100644 
 - - - a / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java 
 + + + b / src / java / org / apache / cassandra / tools / SSTableRepairedAtSetter . java 
 @ @ - 78 , 14 + 78 , 21 @ @ public class SSTableRepairedAtSetter 
 
 String fname = args [ 2 ] ; 
 Descriptor descriptor = Descriptor . fromFilename ( fname ) ; 
 - if ( setIsRepaired ) 
 + if ( descriptor . version . hasRepairedAt ) 
 { 
 - FileTime f = Files . getLastModifiedTime ( new File ( descriptor . filenameFor ( Component . DATA ) ) . toPath ( ) ) ; 
 - descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , f . toMillis ( ) ) ; 
 + if ( setIsRepaired ) 
 + { 
 + FileTime f = Files . getLastModifiedTime ( new File ( descriptor . filenameFor ( Component . DATA ) ) . toPath ( ) ) ; 
 + descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , f . toMillis ( ) ) ; 
 + } 
 + else 
 + { 
 + descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , ActiveRepairService . UNREPAIRED _ SSTABLE ) ; 
 + } 
 } 
 else 
 { 
 - descriptor . getMetadataSerializer ( ) . mutateRepairedAt ( descriptor , ActiveRepairService . UNREPAIRED _ SSTABLE ) ; 
 + out . println ( " SSTable " + fname + " does not have repaired property , run upgradesstables " ) ; 
 } 
 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / tools / SSTableExport . java b / src / java / org / apache / cassandra / tools / SSTableExport . java 
 index c407ca1 . . fc64da6 100644 
 - - - a / src / java / org / apache / cassandra / tools / SSTableExport . java 
 + + + b / src / java / org / apache / cassandra / tools / SSTableExport . java 
 @ @ - 17 , 56 + 17 , 29 @ @ 
 * / 
 package org . apache . cassandra . tools ; 
 
 - import static org . apache . cassandra . utils . ByteBufferUtil . bytesToHex ; 
 - import static org . apache . cassandra . utils . ByteBufferUtil . hexToBytes ; 
 - 
 import java . io . File ; 
 import java . io . IOException ; 
 import java . io . PrintStream ; 
 import java . nio . ByteBuffer ; 
 - import java . util . ArrayList ; 
 - import java . util . Arrays ; 
 - import java . util . Collection ; 
 - import java . util . HashSet ; 
 - import java . util . Iterator ; 
 - import java . util . List ; 
 - import java . util . Set ; 
 - 
 - import com . google . common . util . concurrent . RateLimiter ; 
 - import org . apache . commons . cli . CommandLine ; 
 - import org . apache . commons . cli . CommandLineParser ; 
 - import org . apache . commons . cli . Option ; 
 - import org . apache . commons . cli . Options ; 
 - import org . apache . commons . cli . ParseException ; 
 - import org . apache . commons . cli . PosixParser ; 
 + import java . util . * ; 
 + 
 + import org . apache . commons . cli . * ; 
 
 import org . apache . cassandra . config . CFMetaData ; 
 - import org . apache . cassandra . exceptions . ConfigurationException ; 
 import org . apache . cassandra . config . DatabaseDescriptor ; 
 import org . apache . cassandra . config . Schema ; 
 - import org . apache . cassandra . db . AbstractColumnContainer ; 
 - import org . apache . cassandra . db . ColumnFamily ; 
 - import org . apache . cassandra . db . CounterColumn ; 
 - import org . apache . cassandra . db . DecoratedKey ; 
 - import org . apache . cassandra . db . DeletedColumn ; 
 - import org . apache . cassandra . db . DeletionInfo ; 
 - import org . apache . cassandra . db . DeletionTime ; 
 - import org . apache . cassandra . db . ExpiringColumn ; 
 - import org . apache . cassandra . db . IColumn ; 
 - import org . apache . cassandra . db . OnDiskAtom ; 
 - import org . apache . cassandra . db . RangeTombstone ; 
 - import org . apache . cassandra . db . SuperColumn ; 
 + import org . apache . cassandra . db . * ; 
 import org . apache . cassandra . db . marshal . AbstractType ; 
 import org . apache . cassandra . dht . IPartitioner ; 
 - import org . apache . cassandra . io . sstable . Descriptor ; 
 - import org . apache . cassandra . io . sstable . KeyIterator ; 
 - import org . apache . cassandra . io . sstable . SSTableIdentityIterator ; 
 - import org . apache . cassandra . io . sstable . SSTableReader ; 
 - import org . apache . cassandra . io . sstable . SSTableScanner ; 
 + import org . apache . cassandra . exceptions . ConfigurationException ; 
 + import org . apache . cassandra . io . sstable . * ; 
 import org . apache . cassandra . utils . ByteBufferUtil ; 
 import org . codehaus . jackson . JsonGenerator ; 
 import org . codehaus . jackson . map . ObjectMapper ; 
 
 + import static org . apache . cassandra . utils . ByteBufferUtil . bytesToHex ; 
 + import static org . apache . cassandra . utils . ByteBufferUtil . hexToBytes ; 
 + 
 / * * 
 * Export SSTables to JSON format . 
 * /
