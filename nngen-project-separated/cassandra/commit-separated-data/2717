BLEU SCORE: 0.03283637368030199

TEST MSG: Allow per - dc enabling of hints
GENERATED MSG: merge from 0 . 7

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index bdfec11 . . f0c116f 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 6 <nl> + * Allow per - dc enabling of hints ( CASSANDRA - 6157 ) <nl> * Add compatibility for Hadoop 0 . 2 . x ( CASSANDRA - 5201 ) <nl> * Fix EstimatedHistogram races ( CASSANDRA - 6682 ) <nl> * Failure detector correctly converts initial value to nanos ( CASSANDRA - 6658 ) <nl> @ @ - 27 , 6 + 28 , 7 @ @ Merged from 1 . 2 : <nl> * Fix SecondaryIndexManager # deleteFromIndexes ( ) ( CASSANDRA - 6711 ) <nl> * Fix snapshot repair not snapshotting coordinator itself ( CASSANDRA - 6713 ) <nl> <nl> + <nl> 2 . 0 . 5 <nl> * Reduce garbage generated by bloom filter lookups ( CASSANDRA - 6609 ) <nl> * Add ks . cf names to tombstone logging ( CASSANDRA - 6597 ) <nl> diff - - git a / build . xml b / build . xml <nl> index fb774f6 . . 77b2639 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 381 , 6 + 381 , 7 @ @ <nl> < dependency groupId = " edu . stanford . ppl " artifactId = " snaptree " version = " 0 . 1 " / > <nl> < dependency groupId = " org . mindrot " artifactId = " jbcrypt " version = " 0 . 3m " / > <nl> < dependency groupId = " io . netty " artifactId = " netty " version = " 3 . 6 . 6 . Final " / > <nl> + < dependency groupId = " net . sf . supercsv " artifactId = " super - csv " version = " 2 . 1 . 0 " / > <nl> < / dependencyManagement > <nl> < developer id = " alakshman " name = " Avinash Lakshman " / > <nl> < developer id = " antelder " name = " Anthony Elder " / > <nl> @ @ - 461 , 6 + 462 , 7 @ @ <nl> < dependency groupId = " com . yammer . metrics " artifactId = " metrics - core " / > <nl> < dependency groupId = " com . addthis . metrics " artifactId = " reporter - config " / > <nl> < dependency groupId = " com . thinkaurelius . thrift " artifactId = " thrift - server " version = " 0 . 3 . 3 " / > <nl> + < dependency groupId = " net . sf . supercsv " artifactId = " super - csv " version = " 2 . 1 . 0 " / > <nl> <nl> < dependency groupId = " log4j " artifactId = " log4j " / > <nl> < ! - - cassandra has a hard dependency on log4j , so force slf4j ' s log4j provider at runtime - - > <nl> diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml <nl> index bfe60c4 . . 4c9ad67 100644 <nl> - - - a / conf / cassandra . yaml <nl> + + + b / conf / cassandra . yaml <nl> @ @ - 29 , 6 + 29 , 9 @ @ num _ tokens : 256 <nl> # that do not have vnodes enabled . <nl> # initial _ token : <nl> <nl> + # May either be " true " or " false " to enable globally , or contain a list <nl> + # of data centers to enable per - datacenter . <nl> + # hinted _ handoff _ enabled : DC1 , DC2 <nl> # See http : / / wiki . apache . org / cassandra / HintedHandoff <nl> hinted _ handoff _ enabled : true <nl> # this defines the maximum amount of time a dead host will have hints <nl> diff - - git a / lib / licenses / super - csv - 2 . 1 . 0 . txt b / lib / licenses / super - csv - 2 . 1 . 0 . txt <nl> new file mode 100644 <nl> index 0000000 . . d645695 <nl> - - - / dev / null <nl> + + + b / lib / licenses / super - csv - 2 . 1 . 0 . txt <nl> @ @ - 0 , 0 + 1 , 202 @ @ <nl> + <nl> + Apache License <nl> + Version 2 . 0 , January 2004 <nl> + http : / / www . apache . org / licenses / <nl> + <nl> + TERMS AND CONDITIONS FOR USE , REPRODUCTION , AND DISTRIBUTION <nl> + <nl> + 1 . Definitions . <nl> + <nl> + " License " shall mean the terms and conditions for use , reproduction , <nl> + and distribution as defined by Sections 1 through 9 of this document . <nl> + <nl> + " Licensor " shall mean the copyright owner or entity authorized by <nl> + the copyright owner that is granting the License . <nl> + <nl> + " Legal Entity " shall mean the union of the acting entity and all <nl> + other entities that control , are controlled by , or are under common <nl> + control with that entity . For the purposes of this definition , <nl> + " control " means ( i ) the power , direct or indirect , to cause the <nl> + direction or management of such entity , whether by contract or <nl> + otherwise , or ( ii ) ownership of fifty percent ( 50 % ) or more of the <nl> + outstanding shares , or ( iii ) beneficial ownership of such entity . <nl> + <nl> + " You " ( or " Your " ) shall mean an individual or Legal Entity <nl> + exercising permissions granted by this License . <nl> + <nl> + " Source " form shall mean the preferred form for making modifications , <nl> + including but not limited to software source code , documentation <nl> + source , and configuration files . <nl> + <nl> + " Object " form shall mean any form resulting from mechanical <nl> + transformation or translation of a Source form , including but <nl> + not limited to compiled object code , generated documentation , <nl> + and conversions to other media types . <nl> + <nl> + " Work " shall mean the work of authorship , whether in Source or <nl> + Object form , made available under the License , as indicated by a <nl> + copyright notice that is included in or attached to the work <nl> + ( an example is provided in the Appendix below ) . <nl> + <nl> + " Derivative Works " shall mean any work , whether in Source or Object <nl> + form , that is based on ( or derived from ) the Work and for which the <nl> + editorial revisions , annotations , elaborations , or other modifications <nl> + represent , as a whole , an original work of authorship . For the purposes <nl> + of this License , Derivative Works shall not include works that remain <nl> + separable from , or merely link ( or bind by name ) to the interfaces of , <nl> + the Work and Derivative Works thereof . <nl> + <nl> + " Contribution " shall mean any work of authorship , including <nl> + the original version of the Work and any modifications or additions <nl> + to that Work or Derivative Works thereof , that is intentionally <nl> + submitted to Licensor for inclusion in the Work by the copyright owner <nl> + or by an individual or Legal Entity authorized to submit on behalf of <nl> + the copyright owner . For the purposes of this definition , " submitted " <nl> + means any form of electronic , verbal , or written communication sent <nl> + to the Licensor or its representatives , including but not limited to <nl> + communication on electronic mailing lists , source code control systems , <nl> + and issue tracking systems that are managed by , or on behalf of , the <nl> + Licensor for the purpose of discussing and improving the Work , but <nl> + excluding communication that is conspicuously marked or otherwise <nl> + designated in writing by the copyright owner as " Not a Contribution . " <nl> + <nl> + " Contributor " shall mean Licensor and any individual or Legal Entity <nl> + on behalf of whom a Contribution has been received by Licensor and <nl> + subsequently incorporated within the Work . <nl> + <nl> + 2 . Grant of Copyright License . Subject to the terms and conditions of <nl> + this License , each Contributor hereby grants to You a perpetual , <nl> + worldwide , non - exclusive , no - charge , royalty - free , irrevocable <nl> + copyright license to reproduce , prepare Derivative Works of , <nl> + publicly display , publicly perform , sublicense , and distribute the <nl> + Work and such Derivative Works in Source or Object form . <nl> + <nl> + 3 . Grant of Patent License . Subject to the terms and conditions of <nl> + this License , each Contributor hereby grants to You a perpetual , <nl> + worldwide , non - exclusive , no - charge , royalty - free , irrevocable <nl> + ( except as stated in this section ) patent license to make , have made , <nl> + use , offer to sell , sell , import , and otherwise transfer the Work , <nl> + where such license applies only to those patent claims licensable <nl> + by such Contributor that are necessarily infringed by their <nl> + Contribution ( s ) alone or by combination of their Contribution ( s ) <nl> + with the Work to which such Contribution ( s ) was submitted . If You <nl> + institute patent litigation against any entity ( including a <nl> + cross - claim or counterclaim in a lawsuit ) alleging that the Work <nl> + or a Contribution incorporated within the Work constitutes direct <nl> + or contributory patent infringement , then any patent licenses <nl> + granted to You under this License for that Work shall terminate <nl> + as of the date such litigation is filed . <nl> + <nl> + 4 . Redistribution . You may reproduce and distribute copies of the <nl> + Work or Derivative Works thereof in any medium , with or without <nl> + modifications , and in Source or Object form , provided that You <nl> + meet the following conditions : <nl> + <nl> + ( a ) You must give any other recipients of the Work or <nl> + Derivative Works a copy of this License ; and <nl> + <nl> + ( b ) You must cause any modified files to carry prominent notices <nl> + stating that You changed the files ; and <nl> + <nl> + ( c ) You must retain , in the Source form of any Derivative Works <nl> + that You distribute , all copyright , patent , trademark , and <nl> + attribution notices from the Source form of the Work , <nl> + excluding those notices that do not pertain to any part of <nl> + the Derivative Works ; and <nl> + <nl> + ( d ) If the Work includes a " NOTICE " text file as part of its <nl> + distribution , then any Derivative Works that You distribute must <nl> + include a readable copy of the attribution notices contained <nl> + within such NOTICE file , excluding those notices that do not <nl> + pertain to any part of the Derivative Works , in at least one <nl> + of the following places : within a NOTICE text file distributed <nl> + as part of the Derivative Works ; within the Source form or <nl> + documentation , if provided along with the Derivative Works ; or , <nl> + within a display generated by the Derivative Works , if and <nl> + wherever such third - party notices normally appear . The contents <nl> + of the NOTICE file are for informational purposes only and <nl> + do not modify the License . You may add Your own attribution <nl> + notices within Derivative Works that You distribute , alongside <nl> + or as an addendum to the NOTICE text from the Work , provided <nl> + that such additional attribution notices cannot be construed <nl> + as modifying the License . <nl> + <nl> + You may add Your own copyright statement to Your modifications and <nl> + may provide additional or different license terms and conditions <nl> + for use , reproduction , or distribution of Your modifications , or <nl> + for any such Derivative Works as a whole , provided Your use , <nl> + reproduction , and distribution of the Work otherwise complies with <nl> + the conditions stated in this License . <nl> + <nl> + 5 . Submission of Contributions . Unless You explicitly state otherwise , <nl> + any Contribution intentionally submitted for inclusion in the Work <nl> + by You to the Licensor shall be under the terms and conditions of <nl> + this License , without any additional terms or conditions . <nl> + Notwithstanding the above , nothing herein shall supersede or modify <nl> + the terms of any separate license agreement you may have executed <nl> + with Licensor regarding such Contributions . <nl> + <nl> + 6 . Trademarks . This License does not grant permission to use the trade <nl> + names , trademarks , service marks , or product names of the Licensor , <nl> + except as required for reasonable and customary use in describing the <nl> + origin of the Work and reproducing the content of the NOTICE file . <nl> + <nl> + 7 . Disclaimer of Warranty . Unless required by applicable law or <nl> + agreed to in writing , Licensor provides the Work ( and each <nl> + Contributor provides its Contributions ) on an " AS IS " BASIS , <nl> + WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or <nl> + implied , including , without limitation , any warranties or conditions <nl> + of TITLE , NON - INFRINGEMENT , MERCHANTABILITY , or FITNESS FOR A <nl> + PARTICULAR PURPOSE . You are solely responsible for determining the <nl> + appropriateness of using or redistributing the Work and assume any <nl> + risks associated with Your exercise of permissions under this License . <nl> + <nl> + 8 . Limitation of Liability . In no event and under no legal theory , <nl> + whether in tort ( including negligence ) , contract , or otherwise , <nl> + unless required by applicable law ( such as deliberate and grossly <nl> + negligent acts ) or agreed to in writing , shall any Contributor be <nl> + liable to You for damages , including any direct , indirect , special , <nl> + incidental , or consequential damages of any character arising as a <nl> + result of this License or out of the use or inability to use the <nl> + Work ( including but not limited to damages for loss of goodwill , <nl> + work stoppage , computer failure or malfunction , or any and all <nl> + other commercial damages or losses ) , even if such Contributor <nl> + has been advised of the possibility of such damages . <nl> + <nl> + 9 . Accepting Warranty or Additional Liability . While redistributing <nl> + the Work or Derivative Works thereof , You may choose to offer , <nl> + and charge a fee for , acceptance of support , warranty , indemnity , <nl> + or other liability obligations and / or rights consistent with this <nl> + License . However , in accepting such obligations , You may act only <nl> + on Your own behalf and on Your sole responsibility , not on behalf <nl> + of any other Contributor , and only if You agree to indemnify , <nl> + defend , and hold each Contributor harmless for any liability <nl> + incurred by , or claims asserted against , such Contributor by reason <nl> + of your accepting any such warranty or additional liability . <nl> + <nl> + END OF TERMS AND CONDITIONS <nl> + <nl> + APPENDIX : How to apply the Apache License to your work . <nl> + <nl> + To apply the Apache License to your work , attach the following <nl> + boilerplate notice , with the fields enclosed by brackets " [ ] " <nl> + replaced with your own identifying information . ( Don ' t include <nl> + the brackets ! ) The text should be enclosed in the appropriate <nl> + comment syntax for the file format . We also recommend that a <nl> + file or class name and description of purpose be included on the <nl> + same " printed page " as the copyright notice for easier <nl> + identification within third - party archives . <nl> + <nl> + Copyright [ yyyy ] [ name of copyright owner ] <nl> + <nl> + Licensed under the Apache License , Version 2 . 0 ( the " License " ) ; <nl> + you may not use this file except in compliance with the License . <nl> + You may obtain a copy of the License at <nl> + <nl> + http : / / www . apache . org / licenses / LICENSE - 2 . 0 <nl> + <nl> + Unless required by applicable law or agreed to in writing , software <nl> + distributed under the License is distributed on an " AS IS " BASIS , <nl> + WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . <nl> + See the License for the specific language governing permissions and <nl> + limitations under the License . <nl> diff - - git a / lib / super - csv - 2 . 1 . 0 . jar b / lib / super - csv - 2 . 1 . 0 . jar <nl> new file mode 100644 <nl> index 0000000 . . 6a85716 <nl> Binary files / dev / null and b / lib / super - csv - 2 . 1 . 0 . jar differ <nl> diff - - git a / src / java / org / apache / cassandra / config / Config . java b / src / java / org / apache / cassandra / config / Config . java <nl> index 2fa49f3 . . ceb8df0 100644 <nl> - - - a / src / java / org / apache / cassandra / config / Config . java <nl> + + + b / src / java / org / apache / cassandra / config / Config . java <nl> @ @ - 17 , 8 + 17 , 18 @ @ <nl> * / <nl> package org . apache . cassandra . config ; <nl> <nl> + import java . io . IOException ; <nl> + import java . io . StringReader ; <nl> + import java . util . List ; <nl> + import java . util . Set ; <nl> + <nl> + import com . google . common . collect . Sets ; <nl> + import org . supercsv . io . CsvListReader ; <nl> + import org . supercsv . prefs . CsvPreference ; <nl> + <nl> import org . apache . cassandra . config . EncryptionOptions . ClientEncryptionOptions ; <nl> import org . apache . cassandra . config . EncryptionOptions . ServerEncryptionOptions ; <nl> + import org . apache . cassandra . exceptions . ConfigurationException ; <nl> import org . apache . cassandra . io . util . NativeAllocator ; <nl> import org . apache . cassandra . utils . FBUtilities ; <nl> <nl> @ @ - 38 , 7 + 48 , 9 @ @ public class Config <nl> public String partitioner ; <nl> <nl> public Boolean auto _ bootstrap = true ; <nl> - public volatile Boolean hinted _ handoff _ enabled = true ; <nl> + public volatile boolean hinted _ handoff _ enabled _ global = true ; <nl> + public String hinted _ handoff _ enabled ; <nl> + public Set < String > hinted _ handoff _ enabled _ by _ dc = Sets . newConcurrentHashSet ( ) ; <nl> public volatile Integer max _ hint _ window _ in _ ms = 3600 * 1000 ; / / one hour <nl> <nl> public SeedProviderDef seed _ provider ; <nl> @ @ - 185 , 6 + 197 , 9 @ @ public class Config <nl> public volatile int tombstone _ warn _ threshold = 1000 ; <nl> public volatile int tombstone _ failure _ threshold = 100000 ; <nl> <nl> + private static final CsvPreference STANDARD _ SURROUNDING _ SPACES _ NEED _ QUOTES = new CsvPreference . Builder ( CsvPreference . STANDARD _ PREFERENCE ) <nl> + . surroundingSpacesNeedQuotes ( true ) . build ( ) ; <nl> + <nl> public static boolean getOutboundBindAny ( ) <nl> { <nl> return outboundBindAny ; <nl> @ @ - 205 , 6 + 220 , 38 @ @ public class Config <nl> isClientMode = clientMode ; <nl> } <nl> <nl> + public void configHintedHandoff ( ) throws ConfigurationException <nl> + { <nl> + if ( hinted _ handoff _ enabled ! = null & & ! hinted _ handoff _ enabled . isEmpty ( ) ) <nl> + { <nl> + if ( hinted _ handoff _ enabled . toLowerCase ( ) . equalsIgnoreCase ( " true " ) ) <nl> + { <nl> + hinted _ handoff _ enabled _ global = true ; <nl> + } <nl> + else if ( hinted _ handoff _ enabled . toLowerCase ( ) . equalsIgnoreCase ( " false " ) ) <nl> + { <nl> + hinted _ handoff _ enabled _ global = false ; <nl> + } <nl> + else <nl> + { <nl> + try <nl> + { <nl> + hinted _ handoff _ enabled _ by _ dc . addAll ( parseHintedHandoffEnabledDCs ( hinted _ handoff _ enabled ) ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + throw new ConfigurationException ( " Invalid hinted _ handoff _ enabled parameter " + hinted _ handoff _ enabled , e ) ; <nl> + } <nl> + } <nl> + } <nl> + } <nl> + <nl> + public static List < String > parseHintedHandoffEnabledDCs ( final String dcNames ) throws IOException <nl> + { <nl> + final CsvListReader csvListReader = new CsvListReader ( new StringReader ( dcNames ) , STANDARD _ SURROUNDING _ SPACES _ NEED _ QUOTES ) ; <nl> + return csvListReader . read ( ) ; <nl> + } <nl> + <nl> public static enum CommitLogSync <nl> { <nl> periodic , <nl> diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index e1a95ab . . 9e06601 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 19 , 6 + 19 , 7 @ @ package org . apache . cassandra . config ; <nl> <nl> import java . io . File ; <nl> import java . io . FileFilter ; <nl> + import java . io . IOException ; <nl> import java . net . InetAddress ; <nl> import java . net . UnknownHostException ; <nl> import java . util . * ; <nl> @ @ - 1109 , 12 + 1110 , 47 @ @ public class DatabaseDescriptor <nl> <nl> public static void setHintedHandoffEnabled ( boolean hintedHandoffEnabled ) <nl> { <nl> - conf . hinted _ handoff _ enabled = hintedHandoffEnabled ; <nl> + conf . hinted _ handoff _ enabled _ global = hintedHandoffEnabled ; <nl> + conf . hinted _ handoff _ enabled _ by _ dc . clear ( ) ; <nl> + } <nl> + <nl> + public static void setHintedHandoffEnabled ( final String dcNames ) <nl> + { <nl> + List < String > dcNameList ; <nl> + try <nl> + { <nl> + dcNameList = Config . parseHintedHandoffEnabledDCs ( dcNames ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + throw new IllegalArgumentException ( " Could not read csv of dcs for hinted handoff enable . " + dcNames , e ) ; <nl> + } <nl> + <nl> + if ( dcNameList . isEmpty ( ) ) <nl> + throw new IllegalArgumentException ( " Empty list of Dcs for hinted handoff enable " ) ; <nl> + <nl> + conf . hinted _ handoff _ enabled _ by _ dc . clear ( ) ; <nl> + conf . hinted _ handoff _ enabled _ by _ dc . addAll ( dcNameList ) ; <nl> } <nl> <nl> public static boolean hintedHandoffEnabled ( ) <nl> { <nl> - return conf . hinted _ handoff _ enabled ; <nl> + return conf . hinted _ handoff _ enabled _ global ; <nl> + } <nl> + <nl> + public static Set < String > hintedHandoffEnabledByDC ( ) <nl> + { <nl> + return Collections . unmodifiableSet ( conf . hinted _ handoff _ enabled _ by _ dc ) ; <nl> + } <nl> + <nl> + public static boolean shouldHintByDC ( ) <nl> + { <nl> + return ! conf . hinted _ handoff _ enabled _ by _ dc . isEmpty ( ) ; <nl> + } <nl> + <nl> + public static boolean hintedHandoffEnabled ( final String dcName ) <nl> + { <nl> + return conf . hinted _ handoff _ enabled _ by _ dc . contains ( dcName ) ; <nl> } <nl> <nl> public static void setMaxHintWindow ( int ms ) <nl> diff - - git a / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java b / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java <nl> index d8a138c . . 6b5a152 100644 <nl> - - - a / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java <nl> + + + b / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java <nl> @ @ - 91 , 6 + 91 , 7 @ @ public class YamlConfigurationLoader implements ConfigurationLoader <nl> constructor . setPropertyUtils ( propertiesChecker ) ; <nl> Yaml yaml = new Yaml ( constructor ) ; <nl> Config result = yaml . loadAs ( input , Config . class ) ; <nl> + result . configHintedHandoff ( ) ; <nl> propertiesChecker . check ( ) ; <nl> return result ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> index 8d1f913 . . 14c1ce3 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageProxy . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> @ @ - 1758 , 11 + 1758 , 21 @ @ public class StorageProxy implements StorageProxyMBean <nl> return DatabaseDescriptor . hintedHandoffEnabled ( ) ; <nl> } <nl> <nl> + public Set < String > getHintedHandoffEnabledByDC ( ) <nl> + { <nl> + return DatabaseDescriptor . hintedHandoffEnabledByDC ( ) ; <nl> + } <nl> + <nl> public void setHintedHandoffEnabled ( boolean b ) <nl> { <nl> DatabaseDescriptor . setHintedHandoffEnabled ( b ) ; <nl> } <nl> <nl> + public void setHintedHandoffEnabledByDCList ( String dcNames ) <nl> + { <nl> + DatabaseDescriptor . setHintedHandoffEnabled ( dcNames ) ; <nl> + } <nl> + <nl> public int getMaxHintWindow ( ) <nl> { <nl> return DatabaseDescriptor . getMaxHintWindow ( ) ; <nl> @ @ - 1775 , 7 + 1785 , 17 @ @ public class StorageProxy implements StorageProxyMBean <nl> <nl> public static boolean shouldHint ( InetAddress ep ) <nl> { <nl> - if ( ! DatabaseDescriptor . hintedHandoffEnabled ( ) ) <nl> + if ( DatabaseDescriptor . shouldHintByDC ( ) ) <nl> + { <nl> + final String dc = DatabaseDescriptor . getEndpointSnitch ( ) . getDatacenter ( ep ) ; <nl> + / / Disable DC specific hints <nl> + if ( ! DatabaseDescriptor . hintedHandoffEnabled ( dc ) ) <nl> + { <nl> + HintedHandOffManager . instance . metrics . incrPastWindow ( ep ) ; <nl> + return false ; <nl> + } <nl> + } <nl> + else if ( ! DatabaseDescriptor . hintedHandoffEnabled ( ) ) <nl> { <nl> HintedHandOffManager . instance . metrics . incrPastWindow ( ep ) ; <nl> return false ; <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageProxyMBean . java b / src / java / org / apache / cassandra / service / StorageProxyMBean . java <nl> index ad7d4c7 . . 203cabe 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageProxyMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageProxyMBean . java <nl> @ @ - 19 , 6 + 19 , 7 @ @ package org . apache . cassandra . service ; <nl> <nl> import java . util . List ; <nl> import java . util . Map ; <nl> + import java . util . Set ; <nl> <nl> public interface StorageProxyMBean <nl> { <nl> @ @ - 72 , 7 + 73 , 9 @ @ public interface StorageProxyMBean <nl> <nl> public long getTotalHints ( ) ; <nl> public boolean getHintedHandoffEnabled ( ) ; <nl> + public Set < String > getHintedHandoffEnabledByDC ( ) ; <nl> public void setHintedHandoffEnabled ( boolean b ) ; <nl> + public void setHintedHandoffEnabledByDCList ( String dcs ) ; <nl> public int getMaxHintWindow ( ) ; <nl> public void setMaxHintWindow ( int ms ) ; <nl> public int getMaxHintsInProgress ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> index f3cd563 . . fb29342 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> @ @ - 1229 , 7 + 1229 , 10 @ @ public class NodeCmd <nl> case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; <nl> case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; <nl> case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; <nl> - case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; <nl> + case ENABLEHANDOFF : <nl> + if ( arguments . length > 0 ) { probe . enableHintedHandoff ( arguments [ 0 ] ) ; } <nl> + else { probe . enableHintedHandoff ( ) ; } <nl> + break ; <nl> case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; <nl> case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; <nl> case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index ffd6203 . . 28cafb7 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 721 , 6 + 721 , 11 @ @ public class NodeProbe <nl> spProxy . setHintedHandoffEnabled ( true ) ; <nl> } <nl> <nl> + public void enableHintedHandoff ( String dcNames ) <nl> + { <nl> + spProxy . setHintedHandoffEnabledByDCList ( dcNames ) ; <nl> + } <nl> + <nl> public void pauseHintsDelivery ( ) <nl> { <nl> hhProxy . pauseHintsDelivery ( true ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index eec904a . . 982454c 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 59 , 6 + 59 , 8 @ @ <nl> the old ones ( CASSANDRA - 1644 ) <nl> * upgrade to Thrift 0 . 5 ( CASSANDRA - 1367 ) <nl> * renamed CL . DCQUORUM to LOCAL _ QUORUM and DCQUORUMSYNC to EACH _ QUORUM <nl> + * cli truncate support ( CASSANDRA - 1653 ) <nl> + * update GC settings in cassandra . bat ( CASSANDRA - 1636 ) <nl> <nl> <nl> 0 . 7 - beta2 <nl> diff - - git a / src / java / org / apache / cassandra / cli / Cli . g b / src / java / org / apache / cassandra / cli / Cli . g <nl> index e59c608 . . a9229ee 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / Cli . g <nl> + + + b / src / java / org / apache / cassandra / cli / Cli . g <nl> @ @ - 55 , 6 + 55 , 7 @ @ tokens { <nl> NODE _ UPDATE _ KEYSPACE ; <nl> NODE _ UPDATE _ COLUMN _ FAMILY ; <nl> NODE _ LIST ; <nl> + NODE _ TRUNCATE ; <nl> <nl> / / Internal Nodes . <nl> NODE _ COLUMN _ ACCESS ; <nl> @ @ - 123 , 6 + 124 , 7 @ @ statement <nl> | setStatement <nl> | showStatement <nl> | listStatement <nl> + | truncateStatement <nl> | - > ^ ( NODE _ NO _ OP ) <nl> ; <nl> <nl> @ @ - 174 , 6 + 176 , 8 @ @ helpStatement <nl> - > ^ ( NODE _ HELP NODE _ THRIFT _ COUNT ) <nl> | K _ HELP K _ LIST <nl> - > ^ ( NODE _ HELP NODE _ LIST ) <nl> + | K _ HELP K _ TRUNCATE <nl> + - > ^ ( NODE _ HELP NODE _ TRUNCATE ) <nl> | K _ HELP <nl> - > ^ ( NODE _ HELP ) <nl> | ' ? ' <nl> @ @ - 231 , 6 + 235 , 11 @ @ listStatement <nl> - > ^ ( NODE _ LIST columnFamily keyRangeExpr ? ^ ( NODE _ LIMIT $ limit ) ? ) <nl> ; <nl> <nl> + truncateStatement <nl> + : K _ TRUNCATE columnFamily <nl> + - > ^ ( NODE _ TRUNCATE columnFamily ) <nl> + ; <nl> + <nl> showClusterName <nl> : K _ SHOW K _ CLUSTER K _ NAME <nl> - > ^ ( NODE _ SHOW _ CLUSTER _ NAME ) <nl> @ @ - 430 , 6 + 439 , 7 @ @ K _ AND : ' AND ' ; <nl> K _ UPDATE : ' UPDATE ' ; <nl> K _ LIST : ' LIST ' ; <nl> K _ LIMIT : ' LIMIT ' ; <nl> + K _ TRUNCATE : ' TRUNCATE ' ; <nl> <nl> / / private syntactic rules <nl> fragment <nl> diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java <nl> index b6ace98 . . b63105a 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / CliClient . java <nl> + + + b / src / java / org / apache / cassandra / cli / CliClient . java <nl> @ @ - 171 , 6 + 171 , 9 @ @ public class CliClient extends CliUserHelp <nl> case CliParser . NODE _ LIST : <nl> executeList ( tree ) ; <nl> break ; <nl> + case CliParser . NODE _ TRUNCATE : <nl> + executeTruncate ( tree . getChild ( 0 ) . getText ( ) ) ; <nl> + break ; <nl> case CliParser . NODE _ NO _ OP : <nl> / / comment lines come here ; they are treated as no ops . <nl> break ; <nl> @ @ - 943 , 6 + 946 , 30 @ @ public class CliClient extends CliUserHelp <nl> printSliceList ( columnFamilyDef , keySlices ) ; <nl> } <nl> <nl> + / / TRUNCATE < columnFamily > <nl> + private void executeTruncate ( String columnFamily ) <nl> + { <nl> + if ( ! CliMain . isConnected ( ) | | ! hasKeySpace ( ) ) <nl> + return ; <nl> + <nl> + / / getting CfDef , it will fail if there is no such column family in current keySpace . <nl> + CfDef cfDef = getCfDef ( columnFamily ) ; <nl> + <nl> + try <nl> + { <nl> + thriftClient . truncate ( cfDef . getName ( ) ) ; <nl> + sessionState . out . println ( columnFamily + " truncated . " ) ; <nl> + } <nl> + catch ( InvalidRequestException e ) <nl> + { <nl> + throw new RuntimeException ( e . getWhy ( ) ) ; <nl> + } <nl> + catch ( Exception e ) <nl> + { <nl> + throw new RuntimeException ( e . getMessage ( ) ) ; <nl> + } <nl> + } <nl> + <nl> / / SHOW API VERSION <nl> private void executeShowVersion ( ) throws TException <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / cli / CliCompleter . java b / src / java / org / apache / cassandra / cli / CliCompleter . java <nl> index f541fe5 . . b033d8f 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / CliCompleter . java <nl> + + + b / src / java / org / apache / cassandra / cli / CliCompleter . java <nl> @ @ - 55 , 12 + 55 , 16 @ @ public class CliCompleter extends SimpleCompletor <nl> " help set " , <nl> " help del " , <nl> " help count " , <nl> + " help list " , <nl> + " help truncate " <nl> } ; <nl> private static String [ ] keyspaceCommands = { <nl> " get " , <nl> " set " , <nl> " count " , <nl> - " del " <nl> + " del " , <nl> + " list " , <nl> + " truncate " <nl> } ; <nl> <nl> public CliCompleter ( ) <nl> diff - - git a / src / java / org / apache / cassandra / cli / CliUserHelp . java b / src / java / org / apache / cassandra / cli / CliUserHelp . java <nl> index 7c512e2 . . db6a779 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / CliUserHelp . java <nl> + + + b / src / java / org / apache / cassandra / cli / CliUserHelp . java <nl> @ @ - 281 , 6 + 281 , 13 @ @ public class CliUserHelp { <nl> state . out . println ( " list Users [ j : ] limit 40 " ) ; <nl> break ; <nl> <nl> + case CliParser . NODE _ TRUNCATE : <nl> + state . out . println ( " truncate < column _ family > " ) ; <nl> + state . out . println ( " Truncate specified column family . \ n " ) ; <nl> + state . out . println ( " example : " ) ; <nl> + state . out . println ( " truncate Category " ) ; <nl> + break ; <nl> + <nl> default : <nl> state . out . println ( " ? " ) ; <nl> break ; <nl> @ @ - 324 , 7 + 331 , 8 @ @ public class CliUserHelp { <nl> state . out . println ( " del < cf > [ ' < key > ' ] [ ' < super > ' ] [ ' < col > ' ] Delete sub column . " ) ; <nl> state . out . println ( " count < cf > [ ' < key > ' ] Count columns in record . " ) ; <nl> state . out . println ( " count < cf > [ ' < key > ' ] [ ' < super > ' ] Count columns in a super column . " ) ; <nl> - state . out . println ( " list < cf > List all rows in the column family . " ) ; <nl> + state . out . println ( " truncate < column _ family > Truncate specified column family . " ) ; <nl> + state . out . println ( " list < cf > List all rows in the column family . " ) ; <nl> state . out . println ( " list < cf > [ < startKey > : ] " ) ; <nl> state . out . println ( " List rows in the column family beginning with < startKey > . " ) ; <nl> state . out . println ( " list < cf > [ < startKey > : < endKey > ] " ) ; <nl> diff - - git a / test / unit / org / apache / cassandra / cli / CliTest . java b / test / unit / org / apache / cassandra / cli / CliTest . java <nl> index 24a3de0 . . eddcafd 100644 <nl> - - - a / test / unit / org / apache / cassandra / cli / CliTest . java <nl> + + + b / test / unit / org / apache / cassandra / cli / CliTest . java <nl> @ @ - 52 , 6 + 52 , 7 @ @ public class CliTest extends TestCase <nl> " list CF3 [ h : ] " , <nl> " list CF3 limit 10 " , <nl> " list CF3 [ h : g ] limit 10 " , <nl> + " truncate CF1 " , <nl> " update keyspace TestKeySpace with placement _ strategy = ' org . apache . cassandra . locator . LocalStrategy ' " , <nl> " update keyspace TestKeySpace with replication _ factor = 1 and strategy _ options = [ { DC1 : 3 , DC2 : 4 , DC5 : 1 } ] " <nl> } ; <nl> @ @ - 101 , 6 + 102 , 10 @ @ public class CliTest extends TestCase <nl> assertTrue ( result . startsWith ( " = > ( column = " ) ) ; <nl> } <nl> } <nl> + else if ( statement . startsWith ( " truncate " ) ) <nl> + { <nl> + assertTrue ( result . contains ( " truncated . " ) ) ; <nl> + } <nl> <nl> outStream . reset ( ) ; / / reset stream so we have only output from next statement all the time <nl> errStream . reset ( ) ; / / no errors to the end user .

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index bdfec11 . . f0c116f 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 6 
 + * Allow per - dc enabling of hints ( CASSANDRA - 6157 ) 
 * Add compatibility for Hadoop 0 . 2 . x ( CASSANDRA - 5201 ) 
 * Fix EstimatedHistogram races ( CASSANDRA - 6682 ) 
 * Failure detector correctly converts initial value to nanos ( CASSANDRA - 6658 ) 
 @ @ - 27 , 6 + 28 , 7 @ @ Merged from 1 . 2 : 
 * Fix SecondaryIndexManager # deleteFromIndexes ( ) ( CASSANDRA - 6711 ) 
 * Fix snapshot repair not snapshotting coordinator itself ( CASSANDRA - 6713 ) 
 
 + 
 2 . 0 . 5 
 * Reduce garbage generated by bloom filter lookups ( CASSANDRA - 6609 ) 
 * Add ks . cf names to tombstone logging ( CASSANDRA - 6597 ) 
 diff - - git a / build . xml b / build . xml 
 index fb774f6 . . 77b2639 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 381 , 6 + 381 , 7 @ @ 
 < dependency groupId = " edu . stanford . ppl " artifactId = " snaptree " version = " 0 . 1 " / > 
 < dependency groupId = " org . mindrot " artifactId = " jbcrypt " version = " 0 . 3m " / > 
 < dependency groupId = " io . netty " artifactId = " netty " version = " 3 . 6 . 6 . Final " / > 
 + < dependency groupId = " net . sf . supercsv " artifactId = " super - csv " version = " 2 . 1 . 0 " / > 
 < / dependencyManagement > 
 < developer id = " alakshman " name = " Avinash Lakshman " / > 
 < developer id = " antelder " name = " Anthony Elder " / > 
 @ @ - 461 , 6 + 462 , 7 @ @ 
 < dependency groupId = " com . yammer . metrics " artifactId = " metrics - core " / > 
 < dependency groupId = " com . addthis . metrics " artifactId = " reporter - config " / > 
 < dependency groupId = " com . thinkaurelius . thrift " artifactId = " thrift - server " version = " 0 . 3 . 3 " / > 
 + < dependency groupId = " net . sf . supercsv " artifactId = " super - csv " version = " 2 . 1 . 0 " / > 
 
 < dependency groupId = " log4j " artifactId = " log4j " / > 
 < ! - - cassandra has a hard dependency on log4j , so force slf4j ' s log4j provider at runtime - - > 
 diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml 
 index bfe60c4 . . 4c9ad67 100644 
 - - - a / conf / cassandra . yaml 
 + + + b / conf / cassandra . yaml 
 @ @ - 29 , 6 + 29 , 9 @ @ num _ tokens : 256 
 # that do not have vnodes enabled . 
 # initial _ token : 
 
 + # May either be " true " or " false " to enable globally , or contain a list 
 + # of data centers to enable per - datacenter . 
 + # hinted _ handoff _ enabled : DC1 , DC2 
 # See http : / / wiki . apache . org / cassandra / HintedHandoff 
 hinted _ handoff _ enabled : true 
 # this defines the maximum amount of time a dead host will have hints 
 diff - - git a / lib / licenses / super - csv - 2 . 1 . 0 . txt b / lib / licenses / super - csv - 2 . 1 . 0 . txt 
 new file mode 100644 
 index 0000000 . . d645695 
 - - - / dev / null 
 + + + b / lib / licenses / super - csv - 2 . 1 . 0 . txt 
 @ @ - 0 , 0 + 1 , 202 @ @ 
 + 
 + Apache License 
 + Version 2 . 0 , January 2004 
 + http : / / www . apache . org / licenses / 
 + 
 + TERMS AND CONDITIONS FOR USE , REPRODUCTION , AND DISTRIBUTION 
 + 
 + 1 . Definitions . 
 + 
 + " License " shall mean the terms and conditions for use , reproduction , 
 + and distribution as defined by Sections 1 through 9 of this document . 
 + 
 + " Licensor " shall mean the copyright owner or entity authorized by 
 + the copyright owner that is granting the License . 
 + 
 + " Legal Entity " shall mean the union of the acting entity and all 
 + other entities that control , are controlled by , or are under common 
 + control with that entity . For the purposes of this definition , 
 + " control " means ( i ) the power , direct or indirect , to cause the 
 + direction or management of such entity , whether by contract or 
 + otherwise , or ( ii ) ownership of fifty percent ( 50 % ) or more of the 
 + outstanding shares , or ( iii ) beneficial ownership of such entity . 
 + 
 + " You " ( or " Your " ) shall mean an individual or Legal Entity 
 + exercising permissions granted by this License . 
 + 
 + " Source " form shall mean the preferred form for making modifications , 
 + including but not limited to software source code , documentation 
 + source , and configuration files . 
 + 
 + " Object " form shall mean any form resulting from mechanical 
 + transformation or translation of a Source form , including but 
 + not limited to compiled object code , generated documentation , 
 + and conversions to other media types . 
 + 
 + " Work " shall mean the work of authorship , whether in Source or 
 + Object form , made available under the License , as indicated by a 
 + copyright notice that is included in or attached to the work 
 + ( an example is provided in the Appendix below ) . 
 + 
 + " Derivative Works " shall mean any work , whether in Source or Object 
 + form , that is based on ( or derived from ) the Work and for which the 
 + editorial revisions , annotations , elaborations , or other modifications 
 + represent , as a whole , an original work of authorship . For the purposes 
 + of this License , Derivative Works shall not include works that remain 
 + separable from , or merely link ( or bind by name ) to the interfaces of , 
 + the Work and Derivative Works thereof . 
 + 
 + " Contribution " shall mean any work of authorship , including 
 + the original version of the Work and any modifications or additions 
 + to that Work or Derivative Works thereof , that is intentionally 
 + submitted to Licensor for inclusion in the Work by the copyright owner 
 + or by an individual or Legal Entity authorized to submit on behalf of 
 + the copyright owner . For the purposes of this definition , " submitted " 
 + means any form of electronic , verbal , or written communication sent 
 + to the Licensor or its representatives , including but not limited to 
 + communication on electronic mailing lists , source code control systems , 
 + and issue tracking systems that are managed by , or on behalf of , the 
 + Licensor for the purpose of discussing and improving the Work , but 
 + excluding communication that is conspicuously marked or otherwise 
 + designated in writing by the copyright owner as " Not a Contribution . " 
 + 
 + " Contributor " shall mean Licensor and any individual or Legal Entity 
 + on behalf of whom a Contribution has been received by Licensor and 
 + subsequently incorporated within the Work . 
 + 
 + 2 . Grant of Copyright License . Subject to the terms and conditions of 
 + this License , each Contributor hereby grants to You a perpetual , 
 + worldwide , non - exclusive , no - charge , royalty - free , irrevocable 
 + copyright license to reproduce , prepare Derivative Works of , 
 + publicly display , publicly perform , sublicense , and distribute the 
 + Work and such Derivative Works in Source or Object form . 
 + 
 + 3 . Grant of Patent License . Subject to the terms and conditions of 
 + this License , each Contributor hereby grants to You a perpetual , 
 + worldwide , non - exclusive , no - charge , royalty - free , irrevocable 
 + ( except as stated in this section ) patent license to make , have made , 
 + use , offer to sell , sell , import , and otherwise transfer the Work , 
 + where such license applies only to those patent claims licensable 
 + by such Contributor that are necessarily infringed by their 
 + Contribution ( s ) alone or by combination of their Contribution ( s ) 
 + with the Work to which such Contribution ( s ) was submitted . If You 
 + institute patent litigation against any entity ( including a 
 + cross - claim or counterclaim in a lawsuit ) alleging that the Work 
 + or a Contribution incorporated within the Work constitutes direct 
 + or contributory patent infringement , then any patent licenses 
 + granted to You under this License for that Work shall terminate 
 + as of the date such litigation is filed . 
 + 
 + 4 . Redistribution . You may reproduce and distribute copies of the 
 + Work or Derivative Works thereof in any medium , with or without 
 + modifications , and in Source or Object form , provided that You 
 + meet the following conditions : 
 + 
 + ( a ) You must give any other recipients of the Work or 
 + Derivative Works a copy of this License ; and 
 + 
 + ( b ) You must cause any modified files to carry prominent notices 
 + stating that You changed the files ; and 
 + 
 + ( c ) You must retain , in the Source form of any Derivative Works 
 + that You distribute , all copyright , patent , trademark , and 
 + attribution notices from the Source form of the Work , 
 + excluding those notices that do not pertain to any part of 
 + the Derivative Works ; and 
 + 
 + ( d ) If the Work includes a " NOTICE " text file as part of its 
 + distribution , then any Derivative Works that You distribute must 
 + include a readable copy of the attribution notices contained 
 + within such NOTICE file , excluding those notices that do not 
 + pertain to any part of the Derivative Works , in at least one 
 + of the following places : within a NOTICE text file distributed 
 + as part of the Derivative Works ; within the Source form or 
 + documentation , if provided along with the Derivative Works ; or , 
 + within a display generated by the Derivative Works , if and 
 + wherever such third - party notices normally appear . The contents 
 + of the NOTICE file are for informational purposes only and 
 + do not modify the License . You may add Your own attribution 
 + notices within Derivative Works that You distribute , alongside 
 + or as an addendum to the NOTICE text from the Work , provided 
 + that such additional attribution notices cannot be construed 
 + as modifying the License . 
 + 
 + You may add Your own copyright statement to Your modifications and 
 + may provide additional or different license terms and conditions 
 + for use , reproduction , or distribution of Your modifications , or 
 + for any such Derivative Works as a whole , provided Your use , 
 + reproduction , and distribution of the Work otherwise complies with 
 + the conditions stated in this License . 
 + 
 + 5 . Submission of Contributions . Unless You explicitly state otherwise , 
 + any Contribution intentionally submitted for inclusion in the Work 
 + by You to the Licensor shall be under the terms and conditions of 
 + this License , without any additional terms or conditions . 
 + Notwithstanding the above , nothing herein shall supersede or modify 
 + the terms of any separate license agreement you may have executed 
 + with Licensor regarding such Contributions . 
 + 
 + 6 . Trademarks . This License does not grant permission to use the trade 
 + names , trademarks , service marks , or product names of the Licensor , 
 + except as required for reasonable and customary use in describing the 
 + origin of the Work and reproducing the content of the NOTICE file . 
 + 
 + 7 . Disclaimer of Warranty . Unless required by applicable law or 
 + agreed to in writing , Licensor provides the Work ( and each 
 + Contributor provides its Contributions ) on an " AS IS " BASIS , 
 + WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or 
 + implied , including , without limitation , any warranties or conditions 
 + of TITLE , NON - INFRINGEMENT , MERCHANTABILITY , or FITNESS FOR A 
 + PARTICULAR PURPOSE . You are solely responsible for determining the 
 + appropriateness of using or redistributing the Work and assume any 
 + risks associated with Your exercise of permissions under this License . 
 + 
 + 8 . Limitation of Liability . In no event and under no legal theory , 
 + whether in tort ( including negligence ) , contract , or otherwise , 
 + unless required by applicable law ( such as deliberate and grossly 
 + negligent acts ) or agreed to in writing , shall any Contributor be 
 + liable to You for damages , including any direct , indirect , special , 
 + incidental , or consequential damages of any character arising as a 
 + result of this License or out of the use or inability to use the 
 + Work ( including but not limited to damages for loss of goodwill , 
 + work stoppage , computer failure or malfunction , or any and all 
 + other commercial damages or losses ) , even if such Contributor 
 + has been advised of the possibility of such damages . 
 + 
 + 9 . Accepting Warranty or Additional Liability . While redistributing 
 + the Work or Derivative Works thereof , You may choose to offer , 
 + and charge a fee for , acceptance of support , warranty , indemnity , 
 + or other liability obligations and / or rights consistent with this 
 + License . However , in accepting such obligations , You may act only 
 + on Your own behalf and on Your sole responsibility , not on behalf 
 + of any other Contributor , and only if You agree to indemnify , 
 + defend , and hold each Contributor harmless for any liability 
 + incurred by , or claims asserted against , such Contributor by reason 
 + of your accepting any such warranty or additional liability . 
 + 
 + END OF TERMS AND CONDITIONS 
 + 
 + APPENDIX : How to apply the Apache License to your work . 
 + 
 + To apply the Apache License to your work , attach the following 
 + boilerplate notice , with the fields enclosed by brackets " [ ] " 
 + replaced with your own identifying information . ( Don ' t include 
 + the brackets ! ) The text should be enclosed in the appropriate 
 + comment syntax for the file format . We also recommend that a 
 + file or class name and description of purpose be included on the 
 + same " printed page " as the copyright notice for easier 
 + identification within third - party archives . 
 + 
 + Copyright [ yyyy ] [ name of copyright owner ] 
 + 
 + Licensed under the Apache License , Version 2 . 0 ( the " License " ) ; 
 + you may not use this file except in compliance with the License . 
 + You may obtain a copy of the License at 
 + 
 + http : / / www . apache . org / licenses / LICENSE - 2 . 0 
 + 
 + Unless required by applicable law or agreed to in writing , software 
 + distributed under the License is distributed on an " AS IS " BASIS , 
 + WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . 
 + See the License for the specific language governing permissions and 
 + limitations under the License . 
 diff - - git a / lib / super - csv - 2 . 1 . 0 . jar b / lib / super - csv - 2 . 1 . 0 . jar 
 new file mode 100644 
 index 0000000 . . 6a85716 
 Binary files / dev / null and b / lib / super - csv - 2 . 1 . 0 . jar differ 
 diff - - git a / src / java / org / apache / cassandra / config / Config . java b / src / java / org / apache / cassandra / config / Config . java 
 index 2fa49f3 . . ceb8df0 100644 
 - - - a / src / java / org / apache / cassandra / config / Config . java 
 + + + b / src / java / org / apache / cassandra / config / Config . java 
 @ @ - 17 , 8 + 17 , 18 @ @ 
 * / 
 package org . apache . cassandra . config ; 
 
 + import java . io . IOException ; 
 + import java . io . StringReader ; 
 + import java . util . List ; 
 + import java . util . Set ; 
 + 
 + import com . google . common . collect . Sets ; 
 + import org . supercsv . io . CsvListReader ; 
 + import org . supercsv . prefs . CsvPreference ; 
 + 
 import org . apache . cassandra . config . EncryptionOptions . ClientEncryptionOptions ; 
 import org . apache . cassandra . config . EncryptionOptions . ServerEncryptionOptions ; 
 + import org . apache . cassandra . exceptions . ConfigurationException ; 
 import org . apache . cassandra . io . util . NativeAllocator ; 
 import org . apache . cassandra . utils . FBUtilities ; 
 
 @ @ - 38 , 7 + 48 , 9 @ @ public class Config 
 public String partitioner ; 
 
 public Boolean auto _ bootstrap = true ; 
 - public volatile Boolean hinted _ handoff _ enabled = true ; 
 + public volatile boolean hinted _ handoff _ enabled _ global = true ; 
 + public String hinted _ handoff _ enabled ; 
 + public Set < String > hinted _ handoff _ enabled _ by _ dc = Sets . newConcurrentHashSet ( ) ; 
 public volatile Integer max _ hint _ window _ in _ ms = 3600 * 1000 ; / / one hour 
 
 public SeedProviderDef seed _ provider ; 
 @ @ - 185 , 6 + 197 , 9 @ @ public class Config 
 public volatile int tombstone _ warn _ threshold = 1000 ; 
 public volatile int tombstone _ failure _ threshold = 100000 ; 
 
 + private static final CsvPreference STANDARD _ SURROUNDING _ SPACES _ NEED _ QUOTES = new CsvPreference . Builder ( CsvPreference . STANDARD _ PREFERENCE ) 
 + . surroundingSpacesNeedQuotes ( true ) . build ( ) ; 
 + 
 public static boolean getOutboundBindAny ( ) 
 { 
 return outboundBindAny ; 
 @ @ - 205 , 6 + 220 , 38 @ @ public class Config 
 isClientMode = clientMode ; 
 } 
 
 + public void configHintedHandoff ( ) throws ConfigurationException 
 + { 
 + if ( hinted _ handoff _ enabled ! = null & & ! hinted _ handoff _ enabled . isEmpty ( ) ) 
 + { 
 + if ( hinted _ handoff _ enabled . toLowerCase ( ) . equalsIgnoreCase ( " true " ) ) 
 + { 
 + hinted _ handoff _ enabled _ global = true ; 
 + } 
 + else if ( hinted _ handoff _ enabled . toLowerCase ( ) . equalsIgnoreCase ( " false " ) ) 
 + { 
 + hinted _ handoff _ enabled _ global = false ; 
 + } 
 + else 
 + { 
 + try 
 + { 
 + hinted _ handoff _ enabled _ by _ dc . addAll ( parseHintedHandoffEnabledDCs ( hinted _ handoff _ enabled ) ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + throw new ConfigurationException ( " Invalid hinted _ handoff _ enabled parameter " + hinted _ handoff _ enabled , e ) ; 
 + } 
 + } 
 + } 
 + } 
 + 
 + public static List < String > parseHintedHandoffEnabledDCs ( final String dcNames ) throws IOException 
 + { 
 + final CsvListReader csvListReader = new CsvListReader ( new StringReader ( dcNames ) , STANDARD _ SURROUNDING _ SPACES _ NEED _ QUOTES ) ; 
 + return csvListReader . read ( ) ; 
 + } 
 + 
 public static enum CommitLogSync 
 { 
 periodic , 
 diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index e1a95ab . . 9e06601 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 19 , 6 + 19 , 7 @ @ package org . apache . cassandra . config ; 
 
 import java . io . File ; 
 import java . io . FileFilter ; 
 + import java . io . IOException ; 
 import java . net . InetAddress ; 
 import java . net . UnknownHostException ; 
 import java . util . * ; 
 @ @ - 1109 , 12 + 1110 , 47 @ @ public class DatabaseDescriptor 
 
 public static void setHintedHandoffEnabled ( boolean hintedHandoffEnabled ) 
 { 
 - conf . hinted _ handoff _ enabled = hintedHandoffEnabled ; 
 + conf . hinted _ handoff _ enabled _ global = hintedHandoffEnabled ; 
 + conf . hinted _ handoff _ enabled _ by _ dc . clear ( ) ; 
 + } 
 + 
 + public static void setHintedHandoffEnabled ( final String dcNames ) 
 + { 
 + List < String > dcNameList ; 
 + try 
 + { 
 + dcNameList = Config . parseHintedHandoffEnabledDCs ( dcNames ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + throw new IllegalArgumentException ( " Could not read csv of dcs for hinted handoff enable . " + dcNames , e ) ; 
 + } 
 + 
 + if ( dcNameList . isEmpty ( ) ) 
 + throw new IllegalArgumentException ( " Empty list of Dcs for hinted handoff enable " ) ; 
 + 
 + conf . hinted _ handoff _ enabled _ by _ dc . clear ( ) ; 
 + conf . hinted _ handoff _ enabled _ by _ dc . addAll ( dcNameList ) ; 
 } 
 
 public static boolean hintedHandoffEnabled ( ) 
 { 
 - return conf . hinted _ handoff _ enabled ; 
 + return conf . hinted _ handoff _ enabled _ global ; 
 + } 
 + 
 + public static Set < String > hintedHandoffEnabledByDC ( ) 
 + { 
 + return Collections . unmodifiableSet ( conf . hinted _ handoff _ enabled _ by _ dc ) ; 
 + } 
 + 
 + public static boolean shouldHintByDC ( ) 
 + { 
 + return ! conf . hinted _ handoff _ enabled _ by _ dc . isEmpty ( ) ; 
 + } 
 + 
 + public static boolean hintedHandoffEnabled ( final String dcName ) 
 + { 
 + return conf . hinted _ handoff _ enabled _ by _ dc . contains ( dcName ) ; 
 } 
 
 public static void setMaxHintWindow ( int ms ) 
 diff - - git a / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java b / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java 
 index d8a138c . . 6b5a152 100644 
 - - - a / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java 
 + + + b / src / java / org / apache / cassandra / config / YamlConfigurationLoader . java 
 @ @ - 91 , 6 + 91 , 7 @ @ public class YamlConfigurationLoader implements ConfigurationLoader 
 constructor . setPropertyUtils ( propertiesChecker ) ; 
 Yaml yaml = new Yaml ( constructor ) ; 
 Config result = yaml . loadAs ( input , Config . class ) ; 
 + result . configHintedHandoff ( ) ; 
 propertiesChecker . check ( ) ; 
 return result ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java 
 index 8d1f913 . . 14c1ce3 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageProxy . java 
 + + + b / src / java / org / apache / cassandra / service / StorageProxy . java 
 @ @ - 1758 , 11 + 1758 , 21 @ @ public class StorageProxy implements StorageProxyMBean 
 return DatabaseDescriptor . hintedHandoffEnabled ( ) ; 
 } 
 
 + public Set < String > getHintedHandoffEnabledByDC ( ) 
 + { 
 + return DatabaseDescriptor . hintedHandoffEnabledByDC ( ) ; 
 + } 
 + 
 public void setHintedHandoffEnabled ( boolean b ) 
 { 
 DatabaseDescriptor . setHintedHandoffEnabled ( b ) ; 
 } 
 
 + public void setHintedHandoffEnabledByDCList ( String dcNames ) 
 + { 
 + DatabaseDescriptor . setHintedHandoffEnabled ( dcNames ) ; 
 + } 
 + 
 public int getMaxHintWindow ( ) 
 { 
 return DatabaseDescriptor . getMaxHintWindow ( ) ; 
 @ @ - 1775 , 7 + 1785 , 17 @ @ public class StorageProxy implements StorageProxyMBean 
 
 public static boolean shouldHint ( InetAddress ep ) 
 { 
 - if ( ! DatabaseDescriptor . hintedHandoffEnabled ( ) ) 
 + if ( DatabaseDescriptor . shouldHintByDC ( ) ) 
 + { 
 + final String dc = DatabaseDescriptor . getEndpointSnitch ( ) . getDatacenter ( ep ) ; 
 + / / Disable DC specific hints 
 + if ( ! DatabaseDescriptor . hintedHandoffEnabled ( dc ) ) 
 + { 
 + HintedHandOffManager . instance . metrics . incrPastWindow ( ep ) ; 
 + return false ; 
 + } 
 + } 
 + else if ( ! DatabaseDescriptor . hintedHandoffEnabled ( ) ) 
 { 
 HintedHandOffManager . instance . metrics . incrPastWindow ( ep ) ; 
 return false ; 
 diff - - git a / src / java / org / apache / cassandra / service / StorageProxyMBean . java b / src / java / org / apache / cassandra / service / StorageProxyMBean . java 
 index ad7d4c7 . . 203cabe 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageProxyMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageProxyMBean . java 
 @ @ - 19 , 6 + 19 , 7 @ @ package org . apache . cassandra . service ; 
 
 import java . util . List ; 
 import java . util . Map ; 
 + import java . util . Set ; 
 
 public interface StorageProxyMBean 
 { 
 @ @ - 72 , 7 + 73 , 9 @ @ public interface StorageProxyMBean 
 
 public long getTotalHints ( ) ; 
 public boolean getHintedHandoffEnabled ( ) ; 
 + public Set < String > getHintedHandoffEnabledByDC ( ) ; 
 public void setHintedHandoffEnabled ( boolean b ) ; 
 + public void setHintedHandoffEnabledByDCList ( String dcs ) ; 
 public int getMaxHintWindow ( ) ; 
 public void setMaxHintWindow ( int ms ) ; 
 public int getMaxHintsInProgress ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 index f3cd563 . . fb29342 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 @ @ - 1229 , 7 + 1229 , 10 @ @ public class NodeCmd 
 case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; 
 case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; 
 case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; 
 - case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; 
 + case ENABLEHANDOFF : 
 + if ( arguments . length > 0 ) { probe . enableHintedHandoff ( arguments [ 0 ] ) ; } 
 + else { probe . enableHintedHandoff ( ) ; } 
 + break ; 
 case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; 
 case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; 
 case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index ffd6203 . . 28cafb7 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 721 , 6 + 721 , 11 @ @ public class NodeProbe 
 spProxy . setHintedHandoffEnabled ( true ) ; 
 } 
 
 + public void enableHintedHandoff ( String dcNames ) 
 + { 
 + spProxy . setHintedHandoffEnabledByDCList ( dcNames ) ; 
 + } 
 + 
 public void pauseHintsDelivery ( ) 
 { 
 hhProxy . pauseHintsDelivery ( true ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index eec904a . . 982454c 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 59 , 6 + 59 , 8 @ @ 
 the old ones ( CASSANDRA - 1644 ) 
 * upgrade to Thrift 0 . 5 ( CASSANDRA - 1367 ) 
 * renamed CL . DCQUORUM to LOCAL _ QUORUM and DCQUORUMSYNC to EACH _ QUORUM 
 + * cli truncate support ( CASSANDRA - 1653 ) 
 + * update GC settings in cassandra . bat ( CASSANDRA - 1636 ) 
 
 
 0 . 7 - beta2 
 diff - - git a / src / java / org / apache / cassandra / cli / Cli . g b / src / java / org / apache / cassandra / cli / Cli . g 
 index e59c608 . . a9229ee 100644 
 - - - a / src / java / org / apache / cassandra / cli / Cli . g 
 + + + b / src / java / org / apache / cassandra / cli / Cli . g 
 @ @ - 55 , 6 + 55 , 7 @ @ tokens { 
 NODE _ UPDATE _ KEYSPACE ; 
 NODE _ UPDATE _ COLUMN _ FAMILY ; 
 NODE _ LIST ; 
 + NODE _ TRUNCATE ; 
 
 / / Internal Nodes . 
 NODE _ COLUMN _ ACCESS ; 
 @ @ - 123 , 6 + 124 , 7 @ @ statement 
 | setStatement 
 | showStatement 
 | listStatement 
 + | truncateStatement 
 | - > ^ ( NODE _ NO _ OP ) 
 ; 
 
 @ @ - 174 , 6 + 176 , 8 @ @ helpStatement 
 - > ^ ( NODE _ HELP NODE _ THRIFT _ COUNT ) 
 | K _ HELP K _ LIST 
 - > ^ ( NODE _ HELP NODE _ LIST ) 
 + | K _ HELP K _ TRUNCATE 
 + - > ^ ( NODE _ HELP NODE _ TRUNCATE ) 
 | K _ HELP 
 - > ^ ( NODE _ HELP ) 
 | ' ? ' 
 @ @ - 231 , 6 + 235 , 11 @ @ listStatement 
 - > ^ ( NODE _ LIST columnFamily keyRangeExpr ? ^ ( NODE _ LIMIT $ limit ) ? ) 
 ; 
 
 + truncateStatement 
 + : K _ TRUNCATE columnFamily 
 + - > ^ ( NODE _ TRUNCATE columnFamily ) 
 + ; 
 + 
 showClusterName 
 : K _ SHOW K _ CLUSTER K _ NAME 
 - > ^ ( NODE _ SHOW _ CLUSTER _ NAME ) 
 @ @ - 430 , 6 + 439 , 7 @ @ K _ AND : ' AND ' ; 
 K _ UPDATE : ' UPDATE ' ; 
 K _ LIST : ' LIST ' ; 
 K _ LIMIT : ' LIMIT ' ; 
 + K _ TRUNCATE : ' TRUNCATE ' ; 
 
 / / private syntactic rules 
 fragment 
 diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java 
 index b6ace98 . . b63105a 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliClient . java 
 + + + b / src / java / org / apache / cassandra / cli / CliClient . java 
 @ @ - 171 , 6 + 171 , 9 @ @ public class CliClient extends CliUserHelp 
 case CliParser . NODE _ LIST : 
 executeList ( tree ) ; 
 break ; 
 + case CliParser . NODE _ TRUNCATE : 
 + executeTruncate ( tree . getChild ( 0 ) . getText ( ) ) ; 
 + break ; 
 case CliParser . NODE _ NO _ OP : 
 / / comment lines come here ; they are treated as no ops . 
 break ; 
 @ @ - 943 , 6 + 946 , 30 @ @ public class CliClient extends CliUserHelp 
 printSliceList ( columnFamilyDef , keySlices ) ; 
 } 
 
 + / / TRUNCATE < columnFamily > 
 + private void executeTruncate ( String columnFamily ) 
 + { 
 + if ( ! CliMain . isConnected ( ) | | ! hasKeySpace ( ) ) 
 + return ; 
 + 
 + / / getting CfDef , it will fail if there is no such column family in current keySpace . 
 + CfDef cfDef = getCfDef ( columnFamily ) ; 
 + 
 + try 
 + { 
 + thriftClient . truncate ( cfDef . getName ( ) ) ; 
 + sessionState . out . println ( columnFamily + " truncated . " ) ; 
 + } 
 + catch ( InvalidRequestException e ) 
 + { 
 + throw new RuntimeException ( e . getWhy ( ) ) ; 
 + } 
 + catch ( Exception e ) 
 + { 
 + throw new RuntimeException ( e . getMessage ( ) ) ; 
 + } 
 + } 
 + 
 / / SHOW API VERSION 
 private void executeShowVersion ( ) throws TException 
 { 
 diff - - git a / src / java / org / apache / cassandra / cli / CliCompleter . java b / src / java / org / apache / cassandra / cli / CliCompleter . java 
 index f541fe5 . . b033d8f 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliCompleter . java 
 + + + b / src / java / org / apache / cassandra / cli / CliCompleter . java 
 @ @ - 55 , 12 + 55 , 16 @ @ public class CliCompleter extends SimpleCompletor 
 " help set " , 
 " help del " , 
 " help count " , 
 + " help list " , 
 + " help truncate " 
 } ; 
 private static String [ ] keyspaceCommands = { 
 " get " , 
 " set " , 
 " count " , 
 - " del " 
 + " del " , 
 + " list " , 
 + " truncate " 
 } ; 
 
 public CliCompleter ( ) 
 diff - - git a / src / java / org / apache / cassandra / cli / CliUserHelp . java b / src / java / org / apache / cassandra / cli / CliUserHelp . java 
 index 7c512e2 . . db6a779 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliUserHelp . java 
 + + + b / src / java / org / apache / cassandra / cli / CliUserHelp . java 
 @ @ - 281 , 6 + 281 , 13 @ @ public class CliUserHelp { 
 state . out . println ( " list Users [ j : ] limit 40 " ) ; 
 break ; 
 
 + case CliParser . NODE _ TRUNCATE : 
 + state . out . println ( " truncate < column _ family > " ) ; 
 + state . out . println ( " Truncate specified column family . \ n " ) ; 
 + state . out . println ( " example : " ) ; 
 + state . out . println ( " truncate Category " ) ; 
 + break ; 
 + 
 default : 
 state . out . println ( " ? " ) ; 
 break ; 
 @ @ - 324 , 7 + 331 , 8 @ @ public class CliUserHelp { 
 state . out . println ( " del < cf > [ ' < key > ' ] [ ' < super > ' ] [ ' < col > ' ] Delete sub column . " ) ; 
 state . out . println ( " count < cf > [ ' < key > ' ] Count columns in record . " ) ; 
 state . out . println ( " count < cf > [ ' < key > ' ] [ ' < super > ' ] Count columns in a super column . " ) ; 
 - state . out . println ( " list < cf > List all rows in the column family . " ) ; 
 + state . out . println ( " truncate < column _ family > Truncate specified column family . " ) ; 
 + state . out . println ( " list < cf > List all rows in the column family . " ) ; 
 state . out . println ( " list < cf > [ < startKey > : ] " ) ; 
 state . out . println ( " List rows in the column family beginning with < startKey > . " ) ; 
 state . out . println ( " list < cf > [ < startKey > : < endKey > ] " ) ; 
 diff - - git a / test / unit / org / apache / cassandra / cli / CliTest . java b / test / unit / org / apache / cassandra / cli / CliTest . java 
 index 24a3de0 . . eddcafd 100644 
 - - - a / test / unit / org / apache / cassandra / cli / CliTest . java 
 + + + b / test / unit / org / apache / cassandra / cli / CliTest . java 
 @ @ - 52 , 6 + 52 , 7 @ @ public class CliTest extends TestCase 
 " list CF3 [ h : ] " , 
 " list CF3 limit 10 " , 
 " list CF3 [ h : g ] limit 10 " , 
 + " truncate CF1 " , 
 " update keyspace TestKeySpace with placement _ strategy = ' org . apache . cassandra . locator . LocalStrategy ' " , 
 " update keyspace TestKeySpace with replication _ factor = 1 and strategy _ options = [ { DC1 : 3 , DC2 : 4 , DC5 : 1 } ] " 
 } ; 
 @ @ - 101 , 6 + 102 , 10 @ @ public class CliTest extends TestCase 
 assertTrue ( result . startsWith ( " = > ( column = " ) ) ; 
 } 
 } 
 + else if ( statement . startsWith ( " truncate " ) ) 
 + { 
 + assertTrue ( result . contains ( " truncated . " ) ) ; 
 + } 
 
 outStream . reset ( ) ; / / reset stream so we have only output from next statement all the time 
 errStream . reset ( ) ; / / no errors to the end user .
