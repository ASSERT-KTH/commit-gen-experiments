BLEU SCORE: 0.03283637368030199

TEST MSG: Docs : Clarify PartitionSize table metric documentation
GENERATED MSG: Fix CQL3 doc

TEST DIFF (one line): diff - - git a / doc / source / operating / metrics . rst b / doc / source / operating / metrics . rst <nl> index 4f61bf2 . . 40a1cff 100644 <nl> - - - a / doc / source / operating / metrics . rst <nl> + + + b / doc / source / operating / metrics . rst <nl> @ @ - 108 , 9 + 108 , 9 @ @ PendingCompactions Gauge < Integer > Estimate of number of pen <nl> LiveSSTableCount Gauge < Integer > Number of SSTables on disk for this table . <nl> LiveDiskSpaceUsed Counter Disk space used by SSTables belonging to this table ( in bytes ) . <nl> TotalDiskSpaceUsed Counter Total disk space used by SSTables belonging to this table , including obsolete ones waiting to be GC ' d . <nl> - MinPartitionSize Gauge < Long > Size of the smallest compacted partition ( in bytes ) . <nl> - MaxPartitionSize Gauge < Long > Size of the largest compacted partition ( in bytes ) . <nl> - MeanPartitionSize Gauge < Long > Size of the average compacted partition ( in bytes ) . <nl> + MinPartitionSize Gauge < Long > Estimated minimum uncompressed partition size in bytes for any given SSTable in this table . Note that if there are multiple SSTables containing the same partition this metric does not sum those sizes , it just returns the minimum . For example if there are two SSTables containing only one ( identical ) partition with size 3 and 7 , this metric would show 3 instead of 10 . <nl> + MaxPartitionSize Gauge < Long > Estimated maximum uncompressed partition size in bytes for any given SSTable in this table . Note that if there are multiple SSTables containing the same partition this metric does not sum those sizes , it just returns the maximum . For example if there are two SSTables containing only one ( identical ) partition with size 3 and 7 , this metric would show 7 instead of 10 . <nl> + MeanPartitionSize Gauge < Long > Estimated weighted mean uncompressed partition size in bytes across all SSTables in this table . Each SSTable contributes an estimated mean size proportional to the estimated number of partitions in that SSTable . For example if there are two SSTables with mean size 2 and 300 , covering 200 partitions and 3 partitions respectively , this metric would return ( 2 * 200 + 300 * 3 ) / ( 200 + 3 ) = 6 . <nl> BloomFilterFalsePositives Gauge < Long > Number of false positives on table ' s bloom filter . <nl> BloomFilterFalseRatio Gauge < Double > False positive ratio of table ' s bloom filter . <nl> BloomFilterDiskSpaceUsed Gauge < Long > Disk space used by bloom filter ( in bytes ) .
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d4c6697 . . 2346993 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 . 1 <nl> + * nodetool methods to enable / disable hint storage / delivery ( CASSANDRA - 4750 ) <nl> * disallow bloom filter false positive chance of 0 ( CASSANDRA - 5013 ) <nl> * add threadpool size adjustment methods to JMXEnabledThreadPoolExecutor and <nl> CompactionManagerMBean ( CASSANDRA - 5044 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index 476af88 . . 8ca0281 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 87 , 12 + 87 , 15 @ @ import org . cliffc . high _ scale _ lib . NonBlockingHashSet ; <nl> <nl> public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> { <nl> + public static final String MBEAN _ NAME = " org . apache . cassandra . db : type = HintedHandoffManager " ; <nl> public static final HintedHandOffManager instance = new HintedHandOffManager ( ) ; <nl> <nl> private static final Logger logger = LoggerFactory . getLogger ( HintedHandOffManager . class ) ; <nl> private static final int PAGE _ SIZE = 128 ; <nl> private static final int LARGE _ NUMBER = 65536 ; / / 64k nodes ought to be enough for anybody . <nl> <nl> + private volatile boolean hintedHandOffPaused = false ; <nl> + <nl> static final CompositeType comparator = CompositeType . getInstance ( Arrays . < AbstractType < ? > > asList ( UUIDType . instance , Int32Type . instance ) ) ; <nl> <nl> private final NonBlockingHashSet < InetAddress > queuedDeliveries = new NonBlockingHashSet < InetAddress > ( ) ; <nl> @ @ - 108 , 7 + 111 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> MBeanServer mbs = ManagementFactory . getPlatformMBeanServer ( ) ; <nl> try <nl> { <nl> - mbs . registerMBean ( this , new ObjectName ( " org . apache . cassandra . db : type = HintedHandoffManager " ) ) ; <nl> + mbs . registerMBean ( this , new ObjectName ( MBEAN _ NAME ) ) ; <nl> } <nl> catch ( Exception e ) <nl> { <nl> @ @ - 256 , 6 + 259 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> if ( hintStore . isEmpty ( ) ) <nl> return ; / / nothing to do , don ' t confuse users by logging a no - op handoff <nl> <nl> + / / check if hints delivery has been paused <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + return ; <nl> + } <nl> + <nl> logger . debug ( " Checking remote ( { } ) schema before delivering hints " , endpoint ) ; <nl> try <nl> { <nl> @ @ - 303 , 6 + 313 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> <nl> while ( true ) <nl> { <nl> + / / check if hints delivery has been paused during the process <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + break ; <nl> + } <nl> + <nl> QueryFilter filter = QueryFilter . getSliceFilter ( epkey , new QueryPath ( SystemTable . HINTS _ CF ) , startColumn , ByteBufferUtil . EMPTY _ BYTE _ BUFFER , false , pageSize ) ; <nl> ColumnFamily hintsPage = ColumnFamilyStore . removeDeleted ( hintStore . getColumnFamily ( filter ) , ( int ) ( System . currentTimeMillis ( ) / 1000 ) ) ; <nl> if ( pagingFinished ( hintsPage , startColumn ) ) <nl> @ @ - 332 , 6 + 349 , 11 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> if ( ! hint . isLive ( ) ) <nl> continue ; <nl> <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . debug ( " Hints delivery process is paused , aborting " ) ; <nl> + break ; <nl> + } <nl> startColumn = hint . name ( ) ; <nl> <nl> ByteBuffer [ ] components = comparator . split ( hint . name ( ) ) ; <nl> @ @ - 384 , 6 + 406 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> } <nl> <nl> logger . info ( String . format ( " Finished hinted handoff of % s rows to endpoint % s " , rowsReplayed , endpoint ) ) ; <nl> + if ( hintedHandOffPaused ) <nl> + { <nl> + logger . info ( " Hints delivery process is paused , not delivering further hints " ) ; <nl> + } <nl> } <nl> <nl> / * * <nl> @ @ - 440 , 6 + 466 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> scheduleHintDelivery ( InetAddress . getByName ( to ) ) ; <nl> } <nl> <nl> + public void pauseHintsDelivery ( boolean b ) { <nl> + hintedHandOffPaused = b ; <nl> + } <nl> + <nl> public List < String > listEndpointsPendingHints ( ) <nl> { <nl> Token . TokenFactory tokenFactory = StorageService . getPartitioner ( ) . getTokenFactory ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> index 1ba70c4 . . 690a3eb 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java <nl> @ @ - 45 , 5 + 45 , 8 @ @ public interface HintedHandOffManagerMBean <nl> <nl> / * * force hint delivery to an endpoint * * / <nl> public void scheduleHintDelivery ( String host ) throws UnknownHostException ; <nl> + <nl> + / * * pause hints delivery process * * / <nl> + public void pauseHintsDelivery ( boolean b ) ; <nl> } <nl> <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> index d72f3d3 . . dddc98c 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java <nl> @ @ - 102 , 9 + 102 , 11 @ @ public class NodeCmd <nl> COMPACTIONSTATS , <nl> DECOMMISSION , <nl> DISABLEGOSSIP , <nl> + DISABLEHANDOFF , <nl> DISABLETHRIFT , <nl> DRAIN , <nl> ENABLEGOSSIP , <nl> + ENABLEHANDOFF , <nl> ENABLETHRIFT , <nl> FLUSH , <nl> GETCOMPACTIONTHRESHOLD , <nl> @ @ - 118 , 12 + 120 , 14 @ @ public class NodeCmd <nl> JOIN , <nl> MOVE , <nl> NETSTATS , <nl> + PAUSEHANDOFF , <nl> PROXYHISTOGRAMS , <nl> REBUILD , <nl> REFRESH , <nl> REMOVETOKEN , <nl> REMOVENODE , <nl> REPAIR , <nl> + RESUMEHANDOFF , <nl> RING , <nl> SCRUB , <nl> SETCACHECAPACITY , <nl> @ @ - 1006 , 6 + 1010 , 10 @ @ public class NodeCmd <nl> case COMPACTIONSTATS : nodeCmd . printCompactionStats ( System . out ) ; break ; <nl> case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; <nl> case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; <nl> + case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; <nl> + case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; <nl> + case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; <nl> + case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; <nl> case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; <nl> case ENABLETHRIFT : probe . startThriftServer ( ) ; break ; <nl> case STATUSTHRIFT : nodeCmd . printIsThriftServerRunning ( System . out ) ; break ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 021a40f . . 7a7c60c 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 40 , 6 + 40 , 8 @ @ import com . google . common . collect . Iterables ; <nl> <nl> import org . apache . cassandra . concurrent . JMXEnabledThreadPoolExecutorMBean ; <nl> import org . apache . cassandra . db . ColumnFamilyStoreMBean ; <nl> + import org . apache . cassandra . db . HintedHandOffManager ; <nl> + import org . apache . cassandra . db . HintedHandOffManagerMBean ; <nl> import org . apache . cassandra . db . compaction . CompactionManager ; <nl> import org . apache . cassandra . db . compaction . CompactionManagerMBean ; <nl> import org . apache . cassandra . gms . FailureDetector ; <nl> @ @ - 77 , 6 + 79 , 7 @ @ public class NodeProbe <nl> private CacheServiceMBean cacheService ; <nl> private PBSPredictorMBean PBSPredictorProxy ; <nl> private StorageProxyMBean spProxy ; <nl> + private HintedHandOffManagerMBean hhProxy ; <nl> <nl> / * * <nl> * Creates a NodeProbe using the specified JMX host , port , username , and password . <nl> @ @ - 159 , 6 + 162 , 8 @ @ public class NodeProbe <nl> cacheService = JMX . newMBeanProxy ( mbeanServerConn , name , CacheServiceMBean . class ) ; <nl> name = new ObjectName ( StorageProxy . MBEAN _ NAME ) ; <nl> spProxy = JMX . newMBeanProxy ( mbeanServerConn , name , StorageProxyMBean . class ) ; <nl> + name = new ObjectName ( HintedHandOffManager . MBEAN _ NAME ) ; <nl> + hhProxy = JMX . newMBeanProxy ( mbeanServerConn , name , HintedHandOffManagerMBean . class ) ; <nl> } catch ( MalformedObjectNameException e ) <nl> { <nl> throw new RuntimeException ( <nl> @ @ - 647 , 6 + 652 , 26 @ @ public class NodeProbe <nl> return ssProxy . getKeyspaces ( ) ; <nl> } <nl> <nl> + public void disableHintedHandoff ( ) <nl> + { <nl> + spProxy . setHintedHandoffEnabled ( false ) ; <nl> + } <nl> + <nl> + public void enableHintedHandoff ( ) <nl> + { <nl> + spProxy . setHintedHandoffEnabled ( true ) ; <nl> + } <nl> + <nl> + public void pauseHintsDelivery ( ) <nl> + { <nl> + hhProxy . pauseHintsDelivery ( true ) ; <nl> + } <nl> + <nl> + public void resumeHintsDelivery ( ) <nl> + { <nl> + hhProxy . pauseHintsDelivery ( false ) ; <nl> + } <nl> + <nl> public void stopGossiping ( ) <nl> { <nl> ssProxy . stopGossiping ( ) ; <nl> diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> index 677b689 . . 2398f01 100644 <nl> - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml <nl> @ @ - 1 , 4 + 1 , 3 @ @ <nl> - <nl> # Licensed to the Apache Software Foundation ( ASF ) under one <nl> # or more contributor license agreements . See the NOTICE file <nl> # distributed with this work for additional information <nl> @ @ - 50 , 6 + 49 , 18 @ @ commands : <nl> - name : compactionstats <nl> help : | <nl> Print statistics on compactions <nl> + - name : disablehandoff <nl> + help : | <nl> + Disable the future hints storing on the current node <nl> + - name : enablehandoff <nl> + help : | <nl> + Reenable the future hints storing on the current node <nl> + - name : resumehandoff <nl> + help : | <nl> + Resume hints delivery process <nl> + - name : pausehandoff <nl> + help : | <nl> + Pause hints delivery process <nl> - name : disablegossip <nl> help : | <nl> Disable gossip ( effectively marking the node dead )

TEST DIFF:
diff - - git a / doc / source / operating / metrics . rst b / doc / source / operating / metrics . rst 
 index 4f61bf2 . . 40a1cff 100644 
 - - - a / doc / source / operating / metrics . rst 
 + + + b / doc / source / operating / metrics . rst 
 @ @ - 108 , 9 + 108 , 9 @ @ PendingCompactions Gauge < Integer > Estimate of number of pen 
 LiveSSTableCount Gauge < Integer > Number of SSTables on disk for this table . 
 LiveDiskSpaceUsed Counter Disk space used by SSTables belonging to this table ( in bytes ) . 
 TotalDiskSpaceUsed Counter Total disk space used by SSTables belonging to this table , including obsolete ones waiting to be GC ' d . 
 - MinPartitionSize Gauge < Long > Size of the smallest compacted partition ( in bytes ) . 
 - MaxPartitionSize Gauge < Long > Size of the largest compacted partition ( in bytes ) . 
 - MeanPartitionSize Gauge < Long > Size of the average compacted partition ( in bytes ) . 
 + MinPartitionSize Gauge < Long > Estimated minimum uncompressed partition size in bytes for any given SSTable in this table . Note that if there are multiple SSTables containing the same partition this metric does not sum those sizes , it just returns the minimum . For example if there are two SSTables containing only one ( identical ) partition with size 3 and 7 , this metric would show 3 instead of 10 . 
 + MaxPartitionSize Gauge < Long > Estimated maximum uncompressed partition size in bytes for any given SSTable in this table . Note that if there are multiple SSTables containing the same partition this metric does not sum those sizes , it just returns the maximum . For example if there are two SSTables containing only one ( identical ) partition with size 3 and 7 , this metric would show 7 instead of 10 . 
 + MeanPartitionSize Gauge < Long > Estimated weighted mean uncompressed partition size in bytes across all SSTables in this table . Each SSTable contributes an estimated mean size proportional to the estimated number of partitions in that SSTable . For example if there are two SSTables with mean size 2 and 300 , covering 200 partitions and 3 partitions respectively , this metric would return ( 2 * 200 + 300 * 3 ) / ( 200 + 3 ) = 6 . 
 BloomFilterFalsePositives Gauge < Long > Number of false positives on table ' s bloom filter . 
 BloomFilterFalseRatio Gauge < Double > False positive ratio of table ' s bloom filter . 
 BloomFilterDiskSpaceUsed Gauge < Long > Disk space used by bloom filter ( in bytes ) .

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d4c6697 . . 2346993 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 . 1 
 + * nodetool methods to enable / disable hint storage / delivery ( CASSANDRA - 4750 ) 
 * disallow bloom filter false positive chance of 0 ( CASSANDRA - 5013 ) 
 * add threadpool size adjustment methods to JMXEnabledThreadPoolExecutor and 
 CompactionManagerMBean ( CASSANDRA - 5044 ) 
 diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index 476af88 . . 8ca0281 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 87 , 12 + 87 , 15 @ @ import org . cliffc . high _ scale _ lib . NonBlockingHashSet ; 
 
 public class HintedHandOffManager implements HintedHandOffManagerMBean 
 { 
 + public static final String MBEAN _ NAME = " org . apache . cassandra . db : type = HintedHandoffManager " ; 
 public static final HintedHandOffManager instance = new HintedHandOffManager ( ) ; 
 
 private static final Logger logger = LoggerFactory . getLogger ( HintedHandOffManager . class ) ; 
 private static final int PAGE _ SIZE = 128 ; 
 private static final int LARGE _ NUMBER = 65536 ; / / 64k nodes ought to be enough for anybody . 
 
 + private volatile boolean hintedHandOffPaused = false ; 
 + 
 static final CompositeType comparator = CompositeType . getInstance ( Arrays . < AbstractType < ? > > asList ( UUIDType . instance , Int32Type . instance ) ) ; 
 
 private final NonBlockingHashSet < InetAddress > queuedDeliveries = new NonBlockingHashSet < InetAddress > ( ) ; 
 @ @ - 108 , 7 + 111 , 7 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 MBeanServer mbs = ManagementFactory . getPlatformMBeanServer ( ) ; 
 try 
 { 
 - mbs . registerMBean ( this , new ObjectName ( " org . apache . cassandra . db : type = HintedHandoffManager " ) ) ; 
 + mbs . registerMBean ( this , new ObjectName ( MBEAN _ NAME ) ) ; 
 } 
 catch ( Exception e ) 
 { 
 @ @ - 256 , 6 + 259 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 if ( hintStore . isEmpty ( ) ) 
 return ; / / nothing to do , don ' t confuse users by logging a no - op handoff 
 
 + / / check if hints delivery has been paused 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + return ; 
 + } 
 + 
 logger . debug ( " Checking remote ( { } ) schema before delivering hints " , endpoint ) ; 
 try 
 { 
 @ @ - 303 , 6 + 313 , 13 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 
 while ( true ) 
 { 
 + / / check if hints delivery has been paused during the process 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + break ; 
 + } 
 + 
 QueryFilter filter = QueryFilter . getSliceFilter ( epkey , new QueryPath ( SystemTable . HINTS _ CF ) , startColumn , ByteBufferUtil . EMPTY _ BYTE _ BUFFER , false , pageSize ) ; 
 ColumnFamily hintsPage = ColumnFamilyStore . removeDeleted ( hintStore . getColumnFamily ( filter ) , ( int ) ( System . currentTimeMillis ( ) / 1000 ) ) ; 
 if ( pagingFinished ( hintsPage , startColumn ) ) 
 @ @ - 332 , 6 + 349 , 11 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 if ( ! hint . isLive ( ) ) 
 continue ; 
 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . debug ( " Hints delivery process is paused , aborting " ) ; 
 + break ; 
 + } 
 startColumn = hint . name ( ) ; 
 
 ByteBuffer [ ] components = comparator . split ( hint . name ( ) ) ; 
 @ @ - 384 , 6 + 406 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 } 
 
 logger . info ( String . format ( " Finished hinted handoff of % s rows to endpoint % s " , rowsReplayed , endpoint ) ) ; 
 + if ( hintedHandOffPaused ) 
 + { 
 + logger . info ( " Hints delivery process is paused , not delivering further hints " ) ; 
 + } 
 } 
 
 / * * 
 @ @ - 440 , 6 + 466 , 10 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 scheduleHintDelivery ( InetAddress . getByName ( to ) ) ; 
 } 
 
 + public void pauseHintsDelivery ( boolean b ) { 
 + hintedHandOffPaused = b ; 
 + } 
 + 
 public List < String > listEndpointsPendingHints ( ) 
 { 
 Token . TokenFactory tokenFactory = StorageService . getPartitioner ( ) . getTokenFactory ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 index 1ba70c4 . . 690a3eb 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManagerMBean . java 
 @ @ - 45 , 5 + 45 , 8 @ @ public interface HintedHandOffManagerMBean 
 
 / * * force hint delivery to an endpoint * * / 
 public void scheduleHintDelivery ( String host ) throws UnknownHostException ; 
 + 
 + / * * pause hints delivery process * * / 
 + public void pauseHintsDelivery ( boolean b ) ; 
 } 
 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeCmd . java b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 index d72f3d3 . . dddc98c 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeCmd . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeCmd . java 
 @ @ - 102 , 9 + 102 , 11 @ @ public class NodeCmd 
 COMPACTIONSTATS , 
 DECOMMISSION , 
 DISABLEGOSSIP , 
 + DISABLEHANDOFF , 
 DISABLETHRIFT , 
 DRAIN , 
 ENABLEGOSSIP , 
 + ENABLEHANDOFF , 
 ENABLETHRIFT , 
 FLUSH , 
 GETCOMPACTIONTHRESHOLD , 
 @ @ - 118 , 12 + 120 , 14 @ @ public class NodeCmd 
 JOIN , 
 MOVE , 
 NETSTATS , 
 + PAUSEHANDOFF , 
 PROXYHISTOGRAMS , 
 REBUILD , 
 REFRESH , 
 REMOVETOKEN , 
 REMOVENODE , 
 REPAIR , 
 + RESUMEHANDOFF , 
 RING , 
 SCRUB , 
 SETCACHECAPACITY , 
 @ @ - 1006 , 6 + 1010 , 10 @ @ public class NodeCmd 
 case COMPACTIONSTATS : nodeCmd . printCompactionStats ( System . out ) ; break ; 
 case DISABLEGOSSIP : probe . stopGossiping ( ) ; break ; 
 case ENABLEGOSSIP : probe . startGossiping ( ) ; break ; 
 + case DISABLEHANDOFF : probe . disableHintedHandoff ( ) ; break ; 
 + case ENABLEHANDOFF : probe . enableHintedHandoff ( ) ; break ; 
 + case PAUSEHANDOFF : probe . pauseHintsDelivery ( ) ; break ; 
 + case RESUMEHANDOFF : probe . resumeHintsDelivery ( ) ; break ; 
 case DISABLETHRIFT : probe . stopThriftServer ( ) ; break ; 
 case ENABLETHRIFT : probe . startThriftServer ( ) ; break ; 
 case STATUSTHRIFT : nodeCmd . printIsThriftServerRunning ( System . out ) ; break ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 021a40f . . 7a7c60c 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 40 , 6 + 40 , 8 @ @ import com . google . common . collect . Iterables ; 
 
 import org . apache . cassandra . concurrent . JMXEnabledThreadPoolExecutorMBean ; 
 import org . apache . cassandra . db . ColumnFamilyStoreMBean ; 
 + import org . apache . cassandra . db . HintedHandOffManager ; 
 + import org . apache . cassandra . db . HintedHandOffManagerMBean ; 
 import org . apache . cassandra . db . compaction . CompactionManager ; 
 import org . apache . cassandra . db . compaction . CompactionManagerMBean ; 
 import org . apache . cassandra . gms . FailureDetector ; 
 @ @ - 77 , 6 + 79 , 7 @ @ public class NodeProbe 
 private CacheServiceMBean cacheService ; 
 private PBSPredictorMBean PBSPredictorProxy ; 
 private StorageProxyMBean spProxy ; 
 + private HintedHandOffManagerMBean hhProxy ; 
 
 / * * 
 * Creates a NodeProbe using the specified JMX host , port , username , and password . 
 @ @ - 159 , 6 + 162 , 8 @ @ public class NodeProbe 
 cacheService = JMX . newMBeanProxy ( mbeanServerConn , name , CacheServiceMBean . class ) ; 
 name = new ObjectName ( StorageProxy . MBEAN _ NAME ) ; 
 spProxy = JMX . newMBeanProxy ( mbeanServerConn , name , StorageProxyMBean . class ) ; 
 + name = new ObjectName ( HintedHandOffManager . MBEAN _ NAME ) ; 
 + hhProxy = JMX . newMBeanProxy ( mbeanServerConn , name , HintedHandOffManagerMBean . class ) ; 
 } catch ( MalformedObjectNameException e ) 
 { 
 throw new RuntimeException ( 
 @ @ - 647 , 6 + 652 , 26 @ @ public class NodeProbe 
 return ssProxy . getKeyspaces ( ) ; 
 } 
 
 + public void disableHintedHandoff ( ) 
 + { 
 + spProxy . setHintedHandoffEnabled ( false ) ; 
 + } 
 + 
 + public void enableHintedHandoff ( ) 
 + { 
 + spProxy . setHintedHandoffEnabled ( true ) ; 
 + } 
 + 
 + public void pauseHintsDelivery ( ) 
 + { 
 + hhProxy . pauseHintsDelivery ( true ) ; 
 + } 
 + 
 + public void resumeHintsDelivery ( ) 
 + { 
 + hhProxy . pauseHintsDelivery ( false ) ; 
 + } 
 + 
 public void stopGossiping ( ) 
 { 
 ssProxy . stopGossiping ( ) ; 
 diff - - git a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 index 677b689 . . 2398f01 100644 
 - - - a / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 + + + b / src / resources / org / apache / cassandra / tools / NodeToolHelp . yaml 
 @ @ - 1 , 4 + 1 , 3 @ @ 
 - 
 # Licensed to the Apache Software Foundation ( ASF ) under one 
 # or more contributor license agreements . See the NOTICE file 
 # distributed with this work for additional information 
 @ @ - 50 , 6 + 49 , 18 @ @ commands : 
 - name : compactionstats 
 help : | 
 Print statistics on compactions 
 + - name : disablehandoff 
 + help : | 
 + Disable the future hints storing on the current node 
 + - name : enablehandoff 
 + help : | 
 + Reenable the future hints storing on the current node 
 + - name : resumehandoff 
 + help : | 
 + Resume hints delivery process 
 + - name : pausehandoff 
 + help : | 
 + Pause hints delivery process 
 - name : disablegossip 
 help : | 
 Disable gossip ( effectively marking the node dead )
