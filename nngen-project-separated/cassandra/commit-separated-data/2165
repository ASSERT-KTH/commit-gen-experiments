BLEU SCORE: 0.03283637368030199

TEST MSG: Fix failure to stream ranges when moving
GENERATED MSG: merge from 1 . 0 . 0

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 9c75426 . . 0b45cef 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 0 <nl> + * Fix failure to stream ranges when moving ( CASSANDRA - 7836 ) <nl> * Correctly remove tmplink files ( CASSANDRA - 7803 ) <nl> * ( cqlsh ) Fix column name formatting for functions , CAS operations , <nl> and UDT field selections ( CASSANDRA - 7806 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index b4aa5ba . . 735bf7b 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 3179 , 6 + 3179 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> <nl> for ( String keyspace : keyspaceNames ) <nl> { <nl> + logger . debug ( " Calculating ranges to stream and request for keyspace { } " , keyspace ) ; <nl> for ( Token newToken : newTokens ) <nl> { <nl> / / replication strategy of the current keyspace ( aka table ) <nl> @ @ - 3263 , 17 + 3264 , 26 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> Set < InetAddress > newEndpoints = ImmutableSet . copyOf ( strategy . calculateNaturalEndpoints ( toStream . right , tokenMetaCloneAllSettled ) ) ; <nl> logger . debug ( " Range : { } Current endpoints : { } New endpoints : { } " , toStream , currentEndpoints , newEndpoints ) ; <nl> for ( InetAddress address : Sets . difference ( newEndpoints , currentEndpoints ) ) <nl> + { <nl> + logger . debug ( " Range { } has new owner { } " , toStream , address ) ; <nl> endpointRanges . put ( address , toStream ) ; <nl> + } <nl> } <nl> <nl> / / stream ranges <nl> for ( InetAddress address : endpointRanges . keySet ( ) ) <nl> + { <nl> + logger . debug ( " Will stream range { } of keyspace { } to endpoint { } " , endpointRanges . get ( address ) , keyspace , address ) ; <nl> streamPlan . transferRanges ( address , keyspace , endpointRanges . get ( address ) ) ; <nl> + } <nl> <nl> / / stream requests <nl> Multimap < InetAddress , Range < Token > > workMap = RangeStreamer . getWorkMap ( rangesToFetchWithPreferredEndpoints ) ; <nl> for ( InetAddress address : workMap . keySet ( ) ) <nl> + { <nl> + logger . debug ( " Will request range { } of keyspace { } from endpoint { } " , workMap . get ( address ) , keyspace , address ) ; <nl> streamPlan . requestRanges ( address , keyspace , workMap . get ( address ) ) ; <nl> + } <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> logger . debug ( " Keyspace { } : work map { } . " , keyspace , workMap ) ; <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamPlan . java b / src / java / org / apache / cassandra / streaming / StreamPlan . java <nl> index e775c90 . . feb116f 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamPlan . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamPlan . java <nl> @ @ - 143 , 7 + 143 , 7 @ @ public class StreamPlan <nl> * / <nl> public boolean isEmpty ( ) <nl> { <nl> - return coordinator . hasActiveSessions ( ) ; <nl> + return ! coordinator . hasActiveSessions ( ) ; <nl> } <nl> <nl> / * *
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 630ee2e . . 1f0f0e9 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 10 @ @ <nl> - 1 . 0 - dev <nl> + 1 . 1 - dev <nl> + <nl> + <nl> + 1 . 0 . 1 <nl> + <nl> + <nl> + 1 . 0 <nl> * removed binarymemtable ( CASSANDRA - 2692 ) <nl> * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) <nl> * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 9c75426 . . 0b45cef 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 0 
 + * Fix failure to stream ranges when moving ( CASSANDRA - 7836 ) 
 * Correctly remove tmplink files ( CASSANDRA - 7803 ) 
 * ( cqlsh ) Fix column name formatting for functions , CAS operations , 
 and UDT field selections ( CASSANDRA - 7806 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index b4aa5ba . . 735bf7b 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 3179 , 6 + 3179 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 
 for ( String keyspace : keyspaceNames ) 
 { 
 + logger . debug ( " Calculating ranges to stream and request for keyspace { } " , keyspace ) ; 
 for ( Token newToken : newTokens ) 
 { 
 / / replication strategy of the current keyspace ( aka table ) 
 @ @ - 3263 , 17 + 3264 , 26 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 Set < InetAddress > newEndpoints = ImmutableSet . copyOf ( strategy . calculateNaturalEndpoints ( toStream . right , tokenMetaCloneAllSettled ) ) ; 
 logger . debug ( " Range : { } Current endpoints : { } New endpoints : { } " , toStream , currentEndpoints , newEndpoints ) ; 
 for ( InetAddress address : Sets . difference ( newEndpoints , currentEndpoints ) ) 
 + { 
 + logger . debug ( " Range { } has new owner { } " , toStream , address ) ; 
 endpointRanges . put ( address , toStream ) ; 
 + } 
 } 
 
 / / stream ranges 
 for ( InetAddress address : endpointRanges . keySet ( ) ) 
 + { 
 + logger . debug ( " Will stream range { } of keyspace { } to endpoint { } " , endpointRanges . get ( address ) , keyspace , address ) ; 
 streamPlan . transferRanges ( address , keyspace , endpointRanges . get ( address ) ) ; 
 + } 
 
 / / stream requests 
 Multimap < InetAddress , Range < Token > > workMap = RangeStreamer . getWorkMap ( rangesToFetchWithPreferredEndpoints ) ; 
 for ( InetAddress address : workMap . keySet ( ) ) 
 + { 
 + logger . debug ( " Will request range { } of keyspace { } from endpoint { } " , workMap . get ( address ) , keyspace , address ) ; 
 streamPlan . requestRanges ( address , keyspace , workMap . get ( address ) ) ; 
 + } 
 
 if ( logger . isDebugEnabled ( ) ) 
 logger . debug ( " Keyspace { } : work map { } . " , keyspace , workMap ) ; 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamPlan . java b / src / java / org / apache / cassandra / streaming / StreamPlan . java 
 index e775c90 . . feb116f 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamPlan . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamPlan . java 
 @ @ - 143 , 7 + 143 , 7 @ @ public class StreamPlan 
 * / 
 public boolean isEmpty ( ) 
 { 
 - return coordinator . hasActiveSessions ( ) ; 
 + return ! coordinator . hasActiveSessions ( ) ; 
 } 
 
 / * *

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 630ee2e . . 1f0f0e9 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 10 @ @ 
 - 1 . 0 - dev 
 + 1 . 1 - dev 
 + 
 + 
 + 1 . 0 . 1 
 + 
 + 
 + 1 . 0 
 * removed binarymemtable ( CASSANDRA - 2692 ) 
 * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) 
 * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 )
