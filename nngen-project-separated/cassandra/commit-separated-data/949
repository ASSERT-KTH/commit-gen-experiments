BLEU SCORE: 0.05522397783539471

TEST MSG: Log endpoint and port associated with streaming operation
GENERATED MSG: Fix ConcurrentModificationException during streaming

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 4650cf6 . . af3167c 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 6 <nl> + * Log endpoint and port associated with streaming operation ( CASSANDRA - 8777 ) <nl> * Print sensible units for all log messages ( CASSANDRA - 9692 ) <nl> * Upgrade Netty to version 4 . 0 . 34 ( CASSANDRA - 11096 ) <nl> * Break the CQL grammar into separate Parser and Lexer ( CASSANDRA - 11372 ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / ConnectionHandler . java b / src / java / org / apache / cassandra / streaming / ConnectionHandler . java <nl> index d4662c7 . . 960b531 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / ConnectionHandler . java <nl> + + + b / src / java / org / apache / cassandra / streaming / ConnectionHandler . java <nl> @ @ - 206 , 7 + 206 , 7 @ @ public class ConnectionHandler <nl> this . socket = socket ; <nl> this . protocolVersion = protocolVersion ; <nl> <nl> - new Thread ( this , name ( ) + " - " + session . peer ) . start ( ) ; <nl> + new Thread ( this , name ( ) + " - " + socket . getRemoteSocketAddress ( ) ) . start ( ) ; <nl> } <nl> <nl> public ListenableFuture < ? > close ( ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamSession . java b / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> index 39e12d4 . . 0a04bd9 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> @ @ - 516 , 7 + 516 , 10 @ @ public class StreamSession implements IEndpointStateChangeSubscriber <nl> * / <nl> public void onError ( Throwable e ) <nl> { <nl> - logger . error ( " [ Stream # { } ] Streaming error occurred " , planId ( ) , e ) ; <nl> + logger . error ( " [ Stream # { } ] Streaming error occurred on session with peer { } { } " , planId ( ) , <nl> + peer . getHostAddress ( ) , <nl> + peer . equals ( connecting ) ? " " : " through " + connecting . getHostAddress ( ) , <nl> + e ) ; <nl> / / send session failure message <nl> if ( handler . isOutgoingConnected ( ) ) <nl> handler . sendMessage ( new SessionFailedMessage ( ) ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 4d56c98 . . 20a6373 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 14 , 6 + 14 , 7 @ @ <nl> * Support streaming SSTables of old versions ( CASSANDRA - 5772 ) <nl> * Always respect protocol version in native protocol ( CASSANDRA - 5778 ) <nl> * Fix ConcurrentModificationException during streaming ( CASSANDRA - 5782 ) <nl> + * Update deletion timestamp in Commit # updatesWithPaxosTime ( CASSANDRA - 5787 ) <nl> <nl> <nl> 2 . 0 . 0 - beta1 <nl> diff - - git a / src / java / org / apache / cassandra / db / DeletionInfo . java b / src / java / org / apache / cassandra / db / DeletionInfo . java <nl> index 49aa427 . . 32cc2a7 100644 <nl> - - - a / src / java / org / apache / cassandra / db / DeletionInfo . java <nl> + + + b / src / java / org / apache / cassandra / db / DeletionInfo . java <nl> @ @ - 265 , 6 + 265 , 16 @ @ public class DeletionInfo <nl> return sb . toString ( ) ; <nl> } <nl> <nl> + / / Updates all the timestamp of the deletion contained in this DeletionInfo to be { @ code timestamp } . <nl> + public void updateAllTimestamp ( long timestamp ) <nl> + { <nl> + if ( topLevel . markedForDeleteAt ! = Long . MIN _ VALUE ) <nl> + topLevel = new DeletionTime ( timestamp , topLevel . localDeletionTime ) ; <nl> + <nl> + if ( ranges ! = null ) <nl> + ranges . updateAllTimestamp ( timestamp ) ; <nl> + } <nl> + <nl> @ Override <nl> public boolean equals ( Object o ) <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / db / RangeTombstoneList . java b / src / java / org / apache / cassandra / db / RangeTombstoneList . java <nl> index 771b1a8 . . e99ed9f 100644 <nl> - - - a / src / java / org / apache / cassandra / db / RangeTombstoneList . java <nl> + + + b / src / java / org / apache / cassandra / db / RangeTombstoneList . java <nl> @ @ - 288 , 6 + 288 , 12 @ @ public class RangeTombstoneList implements Iterable < RangeTombstone > <nl> return max ; <nl> } <nl> <nl> + public void updateAllTimestamp ( long timestamp ) <nl> + { <nl> + for ( int i = 0 ; i < size ; i + + ) <nl> + markedAts [ i ] = timestamp ; <nl> + } <nl> + <nl> / * * <nl> * Removes all range tombstones whose local deletion time is older than gcBefore . <nl> * / <nl> diff - - git a / src / java / org / apache / cassandra / service / paxos / Commit . java b / src / java / org / apache / cassandra / service / paxos / Commit . java <nl> index fdc707b . . 04ddca8 100644 <nl> - - - a / src / java / org / apache / cassandra / service / paxos / Commit . java <nl> + + + b / src / java / org / apache / cassandra / service / paxos / Commit . java <nl> @ @ - 114 , 6 + 114 , 7 @ @ public class Commit <nl> { <nl> ColumnFamily cf = updates . cloneMeShallow ( ) ; <nl> long t = UUIDGen . microsTimestamp ( ballot ) ; <nl> + cf . deletionInfo ( ) . updateAllTimestamp ( t ) ; <nl> for ( Column column : updates ) <nl> cf . addAtom ( column . withUpdatedTimestamp ( t ) ) ; <nl> return cf ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 4650cf6 . . af3167c 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 6 
 + * Log endpoint and port associated with streaming operation ( CASSANDRA - 8777 ) 
 * Print sensible units for all log messages ( CASSANDRA - 9692 ) 
 * Upgrade Netty to version 4 . 0 . 34 ( CASSANDRA - 11096 ) 
 * Break the CQL grammar into separate Parser and Lexer ( CASSANDRA - 11372 ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / ConnectionHandler . java b / src / java / org / apache / cassandra / streaming / ConnectionHandler . java 
 index d4662c7 . . 960b531 100644 
 - - - a / src / java / org / apache / cassandra / streaming / ConnectionHandler . java 
 + + + b / src / java / org / apache / cassandra / streaming / ConnectionHandler . java 
 @ @ - 206 , 7 + 206 , 7 @ @ public class ConnectionHandler 
 this . socket = socket ; 
 this . protocolVersion = protocolVersion ; 
 
 - new Thread ( this , name ( ) + " - " + session . peer ) . start ( ) ; 
 + new Thread ( this , name ( ) + " - " + socket . getRemoteSocketAddress ( ) ) . start ( ) ; 
 } 
 
 public ListenableFuture < ? > close ( ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamSession . java b / src / java / org / apache / cassandra / streaming / StreamSession . java 
 index 39e12d4 . . 0a04bd9 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamSession . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamSession . java 
 @ @ - 516 , 7 + 516 , 10 @ @ public class StreamSession implements IEndpointStateChangeSubscriber 
 * / 
 public void onError ( Throwable e ) 
 { 
 - logger . error ( " [ Stream # { } ] Streaming error occurred " , planId ( ) , e ) ; 
 + logger . error ( " [ Stream # { } ] Streaming error occurred on session with peer { } { } " , planId ( ) , 
 + peer . getHostAddress ( ) , 
 + peer . equals ( connecting ) ? " " : " through " + connecting . getHostAddress ( ) , 
 + e ) ; 
 / / send session failure message 
 if ( handler . isOutgoingConnected ( ) ) 
 handler . sendMessage ( new SessionFailedMessage ( ) ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 4d56c98 . . 20a6373 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 14 , 6 + 14 , 7 @ @ 
 * Support streaming SSTables of old versions ( CASSANDRA - 5772 ) 
 * Always respect protocol version in native protocol ( CASSANDRA - 5778 ) 
 * Fix ConcurrentModificationException during streaming ( CASSANDRA - 5782 ) 
 + * Update deletion timestamp in Commit # updatesWithPaxosTime ( CASSANDRA - 5787 ) 
 
 
 2 . 0 . 0 - beta1 
 diff - - git a / src / java / org / apache / cassandra / db / DeletionInfo . java b / src / java / org / apache / cassandra / db / DeletionInfo . java 
 index 49aa427 . . 32cc2a7 100644 
 - - - a / src / java / org / apache / cassandra / db / DeletionInfo . java 
 + + + b / src / java / org / apache / cassandra / db / DeletionInfo . java 
 @ @ - 265 , 6 + 265 , 16 @ @ public class DeletionInfo 
 return sb . toString ( ) ; 
 } 
 
 + / / Updates all the timestamp of the deletion contained in this DeletionInfo to be { @ code timestamp } . 
 + public void updateAllTimestamp ( long timestamp ) 
 + { 
 + if ( topLevel . markedForDeleteAt ! = Long . MIN _ VALUE ) 
 + topLevel = new DeletionTime ( timestamp , topLevel . localDeletionTime ) ; 
 + 
 + if ( ranges ! = null ) 
 + ranges . updateAllTimestamp ( timestamp ) ; 
 + } 
 + 
 @ Override 
 public boolean equals ( Object o ) 
 { 
 diff - - git a / src / java / org / apache / cassandra / db / RangeTombstoneList . java b / src / java / org / apache / cassandra / db / RangeTombstoneList . java 
 index 771b1a8 . . e99ed9f 100644 
 - - - a / src / java / org / apache / cassandra / db / RangeTombstoneList . java 
 + + + b / src / java / org / apache / cassandra / db / RangeTombstoneList . java 
 @ @ - 288 , 6 + 288 , 12 @ @ public class RangeTombstoneList implements Iterable < RangeTombstone > 
 return max ; 
 } 
 
 + public void updateAllTimestamp ( long timestamp ) 
 + { 
 + for ( int i = 0 ; i < size ; i + + ) 
 + markedAts [ i ] = timestamp ; 
 + } 
 + 
 / * * 
 * Removes all range tombstones whose local deletion time is older than gcBefore . 
 * / 
 diff - - git a / src / java / org / apache / cassandra / service / paxos / Commit . java b / src / java / org / apache / cassandra / service / paxos / Commit . java 
 index fdc707b . . 04ddca8 100644 
 - - - a / src / java / org / apache / cassandra / service / paxos / Commit . java 
 + + + b / src / java / org / apache / cassandra / service / paxos / Commit . java 
 @ @ - 114 , 6 + 114 , 7 @ @ public class Commit 
 { 
 ColumnFamily cf = updates . cloneMeShallow ( ) ; 
 long t = UUIDGen . microsTimestamp ( ballot ) ; 
 + cf . deletionInfo ( ) . updateAllTimestamp ( t ) ; 
 for ( Column column : updates ) 
 cf . addAtom ( column . withUpdatedTimestamp ( t ) ) ; 
 return cf ;
