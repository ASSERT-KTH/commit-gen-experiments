BLEU SCORE: 0.15777684932819508

TEST MSG: Fix RowAndDeletionMergeIteratorTest
GENERATED MSG: Fix RangeTombstone combining in RowAndTombstonMergeIterator

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java b / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java <nl> index 54bb344 . . 84bbc57 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java <nl> @ @ - 94 , 7 + 94 , 7 @ @ public class RowAndDeletionMergeIteratorTest <nl> public void testWithOnlyRangeTombstones ( ) <nl> { <nl> int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> <nl> Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( rt ( 1 , false , 3 , false , timestamp , delTime ) , <nl> atLeast ( 4 , timestamp , delTime ) ) ; <nl> @ @ - 121 , 7 + 121 , 7 @ @ public class RowAndDeletionMergeIteratorTest <nl> Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> <nl> int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> <nl> Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) ) ; <nl> <nl> @ @ - 131 , 9 + 131 , 6 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 0 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> @ @ - 157 , 7 + 154 , 7 @ @ public class RowAndDeletionMergeIteratorTest <nl> Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> <nl> int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> <nl> Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( greaterThan ( 2 , timestamp , delTime ) ) ; <nl> <nl> @ @ - 176 , 12 + 173 , 6 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ START _ BOUND , 2 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 3 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 4 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; <nl> <nl> assertFalse ( iterator . hasNext ( ) ) ; <nl> @ @ - 193 , 7 + 184 , 7 @ @ public class RowAndDeletionMergeIteratorTest <nl> Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> <nl> int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> <nl> Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) , <nl> greaterThan ( 2 , timestamp , delTime ) ) ; <nl> @ @ - 204 , 9 + 195 , 6 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 0 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> @ @ - 219 , 12 + 207 , 6 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ START _ BOUND , 2 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 3 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 4 ) ; <nl> - <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; <nl> <nl> assertFalse ( iterator . hasNext ( ) ) ; <nl> @ @ - 243 , 7 + 225 , 7 @ @ public class RowAndDeletionMergeIteratorTest <nl> Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> <nl> int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> <nl> Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 2 , timestamp , delTime ) , <nl> greaterThan ( 2 , timestamp , delTime ) ) ; <nl> @ @ - 254 , 22 + 236 , 32 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 0 ) ; <nl> + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ EXCL _ START _ BOUNDARY , 2 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 1 ) ; <nl> + assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; <nl> <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 2 ) ; <nl> + assertFalse ( iterator . hasNext ( ) ) ; <nl> + } <nl> <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ EXCL _ START _ BOUNDARY , 2 ) ; <nl> + @ Test <nl> + public void testWithExcludingEndIncludingStartMarker ( ) <nl> + { <nl> + Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> + <nl> + int delTime = nowInSeconds + 1 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> + <nl> + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( lessThan ( 2 , timestamp , delTime ) , <nl> + atLeast ( 2 , timestamp , delTime ) ) ; <nl> + <nl> + UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , rangeTombstoneIterator , false ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 3 ) ; <nl> + assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 4 ) ; <nl> + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ END _ INCL _ START _ BOUNDARY , 2 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; <nl> @ @ - 278 , 15 + 270 , 11 @ @ public class RowAndDeletionMergeIteratorTest <nl> } <nl> <nl> @ Test <nl> - public void testWithExcludingEndIncludingStartMarker ( ) <nl> + public void testNonShadowingTombstone ( ) <nl> { <nl> Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> <nl> - int delTime = nowInSeconds + 1 ; <nl> - long timestamp = delTime * 1000 ; <nl> - <nl> - Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( lessThan ( 2 , timestamp , delTime ) , <nl> - atLeast ( 2 , timestamp , delTime ) ) ; <nl> + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , - 1L , 0 ) ) ; <nl> <nl> UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , rangeTombstoneIterator , false ) ; <nl> <nl> @ @ - 297 , 10 + 285 , 10 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertRow ( iterator . next ( ) , 0 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRow ( iterator . next ( ) , 1 ) ; <nl> + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ END _ INCL _ START _ BOUNDARY , 2 ) ; <nl> + assertRow ( iterator . next ( ) , 1 ) ; <nl> <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRow ( iterator . next ( ) , 2 ) ; <nl> @ @ - 311 , 12 + 299 , 32 @ @ public class RowAndDeletionMergeIteratorTest <nl> assertTrue ( iterator . hasNext ( ) ) ; <nl> assertRow ( iterator . next ( ) , 4 ) ; <nl> <nl> - assertTrue ( iterator . hasNext ( ) ) ; <nl> - assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; <nl> + assertFalse ( iterator . hasNext ( ) ) ; <nl> + } <nl> + <nl> + @ Test <nl> + public void testWithPartitionLevelTombstone ( ) <nl> + { <nl> + Iterator < Row > rowIterator = createRowIterator ( ) ; <nl> + <nl> + int delTime = nowInSeconds - 1 ; <nl> + long timestamp = toMillis ( delTime ) ; <nl> + <nl> + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) , <nl> + greaterThan ( 2 , timestamp , delTime ) ) ; <nl> + <nl> + int partitionDelTime = nowInSeconds + 1 ; <nl> + long partitionTimestamp = toMillis ( partitionDelTime ) ; <nl> + <nl> + UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , <nl> + rangeTombstoneIterator , <nl> + new DeletionTime ( partitionTimestamp , partitionDelTime ) , <nl> + false ) ; <nl> <nl> assertFalse ( iterator . hasNext ( ) ) ; <nl> } <nl> <nl> + <nl> private void assertRtMarker ( Unfiltered unfiltered , Bound bound ) <nl> { <nl> assertEquals ( Unfiltered . Kind . RANGE _ TOMBSTONE _ MARKER , unfiltered . kind ( ) ) ; <nl> @ @ - 350 , 9 + 358 , 17 @ @ public class RowAndDeletionMergeIteratorTest <nl> <nl> private UnfilteredRowIterator createMergeIterator ( Iterator < Row > rows , Iterator < RangeTombstone > tombstones , boolean reversed ) <nl> { <nl> + return createMergeIterator ( rows , tombstones , DeletionTime . LIVE , reversed ) ; <nl> + } <nl> + <nl> + private UnfilteredRowIterator createMergeIterator ( Iterator < Row > rows , <nl> + Iterator < RangeTombstone > tombstones , <nl> + DeletionTime deletionTime , <nl> + boolean reversed ) <nl> + { <nl> return new RowAndDeletionMergeIterator ( cfm , <nl> Util . dk ( " k " ) , <nl> - DeletionTime . LIVE , <nl> + deletionTime , <nl> ColumnFilter . all ( cfm ) , <nl> Rows . EMPTY _ STATIC _ ROW , <nl> reversed , <nl> @ @ - 404 , 4 + 420 , 9 @ @ public class RowAndDeletionMergeIteratorTest <nl> { <nl> return ByteBufferUtil . bytes ( i ) ; <nl> } <nl> + <nl> + private long toMillis ( int timeInSeconds ) <nl> + { <nl> + return timeInSeconds * 1000L ; <nl> + } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java b / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java 
 index 54bb344 . . 84bbc57 100644 
 - - - a / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java 
 + + + b / test / unit / org / apache / cassandra / db / rows / RowAndDeletionMergeIteratorTest . java 
 @ @ - 94 , 7 + 94 , 7 @ @ public class RowAndDeletionMergeIteratorTest 
 public void testWithOnlyRangeTombstones ( ) 
 { 
 int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 + long timestamp = toMillis ( delTime ) ; 
 
 Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( rt ( 1 , false , 3 , false , timestamp , delTime ) , 
 atLeast ( 4 , timestamp , delTime ) ) ; 
 @ @ - 121 , 7 + 121 , 7 @ @ public class RowAndDeletionMergeIteratorTest 
 Iterator < Row > rowIterator = createRowIterator ( ) ; 
 
 int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 + long timestamp = toMillis ( delTime ) ; 
 
 Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) ) ; 
 
 @ @ - 131 , 9 + 131 , 6 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 0 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 @ @ - 157 , 7 + 154 , 7 @ @ public class RowAndDeletionMergeIteratorTest 
 Iterator < Row > rowIterator = createRowIterator ( ) ; 
 
 int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 + long timestamp = toMillis ( delTime ) ; 
 
 Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( greaterThan ( 2 , timestamp , delTime ) ) ; 
 
 @ @ - 176 , 12 + 173 , 6 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ START _ BOUND , 2 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 3 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 4 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; 
 
 assertFalse ( iterator . hasNext ( ) ) ; 
 @ @ - 193 , 7 + 184 , 7 @ @ public class RowAndDeletionMergeIteratorTest 
 Iterator < Row > rowIterator = createRowIterator ( ) ; 
 
 int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 + long timestamp = toMillis ( delTime ) ; 
 
 Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) , 
 greaterThan ( 2 , timestamp , delTime ) ) ; 
 @ @ - 204 , 9 + 195 , 6 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 0 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 @ @ - 219 , 12 + 207 , 6 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ START _ BOUND , 2 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 3 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 4 ) ; 
 - 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; 
 
 assertFalse ( iterator . hasNext ( ) ) ; 
 @ @ - 243 , 7 + 225 , 7 @ @ public class RowAndDeletionMergeIteratorTest 
 Iterator < Row > rowIterator = createRowIterator ( ) ; 
 
 int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 + long timestamp = toMillis ( delTime ) ; 
 
 Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 2 , timestamp , delTime ) , 
 greaterThan ( 2 , timestamp , delTime ) ) ; 
 @ @ - 254 , 22 + 236 , 32 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 0 ) ; 
 + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ EXCL _ START _ BOUNDARY , 2 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 1 ) ; 
 + assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; 
 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 2 ) ; 
 + assertFalse ( iterator . hasNext ( ) ) ; 
 + } 
 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ EXCL _ START _ BOUNDARY , 2 ) ; 
 + @ Test 
 + public void testWithExcludingEndIncludingStartMarker ( ) 
 + { 
 + Iterator < Row > rowIterator = createRowIterator ( ) ; 
 + 
 + int delTime = nowInSeconds + 1 ; 
 + long timestamp = toMillis ( delTime ) ; 
 + 
 + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( lessThan ( 2 , timestamp , delTime ) , 
 + atLeast ( 2 , timestamp , delTime ) ) ; 
 + 
 + UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , rangeTombstoneIterator , false ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 3 ) ; 
 + assertRtMarker ( iterator . next ( ) , Bound . BOTTOM ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 4 ) ; 
 + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ END _ INCL _ START _ BOUNDARY , 2 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; 
 @ @ - 278 , 15 + 270 , 11 @ @ public class RowAndDeletionMergeIteratorTest 
 } 
 
 @ Test 
 - public void testWithExcludingEndIncludingStartMarker ( ) 
 + public void testNonShadowingTombstone ( ) 
 { 
 Iterator < Row > rowIterator = createRowIterator ( ) ; 
 
 - int delTime = nowInSeconds + 1 ; 
 - long timestamp = delTime * 1000 ; 
 - 
 - Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( lessThan ( 2 , timestamp , delTime ) , 
 - atLeast ( 2 , timestamp , delTime ) ) ; 
 + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , - 1L , 0 ) ) ; 
 
 UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , rangeTombstoneIterator , false ) ; 
 
 @ @ - 297 , 10 + 285 , 10 @ @ public class RowAndDeletionMergeIteratorTest 
 assertRow ( iterator . next ( ) , 0 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRow ( iterator . next ( ) , 1 ) ; 
 + assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . INCL _ END _ BOUND , 0 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRtMarker ( iterator . next ( ) , ClusteringPrefix . Kind . EXCL _ END _ INCL _ START _ BOUNDARY , 2 ) ; 
 + assertRow ( iterator . next ( ) , 1 ) ; 
 
 assertTrue ( iterator . hasNext ( ) ) ; 
 assertRow ( iterator . next ( ) , 2 ) ; 
 @ @ - 311 , 12 + 299 , 32 @ @ public class RowAndDeletionMergeIteratorTest 
 assertTrue ( iterator . hasNext ( ) ) ; 
 assertRow ( iterator . next ( ) , 4 ) ; 
 
 - assertTrue ( iterator . hasNext ( ) ) ; 
 - assertRtMarker ( iterator . next ( ) , Bound . TOP ) ; 
 + assertFalse ( iterator . hasNext ( ) ) ; 
 + } 
 + 
 + @ Test 
 + public void testWithPartitionLevelTombstone ( ) 
 + { 
 + Iterator < Row > rowIterator = createRowIterator ( ) ; 
 + 
 + int delTime = nowInSeconds - 1 ; 
 + long timestamp = toMillis ( delTime ) ; 
 + 
 + Iterator < RangeTombstone > rangeTombstoneIterator = createRangeTombstoneIterator ( atMost ( 0 , timestamp , delTime ) , 
 + greaterThan ( 2 , timestamp , delTime ) ) ; 
 + 
 + int partitionDelTime = nowInSeconds + 1 ; 
 + long partitionTimestamp = toMillis ( partitionDelTime ) ; 
 + 
 + UnfilteredRowIterator iterator = createMergeIterator ( rowIterator , 
 + rangeTombstoneIterator , 
 + new DeletionTime ( partitionTimestamp , partitionDelTime ) , 
 + false ) ; 
 
 assertFalse ( iterator . hasNext ( ) ) ; 
 } 
 
 + 
 private void assertRtMarker ( Unfiltered unfiltered , Bound bound ) 
 { 
 assertEquals ( Unfiltered . Kind . RANGE _ TOMBSTONE _ MARKER , unfiltered . kind ( ) ) ; 
 @ @ - 350 , 9 + 358 , 17 @ @ public class RowAndDeletionMergeIteratorTest 
 
 private UnfilteredRowIterator createMergeIterator ( Iterator < Row > rows , Iterator < RangeTombstone > tombstones , boolean reversed ) 
 { 
 + return createMergeIterator ( rows , tombstones , DeletionTime . LIVE , reversed ) ; 
 + } 
 + 
 + private UnfilteredRowIterator createMergeIterator ( Iterator < Row > rows , 
 + Iterator < RangeTombstone > tombstones , 
 + DeletionTime deletionTime , 
 + boolean reversed ) 
 + { 
 return new RowAndDeletionMergeIterator ( cfm , 
 Util . dk ( " k " ) , 
 - DeletionTime . LIVE , 
 + deletionTime , 
 ColumnFilter . all ( cfm ) , 
 Rows . EMPTY _ STATIC _ ROW , 
 reversed , 
 @ @ - 404 , 4 + 420 , 9 @ @ public class RowAndDeletionMergeIteratorTest 
 { 
 return ByteBufferUtil . bytes ( i ) ; 
 } 
 + 
 + private long toMillis ( int timeInSeconds ) 
 + { 
 + return timeInSeconds * 1000L ; 
 + } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
