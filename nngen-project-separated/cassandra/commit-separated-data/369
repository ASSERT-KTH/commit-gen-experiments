BLEU SCORE: 0.02383853510228548

TEST MSG: NPE in IR cleanup when columnfamily has no sstables
GENERATED MSG: merge from 1 . 0 . 0

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 1f6c215 . . 4425aad 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 4 . 0 <nl> + * NPE in IR cleanup when columnfamily has no sstables ( CASSANDRA - 13585 ) <nl> * Fix Randomness of stress values ( CASSANDRA - 12744 ) <nl> * Allow selecting Map values and Set elements ( CASSANDRA - 7396 ) <nl> * Fast and garbage - free Streaming Histogram ( CASSANDRA - 13444 ) <nl> diff - - git a / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java b / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java <nl> index dd71537 . . f183d14 100644 <nl> - - - a / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java <nl> + + + b / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java <nl> @ @ - 69 , 8 + 69 , 10 @ @ public class PendingAntiCompaction <nl> <nl> void abort ( ) <nl> { <nl> - txn . abort ( ) ; <nl> - refs . release ( ) ; <nl> + if ( txn ! = null ) <nl> + txn . abort ( ) ; <nl> + if ( refs ! = null ) <nl> + refs . release ( ) ; <nl> } <nl> } <nl> <nl> diff - - git a / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java b / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java <nl> index 2126835 . . 3119453 100644 <nl> - - - a / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java <nl> + + + b / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java <nl> @ @ - 255 , 6 + 255 , 20 @ @ public class PendingAntiCompactionTest <nl> result . abort ( ) ; / / releases sstable refs <nl> } <nl> <nl> + @ Test <nl> + public void pendingRepairNoSSTablesExist ( ) throws Exception <nl> + { <nl> + cfs . disableAutoCompaction ( ) ; <nl> + <nl> + Assert . assertEquals ( 0 , cfs . getLiveSSTables ( ) . size ( ) ) ; <nl> + <nl> + PendingAntiCompaction . AcquisitionCallable acquisitionCallable = new PendingAntiCompaction . AcquisitionCallable ( cfs , FULL _ RANGE , UUIDGen . getTimeUUID ( ) ) ; <nl> + PendingAntiCompaction . AcquireResult result = acquisitionCallable . call ( ) ; <nl> + Assert . assertNotNull ( result ) ; <nl> + <nl> + result . abort ( ) ; / / There ' s nothing to release , but we should exit cleanly <nl> + } <nl> + <nl> / * * <nl> * anti compaction task should be submitted if everything is ok <nl> * /
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 630ee2e . . 1f0f0e9 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 10 @ @ <nl> - 1 . 0 - dev <nl> + 1 . 1 - dev <nl> + <nl> + <nl> + 1 . 0 . 1 <nl> + <nl> + <nl> + 1 . 0 <nl> * removed binarymemtable ( CASSANDRA - 2692 ) <nl> * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) <nl> * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 1f6c215 . . 4425aad 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 4 . 0 
 + * NPE in IR cleanup when columnfamily has no sstables ( CASSANDRA - 13585 ) 
 * Fix Randomness of stress values ( CASSANDRA - 12744 ) 
 * Allow selecting Map values and Set elements ( CASSANDRA - 7396 ) 
 * Fast and garbage - free Streaming Histogram ( CASSANDRA - 13444 ) 
 diff - - git a / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java b / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java 
 index dd71537 . . f183d14 100644 
 - - - a / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java 
 + + + b / src / java / org / apache / cassandra / repair / consistent / PendingAntiCompaction . java 
 @ @ - 69 , 8 + 69 , 10 @ @ public class PendingAntiCompaction 
 
 void abort ( ) 
 { 
 - txn . abort ( ) ; 
 - refs . release ( ) ; 
 + if ( txn ! = null ) 
 + txn . abort ( ) ; 
 + if ( refs ! = null ) 
 + refs . release ( ) ; 
 } 
 } 
 
 diff - - git a / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java b / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java 
 index 2126835 . . 3119453 100644 
 - - - a / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java 
 + + + b / test / unit / org / apache / cassandra / repair / consistent / PendingAntiCompactionTest . java 
 @ @ - 255 , 6 + 255 , 20 @ @ public class PendingAntiCompactionTest 
 result . abort ( ) ; / / releases sstable refs 
 } 
 
 + @ Test 
 + public void pendingRepairNoSSTablesExist ( ) throws Exception 
 + { 
 + cfs . disableAutoCompaction ( ) ; 
 + 
 + Assert . assertEquals ( 0 , cfs . getLiveSSTables ( ) . size ( ) ) ; 
 + 
 + PendingAntiCompaction . AcquisitionCallable acquisitionCallable = new PendingAntiCompaction . AcquisitionCallable ( cfs , FULL _ RANGE , UUIDGen . getTimeUUID ( ) ) ; 
 + PendingAntiCompaction . AcquireResult result = acquisitionCallable . call ( ) ; 
 + Assert . assertNotNull ( result ) ; 
 + 
 + result . abort ( ) ; / / There ' s nothing to release , but we should exit cleanly 
 + } 
 + 
 / * * 
 * anti compaction task should be submitted if everything is ok 
 * /

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 630ee2e . . 1f0f0e9 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 10 @ @ 
 - 1 . 0 - dev 
 + 1 . 1 - dev 
 + 
 + 
 + 1 . 0 . 1 
 + 
 + 
 + 1 . 0 
 * removed binarymemtable ( CASSANDRA - 2692 ) 
 * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) 
 * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 )
