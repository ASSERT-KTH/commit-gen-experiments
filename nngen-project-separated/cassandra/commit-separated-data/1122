BLEU SCORE: 0.05522397783539471

TEST MSG: Eliminate the dependency on jgrapht for UDT resolution
GENERATED MSG: use ivy for junit and remove local copy

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index a2951a8 . . e6ab5dd 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 . 3 <nl> + * Eliminate the dependency on jgrapht for UDT resolution ( CASSANDRA - 10653 ) <nl> * ( Hadoop ) Close Clusters and Sessions in Hadoop Input / Output classes ( CASSANDRA - 1837 ) <nl> * Fix sstableloader not working with upper case keyspace name ( CASSANDRA - 10806 ) <nl> Merged from 2 . 2 : <nl> diff - - git a / NOTICE . txt b / NOTICE . txt <nl> index b880183 . . a20994f 100644 <nl> - - - a / NOTICE . txt <nl> + + + b / NOTICE . txt <nl> @ @ - 83 , 7 + 83 , 3 @ @ BSD 3 - clause <nl> ASM <nl> ( http : / / asm . ow2 . org / ) <nl> Copyright ( c ) 2000 - 2011 INRIA , France Telecom <nl> - <nl> - JGraphT <nl> - ( http : / / jgrapht . org ) <nl> - Copyright 2003 - 2015 , by Barak Naveh and Contributors . <nl> diff - - git a / build . xml b / build . xml <nl> index 0420652 . . cab361f 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 392 , 7 + 392 , 6 @ @ <nl> < dependency groupId = " org . mindrot " artifactId = " jbcrypt " version = " 0 . 3m " / > <nl> < dependency groupId = " io . airlift " artifactId = " airline " version = " 0 . 6 " / > <nl> < dependency groupId = " io . netty " artifactId = " netty - all " version = " 4 . 0 . 23 . Final " / > <nl> - < dependency groupId = " org . jgrapht " artifactId = " jgrapht - core " version = " 0 . 9 . 1 " / > <nl> < dependency groupId = " com . google . code . findbugs " artifactId = " jsr305 " version = " 2 . 0 . 2 " / > <nl> < dependency groupId = " com . clearspring . analytics " artifactId = " stream " version = " 2 . 5 . 2 " / > <nl> < ! - - TODO CASSANDRA - 9543 <nl> @ @ - 552 , 7 + 551 , 6 @ @ <nl> < dependency groupId = " com . github . jbellis " artifactId = " jamm " / > <nl> <nl> < dependency groupId = " io . netty " artifactId = " netty - all " / > <nl> - < dependency groupId = " org . jgrapht " artifactId = " jgrapht - core " / > <nl> < dependency groupId = " joda - time " artifactId = " joda - time " / > <nl> < dependency groupId = " org . fusesource " artifactId = " sigar " / > <nl> < dependency groupId = " org . eclipse . jdt . core . compiler " artifactId = " ecj " / > <nl> diff - - git a / lib / jgrapht - core - 0 . 9 . 1 . jar b / lib / jgrapht - core - 0 . 9 . 1 . jar <nl> deleted file mode 100644 <nl> index f491e25 . . 0000000 <nl> Binary files a / lib / jgrapht - core - 0 . 9 . 1 . jar and / dev / null differ <nl> diff - - git a / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt b / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt <nl> deleted file mode 100644 <nl> index 5d80026 . . 0000000 <nl> - - - a / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt <nl> + + + / dev / null <nl> @ @ - 1 , 227 + 0 , 0 @ @ <nl> - Eclipse Public License - v 1 . 0 <nl> - <nl> - THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE <nl> - PUBLIC LICENSE ( " AGREEMENT " ) . ANY USE , REPRODUCTION OR DISTRIBUTION OF <nl> - THE PROGRAM CONSTITUTES RECIPIENT ' S ACCEPTANCE OF THIS AGREEMENT . <nl> - <nl> - 1 . DEFINITIONS <nl> - <nl> - " Contribution " means : <nl> - <nl> - a ) in the case of the initial Contributor , the initial code and <nl> - documentation distributed under this Agreement , and <nl> - <nl> - b ) in the case of each subsequent Contributor : <nl> - <nl> - i ) changes to the Program , and <nl> - <nl> - ii ) additions to the Program ; <nl> - <nl> - where such changes and / or additions to the Program originate from and <nl> - are distributed by that particular Contributor . A Contribution <nl> - ' originates ' from a Contributor if it was added to the Program by such <nl> - Contributor itself or anyone acting on such Contributor ' s behalf . <nl> - Contributions do not include additions to the Program which : ( i ) are <nl> - separate modules of software distributed in conjunction with the <nl> - Program under their own license agreement , and ( ii ) are not derivative <nl> - works of the Program . <nl> - <nl> - " Contributor " means any person or entity that distributes the Program . <nl> - <nl> - " Licensed Patents " mean patent claims licensable by a Contributor which <nl> - are necessarily infringed by the use or sale of its Contribution alone <nl> - or when combined with the Program . <nl> - <nl> - " Program " means the Contributions distributed in accordance with this <nl> - Agreement . <nl> - <nl> - " Recipient " means anyone who receives the Program under this Agreement , <nl> - including all Contributors . <nl> - <nl> - 2 . GRANT OF RIGHTS <nl> - <nl> - a ) Subject to the terms of this Agreement , each Contributor hereby <nl> - grants Recipient a non - exclusive , worldwide , royalty - free copyright <nl> - license to reproduce , prepare derivative works of , publicly display , <nl> - publicly perform , distribute and sublicense the Contribution of such <nl> - Contributor , if any , and such derivative works , in source code and <nl> - object code form . <nl> - <nl> - b ) Subject to the terms of this Agreement , each Contributor hereby <nl> - grants Recipient a non - exclusive , worldwide , royalty - free patent <nl> - license under Licensed Patents to make , use , sell , offer to sell , <nl> - import and otherwise transfer the Contribution of such Contributor , if <nl> - any , in source code and object code form . This patent license shall <nl> - apply to the combination of the Contribution and the Program if , at the <nl> - time the Contribution is added by the Contributor , such addition of the <nl> - Contribution causes such combination to be covered by the Licensed <nl> - Patents . The patent license shall not apply to any other combinations <nl> - which include the Contribution . No hardware per se is licensed <nl> - hereunder . <nl> - <nl> - c ) Recipient understands that although each Contributor grants the <nl> - licenses to its Contributions set forth herein , no assurances are <nl> - provided by any Contributor that the Program does not infringe the <nl> - patent or other intellectual property rights of any other entity . Each <nl> - Contributor disclaims any liability to Recipient for claims brought by <nl> - any other entity based on infringement of intellectual property rights <nl> - or otherwise . As a condition to exercising the rights and licenses <nl> - granted hereunder , each Recipient hereby assumes sole responsibility to <nl> - secure any other intellectual property rights needed , if any . For <nl> - example , if a third party patent license is required to allow Recipient <nl> - to distribute the Program , it is Recipient ' s responsibility to acquire <nl> - that license before distributing the Program . <nl> - <nl> - d ) Each Contributor represents that to its knowledge it has sufficient <nl> - copyright rights in its Contribution , if any , to grant the copyright <nl> - license set forth in this Agreement . <nl> - <nl> - 3 . REQUIREMENTS <nl> - <nl> - A Contributor may choose to distribute the Program in object code form <nl> - under its own license agreement , provided that : <nl> - <nl> - a ) it complies with the terms and conditions of this Agreement ; and <nl> - <nl> - b ) its license agreement : <nl> - <nl> - i ) effectively disclaims on behalf of all Contributors all warranties <nl> - and conditions , express and implied , including warranties or conditions <nl> - of title and non - infringement , and implied warranties or conditions of <nl> - merchantability and fitness for a particular purpose ; <nl> - <nl> - ii ) effectively excludes on behalf of all Contributors all liability <nl> - for damages , including direct , indirect , special , incidental and <nl> - consequential damages , such as lost profits ; <nl> - <nl> - iii ) states that any provisions which differ from this Agreement are <nl> - offered by that Contributor alone and not by any other party ; and <nl> - <nl> - iv ) states that source code for the Program is available from such <nl> - Contributor , and informs licensees how to obtain it in a reasonable <nl> - manner on or through a medium customarily used for software exchange . <nl> - <nl> - When the Program is made available in source code form : <nl> - <nl> - a ) it must be made available under this Agreement ; and <nl> - <nl> - b ) a copy of this Agreement must be included with each copy of the <nl> - Program . <nl> - <nl> - Contributors may not remove or alter any copyright notices contained <nl> - within the Program . <nl> - <nl> - Each Contributor must identify itself as the originator of its <nl> - Contribution , if any , in a manner that reasonably allows subsequent <nl> - Recipients to identify the originator of the Contribution . <nl> - <nl> - 4 . COMMERCIAL DISTRIBUTION <nl> - <nl> - Commercial distributors of software may accept certain responsibilities <nl> - with respect to end users , business partners and the like . While this <nl> - license is intended to facilitate the commercial use of the Program , <nl> - the Contributor who includes the Program in a commercial product <nl> - offering should do so in a manner which does not create potential <nl> - liability for other Contributors . Therefore , if a Contributor includes <nl> - the Program in a commercial product offering , such Contributor <nl> - ( " Commercial Contributor " ) hereby agrees to defend and indemnify every <nl> - other Contributor ( " Indemnified Contributor " ) against any losses , <nl> - damages and costs ( collectively " Losses " ) arising from claims , lawsuits <nl> - and other legal actions brought by a third party against the <nl> - Indemnified Contributor to the extent caused by the acts or omissions <nl> - of such Commercial Contributor in connection with its distribution of <nl> - the Program in a commercial product offering . The obligations in this <nl> - section do not apply to any claims or Losses relating to any actual or <nl> - alleged intellectual property infringement . In order to qualify , an <nl> - Indemnified Contributor must : a ) promptly notify the Commercial <nl> - Contributor in writing of such claim , and b ) allow the Commercial <nl> - Contributor to control , and cooperate with the Commercial Contributor <nl> - in , the defense and any related settlement negotiations . The <nl> - Indemnified Contributor may participate in any such claim at its own <nl> - expense . <nl> - <nl> - For example , a Contributor might include the Program in a commercial <nl> - product offering , Product X . That Contributor is then a Commercial <nl> - Contributor . If that Commercial Contributor then makes performance <nl> - claims , or offers warranties related to Product X , those performance <nl> - claims and warranties are such Commercial Contributor ' s responsibility <nl> - alone . Under this section , the Commercial Contributor would have to <nl> - defend claims against the other Contributors related to those <nl> - performance claims and warranties , and if a court requires any other <nl> - Contributor to pay any damages as a result , the Commercial Contributor <nl> - must pay those damages . <nl> - <nl> - 5 . NO WARRANTY <nl> - <nl> - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , THE PROGRAM IS <nl> - PROVIDED ON AN " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY <nl> - KIND , EITHER EXPRESS OR IMPLIED INCLUDING , WITHOUT LIMITATION , ANY <nl> - WARRANTIES OR CONDITIONS OF TITLE , NON - INFRINGEMENT , MERCHANTABILITY OR <nl> - FITNESS FOR A PARTICULAR PURPOSE . Each Recipient is solely responsible <nl> - for determining the appropriateness of using and distributing the <nl> - Program and assumes all risks associated with its exercise of rights <nl> - under this Agreement , including but not limited to the risks and costs <nl> - of program errors , compliance with applicable laws , damage to or loss <nl> - of data , programs or equipment , and unavailability or interruption of <nl> - operations . <nl> - <nl> - 6 . DISCLAIMER OF LIABILITY <nl> - <nl> - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , NEITHER RECIPIENT NOR <nl> - ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT , INDIRECT , <nl> - INCIDENTAL , SPECIAL , EXEMPLARY , OR CONSEQUENTIAL DAMAGES ( INCLUDING <nl> - WITHOUT LIMITATION LOST PROFITS ) , HOWEVER CAUSED AND ON ANY THEORY OF <nl> - LIABILITY , WHETHER IN CONTRACT , STRICT LIABILITY , OR TORT ( INCLUDING <nl> - NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY OUT OF THE USE OR <nl> - DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED <nl> - HEREUNDER , EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES . <nl> - <nl> - 7 . GENERAL <nl> - <nl> - If any provision of this Agreement is invalid or unenforceable under <nl> - applicable law , it shall not affect the validity or enforceability of <nl> - the remainder of the terms of this Agreement , and without further <nl> - action by the parties hereto , such provision shall be reformed to the <nl> - minimum extent necessary to make such provision valid and enforceable . <nl> - <nl> - If Recipient institutes patent litigation against any entity ( including <nl> - a cross - claim or counterclaim in a lawsuit ) alleging that the Program <nl> - itself ( excluding combinations of the Program with other software or <nl> - hardware ) infringes such Recipient ' s patent ( s ) , then such Recipient ' s <nl> - rights granted under Section 2 ( b ) shall terminate as of the date such <nl> - litigation is filed . <nl> - <nl> - All Recipient ' s rights under this Agreement shall terminate if it fails <nl> - to comply with any of the material terms or conditions of this <nl> - Agreement and does not cure such failure in a reasonable period of time <nl> - after becoming aware of such noncompliance . If all Recipient ' s rights <nl> - under this Agreement terminate , Recipient agrees to cease use and <nl> - distribution of the Program as soon as reasonably practicable . However , <nl> - Recipient ' s obligations under this Agreement and any licenses granted <nl> - by Recipient relating to the Program shall continue and survive . <nl> - <nl> - Everyone is permitted to copy and distribute copies of this Agreement , <nl> - but in order to avoid inconsistency the Agreement is copyrighted and <nl> - may only be modified in the following manner . The Agreement Steward <nl> - reserves the right to publish new versions ( including revisions ) of <nl> - this Agreement from time to time . No one other than the Agreement <nl> - Steward has the right to modify this Agreement . The Eclipse Foundation <nl> - is the initial Agreement Steward . The Eclipse Foundation may assign the <nl> - responsibility to serve as the Agreement Steward to a suitable separate <nl> - entity . Each new version of the Agreement will be given a <nl> - distinguishing version number . The Program ( including Contributions ) <nl> - may always be distributed subject to the version of the Agreement under <nl> - which it was received . In addition , after a new version of the <nl> - Agreement is published , Contributor may elect to distribute the Program <nl> - ( including its Contributions ) under the new version . Except as <nl> - expressly stated in Sections 2 ( a ) and 2 ( b ) above , Recipient receives no <nl> - rights or licenses to the intellectual property of any Contributor <nl> - under this Agreement , whether expressly , by implication , estoppel or <nl> - otherwise . All rights in the Program not expressly granted under this <nl> - Agreement are reserved . <nl> - <nl> - This Agreement is governed by the laws of the State of New York and the <nl> - intellectual property laws of the United States of America . No party to <nl> - this Agreement will bring a legal action under this Agreement more than <nl> - one year after the cause of action arose . Each party waives its rights <nl> - to a jury trial in any resulting litigation . <nl> diff - - git a / src / java / org / apache / cassandra / schema / Types . java b / src / java / org / apache / cassandra / schema / Types . java <nl> index 258be9f . . 1b71364 100644 <nl> - - - a / src / java / org / apache / cassandra / schema / Types . java <nl> + + + b / src / java / org / apache / cassandra / schema / Types . java <nl> @ @ - 22 , 18 + 22 , 19 @ @ import java . util . * ; <nl> <nl> import javax . annotation . Nullable ; <nl> <nl> + import com . google . common . collect . HashMultimap ; <nl> import com . google . common . collect . ImmutableMap ; <nl> import com . google . common . collect . MapDifference ; <nl> import com . google . common . collect . Maps ; <nl> + import com . google . common . collect . Multimap ; <nl> <nl> import org . apache . cassandra . cql3 . CQL3Type ; <nl> import org . apache . cassandra . db . marshal . AbstractType ; <nl> import org . apache . cassandra . db . marshal . UserType ; <nl> + import org . apache . cassandra . exceptions . ConfigurationException ; <nl> import org . apache . cassandra . utils . ByteBufferUtil ; <nl> - import org . jgrapht . graph . DefaultDirectedGraph ; <nl> - import org . jgrapht . graph . DefaultEdge ; <nl> - import org . jgrapht . traverse . TopologicalOrderIterator ; <nl> <nl> + import static java . lang . String . format ; <nl> import static com . google . common . collect . Iterables . filter ; <nl> import static java . util . stream . Collectors . toList ; <nl> import static org . apache . cassandra . utils . ByteBufferUtil . bytes ; <nl> @ @ - 114 , 7 + 115 , 7 @ @ public final class Types implements Iterable < UserType > <nl> public Types with ( UserType type ) <nl> { <nl> if ( get ( type . name ) . isPresent ( ) ) <nl> - throw new IllegalStateException ( String . format ( " Type % s already exists " , type . name ) ) ; <nl> + throw new IllegalStateException ( format ( " Type % s already exists " , type . name ) ) ; <nl> <nl> return builder ( ) . add ( this ) . add ( type ) . build ( ) ; <nl> } <nl> @ @ - 125 , 7 + 126 , 7 @ @ public final class Types implements Iterable < UserType > <nl> public Types without ( ByteBuffer name ) <nl> { <nl> UserType type = <nl> - get ( name ) . orElseThrow ( ( ) - > new IllegalStateException ( String . format ( " Type % s doesn ' t exists " , name ) ) ) ; <nl> + get ( name ) . orElseThrow ( ( ) - > new IllegalStateException ( format ( " Type % s doesn ' t exists " , name ) ) ) ; <nl> <nl> return builder ( ) . add ( filter ( this , t - > t ! = type ) ) . build ( ) ; <nl> } <nl> @ @ - 210 , 27 + 211 , 42 @ @ public final class Types implements Iterable < UserType > <nl> / * <nl> * build a DAG of UDT dependencies <nl> * / <nl> - DefaultDirectedGraph < RawUDT , DefaultEdge > graph = new DefaultDirectedGraph < > ( DefaultEdge . class ) ; <nl> + Map < RawUDT , Integer > vertices = new HashMap < > ( ) ; / / map values are numbers of referenced types <nl> + for ( RawUDT udt : definitions ) <nl> + vertices . put ( udt , 0 ) ; <nl> <nl> - definitions . forEach ( graph : : addVertex ) ; <nl> - <nl> - for ( RawUDT udt1 : definitions ) <nl> + Multimap < RawUDT , RawUDT > adjacencyList = HashMultimap . create ( ) ; <nl> + for ( RawUDT udt1 : definitions ) <nl> for ( RawUDT udt2 : definitions ) <nl> - if ( udt1 ! = udt2 & & udt1 . referencesUserType ( udt2 . name ) ) <nl> - graph . addEdge ( udt2 , udt1 ) ; <nl> + if ( udt1 ! = udt2 & & udt1 . referencesUserType ( udt2 ) ) <nl> + adjacencyList . put ( udt2 , udt1 ) ; <nl> <nl> / * <nl> - * iterate in topological order , <nl> + * resolve dependencies in topological order , using Kahn ' s algorithm <nl> * / <nl> - Types types = new Types ( new HashMap < > ( ) ) ; <nl> + adjacencyList . values ( ) . forEach ( vertex - > vertices . put ( vertex , vertices . get ( vertex ) + 1 ) ) ; <nl> <nl> - TopologicalOrderIterator < RawUDT , DefaultEdge > iterator = new TopologicalOrderIterator < > ( graph ) ; <nl> - while ( iterator . hasNext ( ) ) <nl> + Queue < RawUDT > resolvableTypes = new LinkedList < > ( ) ; / / UDTs with 0 dependencies <nl> + for ( Map . Entry < RawUDT , Integer > entry : vertices . entrySet ( ) ) <nl> + if ( entry . getValue ( ) = = 0 ) <nl> + resolvableTypes . add ( entry . getKey ( ) ) ; <nl> + <nl> + Types types = new Types ( new HashMap < > ( ) ) ; <nl> + while ( ! resolvableTypes . isEmpty ( ) ) <nl> { <nl> - UserType udt = iterator . next ( ) . prepare ( keyspace , types ) ; / / will throw InvalidRequestException if meets an unknown type <nl> + RawUDT vertex = resolvableTypes . remove ( ) ; <nl> + <nl> + for ( RawUDT dependentType : adjacencyList . get ( vertex ) ) <nl> + if ( vertices . replace ( dependentType , vertices . get ( dependentType ) - 1 ) = = 1 ) <nl> + resolvableTypes . add ( dependentType ) ; <nl> + <nl> + UserType udt = vertex . prepare ( keyspace , types ) ; <nl> types . types . put ( udt . name , udt ) ; <nl> } <nl> <nl> + if ( types . types . size ( ) ! = definitions . size ( ) ) <nl> + throw new ConfigurationException ( format ( " Cannot resolve UDTs for keyspace % s : some types are missing " , keyspace ) ) ; <nl> + <nl> / * <nl> * return an immutable copy <nl> * / <nl> @ @ - 260 , 9 + 276 , 9 @ @ public final class Types implements Iterable < UserType > <nl> this . fieldTypes = fieldTypes ; <nl> } <nl> <nl> - boolean referencesUserType ( String typeName ) <nl> + boolean referencesUserType ( RawUDT other ) <nl> { <nl> - return fieldTypes . stream ( ) . anyMatch ( t - > t . referencesUserType ( typeName ) ) ; <nl> + return fieldTypes . stream ( ) . anyMatch ( t - > t . referencesUserType ( other . name ) ) ; <nl> } <nl> <nl> UserType prepare ( String keyspace , Types types ) <nl> @ @ - 279 , 6 + 295 , 18 @ @ public final class Types implements Iterable < UserType > <nl> <nl> return new UserType ( keyspace , bytes ( name ) , preparedFieldNames , preparedFieldTypes ) ; <nl> } <nl> + <nl> + @ Override <nl> + public int hashCode ( ) <nl> + { <nl> + return name . hashCode ( ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public boolean equals ( Object other ) <nl> + { <nl> + return name . equals ( ( ( RawUDT ) other ) . name ) ; <nl> + } <nl> } <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / LICENSE . txt b / LICENSE . txt <nl> index e372f6a . . 0781488 100644 <nl> - - - a / LICENSE . txt <nl> + + + b / LICENSE . txt <nl> @ @ - 280 , 221 + 280 , 3 @ @ be freely reproduced , distributed , transmitted , used , modified , built <nl> upon , or otherwise exploited by anyone for any purpose , commercial or <nl> non - commercial , and in any way , including by methods that have not yet <nl> been invented or conceived . <nl> - <nl> - <nl> - For lib / junit - 4 . 6 . jar : <nl> - - - - - - - - - - - - - - - - - - - - - - - <nl> - <nl> - Common Public License Version 1 . 0 <nl> - <nl> - THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS COMMON PUBLIC <nl> - LICENSE ( " AGREEMENT " ) . ANY USE , REPRODUCTION OR DISTRIBUTION OF THE PROGRAM <nl> - CONSTITUTES RECIPIENT ' S ACCEPTANCE OF THIS AGREEMENT . <nl> - <nl> - 1 . DEFINITIONS <nl> - <nl> - " Contribution " means : <nl> - <nl> - a ) in the case of the initial Contributor , the initial code and <nl> - documentation distributed under this Agreement , and <nl> - <nl> - b ) in the case of each subsequent Contributor : <nl> - <nl> - i ) changes to the Program , and <nl> - <nl> - ii ) additions to the Program ; <nl> - <nl> - where such changes and / or additions to the Program originate from and are <nl> - distributed by that particular Contributor . A Contribution ' originates ' from a <nl> - Contributor if it was added to the Program by such Contributor itself or anyone <nl> - acting on such Contributor ' s behalf . Contributions do not include additions to <nl> - the Program which : ( i ) are separate modules of software distributed in <nl> - conjunction with the Program under their own license agreement , and ( ii ) are not <nl> - derivative works of the Program . <nl> - <nl> - " Contributor " means any person or entity that distributes the Program . <nl> - <nl> - " Licensed Patents " mean patent claims licensable by a Contributor which are <nl> - necessarily infringed by the use or sale of its Contribution alone or when <nl> - combined with the Program . <nl> - <nl> - " Program " means the Contributions distributed in accordance with this Agreement . <nl> - <nl> - " Recipient " means anyone who receives the Program under this Agreement , <nl> - including all Contributors . <nl> - <nl> - 2 . GRANT OF RIGHTS <nl> - <nl> - a ) Subject to the terms of this Agreement , each Contributor hereby grants <nl> - Recipient a non - exclusive , worldwide , royalty - free copyright license to <nl> - reproduce , prepare derivative works of , publicly display , publicly perform , <nl> - distribute and sublicense the Contribution of such Contributor , if any , and such <nl> - derivative works , in source code and object code form . <nl> - <nl> - b ) Subject to the terms of this Agreement , each Contributor hereby grants <nl> - Recipient a non - exclusive , worldwide , royalty - free patent license under Licensed <nl> - Patents to make , use , sell , offer to sell , import and otherwise transfer the <nl> - Contribution of such Contributor , if any , in source code and object code form . <nl> - This patent license shall apply to the combination of the Contribution and the <nl> - Program if , at the time the Contribution is added by the Contributor , such <nl> - addition of the Contribution causes such combination to be covered by the <nl> - Licensed Patents . The patent license shall not apply to any other combinations <nl> - which include the Contribution . No hardware per se is licensed hereunder . <nl> - <nl> - c ) Recipient understands that although each Contributor grants the licenses <nl> - to its Contributions set forth herein , no assurances are provided by any <nl> - Contributor that the Program does not infringe the patent or other intellectual <nl> - property rights of any other entity . Each Contributor disclaims any liability to <nl> - Recipient for claims brought by any other entity based on infringement of <nl> - intellectual property rights or otherwise . As a condition to exercising the <nl> - rights and licenses granted hereunder , each Recipient hereby assumes sole <nl> - responsibility to secure any other intellectual property rights needed , if any . <nl> - For example , if a third party patent license is required to allow Recipient to <nl> - distribute the Program , it is Recipient ' s responsibility to acquire that license <nl> - before distributing the Program . <nl> - <nl> - d ) Each Contributor represents that to its knowledge it has sufficient <nl> - copyright rights in its Contribution , if any , to grant the copyright license set <nl> - forth in this Agreement . <nl> - <nl> - 3 . REQUIREMENTS <nl> - <nl> - A Contributor may choose to distribute the Program in object code form under its <nl> - own license agreement , provided that : <nl> - <nl> - a ) it complies with the terms and conditions of this Agreement ; and <nl> - <nl> - b ) its license agreement : <nl> - <nl> - i ) effectively disclaims on behalf of all Contributors all warranties and <nl> - conditions , express and implied , including warranties or conditions of title and <nl> - non - infringement , and implied warranties or conditions of merchantability and <nl> - fitness for a particular purpose ; <nl> - <nl> - ii ) effectively excludes on behalf of all Contributors all liability for <nl> - damages , including direct , indirect , special , incidental and consequential <nl> - damages , such as lost profits ; <nl> - <nl> - iii ) states that any provisions which differ from this Agreement are offered <nl> - by that Contributor alone and not by any other party ; and <nl> - <nl> - iv ) states that source code for the Program is available from such <nl> - Contributor , and informs licensees how to obtain it in a reasonable manner on or <nl> - through a medium customarily used for software exchange . <nl> - <nl> - When the Program is made available in source code form : <nl> - <nl> - a ) it must be made available under this Agreement ; and <nl> - <nl> - b ) a copy of this Agreement must be included with each copy of the Program . <nl> - <nl> - Contributors may not remove or alter any copyright notices contained within the <nl> - Program . <nl> - <nl> - Each Contributor must identify itself as the originator of its Contribution , if <nl> - any , in a manner that reasonably allows subsequent Recipients to identify the <nl> - originator of the Contribution . <nl> - <nl> - 4 . COMMERCIAL DISTRIBUTION <nl> - <nl> - Commercial distributors of software may accept certain responsibilities with <nl> - respect to end users , business partners and the like . While this license is <nl> - intended to facilitate the commercial use of the Program , the Contributor who <nl> - includes the Program in a commercial product offering should do so in a manner <nl> - which does not create potential liability for other Contributors . Therefore , if <nl> - a Contributor includes the Program in a commercial product offering , such <nl> - Contributor ( " Commercial Contributor " ) hereby agrees to defend and indemnify <nl> - every other Contributor ( " Indemnified Contributor " ) against any losses , damages <nl> - and costs ( collectively " Losses " ) arising from claims , lawsuits and other legal <nl> - actions brought by a third party against the Indemnified Contributor to the <nl> - extent caused by the acts or omissions of such Commercial Contributor in <nl> - connection with its distribution of the Program in a commercial product <nl> - offering . The obligations in this section do not apply to any claims or Losses <nl> - relating to any actual or alleged intellectual property infringement . In order <nl> - to qualify , an Indemnified Contributor must : a ) promptly notify the Commercial <nl> - Contributor in writing of such claim , and b ) allow the Commercial Contributor to <nl> - control , and cooperate with the Commercial Contributor in , the defense and any <nl> - related settlement negotiations . The Indemnified Contributor may participate in <nl> - any such claim at its own expense . <nl> - <nl> - For example , a Contributor might include the Program in a commercial product <nl> - offering , Product X . That Contributor is then a Commercial Contributor . If that <nl> - Commercial Contributor then makes performance claims , or offers warranties <nl> - related to Product X , those performance claims and warranties are such <nl> - Commercial Contributor ' s responsibility alone . Under this section , the <nl> - Commercial Contributor would have to defend claims against the other <nl> - Contributors related to those performance claims and warranties , and if a court <nl> - requires any other Contributor to pay any damages as a result , the Commercial <nl> - Contributor must pay those damages . <nl> - <nl> - 5 . NO WARRANTY <nl> - <nl> - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , THE PROGRAM IS PROVIDED ON AN <nl> - " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , EITHER EXPRESS OR <nl> - IMPLIED INCLUDING , WITHOUT LIMITATION , ANY WARRANTIES OR CONDITIONS OF TITLE , <nl> - NON - INFRINGEMENT , MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE . Each <nl> - Recipient is solely responsible for determining the appropriateness of using and <nl> - distributing the Program and assumes all risks associated with its exercise of <nl> - rights under this Agreement , including but not limited to the risks and costs of <nl> - program errors , compliance with applicable laws , damage to or loss of data , <nl> - programs or equipment , and unavailability or interruption of operations . <nl> - <nl> - 6 . DISCLAIMER OF LIABILITY <nl> - <nl> - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , NEITHER RECIPIENT NOR ANY <nl> - CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT , INDIRECT , INCIDENTAL , <nl> - SPECIAL , EXEMPLARY , OR CONSEQUENTIAL DAMAGES ( INCLUDING WITHOUT LIMITATION LOST <nl> - PROFITS ) , HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY , WHETHER IN CONTRACT , <nl> - STRICT LIABILITY , OR TORT ( INCLUDING NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY <nl> - OUT OF THE USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS <nl> - GRANTED HEREUNDER , EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES . <nl> - <nl> - 7 . GENERAL <nl> - <nl> - If any provision of this Agreement is invalid or unenforceable under applicable <nl> - law , it shall not affect the validity or enforceability of the remainder of the <nl> - terms of this Agreement , and without further action by the parties hereto , such <nl> - provision shall be reformed to the minimum extent necessary to make such <nl> - provision valid and enforceable . <nl> - <nl> - If Recipient institutes patent litigation against a Contributor with respect to <nl> - a patent applicable to software ( including a cross - claim or counterclaim in a <nl> - lawsuit ) , then any patent licenses granted by that Contributor to such Recipient <nl> - under this Agreement shall terminate as of the date such litigation is filed . In <nl> - addition , if Recipient institutes patent litigation against any entity <nl> - ( including a cross - claim or counterclaim in a lawsuit ) alleging that the Program <nl> - itself ( excluding combinations of the Program with other software or hardware ) <nl> - infringes such Recipient ' s patent ( s ) , then such Recipient ' s rights granted under <nl> - Section 2 ( b ) shall terminate as of the date such litigation is filed . <nl> - <nl> - All Recipient ' s rights under this Agreement shall terminate if it fails to <nl> - comply with any of the material terms or conditions of this Agreement and does <nl> - not cure such failure in a reasonable period of time after becoming aware of <nl> - such noncompliance . If all Recipient ' s rights under this Agreement terminate , <nl> - Recipient agrees to cease use and distribution of the Program as soon as <nl> - reasonably practicable . However , Recipient ' s obligations under this Agreement <nl> - and any licenses granted by Recipient relating to the Program shall continue and <nl> - survive . <nl> - <nl> - Everyone is permitted to copy and distribute copies of this Agreement , but in <nl> - order to avoid inconsistency the Agreement is copyrighted and may only be <nl> - modified in the following manner . The Agreement Steward reserves the right to <nl> - publish new versions ( including revisions ) of this Agreement from time to time . <nl> - No one other than the Agreement Steward has the right to modify this Agreement . <nl> - IBM is the initial Agreement Steward . IBM may assign the responsibility to serve <nl> - as the Agreement Steward to a suitable separate entity . Each new version of the <nl> - Agreement will be given a distinguishing version number . The Program ( including <nl> - Contributions ) may always be distributed subject to the version of the Agreement <nl> - under which it was received . In addition , after a new version of the Agreement <nl> - is published , Contributor may elect to distribute the Program ( including its <nl> - Contributions ) under the new version . Except as expressly stated in Sections <nl> - 2 ( a ) and 2 ( b ) above , Recipient receives no rights or licenses to the <nl> - intellectual property of any Contributor under this Agreement , whether <nl> - expressly , by implication , estoppel or otherwise . All rights in the Program not <nl> - expressly granted under this Agreement are reserved . <nl> - <nl> - This Agreement is governed by the laws of the State of New York and the <nl> - intellectual property laws of the United States of America . No party to this <nl> - Agreement will bring a legal action under this Agreement more than one year <nl> - after the cause of action arose . Each party waives its rights to a jury trial in <nl> - any resulting litigation . <nl> diff - - git a / NOTICE . txt b / NOTICE . txt <nl> index 852cedb . . 7d98c34 100644 <nl> - - - a / NOTICE . txt <nl> + + + b / NOTICE . txt <nl> @ @ - 11 , 8 + 11 , 6 @ @ Some alternate data structures provided by high - scale - lib from <nl> http : / / sourceforge . net / projects / high - scale - lib / . <nl> Written by Cliff Click and released as Public Domain . <nl> <nl> - This product makes use of the JUnit test framework ( http : / / junit . org ) . <nl> - <nl> Some alternate data structures provided by concurrentlinkedhashmap <nl> from http : / / code . google . com / p / concurrentlinkedhashmap / . <nl> Copyright 2009 Benjamin Manes <nl> diff - - git a / ivy . xml b / ivy . xml <nl> index b548940 . . 676283e 100644 <nl> - - - a / ivy . xml <nl> + + + b / ivy . xml <nl> @ @ - 41 , 6 + 41 , 7 @ @ <nl> < dependency org = " org . slf4j " name = " slf4j - api " rev = " 1 . 5 . 8 " / > <nl> < dependency org = " org . slf4j " name = " slf4j - log4j12 " rev = " 1 . 5 . 8 " / > <nl> < dependency org = " com . googlecode . json - simple " name = " json - simple " rev = " 1 . 1 " / > <nl> + < dependency org = " junit " name = " junit " rev = " 4 . 6 " / > <nl> < / dependencies > <nl> < / ivy - module > <nl> <nl> diff - - git a / lib / junit - 4 . 6 . jar b / lib / junit - 4 . 6 . jar <nl> deleted file mode 100644 <nl> index 00770a4 . . 0000000 <nl> Binary files a / lib / junit - 4 . 6 . jar and / dev / null differ

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index a2951a8 . . e6ab5dd 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 . 3 
 + * Eliminate the dependency on jgrapht for UDT resolution ( CASSANDRA - 10653 ) 
 * ( Hadoop ) Close Clusters and Sessions in Hadoop Input / Output classes ( CASSANDRA - 1837 ) 
 * Fix sstableloader not working with upper case keyspace name ( CASSANDRA - 10806 ) 
 Merged from 2 . 2 : 
 diff - - git a / NOTICE . txt b / NOTICE . txt 
 index b880183 . . a20994f 100644 
 - - - a / NOTICE . txt 
 + + + b / NOTICE . txt 
 @ @ - 83 , 7 + 83 , 3 @ @ BSD 3 - clause 
 ASM 
 ( http : / / asm . ow2 . org / ) 
 Copyright ( c ) 2000 - 2011 INRIA , France Telecom 
 - 
 - JGraphT 
 - ( http : / / jgrapht . org ) 
 - Copyright 2003 - 2015 , by Barak Naveh and Contributors . 
 diff - - git a / build . xml b / build . xml 
 index 0420652 . . cab361f 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 392 , 7 + 392 , 6 @ @ 
 < dependency groupId = " org . mindrot " artifactId = " jbcrypt " version = " 0 . 3m " / > 
 < dependency groupId = " io . airlift " artifactId = " airline " version = " 0 . 6 " / > 
 < dependency groupId = " io . netty " artifactId = " netty - all " version = " 4 . 0 . 23 . Final " / > 
 - < dependency groupId = " org . jgrapht " artifactId = " jgrapht - core " version = " 0 . 9 . 1 " / > 
 < dependency groupId = " com . google . code . findbugs " artifactId = " jsr305 " version = " 2 . 0 . 2 " / > 
 < dependency groupId = " com . clearspring . analytics " artifactId = " stream " version = " 2 . 5 . 2 " / > 
 < ! - - TODO CASSANDRA - 9543 
 @ @ - 552 , 7 + 551 , 6 @ @ 
 < dependency groupId = " com . github . jbellis " artifactId = " jamm " / > 
 
 < dependency groupId = " io . netty " artifactId = " netty - all " / > 
 - < dependency groupId = " org . jgrapht " artifactId = " jgrapht - core " / > 
 < dependency groupId = " joda - time " artifactId = " joda - time " / > 
 < dependency groupId = " org . fusesource " artifactId = " sigar " / > 
 < dependency groupId = " org . eclipse . jdt . core . compiler " artifactId = " ecj " / > 
 diff - - git a / lib / jgrapht - core - 0 . 9 . 1 . jar b / lib / jgrapht - core - 0 . 9 . 1 . jar 
 deleted file mode 100644 
 index f491e25 . . 0000000 
 Binary files a / lib / jgrapht - core - 0 . 9 . 1 . jar and / dev / null differ 
 diff - - git a / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt b / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt 
 deleted file mode 100644 
 index 5d80026 . . 0000000 
 - - - a / lib / licenses / jgrapht - core - 0 . 9 . 1 . txt 
 + + + / dev / null 
 @ @ - 1 , 227 + 0 , 0 @ @ 
 - Eclipse Public License - v 1 . 0 
 - 
 - THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS ECLIPSE 
 - PUBLIC LICENSE ( " AGREEMENT " ) . ANY USE , REPRODUCTION OR DISTRIBUTION OF 
 - THE PROGRAM CONSTITUTES RECIPIENT ' S ACCEPTANCE OF THIS AGREEMENT . 
 - 
 - 1 . DEFINITIONS 
 - 
 - " Contribution " means : 
 - 
 - a ) in the case of the initial Contributor , the initial code and 
 - documentation distributed under this Agreement , and 
 - 
 - b ) in the case of each subsequent Contributor : 
 - 
 - i ) changes to the Program , and 
 - 
 - ii ) additions to the Program ; 
 - 
 - where such changes and / or additions to the Program originate from and 
 - are distributed by that particular Contributor . A Contribution 
 - ' originates ' from a Contributor if it was added to the Program by such 
 - Contributor itself or anyone acting on such Contributor ' s behalf . 
 - Contributions do not include additions to the Program which : ( i ) are 
 - separate modules of software distributed in conjunction with the 
 - Program under their own license agreement , and ( ii ) are not derivative 
 - works of the Program . 
 - 
 - " Contributor " means any person or entity that distributes the Program . 
 - 
 - " Licensed Patents " mean patent claims licensable by a Contributor which 
 - are necessarily infringed by the use or sale of its Contribution alone 
 - or when combined with the Program . 
 - 
 - " Program " means the Contributions distributed in accordance with this 
 - Agreement . 
 - 
 - " Recipient " means anyone who receives the Program under this Agreement , 
 - including all Contributors . 
 - 
 - 2 . GRANT OF RIGHTS 
 - 
 - a ) Subject to the terms of this Agreement , each Contributor hereby 
 - grants Recipient a non - exclusive , worldwide , royalty - free copyright 
 - license to reproduce , prepare derivative works of , publicly display , 
 - publicly perform , distribute and sublicense the Contribution of such 
 - Contributor , if any , and such derivative works , in source code and 
 - object code form . 
 - 
 - b ) Subject to the terms of this Agreement , each Contributor hereby 
 - grants Recipient a non - exclusive , worldwide , royalty - free patent 
 - license under Licensed Patents to make , use , sell , offer to sell , 
 - import and otherwise transfer the Contribution of such Contributor , if 
 - any , in source code and object code form . This patent license shall 
 - apply to the combination of the Contribution and the Program if , at the 
 - time the Contribution is added by the Contributor , such addition of the 
 - Contribution causes such combination to be covered by the Licensed 
 - Patents . The patent license shall not apply to any other combinations 
 - which include the Contribution . No hardware per se is licensed 
 - hereunder . 
 - 
 - c ) Recipient understands that although each Contributor grants the 
 - licenses to its Contributions set forth herein , no assurances are 
 - provided by any Contributor that the Program does not infringe the 
 - patent or other intellectual property rights of any other entity . Each 
 - Contributor disclaims any liability to Recipient for claims brought by 
 - any other entity based on infringement of intellectual property rights 
 - or otherwise . As a condition to exercising the rights and licenses 
 - granted hereunder , each Recipient hereby assumes sole responsibility to 
 - secure any other intellectual property rights needed , if any . For 
 - example , if a third party patent license is required to allow Recipient 
 - to distribute the Program , it is Recipient ' s responsibility to acquire 
 - that license before distributing the Program . 
 - 
 - d ) Each Contributor represents that to its knowledge it has sufficient 
 - copyright rights in its Contribution , if any , to grant the copyright 
 - license set forth in this Agreement . 
 - 
 - 3 . REQUIREMENTS 
 - 
 - A Contributor may choose to distribute the Program in object code form 
 - under its own license agreement , provided that : 
 - 
 - a ) it complies with the terms and conditions of this Agreement ; and 
 - 
 - b ) its license agreement : 
 - 
 - i ) effectively disclaims on behalf of all Contributors all warranties 
 - and conditions , express and implied , including warranties or conditions 
 - of title and non - infringement , and implied warranties or conditions of 
 - merchantability and fitness for a particular purpose ; 
 - 
 - ii ) effectively excludes on behalf of all Contributors all liability 
 - for damages , including direct , indirect , special , incidental and 
 - consequential damages , such as lost profits ; 
 - 
 - iii ) states that any provisions which differ from this Agreement are 
 - offered by that Contributor alone and not by any other party ; and 
 - 
 - iv ) states that source code for the Program is available from such 
 - Contributor , and informs licensees how to obtain it in a reasonable 
 - manner on or through a medium customarily used for software exchange . 
 - 
 - When the Program is made available in source code form : 
 - 
 - a ) it must be made available under this Agreement ; and 
 - 
 - b ) a copy of this Agreement must be included with each copy of the 
 - Program . 
 - 
 - Contributors may not remove or alter any copyright notices contained 
 - within the Program . 
 - 
 - Each Contributor must identify itself as the originator of its 
 - Contribution , if any , in a manner that reasonably allows subsequent 
 - Recipients to identify the originator of the Contribution . 
 - 
 - 4 . COMMERCIAL DISTRIBUTION 
 - 
 - Commercial distributors of software may accept certain responsibilities 
 - with respect to end users , business partners and the like . While this 
 - license is intended to facilitate the commercial use of the Program , 
 - the Contributor who includes the Program in a commercial product 
 - offering should do so in a manner which does not create potential 
 - liability for other Contributors . Therefore , if a Contributor includes 
 - the Program in a commercial product offering , such Contributor 
 - ( " Commercial Contributor " ) hereby agrees to defend and indemnify every 
 - other Contributor ( " Indemnified Contributor " ) against any losses , 
 - damages and costs ( collectively " Losses " ) arising from claims , lawsuits 
 - and other legal actions brought by a third party against the 
 - Indemnified Contributor to the extent caused by the acts or omissions 
 - of such Commercial Contributor in connection with its distribution of 
 - the Program in a commercial product offering . The obligations in this 
 - section do not apply to any claims or Losses relating to any actual or 
 - alleged intellectual property infringement . In order to qualify , an 
 - Indemnified Contributor must : a ) promptly notify the Commercial 
 - Contributor in writing of such claim , and b ) allow the Commercial 
 - Contributor to control , and cooperate with the Commercial Contributor 
 - in , the defense and any related settlement negotiations . The 
 - Indemnified Contributor may participate in any such claim at its own 
 - expense . 
 - 
 - For example , a Contributor might include the Program in a commercial 
 - product offering , Product X . That Contributor is then a Commercial 
 - Contributor . If that Commercial Contributor then makes performance 
 - claims , or offers warranties related to Product X , those performance 
 - claims and warranties are such Commercial Contributor ' s responsibility 
 - alone . Under this section , the Commercial Contributor would have to 
 - defend claims against the other Contributors related to those 
 - performance claims and warranties , and if a court requires any other 
 - Contributor to pay any damages as a result , the Commercial Contributor 
 - must pay those damages . 
 - 
 - 5 . NO WARRANTY 
 - 
 - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , THE PROGRAM IS 
 - PROVIDED ON AN " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY 
 - KIND , EITHER EXPRESS OR IMPLIED INCLUDING , WITHOUT LIMITATION , ANY 
 - WARRANTIES OR CONDITIONS OF TITLE , NON - INFRINGEMENT , MERCHANTABILITY OR 
 - FITNESS FOR A PARTICULAR PURPOSE . Each Recipient is solely responsible 
 - for determining the appropriateness of using and distributing the 
 - Program and assumes all risks associated with its exercise of rights 
 - under this Agreement , including but not limited to the risks and costs 
 - of program errors , compliance with applicable laws , damage to or loss 
 - of data , programs or equipment , and unavailability or interruption of 
 - operations . 
 - 
 - 6 . DISCLAIMER OF LIABILITY 
 - 
 - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , NEITHER RECIPIENT NOR 
 - ANY CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT , INDIRECT , 
 - INCIDENTAL , SPECIAL , EXEMPLARY , OR CONSEQUENTIAL DAMAGES ( INCLUDING 
 - WITHOUT LIMITATION LOST PROFITS ) , HOWEVER CAUSED AND ON ANY THEORY OF 
 - LIABILITY , WHETHER IN CONTRACT , STRICT LIABILITY , OR TORT ( INCLUDING 
 - NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY OUT OF THE USE OR 
 - DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS GRANTED 
 - HEREUNDER , EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES . 
 - 
 - 7 . GENERAL 
 - 
 - If any provision of this Agreement is invalid or unenforceable under 
 - applicable law , it shall not affect the validity or enforceability of 
 - the remainder of the terms of this Agreement , and without further 
 - action by the parties hereto , such provision shall be reformed to the 
 - minimum extent necessary to make such provision valid and enforceable . 
 - 
 - If Recipient institutes patent litigation against any entity ( including 
 - a cross - claim or counterclaim in a lawsuit ) alleging that the Program 
 - itself ( excluding combinations of the Program with other software or 
 - hardware ) infringes such Recipient ' s patent ( s ) , then such Recipient ' s 
 - rights granted under Section 2 ( b ) shall terminate as of the date such 
 - litigation is filed . 
 - 
 - All Recipient ' s rights under this Agreement shall terminate if it fails 
 - to comply with any of the material terms or conditions of this 
 - Agreement and does not cure such failure in a reasonable period of time 
 - after becoming aware of such noncompliance . If all Recipient ' s rights 
 - under this Agreement terminate , Recipient agrees to cease use and 
 - distribution of the Program as soon as reasonably practicable . However , 
 - Recipient ' s obligations under this Agreement and any licenses granted 
 - by Recipient relating to the Program shall continue and survive . 
 - 
 - Everyone is permitted to copy and distribute copies of this Agreement , 
 - but in order to avoid inconsistency the Agreement is copyrighted and 
 - may only be modified in the following manner . The Agreement Steward 
 - reserves the right to publish new versions ( including revisions ) of 
 - this Agreement from time to time . No one other than the Agreement 
 - Steward has the right to modify this Agreement . The Eclipse Foundation 
 - is the initial Agreement Steward . The Eclipse Foundation may assign the 
 - responsibility to serve as the Agreement Steward to a suitable separate 
 - entity . Each new version of the Agreement will be given a 
 - distinguishing version number . The Program ( including Contributions ) 
 - may always be distributed subject to the version of the Agreement under 
 - which it was received . In addition , after a new version of the 
 - Agreement is published , Contributor may elect to distribute the Program 
 - ( including its Contributions ) under the new version . Except as 
 - expressly stated in Sections 2 ( a ) and 2 ( b ) above , Recipient receives no 
 - rights or licenses to the intellectual property of any Contributor 
 - under this Agreement , whether expressly , by implication , estoppel or 
 - otherwise . All rights in the Program not expressly granted under this 
 - Agreement are reserved . 
 - 
 - This Agreement is governed by the laws of the State of New York and the 
 - intellectual property laws of the United States of America . No party to 
 - this Agreement will bring a legal action under this Agreement more than 
 - one year after the cause of action arose . Each party waives its rights 
 - to a jury trial in any resulting litigation . 
 diff - - git a / src / java / org / apache / cassandra / schema / Types . java b / src / java / org / apache / cassandra / schema / Types . java 
 index 258be9f . . 1b71364 100644 
 - - - a / src / java / org / apache / cassandra / schema / Types . java 
 + + + b / src / java / org / apache / cassandra / schema / Types . java 
 @ @ - 22 , 18 + 22 , 19 @ @ import java . util . * ; 
 
 import javax . annotation . Nullable ; 
 
 + import com . google . common . collect . HashMultimap ; 
 import com . google . common . collect . ImmutableMap ; 
 import com . google . common . collect . MapDifference ; 
 import com . google . common . collect . Maps ; 
 + import com . google . common . collect . Multimap ; 
 
 import org . apache . cassandra . cql3 . CQL3Type ; 
 import org . apache . cassandra . db . marshal . AbstractType ; 
 import org . apache . cassandra . db . marshal . UserType ; 
 + import org . apache . cassandra . exceptions . ConfigurationException ; 
 import org . apache . cassandra . utils . ByteBufferUtil ; 
 - import org . jgrapht . graph . DefaultDirectedGraph ; 
 - import org . jgrapht . graph . DefaultEdge ; 
 - import org . jgrapht . traverse . TopologicalOrderIterator ; 
 
 + import static java . lang . String . format ; 
 import static com . google . common . collect . Iterables . filter ; 
 import static java . util . stream . Collectors . toList ; 
 import static org . apache . cassandra . utils . ByteBufferUtil . bytes ; 
 @ @ - 114 , 7 + 115 , 7 @ @ public final class Types implements Iterable < UserType > 
 public Types with ( UserType type ) 
 { 
 if ( get ( type . name ) . isPresent ( ) ) 
 - throw new IllegalStateException ( String . format ( " Type % s already exists " , type . name ) ) ; 
 + throw new IllegalStateException ( format ( " Type % s already exists " , type . name ) ) ; 
 
 return builder ( ) . add ( this ) . add ( type ) . build ( ) ; 
 } 
 @ @ - 125 , 7 + 126 , 7 @ @ public final class Types implements Iterable < UserType > 
 public Types without ( ByteBuffer name ) 
 { 
 UserType type = 
 - get ( name ) . orElseThrow ( ( ) - > new IllegalStateException ( String . format ( " Type % s doesn ' t exists " , name ) ) ) ; 
 + get ( name ) . orElseThrow ( ( ) - > new IllegalStateException ( format ( " Type % s doesn ' t exists " , name ) ) ) ; 
 
 return builder ( ) . add ( filter ( this , t - > t ! = type ) ) . build ( ) ; 
 } 
 @ @ - 210 , 27 + 211 , 42 @ @ public final class Types implements Iterable < UserType > 
 / * 
 * build a DAG of UDT dependencies 
 * / 
 - DefaultDirectedGraph < RawUDT , DefaultEdge > graph = new DefaultDirectedGraph < > ( DefaultEdge . class ) ; 
 + Map < RawUDT , Integer > vertices = new HashMap < > ( ) ; / / map values are numbers of referenced types 
 + for ( RawUDT udt : definitions ) 
 + vertices . put ( udt , 0 ) ; 
 
 - definitions . forEach ( graph : : addVertex ) ; 
 - 
 - for ( RawUDT udt1 : definitions ) 
 + Multimap < RawUDT , RawUDT > adjacencyList = HashMultimap . create ( ) ; 
 + for ( RawUDT udt1 : definitions ) 
 for ( RawUDT udt2 : definitions ) 
 - if ( udt1 ! = udt2 & & udt1 . referencesUserType ( udt2 . name ) ) 
 - graph . addEdge ( udt2 , udt1 ) ; 
 + if ( udt1 ! = udt2 & & udt1 . referencesUserType ( udt2 ) ) 
 + adjacencyList . put ( udt2 , udt1 ) ; 
 
 / * 
 - * iterate in topological order , 
 + * resolve dependencies in topological order , using Kahn ' s algorithm 
 * / 
 - Types types = new Types ( new HashMap < > ( ) ) ; 
 + adjacencyList . values ( ) . forEach ( vertex - > vertices . put ( vertex , vertices . get ( vertex ) + 1 ) ) ; 
 
 - TopologicalOrderIterator < RawUDT , DefaultEdge > iterator = new TopologicalOrderIterator < > ( graph ) ; 
 - while ( iterator . hasNext ( ) ) 
 + Queue < RawUDT > resolvableTypes = new LinkedList < > ( ) ; / / UDTs with 0 dependencies 
 + for ( Map . Entry < RawUDT , Integer > entry : vertices . entrySet ( ) ) 
 + if ( entry . getValue ( ) = = 0 ) 
 + resolvableTypes . add ( entry . getKey ( ) ) ; 
 + 
 + Types types = new Types ( new HashMap < > ( ) ) ; 
 + while ( ! resolvableTypes . isEmpty ( ) ) 
 { 
 - UserType udt = iterator . next ( ) . prepare ( keyspace , types ) ; / / will throw InvalidRequestException if meets an unknown type 
 + RawUDT vertex = resolvableTypes . remove ( ) ; 
 + 
 + for ( RawUDT dependentType : adjacencyList . get ( vertex ) ) 
 + if ( vertices . replace ( dependentType , vertices . get ( dependentType ) - 1 ) = = 1 ) 
 + resolvableTypes . add ( dependentType ) ; 
 + 
 + UserType udt = vertex . prepare ( keyspace , types ) ; 
 types . types . put ( udt . name , udt ) ; 
 } 
 
 + if ( types . types . size ( ) ! = definitions . size ( ) ) 
 + throw new ConfigurationException ( format ( " Cannot resolve UDTs for keyspace % s : some types are missing " , keyspace ) ) ; 
 + 
 / * 
 * return an immutable copy 
 * / 
 @ @ - 260 , 9 + 276 , 9 @ @ public final class Types implements Iterable < UserType > 
 this . fieldTypes = fieldTypes ; 
 } 
 
 - boolean referencesUserType ( String typeName ) 
 + boolean referencesUserType ( RawUDT other ) 
 { 
 - return fieldTypes . stream ( ) . anyMatch ( t - > t . referencesUserType ( typeName ) ) ; 
 + return fieldTypes . stream ( ) . anyMatch ( t - > t . referencesUserType ( other . name ) ) ; 
 } 
 
 UserType prepare ( String keyspace , Types types ) 
 @ @ - 279 , 6 + 295 , 18 @ @ public final class Types implements Iterable < UserType > 
 
 return new UserType ( keyspace , bytes ( name ) , preparedFieldNames , preparedFieldTypes ) ; 
 } 
 + 
 + @ Override 
 + public int hashCode ( ) 
 + { 
 + return name . hashCode ( ) ; 
 + } 
 + 
 + @ Override 
 + public boolean equals ( Object other ) 
 + { 
 + return name . equals ( ( ( RawUDT ) other ) . name ) ; 
 + } 
 } 
 } 
 }

NEAREST DIFF:
diff - - git a / LICENSE . txt b / LICENSE . txt 
 index e372f6a . . 0781488 100644 
 - - - a / LICENSE . txt 
 + + + b / LICENSE . txt 
 @ @ - 280 , 221 + 280 , 3 @ @ be freely reproduced , distributed , transmitted , used , modified , built 
 upon , or otherwise exploited by anyone for any purpose , commercial or 
 non - commercial , and in any way , including by methods that have not yet 
 been invented or conceived . 
 - 
 - 
 - For lib / junit - 4 . 6 . jar : 
 - - - - - - - - - - - - - - - - - - - - - - - 
 - 
 - Common Public License Version 1 . 0 
 - 
 - THE ACCOMPANYING PROGRAM IS PROVIDED UNDER THE TERMS OF THIS COMMON PUBLIC 
 - LICENSE ( " AGREEMENT " ) . ANY USE , REPRODUCTION OR DISTRIBUTION OF THE PROGRAM 
 - CONSTITUTES RECIPIENT ' S ACCEPTANCE OF THIS AGREEMENT . 
 - 
 - 1 . DEFINITIONS 
 - 
 - " Contribution " means : 
 - 
 - a ) in the case of the initial Contributor , the initial code and 
 - documentation distributed under this Agreement , and 
 - 
 - b ) in the case of each subsequent Contributor : 
 - 
 - i ) changes to the Program , and 
 - 
 - ii ) additions to the Program ; 
 - 
 - where such changes and / or additions to the Program originate from and are 
 - distributed by that particular Contributor . A Contribution ' originates ' from a 
 - Contributor if it was added to the Program by such Contributor itself or anyone 
 - acting on such Contributor ' s behalf . Contributions do not include additions to 
 - the Program which : ( i ) are separate modules of software distributed in 
 - conjunction with the Program under their own license agreement , and ( ii ) are not 
 - derivative works of the Program . 
 - 
 - " Contributor " means any person or entity that distributes the Program . 
 - 
 - " Licensed Patents " mean patent claims licensable by a Contributor which are 
 - necessarily infringed by the use or sale of its Contribution alone or when 
 - combined with the Program . 
 - 
 - " Program " means the Contributions distributed in accordance with this Agreement . 
 - 
 - " Recipient " means anyone who receives the Program under this Agreement , 
 - including all Contributors . 
 - 
 - 2 . GRANT OF RIGHTS 
 - 
 - a ) Subject to the terms of this Agreement , each Contributor hereby grants 
 - Recipient a non - exclusive , worldwide , royalty - free copyright license to 
 - reproduce , prepare derivative works of , publicly display , publicly perform , 
 - distribute and sublicense the Contribution of such Contributor , if any , and such 
 - derivative works , in source code and object code form . 
 - 
 - b ) Subject to the terms of this Agreement , each Contributor hereby grants 
 - Recipient a non - exclusive , worldwide , royalty - free patent license under Licensed 
 - Patents to make , use , sell , offer to sell , import and otherwise transfer the 
 - Contribution of such Contributor , if any , in source code and object code form . 
 - This patent license shall apply to the combination of the Contribution and the 
 - Program if , at the time the Contribution is added by the Contributor , such 
 - addition of the Contribution causes such combination to be covered by the 
 - Licensed Patents . The patent license shall not apply to any other combinations 
 - which include the Contribution . No hardware per se is licensed hereunder . 
 - 
 - c ) Recipient understands that although each Contributor grants the licenses 
 - to its Contributions set forth herein , no assurances are provided by any 
 - Contributor that the Program does not infringe the patent or other intellectual 
 - property rights of any other entity . Each Contributor disclaims any liability to 
 - Recipient for claims brought by any other entity based on infringement of 
 - intellectual property rights or otherwise . As a condition to exercising the 
 - rights and licenses granted hereunder , each Recipient hereby assumes sole 
 - responsibility to secure any other intellectual property rights needed , if any . 
 - For example , if a third party patent license is required to allow Recipient to 
 - distribute the Program , it is Recipient ' s responsibility to acquire that license 
 - before distributing the Program . 
 - 
 - d ) Each Contributor represents that to its knowledge it has sufficient 
 - copyright rights in its Contribution , if any , to grant the copyright license set 
 - forth in this Agreement . 
 - 
 - 3 . REQUIREMENTS 
 - 
 - A Contributor may choose to distribute the Program in object code form under its 
 - own license agreement , provided that : 
 - 
 - a ) it complies with the terms and conditions of this Agreement ; and 
 - 
 - b ) its license agreement : 
 - 
 - i ) effectively disclaims on behalf of all Contributors all warranties and 
 - conditions , express and implied , including warranties or conditions of title and 
 - non - infringement , and implied warranties or conditions of merchantability and 
 - fitness for a particular purpose ; 
 - 
 - ii ) effectively excludes on behalf of all Contributors all liability for 
 - damages , including direct , indirect , special , incidental and consequential 
 - damages , such as lost profits ; 
 - 
 - iii ) states that any provisions which differ from this Agreement are offered 
 - by that Contributor alone and not by any other party ; and 
 - 
 - iv ) states that source code for the Program is available from such 
 - Contributor , and informs licensees how to obtain it in a reasonable manner on or 
 - through a medium customarily used for software exchange . 
 - 
 - When the Program is made available in source code form : 
 - 
 - a ) it must be made available under this Agreement ; and 
 - 
 - b ) a copy of this Agreement must be included with each copy of the Program . 
 - 
 - Contributors may not remove or alter any copyright notices contained within the 
 - Program . 
 - 
 - Each Contributor must identify itself as the originator of its Contribution , if 
 - any , in a manner that reasonably allows subsequent Recipients to identify the 
 - originator of the Contribution . 
 - 
 - 4 . COMMERCIAL DISTRIBUTION 
 - 
 - Commercial distributors of software may accept certain responsibilities with 
 - respect to end users , business partners and the like . While this license is 
 - intended to facilitate the commercial use of the Program , the Contributor who 
 - includes the Program in a commercial product offering should do so in a manner 
 - which does not create potential liability for other Contributors . Therefore , if 
 - a Contributor includes the Program in a commercial product offering , such 
 - Contributor ( " Commercial Contributor " ) hereby agrees to defend and indemnify 
 - every other Contributor ( " Indemnified Contributor " ) against any losses , damages 
 - and costs ( collectively " Losses " ) arising from claims , lawsuits and other legal 
 - actions brought by a third party against the Indemnified Contributor to the 
 - extent caused by the acts or omissions of such Commercial Contributor in 
 - connection with its distribution of the Program in a commercial product 
 - offering . The obligations in this section do not apply to any claims or Losses 
 - relating to any actual or alleged intellectual property infringement . In order 
 - to qualify , an Indemnified Contributor must : a ) promptly notify the Commercial 
 - Contributor in writing of such claim , and b ) allow the Commercial Contributor to 
 - control , and cooperate with the Commercial Contributor in , the defense and any 
 - related settlement negotiations . The Indemnified Contributor may participate in 
 - any such claim at its own expense . 
 - 
 - For example , a Contributor might include the Program in a commercial product 
 - offering , Product X . That Contributor is then a Commercial Contributor . If that 
 - Commercial Contributor then makes performance claims , or offers warranties 
 - related to Product X , those performance claims and warranties are such 
 - Commercial Contributor ' s responsibility alone . Under this section , the 
 - Commercial Contributor would have to defend claims against the other 
 - Contributors related to those performance claims and warranties , and if a court 
 - requires any other Contributor to pay any damages as a result , the Commercial 
 - Contributor must pay those damages . 
 - 
 - 5 . NO WARRANTY 
 - 
 - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , THE PROGRAM IS PROVIDED ON AN 
 - " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , EITHER EXPRESS OR 
 - IMPLIED INCLUDING , WITHOUT LIMITATION , ANY WARRANTIES OR CONDITIONS OF TITLE , 
 - NON - INFRINGEMENT , MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE . Each 
 - Recipient is solely responsible for determining the appropriateness of using and 
 - distributing the Program and assumes all risks associated with its exercise of 
 - rights under this Agreement , including but not limited to the risks and costs of 
 - program errors , compliance with applicable laws , damage to or loss of data , 
 - programs or equipment , and unavailability or interruption of operations . 
 - 
 - 6 . DISCLAIMER OF LIABILITY 
 - 
 - EXCEPT AS EXPRESSLY SET FORTH IN THIS AGREEMENT , NEITHER RECIPIENT NOR ANY 
 - CONTRIBUTORS SHALL HAVE ANY LIABILITY FOR ANY DIRECT , INDIRECT , INCIDENTAL , 
 - SPECIAL , EXEMPLARY , OR CONSEQUENTIAL DAMAGES ( INCLUDING WITHOUT LIMITATION LOST 
 - PROFITS ) , HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY , WHETHER IN CONTRACT , 
 - STRICT LIABILITY , OR TORT ( INCLUDING NEGLIGENCE OR OTHERWISE ) ARISING IN ANY WAY 
 - OUT OF THE USE OR DISTRIBUTION OF THE PROGRAM OR THE EXERCISE OF ANY RIGHTS 
 - GRANTED HEREUNDER , EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES . 
 - 
 - 7 . GENERAL 
 - 
 - If any provision of this Agreement is invalid or unenforceable under applicable 
 - law , it shall not affect the validity or enforceability of the remainder of the 
 - terms of this Agreement , and without further action by the parties hereto , such 
 - provision shall be reformed to the minimum extent necessary to make such 
 - provision valid and enforceable . 
 - 
 - If Recipient institutes patent litigation against a Contributor with respect to 
 - a patent applicable to software ( including a cross - claim or counterclaim in a 
 - lawsuit ) , then any patent licenses granted by that Contributor to such Recipient 
 - under this Agreement shall terminate as of the date such litigation is filed . In 
 - addition , if Recipient institutes patent litigation against any entity 
 - ( including a cross - claim or counterclaim in a lawsuit ) alleging that the Program 
 - itself ( excluding combinations of the Program with other software or hardware ) 
 - infringes such Recipient ' s patent ( s ) , then such Recipient ' s rights granted under 
 - Section 2 ( b ) shall terminate as of the date such litigation is filed . 
 - 
 - All Recipient ' s rights under this Agreement shall terminate if it fails to 
 - comply with any of the material terms or conditions of this Agreement and does 
 - not cure such failure in a reasonable period of time after becoming aware of 
 - such noncompliance . If all Recipient ' s rights under this Agreement terminate , 
 - Recipient agrees to cease use and distribution of the Program as soon as 
 - reasonably practicable . However , Recipient ' s obligations under this Agreement 
 - and any licenses granted by Recipient relating to the Program shall continue and 
 - survive . 
 - 
 - Everyone is permitted to copy and distribute copies of this Agreement , but in 
 - order to avoid inconsistency the Agreement is copyrighted and may only be 
 - modified in the following manner . The Agreement Steward reserves the right to 
 - publish new versions ( including revisions ) of this Agreement from time to time . 
 - No one other than the Agreement Steward has the right to modify this Agreement . 
 - IBM is the initial Agreement Steward . IBM may assign the responsibility to serve 
 - as the Agreement Steward to a suitable separate entity . Each new version of the 
 - Agreement will be given a distinguishing version number . The Program ( including 
 - Contributions ) may always be distributed subject to the version of the Agreement 
 - under which it was received . In addition , after a new version of the Agreement 
 - is published , Contributor may elect to distribute the Program ( including its 
 - Contributions ) under the new version . Except as expressly stated in Sections 
 - 2 ( a ) and 2 ( b ) above , Recipient receives no rights or licenses to the 
 - intellectual property of any Contributor under this Agreement , whether 
 - expressly , by implication , estoppel or otherwise . All rights in the Program not 
 - expressly granted under this Agreement are reserved . 
 - 
 - This Agreement is governed by the laws of the State of New York and the 
 - intellectual property laws of the United States of America . No party to this 
 - Agreement will bring a legal action under this Agreement more than one year 
 - after the cause of action arose . Each party waives its rights to a jury trial in 
 - any resulting litigation . 
 diff - - git a / NOTICE . txt b / NOTICE . txt 
 index 852cedb . . 7d98c34 100644 
 - - - a / NOTICE . txt 
 + + + b / NOTICE . txt 
 @ @ - 11 , 8 + 11 , 6 @ @ Some alternate data structures provided by high - scale - lib from 
 http : / / sourceforge . net / projects / high - scale - lib / . 
 Written by Cliff Click and released as Public Domain . 
 
 - This product makes use of the JUnit test framework ( http : / / junit . org ) . 
 - 
 Some alternate data structures provided by concurrentlinkedhashmap 
 from http : / / code . google . com / p / concurrentlinkedhashmap / . 
 Copyright 2009 Benjamin Manes 
 diff - - git a / ivy . xml b / ivy . xml 
 index b548940 . . 676283e 100644 
 - - - a / ivy . xml 
 + + + b / ivy . xml 
 @ @ - 41 , 6 + 41 , 7 @ @ 
 < dependency org = " org . slf4j " name = " slf4j - api " rev = " 1 . 5 . 8 " / > 
 < dependency org = " org . slf4j " name = " slf4j - log4j12 " rev = " 1 . 5 . 8 " / > 
 < dependency org = " com . googlecode . json - simple " name = " json - simple " rev = " 1 . 1 " / > 
 + < dependency org = " junit " name = " junit " rev = " 4 . 6 " / > 
 < / dependencies > 
 < / ivy - module > 
 
 diff - - git a / lib / junit - 4 . 6 . jar b / lib / junit - 4 . 6 . jar 
 deleted file mode 100644 
 index 00770a4 . . 0000000 
 Binary files a / lib / junit - 4 . 6 . jar and / dev / null differ
