BLEU SCORE: 0.08116697886877475

TEST MSG: Add stress profile yaml with LWT
GENERATED MSG: optimize commitlog checksumming with PureJavaCrc32

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index a1951b4 . . 78c2947 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 4 . 0 <nl> + * Add stress profile yaml with LWT ( CASSANDRA - 7960 ) <nl> * Reduce memory copies and object creations when acting on ByteBufs ( CASSANDRA - 13789 ) <nl> * simplify mx4j configuration ( Cassandra - 13578 ) <nl> * Fix trigger example on 4 . 0 ( CASSANDRA - 13796 ) <nl> diff - - git a / tools / cqlstress - lwt - example . yaml b / tools / cqlstress - lwt - example . yaml <nl> new file mode 100644 <nl> index 0000000 . . 8f523be <nl> - - - / dev / null <nl> + + + b / tools / cqlstress - lwt - example . yaml <nl> @ @ - 0 , 0 + 1 , 71 @ @ <nl> + # Based on https : / / gist . github . com / tjake / 8995058fed11d9921e31 <nl> + # # # DML # # # <nl> + <nl> + # Keyspace Name <nl> + keyspace : cqlstress _ lwt _ example <nl> + <nl> + # The CQL for creating a keyspace ( optional if it already exists ) <nl> + keyspace _ definition : | <nl> + CREATE KEYSPACE cqlstress _ lwt _ example WITH replication = { ' class ' : ' SimpleStrategy ' , ' replication _ factor ' : 3 } ; <nl> + <nl> + # Table name <nl> + table : blogposts <nl> + <nl> + # The CQL for creating a table you wish to stress ( optional if it already exists ) <nl> + table _ definition : | <nl> + CREATE TABLE blogposts ( <nl> + domain text , <nl> + published _ date timeuuid , <nl> + url text , <nl> + author text , <nl> + title text , <nl> + body text , <nl> + PRIMARY KEY ( domain , published _ date ) <nl> + ) WITH CLUSTERING ORDER BY ( published _ date DESC ) <nl> + AND compaction = { ' class ' : ' LeveledCompactionStrategy ' } <nl> + AND comment = ' A table to hold blog posts ' <nl> + <nl> + # # # Column Distribution Specifications # # # <nl> + <nl> + columnspec : <nl> + - name : domain <nl> + size : gaussian ( 5 . . 100 ) # domain names are relatively short <nl> + population : uniform ( 1 . . 10M ) # 10M possible domains to pick from <nl> + <nl> + - name : published _ date <nl> + cluster : fixed ( 1000 ) # under each domain we will have max 1000 posts <nl> + <nl> + - name : url <nl> + size : uniform ( 30 . . 300 ) <nl> + <nl> + - name : title # titles shouldn ' t go beyond 200 chars <nl> + size : gaussian ( 10 . . 200 ) <nl> + <nl> + - name : author <nl> + size : uniform ( 5 . . 20 ) # author names should be short <nl> + <nl> + - name : body <nl> + size : gaussian ( 100 . . 5000 ) # the body of the blog post can be long <nl> + <nl> + # # # Batch Ratio Distribution Specifications # # # <nl> + <nl> + insert : <nl> + partitions : fixed ( 1 ) # Our partition key is the domain so only insert one per batch <nl> + <nl> + select : fixed ( 1 ) / 1000 # We have 1000 posts per domain so 1 / 1000 will allow 1 post per batch <nl> + <nl> + batchtype : UNLOGGED # Unlogged batches <nl> + <nl> + condition : IF body = NULL # LWT : Do not override <nl> + <nl> + <nl> + # <nl> + # A list of queries you wish to run against the schema <nl> + # <nl> + queries : <nl> + singlepost : <nl> + cql : select * from blogposts where domain = ? LIMIT 1 <nl> + fields : samerow <nl> + timeline : <nl> + cql : select url , title , published _ date from blogposts where domain = ? LIMIT 10 <nl> + fields : samerow <nl> diff - - git a / tools / stress / src / org / apache / cassandra / stress / StressProfile . java b / tools / stress / src / org / apache / cassandra / stress / StressProfile . java <nl> index 2420d68 . . 15a36dd 100644 <nl> - - - a / tools / stress / src / org / apache / cassandra / stress / StressProfile . java <nl> + + + b / tools / stress / src / org / apache / cassandra / stress / StressProfile . java <nl> @ @ - 543 , 6 + 543 , 11 @ @ public class StressProfile implements Serializable <nl> <nl> / / Put PK predicates at the end <nl> sb . append ( pred ) ; <nl> + if ( insert . containsKey ( " condition " ) ) <nl> + { <nl> + sb . append ( " " + insert . get ( " condition " ) ) ; <nl> + insert . remove ( " condition " ) ; <nl> + } <nl> } <nl> else <nl> { <nl> @ @ - 595 , 6 + 600 , 8 @ @ public class StressProfile implements Serializable <nl> String query = sb . toString ( ) ; <nl> <nl> insertStatement = client . prepare ( query ) ; <nl> + System . out . println ( " Insert Statement : " ) ; <nl> + System . out . println ( " " + query ) ; <nl> } <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / NEWS . txt b / NEWS . txt <nl> index fc401b8 . . cc3c18e 100644 <nl> - - - a / NEWS . txt <nl> + + + b / NEWS . txt <nl> @ @ - 14 , 6 + 14 , 8 @ @ by version X , but the inverse is not necessarily the case . ) <nl> <nl> Upgrading <nl> - - - - - - - - - <nl> + - Compression is enabled by default on newly created ColumnFamilies <nl> + ( and unchanged for ColumnFamilies created prior to upgrading ) . <nl> - The KsDef . replication _ factor field ( deprecated since 0 . 8 ) has <nl> been removed . Older clients will need to be updated to be able <nl> to continue to created and update keyspaces . <nl> @ @ - 59 , 6 + 61 , 7 @ @ Features <nl> - Hadoop : a new BulkOutputFormat is included which will directly write <nl> SSTables locally and then stream them into the cluster . <nl> - Hadoop : KeyRange . filter is now supported with ColumnFamilyInputFormat <nl> + - Hadoop wide row mode added to ColumnFamilyInputFormat <nl> - The bulk loader is not longer a fat client ; it can be run from an <nl> existing machine in a cluster . <nl> - A new write survey mode has been added , similar to bootstrap ( enabled via <nl> @ @ - 69 , 6 + 72 , 7 @ @ Features <nl> threshold . <nl> - Off - heap caches no longer require JNA . <nl> - Streaming is now multithreaded . <nl> + - Compactions may now be aborted via JMX or nodetool . <nl> <nl> <nl> 1 . 0 . 8

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index a1951b4 . . 78c2947 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 4 . 0 
 + * Add stress profile yaml with LWT ( CASSANDRA - 7960 ) 
 * Reduce memory copies and object creations when acting on ByteBufs ( CASSANDRA - 13789 ) 
 * simplify mx4j configuration ( Cassandra - 13578 ) 
 * Fix trigger example on 4 . 0 ( CASSANDRA - 13796 ) 
 diff - - git a / tools / cqlstress - lwt - example . yaml b / tools / cqlstress - lwt - example . yaml 
 new file mode 100644 
 index 0000000 . . 8f523be 
 - - - / dev / null 
 + + + b / tools / cqlstress - lwt - example . yaml 
 @ @ - 0 , 0 + 1 , 71 @ @ 
 + # Based on https : / / gist . github . com / tjake / 8995058fed11d9921e31 
 + # # # DML # # # 
 + 
 + # Keyspace Name 
 + keyspace : cqlstress _ lwt _ example 
 + 
 + # The CQL for creating a keyspace ( optional if it already exists ) 
 + keyspace _ definition : | 
 + CREATE KEYSPACE cqlstress _ lwt _ example WITH replication = { ' class ' : ' SimpleStrategy ' , ' replication _ factor ' : 3 } ; 
 + 
 + # Table name 
 + table : blogposts 
 + 
 + # The CQL for creating a table you wish to stress ( optional if it already exists ) 
 + table _ definition : | 
 + CREATE TABLE blogposts ( 
 + domain text , 
 + published _ date timeuuid , 
 + url text , 
 + author text , 
 + title text , 
 + body text , 
 + PRIMARY KEY ( domain , published _ date ) 
 + ) WITH CLUSTERING ORDER BY ( published _ date DESC ) 
 + AND compaction = { ' class ' : ' LeveledCompactionStrategy ' } 
 + AND comment = ' A table to hold blog posts ' 
 + 
 + # # # Column Distribution Specifications # # # 
 + 
 + columnspec : 
 + - name : domain 
 + size : gaussian ( 5 . . 100 ) # domain names are relatively short 
 + population : uniform ( 1 . . 10M ) # 10M possible domains to pick from 
 + 
 + - name : published _ date 
 + cluster : fixed ( 1000 ) # under each domain we will have max 1000 posts 
 + 
 + - name : url 
 + size : uniform ( 30 . . 300 ) 
 + 
 + - name : title # titles shouldn ' t go beyond 200 chars 
 + size : gaussian ( 10 . . 200 ) 
 + 
 + - name : author 
 + size : uniform ( 5 . . 20 ) # author names should be short 
 + 
 + - name : body 
 + size : gaussian ( 100 . . 5000 ) # the body of the blog post can be long 
 + 
 + # # # Batch Ratio Distribution Specifications # # # 
 + 
 + insert : 
 + partitions : fixed ( 1 ) # Our partition key is the domain so only insert one per batch 
 + 
 + select : fixed ( 1 ) / 1000 # We have 1000 posts per domain so 1 / 1000 will allow 1 post per batch 
 + 
 + batchtype : UNLOGGED # Unlogged batches 
 + 
 + condition : IF body = NULL # LWT : Do not override 
 + 
 + 
 + # 
 + # A list of queries you wish to run against the schema 
 + # 
 + queries : 
 + singlepost : 
 + cql : select * from blogposts where domain = ? LIMIT 1 
 + fields : samerow 
 + timeline : 
 + cql : select url , title , published _ date from blogposts where domain = ? LIMIT 10 
 + fields : samerow 
 diff - - git a / tools / stress / src / org / apache / cassandra / stress / StressProfile . java b / tools / stress / src / org / apache / cassandra / stress / StressProfile . java 
 index 2420d68 . . 15a36dd 100644 
 - - - a / tools / stress / src / org / apache / cassandra / stress / StressProfile . java 
 + + + b / tools / stress / src / org / apache / cassandra / stress / StressProfile . java 
 @ @ - 543 , 6 + 543 , 11 @ @ public class StressProfile implements Serializable 
 
 / / Put PK predicates at the end 
 sb . append ( pred ) ; 
 + if ( insert . containsKey ( " condition " ) ) 
 + { 
 + sb . append ( " " + insert . get ( " condition " ) ) ; 
 + insert . remove ( " condition " ) ; 
 + } 
 } 
 else 
 { 
 @ @ - 595 , 6 + 600 , 8 @ @ public class StressProfile implements Serializable 
 String query = sb . toString ( ) ; 
 
 insertStatement = client . prepare ( query ) ; 
 + System . out . println ( " Insert Statement : " ) ; 
 + System . out . println ( " " + query ) ; 
 } 
 } 
 }

NEAREST DIFF:
diff - - git a / NEWS . txt b / NEWS . txt 
 index fc401b8 . . cc3c18e 100644 
 - - - a / NEWS . txt 
 + + + b / NEWS . txt 
 @ @ - 14 , 6 + 14 , 8 @ @ by version X , but the inverse is not necessarily the case . ) 
 
 Upgrading 
 - - - - - - - - - 
 + - Compression is enabled by default on newly created ColumnFamilies 
 + ( and unchanged for ColumnFamilies created prior to upgrading ) . 
 - The KsDef . replication _ factor field ( deprecated since 0 . 8 ) has 
 been removed . Older clients will need to be updated to be able 
 to continue to created and update keyspaces . 
 @ @ - 59 , 6 + 61 , 7 @ @ Features 
 - Hadoop : a new BulkOutputFormat is included which will directly write 
 SSTables locally and then stream them into the cluster . 
 - Hadoop : KeyRange . filter is now supported with ColumnFamilyInputFormat 
 + - Hadoop wide row mode added to ColumnFamilyInputFormat 
 - The bulk loader is not longer a fat client ; it can be run from an 
 existing machine in a cluster . 
 - A new write survey mode has been added , similar to bootstrap ( enabled via 
 @ @ - 69 , 6 + 72 , 7 @ @ Features 
 threshold . 
 - Off - heap caches no longer require JNA . 
 - Streaming is now multithreaded . 
 + - Compactions may now be aborted via JMX or nodetool . 
 
 
 1 . 0 . 8
