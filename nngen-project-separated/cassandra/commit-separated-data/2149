BLEU SCORE: 0.05522397783539471

TEST MSG: use correct native port in pig - test
GENERATED MSG: Handle null correctly in CqlStorage

TEST DIFF (one line): diff - - git a / test / pig / org / apache / cassandra / pig / PigTestBase . java b / test / pig / org / apache / cassandra / pig / PigTestBase . java <nl> index 002fbba . . 4b3e422 100644 <nl> - - - a / test / pig / org / apache / cassandra / pig / PigTestBase . java <nl> + + + b / test / pig / org / apache / cassandra / pig / PigTestBase . java <nl> @ @ - 68 , 7 + 68 , 7 @ @ public class PigTestBase extends SchemaLoader <nl> protected static String defaultParameters = " init _ address = localhost & rpc _ port = 9170 & partitioner = org . apache . cassandra . dht . ByteOrderedPartitioner " ; <nl> protected static String nativeParameters = " & core _ conns = 2 & max _ conns = 10 & min _ simult _ reqs = 3 & max _ simult _ reqs = 10 & native _ timeout = 10000000 " + <nl> " & native _ read _ timeout = 10000000 & send _ buff _ size = 4096 & receive _ buff _ size = 4096 & solinger = 3 " + <nl> - " & tcp _ nodelay = true & reuse _ address = true & keep _ alive = true & native _ port = 9052 " ; <nl> + " & tcp _ nodelay = true & reuse _ address = true & keep _ alive = true & native _ port = 9042 " ; <nl> <nl> static <nl> {
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 32c74aa . . 3c96770 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 3 + 1 , 7 @ @ <nl> + 2 . 0 . 3 <nl> + * Fix modifying column _ metadata from thrift ( CASSANDRA - 6182 ) <nl> + <nl> + <nl> 2 . 0 . 2 <nl> * Update FailureDetector to use nanontime ( CASSANDRA - 4925 ) <nl> * Fix FileCacheService regressions ( CASSANDRA - 6149 ) <nl> diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> index d63ee01 . . 20c35b3 100644 <nl> - - - a / src / java / org / apache / cassandra / config / CFMetaData . java <nl> + + + b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> @ @ - 1461 , 7 + 1461 , 7 @ @ public final class CFMetaData <nl> if ( fromThrift & & cd . type ! = ColumnDefinition . Type . REGULAR ) <nl> continue ; <nl> <nl> - cd . deleteFromSchema ( rm , cfName , modificationTimestamp ) ; <nl> + cd . deleteFromSchema ( rm , cfName , getColumnDefinitionComparator ( cd ) , modificationTimestamp ) ; <nl> } <nl> <nl> / / newly added columns <nl> @ @ - 1506 , 7 + 1506 , 7 @ @ public final class CFMetaData <nl> cf . addAtom ( new RangeTombstone ( builder . build ( ) , builder . buildAsEndOfRange ( ) , timestamp , ldt ) ) ; <nl> <nl> for ( ColumnDefinition cd : column _ metadata . values ( ) ) <nl> - cd . deleteFromSchema ( rm , cfName , timestamp ) ; <nl> + cd . deleteFromSchema ( rm , cfName , getColumnDefinitionComparator ( cd ) , timestamp ) ; <nl> <nl> for ( TriggerDefinition td : triggers . values ( ) ) <nl> td . deleteFromSchema ( rm , cfName , timestamp ) ; <nl> diff - - git a / src / java / org / apache / cassandra / config / ColumnDefinition . java b / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> index d68e7e2 . . 7ca4d45 100644 <nl> - - - a / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> + + + b / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> @ @ - 230 , 13 + 230 , 15 @ @ public class ColumnDefinition <nl> * @ param cfName The name of the parent ColumnFamily <nl> * @ param timestamp The timestamp to use for column modification <nl> * / <nl> - public void deleteFromSchema ( RowMutation rm , String cfName , long timestamp ) <nl> + public void deleteFromSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) <nl> { <nl> ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; <nl> int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; <nl> <nl> ColumnNameBuilder builder = CFMetaData . SchemaColumnsCf . getCfDef ( ) . getColumnNameBuilder ( ) ; <nl> - builder . add ( ByteBufferUtil . bytes ( cfName ) ) . add ( name ) ; <nl> + / / Note : the following is necessary for backward compatibility . For CQL3 , comparator will be UTF8 and nameBytes = = name <nl> + ByteBuffer nameBytes = ByteBufferUtil . bytes ( comparator . getString ( name ) ) ; <nl> + builder . add ( ByteBufferUtil . bytes ( cfName ) ) . add ( nameBytes ) ; <nl> cf . addAtom ( new RangeTombstone ( builder . build ( ) , builder . buildAsEndOfRange ( ) , timestamp , ldt ) ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / test / pig / org / apache / cassandra / pig / PigTestBase . java b / test / pig / org / apache / cassandra / pig / PigTestBase . java 
 index 002fbba . . 4b3e422 100644 
 - - - a / test / pig / org / apache / cassandra / pig / PigTestBase . java 
 + + + b / test / pig / org / apache / cassandra / pig / PigTestBase . java 
 @ @ - 68 , 7 + 68 , 7 @ @ public class PigTestBase extends SchemaLoader 
 protected static String defaultParameters = " init _ address = localhost & rpc _ port = 9170 & partitioner = org . apache . cassandra . dht . ByteOrderedPartitioner " ; 
 protected static String nativeParameters = " & core _ conns = 2 & max _ conns = 10 & min _ simult _ reqs = 3 & max _ simult _ reqs = 10 & native _ timeout = 10000000 " + 
 " & native _ read _ timeout = 10000000 & send _ buff _ size = 4096 & receive _ buff _ size = 4096 & solinger = 3 " + 
 - " & tcp _ nodelay = true & reuse _ address = true & keep _ alive = true & native _ port = 9052 " ; 
 + " & tcp _ nodelay = true & reuse _ address = true & keep _ alive = true & native _ port = 9042 " ; 
 
 static 
 {

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 32c74aa . . 3c96770 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 3 + 1 , 7 @ @ 
 + 2 . 0 . 3 
 + * Fix modifying column _ metadata from thrift ( CASSANDRA - 6182 ) 
 + 
 + 
 2 . 0 . 2 
 * Update FailureDetector to use nanontime ( CASSANDRA - 4925 ) 
 * Fix FileCacheService regressions ( CASSANDRA - 6149 ) 
 diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java 
 index d63ee01 . . 20c35b3 100644 
 - - - a / src / java / org / apache / cassandra / config / CFMetaData . java 
 + + + b / src / java / org / apache / cassandra / config / CFMetaData . java 
 @ @ - 1461 , 7 + 1461 , 7 @ @ public final class CFMetaData 
 if ( fromThrift & & cd . type ! = ColumnDefinition . Type . REGULAR ) 
 continue ; 
 
 - cd . deleteFromSchema ( rm , cfName , modificationTimestamp ) ; 
 + cd . deleteFromSchema ( rm , cfName , getColumnDefinitionComparator ( cd ) , modificationTimestamp ) ; 
 } 
 
 / / newly added columns 
 @ @ - 1506 , 7 + 1506 , 7 @ @ public final class CFMetaData 
 cf . addAtom ( new RangeTombstone ( builder . build ( ) , builder . buildAsEndOfRange ( ) , timestamp , ldt ) ) ; 
 
 for ( ColumnDefinition cd : column _ metadata . values ( ) ) 
 - cd . deleteFromSchema ( rm , cfName , timestamp ) ; 
 + cd . deleteFromSchema ( rm , cfName , getColumnDefinitionComparator ( cd ) , timestamp ) ; 
 
 for ( TriggerDefinition td : triggers . values ( ) ) 
 td . deleteFromSchema ( rm , cfName , timestamp ) ; 
 diff - - git a / src / java / org / apache / cassandra / config / ColumnDefinition . java b / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 index d68e7e2 . . 7ca4d45 100644 
 - - - a / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 + + + b / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 @ @ - 230 , 13 + 230 , 15 @ @ public class ColumnDefinition 
 * @ param cfName The name of the parent ColumnFamily 
 * @ param timestamp The timestamp to use for column modification 
 * / 
 - public void deleteFromSchema ( RowMutation rm , String cfName , long timestamp ) 
 + public void deleteFromSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) 
 { 
 ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; 
 int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; 
 
 ColumnNameBuilder builder = CFMetaData . SchemaColumnsCf . getCfDef ( ) . getColumnNameBuilder ( ) ; 
 - builder . add ( ByteBufferUtil . bytes ( cfName ) ) . add ( name ) ; 
 + / / Note : the following is necessary for backward compatibility . For CQL3 , comparator will be UTF8 and nameBytes = = name 
 + ByteBuffer nameBytes = ByteBufferUtil . bytes ( comparator . getString ( name ) ) ; 
 + builder . add ( ByteBufferUtil . bytes ( cfName ) ) . add ( nameBytes ) ; 
 cf . addAtom ( new RangeTombstone ( builder . build ( ) , builder . buildAsEndOfRange ( ) , timestamp , ldt ) ) ; 
 } 

