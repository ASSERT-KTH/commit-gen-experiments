BLEU SCORE: 0.05522397783539471

TEST MSG: Fix update / delete behavior for static lists
GENERATED MSG: Fix deleting from an empty list

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> index 876c5e4 . . 37b46ae 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> @ @ - 29 , 6 + 29 , 7 @ @ import org . apache . cassandra . config . ColumnDefinition ; <nl> import org . apache . cassandra . config . Schema ; <nl> import org . apache . cassandra . cql3 . * ; <nl> import org . apache . cassandra . db . * ; <nl> + import org . apache . cassandra . db . composites . AbstractCellNameType ; <nl> import org . apache . cassandra . db . composites . CBuilder ; <nl> import org . apache . cassandra . db . composites . Composite ; <nl> import org . apache . cassandra . db . filter . ColumnSlice ; <nl> @ @ - 446 , 7 + 447 , 10 @ @ public abstract class ModificationStatement implements CQLStatement <nl> if ( row . cf = = null | | row . cf . isEmpty ( ) ) <nl> continue ; <nl> <nl> - Iterator < CQL3Row > iter = cfm . comparator . CQL3RowBuilder ( cfm , now ) . group ( row . cf . getSortedColumns ( ) . iterator ( ) ) ; <nl> + CQL3Row . RowIterator iter = cfm . comparator . CQL3RowBuilder ( cfm , now ) . group ( row . cf . getSortedColumns ( ) . iterator ( ) ) ; <nl> + if ( iter . getStaticRow ( ) ! = null ) { <nl> + map . put ( row . key . getKey ( ) , iter . getStaticRow ( ) ) ; <nl> + } <nl> if ( iter . hasNext ( ) ) <nl> { <nl> map . put ( row . key . getKey ( ) , iter . next ( ) ) ; <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> index 0241d4f . . 31dd5a6 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> @ @ - 485 , 4 + 485 , 27 @ @ public class CollectionsTest extends CQLTester <nl> assertInvalid ( " alter table % s add v set < int > " ) ; <nl> } <nl> <nl> + <nl> + / * * <nl> + * Test for 9838 . <nl> + * / <nl> + @ Test <nl> + public void testUpdateStaticList ( ) throws Throwable <nl> + { <nl> + createTable ( " CREATE TABLE % s ( k1 text , k2 text , s _ list list < int > static , PRIMARY KEY ( k1 , k2 ) ) " ) ; <nl> + <nl> + execute ( " insert into % s ( k1 , k2 ) VALUES ( ' a ' , ' b ' ) " ) ; <nl> + execute ( " update % s set s _ list = s _ list + [ 0 ] where k1 = ' a ' " ) ; <nl> + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 0 ) ) ) ; <nl> + <nl> + execute ( " update % s set s _ list [ 0 ] = 100 where k1 = ' a ' " ) ; <nl> + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 100 ) ) ) ; <nl> + <nl> + execute ( " update % s set s _ list = s _ list + [ 0 ] where k1 = ' a ' " ) ; <nl> + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 100 , 0 ) ) ) ; <nl> + <nl> + execute ( " delete s _ list [ 0 ] from % s where k1 = ' a ' " ) ; <nl> + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 0 ) ) ) ; <nl> + } <nl> + <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 index 876c5e4 . . 37b46ae 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 @ @ - 29 , 6 + 29 , 7 @ @ import org . apache . cassandra . config . ColumnDefinition ; 
 import org . apache . cassandra . config . Schema ; 
 import org . apache . cassandra . cql3 . * ; 
 import org . apache . cassandra . db . * ; 
 + import org . apache . cassandra . db . composites . AbstractCellNameType ; 
 import org . apache . cassandra . db . composites . CBuilder ; 
 import org . apache . cassandra . db . composites . Composite ; 
 import org . apache . cassandra . db . filter . ColumnSlice ; 
 @ @ - 446 , 7 + 447 , 10 @ @ public abstract class ModificationStatement implements CQLStatement 
 if ( row . cf = = null | | row . cf . isEmpty ( ) ) 
 continue ; 
 
 - Iterator < CQL3Row > iter = cfm . comparator . CQL3RowBuilder ( cfm , now ) . group ( row . cf . getSortedColumns ( ) . iterator ( ) ) ; 
 + CQL3Row . RowIterator iter = cfm . comparator . CQL3RowBuilder ( cfm , now ) . group ( row . cf . getSortedColumns ( ) . iterator ( ) ) ; 
 + if ( iter . getStaticRow ( ) ! = null ) { 
 + map . put ( row . key . getKey ( ) , iter . getStaticRow ( ) ) ; 
 + } 
 if ( iter . hasNext ( ) ) 
 { 
 map . put ( row . key . getKey ( ) , iter . next ( ) ) ; 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 index 0241d4f . . 31dd5a6 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 @ @ - 485 , 4 + 485 , 27 @ @ public class CollectionsTest extends CQLTester 
 assertInvalid ( " alter table % s add v set < int > " ) ; 
 } 
 
 + 
 + / * * 
 + * Test for 9838 . 
 + * / 
 + @ Test 
 + public void testUpdateStaticList ( ) throws Throwable 
 + { 
 + createTable ( " CREATE TABLE % s ( k1 text , k2 text , s _ list list < int > static , PRIMARY KEY ( k1 , k2 ) ) " ) ; 
 + 
 + execute ( " insert into % s ( k1 , k2 ) VALUES ( ' a ' , ' b ' ) " ) ; 
 + execute ( " update % s set s _ list = s _ list + [ 0 ] where k1 = ' a ' " ) ; 
 + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 0 ) ) ) ; 
 + 
 + execute ( " update % s set s _ list [ 0 ] = 100 where k1 = ' a ' " ) ; 
 + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 100 ) ) ) ; 
 + 
 + execute ( " update % s set s _ list = s _ list + [ 0 ] where k1 = ' a ' " ) ; 
 + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 100 , 0 ) ) ) ; 
 + 
 + execute ( " delete s _ list [ 0 ] from % s where k1 = ' a ' " ) ; 
 + assertRows ( execute ( " select s _ list from % s where k1 = ' a ' " ) , row ( list ( 0 ) ) ) ; 
 + } 
 + 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
