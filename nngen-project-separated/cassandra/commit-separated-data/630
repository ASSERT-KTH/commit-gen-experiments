BLEU SCORE: 0.06285596338261261

TEST MSG: Revert " Merge branch ' cassandra - 3 . 0 ' into trunk "
GENERATED MSG: Revert " Reject invalid DC names as option while creating or altering NetworkTopologyStrategy "

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index ba08745 . . ca95411 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 92 , 7 + 92 , 6 @ @ Merged from 3 . 0 : <nl> * Calculate last compacted key on startup ( CASSANDRA - 6216 ) <nl> * Add schema to snapshot manifest , add USING TIMESTAMP clause to ALTER TABLE statements ( CASSANDRA - 7190 ) <nl> * If CF has no clustering columns , any row cache is full partition cache ( CASSANDRA - 12499 ) <nl> - * Reject invalid replication settings when creating or altering a keyspace ( CASSANDRA - 12681 ) <nl> Merged from 2 . 2 : <nl> * Fix merkle tree depth calculation ( CASSANDRA - 12580 ) <nl> * Make Collections deserialization more robust ( CASSANDRA - 12618 ) <nl> diff - - git a / NEWS . txt b / NEWS . txt <nl> index 9ab7c26 . . ad0f2be 100644 <nl> - - - a / NEWS . txt <nl> + + + b / NEWS . txt <nl> @ @ - 98 , 9 + 98 , 6 @ @ Upgrading <nl> - Application layer keep - alives were added to the streaming protocol to prevent idle incoming connections from <nl> timing out and failing the stream session ( CASSANDRA - 11839 ) . This effectively deprecates the streaming _ socket _ timeout _ in _ ms <nl> property in favor of streaming _ keep _ alive _ period _ in _ secs . See cassandra . yaml for more details about this property . <nl> - - Cassandra will no longer allow invalid keyspace replication options , such as invalid datacenter names for <nl> - NetworkTopologyStrategy . Existing keyspaces will continue to operate , but CREATE and ALTER will validate that <nl> - all datacenters specified exist in the cluster . <nl> <nl> 3 . 8 <nl> = = = <nl> diff - - git a / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java b / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java <nl> index 4ba1da8 . . 038ac9f 100644 <nl> - - - a / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java <nl> + + + b / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java <nl> @ @ - 320 , 7 + 320 , 7 @ @ public abstract class AbstractReplicationStrategy <nl> } <nl> } <nl> <nl> - protected void validateExpectedOptions ( ) throws ConfigurationException <nl> + private void validateExpectedOptions ( ) throws ConfigurationException <nl> { <nl> Collection expectedOptions = recognizedOptions ( ) ; <nl> if ( expectedOptions = = null ) <nl> diff - - git a / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java b / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java <nl> index 442e6cf . . 756b689 100644 <nl> - - - a / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java <nl> + + + b / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java <nl> @ @ - 24 , 11 + 24 , 9 @ @ import java . util . Map . Entry ; <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ; <nl> <nl> - import org . apache . cassandra . config . DatabaseDescriptor ; <nl> import org . apache . cassandra . exceptions . ConfigurationException ; <nl> import org . apache . cassandra . dht . Token ; <nl> import org . apache . cassandra . locator . TokenMetadata . Topology ; <nl> - import org . apache . cassandra . service . StorageService ; <nl> import org . apache . cassandra . utils . FBUtilities ; <nl> import org . apache . cassandra . utils . Pair ; <nl> <nl> @ @ - 216 , 45 + 214 , 6 @ @ public class NetworkTopologyStrategy extends AbstractReplicationStrategy <nl> return datacenters . keySet ( ) ; <nl> } <nl> <nl> - / * <nl> - * ( non - javadoc ) Method to generate list of valid data center names to be used to validate the replication parameters during CREATE / ALTER keyspace operations . <nl> - * All peers of current node are fetched from { @ link TokenMetadata } and then a set is build by fetching DC name of each peer . <nl> - * @ return a set of valid DC names <nl> - * / <nl> - private static Set < String > buildValidDataCentersSet ( ) <nl> - { <nl> - final Set < String > validDataCenters = new HashSet < > ( ) ; <nl> - final IEndpointSnitch snitch = DatabaseDescriptor . getEndpointSnitch ( ) ; <nl> - <nl> - / / Add data center of localhost . <nl> - validDataCenters . add ( snitch . getDatacenter ( FBUtilities . getBroadcastAddress ( ) ) ) ; <nl> - / / Fetch and add DCs of all peers . <nl> - for ( final InetAddress peer : StorageService . instance . getTokenMetadata ( ) . getAllEndpoints ( ) ) <nl> - { <nl> - validDataCenters . add ( snitch . getDatacenter ( peer ) ) ; <nl> - } <nl> - <nl> - return validDataCenters ; <nl> - } <nl> - <nl> - public Collection < String > recognizedOptions ( ) <nl> - { <nl> - / / only valid options are valid DC names . <nl> - return buildValidDataCentersSet ( ) ; <nl> - } <nl> - <nl> - protected void validateExpectedOptions ( ) throws ConfigurationException <nl> - { <nl> - / / Do not accept query with no data centers specified . <nl> - if ( this . configOptions . isEmpty ( ) ) <nl> - { <nl> - throw new ConfigurationException ( " Configuration for at least one datacenter must be present " ) ; <nl> - } <nl> - <nl> - / / Validate the data center names <nl> - super . validateExpectedOptions ( ) ; <nl> - } <nl> - <nl> public void validateOptions ( ) throws ConfigurationException <nl> { <nl> for ( Entry < String , String > e : this . configOptions . entrySet ( ) ) <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / CQLTester . java b / test / unit / org / apache / cassandra / cql3 / CQLTester . java <nl> index 29d51a8 . . 3bb753f 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / CQLTester . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / CQLTester . java <nl> @ @ - 57 , 7 + 57 , 6 @ @ import org . apache . cassandra . dht . Murmur3Partitioner ; <nl> import org . apache . cassandra . exceptions . ConfigurationException ; <nl> import org . apache . cassandra . exceptions . SyntaxException ; <nl> import org . apache . cassandra . io . util . FileUtils ; <nl> - import org . apache . cassandra . locator . AbstractEndpointSnitch ; <nl> import org . apache . cassandra . serializers . TypeSerializer ; <nl> import org . apache . cassandra . service . ClientState ; <nl> import org . apache . cassandra . service . QueryState ; <nl> @ @ - 84 , 8 + 83 , 6 @ @ public abstract class CQLTester <nl> protected static final long ROW _ CACHE _ SIZE _ IN _ MB = Integer . valueOf ( System . getProperty ( " cassandra . test . row _ cache _ size _ in _ mb " , " 0 " ) ) ; <nl> private static final AtomicInteger seqNumber = new AtomicInteger ( ) ; <nl> protected static final ByteBuffer TOO _ BIG = ByteBuffer . allocate ( FBUtilities . MAX _ UNSIGNED _ SHORT + 1024 ) ; <nl> - public static final String DATA _ CENTER = " datacenter1 " ; <nl> - public static final String RACK1 = " rack1 " ; <nl> <nl> private static org . apache . cassandra . transport . Server server ; <nl> protected static final int nativePort ; <nl> @ @ - 118 , 14 + 115 , 6 @ @ public abstract class CQLTester <nl> <nl> nativeAddr = InetAddress . getLoopbackAddress ( ) ; <nl> <nl> - / / Register an EndpointSnitch which returns fixed values for test . <nl> - DatabaseDescriptor . setEndpointSnitch ( new AbstractEndpointSnitch ( ) <nl> - { <nl> - @ Override public String getRack ( InetAddress endpoint ) { return RACK1 ; } <nl> - @ Override public String getDatacenter ( InetAddress endpoint ) { return DATA _ CENTER ; } <nl> - @ Override public int compareEndpoints ( InetAddress target , InetAddress a1 , InetAddress a2 ) { return 0 ; } <nl> - } ) ; <nl> - <nl> try <nl> { <nl> try ( ServerSocket serverSocket = new ServerSocket ( 0 ) ) <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java <nl> index 5af3ebb . . 5cb76c9 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java <nl> @ @ - 246 , 6 + 246 , 16 @ @ public class SecondaryIndexTest extends CQLTester <nl> } <nl> <nl> / * * <nl> + * Check one can use arbitrary name for datacenter when creating keyspace
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index ba08745 . . ca95411 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 92 , 7 + 92 , 6 @ @ Merged from 3 . 0 : 
 * Calculate last compacted key on startup ( CASSANDRA - 6216 ) 
 * Add schema to snapshot manifest , add USING TIMESTAMP clause to ALTER TABLE statements ( CASSANDRA - 7190 ) 
 * If CF has no clustering columns , any row cache is full partition cache ( CASSANDRA - 12499 ) 
 - * Reject invalid replication settings when creating or altering a keyspace ( CASSANDRA - 12681 ) 
 Merged from 2 . 2 : 
 * Fix merkle tree depth calculation ( CASSANDRA - 12580 ) 
 * Make Collections deserialization more robust ( CASSANDRA - 12618 ) 
 diff - - git a / NEWS . txt b / NEWS . txt 
 index 9ab7c26 . . ad0f2be 100644 
 - - - a / NEWS . txt 
 + + + b / NEWS . txt 
 @ @ - 98 , 9 + 98 , 6 @ @ Upgrading 
 - Application layer keep - alives were added to the streaming protocol to prevent idle incoming connections from 
 timing out and failing the stream session ( CASSANDRA - 11839 ) . This effectively deprecates the streaming _ socket _ timeout _ in _ ms 
 property in favor of streaming _ keep _ alive _ period _ in _ secs . See cassandra . yaml for more details about this property . 
 - - Cassandra will no longer allow invalid keyspace replication options , such as invalid datacenter names for 
 - NetworkTopologyStrategy . Existing keyspaces will continue to operate , but CREATE and ALTER will validate that 
 - all datacenters specified exist in the cluster . 
 
 3 . 8 
 = = = 
 diff - - git a / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java b / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java 
 index 4ba1da8 . . 038ac9f 100644 
 - - - a / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java 
 + + + b / src / java / org / apache / cassandra / locator / AbstractReplicationStrategy . java 
 @ @ - 320 , 7 + 320 , 7 @ @ public abstract class AbstractReplicationStrategy 
 } 
 } 
 
 - protected void validateExpectedOptions ( ) throws ConfigurationException 
 + private void validateExpectedOptions ( ) throws ConfigurationException 
 { 
 Collection expectedOptions = recognizedOptions ( ) ; 
 if ( expectedOptions = = null ) 
 diff - - git a / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java b / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java 
 index 442e6cf . . 756b689 100644 
 - - - a / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java 
 + + + b / src / java / org / apache / cassandra / locator / NetworkTopologyStrategy . java 
 @ @ - 24 , 11 + 24 , 9 @ @ import java . util . Map . Entry ; 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ; 
 
 - import org . apache . cassandra . config . DatabaseDescriptor ; 
 import org . apache . cassandra . exceptions . ConfigurationException ; 
 import org . apache . cassandra . dht . Token ; 
 import org . apache . cassandra . locator . TokenMetadata . Topology ; 
 - import org . apache . cassandra . service . StorageService ; 
 import org . apache . cassandra . utils . FBUtilities ; 
 import org . apache . cassandra . utils . Pair ; 
 
 @ @ - 216 , 45 + 214 , 6 @ @ public class NetworkTopologyStrategy extends AbstractReplicationStrategy 
 return datacenters . keySet ( ) ; 
 } 
 
 - / * 
 - * ( non - javadoc ) Method to generate list of valid data center names to be used to validate the replication parameters during CREATE / ALTER keyspace operations . 
 - * All peers of current node are fetched from { @ link TokenMetadata } and then a set is build by fetching DC name of each peer . 
 - * @ return a set of valid DC names 
 - * / 
 - private static Set < String > buildValidDataCentersSet ( ) 
 - { 
 - final Set < String > validDataCenters = new HashSet < > ( ) ; 
 - final IEndpointSnitch snitch = DatabaseDescriptor . getEndpointSnitch ( ) ; 
 - 
 - / / Add data center of localhost . 
 - validDataCenters . add ( snitch . getDatacenter ( FBUtilities . getBroadcastAddress ( ) ) ) ; 
 - / / Fetch and add DCs of all peers . 
 - for ( final InetAddress peer : StorageService . instance . getTokenMetadata ( ) . getAllEndpoints ( ) ) 
 - { 
 - validDataCenters . add ( snitch . getDatacenter ( peer ) ) ; 
 - } 
 - 
 - return validDataCenters ; 
 - } 
 - 
 - public Collection < String > recognizedOptions ( ) 
 - { 
 - / / only valid options are valid DC names . 
 - return buildValidDataCentersSet ( ) ; 
 - } 
 - 
 - protected void validateExpectedOptions ( ) throws ConfigurationException 
 - { 
 - / / Do not accept query with no data centers specified . 
 - if ( this . configOptions . isEmpty ( ) ) 
 - { 
 - throw new ConfigurationException ( " Configuration for at least one datacenter must be present " ) ; 
 - } 
 - 
 - / / Validate the data center names 
 - super . validateExpectedOptions ( ) ; 
 - } 
 - 
 public void validateOptions ( ) throws ConfigurationException 
 { 
 for ( Entry < String , String > e : this . configOptions . entrySet ( ) ) 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / CQLTester . java b / test / unit / org / apache / cassandra / cql3 / CQLTester . java 
 index 29d51a8 . . 3bb753f 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / CQLTester . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / CQLTester . java 
 @ @ - 57 , 7 + 57 , 6 @ @ import org . apache . cassandra . dht . Murmur3Partitioner ; 
 import org . apache . cassandra . exceptions . ConfigurationException ; 
 import org . apache . cassandra . exceptions . SyntaxException ; 
 import org . apache . cassandra . io . util . FileUtils ; 
 - import org . apache . cassandra . locator . AbstractEndpointSnitch ; 
 import org . apache . cassandra . serializers . TypeSerializer ; 
 import org . apache . cassandra . service . ClientState ; 
 import org . apache . cassandra . service . QueryState ; 
 @ @ - 84 , 8 + 83 , 6 @ @ public abstract class CQLTester 
 protected static final long ROW _ CACHE _ SIZE _ IN _ MB = Integer . valueOf ( System . getProperty ( " cassandra . test . row _ cache _ size _ in _ mb " , " 0 " ) ) ; 
 private static final AtomicInteger seqNumber = new AtomicInteger ( ) ; 
 protected static final ByteBuffer TOO _ BIG = ByteBuffer . allocate ( FBUtilities . MAX _ UNSIGNED _ SHORT + 1024 ) ; 
 - public static final String DATA _ CENTER = " datacenter1 " ; 
 - public static final String RACK1 = " rack1 " ; 
 
 private static org . apache . cassandra . transport . Server server ; 
 protected static final int nativePort ; 
 @ @ - 118 , 14 + 115 , 6 @ @ public abstract class CQLTester 
 
 nativeAddr = InetAddress . getLoopbackAddress ( ) ; 
 
 - / / Register an EndpointSnitch which returns fixed values for test . 
 - DatabaseDescriptor . setEndpointSnitch ( new AbstractEndpointSnitch ( ) 
 - { 
 - @ Override public String getRack ( InetAddress endpoint ) { return RACK1 ; } 
 - @ Override public String getDatacenter ( InetAddress endpoint ) { return DATA _ CENTER ; } 
 - @ Override public int compareEndpoints ( InetAddress target , InetAddress a1 , InetAddress a2 ) { return 0 ; } 
 - } ) ; 
 - 
 try 
 { 
 try ( ServerSocket serverSocket = new ServerSocket ( 0 ) ) 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java 
 index 5af3ebb . . 5cb76c9 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / SecondaryIndexTest . java 
 @ @ - 246 , 6 + 246 , 16 @ @ public class SecondaryIndexTest extends CQLTester 
 } 
 
 / * * 
 + * Check one can use arbitrary name for datacenter when creating keyspace

NEAREST DIFF:
ELIMINATEDSENTENCE
