BLEU SCORE: 0.020980574531482755

TEST MSG: Fix upgradesstables NPE for non - CF - based indexes
GENERATED MSG: merge from 2 . 0

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index dfbe5c6 . . b260b49 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 6 <nl> + * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) <nl> * Improve nodetool cfhistograms formatting ( CASSANDRA - 6360 ) <nl> * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) <nl> * Correctly handle null with IF conditions and TTL ( CASSANDRA - 6623 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> index f3e993d . . e93efd1 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> @ @ - 63 , 7 + 63 , 7 @ @ public abstract class SecondaryIndexSearcher <nl> continue ; <nl> <nl> SecondaryIndex index = indexManager . getIndexForColumn ( expression . column _ name ) ; <nl> - if ( index = = null | | ( expression . op ! = IndexOperator . EQ ) ) <nl> + if ( index = = null | | index . getIndexCfs ( ) = = null | | expression . op ! = IndexOperator . EQ ) <nl> continue ; <nl> int columns = index . getIndexCfs ( ) . getMeanColumns ( ) ; <nl> candidates . put ( index , columns ) ; <nl> diff - - git a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> index aa35605 . . 90e7089 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> @ @ - 80 , 6 + 80 , 7 @ @ public class CompositesSearcher extends SecondaryIndexSearcher <nl> final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; <nl> final CompositesIndex index = ( CompositesIndex ) indexManager . getIndexForColumn ( primary . column _ name ) ; <nl> assert index ! = null ; <nl> + assert index . getIndexCfs ( ) ! = null ; <nl> final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> index e14f865 . . 5d82ba0 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> @ @ - 63 , 6 + 63 , 7 @ @ public class KeysSearcher extends SecondaryIndexSearcher <nl> final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; <nl> final SecondaryIndex index = indexManager . getIndexForColumn ( primary . column _ name ) ; <nl> assert index ! = null ; <nl> + assert index . getIndexCfs ( ) ! = null ; <nl> final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 9a6b50f . . 26846e7 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2297 , 8 + 2297 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> { <nl> for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) <nl> { <nl> - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> - valid . add ( si . getIndexCfs ( ) ) ; <nl> + if ( si . getIndexCfs ( ) ! = null ) { <nl> + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> + valid . add ( si . getIndexCfs ( ) ) ; <nl> + } <nl> } <nl> <nl> } <nl> @ @ - 2346 , 8 + 2348 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> { <nl> for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) <nl> { <nl> - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> - valid . add ( si . getIndexCfs ( ) ) ; <nl> + if ( si . getIndexCfs ( ) ! = null ) { <nl> + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> + valid . add ( si . getIndexCfs ( ) ) ; <nl> + } <nl> } <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / build . xml b / build . xml <nl> index 4d8ae14 . . 254cc2d 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 340 , 7 + 340 , 7 @ @ <nl> < dependency groupId = " com . google . guava " artifactId = " guava " version = " 13 . 0 . 1 " / > <nl> < dependency groupId = " commons - cli " artifactId = " commons - cli " version = " 1 . 1 " / > <nl> < dependency groupId = " commons - codec " artifactId = " commons - codec " version = " 1 . 2 " / > <nl> - < dependency groupId = " commons - lang " artifactId = " commons - lang " version = " 3 . 1 " / > <nl> + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " version = " 3 . 1 " / > <nl> < dependency groupId = " com . googlecode . concurrentlinkedhashmap " artifactId = " concurrentlinkedhashmap - lru " version = " 1 . 3 " / > <nl> < dependency groupId = " org . antlr " artifactId = " antlr " version = " 3 . 2 " / > <nl> < dependency groupId = " org . slf4j " artifactId = " slf4j - api " version = " 1 . 7 . 2 " / > <nl> @ @ - 438 , 7 + 438 , 7 @ @ <nl> < dependency groupId = " com . google . guava " artifactId = " guava " / > <nl> < dependency groupId = " commons - cli " artifactId = " commons - cli " / > <nl> < dependency groupId = " commons - codec " artifactId = " commons - codec " / > <nl> - < dependency groupId = " commons - lang " artifactId = " commons - lang " / > <nl> + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " / > <nl> < dependency groupId = " com . googlecode . concurrentlinkedhashmap " artifactId = " concurrentlinkedhashmap - lru " / > <nl> < dependency groupId = " org . antlr " artifactId = " antlr " / > <nl> < dependency groupId = " org . slf4j " artifactId = " slf4j - api " / > <nl> @ @ - 479 , 7 + 479 , 7 @ @ <nl> artifactId = " cassandra - parent " <nl> version = " $ { version } " / > <nl> < scm connection = " $ { scm . connection } " developerConnection = " $ { scm . developerConnection } " url = " $ { scm . url } " / > <nl> - < dependency groupId = " commons - lang " artifactId = " commons - lang " / > <nl> + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " / > <nl> < dependency groupId = " org . slf4j " artifactId = " slf4j - api " / > <nl> < dependency groupId = " org . apache . thrift " artifactId = " libthrift " / > <nl> < / artifact : pom >

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index dfbe5c6 . . b260b49 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 6 
 + * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) 
 * Improve nodetool cfhistograms formatting ( CASSANDRA - 6360 ) 
 * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) 
 * Correctly handle null with IF conditions and TTL ( CASSANDRA - 6623 ) 
 diff - - git a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 index f3e993d . . e93efd1 100644 
 - - - a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 @ @ - 63 , 7 + 63 , 7 @ @ public abstract class SecondaryIndexSearcher 
 continue ; 
 
 SecondaryIndex index = indexManager . getIndexForColumn ( expression . column _ name ) ; 
 - if ( index = = null | | ( expression . op ! = IndexOperator . EQ ) ) 
 + if ( index = = null | | index . getIndexCfs ( ) = = null | | expression . op ! = IndexOperator . EQ ) 
 continue ; 
 int columns = index . getIndexCfs ( ) . getMeanColumns ( ) ; 
 candidates . put ( index , columns ) ; 
 diff - - git a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 index aa35605 . . 90e7089 100644 
 - - - a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 @ @ - 80 , 6 + 80 , 7 @ @ public class CompositesSearcher extends SecondaryIndexSearcher 
 final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; 
 final CompositesIndex index = ( CompositesIndex ) indexManager . getIndexForColumn ( primary . column _ name ) ; 
 assert index ! = null ; 
 + assert index . getIndexCfs ( ) ! = null ; 
 final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; 
 
 if ( logger . isDebugEnabled ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 index e14f865 . . 5d82ba0 100644 
 - - - a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 @ @ - 63 , 6 + 63 , 7 @ @ public class KeysSearcher extends SecondaryIndexSearcher 
 final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; 
 final SecondaryIndex index = indexManager . getIndexForColumn ( primary . column _ name ) ; 
 assert index ! = null ; 
 + assert index . getIndexCfs ( ) ! = null ; 
 final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; 
 
 if ( logger . isDebugEnabled ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 9a6b50f . . 26846e7 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2297 , 8 + 2297 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 { 
 for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) 
 { 
 - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 - valid . add ( si . getIndexCfs ( ) ) ; 
 + if ( si . getIndexCfs ( ) ! = null ) { 
 + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 + valid . add ( si . getIndexCfs ( ) ) ; 
 + } 
 } 
 
 } 
 @ @ - 2346 , 8 + 2348 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 { 
 for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) 
 { 
 - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 - valid . add ( si . getIndexCfs ( ) ) ; 
 + if ( si . getIndexCfs ( ) ! = null ) { 
 + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 + valid . add ( si . getIndexCfs ( ) ) ; 
 + } 
 } 
 } 
 }

NEAREST DIFF:
diff - - git a / build . xml b / build . xml 
 index 4d8ae14 . . 254cc2d 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 340 , 7 + 340 , 7 @ @ 
 < dependency groupId = " com . google . guava " artifactId = " guava " version = " 13 . 0 . 1 " / > 
 < dependency groupId = " commons - cli " artifactId = " commons - cli " version = " 1 . 1 " / > 
 < dependency groupId = " commons - codec " artifactId = " commons - codec " version = " 1 . 2 " / > 
 - < dependency groupId = " commons - lang " artifactId = " commons - lang " version = " 3 . 1 " / > 
 + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " version = " 3 . 1 " / > 
 < dependency groupId = " com . googlecode . concurrentlinkedhashmap " artifactId = " concurrentlinkedhashmap - lru " version = " 1 . 3 " / > 
 < dependency groupId = " org . antlr " artifactId = " antlr " version = " 3 . 2 " / > 
 < dependency groupId = " org . slf4j " artifactId = " slf4j - api " version = " 1 . 7 . 2 " / > 
 @ @ - 438 , 7 + 438 , 7 @ @ 
 < dependency groupId = " com . google . guava " artifactId = " guava " / > 
 < dependency groupId = " commons - cli " artifactId = " commons - cli " / > 
 < dependency groupId = " commons - codec " artifactId = " commons - codec " / > 
 - < dependency groupId = " commons - lang " artifactId = " commons - lang " / > 
 + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " / > 
 < dependency groupId = " com . googlecode . concurrentlinkedhashmap " artifactId = " concurrentlinkedhashmap - lru " / > 
 < dependency groupId = " org . antlr " artifactId = " antlr " / > 
 < dependency groupId = " org . slf4j " artifactId = " slf4j - api " / > 
 @ @ - 479 , 7 + 479 , 7 @ @ 
 artifactId = " cassandra - parent " 
 version = " $ { version } " / > 
 < scm connection = " $ { scm . connection } " developerConnection = " $ { scm . developerConnection } " url = " $ { scm . url } " / > 
 - < dependency groupId = " commons - lang " artifactId = " commons - lang " / > 
 + < dependency groupId = " org . apache . commons " artifactId = " commons - lang3 " / > 
 < dependency groupId = " org . slf4j " artifactId = " slf4j - api " / > 
 < dependency groupId = " org . apache . thrift " artifactId = " libthrift " / > 
 < / artifact : pom >
