BLEU SCORE: 0.5946035575013605

TEST MSG: fixup CHANGES . txt
GENERATED MSG: fix CHANGES . txt

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 4a22af4 . . e231bf2 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 3 + 1 , 8 @ @ <nl> + 3 . 11 . 2 <nl> + Merged from 3 . 0 : <nl> + * Deserialise sstable metadata in nodetool verify ( CASSANDRA - 13922 ) <nl> + <nl> + <nl> 3 . 11 . 1 <nl> * Fix the computation of cdc _ total _ space _ in _ mb for exabyte filesystems ( CASSANDRA - 13808 ) <nl> * AbstractTokenTreeBuilder # serializedSize returns wrong value when there is a single leaf and overflow collisions ( CASSANDRA - 13869 ) <nl> @ @ - 12 , 7 + 17 , 6 @ @ <nl> * Duplicate the buffer before passing it to analyser in SASI operation ( CASSANDRA - 13512 ) <nl> * Properly evict pstmts from prepared statements cache ( CASSANDRA - 13641 ) <nl> Merged from 3 . 0 : <nl> - * Deserialise sstable metadata in nodetool verify ( CASSANDRA - 13922 ) <nl> * Improve TRUNCATE performance ( CASSANDRA - 13909 ) <nl> * Implement short read protection on partition boundaries ( CASSANDRA - 13595 ) <nl> * Fix ISE thrown by UPI . Serializer . hasNext ( ) for some SELECT queries ( CASSANDRA - 13911 )
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 8423e2f . . 7b4c4ca 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 3 , 6 + 3 , 7 @ @ <nl> * more efficient allocation of small bloom filters ( CASSANDRA - 3618 ) <nl> * CLibrary . createHardLinkWithExec ( ) to check for errors ( CASSANDRA - 3101 ) <nl> * fsync the directory after new sstable or commitlog segment are created ( CASSANDRA - 3250 ) <nl> + * Avoid creating empty and non cleaned writer during compaction ( CASSANDRA - 3616 ) <nl> Merged from 0 . 8 : <nl> * prevent new nodes from thinking down nodes are up forever ( CASSANDRA - 3626 ) <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionTask . java b / src / java / org / apache / cassandra / db / compaction / CompactionTask . java <nl> index fe85e89 . . a42b9ff 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / CompactionTask . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / CompactionTask . java <nl> @ @ - 175 , 9 + 175 , 12 @ @ public class CompactionTask extends AbstractCompactionTask <nl> SSTableReader toIndex = writer . closeAndOpenReader ( getMaxDataAge ( toCompact ) ) ; <nl> cachedKeyMap . put ( toIndex , cachedKeys ) ; <nl> sstables . add ( toIndex ) ; <nl> - writer = cfs . createCompactionWriter ( keysPerSSTable , compactionFileLocation , toCompact ) ; <nl> - writers . add ( writer ) ; <nl> - cachedKeys = new HashMap < DecoratedKey , Long > ( ) ; <nl> + if ( nni . hasNext ( ) ) <nl> + { <nl> + writer = cfs . createCompactionWriter ( keysPerSSTable , compactionFileLocation , toCompact ) ; <nl> + writers . add ( writer ) ; <nl> + cachedKeys = new HashMap < DecoratedKey , Long > ( ) ; <nl> + } <nl> } <nl> } <nl> }

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 4a22af4 . . e231bf2 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 3 + 1 , 8 @ @ 
 + 3 . 11 . 2 
 + Merged from 3 . 0 : 
 + * Deserialise sstable metadata in nodetool verify ( CASSANDRA - 13922 ) 
 + 
 + 
 3 . 11 . 1 
 * Fix the computation of cdc _ total _ space _ in _ mb for exabyte filesystems ( CASSANDRA - 13808 ) 
 * AbstractTokenTreeBuilder # serializedSize returns wrong value when there is a single leaf and overflow collisions ( CASSANDRA - 13869 ) 
 @ @ - 12 , 7 + 17 , 6 @ @ 
 * Duplicate the buffer before passing it to analyser in SASI operation ( CASSANDRA - 13512 ) 
 * Properly evict pstmts from prepared statements cache ( CASSANDRA - 13641 ) 
 Merged from 3 . 0 : 
 - * Deserialise sstable metadata in nodetool verify ( CASSANDRA - 13922 ) 
 * Improve TRUNCATE performance ( CASSANDRA - 13909 ) 
 * Implement short read protection on partition boundaries ( CASSANDRA - 13595 ) 
 * Fix ISE thrown by UPI . Serializer . hasNext ( ) for some SELECT queries ( CASSANDRA - 13911 )

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 8423e2f . . 7b4c4ca 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 3 , 6 + 3 , 7 @ @ 
 * more efficient allocation of small bloom filters ( CASSANDRA - 3618 ) 
 * CLibrary . createHardLinkWithExec ( ) to check for errors ( CASSANDRA - 3101 ) 
 * fsync the directory after new sstable or commitlog segment are created ( CASSANDRA - 3250 ) 
 + * Avoid creating empty and non cleaned writer during compaction ( CASSANDRA - 3616 ) 
 Merged from 0 . 8 : 
 * prevent new nodes from thinking down nodes are up forever ( CASSANDRA - 3626 ) 
 
 diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionTask . java b / src / java / org / apache / cassandra / db / compaction / CompactionTask . java 
 index fe85e89 . . a42b9ff 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / CompactionTask . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / CompactionTask . java 
 @ @ - 175 , 9 + 175 , 12 @ @ public class CompactionTask extends AbstractCompactionTask 
 SSTableReader toIndex = writer . closeAndOpenReader ( getMaxDataAge ( toCompact ) ) ; 
 cachedKeyMap . put ( toIndex , cachedKeys ) ; 
 sstables . add ( toIndex ) ; 
 - writer = cfs . createCompactionWriter ( keysPerSSTable , compactionFileLocation , toCompact ) ; 
 - writers . add ( writer ) ; 
 - cachedKeys = new HashMap < DecoratedKey , Long > ( ) ; 
 + if ( nni . hasNext ( ) ) 
 + { 
 + writer = cfs . createCompactionWriter ( keysPerSSTable , compactionFileLocation , toCompact ) ; 
 + writers . add ( writer ) ; 
 + cachedKeys = new HashMap < DecoratedKey , Long > ( ) ; 
 + } 
 } 
 } 
 }
