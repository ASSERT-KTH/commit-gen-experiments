BLEU SCORE: 1.0

TEST MSG: Fix encoding of cell names for super columns ( CASSANDRA - 12235 follow - up )
GENERATED MSG: Fix encoding of cell names for super columns ( CASSANDRA - 12235 follow - up )

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / LegacyLayout . java b / src / java / org / apache / cassandra / db / LegacyLayout . java <nl> index 3feb1f4 . . 1dd4c5d 100644 <nl> - - - a / src / java / org / apache / cassandra / db / LegacyLayout . java <nl> + + + b / src / java / org / apache / cassandra / db / LegacyLayout . java <nl> @ @ - 264 , 6 + 264 , 8 @ @ public abstract class LegacyLayout <nl> / / We use comparator . size ( ) rather than clustering . size ( ) because of static clusterings <nl> int clusteringSize = metadata . comparator . size ( ) ; <nl> int size = clusteringSize + ( metadata . isDense ( ) ? 0 : 1 ) + ( collectionElement = = null ? 0 : 1 ) ; <nl> + if ( metadata . isSuper ( ) ) <nl> + size = clusteringSize + 1 ; <nl> ByteBuffer [ ] values = new ByteBuffer [ size ] ; <nl> for ( int i = 0 ; i < clusteringSize ; i + + ) <nl> { <nl> @ @ - 282 , 10 + 284 , 23 @ @ public abstract class LegacyLayout <nl> values [ i ] = v ; <nl> } <nl> <nl> - if ( ! metadata . isDense ( ) ) <nl> - values [ clusteringSize ] = columnName ; <nl> - if ( collectionElement ! = null ) <nl> - values [ clusteringSize + 1 ] = collectionElement ; <nl> + if ( metadata . isSuper ( ) ) <nl> + { <nl> + / / We need to set the " column " ( in thrift terms ) name , i . e . the value corresponding to the subcomparator . <nl> + / / What it is depends if this a cell for a declared " static " column or a " dynamic " column part of the <nl> + / / super - column internal map . <nl> + assert columnName ! = null ; / / This should never be null for supercolumns , see decodeForSuperColumn ( ) above <nl> + values [ clusteringSize ] = columnName . equals ( CompactTables . SUPER _ COLUMN _ MAP _ COLUMN ) <nl> + ? collectionElement <nl> + : columnName ; <nl> + } <nl> + else <nl> + { <nl> + if ( ! metadata . isDense ( ) ) <nl> + values [ clusteringSize ] = columnName ; <nl> + if ( collectionElement ! = null ) <nl> + values [ clusteringSize + 1 ] = collectionElement ; <nl> + } <nl> <nl> return CompositeType . build ( isStatic , values ) ; <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / LegacyLayout . java b / src / java / org / apache / cassandra / db / LegacyLayout . java 
 index 3feb1f4 . . 1dd4c5d 100644 
 - - - a / src / java / org / apache / cassandra / db / LegacyLayout . java 
 + + + b / src / java / org / apache / cassandra / db / LegacyLayout . java 
 @ @ - 264 , 6 + 264 , 8 @ @ public abstract class LegacyLayout 
 / / We use comparator . size ( ) rather than clustering . size ( ) because of static clusterings 
 int clusteringSize = metadata . comparator . size ( ) ; 
 int size = clusteringSize + ( metadata . isDense ( ) ? 0 : 1 ) + ( collectionElement = = null ? 0 : 1 ) ; 
 + if ( metadata . isSuper ( ) ) 
 + size = clusteringSize + 1 ; 
 ByteBuffer [ ] values = new ByteBuffer [ size ] ; 
 for ( int i = 0 ; i < clusteringSize ; i + + ) 
 { 
 @ @ - 282 , 10 + 284 , 23 @ @ public abstract class LegacyLayout 
 values [ i ] = v ; 
 } 
 
 - if ( ! metadata . isDense ( ) ) 
 - values [ clusteringSize ] = columnName ; 
 - if ( collectionElement ! = null ) 
 - values [ clusteringSize + 1 ] = collectionElement ; 
 + if ( metadata . isSuper ( ) ) 
 + { 
 + / / We need to set the " column " ( in thrift terms ) name , i . e . the value corresponding to the subcomparator . 
 + / / What it is depends if this a cell for a declared " static " column or a " dynamic " column part of the 
 + / / super - column internal map . 
 + assert columnName ! = null ; / / This should never be null for supercolumns , see decodeForSuperColumn ( ) above 
 + values [ clusteringSize ] = columnName . equals ( CompactTables . SUPER _ COLUMN _ MAP _ COLUMN ) 
 + ? collectionElement 
 + : columnName ; 
 + } 
 + else 
 + { 
 + if ( ! metadata . isDense ( ) ) 
 + values [ clusteringSize ] = columnName ; 
 + if ( collectionElement ! = null ) 
 + values [ clusteringSize + 1 ] = collectionElement ; 
 + } 
 
 return CompositeType . build ( isStatic , values ) ; 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
