BLEU SCORE: 0.02383853510228548

TEST MSG: Add support for UPDATE . . . IF EXISTS
GENERATED MSG: CAS on ' primary key only ' table

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 375dcfe . . f4c96dc 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 13 : <nl> + * Add support for UPDATE . . . IF EXISTS ( CASSANDRA - 8610 ) <nl> * Fix reversal of list prepends ( CASSANDRA - 8733 ) <nl> * Prevent non - zero default _ time _ to _ live on tables with counters <nl> ( CASSANDRA - 8678 ) <nl> diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py <nl> index 0b7863c . . 9e9b6ad 100644 <nl> - - - a / pylib / cqlshlib / cql3handling . py <nl> + + + b / pylib / cqlshlib / cql3handling . py <nl> @ @ - 15 , 7 + 15 , 6 @ @ <nl> # limitations under the License . <nl> <nl> import re <nl> - from warnings import warn <nl> from . cqlhandling import CqlParsingRuleSet , Hint <nl> from cql . cqltypes import ( cql _ types , lookup _ casstype , CompositeType , UTF8Type , <nl> ColumnToCollectionType , CounterColumnType , DateType ) <nl> @ @ - 715 , 6 + 714 , 7 @ @ syntax _ rules + = r ' ' ' <nl> ( " AND " [ updateopt ] = < usingOption > ) * ) ? <nl> " SET " < assignment > ( " , " < assignment > ) * <nl> " WHERE " < whereClause > <nl> + ( " IF " " EXISTS " ) ? <nl> ; <nl> < assignment > : : = updatecol = < cident > <nl> ( " = " update _ rhs = ( < value > | < cident > ) <nl> diff - - git a / pylib / cqlshlib / helptopics . py b / pylib / cqlshlib / helptopics . py <nl> index 2af8db2 . . 0b08726 100644 <nl> - - - a / pylib / cqlshlib / helptopics . py <nl> + + + b / pylib / cqlshlib / helptopics . py <nl> @ @ - 563 , 7 + 563 , 8 @ @ class CQL3HelpTopics ( CQLHelpTopics ) : <nl> UPDATE [ < keyspace > . ] < columnFamily > <nl> [ USING [ TIMESTAMP < timestamp > ] <nl> [ AND TTL < timeToLive > ] ] <nl> - SET name1 = value1 , name2 = value2 WHERE < keycol > = keyval ; <nl> + SET name1 = value1 , name2 = value2 WHERE < keycol > = keyval <nl> + [ IF EXISTS ] ; <nl> <nl> An UPDATE is used to write one or more columns to a record in a table . <nl> No results are returned . The record ' s primary key must be completely <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / Cql . g b / src / java / org / apache / cassandra / cql3 / Cql . g <nl> index a80746c . . 0595c25 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / Cql . g <nl> + + + b / src / java / org / apache / cassandra / cql3 / Cql . g <nl> @ @ - 360 , 18 + 360 , 20 @ @ updateStatement returns [ UpdateStatement . ParsedUpdate expr ] <nl> @ init { <nl> Attributes . Raw attrs = new Attributes . Raw ( ) ; <nl> List < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > operations = new ArrayList < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > ( ) ; <nl> + boolean ifExists = false ; <nl> } <nl> : K _ UPDATE cf = columnFamilyName <nl> ( usingClause [ attrs ] ) ? <nl> K _ SET columnOperation [ operations ] ( ' , ' columnOperation [ operations ] ) * <nl> K _ WHERE wclause = whereClause <nl> - ( K _ IF conditions = updateConditions ) ? <nl> + ( K _ IF ( K _ EXISTS { ifExists = true ; } | conditions = updateConditions ) ) ? <nl> { <nl> return new UpdateStatement . ParsedUpdate ( cf , <nl> attrs , <nl> operations , <nl> wclause , <nl> - conditions = = null ? Collections . < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > emptyList ( ) : conditions ) ; <nl> + conditions = = null ? Collections . < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > emptyList ( ) : conditions , <nl> + ifExists ) ; <nl> } <nl> ; <nl> <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> index 9d98c84 . . 594b5db 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> @ @ - 207 , 14 + 207 , 16 @ @ public class UpdateStatement extends ModificationStatement <nl> * @ param attrs additional attributes for statement ( timestamp , timeToLive ) <nl> * @ param updates a map of column operations to perform <nl> * @ param whereClause the where clause <nl> - * / <nl> + * @ param ifExists flag to check if row exists <nl> + * * / <nl> public ParsedUpdate ( CFName name , <nl> Attributes . Raw attrs , <nl> List < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > updates , <nl> List < Relation > whereClause , <nl> - List < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > conditions ) <nl> + List < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > conditions , <nl> + boolean ifExists ) <nl> { <nl> - super ( name , attrs , conditions , false , false ) ; <nl> + super ( name , attrs , conditions , false , ifExists ) ; <nl> this . updates = updates ; <nl> this . whereClause = whereClause ; <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java <nl> index 2637498 . . 458fa53 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / CliClient . java <nl> + + + b / src / java / org / apache / cassandra / cli / CliClient . java <nl> @ @ - 194 , 6 + 194 , 10 @ @ public class CliClient <nl> public void printBanner ( ) <nl> { <nl> sessionState . out . println ( " Welcome to Cassandra CLI version " + FBUtilities . getReleaseVersionString ( ) + " \ n " ) ; <nl> + <nl> + sessionState . out . println ( " Please consider using the more convenient cqlsh instead of CLI " ) ; <nl> + sessionState . out . println ( " CQL3 is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; <nl> + <nl> sessionState . out . println ( getHelp ( ) . banner ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 375dcfe . . f4c96dc 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 13 : 
 + * Add support for UPDATE . . . IF EXISTS ( CASSANDRA - 8610 ) 
 * Fix reversal of list prepends ( CASSANDRA - 8733 ) 
 * Prevent non - zero default _ time _ to _ live on tables with counters 
 ( CASSANDRA - 8678 ) 
 diff - - git a / pylib / cqlshlib / cql3handling . py b / pylib / cqlshlib / cql3handling . py 
 index 0b7863c . . 9e9b6ad 100644 
 - - - a / pylib / cqlshlib / cql3handling . py 
 + + + b / pylib / cqlshlib / cql3handling . py 
 @ @ - 15 , 7 + 15 , 6 @ @ 
 # limitations under the License . 
 
 import re 
 - from warnings import warn 
 from . cqlhandling import CqlParsingRuleSet , Hint 
 from cql . cqltypes import ( cql _ types , lookup _ casstype , CompositeType , UTF8Type , 
 ColumnToCollectionType , CounterColumnType , DateType ) 
 @ @ - 715 , 6 + 714 , 7 @ @ syntax _ rules + = r ' ' ' 
 ( " AND " [ updateopt ] = < usingOption > ) * ) ? 
 " SET " < assignment > ( " , " < assignment > ) * 
 " WHERE " < whereClause > 
 + ( " IF " " EXISTS " ) ? 
 ; 
 < assignment > : : = updatecol = < cident > 
 ( " = " update _ rhs = ( < value > | < cident > ) 
 diff - - git a / pylib / cqlshlib / helptopics . py b / pylib / cqlshlib / helptopics . py 
 index 2af8db2 . . 0b08726 100644 
 - - - a / pylib / cqlshlib / helptopics . py 
 + + + b / pylib / cqlshlib / helptopics . py 
 @ @ - 563 , 7 + 563 , 8 @ @ class CQL3HelpTopics ( CQLHelpTopics ) : 
 UPDATE [ < keyspace > . ] < columnFamily > 
 [ USING [ TIMESTAMP < timestamp > ] 
 [ AND TTL < timeToLive > ] ] 
 - SET name1 = value1 , name2 = value2 WHERE < keycol > = keyval ; 
 + SET name1 = value1 , name2 = value2 WHERE < keycol > = keyval 
 + [ IF EXISTS ] ; 
 
 An UPDATE is used to write one or more columns to a record in a table . 
 No results are returned . The record ' s primary key must be completely 
 diff - - git a / src / java / org / apache / cassandra / cql3 / Cql . g b / src / java / org / apache / cassandra / cql3 / Cql . g 
 index a80746c . . 0595c25 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / Cql . g 
 + + + b / src / java / org / apache / cassandra / cql3 / Cql . g 
 @ @ - 360 , 18 + 360 , 20 @ @ updateStatement returns [ UpdateStatement . ParsedUpdate expr ] 
 @ init { 
 Attributes . Raw attrs = new Attributes . Raw ( ) ; 
 List < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > operations = new ArrayList < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > ( ) ; 
 + boolean ifExists = false ; 
 } 
 : K _ UPDATE cf = columnFamilyName 
 ( usingClause [ attrs ] ) ? 
 K _ SET columnOperation [ operations ] ( ' , ' columnOperation [ operations ] ) * 
 K _ WHERE wclause = whereClause 
 - ( K _ IF conditions = updateConditions ) ? 
 + ( K _ IF ( K _ EXISTS { ifExists = true ; } | conditions = updateConditions ) ) ? 
 { 
 return new UpdateStatement . ParsedUpdate ( cf , 
 attrs , 
 operations , 
 wclause , 
 - conditions = = null ? Collections . < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > emptyList ( ) : conditions ) ; 
 + conditions = = null ? Collections . < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > emptyList ( ) : conditions , 
 + ifExists ) ; 
 } 
 ; 
 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 index 9d98c84 . . 594b5db 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 @ @ - 207 , 14 + 207 , 16 @ @ public class UpdateStatement extends ModificationStatement 
 * @ param attrs additional attributes for statement ( timestamp , timeToLive ) 
 * @ param updates a map of column operations to perform 
 * @ param whereClause the where clause 
 - * / 
 + * @ param ifExists flag to check if row exists 
 + * * / 
 public ParsedUpdate ( CFName name , 
 Attributes . Raw attrs , 
 List < Pair < ColumnIdentifier . Raw , Operation . RawUpdate > > updates , 
 List < Relation > whereClause , 
 - List < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > conditions ) 
 + List < Pair < ColumnIdentifier . Raw , ColumnCondition . Raw > > conditions , 
 + boolean ifExists ) 
 { 
 - super ( name , attrs , conditions , false , false ) ; 
 + super ( name , attrs , conditions , false , ifExists ) ; 
 this . updates = updates ; 
 this . whereClause = whereClause ; 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java 
 index 2637498 . . 458fa53 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliClient . java 
 + + + b / src / java / org / apache / cassandra / cli / CliClient . java 
 @ @ - 194 , 6 + 194 , 10 @ @ public class CliClient 
 public void printBanner ( ) 
 { 
 sessionState . out . println ( " Welcome to Cassandra CLI version " + FBUtilities . getReleaseVersionString ( ) + " \ n " ) ; 
 + 
 + sessionState . out . println ( " Please consider using the more convenient cqlsh instead of CLI " ) ; 
 + sessionState . out . println ( " CQL3 is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; 
 + 
 sessionState . out . println ( getHelp ( ) . banner ) ; 
 } 

