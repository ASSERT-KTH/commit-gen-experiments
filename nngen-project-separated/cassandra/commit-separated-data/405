BLEU SCORE: 0.04923026124015933

TEST MSG: Fix cqlsh automatic protocol downgrade regression
GENERATED MSG: ( cqlsh ) Add request timeout option to cqlsh

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index dae275f . . adbaf84 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 52 , 6 + 52 , 7 @ @ <nl> * cqlsh auto completion : refactor definition of compaction strategy options ( CASSANDRA - 12946 ) <nl> * Add support for arithmetic operators ( CASSANDRA - 11935 ) <nl> * Add histogram for delay to deliver hints ( CASSANDRA - 13234 ) <nl> + * Fix cqlsh automatic protocol downgrade regression ( CASSANDRA - 13307 ) <nl> <nl> <nl> 3 . 11 . 0 <nl> diff - - git a / bin / cqlsh . py b / bin / cqlsh . py <nl> index bd62072 . . 28e8043 100644 <nl> - - - a / bin / cqlsh . py <nl> + + + b / bin / cqlsh . py <nl> @ @ - 178 , 7 + 178 , 6 @ @ from cqlshlib . util import get _ file _ encoding _ bomsize , trim _ if _ present <nl> DEFAULT _ HOST = ' 127 . 0 . 0 . 1 ' <nl> DEFAULT _ PORT = 9042 <nl> DEFAULT _ SSL = False <nl> - DEFAULT _ PROTOCOL _ VERSION = 4 <nl> DEFAULT _ CONNECT _ TIMEOUT _ SECONDS = 5 <nl> DEFAULT _ REQUEST _ TIMEOUT _ SECONDS = 10 <nl> <nl> @ @ - 223 , 6 + 222 , 9 @ @ parser . add _ option ( ' - - cqlversion ' , default = None , <nl> help = ' Specify a particular CQL version , ' <nl> ' by default the highest version supported by the server will be used . ' <nl> ' Examples : " 3 . 0 . 3 " , " 3 . 1 . 0 " ' ) <nl> + parser . add _ option ( " - - protocol - version " , type = " int " , default = None , <nl> + help = ' Specify a specific protcol version otherwise the client will default and downgrade as necessary ' ) <nl> + <nl> parser . add _ option ( " - e " , " - - execute " , help = ' Execute the statement and quit . ' ) <nl> parser . add _ option ( " - - connect - timeout " , default = DEFAULT _ CONNECT _ TIMEOUT _ SECONDS , dest = ' connect _ timeout ' , <nl> help = ' Specify the connection timeout in seconds ( default : % default seconds ) . ' ) <nl> @ @ - 449 , 7 + 451 , 7 @ @ class Shell ( cmd . Cmd ) : <nl> ssl = False , <nl> single _ statement = None , <nl> request _ timeout = DEFAULT _ REQUEST _ TIMEOUT _ SECONDS , <nl> - protocol _ version = DEFAULT _ PROTOCOL _ VERSION , <nl> + protocol _ version = None , <nl> connect _ timeout = DEFAULT _ CONNECT _ TIMEOUT _ SECONDS ) : <nl> cmd . Cmd . _ _ init _ _ ( self , completekey = completekey ) <nl> self . hostname = hostname <nl> @ @ - 468 , 13 + 470 , 16 @ @ class Shell ( cmd . Cmd ) : <nl> if use _ conn : <nl> self . conn = use _ conn <nl> else : <nl> + kwargs = { } <nl> + if protocol _ version is not None : <nl> + kwargs [ ' protocol _ version ' ] = protocol _ version <nl> self . conn = Cluster ( contact _ points = ( self . hostname , ) , port = self . port , cql _ version = cqlver , <nl> - protocol _ version = protocol _ version , <nl> auth _ provider = self . auth _ provider , <nl> ssl _ options = sslhandling . ssl _ settings ( hostname , CONFIG _ FILE ) if ssl else None , <nl> load _ balancing _ policy = WhiteListRoundRobinPolicy ( [ self . hostname ] ) , <nl> control _ connection _ timeout = connect _ timeout , <nl> - connect _ timeout = connect _ timeout ) <nl> + connect _ timeout = connect _ timeout , <nl> + * * kwargs ) <nl> self . owns _ connection = not use _ conn <nl> <nl> if keyspace : <nl> @ @ - 1673 , 9 + 1678 , 9 @ @ class Shell ( cmd . Cmd ) : <nl> <nl> direction = parsed . get _ binding ( ' dir ' ) . upper ( ) <nl> if direction = = ' FROM ' : <nl> - task = ImportTask ( self , ks , table , columns , fname , opts , DEFAULT _ PROTOCOL _ VERSION , CONFIG _ FILE ) <nl> + task = ImportTask ( self , ks , table , columns , fname , opts , self . conn . protocol _ version , CONFIG _ FILE ) <nl> elif direction = = ' TO ' : <nl> - task = ExportTask ( self , ks , table , columns , fname , opts , DEFAULT _ PROTOCOL _ VERSION , CONFIG _ FILE ) <nl> + task = ExportTask ( self , ks , table , columns , fname , opts , self . conn . protocol _ version , CONFIG _ FILE ) <nl> else : <nl> raise SyntaxError ( " Unknown direction % s " % direction ) <nl> <nl> @ @ - 2231 , 6 + 2236 , 7 @ @ def read _ options ( cmdlineargs , environment ) : <nl> optvalues . encoding = option _ with _ default ( configs . get , ' ui ' , ' encoding ' , UTF8 ) <nl> <nl> optvalues . tty = option _ with _ default ( configs . getboolean , ' ui ' , ' tty ' , sys . stdin . isatty ( ) ) <nl> + optvalues . protocol _ version = option _ with _ default ( configs . getint , ' protocol ' , ' version ' , None ) <nl> optvalues . cqlversion = option _ with _ default ( configs . get , ' cql ' , ' version ' , None ) <nl> optvalues . connect _ timeout = option _ with _ default ( configs . getint , ' connection ' , ' timeout ' , DEFAULT _ CONNECT _ TIMEOUT _ SECONDS ) <nl> optvalues . request _ timeout = option _ with _ default ( configs . getint , ' connection ' , ' request _ timeout ' , DEFAULT _ REQUEST _ TIMEOUT _ SECONDS ) <nl> @ @ - 2384 , 6 + 2390 , 7 @ @ def main ( options , hostname , port ) : <nl> tty = options . tty , <nl> completekey = options . completekey , <nl> browser = options . browser , <nl> + protocol _ version = options . protocol _ version , <nl> cqlver = options . cqlversion , <nl> keyspace = options . keyspace , <nl> display _ timestamp _ format = options . time _ format ,
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index dae275f . . adbaf84 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 52 , 6 + 52 , 7 @ @ 
 * cqlsh auto completion : refactor definition of compaction strategy options ( CASSANDRA - 12946 ) 
 * Add support for arithmetic operators ( CASSANDRA - 11935 ) 
 * Add histogram for delay to deliver hints ( CASSANDRA - 13234 ) 
 + * Fix cqlsh automatic protocol downgrade regression ( CASSANDRA - 13307 ) 
 
 
 3 . 11 . 0 
 diff - - git a / bin / cqlsh . py b / bin / cqlsh . py 
 index bd62072 . . 28e8043 100644 
 - - - a / bin / cqlsh . py 
 + + + b / bin / cqlsh . py 
 @ @ - 178 , 7 + 178 , 6 @ @ from cqlshlib . util import get _ file _ encoding _ bomsize , trim _ if _ present 
 DEFAULT _ HOST = ' 127 . 0 . 0 . 1 ' 
 DEFAULT _ PORT = 9042 
 DEFAULT _ SSL = False 
 - DEFAULT _ PROTOCOL _ VERSION = 4 
 DEFAULT _ CONNECT _ TIMEOUT _ SECONDS = 5 
 DEFAULT _ REQUEST _ TIMEOUT _ SECONDS = 10 
 
 @ @ - 223 , 6 + 222 , 9 @ @ parser . add _ option ( ' - - cqlversion ' , default = None , 
 help = ' Specify a particular CQL version , ' 
 ' by default the highest version supported by the server will be used . ' 
 ' Examples : " 3 . 0 . 3 " , " 3 . 1 . 0 " ' ) 
 + parser . add _ option ( " - - protocol - version " , type = " int " , default = None , 
 + help = ' Specify a specific protcol version otherwise the client will default and downgrade as necessary ' ) 
 + 
 parser . add _ option ( " - e " , " - - execute " , help = ' Execute the statement and quit . ' ) 
 parser . add _ option ( " - - connect - timeout " , default = DEFAULT _ CONNECT _ TIMEOUT _ SECONDS , dest = ' connect _ timeout ' , 
 help = ' Specify the connection timeout in seconds ( default : % default seconds ) . ' ) 
 @ @ - 449 , 7 + 451 , 7 @ @ class Shell ( cmd . Cmd ) : 
 ssl = False , 
 single _ statement = None , 
 request _ timeout = DEFAULT _ REQUEST _ TIMEOUT _ SECONDS , 
 - protocol _ version = DEFAULT _ PROTOCOL _ VERSION , 
 + protocol _ version = None , 
 connect _ timeout = DEFAULT _ CONNECT _ TIMEOUT _ SECONDS ) : 
 cmd . Cmd . _ _ init _ _ ( self , completekey = completekey ) 
 self . hostname = hostname 
 @ @ - 468 , 13 + 470 , 16 @ @ class Shell ( cmd . Cmd ) : 
 if use _ conn : 
 self . conn = use _ conn 
 else : 
 + kwargs = { } 
 + if protocol _ version is not None : 
 + kwargs [ ' protocol _ version ' ] = protocol _ version 
 self . conn = Cluster ( contact _ points = ( self . hostname , ) , port = self . port , cql _ version = cqlver , 
 - protocol _ version = protocol _ version , 
 auth _ provider = self . auth _ provider , 
 ssl _ options = sslhandling . ssl _ settings ( hostname , CONFIG _ FILE ) if ssl else None , 
 load _ balancing _ policy = WhiteListRoundRobinPolicy ( [ self . hostname ] ) , 
 control _ connection _ timeout = connect _ timeout , 
 - connect _ timeout = connect _ timeout ) 
 + connect _ timeout = connect _ timeout , 
 + * * kwargs ) 
 self . owns _ connection = not use _ conn 
 
 if keyspace : 
 @ @ - 1673 , 9 + 1678 , 9 @ @ class Shell ( cmd . Cmd ) : 
 
 direction = parsed . get _ binding ( ' dir ' ) . upper ( ) 
 if direction = = ' FROM ' : 
 - task = ImportTask ( self , ks , table , columns , fname , opts , DEFAULT _ PROTOCOL _ VERSION , CONFIG _ FILE ) 
 + task = ImportTask ( self , ks , table , columns , fname , opts , self . conn . protocol _ version , CONFIG _ FILE ) 
 elif direction = = ' TO ' : 
 - task = ExportTask ( self , ks , table , columns , fname , opts , DEFAULT _ PROTOCOL _ VERSION , CONFIG _ FILE ) 
 + task = ExportTask ( self , ks , table , columns , fname , opts , self . conn . protocol _ version , CONFIG _ FILE ) 
 else : 
 raise SyntaxError ( " Unknown direction % s " % direction ) 
 
 @ @ - 2231 , 6 + 2236 , 7 @ @ def read _ options ( cmdlineargs , environment ) : 
 optvalues . encoding = option _ with _ default ( configs . get , ' ui ' , ' encoding ' , UTF8 ) 
 
 optvalues . tty = option _ with _ default ( configs . getboolean , ' ui ' , ' tty ' , sys . stdin . isatty ( ) ) 
 + optvalues . protocol _ version = option _ with _ default ( configs . getint , ' protocol ' , ' version ' , None ) 
 optvalues . cqlversion = option _ with _ default ( configs . get , ' cql ' , ' version ' , None ) 
 optvalues . connect _ timeout = option _ with _ default ( configs . getint , ' connection ' , ' timeout ' , DEFAULT _ CONNECT _ TIMEOUT _ SECONDS ) 
 optvalues . request _ timeout = option _ with _ default ( configs . getint , ' connection ' , ' request _ timeout ' , DEFAULT _ REQUEST _ TIMEOUT _ SECONDS ) 
 @ @ - 2384 , 6 + 2390 , 7 @ @ def main ( options , hostname , port ) : 
 tty = options . tty , 
 completekey = options . completekey , 
 browser = options . browser , 
 + protocol _ version = options . protocol _ version , 
 cqlver = options . cqlversion , 
 keyspace = options . keyspace , 
 display _ timestamp _ format = options . time _ format ,

NEAREST DIFF:
ELIMINATEDSENTENCE
