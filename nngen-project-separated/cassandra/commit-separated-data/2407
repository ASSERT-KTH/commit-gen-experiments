BLEU SCORE: 0.04844232281716619

TEST MSG: close segments in resetUnsafe
GENERATED MSG: add filename check for commitlog replay

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java <nl> index 5802e8a . . 117b9d1 100644 <nl> - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java <nl> + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java <nl> @ @ - 484 , 8 + 484 , 14 @ @ public class CommitLogSegmentManager <nl> while ( ! segmentManagementTasks . isEmpty ( ) ) <nl> Thread . yield ( ) ; <nl> <nl> + for ( CommitLogSegment segment : activeSegments ) <nl> + segment . close ( ) ; <nl> activeSegments . clear ( ) ; <nl> + <nl> + for ( CommitLogSegment segment : availableSegments ) <nl> + segment . close ( ) ; <nl> availableSegments . clear ( ) ; <nl> + <nl> allocatingFrom = null ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLog . java b / src / java / org / apache / cassandra / db / commitlog / CommitLog . java <nl> index ab45ff7 . . 7cf0a9f 100644 <nl> - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLog . java <nl> + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLog . java <nl> @ @ - 161 , 8 + 161 , 7 @ @ public class CommitLog <nl> { <nl> public boolean accept ( File dir , String name ) <nl> { <nl> - / / throw out anything that starts with dot . <nl> - return ! name . matches ( " \ \ . . * " ) ; <nl> + return CommitLogSegment . possibleCommitLogFile ( name ) ; <nl> } <nl> } ) ; <nl> if ( files . length = = 0 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> index ec54e6e . . bec2698 100644 <nl> - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> @ @ - 63 , 6 + 63 , 11 @ @ public class CommitLogSegment <nl> } <nl> } <nl> <nl> + public static boolean possibleCommitLogFile ( String filename ) <nl> + { <nl> + return filename . matches ( " CommitLog - \ \ d + . log " ) ; <nl> + } <nl> + <nl> public void writeHeader ( ) throws IOException <nl> { <nl> seekAndWriteCommitLogHeader ( header . toByteArray ( ) ) ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java 
 index 5802e8a . . 117b9d1 100644 
 - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java 
 + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegmentManager . java 
 @ @ - 484 , 8 + 484 , 14 @ @ public class CommitLogSegmentManager 
 while ( ! segmentManagementTasks . isEmpty ( ) ) 
 Thread . yield ( ) ; 
 
 + for ( CommitLogSegment segment : activeSegments ) 
 + segment . close ( ) ; 
 activeSegments . clear ( ) ; 
 + 
 + for ( CommitLogSegment segment : availableSegments ) 
 + segment . close ( ) ; 
 availableSegments . clear ( ) ; 
 + 
 allocatingFrom = null ; 
 } 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLog . java b / src / java / org / apache / cassandra / db / commitlog / CommitLog . java 
 index ab45ff7 . . 7cf0a9f 100644 
 - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLog . java 
 + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLog . java 
 @ @ - 161 , 8 + 161 , 7 @ @ public class CommitLog 
 { 
 public boolean accept ( File dir , String name ) 
 { 
 - / / throw out anything that starts with dot . 
 - return ! name . matches ( " \ \ . . * " ) ; 
 + return CommitLogSegment . possibleCommitLogFile ( name ) ; 
 } 
 } ) ; 
 if ( files . length = = 0 ) 
 diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 index ec54e6e . . bec2698 100644 
 - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 @ @ - 63 , 6 + 63 , 11 @ @ public class CommitLogSegment 
 } 
 } 
 
 + public static boolean possibleCommitLogFile ( String filename ) 
 + { 
 + return filename . matches ( " CommitLog - \ \ d + . log " ) ; 
 + } 
 + 
 public void writeHeader ( ) throws IOException 
 { 
 seekAndWriteCommitLogHeader ( header . toByteArray ( ) ) ;
