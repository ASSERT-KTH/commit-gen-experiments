BLEU SCORE: 0.017110488113633058

TEST MSG: Nodetool import row cache invalidation races with adding sstables to tracker
GENERATED MSG: Add five - minute delay before starting compactions on a restarted server

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index fd236a2 . . 9ead7e6 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 4 . 0 <nl> + * Nodetool import row cache invalidation races with adding sstables to tracker ( CASSANDRA - 14529 ) <nl> * Fix assertions in LWTs after TableMetadata was made immutable ( CASSANDRA - 14356 ) <nl> * Abort compactions quicker ( CASSANDRA - 14397 ) <nl> * Support light - weight transactions in cassandra - stress ( CASSANDRA - 13529 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / SSTableImporter . java b / src / java / org / apache / cassandra / db / SSTableImporter . java <nl> index e9f6fe6 . . c919d25 100644 <nl> - - - a / src / java / org / apache / cassandra / db / SSTableImporter . java <nl> + + + b / src / java / org / apache / cassandra / db / SSTableImporter . java <nl> @ @ - 134 , 8 + 134 , 7 @ @ public class SSTableImporter <nl> Descriptor oldDescriptor = entry . getKey ( ) ; <nl> if ( currentDescriptors . contains ( oldDescriptor ) ) <nl> continue ; <nl> - if ( options . invalidateCaches & & cfs . isRowCacheEnabled ( ) ) <nl> - invalidateCachesForSSTable ( oldDescriptor ) ; <nl> + <nl> File targetDir = getTargetDirectory ( dir , oldDescriptor , entry . getValue ( ) ) ; <nl> Descriptor newDescriptor = cfs . getUniqueDescriptorFor ( entry . getKey ( ) , targetDir ) ; <nl> maybeMutateMetadata ( entry . getKey ( ) , options ) ; <nl> @ @ - 176 , 6 + 175 , 12 @ @ public class SSTableImporter <nl> try ( Refs < SSTableReader > refs = Refs . ref ( newSSTables ) ) <nl> { <nl> cfs . getTracker ( ) . addSSTables ( newSSTables ) ; <nl> + for ( SSTableReader reader : newSSTables ) <nl> + { <nl> + if ( options . invalidateCaches & & cfs . isRowCacheEnabled ( ) ) <nl> + invalidateCachesForSSTable ( reader . descriptor ) ; <nl> + } <nl> + <nl> } <nl> <nl> logger . info ( " Done loading load new SSTables for { } / { } " , cfs . keyspace . getName ( ) , cfs . getTableName ( ) ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index fce741b . . da14eee 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 4 @ @ <nl> - 1 . 0 <nl> + 1 . 0 . 0 - beta1 <nl> * removed binarymemtable ( CASSANDRA - 2692 ) <nl> * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) <nl> * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 ) <nl> diff - - git a / build . xml b / build . xml <nl> index c9aceb6 . . 823617d 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 25 , 7 + 25 , 7 @ @ <nl> < property name = " debuglevel " value = " source , lines , vars " / > <nl> <nl> < ! - - default version and SCM information ( we need the default SCM info as people may checkout with git - svn ) - - > <nl> - < property name = " base . version " value = " 1 . 0 " / > <nl> + < property name = " base . version " value = " 1 . 0 . 0 - beta1 " / > <nl> < property name = " scm . default . path " value = " cassandra / branches / cassandra - 1 . 0 . 0 " / > <nl> < property name = " scm . default . connection " value = " scm : svn : http : / / svn . apache . org / repos / asf / $ { scm . default . path } " / > <nl> < property name = " scm . default . developerConnection " value = " scm : svn : https : / / svn . apache . org / repos / asf / $ { scm . default . path } " / > <nl> diff - - git a / debian / changelog b / debian / changelog <nl> index 9bdd0cf . . 12e2c1a 100644 <nl> - - - a / debian / changelog <nl> + + + b / debian / changelog <nl> @ @ - 1 , 3 + 1 , 9 @ @ <nl> + cassandra ( 1 . 0 . 0 - beta1 ) unstable ; urgency = low <nl> + <nl> + * New beta release <nl> + <nl> + - - Sylvain Lebresne < slebresne @ apache . org > Wed , 14 Sep 2011 11 : 07 : 47 + 0200 <nl> + <nl> cassandra ( 0 . 8 . 1 ) unstable ; urgency = low <nl> <nl> * New release

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index fd236a2 . . 9ead7e6 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 4 . 0 
 + * Nodetool import row cache invalidation races with adding sstables to tracker ( CASSANDRA - 14529 ) 
 * Fix assertions in LWTs after TableMetadata was made immutable ( CASSANDRA - 14356 ) 
 * Abort compactions quicker ( CASSANDRA - 14397 ) 
 * Support light - weight transactions in cassandra - stress ( CASSANDRA - 13529 ) 
 diff - - git a / src / java / org / apache / cassandra / db / SSTableImporter . java b / src / java / org / apache / cassandra / db / SSTableImporter . java 
 index e9f6fe6 . . c919d25 100644 
 - - - a / src / java / org / apache / cassandra / db / SSTableImporter . java 
 + + + b / src / java / org / apache / cassandra / db / SSTableImporter . java 
 @ @ - 134 , 8 + 134 , 7 @ @ public class SSTableImporter 
 Descriptor oldDescriptor = entry . getKey ( ) ; 
 if ( currentDescriptors . contains ( oldDescriptor ) ) 
 continue ; 
 - if ( options . invalidateCaches & & cfs . isRowCacheEnabled ( ) ) 
 - invalidateCachesForSSTable ( oldDescriptor ) ; 
 + 
 File targetDir = getTargetDirectory ( dir , oldDescriptor , entry . getValue ( ) ) ; 
 Descriptor newDescriptor = cfs . getUniqueDescriptorFor ( entry . getKey ( ) , targetDir ) ; 
 maybeMutateMetadata ( entry . getKey ( ) , options ) ; 
 @ @ - 176 , 6 + 175 , 12 @ @ public class SSTableImporter 
 try ( Refs < SSTableReader > refs = Refs . ref ( newSSTables ) ) 
 { 
 cfs . getTracker ( ) . addSSTables ( newSSTables ) ; 
 + for ( SSTableReader reader : newSSTables ) 
 + { 
 + if ( options . invalidateCaches & & cfs . isRowCacheEnabled ( ) ) 
 + invalidateCachesForSSTable ( reader . descriptor ) ; 
 + } 
 + 
 } 
 
 logger . info ( " Done loading load new SSTables for { } / { } " , cfs . keyspace . getName ( ) , cfs . getTableName ( ) ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index fce741b . . da14eee 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 4 @ @ 
 - 1 . 0 
 + 1 . 0 . 0 - beta1 
 * removed binarymemtable ( CASSANDRA - 2692 ) 
 * add commitlog _ total _ space _ in _ mb to prevent fragmented logs ( CASSANDRA - 2427 ) 
 * removed commitlog _ rotation _ threshold _ in _ mb configuration ( CASSANDRA - 2771 ) 
 diff - - git a / build . xml b / build . xml 
 index c9aceb6 . . 823617d 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 25 , 7 + 25 , 7 @ @ 
 < property name = " debuglevel " value = " source , lines , vars " / > 
 
 < ! - - default version and SCM information ( we need the default SCM info as people may checkout with git - svn ) - - > 
 - < property name = " base . version " value = " 1 . 0 " / > 
 + < property name = " base . version " value = " 1 . 0 . 0 - beta1 " / > 
 < property name = " scm . default . path " value = " cassandra / branches / cassandra - 1 . 0 . 0 " / > 
 < property name = " scm . default . connection " value = " scm : svn : http : / / svn . apache . org / repos / asf / $ { scm . default . path } " / > 
 < property name = " scm . default . developerConnection " value = " scm : svn : https : / / svn . apache . org / repos / asf / $ { scm . default . path } " / > 
 diff - - git a / debian / changelog b / debian / changelog 
 index 9bdd0cf . . 12e2c1a 100644 
 - - - a / debian / changelog 
 + + + b / debian / changelog 
 @ @ - 1 , 3 + 1 , 9 @ @ 
 + cassandra ( 1 . 0 . 0 - beta1 ) unstable ; urgency = low 
 + 
 + * New beta release 
 + 
 + - - Sylvain Lebresne < slebresne @ apache . org > Wed , 14 Sep 2011 11 : 07 : 47 + 0200 
 + 
 cassandra ( 0 . 8 . 1 ) unstable ; urgency = low 
 
 * New release
