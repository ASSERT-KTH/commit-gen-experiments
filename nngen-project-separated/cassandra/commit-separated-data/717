BLEU SCORE: 0.020980574531482755

TEST MSG: simple reduction of 2n UUID . toString ( ) calls
GENERATED MSG: add nodeprobe cancelpending

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> index 1ef5dfe . . 435c7c8 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> @ @ - 389 , 10 + 389 , 11 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> * / <nl> public synchronized ParentRepairSession removeParentRepairSession ( UUID parentSessionId ) <nl> { <nl> + String snapshotName = parentSessionId . toString ( ) ; <nl> for ( ColumnFamilyStore cfs : getParentRepairSession ( parentSessionId ) . columnFamilyStores . values ( ) ) <nl> { <nl> - if ( cfs . snapshotExists ( parentSessionId . toString ( ) ) ) <nl> - cfs . clearSnapshot ( parentSessionId . toString ( ) ) ; <nl> + if ( cfs . snapshotExists ( snapshotName ) ) <nl> + cfs . clearSnapshot ( snapshotName ) ; <nl> } <nl> return parentRepairSessions . remove ( parentSessionId ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / locator / TokenMetadata . java b / src / java / org / apache / cassandra / locator / TokenMetadata . java <nl> index 164d80f . . 771ce2f 100644 <nl> - - - a / src / java / org / apache / cassandra / locator / TokenMetadata . java <nl> + + + b / src / java / org / apache / cassandra / locator / TokenMetadata . java <nl> @ @ - 287 , 4 + 287 , 9 @ @ public class TokenMetadata <nl> { <nl> return getEndPoint ( getSuccessor ( getToken ( endPoint ) ) ) ; <nl> } <nl> + <nl> + public void clearPendingRanges ( ) <nl> + { <nl> + pendingRanges . clear ( ) ; <nl> + } <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index bc23170 . . d4beeb8 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 1046 , 4 + 1046 , 9 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto <nl> { <nl> return replicationStrategy _ ; <nl> } <nl> + <nl> + public void cancelPendingRanges ( ) <nl> + { <nl> + tokenMetadata _ . clearPendingRanges ( ) ; <nl> + } <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index f4a9913 . . 3cb2001 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 131 , 6 + 131 , 13 @ @ public interface StorageServiceMBean <nl> * / <nl> public void loadBalance ( ) throws IOException , InterruptedException ; <nl> <nl> + / * * <nl> + * cancel writes to nodes that are set to be changing ranges . <nl> + * Only do this if the reason for the range changes no longer exists <nl> + * ( e . g . , a bootstrapping node was killed or crashed . ) <nl> + * / <nl> + public void cancelPendingRanges ( ) ; <nl> + <nl> / * * set the logging level at runtime * / <nl> public void setLog4jLevel ( String classQualifier , String level ) ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 96d80bf . . 347e2c1 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 393 , 6 + 393 , 11 @ @ public class NodeProbe <nl> ssProxy . move ( newToken ) ; <nl> } <nl> <nl> + public void cancelPendingRanges ( ) <nl> + { <nl> + ssProxy . cancelPendingRanges ( ) ; <nl> + } <nl> + <nl> / * * <nl> * Print out the size of the queues in the thread pools <nl> * <nl> @ @ - 488 , 7 + 493 , 7 @ @ public class NodeProbe <nl> HelpFormatter hf = new HelpFormatter ( ) ; <nl> String header = String . format ( <nl> " % nAvailable commands : ring , info , cleanup , compact , cfstats , snapshot [ name ] , clearsnapshot , " + <nl> - " tpstats , flush , decommission , move , loadbalance , " + <nl> + " tpstats , flush , decommission , move , loadbalance , cancelpending , " + <nl> " getcompactionthreshold , setcompactionthreshold [ minthreshold ] ( [ maxthreshold ] ) " ) ; <nl> String usage = String . format ( " java % s - host < arg > < command > % n " , NodeProbe . class . getName ( ) ) ; <nl> hf . printHelp ( usage , " " , options , header ) ; <nl> @ @ - 563 , 6 + 568 , 10 @ @ public class NodeProbe <nl> } <nl> probe . move ( arguments [ 1 ] ) ; <nl> } <nl> + else if ( cmdName . equals ( " cancelpending " ) ) <nl> + { <nl> + probe . cancelPendingRanges ( ) ; <nl> + } <nl> else if ( cmdName . equals ( " snapshot " ) ) <nl> { <nl> String snapshotName = " " ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 index 1ef5dfe . . 435c7c8 100644 
 - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 @ @ - 389 , 10 + 389 , 11 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 * / 
 public synchronized ParentRepairSession removeParentRepairSession ( UUID parentSessionId ) 
 { 
 + String snapshotName = parentSessionId . toString ( ) ; 
 for ( ColumnFamilyStore cfs : getParentRepairSession ( parentSessionId ) . columnFamilyStores . values ( ) ) 
 { 
 - if ( cfs . snapshotExists ( parentSessionId . toString ( ) ) ) 
 - cfs . clearSnapshot ( parentSessionId . toString ( ) ) ; 
 + if ( cfs . snapshotExists ( snapshotName ) ) 
 + cfs . clearSnapshot ( snapshotName ) ; 
 } 
 return parentRepairSessions . remove ( parentSessionId ) ; 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / locator / TokenMetadata . java b / src / java / org / apache / cassandra / locator / TokenMetadata . java 
 index 164d80f . . 771ce2f 100644 
 - - - a / src / java / org / apache / cassandra / locator / TokenMetadata . java 
 + + + b / src / java / org / apache / cassandra / locator / TokenMetadata . java 
 @ @ - 287 , 4 + 287 , 9 @ @ public class TokenMetadata 
 { 
 return getEndPoint ( getSuccessor ( getToken ( endPoint ) ) ) ; 
 } 
 + 
 + public void clearPendingRanges ( ) 
 + { 
 + pendingRanges . clear ( ) ; 
 + } 
 } 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index bc23170 . . d4beeb8 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 1046 , 4 + 1046 , 9 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto 
 { 
 return replicationStrategy _ ; 
 } 
 + 
 + public void cancelPendingRanges ( ) 
 + { 
 + tokenMetadata _ . clearPendingRanges ( ) ; 
 + } 
 } 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index f4a9913 . . 3cb2001 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 131 , 6 + 131 , 13 @ @ public interface StorageServiceMBean 
 * / 
 public void loadBalance ( ) throws IOException , InterruptedException ; 
 
 + / * * 
 + * cancel writes to nodes that are set to be changing ranges . 
 + * Only do this if the reason for the range changes no longer exists 
 + * ( e . g . , a bootstrapping node was killed or crashed . ) 
 + * / 
 + public void cancelPendingRanges ( ) ; 
 + 
 / * * set the logging level at runtime * / 
 public void setLog4jLevel ( String classQualifier , String level ) ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 96d80bf . . 347e2c1 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 393 , 6 + 393 , 11 @ @ public class NodeProbe 
 ssProxy . move ( newToken ) ; 
 } 
 
 + public void cancelPendingRanges ( ) 
 + { 
 + ssProxy . cancelPendingRanges ( ) ; 
 + } 
 + 
 / * * 
 * Print out the size of the queues in the thread pools 
 * 
 @ @ - 488 , 7 + 493 , 7 @ @ public class NodeProbe 
 HelpFormatter hf = new HelpFormatter ( ) ; 
 String header = String . format ( 
 " % nAvailable commands : ring , info , cleanup , compact , cfstats , snapshot [ name ] , clearsnapshot , " + 
 - " tpstats , flush , decommission , move , loadbalance , " + 
 + " tpstats , flush , decommission , move , loadbalance , cancelpending , " + 
 " getcompactionthreshold , setcompactionthreshold [ minthreshold ] ( [ maxthreshold ] ) " ) ; 
 String usage = String . format ( " java % s - host < arg > < command > % n " , NodeProbe . class . getName ( ) ) ; 
 hf . printHelp ( usage , " " , options , header ) ; 
 @ @ - 563 , 6 + 568 , 10 @ @ public class NodeProbe 
 } 
 probe . move ( arguments [ 1 ] ) ; 
 } 
 + else if ( cmdName . equals ( " cancelpending " ) ) 
 + { 
 + probe . cancelPendingRanges ( ) ; 
 + } 
 else if ( cmdName . equals ( " snapshot " ) ) 
 { 
 String snapshotName = " " ;
