BLEU SCORE: 0.004845325335928309

TEST MSG: Restrict Windows to parallel repairs
GENERATED MSG: Fix repair - pr for vnodes ; patched by yukim reviewed by driftx for CASSANDRA - 5329

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 477afd9 . . 399cb01 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 7 <nl> + * Restrict Windows to parallel repairs ( CASSANDRA - 6907 ) <nl> * ( Hadoop ) Allow manually specifying start / end tokens in CFIF ( CASSANDRA - 6436 ) <nl> * Fix NPE in MeteredFlusher ( CASSANDRA - 6820 ) <nl> * Fix race processing range scan responses ( CASSANDRA - 6820 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 42a58b0 . . 6b70987 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2450 , 16 + 2450 , 18 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> return forceRepairAsync ( keyspace , isSequential , isLocal , ranges , columnFamilies ) ; <nl> } <nl> <nl> - public int forceRepairAsync ( final String keyspace , final boolean isSequential , final boolean isLocal , final Collection < Range < Token > > ranges , final String . . . columnFamilies ) <nl> + public int forceRepairAsync ( String keyspace , boolean isSequential , boolean isLocal , Collection < Range < Token > > ranges , String . . . columnFamilies ) <nl> { <nl> if ( Keyspace . SYSTEM _ KS . equals ( keyspace ) | | ranges . isEmpty ( ) ) <nl> return 0 ; <nl> <nl> final int cmd = nextRepairCommand . incrementAndGet ( ) ; <nl> - if ( ranges . size ( ) > 0 ) <nl> + if ( ! FBUtilities . isUnix ( ) & & isSequential ) <nl> { <nl> - new Thread ( createRepairTask ( cmd , keyspace , ranges , isSequential , isLocal , columnFamilies ) ) . start ( ) ; <nl> + logger . warn ( " Snapshot - based repair is not yet supported on Windows . Reverting to parallel repair . " ) ; <nl> + isSequential = false ; <nl> } <nl> + new Thread ( createRepairTask ( cmd , keyspace , ranges , isSequential , isLocal , columnFamilies ) ) . start ( ) ; <nl> return cmd ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / conf / cassandra - env . sh b / conf / cassandra - env . sh <nl> index 462244c . . f98bdb8 100644 <nl> - - - a / conf / cassandra - env . sh <nl> + + + b / conf / cassandra - env . sh <nl> @ @ - 216 , 6 + 216 , 12 @ @ fi <nl> # JVM _ OPTS = " $ JVM _ OPTS - XX : + PrintPromotionFailure " <nl> # JVM _ OPTS = " $ JVM _ OPTS - XX : PrintFLSStatistics = 1 " <nl> # JVM _ OPTS = " $ JVM _ OPTS - Xloggc : / var / log / cassandra / gc - ` date + % s ` . log " <nl> + # If you are using JDK 6u34 7u2 or later you can enable GC log rotation <nl> + # don ' t stick the date in the log name if rotation is on . <nl> + # JVM _ OPTS = " $ JVM _ OPTS - Xloggc : / var / log / cassandra / gc . log " <nl> + # JVM _ OPTS = " $ JVM _ OPTS - XX : + UseGCLogFileRotation " <nl> + # JVM _ OPTS = " $ JVM _ OPTS - XX : NumberOfGCLogFiles = 10 " <nl> + # JVM _ OPTS = " $ JVM _ OPTS - XX : GCLogFileSize = 10M " <nl> <nl> # uncomment to have Cassandra JVM listen for remote debuggers / profilers on port 1414 <nl> # JVM _ OPTS = " $ JVM _ OPTS - Xdebug - Xnoagent - Xrunjdwp : transport = dt _ socket , server = y , suspend = n , address = 1414 "

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 477afd9 . . 399cb01 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 7 
 + * Restrict Windows to parallel repairs ( CASSANDRA - 6907 ) 
 * ( Hadoop ) Allow manually specifying start / end tokens in CFIF ( CASSANDRA - 6436 ) 
 * Fix NPE in MeteredFlusher ( CASSANDRA - 6820 ) 
 * Fix race processing range scan responses ( CASSANDRA - 6820 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 42a58b0 . . 6b70987 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2450 , 16 + 2450 , 18 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 return forceRepairAsync ( keyspace , isSequential , isLocal , ranges , columnFamilies ) ; 
 } 
 
 - public int forceRepairAsync ( final String keyspace , final boolean isSequential , final boolean isLocal , final Collection < Range < Token > > ranges , final String . . . columnFamilies ) 
 + public int forceRepairAsync ( String keyspace , boolean isSequential , boolean isLocal , Collection < Range < Token > > ranges , String . . . columnFamilies ) 
 { 
 if ( Keyspace . SYSTEM _ KS . equals ( keyspace ) | | ranges . isEmpty ( ) ) 
 return 0 ; 
 
 final int cmd = nextRepairCommand . incrementAndGet ( ) ; 
 - if ( ranges . size ( ) > 0 ) 
 + if ( ! FBUtilities . isUnix ( ) & & isSequential ) 
 { 
 - new Thread ( createRepairTask ( cmd , keyspace , ranges , isSequential , isLocal , columnFamilies ) ) . start ( ) ; 
 + logger . warn ( " Snapshot - based repair is not yet supported on Windows . Reverting to parallel repair . " ) ; 
 + isSequential = false ; 
 } 
 + new Thread ( createRepairTask ( cmd , keyspace , ranges , isSequential , isLocal , columnFamilies ) ) . start ( ) ; 
 return cmd ; 
 } 


NEAREST DIFF:
diff - - git a / conf / cassandra - env . sh b / conf / cassandra - env . sh 
 index 462244c . . f98bdb8 100644 
 - - - a / conf / cassandra - env . sh 
 + + + b / conf / cassandra - env . sh 
 @ @ - 216 , 6 + 216 , 12 @ @ fi 
 # JVM _ OPTS = " $ JVM _ OPTS - XX : + PrintPromotionFailure " 
 # JVM _ OPTS = " $ JVM _ OPTS - XX : PrintFLSStatistics = 1 " 
 # JVM _ OPTS = " $ JVM _ OPTS - Xloggc : / var / log / cassandra / gc - ` date + % s ` . log " 
 + # If you are using JDK 6u34 7u2 or later you can enable GC log rotation 
 + # don ' t stick the date in the log name if rotation is on . 
 + # JVM _ OPTS = " $ JVM _ OPTS - Xloggc : / var / log / cassandra / gc . log " 
 + # JVM _ OPTS = " $ JVM _ OPTS - XX : + UseGCLogFileRotation " 
 + # JVM _ OPTS = " $ JVM _ OPTS - XX : NumberOfGCLogFiles = 10 " 
 + # JVM _ OPTS = " $ JVM _ OPTS - XX : GCLogFileSize = 10M " 
 
 # uncomment to have Cassandra JVM listen for remote debuggers / profilers on port 1414 
 # JVM _ OPTS = " $ JVM _ OPTS - Xdebug - Xnoagent - Xrunjdwp : transport = dt _ socket , server = y , suspend = n , address = 1414 "
