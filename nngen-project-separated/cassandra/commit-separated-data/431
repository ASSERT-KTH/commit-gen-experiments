BLEU SCORE: 0.06772997136689071

TEST MSG: Supplemental update to CASSANDRA - 13234 - more accurately calculate hint delay
GENERATED MSG: Backport CASSANDRA - 6747

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / hints / HintsDispatcher . java b / src / java / org / apache / cassandra / hints / HintsDispatcher . java <nl> index 6fc55df . . 4a08540 100644 <nl> - - - a / src / java / org / apache / cassandra / hints / HintsDispatcher . java <nl> + + + b / src / java / org / apache / cassandra / hints / HintsDispatcher . java <nl> @ @ - 174 , 9 + 174 , 8 @ @ final class HintsDispatcher implements AutoCloseable <nl> <nl> private Callback sendHint ( Hint hint ) <nl> { <nl> - Callback callback = new Callback ( ) ; <nl> + Callback callback = new Callback ( hint . creationTime ) ; <nl> HintMessage message = new HintMessage ( hostId , hint ) ; <nl> - HintsServiceMetrics . updateDelayMetrics ( address , ApproximateTime . currentTimeMillis ( ) - hint . creationTime ) ; <nl> MessagingService . instance ( ) . sendRRWithFailure ( message . createMessageOut ( ) , address , callback ) ; <nl> return callback ; <nl> } <nl> @ @ - 187 , 9 + 186 , 8 @ @ final class HintsDispatcher implements AutoCloseable <nl> <nl> private Callback sendEncodedHint ( ByteBuffer hint ) <nl> { <nl> - Callback callback = new Callback ( ) ; <nl> EncodedHintMessage message = new EncodedHintMessage ( hostId , hint , messagingVersion ) ; <nl> - HintsServiceMetrics . updateDelayMetrics ( address , ApproximateTime . currentTimeMillis ( ) - message . getHintCreationTime ( ) ) ; <nl> + Callback callback = new Callback ( message . getHintCreationTime ( ) ) ; <nl> MessagingService . instance ( ) . sendRRWithFailure ( message . createMessageOut ( ) , address , callback ) ; <nl> return callback ; <nl> } <nl> @ @ - 201 , 6 + 199 , 12 @ @ final class HintsDispatcher implements AutoCloseable <nl> private final long start = System . nanoTime ( ) ; <nl> private final SimpleCondition condition = new SimpleCondition ( ) ; <nl> private volatile Outcome outcome ; <nl> + private final long hintCreationTime ; <nl> + <nl> + private Callback ( long hintCreationTime ) <nl> + { <nl> + this . hintCreationTime = hintCreationTime ; <nl> + } <nl> <nl> Outcome await ( ) <nl> { <nl> @ @ - 227 , 6 + 231 , 7 @ @ final class HintsDispatcher implements AutoCloseable <nl> <nl> public void response ( MessageIn msg ) <nl> { <nl> + HintsServiceMetrics . updateDelayMetrics ( msg . from , ApproximateTime . currentTimeMillis ( ) - this . hintCreationTime ) ; <nl> outcome = Outcome . SUCCESS ; <nl> condition . signalAll ( ) ; <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / hints / HintsDispatcher . java b / src / java / org / apache / cassandra / hints / HintsDispatcher . java 
 index 6fc55df . . 4a08540 100644 
 - - - a / src / java / org / apache / cassandra / hints / HintsDispatcher . java 
 + + + b / src / java / org / apache / cassandra / hints / HintsDispatcher . java 
 @ @ - 174 , 9 + 174 , 8 @ @ final class HintsDispatcher implements AutoCloseable 
 
 private Callback sendHint ( Hint hint ) 
 { 
 - Callback callback = new Callback ( ) ; 
 + Callback callback = new Callback ( hint . creationTime ) ; 
 HintMessage message = new HintMessage ( hostId , hint ) ; 
 - HintsServiceMetrics . updateDelayMetrics ( address , ApproximateTime . currentTimeMillis ( ) - hint . creationTime ) ; 
 MessagingService . instance ( ) . sendRRWithFailure ( message . createMessageOut ( ) , address , callback ) ; 
 return callback ; 
 } 
 @ @ - 187 , 9 + 186 , 8 @ @ final class HintsDispatcher implements AutoCloseable 
 
 private Callback sendEncodedHint ( ByteBuffer hint ) 
 { 
 - Callback callback = new Callback ( ) ; 
 EncodedHintMessage message = new EncodedHintMessage ( hostId , hint , messagingVersion ) ; 
 - HintsServiceMetrics . updateDelayMetrics ( address , ApproximateTime . currentTimeMillis ( ) - message . getHintCreationTime ( ) ) ; 
 + Callback callback = new Callback ( message . getHintCreationTime ( ) ) ; 
 MessagingService . instance ( ) . sendRRWithFailure ( message . createMessageOut ( ) , address , callback ) ; 
 return callback ; 
 } 
 @ @ - 201 , 6 + 199 , 12 @ @ final class HintsDispatcher implements AutoCloseable 
 private final long start = System . nanoTime ( ) ; 
 private final SimpleCondition condition = new SimpleCondition ( ) ; 
 private volatile Outcome outcome ; 
 + private final long hintCreationTime ; 
 + 
 + private Callback ( long hintCreationTime ) 
 + { 
 + this . hintCreationTime = hintCreationTime ; 
 + } 
 
 Outcome await ( ) 
 { 
 @ @ - 227 , 6 + 231 , 7 @ @ final class HintsDispatcher implements AutoCloseable 
 
 public void response ( MessageIn msg ) 
 { 
 + HintsServiceMetrics . updateDelayMetrics ( msg . from , ApproximateTime . currentTimeMillis ( ) - this . hintCreationTime ) ; 
 outcome = Outcome . SUCCESS ; 
 condition . signalAll ( ) ; 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
