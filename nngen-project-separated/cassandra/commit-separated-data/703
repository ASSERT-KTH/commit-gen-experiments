BLEU SCORE: 1.0

TEST MSG: Always use RANGE _ SLICE verb for 3 . x messages
GENERATED MSG: Always use RANGE _ SLICE verb for 3 . x messages

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 388a290 . . 10c5d40 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 28 , 6 + 28 , 8 @ @ <nl> * Add repaired percentage metric ( CASSANDRA - 11503 ) <nl> * Add Change - Data - Capture ( CASSANDRA - 8844 ) <nl> Merged from 3 . 0 : <nl> + * Fix potential bad messaging service message for paged range reads <nl> + within mixed - version 3 . x clusters ( CASSANDRA - 12249 ) <nl> * Fix paging logic for deleted partitions with static columns ( CASSANDRA - 12107 ) <nl> * Wait until the message is being send to decide which serializer must be used ( CASSANDRA - 11393 ) <nl> * Fix migration of static thrift column names with non - text comparators ( CASSANDRA - 12147 ) <nl> diff - - git a / src / java / org / apache / cassandra / net / MessageOut . java b / src / java / org / apache / cassandra / net / MessageOut . java <nl> index bc5c41b . . 34694a6 100644 <nl> - - - a / src / java / org / apache / cassandra / net / MessageOut . java <nl> + + + b / src / java / org / apache / cassandra / net / MessageOut . java <nl> @ @ - 104 , 7 + 104 , 7 @ @ public class MessageOut < T > <nl> { <nl> CompactEndpointSerializationHelper . serialize ( from , out ) ; <nl> <nl> - out . writeInt ( verb . ordinal ( ) ) ; <nl> + out . writeInt ( MessagingService . Verb . convertForMessagingServiceVersion ( verb , version ) . ordinal ( ) ) ; <nl> out . writeInt ( parameters . size ( ) ) ; <nl> for ( Map . Entry < String , byte [ ] > entry : parameters . entrySet ( ) ) <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / net / MessagingService . java b / src / java / org / apache / cassandra / net / MessagingService . java <nl> index 220fc66 . . 3302357 100644 <nl> - - - a / src / java / org / apache / cassandra / net / MessagingService . java <nl> + + + b / src / java / org / apache / cassandra / net / MessagingService . java <nl> @ @ - 151 , 6 + 151 , 16 @ @ public final class MessagingService implements MessagingServiceMBean <nl> UNUSED _ 4 , <nl> UNUSED _ 5 , <nl> ; <nl> + <nl> + / / This is to support a " late " choice of the verb based on the messaging service version . <nl> + / / See CASSANDRA - 12249 for more details . <nl> + public static Verb convertForMessagingServiceVersion ( Verb verb , int version ) <nl> + { <nl> + if ( verb = = PAGED _ RANGE & & version > = VERSION _ 30 ) <nl> + return RANGE _ SLICE ; <nl> + <nl> + return verb ; <nl> + } <nl> } <nl> <nl> public static final EnumMap < MessagingService . Verb , Stage > verbStages = new EnumMap < MessagingService . Verb , Stage > ( MessagingService . Verb . class )
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 388a290 . . 10c5d40 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 28 , 6 + 28 , 8 @ @ 
 * Add repaired percentage metric ( CASSANDRA - 11503 ) 
 * Add Change - Data - Capture ( CASSANDRA - 8844 ) 
 Merged from 3 . 0 : 
 + * Fix potential bad messaging service message for paged range reads 
 + within mixed - version 3 . x clusters ( CASSANDRA - 12249 ) 
 * Fix paging logic for deleted partitions with static columns ( CASSANDRA - 12107 ) 
 * Wait until the message is being send to decide which serializer must be used ( CASSANDRA - 11393 ) 
 * Fix migration of static thrift column names with non - text comparators ( CASSANDRA - 12147 ) 
 diff - - git a / src / java / org / apache / cassandra / net / MessageOut . java b / src / java / org / apache / cassandra / net / MessageOut . java 
 index bc5c41b . . 34694a6 100644 
 - - - a / src / java / org / apache / cassandra / net / MessageOut . java 
 + + + b / src / java / org / apache / cassandra / net / MessageOut . java 
 @ @ - 104 , 7 + 104 , 7 @ @ public class MessageOut < T > 
 { 
 CompactEndpointSerializationHelper . serialize ( from , out ) ; 
 
 - out . writeInt ( verb . ordinal ( ) ) ; 
 + out . writeInt ( MessagingService . Verb . convertForMessagingServiceVersion ( verb , version ) . ordinal ( ) ) ; 
 out . writeInt ( parameters . size ( ) ) ; 
 for ( Map . Entry < String , byte [ ] > entry : parameters . entrySet ( ) ) 
 { 
 diff - - git a / src / java / org / apache / cassandra / net / MessagingService . java b / src / java / org / apache / cassandra / net / MessagingService . java 
 index 220fc66 . . 3302357 100644 
 - - - a / src / java / org / apache / cassandra / net / MessagingService . java 
 + + + b / src / java / org / apache / cassandra / net / MessagingService . java 
 @ @ - 151 , 6 + 151 , 16 @ @ public final class MessagingService implements MessagingServiceMBean 
 UNUSED _ 4 , 
 UNUSED _ 5 , 
 ; 
 + 
 + / / This is to support a " late " choice of the verb based on the messaging service version . 
 + / / See CASSANDRA - 12249 for more details . 
 + public static Verb convertForMessagingServiceVersion ( Verb verb , int version ) 
 + { 
 + if ( verb = = PAGED _ RANGE & & version > = VERSION _ 30 ) 
 + return RANGE _ SLICE ; 
 + 
 + return verb ; 
 + } 
 } 
 
 public static final EnumMap < MessagingService . Verb , Stage > verbStages = new EnumMap < MessagingService . Verb , Stage > ( MessagingService . Verb . class )

NEAREST DIFF:
ELIMINATEDSENTENCE
