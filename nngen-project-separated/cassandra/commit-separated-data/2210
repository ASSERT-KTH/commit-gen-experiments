BLEU SCORE: 0.01763751180315069

TEST MSG: Remove duplicates from StorageService . getJoiningNodes
GENERATED MSG: fix unbootstrap when no data is present in a transfer range

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 5dd3ad2 . . 4c261c9 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 . 19 <nl> + * Remove duplicates from StorageService . getJoiningNodes ( CASSANDRA - 7478 ) <nl> * Clone token map outside of hot gossip loops ( CASSANDRA - 7758 ) <nl> * Add stop method to EmbeddedCassandraService ( CASSANDRA - 7595 ) <nl> * Support connecting to ipv6 jmx with nodetool ( CASSANDRA - 7669 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 563b259 . . 4ffa4b2 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2115 , 7 + 2115 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> <nl> public List < String > getJoiningNodes ( ) <nl> { <nl> - return stringify ( tokenMetadata . getBootstrapTokens ( ) . values ( ) ) ; <nl> + return stringify ( tokenMetadata . getBootstrapTokens ( ) . valueSet ( ) ) ; <nl> } <nl> <nl> public List < String > getLiveNodes ( ) <nl> diff - - git a / src / java / org / apache / cassandra / utils / BiMultiValMap . java b / src / java / org / apache / cassandra / utils / BiMultiValMap . java <nl> index 3712d25 . . 2cc11b2 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / BiMultiValMap . java <nl> + + + b / src / java / org / apache / cassandra / utils / BiMultiValMap . java <nl> @ @ - 138 , 4 + 138 , 9 @ @ public class BiMultiValMap < K , V > implements Map < K , V > <nl> { <nl> return reverseMap . keys ( ) ; <nl> } <nl> + <nl> + public Collection < V > valueSet ( ) <nl> + { <nl> + return reverseMap . keySet ( ) ; <nl> + } <nl> }
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index dcc67d1 . . cf79af2 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 9 , 6 + 9 , 7 @ @ dev <nl> * remove assertion causing rare ( and harmless ) error messages in <nl> commitlog ( CASSANDRA - 1330 ) <nl> * fix moving nodes with no keyspaces defined ( CASSANDRA - 1574 ) <nl> + * fix unbootstrap when no data is present in a transfer range ( CASSANDRA - 1573 ) <nl> <nl> <nl> 0 . 7 - beta2 <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 293c56c . . b5faeda 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 396 , 7 + 396 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe <nl> if ( DatabaseDescriptor . getNonSystemTables ( ) . size ( ) > 0 ) <nl> { <nl> bootstrap ( token ) ; <nl> - assert ! isBootstrapMode ; / / bootstrap will block until finishec <nl> + assert ! isBootstrapMode ; / / bootstrap will block until finished <nl> } <nl> else <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamOut . java b / src / java / org / apache / cassandra / streaming / StreamOut . java <nl> index 2a3b342 . . 6328055 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamOut . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamOut . java <nl> @ @ - 150 , 6 + 150 , 10 @ @ public class StreamOut <nl> session . addFilesToStream ( pending ) ; <nl> session . begin ( ) ; <nl> } <nl> + else <nl> + { <nl> + session . close ( ) ; <nl> + } <nl> } <nl> <nl> / / called prior to sending anything .

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 5dd3ad2 . . 4c261c9 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 . 19 
 + * Remove duplicates from StorageService . getJoiningNodes ( CASSANDRA - 7478 ) 
 * Clone token map outside of hot gossip loops ( CASSANDRA - 7758 ) 
 * Add stop method to EmbeddedCassandraService ( CASSANDRA - 7595 ) 
 * Support connecting to ipv6 jmx with nodetool ( CASSANDRA - 7669 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 563b259 . . 4ffa4b2 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2115 , 7 + 2115 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 
 public List < String > getJoiningNodes ( ) 
 { 
 - return stringify ( tokenMetadata . getBootstrapTokens ( ) . values ( ) ) ; 
 + return stringify ( tokenMetadata . getBootstrapTokens ( ) . valueSet ( ) ) ; 
 } 
 
 public List < String > getLiveNodes ( ) 
 diff - - git a / src / java / org / apache / cassandra / utils / BiMultiValMap . java b / src / java / org / apache / cassandra / utils / BiMultiValMap . java 
 index 3712d25 . . 2cc11b2 100644 
 - - - a / src / java / org / apache / cassandra / utils / BiMultiValMap . java 
 + + + b / src / java / org / apache / cassandra / utils / BiMultiValMap . java 
 @ @ - 138 , 4 + 138 , 9 @ @ public class BiMultiValMap < K , V > implements Map < K , V > 
 { 
 return reverseMap . keys ( ) ; 
 } 
 + 
 + public Collection < V > valueSet ( ) 
 + { 
 + return reverseMap . keySet ( ) ; 
 + } 
 }

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index dcc67d1 . . cf79af2 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 9 , 6 + 9 , 7 @ @ dev 
 * remove assertion causing rare ( and harmless ) error messages in 
 commitlog ( CASSANDRA - 1330 ) 
 * fix moving nodes with no keyspaces defined ( CASSANDRA - 1574 ) 
 + * fix unbootstrap when no data is present in a transfer range ( CASSANDRA - 1573 ) 
 
 
 0 . 7 - beta2 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 293c56c . . b5faeda 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 396 , 7 + 396 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe 
 if ( DatabaseDescriptor . getNonSystemTables ( ) . size ( ) > 0 ) 
 { 
 bootstrap ( token ) ; 
 - assert ! isBootstrapMode ; / / bootstrap will block until finishec 
 + assert ! isBootstrapMode ; / / bootstrap will block until finished 
 } 
 else 
 { 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamOut . java b / src / java / org / apache / cassandra / streaming / StreamOut . java 
 index 2a3b342 . . 6328055 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamOut . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamOut . java 
 @ @ - 150 , 6 + 150 , 10 @ @ public class StreamOut 
 session . addFilesToStream ( pending ) ; 
 session . begin ( ) ; 
 } 
 + else 
 + { 
 + session . close ( ) ; 
 + } 
 } 
 
 / / called prior to sending anything .
