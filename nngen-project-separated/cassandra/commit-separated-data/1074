BLEU SCORE: 0.02133165846478451

TEST MSG: Properly pass CellPath when setting list element to null
GENERATED MSG: Fix missing results in 2i queries on collections with filtering

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index da5ed26 . . 6daf7f9 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 . 3 <nl> + * Fix AssertionError when removing from list using UPDATE ( CASSANDRA - 10954 ) <nl> * Fix UnsupportedOperationException when reading old sstable with range <nl> tombstone ( CASSANDRA - 10743 ) <nl> * MV should use the maximum timestamp of the primary key ( CASSANDRA - 10910 ) <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / Lists . java b / src / java / org / apache / cassandra / cql3 / Lists . java <nl> index 4b41a9d . . 18b382b 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / Lists . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / Lists . java <nl> @ @ - 359 , 7 + 359 , 7 @ @ public abstract class Lists <nl> CellPath elementPath = existingRow . getComplexColumnData ( column ) . getCellByIndex ( idx ) . path ( ) ; <nl> if ( value = = null ) <nl> { <nl> - params . addTombstone ( column ) ; <nl> + params . addTombstone ( column , elementPath ) ; <nl> } <nl> else if ( value ! = ByteBufferUtil . UNSET _ BYTE _ BUFFER ) <nl> { <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> index 48e5ad3 . . a0a6e73 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java <nl> @ @ - 852 , 4 + 852 , 16 @ @ public class CollectionsTest extends CQLTester <nl> <nl> assertRows ( execute ( " SELECT s FROM % s WHERE k = 0 " ) , row ( set ( largeText , " v2 " ) ) ) ; <nl> } <nl> + <nl> + @ Test <nl> + public void testRemovalThroughUpdate ( ) throws Throwable <nl> + { <nl> + createTable ( " CREATE TABLE % s ( k int PRIMARY KEY , l list < int > ) " ) ; <nl> + <nl> + execute ( " INSERT INTO % s ( k , l ) VALUES ( ? , ? ) " , 0 , list ( 1 , 2 , 3 ) ) ; <nl> + assertRows ( execute ( " SELECT * FROM % s " ) , row ( 0 , list ( 1 , 2 , 3 ) ) ) ; <nl> + <nl> + execute ( " UPDATE % s SET l [ 0 ] = null WHERE k = 0 " ) ; <nl> + assertRows ( execute ( " SELECT * FROM % s " ) , row ( 0 , list ( 2 , 3 ) ) ) ; <nl> + } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index da5ed26 . . 6daf7f9 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 . 3 
 + * Fix AssertionError when removing from list using UPDATE ( CASSANDRA - 10954 ) 
 * Fix UnsupportedOperationException when reading old sstable with range 
 tombstone ( CASSANDRA - 10743 ) 
 * MV should use the maximum timestamp of the primary key ( CASSANDRA - 10910 ) 
 diff - - git a / src / java / org / apache / cassandra / cql3 / Lists . java b / src / java / org / apache / cassandra / cql3 / Lists . java 
 index 4b41a9d . . 18b382b 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / Lists . java 
 + + + b / src / java / org / apache / cassandra / cql3 / Lists . java 
 @ @ - 359 , 7 + 359 , 7 @ @ public abstract class Lists 
 CellPath elementPath = existingRow . getComplexColumnData ( column ) . getCellByIndex ( idx ) . path ( ) ; 
 if ( value = = null ) 
 { 
 - params . addTombstone ( column ) ; 
 + params . addTombstone ( column , elementPath ) ; 
 } 
 else if ( value ! = ByteBufferUtil . UNSET _ BYTE _ BUFFER ) 
 { 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 index 48e5ad3 . . a0a6e73 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / validation / entities / CollectionsTest . java 
 @ @ - 852 , 4 + 852 , 16 @ @ public class CollectionsTest extends CQLTester 
 
 assertRows ( execute ( " SELECT s FROM % s WHERE k = 0 " ) , row ( set ( largeText , " v2 " ) ) ) ; 
 } 
 + 
 + @ Test 
 + public void testRemovalThroughUpdate ( ) throws Throwable 
 + { 
 + createTable ( " CREATE TABLE % s ( k int PRIMARY KEY , l list < int > ) " ) ; 
 + 
 + execute ( " INSERT INTO % s ( k , l ) VALUES ( ? , ? ) " , 0 , list ( 1 , 2 , 3 ) ) ; 
 + assertRows ( execute ( " SELECT * FROM % s " ) , row ( 0 , list ( 1 , 2 , 3 ) ) ) ; 
 + 
 + execute ( " UPDATE % s SET l [ 0 ] = null WHERE k = 0 " ) ; 
 + assertRows ( execute ( " SELECT * FROM % s " ) , row ( 0 , list ( 2 , 3 ) ) ) ; 
 + } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
