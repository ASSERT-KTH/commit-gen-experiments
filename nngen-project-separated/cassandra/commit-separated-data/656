BLEU SCORE: 0.018738883683389617

TEST MSG: fix jsontransformer for partitions with delete info for CASSANDRA - 12418
GENERATED MSG: merge from 1 . 1

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 5cf351a . . 21fc42c 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 47 , 6 + 47 , 7 @ @ <nl> those static columns in query results ( CASSANDRA - 12123 ) <nl> * Avoid digest mismatch with empty but static rows ( CASSANDRA - 12090 ) <nl> * Fix EOF exception when altering column type ( CASSANDRA - 11820 ) <nl> + * Fix JsonTransformer output of partition with deletion info ( CASSANDRA - 12418 ) <nl> Merged from 2 . 2 : <nl> * Add local address entry in PropertyFileSnitch ( CASSANDRA - 11332 ) <nl> * cqlshlib tests : increase default execute timeout ( CASSANDRA - 12481 ) <nl> diff - - git a / src / java / org / apache / cassandra / tools / JsonTransformer . java b / src / java / org / apache / cassandra / tools / JsonTransformer . java <nl> index 3deed96 . . 590e527 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / JsonTransformer . java <nl> + + + b / src / java / org / apache / cassandra / tools / JsonTransformer . java <nl> @ @ - 193 , 6 + 193 , 7 @ @ public final class JsonTransformer <nl> if ( ! partition . partitionLevelDeletion ( ) . isLive ( ) ) <nl> { <nl> serializeDeletion ( partition . partitionLevelDeletion ( ) ) ; <nl> + json . writeEndObject ( ) ; <nl> } <nl> else <nl> {
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index a83fbab . . e2dc046 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> { <nl> Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; <nl> InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; <nl> - scheduleHintDelivery ( target ) ; <nl> + / / token may have since been removed ( in which case we have just read back a tombstone ) <nl> + if ( target ! = null ) <nl> + scheduleHintDelivery ( target ) ; <nl> } <nl> <nl> if ( logger _ . isDebugEnabled ( ) )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 5cf351a . . 21fc42c 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 47 , 6 + 47 , 7 @ @ 
 those static columns in query results ( CASSANDRA - 12123 ) 
 * Avoid digest mismatch with empty but static rows ( CASSANDRA - 12090 ) 
 * Fix EOF exception when altering column type ( CASSANDRA - 11820 ) 
 + * Fix JsonTransformer output of partition with deletion info ( CASSANDRA - 12418 ) 
 Merged from 2 . 2 : 
 * Add local address entry in PropertyFileSnitch ( CASSANDRA - 11332 ) 
 * cqlshlib tests : increase default execute timeout ( CASSANDRA - 12481 ) 
 diff - - git a / src / java / org / apache / cassandra / tools / JsonTransformer . java b / src / java / org / apache / cassandra / tools / JsonTransformer . java 
 index 3deed96 . . 590e527 100644 
 - - - a / src / java / org / apache / cassandra / tools / JsonTransformer . java 
 + + + b / src / java / org / apache / cassandra / tools / JsonTransformer . java 
 @ @ - 193 , 6 + 193 , 7 @ @ public final class JsonTransformer 
 if ( ! partition . partitionLevelDeletion ( ) . isLive ( ) ) 
 { 
 serializeDeletion ( partition . partitionLevelDeletion ( ) ) ; 
 + json . writeEndObject ( ) ; 
 } 
 else 
 {

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index a83fbab . . e2dc046 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 { 
 Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; 
 InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; 
 - scheduleHintDelivery ( target ) ; 
 + / / token may have since been removed ( in which case we have just read back a tombstone ) 
 + if ( target ! = null ) 
 + scheduleHintDelivery ( target ) ; 
 } 
 
 if ( logger _ . isDebugEnabled ( ) )
