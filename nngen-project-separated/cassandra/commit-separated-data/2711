BLEU SCORE: 0.05341087579952926

TEST MSG: merge from 1 . 2
GENERATED MSG: cleanup

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 83b03de . . 4fffb9a 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 19 , 6 + 19 , 7 @ @ <nl> * Improve repair tasks ( snapshot , differencing ) concurrency ( CASSANDRA - 6566 ) <nl> * Fix replaying pre - 2 . 0 commit logs ( CASSANDRA - 6714 ) <nl> Merged from 1 . 2 : <nl> + * Catch memtable flush exceptions during shutdown ( CASSANDRA - 6735 ) <nl> * Fix broken streams when replacing with same IP ( CASSANDRA - 6622 ) <nl> * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) <nl> * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 4be95b2 . . b66873c 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 585 , 7 + 585 , 15 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> flushes . add ( cfs . forceFlush ( ) ) ; <nl> } <nl> } <nl> - FBUtilities . waitOnFutures ( flushes ) ; <nl> + try <nl> + { <nl> + FBUtilities . waitOnFutures ( flushes ) ; <nl> + } <nl> + catch ( Throwable e ) <nl> + { <nl> + / / don ' t let this stop us from shutting down the commitlog and other thread pools <nl> + logger . warn ( " Caught exception while waiting for memtable flushes during shutdown hook " , e ) ; <nl> + } <nl> <nl> CommitLog . instance . shutdownBlocking ( ) ; <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / CassandraServer . java b / src / java / org / apache / cassandra / service / CassandraServer . java <nl> index 1708b75 . . 1d14676 100644 <nl> - - - a / src / java / org / apache / cassandra / service / CassandraServer . java <nl> + + + b / src / java / org / apache / cassandra / service / CassandraServer . java <nl> @ @ - 618 , 7 + 618 , 7 @ @ public class CassandraServer implements Cassandra . Iface <nl> } <nl> <nl> public List < KeySlice > get _ range _ slice ( String keyspace , ColumnParent column _ parent , SlicePredicate predicate , String start _ key , String finish _ key , int maxRows , ConsistencyLevel consistency _ level ) <nl> - throws InvalidRequestException , UnavailableException , TException , TimedOutException <nl> + throws InvalidRequestException , UnavailableException , TException , TimedOutException <nl> { <nl> if ( logger . isDebugEnabled ( ) ) <nl> logger . debug ( " range _ slice " ) ; <nl> @ @ - 664 , 7 + 664 , 6 @ @ public class CassandraServer implements Cassandra . Iface <nl> return keySlices ; <nl> } <nl> <nl> - @ Override <nl> public void login ( String keyspace , AuthenticationRequest auth _ request ) throws AuthenticationException , AuthorizationException , TException <nl> { <nl> DatabaseDescriptor . getAuthenticator ( ) . login ( keyspace , auth _ request ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 83b03de . . 4fffb9a 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 19 , 6 + 19 , 7 @ @ 
 * Improve repair tasks ( snapshot , differencing ) concurrency ( CASSANDRA - 6566 ) 
 * Fix replaying pre - 2 . 0 commit logs ( CASSANDRA - 6714 ) 
 Merged from 1 . 2 : 
 + * Catch memtable flush exceptions during shutdown ( CASSANDRA - 6735 ) 
 * Fix broken streams when replacing with same IP ( CASSANDRA - 6622 ) 
 * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) 
 * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 4be95b2 . . b66873c 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 585 , 7 + 585 , 15 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 flushes . add ( cfs . forceFlush ( ) ) ; 
 } 
 } 
 - FBUtilities . waitOnFutures ( flushes ) ; 
 + try 
 + { 
 + FBUtilities . waitOnFutures ( flushes ) ; 
 + } 
 + catch ( Throwable e ) 
 + { 
 + / / don ' t let this stop us from shutting down the commitlog and other thread pools 
 + logger . warn ( " Caught exception while waiting for memtable flushes during shutdown hook " , e ) ; 
 + } 
 
 CommitLog . instance . shutdownBlocking ( ) ; 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / CassandraServer . java b / src / java / org / apache / cassandra / service / CassandraServer . java 
 index 1708b75 . . 1d14676 100644 
 - - - a / src / java / org / apache / cassandra / service / CassandraServer . java 
 + + + b / src / java / org / apache / cassandra / service / CassandraServer . java 
 @ @ - 618 , 7 + 618 , 7 @ @ public class CassandraServer implements Cassandra . Iface 
 } 
 
 public List < KeySlice > get _ range _ slice ( String keyspace , ColumnParent column _ parent , SlicePredicate predicate , String start _ key , String finish _ key , int maxRows , ConsistencyLevel consistency _ level ) 
 - throws InvalidRequestException , UnavailableException , TException , TimedOutException 
 + throws InvalidRequestException , UnavailableException , TException , TimedOutException 
 { 
 if ( logger . isDebugEnabled ( ) ) 
 logger . debug ( " range _ slice " ) ; 
 @ @ - 664 , 7 + 664 , 6 @ @ public class CassandraServer implements Cassandra . Iface 
 return keySlices ; 
 } 
 
 - @ Override 
 public void login ( String keyspace , AuthenticationRequest auth _ request ) throws AuthenticationException , AuthorizationException , TException 
 { 
 DatabaseDescriptor . getAuthenticator ( ) . login ( keyspace , auth _ request ) ;
