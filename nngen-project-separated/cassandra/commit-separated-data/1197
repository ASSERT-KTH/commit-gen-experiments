BLEU SCORE: 0.03283637368030199

TEST MSG: Improve json2sstable error reporting on nonexistent columns
GENERATED MSG: Fix various unit - test failures

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7771969 . . 8ff726e 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 12 <nl> + * Improve json2sstable error reporting on nonexistent columns ( CASSANDRA - 10401 ) <nl> * ( cqlsh ) fix COPY using wrong variable name for time _ format ( CASSANDRA - 10633 ) <nl> * Do not run SizeEstimatesRecorder if a node is not a member of the ring ( CASSANDRA - 9912 ) <nl> * Improve handling of dead nodes in gossip ( CASSANDRA - 10298 ) <nl> diff - - git a / src / java / org / apache / cassandra / tools / SSTableImport . java b / src / java / org / apache / cassandra / tools / SSTableImport . java <nl> index 87d52be . . e0f3ef3 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / SSTableImport . java <nl> + + + b / src / java / org / apache / cassandra / tools / SSTableImport . java <nl> @ @ - 281 , 6 + 281 , 11 @ @ public class SSTableImport <nl> * / <nl> public int importJson ( String jsonFile , String keyspace , String cf , String ssTablePath ) throws IOException <nl> { <nl> + if ( Schema . instance . getCFMetaData ( keyspace , cf ) = = null ) <nl> + throw new IllegalArgumentException ( String . format ( " Unknown keyspace / table % s . % s " , <nl> + keyspace , <nl> + cf ) ) ; <nl> + <nl> ColumnFamily columnFamily = ArrayBackedSortedColumns . factory . create ( keyspace , cf ) ; <nl> IPartitioner partitioner = DatabaseDescriptor . getPartitioner ( ) ; <nl> <nl> diff - - git a / test / unit / org / apache / cassandra / tools / SSTableImportTest . java b / test / unit / org / apache / cassandra / tools / SSTableImportTest . java <nl> index a5f05f8 . . 77036e8 100644 <nl> - - - a / test / unit / org / apache / cassandra / tools / SSTableImportTest . java <nl> + + + b / test / unit / org / apache / cassandra / tools / SSTableImportTest . java <nl> @ @ - 51 , 6 + 51 , 15 @ @ import org . apache . cassandra . io . sstable . SSTableReader ; <nl> <nl> public class SSTableImportTest extends SchemaLoader <nl> { <nl> + @ Test ( expected = IllegalArgumentException . class ) <nl> + public void testImportUnknownCf ( ) throws IOException , URISyntaxException <nl> + { <nl> + / / Import JSON to temp SSTable file <nl> + String jsonUrl = resourcePath ( " SimpleCF . json " ) ; <nl> + File tempSS = tempSSTableFile ( " Keyspace1 " , " Standard1 " ) ; <nl> + new SSTableImport ( true ) . importJson ( jsonUrl , " UnknownKeyspace " , " UnknownCF " , tempSS . getPath ( ) ) ; <nl> + } <nl> + <nl> @ Test <nl> public void testImportSimpleCf ( ) throws IOException , URISyntaxException <nl> {
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7771969 . . 8ff726e 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 12 
 + * Improve json2sstable error reporting on nonexistent columns ( CASSANDRA - 10401 ) 
 * ( cqlsh ) fix COPY using wrong variable name for time _ format ( CASSANDRA - 10633 ) 
 * Do not run SizeEstimatesRecorder if a node is not a member of the ring ( CASSANDRA - 9912 ) 
 * Improve handling of dead nodes in gossip ( CASSANDRA - 10298 ) 
 diff - - git a / src / java / org / apache / cassandra / tools / SSTableImport . java b / src / java / org / apache / cassandra / tools / SSTableImport . java 
 index 87d52be . . e0f3ef3 100644 
 - - - a / src / java / org / apache / cassandra / tools / SSTableImport . java 
 + + + b / src / java / org / apache / cassandra / tools / SSTableImport . java 
 @ @ - 281 , 6 + 281 , 11 @ @ public class SSTableImport 
 * / 
 public int importJson ( String jsonFile , String keyspace , String cf , String ssTablePath ) throws IOException 
 { 
 + if ( Schema . instance . getCFMetaData ( keyspace , cf ) = = null ) 
 + throw new IllegalArgumentException ( String . format ( " Unknown keyspace / table % s . % s " , 
 + keyspace , 
 + cf ) ) ; 
 + 
 ColumnFamily columnFamily = ArrayBackedSortedColumns . factory . create ( keyspace , cf ) ; 
 IPartitioner partitioner = DatabaseDescriptor . getPartitioner ( ) ; 
 
 diff - - git a / test / unit / org / apache / cassandra / tools / SSTableImportTest . java b / test / unit / org / apache / cassandra / tools / SSTableImportTest . java 
 index a5f05f8 . . 77036e8 100644 
 - - - a / test / unit / org / apache / cassandra / tools / SSTableImportTest . java 
 + + + b / test / unit / org / apache / cassandra / tools / SSTableImportTest . java 
 @ @ - 51 , 6 + 51 , 15 @ @ import org . apache . cassandra . io . sstable . SSTableReader ; 
 
 public class SSTableImportTest extends SchemaLoader 
 { 
 + @ Test ( expected = IllegalArgumentException . class ) 
 + public void testImportUnknownCf ( ) throws IOException , URISyntaxException 
 + { 
 + / / Import JSON to temp SSTable file 
 + String jsonUrl = resourcePath ( " SimpleCF . json " ) ; 
 + File tempSS = tempSSTableFile ( " Keyspace1 " , " Standard1 " ) ; 
 + new SSTableImport ( true ) . importJson ( jsonUrl , " UnknownKeyspace " , " UnknownCF " , tempSS . getPath ( ) ) ; 
 + } 
 + 
 @ Test 
 public void testImportSimpleCf ( ) throws IOException , URISyntaxException 
 {

NEAREST DIFF:
ELIMINATEDSENTENCE
