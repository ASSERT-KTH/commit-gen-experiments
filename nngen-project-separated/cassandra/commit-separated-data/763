BLEU SCORE: 0.012589193610827863

TEST MSG: push down indexFileLength calc , to where it ' s used
GENERATED MSG: add compaction marker to in - memory list of components . patch by Stu Hood ; reviewed by jbellis for CASSANDRA - 1544

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java b / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java <nl> index 78a6825 . . fc0849f 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java <nl> @ @ - 752 , 11 + 752 , 11 @ @ public abstract class SSTableReader extends SSTable implements SelfRefCounted < SS <nl> builtSummary = true ; <nl> } <nl> <nl> - long indexFileLength = new File ( descriptor . filenameFor ( Component . PRIMARY _ INDEX ) ) . length ( ) ; <nl> int dataBufferSize = optimizationStrategy . bufferSize ( sstableMetadata . estimatedPartitionSize . percentile ( DatabaseDescriptor . getDiskOptimizationEstimatePercentile ( ) ) ) ; <nl> <nl> if ( components . contains ( Component . PRIMARY _ INDEX ) ) <nl> { <nl> + long indexFileLength = new File ( descriptor . filenameFor ( Component . PRIMARY _ INDEX ) ) . length ( ) ; <nl> int indexBufferSize = optimizationStrategy . bufferSize ( indexFileLength / indexSummary . size ( ) ) ; <nl> ifile = ibuilder . bufferSize ( indexBufferSize ) . complete ( ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableReader . java b / src / java / org / apache / cassandra / io / sstable / SSTableReader . java <nl> index 48f24ee . . a258ea0 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableReader . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableReader . java <nl> @ @ - 478 , 6 + 478 , 7 @ @ public class SSTableReader extends SSTable implements Comparable < SSTableReader > <nl> { <nl> throw new IOError ( e ) ; <nl> } <nl> + components . add ( Component . COMPACTED _ MARKER ) ; <nl> phantomReference . deleteOnCleanup ( ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java b / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java 
 index 78a6825 . . fc0849f 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / format / SSTableReader . java 
 @ @ - 752 , 11 + 752 , 11 @ @ public abstract class SSTableReader extends SSTable implements SelfRefCounted < SS 
 builtSummary = true ; 
 } 
 
 - long indexFileLength = new File ( descriptor . filenameFor ( Component . PRIMARY _ INDEX ) ) . length ( ) ; 
 int dataBufferSize = optimizationStrategy . bufferSize ( sstableMetadata . estimatedPartitionSize . percentile ( DatabaseDescriptor . getDiskOptimizationEstimatePercentile ( ) ) ) ; 
 
 if ( components . contains ( Component . PRIMARY _ INDEX ) ) 
 { 
 + long indexFileLength = new File ( descriptor . filenameFor ( Component . PRIMARY _ INDEX ) ) . length ( ) ; 
 int indexBufferSize = optimizationStrategy . bufferSize ( indexFileLength / indexSummary . size ( ) ) ; 
 ifile = ibuilder . bufferSize ( indexBufferSize ) . complete ( ) ; 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableReader . java b / src / java / org / apache / cassandra / io / sstable / SSTableReader . java 
 index 48f24ee . . a258ea0 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableReader . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableReader . java 
 @ @ - 478 , 6 + 478 , 7 @ @ public class SSTableReader extends SSTable implements Comparable < SSTableReader > 
 { 
 throw new IOError ( e ) ; 
 } 
 + components . add ( Component . COMPACTED _ MARKER ) ; 
 phantomReference . deleteOnCleanup ( ) ; 
 } 

