BLEU SCORE: 0.07809849842300641

TEST MSG: Fix infinite loop on exception while streaming
GENERATED MSG: Fix streaming retry

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index bc95a8d . . 37105f3 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 11 , 6 + 11 , 7 @ @ <nl> * Add authentication support to shuffle ( CASSANDRA - 6484 ) <nl> * Cqlsh counts non - empty lines for " Blank lines " warning ( CASSANDRA - 7325 ) <nl> * Make StreamSession # closeSession ( ) idempotent ( CASSANDRA - 7262 ) <nl> + * Fix infinite loop on exception while streaming ( CASSANDRA - 7330 ) <nl> Merged from 1 . 2 : <nl> * Fix availability validation for LOCAL _ ONE CL ( CASSANDRA - 7319 ) <nl> * Use LOCAL _ ONE for non - superuser auth queries ( CASSANDRA - 7328 ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamReader . java b / src / java / org / apache / cassandra / streaming / StreamReader . java <nl> index 72c239c . . 15aa3cb 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamReader . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamReader . java <nl> @ @ - 114 , 9 + 114 , 20 @ @ public class StreamReader <nl> protected void drain ( InputStream dis , long bytesRead ) throws IOException <nl> { <nl> long toSkip = totalSize ( ) - bytesRead ; <nl> - toSkip = toSkip - dis . skip ( toSkip ) ; <nl> + <nl> + / / InputStream . skip can return - 1 if dis is inaccessible . <nl> + long skipped = dis . skip ( toSkip ) ; <nl> + if ( skipped = = - 1 ) <nl> + return ; <nl> + <nl> + toSkip = toSkip - skipped ; <nl> while ( toSkip > 0 ) <nl> - toSkip = toSkip - dis . skip ( toSkip ) ; <nl> + { <nl> + skipped = dis . skip ( toSkip ) ; <nl> + if ( skipped = = - 1 ) <nl> + break ; <nl> + toSkip = toSkip - skipped ; <nl> + } <nl> } <nl> <nl> protected long totalSize ( )
NEAREST DIFF (one line): diff - - git a / . rat - excludes b / . rat - excludes <nl> index 329cea6 . . 8d2ead8 100644 <nl> - - - a / . rat - excludes <nl> + + + b / . rat - excludes <nl> @ @ - 23 , 5 + 23 , 7 @ @ doc / * * <nl> build . properties . default <nl> test / data / * * <nl> examples / pig / * * <nl> + examples / triggers / build . xml <nl> + examples / triggers / conf / * <nl> examples / hadoop _ word _ count / conf / log4j . properties <nl> pylib / cqlshlib / test / * * <nl> diff - - git a / build . xml b / build . xml <nl> index 04e58e3 . . da653c8 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 25 , 7 + 25 , 7 @ @ <nl> < property name = " debuglevel " value = " source , lines , vars " / > <nl> <nl> < ! - - default version and SCM information - - > <nl> - < property name = " base . version " value = " 2 . 0 . 0 - beta1 " / > <nl> + < property name = " base . version " value = " 2 . 0 . 0 - beta2 " / > <nl> < property name = " scm . connection " value = " scm : git : / / git . apache . org / cassandra . git " / > <nl> < property name = " scm . developerConnection " value = " scm : git : / / git . apache . org / cassandra . git " / > <nl> < property name = " scm . url " value = " http : / / git - wip - us . apache . org / repos / asf ? p = cassandra . git ; a = tree " / > <nl> diff - - git a / debian / changelog b / debian / changelog <nl> index 1d87846 . . fc418c7 100644 <nl> - - - a / debian / changelog <nl> + + + b / debian / changelog <nl> @ @ - 1 , 3 + 1 , 9 @ @ <nl> + cassandra ( 2 . 0 . 0 ~ beta2 ) unstable ; urgency = low <nl> + <nl> + * New beta release <nl> + <nl> + - - Sylvain Lebresne < slebresne @ apache . org > Mon , 22 Jul 2013 16 : 53 : 37 + 0200 <nl> + <nl> cassandra ( 2 . 0 . 0 ~ beta1 ) unstable ; urgency = low <nl> <nl> * New beta release <nl> diff - - git a / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java b / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java <nl> index 6eb0cbd . . 055e70e 100644 <nl> - - - a / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java <nl> + + + b / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java <nl> @ @ - 1 , 3 + 1 , 20 @ @ <nl> + / * * <nl> + * Licensed to the Apache Software Foundation ( ASF ) under one <nl> + * or more contributor license agreements . See the NOTICE file <nl> + * distributed with this work for additional information <nl> + * regarding copyright ownership . The ASF licenses this file <nl> + * to you under the Apache License , Version 2 . 0 ( the <nl> + * " License " ) ; you may not use this file except in compliance <nl> + * with the License . You may obtain a copy of the License at <nl> + * <nl> + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 <nl> + * <nl> + * Unless required by applicable law or agreed to in writing , software <nl> + * distributed under the License is distributed on an " AS IS " BASIS , <nl> + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . <nl> + * See the License for the specific language governing permissions and <nl> + * limitations under the License . <nl> + * / <nl> package org . apache . cassandra . triggers ; <nl> <nl> import java . io . InputStream ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index bc95a8d . . 37105f3 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 11 , 6 + 11 , 7 @ @ 
 * Add authentication support to shuffle ( CASSANDRA - 6484 ) 
 * Cqlsh counts non - empty lines for " Blank lines " warning ( CASSANDRA - 7325 ) 
 * Make StreamSession # closeSession ( ) idempotent ( CASSANDRA - 7262 ) 
 + * Fix infinite loop on exception while streaming ( CASSANDRA - 7330 ) 
 Merged from 1 . 2 : 
 * Fix availability validation for LOCAL _ ONE CL ( CASSANDRA - 7319 ) 
 * Use LOCAL _ ONE for non - superuser auth queries ( CASSANDRA - 7328 ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamReader . java b / src / java / org / apache / cassandra / streaming / StreamReader . java 
 index 72c239c . . 15aa3cb 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamReader . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamReader . java 
 @ @ - 114 , 9 + 114 , 20 @ @ public class StreamReader 
 protected void drain ( InputStream dis , long bytesRead ) throws IOException 
 { 
 long toSkip = totalSize ( ) - bytesRead ; 
 - toSkip = toSkip - dis . skip ( toSkip ) ; 
 + 
 + / / InputStream . skip can return - 1 if dis is inaccessible . 
 + long skipped = dis . skip ( toSkip ) ; 
 + if ( skipped = = - 1 ) 
 + return ; 
 + 
 + toSkip = toSkip - skipped ; 
 while ( toSkip > 0 ) 
 - toSkip = toSkip - dis . skip ( toSkip ) ; 
 + { 
 + skipped = dis . skip ( toSkip ) ; 
 + if ( skipped = = - 1 ) 
 + break ; 
 + toSkip = toSkip - skipped ; 
 + } 
 } 
 
 protected long totalSize ( )

NEAREST DIFF:
diff - - git a / . rat - excludes b / . rat - excludes 
 index 329cea6 . . 8d2ead8 100644 
 - - - a / . rat - excludes 
 + + + b / . rat - excludes 
 @ @ - 23 , 5 + 23 , 7 @ @ doc / * * 
 build . properties . default 
 test / data / * * 
 examples / pig / * * 
 + examples / triggers / build . xml 
 + examples / triggers / conf / * 
 examples / hadoop _ word _ count / conf / log4j . properties 
 pylib / cqlshlib / test / * * 
 diff - - git a / build . xml b / build . xml 
 index 04e58e3 . . da653c8 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 25 , 7 + 25 , 7 @ @ 
 < property name = " debuglevel " value = " source , lines , vars " / > 
 
 < ! - - default version and SCM information - - > 
 - < property name = " base . version " value = " 2 . 0 . 0 - beta1 " / > 
 + < property name = " base . version " value = " 2 . 0 . 0 - beta2 " / > 
 < property name = " scm . connection " value = " scm : git : / / git . apache . org / cassandra . git " / > 
 < property name = " scm . developerConnection " value = " scm : git : / / git . apache . org / cassandra . git " / > 
 < property name = " scm . url " value = " http : / / git - wip - us . apache . org / repos / asf ? p = cassandra . git ; a = tree " / > 
 diff - - git a / debian / changelog b / debian / changelog 
 index 1d87846 . . fc418c7 100644 
 - - - a / debian / changelog 
 + + + b / debian / changelog 
 @ @ - 1 , 3 + 1 , 9 @ @ 
 + cassandra ( 2 . 0 . 0 ~ beta2 ) unstable ; urgency = low 
 + 
 + * New beta release 
 + 
 + - - Sylvain Lebresne < slebresne @ apache . org > Mon , 22 Jul 2013 16 : 53 : 37 + 0200 
 + 
 cassandra ( 2 . 0 . 0 ~ beta1 ) unstable ; urgency = low 
 
 * New beta release 
 diff - - git a / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java b / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java 
 index 6eb0cbd . . 055e70e 100644 
 - - - a / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java 
 + + + b / examples / triggers / src / org / apache / cassandra / triggers / InvertedIndex . java 
 @ @ - 1 , 3 + 1 , 20 @ @ 
 + / * * 
 + * Licensed to the Apache Software Foundation ( ASF ) under one 
 + * or more contributor license agreements . See the NOTICE file 
 + * distributed with this work for additional information 
 + * regarding copyright ownership . The ASF licenses this file 
 + * to you under the Apache License , Version 2 . 0 ( the 
 + * " License " ) ; you may not use this file except in compliance 
 + * with the License . You may obtain a copy of the License at 
 + * 
 + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 
 + * 
 + * Unless required by applicable law or agreed to in writing , software 
 + * distributed under the License is distributed on an " AS IS " BASIS , 
 + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . 
 + * See the License for the specific language governing permissions and 
 + * limitations under the License . 
 + * / 
 package org . apache . cassandra . triggers ; 
 
 import java . io . InputStream ;
