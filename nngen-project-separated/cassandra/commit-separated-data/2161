BLEU SCORE: 0.006983826580902993

TEST MSG: don ' t declare throwing exceptions that aren ' t
GENERATED MSG: Revert " fix broadcastAddress and Ec2MultiRegionSnitch . reconnect patch by Vijay ; reviewed by Brandon Williams for CASSANDRA - 3835 "

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cql3 / ColumnCondition . java b / src / java / org / apache / cassandra / cql3 / ColumnCondition . java <nl> index 703ac5b . . 33926c1 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / ColumnCondition . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / ColumnCondition . java <nl> @ @ - 325 , 7 + 325 , 7 @ @ public class ColumnCondition <nl> return idx ; <nl> } <nl> <nl> - static ByteBuffer getListItem ( Iterator < Cell > iter , int index ) throws InvalidRequestException <nl> + static ByteBuffer getListItem ( Iterator < Cell > iter , int index ) <nl> { <nl> int adv = Iterators . advance ( iter , index ) ; <nl> if ( adv = = index & & iter . hasNext ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / service / MigrationManager . java b / src / java / org / apache / cassandra / service / MigrationManager . java <nl> index b3277ee . . b0cf79d 100644 <nl> - - - a / src / java / org / apache / cassandra / service / MigrationManager . java <nl> + + + b / src / java / org / apache / cassandra / service / MigrationManager . java <nl> @ @ - 374 , 7 + 374 , 7 @ @ public class MigrationManager <nl> announce ( addSerializedKeyspace ( UTMetaData . dropFromSchema ( droppedType , FBUtilities . timestampMicros ( ) ) , droppedType . keyspace ) , announceLocally ) ; <nl> } <nl> <nl> - public static void announceFunctionDrop ( FunctionName fun , boolean announceLocally ) throws InvalidRequestException <nl> + public static void announceFunctionDrop ( FunctionName fun , boolean announceLocally ) <nl> { <nl> logger . info ( String . format ( " Drop Function ' % s ' " , fun ) ) ; <nl> announce ( UDFunction . dropFromSchema ( FBUtilities . timestampMicros ( ) , fun ) , announceLocally ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java < nl > index 61cc53e . . 6b1e637 100644 < nl > - - - a / src / java / org / apache / cassandra / cli / CliClient . java < nl > + + + b / src / java / org / apache / cassandra / cli / CliClient . java < nl > @ @ - 1155 , 15 + 1155 , 7 @ @ public class CliClient < nl > { < nl > SimpleSnitch snitch = new SimpleSnitch ( ) ; < nl > Map < String , String > options = new HashMap < String , String > ( ) ; < nl > - < nl > - try < nl > - { < nl > - options . put ( snitch . getDatacenter ( InetAddress . getLocalHost ( ) ) , " 1 " ) ; < nl > - } < nl > - catch ( UnknownHostException e ) < nl > - { < nl > - throw new RuntimeException ( e ) ; < nl > - } < nl > + options . put ( snitch . getDatacenter ( FBUtilities . getBroadcastAddress ( ) ) , " 1 " ) ; < nl > < nl > ksDef . setStrategy _ options ( options ) ; < nl > } < nl > diff - - git a / src / java / org / apache / cassandra / db / SystemTable . java b / src / java / org / apache / cassandra / db / SystemTable . java < nl > index c831382 . . 7e13fc4 100644 < nl > - - - a / src / java / org / apache / cassandra / db / SystemTable . java < nl > + + + b / src / java / org / apache / cassandra / db / SystemTable . java < nl > @ @ - 138 , 7 + 138 , 7 @ @ public class SystemTable < nl > * / < nl > public static synchronized void updateToken ( InetAddress ep , Token token ) < nl > { < nl > - if ( ep = = FBUtilities . getLocalAddress ( ) ) < nl > + if ( ep = = FBUtilities . getBroadcastAddress ( ) ) < nl > { < nl > removeToken ( token ) ; < nl > return ; < nl > diff - - git a / src / java / org / apache / cassandra / gms / Gossiper . java b / src / java / org / apache / cassandra / gms / Gossiper . java < nl > index d1a5b8d . . 96576fb 100644 < nl > - - - a / src / java / org / apache / cassandra / gms / Gossiper . java < nl > + + + b / src / java / org / apache / cassandra / gms / Gossiper . java < nl > @ @ - 1095 , 7 + 1095 , 7 @ @ public class Gossiper implements IFailureDetectionEventListener , GossiperMBean < nl > * / < nl > public void addSavedEndpoint ( InetAddress ep ) < nl > { < nl > - if ( ep = = FBUtilities . getLocalAddress ( ) ) < nl > + if ( ep = = FBUtilities . getBroadcastAddress ( ) ) < nl > { < nl > logger . debug ( " Attempt to add self as saved endpoint " ) ; < nl > return ; < nl > diff - - git a / src / java / org / apache / cassandra / net / OutboundTcpConnection . java b / src / java / org / apache / cassandra / net / OutboundTcpConnection . java < nl > index 17c2097 . . a597aab 100644 < nl > - - - a / src / java / org / apache / cassandra / net / OutboundTcpConnection . java < nl > + + + b / src / java / org / apache / cassandra / net / OutboundTcpConnection . java < nl > @ @ - 78 , 6 + 78 , 11 @ @ public class OutboundTcpConnection extends Thread < nl > enqueue ( CLOSE _ SENTINEL , null ) ; < nl > } < nl > < nl > + void softCloseSocket ( ) < nl > + { < nl > + enqueue ( CLOSE _ SENTINEL , null ) ; < nl > + } < nl > + < nl > public void run ( ) < nl > { < nl > while ( true ) < nl > diff - - git a / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java b / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java < nl > index c7acd9e . . a75dafe 100644 < nl > - - - a / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java < nl > + + + b / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java < nl > @ @ - 68 , 7 + 68 , 8 @ @ public class OutboundTcpConnectionPool < nl > public void reset ( InetAddress remoteEP ) < nl > { < nl > resetedEndpoint = remoteEP ; < nl > - reset ( ) ; < nl > + for ( OutboundTcpConnection con : new OutboundTcpConnection [ ] { cmdCon , ackCon } ) < nl > + con . softCloseSocket ( ) ; < nl > } < nl > < nl > public Socket newSocket ( ) throws IOException < nl > @ @ - 78 , 7 + 79 , 8 @ @ public class OutboundTcpConnectionPool < nl > { < nl > return SSLFactory . getSocket ( DatabaseDescriptor . getEncryptionOptions ( ) , endPoint ( ) , DatabaseDescriptor . getSSLStoragePort ( ) , FBUtilities . getLocalAddress ( ) , 0 ) ; < nl > } < nl > - else { < nl > + else < nl > + { < nl > return new Socket ( endPoint ( ) , DatabaseDescriptor . getStoragePort ( ) , FBUtilities . getLocalAddress ( ) , 0 ) ; < nl > } < nl > } < nl > diff - - git a / src / java / org / apache / cassandra / service / MigrationManager . java b / src / java / org / apache / cassandra / service / MigrationManager . java < nl > index 4f6a5a7 . . cf0cbcd 100644 < nl > - - - a / src / java / org / apache / cassandra / service / MigrationManager . java < nl > + + + b / src / java / org / apache / cassandra / service / MigrationManager . java < nl > @ @ - 54 , 7 + 54 , 7 @ @ public class MigrationManager implements IEndpointStateChangeSubscriber < nl > / / avoids re - pushing migrations that we ' re waiting on target to apply already < nl > private static Map < InetAddress , UUID > lastPushed = new MapMaker ( ) . expiration ( 1 , TimeUnit . MINUTES ) . makeMap ( ) ; < nl > < nl > - private static UUID highestKnown ; < nl > + private static volatile UUID highestKnown ; < nl > < nl > public void onJoin ( InetAddress endpoint , EndpointState epState ) { < nl > VersionedValue value = epState . getApplicationState ( ApplicationState . SCHEMA ) ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / cql3 / ColumnCondition . java b / src / java / org / apache / cassandra / cql3 / ColumnCondition . java 
 index 703ac5b . . 33926c1 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / ColumnCondition . java 
 + + + b / src / java / org / apache / cassandra / cql3 / ColumnCondition . java 
 @ @ - 325 , 7 + 325 , 7 @ @ public class ColumnCondition 
 return idx ; 
 } 
 
 - static ByteBuffer getListItem ( Iterator < Cell > iter , int index ) throws InvalidRequestException 
 + static ByteBuffer getListItem ( Iterator < Cell > iter , int index ) 
 { 
 int adv = Iterators . advance ( iter , index ) ; 
 if ( adv = = index & & iter . hasNext ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / service / MigrationManager . java b / src / java / org / apache / cassandra / service / MigrationManager . java 
 index b3277ee . . b0cf79d 100644 
 - - - a / src / java / org / apache / cassandra / service / MigrationManager . java 
 + + + b / src / java / org / apache / cassandra / service / MigrationManager . java 
 @ @ - 374 , 7 + 374 , 7 @ @ public class MigrationManager 
 announce ( addSerializedKeyspace ( UTMetaData . dropFromSchema ( droppedType , FBUtilities . timestampMicros ( ) ) , droppedType . keyspace ) , announceLocally ) ; 
 } 
 
 - public static void announceFunctionDrop ( FunctionName fun , boolean announceLocally ) throws InvalidRequestException 
 + public static void announceFunctionDrop ( FunctionName fun , boolean announceLocally ) 
 { 
 logger . info ( String . format ( " Drop Function ' % s ' " , fun ) ) ; 
 announce ( UDFunction . dropFromSchema ( FBUtilities . timestampMicros ( ) , fun ) , announceLocally ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java 
 index 61cc53e . . 6b1e637 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliClient . java 
 + + + b / src / java / org / apache / cassandra / cli / CliClient . java 
 @ @ - 1155 , 15 + 1155 , 7 @ @ public class CliClient 
 { 
 SimpleSnitch snitch = new SimpleSnitch ( ) ; 
 Map < String , String > options = new HashMap < String , String > ( ) ; 
 - 
 - try 
 - { 
 - options . put ( snitch . getDatacenter ( InetAddress . getLocalHost ( ) ) , " 1 " ) ; 
 - } 
 - catch ( UnknownHostException e ) 
 - { 
 - throw new RuntimeException ( e ) ; 
 - } 
 + options . put ( snitch . getDatacenter ( FBUtilities . getBroadcastAddress ( ) ) , " 1 " ) ; 
 
 ksDef . setStrategy _ options ( options ) ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / db / SystemTable . java b / src / java / org / apache / cassandra / db / SystemTable . java 
 index c831382 . . 7e13fc4 100644 
 - - - a / src / java / org / apache / cassandra / db / SystemTable . java 
 + + + b / src / java / org / apache / cassandra / db / SystemTable . java 
 @ @ - 138 , 7 + 138 , 7 @ @ public class SystemTable 
 * / 
 public static synchronized void updateToken ( InetAddress ep , Token token ) 
 { 
 - if ( ep = = FBUtilities . getLocalAddress ( ) ) 
 + if ( ep = = FBUtilities . getBroadcastAddress ( ) ) 
 { 
 removeToken ( token ) ; 
 return ; 
 diff - - git a / src / java / org / apache / cassandra / gms / Gossiper . java b / src / java / org / apache / cassandra / gms / Gossiper . java 
 index d1a5b8d . . 96576fb 100644 
 - - - a / src / java / org / apache / cassandra / gms / Gossiper . java 
 + + + b / src / java / org / apache / cassandra / gms / Gossiper . java 
 @ @ - 1095 , 7 + 1095 , 7 @ @ public class Gossiper implements IFailureDetectionEventListener , GossiperMBean 
 * / 
 public void addSavedEndpoint ( InetAddress ep ) 
 { 
 - if ( ep = = FBUtilities . getLocalAddress ( ) ) 
 + if ( ep = = FBUtilities . getBroadcastAddress ( ) ) 
 { 
 logger . debug ( " Attempt to add self as saved endpoint " ) ; 
 return ; 
 diff - - git a / src / java / org / apache / cassandra / net / OutboundTcpConnection . java b / src / java / org / apache / cassandra / net / OutboundTcpConnection . java 
 index 17c2097 . . a597aab 100644 
 - - - a / src / java / org / apache / cassandra / net / OutboundTcpConnection . java 
 + + + b / src / java / org / apache / cassandra / net / OutboundTcpConnection . java 
 @ @ - 78 , 6 + 78 , 11 @ @ public class OutboundTcpConnection extends Thread 
 enqueue ( CLOSE _ SENTINEL , null ) ; 
 } 
 
 + void softCloseSocket ( ) 
 + { 
 + enqueue ( CLOSE _ SENTINEL , null ) ; 
 + } 
 + 
 public void run ( ) 
 { 
 while ( true ) 
 diff - - git a / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java b / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java 
 index c7acd9e . . a75dafe 100644 
 - - - a / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java 
 + + + b / src / java / org / apache / cassandra / net / OutboundTcpConnectionPool . java 
 @ @ - 68 , 7 + 68 , 8 @ @ public class OutboundTcpConnectionPool 
 public void reset ( InetAddress remoteEP ) 
 { 
 resetedEndpoint = remoteEP ; 
 - reset ( ) ; 
 + for ( OutboundTcpConnection con : new OutboundTcpConnection [ ] { cmdCon , ackCon } ) 
 + con . softCloseSocket ( ) ; 
 } 
 
 public Socket newSocket ( ) throws IOException 
 @ @ - 78 , 7 + 79 , 8 @ @ public class OutboundTcpConnectionPool 
 { 
 return SSLFactory . getSocket ( DatabaseDescriptor . getEncryptionOptions ( ) , endPoint ( ) , DatabaseDescriptor . getSSLStoragePort ( ) , FBUtilities . getLocalAddress ( ) , 0 ) ; 
 } 
 - else { 
 + else 
 + { 
 return new Socket ( endPoint ( ) , DatabaseDescriptor . getStoragePort ( ) , FBUtilities . getLocalAddress ( ) , 0 ) ; 
 } 
 } 
 diff - - git a / src / java / org / apache / cassandra / service / MigrationManager . java b / src / java / org / apache / cassandra / service / MigrationManager . java 
 index 4f6a5a7 . . cf0cbcd 100644 
 - - - a / src / java / org / apache / cassandra / service / MigrationManager . java 
 + + + b / src / java / org / apache / cassandra / service / MigrationManager . java 
 @ @ - 54 , 7 + 54 , 7 @ @ public class MigrationManager implements IEndpointStateChangeSubscriber 
 / / avoids re - pushing migrations that we ' re waiting on target to apply already 
 private static Map < InetAddress , UUID > lastPushed = new MapMaker ( ) . expiration ( 1 , TimeUnit . MINUTES ) . makeMap ( ) ; 
 
 - private static UUID highestKnown ; 
 + private static volatile UUID highestKnown ; 
 
 public void onJoin ( InetAddress endpoint , EndpointState epState ) { 
 VersionedValue value = epState . getApplicationState ( ApplicationState . SCHEMA ) ;
