BLEU SCORE: 1.0

TEST MSG: Improve config validation and documentation on overflow and NPE
GENERATED MSG: Improve config validation and documentation on overflow and NPE

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 26b1794 . . 6053117 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 5 + 1 , 6 @ @ <nl> 3 . 0 . 15 <nl> * Fix pending view mutations handling and cleanup batchlog when there are local and remote paired mutations ( CASSANDRA - 13069 ) <nl> + * Improve config validation and documentation on overflow and NPE ( CASSANDRA - 13622 ) <nl> * Range deletes in a CAS batch are ignored ( CASSANDRA - 13655 ) <nl> * Change repair midpoint logging for tiny ranges ( CASSANDRA - 13603 ) <nl> * Better handle corrupt final commitlog segment ( CASSANDRA - 11995 ) <nl> diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml <nl> index 22491c6 . . d77d27a 100644 <nl> - - - a / conf / cassandra . yaml <nl> + + + b / conf / cassandra . yaml <nl> @ @ - 315 , 6 + 315 , 7 @ @ commitlog _ sync _ period _ in _ ms : 10000 <nl> # is reasonable . <nl> # Max mutation size is also configurable via max _ mutation _ size _ in _ kb setting in <nl> # cassandra . yaml . The default is half the size commitlog _ segment _ size _ in _ mb * 1024 . <nl> + # This should be positive and less than 2048 . <nl> # <nl> # NOTE : If max _ mutation _ size _ in _ kb is set explicitly then commitlog _ segment _ size _ in _ mb must <nl> # be set to at least twice the size of max _ mutation _ size _ in _ kb / 1024 <nl> @ @ - 517 , 7 + 518 , 7 @ @ native _ transport _ port : 9042 <nl> # <nl> # The maximum size of allowed frame . Frame ( requests ) larger than this will <nl> # be rejected as invalid . The default is 256MB . If you ' re changing this parameter , <nl> - # you may want to adjust max _ value _ size _ in _ mb accordingly . <nl> + # you may want to adjust max _ value _ size _ in _ mb accordingly . This should be positive and less than 2048 . <nl> # native _ transport _ max _ frame _ size _ in _ mb : 256 <nl> <nl> # The maximum number of concurrent client connections . <nl> @ @ - 960 , 7 + 961 , 7 @ @ windows _ timer _ interval : 1 <nl> <nl> # Maximum size of any value in SSTables . Safety measure to detect SSTable corruption <nl> # early . Any value size larger than this threshold will result into marking an SSTable <nl> - # as corrupted . <nl> + # as corrupted . This should be positive and less than 2048 . <nl> # max _ value _ size _ in _ mb : 256 <nl> <nl> # Coalescing Strategies # <nl> diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index aba7617 . . 029db89 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 442 , 6 + 442 , 9 @ @ public class DatabaseDescriptor <nl> <nl> if ( conf . native _ transport _ max _ frame _ size _ in _ mb < = 0 ) <nl> throw new ConfigurationException ( " native _ transport _ max _ frame _ size _ in _ mb must be positive , but was " + conf . native _ transport _ max _ frame _ size _ in _ mb , false ) ; <nl> + else if ( conf . native _ transport _ max _ frame _ size _ in _ mb > = 2048 ) <nl> + throw new ConfigurationException ( " native _ transport _ max _ frame _ size _ in _ mb must be smaller than 2048 , but was " <nl> + + conf . native _ transport _ max _ frame _ size _ in _ mb , false ) ; <nl> <nl> / / fail early instead of OOMing ( see CASSANDRA - 8116 ) <nl> if ( ThriftServer . HSHA . equals ( conf . rpc _ server _ type ) & & conf . rpc _ max _ threads = = Integer . MAX _ VALUE ) <nl> @ @ - 576 , 6 + 579 , 8 @ @ public class DatabaseDescriptor <nl> / * data file and commit log directories . they get created later , when they ' re needed . * / <nl> for ( String datadir : conf . data _ file _ directories ) <nl> { <nl> + if ( datadir = = null ) <nl> + throw new ConfigurationException ( " data _ file _ directories must not contain empty entry " , false ) ; <nl> if ( datadir . equals ( conf . commitlog _ directory ) ) <nl> throw new ConfigurationException ( " commitlog _ directory must not be the same as any data _ file _ directories " , false ) ; <nl> if ( datadir . equals ( conf . hints _ directory ) ) <nl> @ @ - 718 , 6 + 723 , 13 @ @ public class DatabaseDescriptor <nl> if ( conf . user _ defined _ function _ fail _ timeout < conf . user _ defined _ function _ warn _ timeout ) <nl> throw new ConfigurationException ( " user _ defined _ function _ warn _ timeout must less than user _ defined _ function _ fail _ timeout " , false ) ; <nl> <nl> + if ( conf . commitlog _ segment _ size _ in _ mb < = 0 ) <nl> + throw new ConfigurationException ( " commitlog _ segment _ size _ in _ mb must be positive , but was " <nl> + + conf . commitlog _ segment _ size _ in _ mb , false ) ; <nl> + else if ( conf . commitlog _ segment _ size _ in _ mb > = 2048 ) <nl> + throw new ConfigurationException ( " commitlog _ segment _ size _ in _ mb must be smaller than 2048 , but was " <nl> + + conf . commitlog _ segment _ size _ in _ mb , false ) ; <nl> + <nl> if ( conf . max _ mutation _ size _ in _ kb = = null ) <nl> conf . max _ mutation _ size _ in _ kb = conf . commitlog _ segment _ size _ in _ mb * 1024 / 2 ; <nl> else if ( conf . commitlog _ segment _ size _ in _ mb * 1024 < 2 * conf . max _ mutation _ size _ in _ kb ) <nl> @ @ - 733 , 6 + 745 , 9 @ @ public class DatabaseDescriptor <nl> <nl> if ( conf . max _ value _ size _ in _ mb = = null | | conf . max _ value _ size _ in _ mb < = 0 ) <nl> throw new ConfigurationException ( " max _ value _ size _ in _ mb must be positive " , false ) ; <nl> + else if ( conf . max _ value _ size _ in _ mb > = 2048 ) <nl> + throw new ConfigurationException ( " max _ value _ size _ in _ mb must be smaller than 2048 , but was " <nl> + + conf . max _ value _ size _ in _ mb , false ) ; <nl> <nl> if ( conf . otc _ coalescing _ enough _ coalesced _ messages > 128 ) <nl> throw new ConfigurationException ( " otc _ coalescing _ enough _ coalesced _ messages must be smaller than 128 " , false ) ; <nl> diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> index ca2775f . . 5562f5e 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> @ @ - 34 , 6 + 34 , 8 @ @ import javax . annotation . Nullable ; <nl> <nl> import com . google . common . annotations . VisibleForTesting ; <nl> import com . google . common . base . Joiner ; <nl> + import com . google . common . base . Strings ; <nl> + <nl> import org . apache . commons . lang3 . StringUtils ; <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ; <nl> @ @ - 82 , 8 + 84 , 9 @ @ public class FBUtilities <nl> <nl> public static int getAvailableProcessors ( ) <nl> { <nl> - if ( System . getProperty ( " cassandra . available _ processors " ) ! = null ) <nl> - return Integer . parseInt ( System . getProperty ( " cassandra . available _ processors " ) ) ; <nl> + String availableProcessors = System . getProperty ( " cassandra . available _ processors " ) ; <nl> + if ( ! Strings . isNullOrEmpty ( availableProcessors ) ) <nl> + return Integer . parseInt ( availableProcessors ) ; <nl> else <nl> return Runtime . getRuntime ( ) . availableProcessors ( ) ; <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 26b1794 . . 6053117 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 5 + 1 , 6 @ @ 
 3 . 0 . 15 
 * Fix pending view mutations handling and cleanup batchlog when there are local and remote paired mutations ( CASSANDRA - 13069 ) 
 + * Improve config validation and documentation on overflow and NPE ( CASSANDRA - 13622 ) 
 * Range deletes in a CAS batch are ignored ( CASSANDRA - 13655 ) 
 * Change repair midpoint logging for tiny ranges ( CASSANDRA - 13603 ) 
 * Better handle corrupt final commitlog segment ( CASSANDRA - 11995 ) 
 diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml 
 index 22491c6 . . d77d27a 100644 
 - - - a / conf / cassandra . yaml 
 + + + b / conf / cassandra . yaml 
 @ @ - 315 , 6 + 315 , 7 @ @ commitlog _ sync _ period _ in _ ms : 10000 
 # is reasonable . 
 # Max mutation size is also configurable via max _ mutation _ size _ in _ kb setting in 
 # cassandra . yaml . The default is half the size commitlog _ segment _ size _ in _ mb * 1024 . 
 + # This should be positive and less than 2048 . 
 # 
 # NOTE : If max _ mutation _ size _ in _ kb is set explicitly then commitlog _ segment _ size _ in _ mb must 
 # be set to at least twice the size of max _ mutation _ size _ in _ kb / 1024 
 @ @ - 517 , 7 + 518 , 7 @ @ native _ transport _ port : 9042 
 # 
 # The maximum size of allowed frame . Frame ( requests ) larger than this will 
 # be rejected as invalid . The default is 256MB . If you ' re changing this parameter , 
 - # you may want to adjust max _ value _ size _ in _ mb accordingly . 
 + # you may want to adjust max _ value _ size _ in _ mb accordingly . This should be positive and less than 2048 . 
 # native _ transport _ max _ frame _ size _ in _ mb : 256 
 
 # The maximum number of concurrent client connections . 
 @ @ - 960 , 7 + 961 , 7 @ @ windows _ timer _ interval : 1 
 
 # Maximum size of any value in SSTables . Safety measure to detect SSTable corruption 
 # early . Any value size larger than this threshold will result into marking an SSTable 
 - # as corrupted . 
 + # as corrupted . This should be positive and less than 2048 . 
 # max _ value _ size _ in _ mb : 256 
 
 # Coalescing Strategies # 
 diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index aba7617 . . 029db89 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 442 , 6 + 442 , 9 @ @ public class DatabaseDescriptor 
 
 if ( conf . native _ transport _ max _ frame _ size _ in _ mb < = 0 ) 
 throw new ConfigurationException ( " native _ transport _ max _ frame _ size _ in _ mb must be positive , but was " + conf . native _ transport _ max _ frame _ size _ in _ mb , false ) ; 
 + else if ( conf . native _ transport _ max _ frame _ size _ in _ mb > = 2048 ) 
 + throw new ConfigurationException ( " native _ transport _ max _ frame _ size _ in _ mb must be smaller than 2048 , but was " 
 + + conf . native _ transport _ max _ frame _ size _ in _ mb , false ) ; 
 
 / / fail early instead of OOMing ( see CASSANDRA - 8116 ) 
 if ( ThriftServer . HSHA . equals ( conf . rpc _ server _ type ) & & conf . rpc _ max _ threads = = Integer . MAX _ VALUE ) 
 @ @ - 576 , 6 + 579 , 8 @ @ public class DatabaseDescriptor 
 / * data file and commit log directories . they get created later , when they ' re needed . * / 
 for ( String datadir : conf . data _ file _ directories ) 
 { 
 + if ( datadir = = null ) 
 + throw new ConfigurationException ( " data _ file _ directories must not contain empty entry " , false ) ; 
 if ( datadir . equals ( conf . commitlog _ directory ) ) 
 throw new ConfigurationException ( " commitlog _ directory must not be the same as any data _ file _ directories " , false ) ; 
 if ( datadir . equals ( conf . hints _ directory ) ) 
 @ @ - 718 , 6 + 723 , 13 @ @ public class DatabaseDescriptor 
 if ( conf . user _ defined _ function _ fail _ timeout < conf . user _ defined _ function _ warn _ timeout ) 
 throw new ConfigurationException ( " user _ defined _ function _ warn _ timeout must less than user _ defined _ function _ fail _ timeout " , false ) ; 
 
 + if ( conf . commitlog _ segment _ size _ in _ mb < = 0 ) 
 + throw new ConfigurationException ( " commitlog _ segment _ size _ in _ mb must be positive , but was " 
 + + conf . commitlog _ segment _ size _ in _ mb , false ) ; 
 + else if ( conf . commitlog _ segment _ size _ in _ mb > = 2048 ) 
 + throw new ConfigurationException ( " commitlog _ segment _ size _ in _ mb must be smaller than 2048 , but was " 
 + + conf . commitlog _ segment _ size _ in _ mb , false ) ; 
 + 
 if ( conf . max _ mutation _ size _ in _ kb = = null ) 
 conf . max _ mutation _ size _ in _ kb = conf . commitlog _ segment _ size _ in _ mb * 1024 / 2 ; 
 else if ( conf . commitlog _ segment _ size _ in _ mb * 1024 < 2 * conf . max _ mutation _ size _ in _ kb ) 
 @ @ - 733 , 6 + 745 , 9 @ @ public class DatabaseDescriptor 
 
 if ( conf . max _ value _ size _ in _ mb = = null | | conf . max _ value _ size _ in _ mb < = 0 ) 
 throw new ConfigurationException ( " max _ value _ size _ in _ mb must be positive " , false ) ; 
 + else if ( conf . max _ value _ size _ in _ mb > = 2048 ) 
 + throw new ConfigurationException ( " max _ value _ size _ in _ mb must be smaller than 2048 , but was " 
 + + conf . max _ value _ size _ in _ mb , false ) ; 
 
 if ( conf . otc _ coalescing _ enough _ coalesced _ messages > 128 ) 
 throw new ConfigurationException ( " otc _ coalescing _ enough _ coalesced _ messages must be smaller than 128 " , false ) ; 
 diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 index ca2775f . . 5562f5e 100644 
 - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java 
 + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 @ @ - 34 , 6 + 34 , 8 @ @ import javax . annotation . Nullable ; 
 
 import com . google . common . annotations . VisibleForTesting ; 
 import com . google . common . base . Joiner ; 
 + import com . google . common . base . Strings ; 
 + 
 import org . apache . commons . lang3 . StringUtils ; 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ; 
 @ @ - 82 , 8 + 84 , 9 @ @ public class FBUtilities 
 
 public static int getAvailableProcessors ( ) 
 { 
 - if ( System . getProperty ( " cassandra . available _ processors " ) ! = null ) 
 - return Integer . parseInt ( System . getProperty ( " cassandra . available _ processors " ) ) ; 
 + String availableProcessors = System . getProperty ( " cassandra . available _ processors " ) ; 
 + if ( ! Strings . isNullOrEmpty ( availableProcessors ) ) 
 + return Integer . parseInt ( availableProcessors ) ; 
 else 
 return Runtime . getRuntime ( ) . availableProcessors ( ) ; 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
