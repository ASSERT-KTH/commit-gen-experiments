BLEU SCORE: 0.03283637368030199

TEST MSG: Fix HSHA / offheap _ objects corruption
GENERATED MSG: remove [ Freeable ] Memory finalizers

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 2113349 . . 248139f 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 8 , 6 + 8 , 7 @ @ Merged from 2 . 0 : <nl> <nl> <nl> 2 . 1 . 3 <nl> + * Fix HSHA / offheap _ objects corruption ( CASSANDRA - 8719 ) <nl> * Upgrade libthrift to 0 . 9 . 2 ( CASSANDRA - 8685 ) <nl> * Don ' t use the shared ref in sstableloader ( CASSANDRA - 8704 ) <nl> * Purge internal prepared statements if related tables or <nl> diff - - git a / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java b / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java <nl> index 129a60b . . 57edc52 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java <nl> + + + b / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java <nl> @ @ - 243 , 7 + 243 , 7 @ @ public abstract class MemoryUtil <nl> if ( buffer . isDirect ( ) ) <nl> setBytes ( unsafe . getLong ( buffer , DIRECT _ BYTE _ BUFFER _ ADDRESS _ OFFSET ) + start , address , count ) ; <nl> else <nl> - setBytes ( address , buffer . array ( ) , start , count ) ; <nl> + setBytes ( address , buffer . array ( ) , buffer . arrayOffset ( ) + start , count ) ; <nl> } <nl> <nl> / * *
NEAREST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / streaming / BootstrapTest . java b / test / unit / org / apache / cassandra / streaming / BootstrapTest . java <nl> index b2d24f4 . . 20313f0 100644 <nl> - - - a / test / unit / org / apache / cassandra / streaming / BootstrapTest . java <nl> + + + b / test / unit / org / apache / cassandra / streaming / BootstrapTest . java <nl> @ @ - 36 , 8 + 36 , 8 @ @ public class BootstrapTest extends SchemaLoader <nl> @ Test <nl> public void testGetNewNames ( ) throws IOException <nl> { <nl> - Descriptor desc = Descriptor . fromFilename ( new File ( " Keyspace1 " , " Keyspace1 - Standard1 - f - 500 - Data . db " ) . toString ( ) ) ; <nl> - assert ! desc . isLatestVersion ; / / deliberately test old version <nl> + Descriptor desc = Descriptor . fromFilename ( new File ( " Keyspace1 " , " Keyspace1 - Standard1 - ia - 500 - Data . db " ) . toString ( ) ) ; <nl> + / / assert ! desc . isLatestVersion ; / / minimum compatible version - - for now it is the latest as well <nl> PendingFile inContext = new PendingFile ( null , desc , " Data . db " , Arrays . asList ( new Pair < Long , Long > ( 0L , 1L ) ) , OperationType . BOOTSTRAP ) ; <nl> <nl> PendingFile outContext = StreamIn . getContextMapping ( inContext ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 2113349 . . 248139f 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 8 , 6 + 8 , 7 @ @ Merged from 2 . 0 : 
 
 
 2 . 1 . 3 
 + * Fix HSHA / offheap _ objects corruption ( CASSANDRA - 8719 ) 
 * Upgrade libthrift to 0 . 9 . 2 ( CASSANDRA - 8685 ) 
 * Don ' t use the shared ref in sstableloader ( CASSANDRA - 8704 ) 
 * Purge internal prepared statements if related tables or 
 diff - - git a / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java b / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java 
 index 129a60b . . 57edc52 100644 
 - - - a / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java 
 + + + b / src / java / org / apache / cassandra / utils / memory / MemoryUtil . java 
 @ @ - 243 , 7 + 243 , 7 @ @ public abstract class MemoryUtil 
 if ( buffer . isDirect ( ) ) 
 setBytes ( unsafe . getLong ( buffer , DIRECT _ BYTE _ BUFFER _ ADDRESS _ OFFSET ) + start , address , count ) ; 
 else 
 - setBytes ( address , buffer . array ( ) , start , count ) ; 
 + setBytes ( address , buffer . array ( ) , buffer . arrayOffset ( ) + start , count ) ; 
 } 
 
 / * *

NEAREST DIFF:
diff - - git a / test / unit / org / apache / cassandra / streaming / BootstrapTest . java b / test / unit / org / apache / cassandra / streaming / BootstrapTest . java 
 index b2d24f4 . . 20313f0 100644 
 - - - a / test / unit / org / apache / cassandra / streaming / BootstrapTest . java 
 + + + b / test / unit / org / apache / cassandra / streaming / BootstrapTest . java 
 @ @ - 36 , 8 + 36 , 8 @ @ public class BootstrapTest extends SchemaLoader 
 @ Test 
 public void testGetNewNames ( ) throws IOException 
 { 
 - Descriptor desc = Descriptor . fromFilename ( new File ( " Keyspace1 " , " Keyspace1 - Standard1 - f - 500 - Data . db " ) . toString ( ) ) ; 
 - assert ! desc . isLatestVersion ; / / deliberately test old version 
 + Descriptor desc = Descriptor . fromFilename ( new File ( " Keyspace1 " , " Keyspace1 - Standard1 - ia - 500 - Data . db " ) . toString ( ) ) ; 
 + / / assert ! desc . isLatestVersion ; / / minimum compatible version - - for now it is the latest as well 
 PendingFile inContext = new PendingFile ( null , desc , " Data . db " , Arrays . asList ( new Pair < Long , Long > ( 0L , 1L ) ) , OperationType . BOOTSTRAP ) ; 
 
 PendingFile outContext = StreamIn . getContextMapping ( inContext ) ;
