BLEU SCORE: 0.016087046643979717

TEST MSG: Allow concurrent use of CQLBulkOutputFormat
GENERATED MSG: Return InvalidRequest when using a keyspace that doesn ' t exist

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 8d64d34 . . 417e8c1 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 1 <nl> + * Allow concurrent use of CQLBulkOutputFormat ( CASSANDRA - 7776 ) <nl> * Shutdown JVM on OOM ( CASSANDRA - 7507 ) <nl> * Upgrade netty version and enable epoll event loop ( CASSANDRA - 7761 ) <nl> * Don ' t duplicate sstables smaller than split size when using <nl> diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java <nl> index 7a75bb4 . . 0a7b9f1 100644 <nl> - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java <nl> + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java <nl> @ @ - 23 , 6 + 23 , 7 @ @ import java . nio . ByteBuffer ; <nl> import java . util . HashMap ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> + import java . util . UUID ; <nl> <nl> import org . apache . cassandra . config . CFMetaData ; <nl> import org . apache . cassandra . exceptions . InvalidRequestException ; <nl> @ @ - 150 , 7 + 151 , 7 @ @ public class CqlBulkRecordWriter extends AbstractBulkRecordWriter < Object , List < B <nl> <nl> private File getColumnFamilyDirectory ( ) throws IOException <nl> { <nl> - File dir = new File ( String . format ( " % s % s % s % s % s " , getOutputLocation ( ) , File . separator , keyspace , File . separator , columnFamily ) ) ; <nl> + File dir = new File ( String . format ( " % s % s % s % s % s - % s " , getOutputLocation ( ) , File . separator , keyspace , File . separator , columnFamily , UUID . randomUUID ( ) . toString ( ) ) ) ; <nl> <nl> if ( ! dir . exists ( ) & & ! dir . mkdirs ( ) ) <nl> {
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index c7a228f . . 06ac8a0 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 54 , 6 + 54 , 8 @ @ <nl> <nl> <nl> 1 . 0 . 8 <nl> + * Return InvalidRequest when using a keyspace that doesn ' t exist <nl> + ( CASSANDRA - 3764 ) <nl> * disallow user modification of System keyspace ( CASSANDRA - 3738 ) <nl> * allow using sstable2json on secondary index data ( CASSANDRA - 3738 ) <nl> * ( cqlsh ) add DESCRIBE COLUMNFAMILIES ( CASSANDRA - 3586 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / ClientState . java b / src / java / org / apache / cassandra / service / ClientState . java <nl> index 0ea7272 . . d2df8a9 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ClientState . java <nl> + + + b / src / java / org / apache / cassandra / service / ClientState . java <nl> @ @ - 18 , 12 + 18 , 7 @ @ <nl> <nl> package org . apache . cassandra . service ; <nl> <nl> - import java . util . ArrayList ; <nl> - import java . util . HashMap ; <nl> - import java . util . LinkedHashMap ; <nl> - import java . util . List ; <nl> - import java . util . Map ; <nl> - import java . util . Set ; <nl> + import java . util . * ; <nl> <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ; <nl> @ @ - 32 , 6 + 27 , 7 @ @ import org . apache . cassandra . auth . AuthenticatedUser ; <nl> import org . apache . cassandra . auth . Permission ; <nl> import org . apache . cassandra . auth . Resources ; <nl> import org . apache . cassandra . config . DatabaseDescriptor ; <nl> + import org . apache . cassandra . config . Schema ; <nl> import org . apache . cassandra . cql . CQLStatement ; <nl> import org . apache . cassandra . db . Table ; <nl> import org . apache . cassandra . thrift . AuthenticationException ; <nl> @ @ - 86 , 8 + 82 , 10 @ @ public class ClientState <nl> return keyspace ; <nl> } <nl> <nl> - public void setKeyspace ( String ks ) <nl> + public void setKeyspace ( String ks ) throws InvalidRequestException <nl> { <nl> + if ( Schema . instance . getKSMetaData ( ks ) = = null ) <nl> + throw new InvalidRequestException ( " Keyspace ' " + ks + " ' does not exist " ) ; <nl> keyspace = ks ; <nl> } <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 8d64d34 . . 417e8c1 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 1 
 + * Allow concurrent use of CQLBulkOutputFormat ( CASSANDRA - 7776 ) 
 * Shutdown JVM on OOM ( CASSANDRA - 7507 ) 
 * Upgrade netty version and enable epoll event loop ( CASSANDRA - 7761 ) 
 * Don ' t duplicate sstables smaller than split size when using 
 diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java 
 index 7a75bb4 . . 0a7b9f1 100644 
 - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java 
 + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlBulkRecordWriter . java 
 @ @ - 23 , 6 + 23 , 7 @ @ import java . nio . ByteBuffer ; 
 import java . util . HashMap ; 
 import java . util . List ; 
 import java . util . Map ; 
 + import java . util . UUID ; 
 
 import org . apache . cassandra . config . CFMetaData ; 
 import org . apache . cassandra . exceptions . InvalidRequestException ; 
 @ @ - 150 , 7 + 151 , 7 @ @ public class CqlBulkRecordWriter extends AbstractBulkRecordWriter < Object , List < B 
 
 private File getColumnFamilyDirectory ( ) throws IOException 
 { 
 - File dir = new File ( String . format ( " % s % s % s % s % s " , getOutputLocation ( ) , File . separator , keyspace , File . separator , columnFamily ) ) ; 
 + File dir = new File ( String . format ( " % s % s % s % s % s - % s " , getOutputLocation ( ) , File . separator , keyspace , File . separator , columnFamily , UUID . randomUUID ( ) . toString ( ) ) ) ; 
 
 if ( ! dir . exists ( ) & & ! dir . mkdirs ( ) ) 
 {

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index c7a228f . . 06ac8a0 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 54 , 6 + 54 , 8 @ @ 
 
 
 1 . 0 . 8 
 + * Return InvalidRequest when using a keyspace that doesn ' t exist 
 + ( CASSANDRA - 3764 ) 
 * disallow user modification of System keyspace ( CASSANDRA - 3738 ) 
 * allow using sstable2json on secondary index data ( CASSANDRA - 3738 ) 
 * ( cqlsh ) add DESCRIBE COLUMNFAMILIES ( CASSANDRA - 3586 ) 
 diff - - git a / src / java / org / apache / cassandra / service / ClientState . java b / src / java / org / apache / cassandra / service / ClientState . java 
 index 0ea7272 . . d2df8a9 100644 
 - - - a / src / java / org / apache / cassandra / service / ClientState . java 
 + + + b / src / java / org / apache / cassandra / service / ClientState . java 
 @ @ - 18 , 12 + 18 , 7 @ @ 
 
 package org . apache . cassandra . service ; 
 
 - import java . util . ArrayList ; 
 - import java . util . HashMap ; 
 - import java . util . LinkedHashMap ; 
 - import java . util . List ; 
 - import java . util . Map ; 
 - import java . util . Set ; 
 + import java . util . * ; 
 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ; 
 @ @ - 32 , 6 + 27 , 7 @ @ import org . apache . cassandra . auth . AuthenticatedUser ; 
 import org . apache . cassandra . auth . Permission ; 
 import org . apache . cassandra . auth . Resources ; 
 import org . apache . cassandra . config . DatabaseDescriptor ; 
 + import org . apache . cassandra . config . Schema ; 
 import org . apache . cassandra . cql . CQLStatement ; 
 import org . apache . cassandra . db . Table ; 
 import org . apache . cassandra . thrift . AuthenticationException ; 
 @ @ - 86 , 8 + 82 , 10 @ @ public class ClientState 
 return keyspace ; 
 } 
 
 - public void setKeyspace ( String ks ) 
 + public void setKeyspace ( String ks ) throws InvalidRequestException 
 { 
 + if ( Schema . instance . getKSMetaData ( ks ) = = null ) 
 + throw new InvalidRequestException ( " Keyspace ' " + ks + " ' does not exist " ) ; 
 keyspace = ks ; 
 } 

