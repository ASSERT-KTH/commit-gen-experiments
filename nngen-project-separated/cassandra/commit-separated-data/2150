BLEU SCORE: 0.027611988917697356

TEST MSG: Don ' t expose internal classes over JMX
GENERATED MSG: Make upgradeSSTables skip current version sstables by default

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 93d77c1 . . befdcd7 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 0 <nl> + * Avoid exposing internal classes over JMX ( CASSANDRA - 7879 ) <nl> * Add null check for keys when freezing collection ( CASSANDRA - 7869 ) <nl> <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionManager . java b / src / java / org / apache / cassandra / db / compaction / CompactionManager . java <nl> index 65c4882 . . 09c068f 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / CompactionManager . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / CompactionManager . java <nl> @ @ - 289 , 7 + 289 , 14 @ @ public class CompactionManager implements CompactionManagerMBean <nl> void execute ( SSTableReader input ) throws IOException ; <nl> } <nl> <nl> - public enum AllSSTableOpStatus { ABORTED , SUCCESSFUL } <nl> + public enum AllSSTableOpStatus { ABORTED ( 1 ) , SUCCESSFUL ( 0 ) ; <nl> + public final int statusCode ; <nl> + <nl> + AllSSTableOpStatus ( int statusCode ) <nl> + { <nl> + this . statusCode = statusCode ; <nl> + } <nl> + } <nl> <nl> public AllSSTableOpStatus performScrub ( final ColumnFamilyStore cfs , final boolean skipCorrupted ) throws InterruptedException , ExecutionException <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 735bf7b . . 5c6dbd6 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2156 , 7 + 2156 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> return Gossiper . instance . getCurrentGenerationNumber ( FBUtilities . getBroadcastAddress ( ) ) ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> if ( keyspaceName . equals ( Keyspace . SYSTEM _ KS ) ) <nl> throw new RuntimeException ( " Cleanup of the system keyspace is neither necessary nor wise " ) ; <nl> @ @ - 2168 , 10 + 2168 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) <nl> status = oneStatus ; <nl> } <nl> - return status ; <nl> + return status . statusCode ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> CompactionManager . AllSSTableOpStatus status = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ; <nl> for ( ColumnFamilyStore cfStore : getValidColumnFamilies ( false , false , keyspaceName , columnFamilies ) ) <nl> @ @ - 2180 , 10 + 2180 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) <nl> status = oneStatus ; <nl> } <nl> - return status ; <nl> + return status . statusCode ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> CompactionManager . AllSSTableOpStatus status = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ; <nl> for ( ColumnFamilyStore cfStore : getValidColumnFamilies ( true , true , keyspaceName , columnFamilies ) ) <nl> @ @ - 2192 , 7 + 2192 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) <nl> status = oneStatus ; <nl> } <nl> - return status ; <nl> + return status . statusCode ; <nl> } <nl> <nl> public void forceKeyspaceCompaction ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index b4cc45b . . 8bb13ae 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 238 , 7 + 238 , 7 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> / * * <nl> * Trigger a cleanup of keys on a single keyspace <nl> * / <nl> - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> <nl> / * * <nl> * Scrub ( deserialize + reserialize at the latest version , skipping bad rows if any ) the given keyspace . <nl> @ @ - 246 , 13 + 246 , 13 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> * <nl> * Scrubbed CFs will be snapshotted first , if disableSnapshot is false <nl> * / <nl> - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> <nl> / * * <nl> * Rewrite all sstables to the latest version . <nl> * Unlike scrub , it doesn ' t skip bad rows and do not snapshot sstables first . <nl> * / <nl> - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> <nl> / * * <nl> * Flush all memtables for the given column families , or all columnfamilies for the given keyspace <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 1a2364b . . 3f3073d 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 186 , 51 + 186 , 45 @ @ public class NodeProbe implements AutoCloseable <nl> jmxc . close ( ) ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> return ssProxy . forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> return ssProxy . scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ; <nl> } <nl> <nl> - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> return ssProxy . upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ; <nl> } <nl> <nl> public void forceKeyspaceCleanup ( PrintStream out , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> - switch ( forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ) <nl> + if ( forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ! = 0 ) <nl> { <nl> - case ABORTED : <nl> - failed = true ; <nl> - out . println ( " Aborted cleaning up atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> - break ; <nl> + failed = true ; <nl> + out . println ( " Aborted cleaning up atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> } <nl> } <nl> <nl> public void scrub ( PrintStream out , boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> - switch ( scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ) <nl> + if ( scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ! = 0 ) <nl> { <nl> - case ABORTED : <nl> - failed = true ; <nl> - out . println ( " Aborted scrubbing atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> - break ; <nl> + failed = true ; <nl> + out . println ( " Aborted scrubbing atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> } <nl> } <nl> <nl> public void upgradeSSTables ( PrintStream out , String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> - switch ( upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ) <nl> + if ( upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ! = 0 ) <nl> { <nl> - case ABORTED : <nl> - failed = true ; <nl> - out . println ( " Aborted upgrading sstables for atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> - break ; <nl> + failed = true ; <nl> + out . println ( " Aborted upgrading sstables for atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; <nl> } <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 8ad51a2 . . e0d3869 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 10 , 6 + 10 , 7 @ @ <nl> * Change Kernel Page Cache skipping into row preheating ( disabled by default ) <nl> ( CASSANDRA - 4937 ) <nl> * Make upgradeSSTable skip current version sstables by default ( CASSANDRA - 5366 ) <nl> + * Optimize min / max timestamp collection ( CASSANDRA - 5373 ) <nl> Merged from 1 . 1 : <nl> * cli : Quote ks and cf names in schema output when needed ( CASSANDRA - 5052 ) <nl> * Fix bad default for min / max timestamp in SSTableMetadata ( CASSANDRA - 5372 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index 642a404 . . 4ed7f82 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 1939 , 8 + 1939 , 6 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> / / and adds generation of live ancestors <nl> for ( SSTableReader sstable : sstables ) <nl> { <nl> - sstableMetadataCollector . updateMinTimestamp ( sstable . getMinTimestamp ( ) ) ; <nl> - sstableMetadataCollector . updateMaxTimestamp ( sstable . getMaxTimestamp ( ) ) ; <nl> sstableMetadataCollector . addAncestor ( sstable . descriptor . generation ) ; <nl> for ( Integer i : sstable . getAncestors ( ) ) <nl> {

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 93d77c1 . . befdcd7 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 0 
 + * Avoid exposing internal classes over JMX ( CASSANDRA - 7879 ) 
 * Add null check for keys when freezing collection ( CASSANDRA - 7869 ) 
 
 
 diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionManager . java b / src / java / org / apache / cassandra / db / compaction / CompactionManager . java 
 index 65c4882 . . 09c068f 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / CompactionManager . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / CompactionManager . java 
 @ @ - 289 , 7 + 289 , 14 @ @ public class CompactionManager implements CompactionManagerMBean 
 void execute ( SSTableReader input ) throws IOException ; 
 } 
 
 - public enum AllSSTableOpStatus { ABORTED , SUCCESSFUL } 
 + public enum AllSSTableOpStatus { ABORTED ( 1 ) , SUCCESSFUL ( 0 ) ; 
 + public final int statusCode ; 
 + 
 + AllSSTableOpStatus ( int statusCode ) 
 + { 
 + this . statusCode = statusCode ; 
 + } 
 + } 
 
 public AllSSTableOpStatus performScrub ( final ColumnFamilyStore cfs , final boolean skipCorrupted ) throws InterruptedException , ExecutionException 
 { 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 735bf7b . . 5c6dbd6 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2156 , 7 + 2156 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 return Gossiper . instance . getCurrentGenerationNumber ( FBUtilities . getBroadcastAddress ( ) ) ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 if ( keyspaceName . equals ( Keyspace . SYSTEM _ KS ) ) 
 throw new RuntimeException ( " Cleanup of the system keyspace is neither necessary nor wise " ) ; 
 @ @ - 2168 , 10 + 2168 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) 
 status = oneStatus ; 
 } 
 - return status ; 
 + return status . statusCode ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 CompactionManager . AllSSTableOpStatus status = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ; 
 for ( ColumnFamilyStore cfStore : getValidColumnFamilies ( false , false , keyspaceName , columnFamilies ) ) 
 @ @ - 2180 , 10 + 2180 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) 
 status = oneStatus ; 
 } 
 - return status ; 
 + return status . statusCode ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 CompactionManager . AllSSTableOpStatus status = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ; 
 for ( ColumnFamilyStore cfStore : getValidColumnFamilies ( true , true , keyspaceName , columnFamilies ) ) 
 @ @ - 2192 , 7 + 2192 , 7 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 if ( oneStatus ! = CompactionManager . AllSSTableOpStatus . SUCCESSFUL ) 
 status = oneStatus ; 
 } 
 - return status ; 
 + return status . statusCode ; 
 } 
 
 public void forceKeyspaceCompaction ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index b4cc45b . . 8bb13ae 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 238 , 7 + 238 , 7 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 / * * 
 * Trigger a cleanup of keys on a single keyspace 
 * / 
 - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 
 / * * 
 * Scrub ( deserialize + reserialize at the latest version , skipping bad rows if any ) the given keyspace . 
 @ @ - 246 , 13 + 246 , 13 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 * 
 * Scrubbed CFs will be snapshotted first , if disableSnapshot is false 
 * / 
 - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 
 / * * 
 * Rewrite all sstables to the latest version . 
 * Unlike scrub , it doesn ' t skip bad rows and do not snapshot sstables first . 
 * / 
 - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 
 / * * 
 * Flush all memtables for the given column families , or all columnfamilies for the given keyspace 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 1a2364b . . 3f3073d 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 186 , 51 + 186 , 45 @ @ public class NodeProbe implements AutoCloseable 
 jmxc . close ( ) ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int forceKeyspaceCleanup ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 return ssProxy . forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int scrub ( boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 return ssProxy . scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ; 
 } 
 
 - public CompactionManager . AllSSTableOpStatus upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 + public int upgradeSSTables ( String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 return ssProxy . upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ; 
 } 
 
 public void forceKeyspaceCleanup ( PrintStream out , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 - switch ( forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ) 
 + if ( forceKeyspaceCleanup ( keyspaceName , columnFamilies ) ! = 0 ) 
 { 
 - case ABORTED : 
 - failed = true ; 
 - out . println ( " Aborted cleaning up atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 - break ; 
 + failed = true ; 
 + out . println ( " Aborted cleaning up atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 } 
 } 
 
 public void scrub ( PrintStream out , boolean disableSnapshot , boolean skipCorrupted , String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 - switch ( scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ) 
 + if ( scrub ( disableSnapshot , skipCorrupted , keyspaceName , columnFamilies ) ! = 0 ) 
 { 
 - case ABORTED : 
 - failed = true ; 
 - out . println ( " Aborted scrubbing atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 - break ; 
 + failed = true ; 
 + out . println ( " Aborted scrubbing atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 } 
 } 
 
 public void upgradeSSTables ( PrintStream out , String keyspaceName , boolean excludeCurrentVersion , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException 
 { 
 - switch ( upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ) 
 + if ( upgradeSSTables ( keyspaceName , excludeCurrentVersion , columnFamilies ) ! = 0 ) 
 { 
 - case ABORTED : 
 - failed = true ; 
 - out . println ( " Aborted upgrading sstables for atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 - break ; 
 + failed = true ; 
 + out . println ( " Aborted upgrading sstables for atleast one column family in keyspace " + keyspaceName + " , check server logs for more information . " ) ; 
 } 
 } 


NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 8ad51a2 . . e0d3869 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 10 , 6 + 10 , 7 @ @ 
 * Change Kernel Page Cache skipping into row preheating ( disabled by default ) 
 ( CASSANDRA - 4937 ) 
 * Make upgradeSSTable skip current version sstables by default ( CASSANDRA - 5366 ) 
 + * Optimize min / max timestamp collection ( CASSANDRA - 5373 ) 
 Merged from 1 . 1 : 
 * cli : Quote ks and cf names in schema output when needed ( CASSANDRA - 5052 ) 
 * Fix bad default for min / max timestamp in SSTableMetadata ( CASSANDRA - 5372 ) 
 diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index 642a404 . . 4ed7f82 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 1939 , 8 + 1939 , 6 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 / / and adds generation of live ancestors 
 for ( SSTableReader sstable : sstables ) 
 { 
 - sstableMetadataCollector . updateMinTimestamp ( sstable . getMinTimestamp ( ) ) ; 
 - sstableMetadataCollector . updateMaxTimestamp ( sstable . getMaxTimestamp ( ) ) ; 
 sstableMetadataCollector . addAncestor ( sstable . descriptor . generation ) ; 
 for ( Integer i : sstable . getAncestors ( ) ) 
 {
