BLEU SCORE: 1.0

TEST MSG: ninja follow - up to 8619
GENERATED MSG: ninja follow - up to 8619

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java b / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java <nl> index 3e27ff9 . . a243175 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java <nl> @ @ - 549 , 7 + 549 , 7 @ @ public class CQLSSTableWriter implements Closeable <nl> } ; <nl> } <nl> <nl> - protected void addColumn ( Cell cell ) throws IOException <nl> + protected void addColumn ( Column column ) throws IOException <nl> { <nl> throw new UnsupportedOperationException ( ) ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> index 129dfca . . af720c0 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> @ @ - 23 , 6 + 23 , 7 @ @ import java . util . Map ; <nl> import java . util . TreeMap ; <nl> import java . util . concurrent . BlockingQueue ; <nl> import java . util . concurrent . SynchronousQueue ; <nl> + import java . util . concurrent . TimeUnit ; <nl> <nl> import com . google . common . base . Throwables ; <nl> <nl> @ @ - 165 , 17 + 166 , 21 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> if ( buffer . isEmpty ( ) ) <nl> return ; <nl> <nl> - checkForWriterException ( ) ; <nl> - <nl> - columnFamily = null ; <nl> - try <nl> + while ( true ) <nl> { <nl> - writeQueue . put ( buffer ) ; <nl> - } <nl> - catch ( InterruptedException e ) <nl> - { <nl> - throw new RuntimeException ( e ) ; <nl> + checkForWriterException ( ) ; <nl> <nl> + columnFamily = null ; <nl> + try <nl> + { <nl> + if ( writeQueue . offer ( buffer , 1L , TimeUnit . SECONDS ) ) <nl> + break ; <nl> + } <nl> + catch ( InterruptedException e ) <nl> + { <nl> + throw new RuntimeException ( e ) ; <nl> + <nl> + } <nl> } <nl> buffer = new Buffer ( ) ; <nl> currentSize = 0 ; <nl> @ @ - 213 , 8 + 218 , 15 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> return ; <nl> <nl> writer = getWriter ( ) ; <nl> + boolean first = true ; <nl> for ( Map . Entry < DecoratedKey , ColumnFamily > entry : b . entrySet ( ) ) <nl> - writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; <nl> + { <nl> + if ( entry . getValue ( ) . getColumnCount ( ) > 0 ) <nl> + writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; <nl> + else if ( ! first ) <nl> + throw new AssertionError ( " Empty partition " ) ; <nl> + first = false ; <nl> + } <nl> writer . close ( ) ; <nl> } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java b / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java 
 index 3e27ff9 . . a243175 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / CQLSSTableWriter . java 
 @ @ - 549 , 7 + 549 , 7 @ @ public class CQLSSTableWriter implements Closeable 
 } ; 
 } 
 
 - protected void addColumn ( Cell cell ) throws IOException 
 + protected void addColumn ( Column column ) throws IOException 
 { 
 throw new UnsupportedOperationException ( ) ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 index 129dfca . . af720c0 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 @ @ - 23 , 6 + 23 , 7 @ @ import java . util . Map ; 
 import java . util . TreeMap ; 
 import java . util . concurrent . BlockingQueue ; 
 import java . util . concurrent . SynchronousQueue ; 
 + import java . util . concurrent . TimeUnit ; 
 
 import com . google . common . base . Throwables ; 
 
 @ @ - 165 , 17 + 166 , 21 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 if ( buffer . isEmpty ( ) ) 
 return ; 
 
 - checkForWriterException ( ) ; 
 - 
 - columnFamily = null ; 
 - try 
 + while ( true ) 
 { 
 - writeQueue . put ( buffer ) ; 
 - } 
 - catch ( InterruptedException e ) 
 - { 
 - throw new RuntimeException ( e ) ; 
 + checkForWriterException ( ) ; 
 
 + columnFamily = null ; 
 + try 
 + { 
 + if ( writeQueue . offer ( buffer , 1L , TimeUnit . SECONDS ) ) 
 + break ; 
 + } 
 + catch ( InterruptedException e ) 
 + { 
 + throw new RuntimeException ( e ) ; 
 + 
 + } 
 } 
 buffer = new Buffer ( ) ; 
 currentSize = 0 ; 
 @ @ - 213 , 8 + 218 , 15 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 return ; 
 
 writer = getWriter ( ) ; 
 + boolean first = true ; 
 for ( Map . Entry < DecoratedKey , ColumnFamily > entry : b . entrySet ( ) ) 
 - writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; 
 + { 
 + if ( entry . getValue ( ) . getColumnCount ( ) > 0 ) 
 + writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; 
 + else if ( ! first ) 
 + throw new AssertionError ( " Empty partition " ) ; 
 + first = false ; 
 + } 
 writer . close ( ) ; 
 } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
