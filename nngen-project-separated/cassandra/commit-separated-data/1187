BLEU SCORE: 0.049900497019368314

TEST MSG: Add nodetool command to refresh system . size _ estimates
GENERATED MSG: Add ' nodetool statusgossip '

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d0c0af9 . . 2eeda94 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 12 <nl> + * Add a nodetool command to refresh size _ estimates ( CASSANDRA - 9579 ) <nl> * Shutdown compaction in drain to prevent leak ( CASSANDRA - 10079 ) <nl> * Invalidate cache after stream receive task is completed ( CASSANDRA - 10341 ) <nl> * Reject counter writes in CQLSSTableWriter ( CASSANDRA - 10258 ) <nl> @ @ - 33 , 6 + 34 , 7 @ @ <nl> * Mark nodes as dead even if they ' ve already left ( CASSANDRA - 10205 ) <nl> * Update internal python driver used by cqlsh ( CASSANDRA - 10161 , CASSANDRA - 10507 ) <nl> <nl> + <nl> 2 . 1 . 10 <nl> * Bulk Loader API could not tolerate even node failure ( CASSANDRA - 10347 ) <nl> * Avoid misleading pushed notifications when multiple nodes <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 93b1b97 . . 665ce3a 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 83 , 6 + 83 , 7 @ @ import org . apache . cassandra . db . MutationVerbHandler ; <nl> import org . apache . cassandra . db . ReadRepairVerbHandler ; <nl> import org . apache . cassandra . db . ReadVerbHandler ; <nl> import org . apache . cassandra . db . SchemaCheckVerbHandler ; <nl> + import org . apache . cassandra . db . SizeEstimatesRecorder ; <nl> import org . apache . cassandra . db . SnapshotDetailsTabularData ; <nl> import org . apache . cassandra . db . SystemKeyspace ; <nl> import org . apache . cassandra . db . TruncateVerbHandler ; <nl> @ @ - 2604 , 6 + 2605 , 11 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> return total ; <nl> } <nl> <nl> + public void refreshSizeEstimates ( ) throws ExecutionException <nl> + { <nl> + FBUtilities . waitOnFuture ( ScheduledExecutors . optionalTasks . submit ( SizeEstimatesRecorder . instance ) ) ; <nl> + } <nl> + <nl> / * * <nl> * @ param allowIndexes Allow index CF names to be passed in <nl> * @ param autoAddIndexes Automatically add secondary indexes if a CF has them <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index b8582a3 . . 1351fea 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 248 , 6 + 248 , 11 @ @ public interface StorageServiceMBean extends NotificationEmitter <nl> public long trueSnapshotsSize ( ) ; <nl> <nl> / * * <nl> + * Forces refresh of values stored in system . size _ estimates of all column families . <nl> + * / <nl> + public void refreshSizeEstimates ( ) throws ExecutionException ; <nl> + <nl> + / * * <nl> * Forces major compaction of a single keyspace <nl> * / <nl> public void forceKeyspaceCompaction ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 6f2b6fb . . 49c493d 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 901 , 6 + 901 , 18 @ @ public class NodeProbe implements AutoCloseable <nl> } <nl> } <nl> <nl> + public void refreshSizeEstimates ( ) <nl> + { <nl> + try <nl> + { <nl> + ssProxy . refreshSizeEstimates ( ) ; <nl> + } <nl> + catch ( ExecutionException e ) <nl> + { <nl> + throw new RuntimeException ( " Error while refreshing system . size _ estimates " , e ) ; <nl> + } <nl> + } <nl> + <nl> public void stopNativeTransport ( ) <nl> { <nl> ssProxy . stopNativeTransport ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeTool . java b / src / java / org / apache / cassandra / tools / NodeTool . java <nl> index 277f42c . . 1d4a420 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeTool . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeTool . java <nl> @ @ - 151 , 6 + 151 , 7 @ @ public class NodeTool <nl> ProxyHistograms . class , <nl> Rebuild . class , <nl> Refresh . class , <nl> + RefreshSizeEstimates . class , <nl> RemoveToken . class , <nl> RemoveNode . class , <nl> Repair . class , <nl> @ @ - 1807 , 6 + 1808 , 16 @ @ public class NodeTool <nl> } <nl> } <nl> <nl> + @ Command ( name = " refreshsizeestimates " , description = " Refresh system . size _ estimates " ) <nl> + public static class RefreshSizeEstimates extends NodeToolCmd <nl> + { <nl> + @ Override <nl> + public void execute ( NodeProbe probe ) <nl> + { <nl> + probe . refreshSizeEstimates ( ) ; <nl> + } <nl> + } <nl> + <nl> @ Deprecated <nl> @ Command ( name = " removetoken " , description = " DEPRECATED ( see removenode ) " , hidden = true ) <nl> public static class RemoveToken extends NodeToolCmd
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d0c0af9 . . 2eeda94 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 12 
 + * Add a nodetool command to refresh size _ estimates ( CASSANDRA - 9579 ) 
 * Shutdown compaction in drain to prevent leak ( CASSANDRA - 10079 ) 
 * Invalidate cache after stream receive task is completed ( CASSANDRA - 10341 ) 
 * Reject counter writes in CQLSSTableWriter ( CASSANDRA - 10258 ) 
 @ @ - 33 , 6 + 34 , 7 @ @ 
 * Mark nodes as dead even if they ' ve already left ( CASSANDRA - 10205 ) 
 * Update internal python driver used by cqlsh ( CASSANDRA - 10161 , CASSANDRA - 10507 ) 
 
 + 
 2 . 1 . 10 
 * Bulk Loader API could not tolerate even node failure ( CASSANDRA - 10347 ) 
 * Avoid misleading pushed notifications when multiple nodes 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 93b1b97 . . 665ce3a 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 83 , 6 + 83 , 7 @ @ import org . apache . cassandra . db . MutationVerbHandler ; 
 import org . apache . cassandra . db . ReadRepairVerbHandler ; 
 import org . apache . cassandra . db . ReadVerbHandler ; 
 import org . apache . cassandra . db . SchemaCheckVerbHandler ; 
 + import org . apache . cassandra . db . SizeEstimatesRecorder ; 
 import org . apache . cassandra . db . SnapshotDetailsTabularData ; 
 import org . apache . cassandra . db . SystemKeyspace ; 
 import org . apache . cassandra . db . TruncateVerbHandler ; 
 @ @ - 2604 , 6 + 2605 , 11 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 return total ; 
 } 
 
 + public void refreshSizeEstimates ( ) throws ExecutionException 
 + { 
 + FBUtilities . waitOnFuture ( ScheduledExecutors . optionalTasks . submit ( SizeEstimatesRecorder . instance ) ) ; 
 + } 
 + 
 / * * 
 * @ param allowIndexes Allow index CF names to be passed in 
 * @ param autoAddIndexes Automatically add secondary indexes if a CF has them 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index b8582a3 . . 1351fea 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 248 , 6 + 248 , 11 @ @ public interface StorageServiceMBean extends NotificationEmitter 
 public long trueSnapshotsSize ( ) ; 
 
 / * * 
 + * Forces refresh of values stored in system . size _ estimates of all column families . 
 + * / 
 + public void refreshSizeEstimates ( ) throws ExecutionException ; 
 + 
 + / * * 
 * Forces major compaction of a single keyspace 
 * / 
 public void forceKeyspaceCompaction ( String keyspaceName , String . . . columnFamilies ) throws IOException , ExecutionException , InterruptedException ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 6f2b6fb . . 49c493d 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 901 , 6 + 901 , 18 @ @ public class NodeProbe implements AutoCloseable 
 } 
 } 
 
 + public void refreshSizeEstimates ( ) 
 + { 
 + try 
 + { 
 + ssProxy . refreshSizeEstimates ( ) ; 
 + } 
 + catch ( ExecutionException e ) 
 + { 
 + throw new RuntimeException ( " Error while refreshing system . size _ estimates " , e ) ; 
 + } 
 + } 
 + 
 public void stopNativeTransport ( ) 
 { 
 ssProxy . stopNativeTransport ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeTool . java b / src / java / org / apache / cassandra / tools / NodeTool . java 
 index 277f42c . . 1d4a420 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeTool . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeTool . java 
 @ @ - 151 , 6 + 151 , 7 @ @ public class NodeTool 
 ProxyHistograms . class , 
 Rebuild . class , 
 Refresh . class , 
 + RefreshSizeEstimates . class , 
 RemoveToken . class , 
 RemoveNode . class , 
 Repair . class , 
 @ @ - 1807 , 6 + 1808 , 16 @ @ public class NodeTool 
 } 
 } 
 
 + @ Command ( name = " refreshsizeestimates " , description = " Refresh system . size _ estimates " ) 
 + public static class RefreshSizeEstimates extends NodeToolCmd 
 + { 
 + @ Override 
 + public void execute ( NodeProbe probe ) 
 + { 
 + probe . refreshSizeEstimates ( ) ; 
 + } 
 + } 
 + 
 @ Deprecated 
 @ Command ( name = " removetoken " , description = " DEPRECATED ( see removenode ) " , hidden = true ) 
 public static class RemoveToken extends NodeToolCmd

NEAREST DIFF:
ELIMINATEDSENTENCE
