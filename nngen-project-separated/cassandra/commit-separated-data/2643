BLEU SCORE: 0.024893534183931972

TEST MSG: presize collection
GENERATED MSG: avoid NPE on no - op major compaction

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java b / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java <nl> index 63d983c . . 1fa5ff8 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java <nl> @ @ - 242 , 7 + 242 , 7 @ @ public class SizeTieredCompactionStrategy extends AbstractCompactionStrategy <nl> <nl> private static Map < SSTableReader , Double > getHotnessMap ( Collection < SSTableReader > sstables ) <nl> { <nl> - Map < SSTableReader , Double > hotness = new HashMap < > ( ) ; <nl> + Map < SSTableReader , Double > hotness = new HashMap < > ( sstables . size ( ) ) ; <nl> for ( SSTableReader sstable : sstables ) <nl> hotness . put ( sstable , hotness ( sstable ) ) ; <nl> return hotness ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> index 4a9eefb . . 3c5ba7f 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> @ @ - 50 , 11 + 50 , 11 @ @ import org . apache . cassandra . streaming . StreamingRepairTask ; <nl> import org . apache . cassandra . utils . * ; <nl> <nl> / * * <nl> - * AntiEntropyService encapsulates " validating " ( hashing ) individual column families , <nl> + * ActiveRepairService encapsulates " validating " ( hashing ) individual column families , <nl> * exchanging MerkleTrees with remote nodes via a TreeRequest / Response conversation , <nl> * and then triggering repairs for disagreeing ranges . <nl> * <nl> - * Every Tree conversation has an ' initiator ' , where valid trees are sent after generation <nl> + * The node where repair was invoked acts as the ' initiator , ' where valid trees are sent after generation <nl> * and where the local and remote tree will rendezvous in rendezvous ( cf , endpoint , tree ) . <nl> * Once the trees rendezvous , a Differencer is executed and the service can trigger repairs <nl> * for disagreeing ranges . <nl> @ @ - 62 , 11 + 62 , 11 @ @ import org . apache . cassandra . utils . * ; <nl> * Tree comparison and repair triggering occur in the single threaded Stage . ANTIENTROPY . <nl> * <nl> * The steps taken to enact a repair are as follows : <nl> - * 1 . A major compaction is triggered via nodeprobe : <nl> - * * Nodeprobe sends TreeRequest messages to all neighbors of the target node : when a node <nl> - * receives a TreeRequest , it will perform a readonly compaction to immediately validate <nl> - * the column family . <nl> - * 2 . The compaction process validates the column family by : <nl> + * 1 . A repair is requested via nodeprobe : <nl> + * * The initiator sends TreeRequest messages to all neighbors of the target node : when a node <nl> + * receives a TreeRequest , it will perform a validation ( read - only ) compaction to immediately validate <nl> + * the column family . This is performed on the CompactionManager ExecutorService . <nl> + * 2 . The validation process builds the merkle tree by : <nl> * * Calling Validator . prepare ( ) , which samples the column family to determine key distribution , <nl> * * Calling Validator . add ( ) in order for every row in the column family , <nl> * * Calling Validator . complete ( ) to indicate that all rows have been added .

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java b / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java 
 index 63d983c . . 1fa5ff8 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / SizeTieredCompactionStrategy . java 
 @ @ - 242 , 7 + 242 , 7 @ @ public class SizeTieredCompactionStrategy extends AbstractCompactionStrategy 
 
 private static Map < SSTableReader , Double > getHotnessMap ( Collection < SSTableReader > sstables ) 
 { 
 - Map < SSTableReader , Double > hotness = new HashMap < > ( ) ; 
 + Map < SSTableReader , Double > hotness = new HashMap < > ( sstables . size ( ) ) ; 
 for ( SSTableReader sstable : sstables ) 
 hotness . put ( sstable , hotness ( sstable ) ) ; 
 return hotness ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 index 4a9eefb . . 3c5ba7f 100644 
 - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 @ @ - 50 , 11 + 50 , 11 @ @ import org . apache . cassandra . streaming . StreamingRepairTask ; 
 import org . apache . cassandra . utils . * ; 
 
 / * * 
 - * AntiEntropyService encapsulates " validating " ( hashing ) individual column families , 
 + * ActiveRepairService encapsulates " validating " ( hashing ) individual column families , 
 * exchanging MerkleTrees with remote nodes via a TreeRequest / Response conversation , 
 * and then triggering repairs for disagreeing ranges . 
 * 
 - * Every Tree conversation has an ' initiator ' , where valid trees are sent after generation 
 + * The node where repair was invoked acts as the ' initiator , ' where valid trees are sent after generation 
 * and where the local and remote tree will rendezvous in rendezvous ( cf , endpoint , tree ) . 
 * Once the trees rendezvous , a Differencer is executed and the service can trigger repairs 
 * for disagreeing ranges . 
 @ @ - 62 , 11 + 62 , 11 @ @ import org . apache . cassandra . utils . * ; 
 * Tree comparison and repair triggering occur in the single threaded Stage . ANTIENTROPY . 
 * 
 * The steps taken to enact a repair are as follows : 
 - * 1 . A major compaction is triggered via nodeprobe : 
 - * * Nodeprobe sends TreeRequest messages to all neighbors of the target node : when a node 
 - * receives a TreeRequest , it will perform a readonly compaction to immediately validate 
 - * the column family . 
 - * 2 . The compaction process validates the column family by : 
 + * 1 . A repair is requested via nodeprobe : 
 + * * The initiator sends TreeRequest messages to all neighbors of the target node : when a node 
 + * receives a TreeRequest , it will perform a validation ( read - only ) compaction to immediately validate 
 + * the column family . This is performed on the CompactionManager ExecutorService . 
 + * 2 . The validation process builds the merkle tree by : 
 * * Calling Validator . prepare ( ) , which samples the column family to determine key distribution , 
 * * Calling Validator . add ( ) in order for every row in the column family , 
 * * Calling Validator . complete ( ) to indicate that all rows have been added .
