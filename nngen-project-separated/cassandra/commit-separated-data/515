BLEU SCORE: 0.04069582841180383

TEST MSG: Fix paging for DISTINCT queries on partition keys and static columns
GENERATED MSG: Don ' t query more results than necessary when paging range queries

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 23fd12a . . 414d6ed 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 17 <nl> + * Fix paging for DISTINCT queries on partition keys and static columns ( CASSANDRA - 13017 ) <nl> * Fix race causing infinite loop if Thrift server is stopped before it starts listening ( CASSANDRA - 12856 ) <nl> * cqlsh copy - from : sort user type fields in csv ( CASSANDRA - 12959 ) <nl> * Fix missed signal when commit log segments are recycled ( CASSANDRA - 13037 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> index caa146a . . 3ac777e 100644 <nl> - - - a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> + + + b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> @ @ - 74 , 7 + 74 , 8 @ @ public class RangeSliceQueryPager extends AbstractQueryPager <nl> { <nl> SliceQueryFilter sf = ( SliceQueryFilter ) columnFilter ; <nl> AbstractBounds < RowPosition > keyRange = lastReturnedKey = = null ? command . keyRange : makeIncludingKeyBounds ( lastReturnedKey ) ; <nl> - Composite start = lastReturnedName = = null ? sf . start ( ) : lastReturnedName ; <nl> + / / For DISTINCT queries we can and must ignore the lastReturnedName ( see CASSANDRA - 13017 ) <nl> + Composite start = lastReturnedName = = null | | isDistinct ( ) ? sf . start ( ) : lastReturnedName ; <nl> PagedRangeCommand pageCmd = new PagedRangeCommand ( command . keyspace , <nl> command . columnFamily , <nl> command . timestamp , <nl> diff - - git a / test / unit / org / apache / cassandra / service / QueryPagerTest . java b / test / unit / org / apache / cassandra / service / QueryPagerTest . java <nl> index c78412f . . 1939c4a 100644 <nl> - - - a / test / unit / org / apache / cassandra / service / QueryPagerTest . java <nl> + + + b / test / unit / org / apache / cassandra / service / QueryPagerTest . java <nl> @ @ - 146 , 7 + 146 , 7 @ @ public class QueryPagerTest extends SchemaLoader <nl> private static RangeSliceCommand rangeSliceQuery ( AbstractBounds < RowPosition > range , int count , String start , String end ) <nl> { <nl> SliceQueryFilter filter = new SliceQueryFilter ( CellNames . simpleDense ( bytes ( start ) ) , CellNames . simpleDense ( bytes ( end ) ) , false , Integer . MAX _ VALUE ) ; <nl> - return new RangeSliceCommand ( KS , CF , System . currentTimeMillis ( ) , filter , range , count ) ; <nl> + return new RangeSliceCommand ( KS , CF , System . currentTimeMillis ( ) , filter , range , null , count , true , false ) ; <nl> } <nl> <nl> private static void assertRow ( Row r , String key , String . . . names )
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 23fd12a . . 414d6ed 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 17 
 + * Fix paging for DISTINCT queries on partition keys and static columns ( CASSANDRA - 13017 ) 
 * Fix race causing infinite loop if Thrift server is stopped before it starts listening ( CASSANDRA - 12856 ) 
 * cqlsh copy - from : sort user type fields in csv ( CASSANDRA - 12959 ) 
 * Fix missed signal when commit log segments are recycled ( CASSANDRA - 13037 ) 
 diff - - git a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 index caa146a . . 3ac777e 100644 
 - - - a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 + + + b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 @ @ - 74 , 7 + 74 , 8 @ @ public class RangeSliceQueryPager extends AbstractQueryPager 
 { 
 SliceQueryFilter sf = ( SliceQueryFilter ) columnFilter ; 
 AbstractBounds < RowPosition > keyRange = lastReturnedKey = = null ? command . keyRange : makeIncludingKeyBounds ( lastReturnedKey ) ; 
 - Composite start = lastReturnedName = = null ? sf . start ( ) : lastReturnedName ; 
 + / / For DISTINCT queries we can and must ignore the lastReturnedName ( see CASSANDRA - 13017 ) 
 + Composite start = lastReturnedName = = null | | isDistinct ( ) ? sf . start ( ) : lastReturnedName ; 
 PagedRangeCommand pageCmd = new PagedRangeCommand ( command . keyspace , 
 command . columnFamily , 
 command . timestamp , 
 diff - - git a / test / unit / org / apache / cassandra / service / QueryPagerTest . java b / test / unit / org / apache / cassandra / service / QueryPagerTest . java 
 index c78412f . . 1939c4a 100644 
 - - - a / test / unit / org / apache / cassandra / service / QueryPagerTest . java 
 + + + b / test / unit / org / apache / cassandra / service / QueryPagerTest . java 
 @ @ - 146 , 7 + 146 , 7 @ @ public class QueryPagerTest extends SchemaLoader 
 private static RangeSliceCommand rangeSliceQuery ( AbstractBounds < RowPosition > range , int count , String start , String end ) 
 { 
 SliceQueryFilter filter = new SliceQueryFilter ( CellNames . simpleDense ( bytes ( start ) ) , CellNames . simpleDense ( bytes ( end ) ) , false , Integer . MAX _ VALUE ) ; 
 - return new RangeSliceCommand ( KS , CF , System . currentTimeMillis ( ) , filter , range , count ) ; 
 + return new RangeSliceCommand ( KS , CF , System . currentTimeMillis ( ) , filter , range , null , count , true , false ) ; 
 } 
 
 private static void assertRow ( Row r , String key , String . . . names )

NEAREST DIFF:
ELIMINATEDSENTENCE
