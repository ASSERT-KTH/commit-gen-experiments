BLEU SCORE: 0.035802380724744266

TEST MSG: Fix isClientMode check in Keyspace
GENERATED MSG: clear endpoint cache after updating keyspace metadata

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 4754867 . . 9e9b772 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 5 , 6 + 5 , 7 @ @ <nl> ( CASSANDRA - 8619 ) <nl> * Round up time deltas lower than 1ms in BulkLoader ( CASSANDRA - 8645 ) <nl> * Add batch remove iterator to ABSC ( CASSANDRA - 8414 , 8666 ) <nl> + * Fix isClientMode check in Keyspace ( CASSANDRA - 8687 ) <nl> <nl> <nl> 2 . 0 . 12 : <nl> diff - - git a / src / java / org / apache / cassandra / db / Keyspace . java b / src / java / org / apache / cassandra / db / Keyspace . java <nl> index 28045f4 . . 38b7c2b 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Keyspace . java <nl> + + + b / src / java / org / apache / cassandra / db / Keyspace . java <nl> @ @ - 30 , 10 + 30 , 7 @ @ import com . google . common . collect . Iterables ; <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ; <nl> <nl> - import org . apache . cassandra . config . CFMetaData ; <nl> - import org . apache . cassandra . config . DatabaseDescriptor ; <nl> - import org . apache . cassandra . config . KSMetaData ; <nl> - import org . apache . cassandra . config . Schema ; <nl> + import org . apache . cassandra . config . * ; <nl> import org . apache . cassandra . db . commitlog . CommitLog ; <nl> import org . apache . cassandra . db . filter . QueryFilter ; <nl> import org . apache . cassandra . db . index . SecondaryIndex ; <nl> @ @ - 69 , 7 + 66 , 7 @ @ public class Keyspace <nl> / / proper directories here as well as in CassandraDaemon . <nl> static <nl> { <nl> - if ( ! StorageService . instance . isClientMode ( ) ) <nl> + if ( ! ( Config . isClientMode ( ) | | StorageService . instance . isClientMode ( ) ) ) <nl> DatabaseDescriptor . createAllDirectories ( ) ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7a3998f . . 561b794 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 29 , 6 + 29 , 7 @ @ dev <nl> * upgrade to ConcurrentLinkedHashMap 1 . 1 ( CASSANDRA - 975 ) <nl> * fix index scan routing ( CASSANDRA - 1722 ) <nl> * fix tombstoning of supercolumns in range queries ( CASSANDRA - 1734 ) <nl> + * clear endpoint cache after updating keyspace metadata ( CASSANDRA - 1741 ) <nl> <nl> <nl> 0 . 7 . 0 - beta3 <nl> diff - - git a / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java b / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java <nl> index 6b41088 . . ed5c332 100644 <nl> - - - a / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java <nl> + + + b / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java <nl> @ @ - 4 , 6 + 4 , 7 @ @ import org . apache . cassandra . config . CFMetaData ; <nl> import org . apache . cassandra . config . ConfigurationException ; <nl> import org . apache . cassandra . config . DatabaseDescriptor ; <nl> import org . apache . cassandra . config . KSMetaData ; <nl> + import org . apache . cassandra . db . Table ; <nl> import org . apache . cassandra . utils . FBUtilities ; <nl> import org . apache . cassandra . utils . UUIDGen ; <nl> <nl> @ @ - 58 , 6 + 59 , 7 @ @ public class UpdateKeyspace extends Migration <nl> { <nl> DatabaseDescriptor . clearTableDefinition ( oldKsm , newVersion ) ; <nl> DatabaseDescriptor . setTableDefinition ( newKsm , newVersion ) ; <nl> + Table . open ( newKsm . name ) . replicationStrategy . clearEndpointCache ( ) ; <nl> logger . info ( " Keyspace updated . Please perform any manual operations . " ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 4754867 . . 9e9b772 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 5 , 6 + 5 , 7 @ @ 
 ( CASSANDRA - 8619 ) 
 * Round up time deltas lower than 1ms in BulkLoader ( CASSANDRA - 8645 ) 
 * Add batch remove iterator to ABSC ( CASSANDRA - 8414 , 8666 ) 
 + * Fix isClientMode check in Keyspace ( CASSANDRA - 8687 ) 
 
 
 2 . 0 . 12 : 
 diff - - git a / src / java / org / apache / cassandra / db / Keyspace . java b / src / java / org / apache / cassandra / db / Keyspace . java 
 index 28045f4 . . 38b7c2b 100644 
 - - - a / src / java / org / apache / cassandra / db / Keyspace . java 
 + + + b / src / java / org / apache / cassandra / db / Keyspace . java 
 @ @ - 30 , 10 + 30 , 7 @ @ import com . google . common . collect . Iterables ; 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ; 
 
 - import org . apache . cassandra . config . CFMetaData ; 
 - import org . apache . cassandra . config . DatabaseDescriptor ; 
 - import org . apache . cassandra . config . KSMetaData ; 
 - import org . apache . cassandra . config . Schema ; 
 + import org . apache . cassandra . config . * ; 
 import org . apache . cassandra . db . commitlog . CommitLog ; 
 import org . apache . cassandra . db . filter . QueryFilter ; 
 import org . apache . cassandra . db . index . SecondaryIndex ; 
 @ @ - 69 , 7 + 66 , 7 @ @ public class Keyspace 
 / / proper directories here as well as in CassandraDaemon . 
 static 
 { 
 - if ( ! StorageService . instance . isClientMode ( ) ) 
 + if ( ! ( Config . isClientMode ( ) | | StorageService . instance . isClientMode ( ) ) ) 
 DatabaseDescriptor . createAllDirectories ( ) ; 
 } 


NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7a3998f . . 561b794 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 29 , 6 + 29 , 7 @ @ dev 
 * upgrade to ConcurrentLinkedHashMap 1 . 1 ( CASSANDRA - 975 ) 
 * fix index scan routing ( CASSANDRA - 1722 ) 
 * fix tombstoning of supercolumns in range queries ( CASSANDRA - 1734 ) 
 + * clear endpoint cache after updating keyspace metadata ( CASSANDRA - 1741 ) 
 
 
 0 . 7 . 0 - beta3 
 diff - - git a / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java b / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java 
 index 6b41088 . . ed5c332 100644 
 - - - a / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java 
 + + + b / src / java / org / apache / cassandra / db / migration / UpdateKeyspace . java 
 @ @ - 4 , 6 + 4 , 7 @ @ import org . apache . cassandra . config . CFMetaData ; 
 import org . apache . cassandra . config . ConfigurationException ; 
 import org . apache . cassandra . config . DatabaseDescriptor ; 
 import org . apache . cassandra . config . KSMetaData ; 
 + import org . apache . cassandra . db . Table ; 
 import org . apache . cassandra . utils . FBUtilities ; 
 import org . apache . cassandra . utils . UUIDGen ; 
 
 @ @ - 58 , 6 + 59 , 7 @ @ public class UpdateKeyspace extends Migration 
 { 
 DatabaseDescriptor . clearTableDefinition ( oldKsm , newVersion ) ; 
 DatabaseDescriptor . setTableDefinition ( newKsm , newVersion ) ; 
 + Table . open ( newKsm . name ) . replicationStrategy . clearEndpointCache ( ) ; 
 logger . info ( " Keyspace updated . Please perform any manual operations . " ) ; 
 } 

