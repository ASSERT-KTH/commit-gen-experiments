BLEU SCORE: 0.0018858789477099952

TEST MSG: create the cache name format only once
GENERATED MSG: ignore subdirectories ( snapshots ) within a keyspace directory when scanning for files . Patch by Paul Bohm , reviewed by Gary Dusbabek . CASSANDRA - 983

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cache / AutoSavingCache . java b / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> index 9a79e38 . . 4ac2328 100644 <nl> - - - a / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> + + + b / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> @ @ - 306 , 13 + 306 , 14 @ @ public class AutoSavingCache < K extends CacheKey , V > extends InstrumentingCache < K <nl> File [ ] files = savedCachesDir . listFiles ( ) ; <nl> if ( files ! = null ) <nl> { <nl> + String cacheNameFormat = String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ; <nl> for ( File file : files ) <nl> { <nl> if ( ! file . isFile ( ) ) <nl> continue ; / / someone ' s been messing with our directory . naughty ! <nl> <nl> - if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) <nl> - | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) <nl> + if ( file . getName ( ) . endsWith ( cacheNameFormat ) <nl> + | | file . getName ( ) . endsWith ( cacheType . toString ( ) ) ) <nl> { <nl> if ( ! file . delete ( ) ) <nl> logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index 9f66c2e . . 1779990 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 245 , 6 + 245 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> <nl> for ( File file : files ) <nl> { <nl> + if ( file . isDirectory ( ) ) <nl> + continue ; <nl> String filename = file . getAbsolutePath ( ) ; <nl> String cfName = getColumnFamilyFromFileName ( filename ) ; <nl> <nl> @ @ - 283 , 6 + 285 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> File [ ] files = new File ( directory ) . listFiles ( ) ; <nl> for ( File file : files ) <nl> { <nl> + if ( file . isDirectory ( ) ) <nl> + continue ; <nl> String cfName = getColumnFamilyFromFileName ( file . getAbsolutePath ( ) ) ; <nl> if ( cfName . equals ( columnFamily _ ) ) <nl> fileSet . add ( file ) ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / cache / AutoSavingCache . java b / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 index 9a79e38 . . 4ac2328 100644 
 - - - a / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 + + + b / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 @ @ - 306 , 13 + 306 , 14 @ @ public class AutoSavingCache < K extends CacheKey , V > extends InstrumentingCache < K 
 File [ ] files = savedCachesDir . listFiles ( ) ; 
 if ( files ! = null ) 
 { 
 + String cacheNameFormat = String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ; 
 for ( File file : files ) 
 { 
 if ( ! file . isFile ( ) ) 
 continue ; / / someone ' s been messing with our directory . naughty ! 
 
 - if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) 
 - | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) 
 + if ( file . getName ( ) . endsWith ( cacheNameFormat ) 
 + | | file . getName ( ) . endsWith ( cacheType . toString ( ) ) ) 
 { 
 if ( ! file . delete ( ) ) 
 logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index 9f66c2e . . 1779990 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 245 , 6 + 245 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 
 for ( File file : files ) 
 { 
 + if ( file . isDirectory ( ) ) 
 + continue ; 
 String filename = file . getAbsolutePath ( ) ; 
 String cfName = getColumnFamilyFromFileName ( filename ) ; 
 
 @ @ - 283 , 6 + 285 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 File [ ] files = new File ( directory ) . listFiles ( ) ; 
 for ( File file : files ) 
 { 
 + if ( file . isDirectory ( ) ) 
 + continue ; 
 String cfName = getColumnFamilyFromFileName ( file . getAbsolutePath ( ) ) ; 
 if ( cfName . equals ( columnFamily _ ) ) 
 fileSet . add ( file ) ;
