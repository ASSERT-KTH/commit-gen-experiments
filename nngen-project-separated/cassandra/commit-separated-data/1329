BLEU SCORE: 1.0

TEST MSG: refuse to decomission if not in state NORMAL
GENERATED MSG: refuse to decomission if not in state NORMAL

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 20e1297 . . 7ac7b23 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 10 , 6 + 10 , 8 @ @ Merged from 2 . 1 : <nl> * Change streaming _ socket _ timeout _ in _ ms default to 1 hour ( CASSANDRA - 8611 ) <nl> * ( cqlsh ) update list of CQL keywords ( CASSANDRA - 9232 ) <nl> * Add nodetool gettraceprobability command ( CASSANDRA - 10234 ) <nl> + Merged from 2 . 0 : <nl> + * Disallow decommission when node is in drained state ( CASSANDRA - 8741 ) <nl> <nl> <nl> 2 . 2 . 1 <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 883c96b . . ef795f9 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 3294 , 6 + 3294 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> throw new UnsupportedOperationException ( " local node is not a member of the token ring yet " ) ; <nl> if ( tokenMetadata . cloneAfterAllLeft ( ) . sortedTokens ( ) . size ( ) < 2 ) <nl> throw new UnsupportedOperationException ( " no other normal nodes in the ring ; decommission would be pointless " ) ; <nl> + if ( operationMode ! = Mode . NORMAL ) <nl> + throw new UnsupportedOperationException ( " Node in " + operationMode + " state ; wait for status to become normal or restart " ) ; <nl> <nl> PendingRangeCalculatorService . instance . blockUntilFinished ( ) ; <nl> for ( String keyspaceName : Schema . instance . getNonSystemKeyspaces ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / tools / nodetool / Decommission . java b / src / java / org / apache / cassandra / tools / nodetool / Decommission . java <nl> index a3feb67 . . 34890e0 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / nodetool / Decommission . java <nl> + + + b / src / java / org / apache / cassandra / tools / nodetool / Decommission . java <nl> @ @ - 34 , 6 + 34 , 9 @ @ public class Decommission extends NodeToolCmd <nl> } catch ( InterruptedException e ) <nl> { <nl> throw new RuntimeException ( " Error decommissioning node " , e ) ; <nl> + } catch ( UnsupportedOperationException e ) <nl> + { <nl> + throw new IllegalStateException ( " Unsupported operation : " + e . getMessage ( ) , e ) ; <nl> } <nl> } <nl> } <nl> \ No newline at end of file
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 20e1297 . . 7ac7b23 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 10 , 6 + 10 , 8 @ @ Merged from 2 . 1 : 
 * Change streaming _ socket _ timeout _ in _ ms default to 1 hour ( CASSANDRA - 8611 ) 
 * ( cqlsh ) update list of CQL keywords ( CASSANDRA - 9232 ) 
 * Add nodetool gettraceprobability command ( CASSANDRA - 10234 ) 
 + Merged from 2 . 0 : 
 + * Disallow decommission when node is in drained state ( CASSANDRA - 8741 ) 
 
 
 2 . 2 . 1 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 883c96b . . ef795f9 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 3294 , 6 + 3294 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 throw new UnsupportedOperationException ( " local node is not a member of the token ring yet " ) ; 
 if ( tokenMetadata . cloneAfterAllLeft ( ) . sortedTokens ( ) . size ( ) < 2 ) 
 throw new UnsupportedOperationException ( " no other normal nodes in the ring ; decommission would be pointless " ) ; 
 + if ( operationMode ! = Mode . NORMAL ) 
 + throw new UnsupportedOperationException ( " Node in " + operationMode + " state ; wait for status to become normal or restart " ) ; 
 
 PendingRangeCalculatorService . instance . blockUntilFinished ( ) ; 
 for ( String keyspaceName : Schema . instance . getNonSystemKeyspaces ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / tools / nodetool / Decommission . java b / src / java / org / apache / cassandra / tools / nodetool / Decommission . java 
 index a3feb67 . . 34890e0 100644 
 - - - a / src / java / org / apache / cassandra / tools / nodetool / Decommission . java 
 + + + b / src / java / org / apache / cassandra / tools / nodetool / Decommission . java 
 @ @ - 34 , 6 + 34 , 9 @ @ public class Decommission extends NodeToolCmd 
 } catch ( InterruptedException e ) 
 { 
 throw new RuntimeException ( " Error decommissioning node " , e ) ; 
 + } catch ( UnsupportedOperationException e ) 
 + { 
 + throw new IllegalStateException ( " Unsupported operation : " + e . getMessage ( ) , e ) ; 
 } 
 } 
 } 
 \ No newline at end of file

NEAREST DIFF:
ELIMINATEDSENTENCE
