BLEU SCORE: 0.027611988917697356

TEST MSG: Fix repair race that caused gossip to block
GENERATED MSG: Avoid synchronized on prepareForRepair in ActiveRepairService

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 3f4f3f2 . . a94dbc9 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 . 16 <nl> + * Fix repair race that caused gossip to block ( CASSANDRA - 13849 ) <nl> * Tracing interferes with digest requests when using RandomPartitioner ( CASSANDRA - 13964 ) <nl> * Add flag to disable materialized views , and warnings on creation ( CASSANDRA - 13959 ) <nl> * Don ' t let user drop or generally break tables in system _ distributed ( CASSANDRA - 13813 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> index b4cea79 . . adb6fab 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> @ @ - 280 , 7 + 280 , 7 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> return neighbors ; <nl> } <nl> <nl> - public synchronized UUID prepareForRepair ( UUID parentRepairSession , InetAddress coordinator , Set < InetAddress > endpoints , RepairOption options , List < ColumnFamilyStore > columnFamilyStores ) <nl> + public UUID prepareForRepair ( UUID parentRepairSession , InetAddress coordinator , Set < InetAddress > endpoints , RepairOption options , List < ColumnFamilyStore > columnFamilyStores ) <nl> { <nl> long timestamp = System . currentTimeMillis ( ) ; <nl> registerParentRepairSession ( parentRepairSession , coordinator , columnFamilyStores , options . getRanges ( ) , options . isIncremental ( ) , timestamp , options . isGlobal ( ) ) ; <nl> @ @ - 351 , 7 + 351 , 7 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> throw new RuntimeException ( errorMsg ) ; <nl> } <nl> <nl> - public void registerParentRepairSession ( UUID parentRepairSession , InetAddress coordinator , List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , boolean isIncremental , long timestamp , boolean isGlobal ) <nl> + public synchronized void registerParentRepairSession ( UUID parentRepairSession , InetAddress coordinator , List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , boolean isIncremental , long timestamp , boolean isGlobal ) <nl> { <nl> if ( ! registeredForEndpointChanges ) <nl> { <nl> @ @ - 360 , 7 + 360 , 10 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai <nl> registeredForEndpointChanges = true ; <nl> } <nl> <nl> - parentRepairSessions . put ( parentRepairSession , new ParentRepairSession ( coordinator , columnFamilyStores , ranges , isIncremental , timestamp , isGlobal ) ) ; <nl> + if ( ! parentRepairSessions . containsKey ( parentRepairSession ) ) <nl> + { <nl> + parentRepairSessions . put ( parentRepairSession , new ParentRepairSession ( coordinator , columnFamilyStores , ranges , isIncremental , timestamp , isGlobal ) ) ; <nl> + } <nl> } <nl> <nl> public Set < SSTableReader > currentlyRepairing ( UUID cfId , UUID parentRepairSession )
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 3f4f3f2 . . a94dbc9 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 . 16 
 + * Fix repair race that caused gossip to block ( CASSANDRA - 13849 ) 
 * Tracing interferes with digest requests when using RandomPartitioner ( CASSANDRA - 13964 ) 
 * Add flag to disable materialized views , and warnings on creation ( CASSANDRA - 13959 ) 
 * Don ' t let user drop or generally break tables in system _ distributed ( CASSANDRA - 13813 ) 
 diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 index b4cea79 . . adb6fab 100644 
 - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 @ @ - 280 , 7 + 280 , 7 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 return neighbors ; 
 } 
 
 - public synchronized UUID prepareForRepair ( UUID parentRepairSession , InetAddress coordinator , Set < InetAddress > endpoints , RepairOption options , List < ColumnFamilyStore > columnFamilyStores ) 
 + public UUID prepareForRepair ( UUID parentRepairSession , InetAddress coordinator , Set < InetAddress > endpoints , RepairOption options , List < ColumnFamilyStore > columnFamilyStores ) 
 { 
 long timestamp = System . currentTimeMillis ( ) ; 
 registerParentRepairSession ( parentRepairSession , coordinator , columnFamilyStores , options . getRanges ( ) , options . isIncremental ( ) , timestamp , options . isGlobal ( ) ) ; 
 @ @ - 351 , 7 + 351 , 7 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 throw new RuntimeException ( errorMsg ) ; 
 } 
 
 - public void registerParentRepairSession ( UUID parentRepairSession , InetAddress coordinator , List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , boolean isIncremental , long timestamp , boolean isGlobal ) 
 + public synchronized void registerParentRepairSession ( UUID parentRepairSession , InetAddress coordinator , List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , boolean isIncremental , long timestamp , boolean isGlobal ) 
 { 
 if ( ! registeredForEndpointChanges ) 
 { 
 @ @ - 360 , 7 + 360 , 10 @ @ public class ActiveRepairService implements IEndpointStateChangeSubscriber , IFai 
 registeredForEndpointChanges = true ; 
 } 
 
 - parentRepairSessions . put ( parentRepairSession , new ParentRepairSession ( coordinator , columnFamilyStores , ranges , isIncremental , timestamp , isGlobal ) ) ; 
 + if ( ! parentRepairSessions . containsKey ( parentRepairSession ) ) 
 + { 
 + parentRepairSessions . put ( parentRepairSession , new ParentRepairSession ( coordinator , columnFamilyStores , ranges , isIncremental , timestamp , isGlobal ) ) ; 
 + } 
 } 
 
 public Set < SSTableReader > currentlyRepairing ( UUID cfId , UUID parentRepairSession )

NEAREST DIFF:
ELIMINATEDSENTENCE
