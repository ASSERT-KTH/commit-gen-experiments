BLEU SCORE: 0.041961149062965476

TEST MSG: Add - - hex - format option to nodetool getsstables
GENERATED MSG: add " nodetool endpoints "

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index be9115e . . ba2f25a 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 6 <nl> + * Add - - hex - format option to nodetool getsstables ( CASSANDRA - 11337 ) <nl> * sstablemetadata should print sstable min / max token ( CASSANDRA - 7159 ) <nl> * Do not wrap CassandraException in TriggerExecutor ( CASSANDRA - 9421 ) <nl> * COPY TO should have higher double precision ( CASSANDRA - 11255 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index a2102f4 . . 1c46331 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 1554 , 7 + 1554 , 13 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> / / WARNING : this returns the set of LIVE sstables only , which may be only partially written <nl> public List < String > getSSTablesForKey ( String key ) <nl> { <nl> - DecoratedKey dk = decorateKey ( metadata . getKeyValidator ( ) . fromString ( key ) ) ; <nl> + return getSSTablesForKey ( key , false ) ; <nl> + } <nl> + <nl> + public List < String > getSSTablesForKey ( String key , boolean hexFormat ) <nl> + { <nl> + ByteBuffer keyBuffer = hexFormat ? ByteBufferUtil . hexToBytes ( key ) : metadata . getKeyValidator ( ) . fromString ( key ) ; <nl> + DecoratedKey dk = decorateKey ( keyBuffer ) ; <nl> try ( OpOrder . Group op = readOrdering . start ( ) ) <nl> { <nl> List < String > files = new ArrayList < > ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java b / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java <nl> index c900442 . . 63215b4 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java <nl> @ @ - 124 , 6 + 124 , 14 @ @ public interface ColumnFamilyStoreMBean <nl> public List < String > getSSTablesForKey ( String key ) ; <nl> <nl> / * * <nl> + * Returns a list of filenames that contain the given key on this node <nl> + * @ param key <nl> + * @ param hexFormat if key is in hex string format <nl> + * @ return list of filenames containing the key <nl> + * / <nl> + public List < String > getSSTablesForKey ( String key , boolean hexFormat ) ; <nl> + <nl> + / * * <nl> * Scan through Keyspace / ColumnFamily ' s data directory <nl> * determine which SSTables should be loaded and load them <nl> * / <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 405f70c . . 51fa2c1 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 692 , 10 + 692 , 10 @ @ public class NodeProbe implements AutoCloseable <nl> return ssProxy . getNaturalEndpoints ( keyspace , cf , key ) ; <nl> } <nl> <nl> - public List < String > getSSTables ( String keyspace , String cf , String key ) <nl> + public List < String > getSSTables ( String keyspace , String cf , String key , boolean hexFormat ) <nl> { <nl> ColumnFamilyStoreMBean cfsProxy = getCfsProxy ( keyspace , cf ) ; <nl> - return cfsProxy . getSSTablesForKey ( key ) ; <nl> + return cfsProxy . getSSTablesForKey ( key , hexFormat ) ; <nl> } <nl> <nl> public Set < StreamState > getStreamStatus ( ) <nl> diff - - git a / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java b / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java <nl> index 2c5d46b . . 849ad94 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java <nl> + + + b / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java <nl> @ @ - 24 , 13 + 24 , 19 @ @ import io . airlift . command . Command ; <nl> import java . util . ArrayList ; <nl> import java . util . List ; <nl> <nl> + import io . airlift . command . Option ; <nl> import org . apache . cassandra . tools . NodeProbe ; <nl> import org . apache . cassandra . tools . NodeTool . NodeToolCmd ; <nl> <nl> @ Command ( name = " getsstables " , description = " Print the sstable filenames that own the key " ) <nl> public class GetSSTables extends NodeToolCmd <nl> { <nl> - @ Arguments ( usage = " < keyspace > < table > < key > " , description = " The keyspace , the table , and the key " ) <nl> + @ Option ( title = " hex _ format " , <nl> + name = { " - hf " , " - - hex - format " } , <nl> + description = " Specify the key in hexadecimal string format " ) <nl> + private boolean hexFormat = false ; <nl> + <nl> + @ Arguments ( usage = " < keyspace > < cfname > < key > " , description = " The keyspace , the column family , and the key " ) <nl> private List < String > args = new ArrayList < > ( ) ; <nl> <nl> @ Override <nl> @ @ - 41 , 7 + 47 , 7 @ @ public class GetSSTables extends NodeToolCmd <nl> String cf = args . get ( 1 ) ; <nl> String key = args . get ( 2 ) ; <nl> <nl> - List < String > sstables = probe . getSSTables ( ks , cf , key ) ; <nl> + List < String > sstables = probe . getSSTables ( ks , cf , key , hexFormat ) ; <nl> for ( String sstable : sstables ) <nl> { <nl> System . out . println ( sstable ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> index 154dbff . . 12d2386 100644 <nl> - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java <nl> @ @ - 30 , 6 + 30 , 7 @ @ import java . util . regex . Pattern ; <nl> import java . util . zip . CRC32 ; <nl> import java . util . zip . Checksum ; <nl> <nl> + import org . apache . cassandra . config . CFMetaData ; <nl> import org . apache . cassandra . net . MessagingService ; <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ; <nl> @ @ - 182 , 7 + 183 , 10 @ @ public class CommitLogSegment <nl> { <nl> StringBuilder sb = new StringBuilder ( ) ; <nl> for ( Integer cfId : cfDirty ) <nl> - sb . append ( DatabaseDescriptor . getCFMetaData ( cfId ) . cfName ) . append ( " ( " ) . append ( cfId ) . append ( " ) , " ) ; <nl> + { <nl> + CFMetaData m = DatabaseDescriptor . getCFMetaData ( cfId ) ; <nl> + sb . append ( m = = null ? m . cfName : " < deleted > " ) . append ( " ( " ) . append ( cfId ) . append ( " ) , " ) ; <nl> + } <nl> return sb . toString ( ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index be9115e . . ba2f25a 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 6 
 + * Add - - hex - format option to nodetool getsstables ( CASSANDRA - 11337 ) 
 * sstablemetadata should print sstable min / max token ( CASSANDRA - 7159 ) 
 * Do not wrap CassandraException in TriggerExecutor ( CASSANDRA - 9421 ) 
 * COPY TO should have higher double precision ( CASSANDRA - 11255 ) 
 diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index a2102f4 . . 1c46331 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 1554 , 7 + 1554 , 13 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 / / WARNING : this returns the set of LIVE sstables only , which may be only partially written 
 public List < String > getSSTablesForKey ( String key ) 
 { 
 - DecoratedKey dk = decorateKey ( metadata . getKeyValidator ( ) . fromString ( key ) ) ; 
 + return getSSTablesForKey ( key , false ) ; 
 + } 
 + 
 + public List < String > getSSTablesForKey ( String key , boolean hexFormat ) 
 + { 
 + ByteBuffer keyBuffer = hexFormat ? ByteBufferUtil . hexToBytes ( key ) : metadata . getKeyValidator ( ) . fromString ( key ) ; 
 + DecoratedKey dk = decorateKey ( keyBuffer ) ; 
 try ( OpOrder . Group op = readOrdering . start ( ) ) 
 { 
 List < String > files = new ArrayList < > ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java b / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java 
 index c900442 . . 63215b4 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStoreMBean . java 
 @ @ - 124 , 6 + 124 , 14 @ @ public interface ColumnFamilyStoreMBean 
 public List < String > getSSTablesForKey ( String key ) ; 
 
 / * * 
 + * Returns a list of filenames that contain the given key on this node 
 + * @ param key 
 + * @ param hexFormat if key is in hex string format 
 + * @ return list of filenames containing the key 
 + * / 
 + public List < String > getSSTablesForKey ( String key , boolean hexFormat ) ; 
 + 
 + / * * 
 * Scan through Keyspace / ColumnFamily ' s data directory 
 * determine which SSTables should be loaded and load them 
 * / 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 405f70c . . 51fa2c1 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 692 , 10 + 692 , 10 @ @ public class NodeProbe implements AutoCloseable 
 return ssProxy . getNaturalEndpoints ( keyspace , cf , key ) ; 
 } 
 
 - public List < String > getSSTables ( String keyspace , String cf , String key ) 
 + public List < String > getSSTables ( String keyspace , String cf , String key , boolean hexFormat ) 
 { 
 ColumnFamilyStoreMBean cfsProxy = getCfsProxy ( keyspace , cf ) ; 
 - return cfsProxy . getSSTablesForKey ( key ) ; 
 + return cfsProxy . getSSTablesForKey ( key , hexFormat ) ; 
 } 
 
 public Set < StreamState > getStreamStatus ( ) 
 diff - - git a / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java b / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java 
 index 2c5d46b . . 849ad94 100644 
 - - - a / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java 
 + + + b / src / java / org / apache / cassandra / tools / nodetool / GetSSTables . java 
 @ @ - 24 , 13 + 24 , 19 @ @ import io . airlift . command . Command ; 
 import java . util . ArrayList ; 
 import java . util . List ; 
 
 + import io . airlift . command . Option ; 
 import org . apache . cassandra . tools . NodeProbe ; 
 import org . apache . cassandra . tools . NodeTool . NodeToolCmd ; 
 
 @ Command ( name = " getsstables " , description = " Print the sstable filenames that own the key " ) 
 public class GetSSTables extends NodeToolCmd 
 { 
 - @ Arguments ( usage = " < keyspace > < table > < key > " , description = " The keyspace , the table , and the key " ) 
 + @ Option ( title = " hex _ format " , 
 + name = { " - hf " , " - - hex - format " } , 
 + description = " Specify the key in hexadecimal string format " ) 
 + private boolean hexFormat = false ; 
 + 
 + @ Arguments ( usage = " < keyspace > < cfname > < key > " , description = " The keyspace , the column family , and the key " ) 
 private List < String > args = new ArrayList < > ( ) ; 
 
 @ Override 
 @ @ - 41 , 7 + 47 , 7 @ @ public class GetSSTables extends NodeToolCmd 
 String cf = args . get ( 1 ) ; 
 String key = args . get ( 2 ) ; 
 
 - List < String > sstables = probe . getSSTables ( ks , cf , key ) ; 
 + List < String > sstables = probe . getSSTables ( ks , cf , key , hexFormat ) ; 
 for ( String sstable : sstables ) 
 { 
 System . out . println ( sstable ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 index 154dbff . . 12d2386 100644 
 - - - a / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 + + + b / src / java / org / apache / cassandra / db / commitlog / CommitLogSegment . java 
 @ @ - 30 , 6 + 30 , 7 @ @ import java . util . regex . Pattern ; 
 import java . util . zip . CRC32 ; 
 import java . util . zip . Checksum ; 
 
 + import org . apache . cassandra . config . CFMetaData ; 
 import org . apache . cassandra . net . MessagingService ; 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ; 
 @ @ - 182 , 7 + 183 , 10 @ @ public class CommitLogSegment 
 { 
 StringBuilder sb = new StringBuilder ( ) ; 
 for ( Integer cfId : cfDirty ) 
 - sb . append ( DatabaseDescriptor . getCFMetaData ( cfId ) . cfName ) . append ( " ( " ) . append ( cfId ) . append ( " ) , " ) ; 
 + { 
 + CFMetaData m = DatabaseDescriptor . getCFMetaData ( cfId ) ; 
 + sb . append ( m = = null ? m . cfName : " < deleted > " ) . append ( " ( " ) . append ( cfId ) . append ( " ) , " ) ; 
 + } 
 return sb . toString ( ) ; 
 } 

