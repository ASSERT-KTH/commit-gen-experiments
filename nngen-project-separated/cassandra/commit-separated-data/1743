BLEU SCORE: 0.011246923682765546

TEST MSG: remove dead code
GENERATED MSG: Don ' t ignore index expressions in get _ indexed _ slices

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / thrift / CassandraServer . java b / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> index e92e0c6 . . c6d2600 100644 <nl> - - - a / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> + + + b / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> @ @ - 581 , 13 + 581 , 6 @ @ public class CassandraServer implements Cassandra . Iface <nl> } <nl> } <nl> <nl> - private static ByteBuffer getName ( ColumnOrSuperColumn cosc ) <nl> - { <nl> - return cosc . isSetSuper _ column ( ) ? cosc . super _ column . name : <nl> - ( cosc . isSetColumn ( ) ? cosc . column . name : <nl> - ( cosc . isSetCounter _ column ( ) ? cosc . counter _ column . name : cosc . counter _ super _ column . name ) ) ; <nl> - } <nl> - <nl> public Map < ByteBuffer , Integer > multiget _ count ( List < ByteBuffer > keys , ColumnParent column _ parent , SlicePredicate predicate , ConsistencyLevel consistency _ level ) <nl> throws InvalidRequestException , UnavailableException , TimedOutException <nl> {
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b201961 . . 83eca8a 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 10 , 6 + 10 , 7 @ @ <nl> readability ( CASSANDRA - 3726 ) <nl> * synchronize BiMap of bootstrapping tokens ( CASSANDRA - 3417 ) <nl> * show index options in CLI ( CASSANDRA - 3809 ) <nl> + * add optional socket timeout for streaming ( CASSANDRA - 3838 ) <nl> Merged from 0 . 8 : <nl> * ( Pig ) fix CassandraStorage to use correct comparator in Super ColumnFamily <nl> case ( CASSANDRA - 3251 ) <nl> diff - - git a / NEWS . txt b / NEWS . txt <nl> index 2c29606 . . e36b9e8 100644 <nl> - - - a / NEWS . txt <nl> + + + b / NEWS . txt <nl> @ @ - 8 , 6 + 8 , 13 @ @ upgrade , just in case you need to roll back to the previous version . <nl> ( Cassandra version X + 1 will always be able to read data files created <nl> by version X , but the inverse is not necessarily the case . ) <nl> <nl> + 1 . 0 . 8 <nl> + = = = = = <nl> + <nl> + Other <nl> + - - - - - <nl> + - Allow configuring socket timeout for streaming <nl> + <nl> 1 . 0 . 7 <nl> = = = = = <nl> <nl> diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml <nl> index 2082db0 . . 209bcb8 100644 <nl> - - - a / conf / cassandra . yaml <nl> + + + b / conf / cassandra . yaml <nl> @ @ - 315 , 6 + 315 , 13 @ @ compaction _ preheat _ key _ cache : true <nl> # Time to wait for a reply from other nodes before failing the command <nl> rpc _ timeout _ in _ ms : 10000 <nl> <nl> + # Enable socket timeout for streaming operation . <nl> + # When a timeout occurs during streaming , streaming is retried from the start <nl> + # of the current file . This * can * involve re - streaming an important amount of <nl> + # data , so you should avoid setting the value too low . <nl> + # Default value is 0 , which never timeout streams . <nl> + # streaming _ socket _ timeout _ in _ ms : 0 <nl> + <nl> # phi value that must be reached for a host to be marked down . <nl> # most users should never need to adjust this . <nl> # phi _ convict _ threshold : 8 <nl> diff - - git a / src / java / org / apache / cassandra / config / Config . java b / src / java / org / apache / cassandra / config / Config . java <nl> index 9f5480c . . 7cff37f 100644 <nl> - - - a / src / java / org / apache / cassandra / config / Config . java <nl> + + + b / src / java / org / apache / cassandra / config / Config . java <nl> @ @ - 50 , 6 + 50 , 8 @ @ public class Config <nl> <nl> public Long rpc _ timeout _ in _ ms = new Long ( 2000 ) ; <nl> <nl> + public Integer streaming _ socket _ timeout _ in _ ms = new Integer ( 0 ) ; <nl> + <nl> public Integer phi _ convict _ threshold = 8 ; <nl> <nl> public Integer concurrent _ reads = 8 ; <nl> diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index 03b5175 . . 5aa59e4 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 1008 , 4 + 1008 , 9 @ @ public class DatabaseDescriptor <nl> { <nl> return conf . commitlog _ total _ space _ in _ mb ; <nl> } <nl> + <nl> + public static int getStreamingSocketTimeout ( ) <nl> + { <nl> + return conf . streaming _ socket _ timeout _ in _ ms ; <nl> + } <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / streaming / FileStreamTask . java b / src / java / org / apache / cassandra / streaming / FileStreamTask . java <nl> index 9411b16 . . ffb1388 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / FileStreamTask . java <nl> + + + b / src / java / org / apache / cassandra / streaming / FileStreamTask . java <nl> @ @ - 197 , 6 + 197 , 7 @ @ public class FileStreamTask extends WrappedRunnable <nl> try <nl> { <nl> socket = MessagingService . instance ( ) . getConnectionPool ( to ) . newSocket ( ) ; <nl> + socket . setSoTimeout ( DatabaseDescriptor . getStreamingSocketTimeout ( ) ) ; <nl> output = socket . getOutputStream ( ) ; <nl> break ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java b / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java <nl> index e2a618f . . 8ade06a 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java <nl> + + + b / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java <nl> @ @ - 55 , 6 + 55 , 7 @ @ public class IncomingStreamReader <nl> <nl> public IncomingStreamReader ( StreamHeader header , Socket socket ) throws IOException <nl> { <nl> + socket . setSoTimeout ( DatabaseDescriptor . getStreamingSocketTimeout ( ) ) ; <nl> this . socket = socket ; <nl> InetSocketAddress remoteAddress = ( InetSocketAddress ) socket . getRemoteSocketAddress ( ) ; <nl> session = StreamInSession . get ( remoteAddress . getAddress ( ) , header . sessionId ) ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / thrift / CassandraServer . java b / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 index e92e0c6 . . c6d2600 100644 
 - - - a / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 + + + b / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 @ @ - 581 , 13 + 581 , 6 @ @ public class CassandraServer implements Cassandra . Iface 
 } 
 } 
 
 - private static ByteBuffer getName ( ColumnOrSuperColumn cosc ) 
 - { 
 - return cosc . isSetSuper _ column ( ) ? cosc . super _ column . name : 
 - ( cosc . isSetColumn ( ) ? cosc . column . name : 
 - ( cosc . isSetCounter _ column ( ) ? cosc . counter _ column . name : cosc . counter _ super _ column . name ) ) ; 
 - } 
 - 
 public Map < ByteBuffer , Integer > multiget _ count ( List < ByteBuffer > keys , ColumnParent column _ parent , SlicePredicate predicate , ConsistencyLevel consistency _ level ) 
 throws InvalidRequestException , UnavailableException , TimedOutException 
 {

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b201961 . . 83eca8a 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 10 , 6 + 10 , 7 @ @ 
 readability ( CASSANDRA - 3726 ) 
 * synchronize BiMap of bootstrapping tokens ( CASSANDRA - 3417 ) 
 * show index options in CLI ( CASSANDRA - 3809 ) 
 + * add optional socket timeout for streaming ( CASSANDRA - 3838 ) 
 Merged from 0 . 8 : 
 * ( Pig ) fix CassandraStorage to use correct comparator in Super ColumnFamily 
 case ( CASSANDRA - 3251 ) 
 diff - - git a / NEWS . txt b / NEWS . txt 
 index 2c29606 . . e36b9e8 100644 
 - - - a / NEWS . txt 
 + + + b / NEWS . txt 
 @ @ - 8 , 6 + 8 , 13 @ @ upgrade , just in case you need to roll back to the previous version . 
 ( Cassandra version X + 1 will always be able to read data files created 
 by version X , but the inverse is not necessarily the case . ) 
 
 + 1 . 0 . 8 
 + = = = = = 
 + 
 + Other 
 + - - - - - 
 + - Allow configuring socket timeout for streaming 
 + 
 1 . 0 . 7 
 = = = = = 
 
 diff - - git a / conf / cassandra . yaml b / conf / cassandra . yaml 
 index 2082db0 . . 209bcb8 100644 
 - - - a / conf / cassandra . yaml 
 + + + b / conf / cassandra . yaml 
 @ @ - 315 , 6 + 315 , 13 @ @ compaction _ preheat _ key _ cache : true 
 # Time to wait for a reply from other nodes before failing the command 
 rpc _ timeout _ in _ ms : 10000 
 
 + # Enable socket timeout for streaming operation . 
 + # When a timeout occurs during streaming , streaming is retried from the start 
 + # of the current file . This * can * involve re - streaming an important amount of 
 + # data , so you should avoid setting the value too low . 
 + # Default value is 0 , which never timeout streams . 
 + # streaming _ socket _ timeout _ in _ ms : 0 
 + 
 # phi value that must be reached for a host to be marked down . 
 # most users should never need to adjust this . 
 # phi _ convict _ threshold : 8 
 diff - - git a / src / java / org / apache / cassandra / config / Config . java b / src / java / org / apache / cassandra / config / Config . java 
 index 9f5480c . . 7cff37f 100644 
 - - - a / src / java / org / apache / cassandra / config / Config . java 
 + + + b / src / java / org / apache / cassandra / config / Config . java 
 @ @ - 50 , 6 + 50 , 8 @ @ public class Config 
 
 public Long rpc _ timeout _ in _ ms = new Long ( 2000 ) ; 
 
 + public Integer streaming _ socket _ timeout _ in _ ms = new Integer ( 0 ) ; 
 + 
 public Integer phi _ convict _ threshold = 8 ; 
 
 public Integer concurrent _ reads = 8 ; 
 diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index 03b5175 . . 5aa59e4 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 1008 , 4 + 1008 , 9 @ @ public class DatabaseDescriptor 
 { 
 return conf . commitlog _ total _ space _ in _ mb ; 
 } 
 + 
 + public static int getStreamingSocketTimeout ( ) 
 + { 
 + return conf . streaming _ socket _ timeout _ in _ ms ; 
 + } 
 } 
 diff - - git a / src / java / org / apache / cassandra / streaming / FileStreamTask . java b / src / java / org / apache / cassandra / streaming / FileStreamTask . java 
 index 9411b16 . . ffb1388 100644 
 - - - a / src / java / org / apache / cassandra / streaming / FileStreamTask . java 
 + + + b / src / java / org / apache / cassandra / streaming / FileStreamTask . java 
 @ @ - 197 , 6 + 197 , 7 @ @ public class FileStreamTask extends WrappedRunnable 
 try 
 { 
 socket = MessagingService . instance ( ) . getConnectionPool ( to ) . newSocket ( ) ; 
 + socket . setSoTimeout ( DatabaseDescriptor . getStreamingSocketTimeout ( ) ) ; 
 output = socket . getOutputStream ( ) ; 
 break ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java b / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java 
 index e2a618f . . 8ade06a 100644 
 - - - a / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java 
 + + + b / src / java / org / apache / cassandra / streaming / IncomingStreamReader . java 
 @ @ - 55 , 6 + 55 , 7 @ @ public class IncomingStreamReader 
 
 public IncomingStreamReader ( StreamHeader header , Socket socket ) throws IOException 
 { 
 + socket . setSoTimeout ( DatabaseDescriptor . getStreamingSocketTimeout ( ) ) ; 
 this . socket = socket ; 
 InetSocketAddress remoteAddress = ( InetSocketAddress ) socket . getRemoteSocketAddress ( ) ; 
 session = StreamInSession . get ( remoteAddress . getAddress ( ) , header . sessionId ) ;
