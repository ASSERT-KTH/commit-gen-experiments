BLEU SCORE: 0.04186576731652839

TEST MSG: CHANGES
GENERATED MSG: fix CAS contention timeout

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index e72e5d2 . . e0338db 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 4 <nl> + * Fix cleanup ClassCastException ( CASSANDRA - 6462 ) <nl> * Reduce gossip memory use by interning VersionedValue strings ( CASSANDRA - 6410 ) <nl> * Allow specifying datacenters to participate in a repair ( CASSANDRA - 6218 ) <nl> * Fix divide - by - zero in PCI ( CASSANDRA - 6403 )
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 960a8c2 . . 25c0217 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 10 , 6 + 10 , 8 @ @ <nl> ( CASSANDRA - 5752 ) <nl> * add " all time blocked " to StatusLogger output ( CASSANDRA - 5825 ) <nl> * Future - proof inter - major - version schema migrations ( CASSANDRA - 5845 ) <nl> + * ( Hadoop ) add CqlPagingRecordReader support for ReversedType in Thrift table <nl> + ( CASSANDRA - 5718 ) <nl> <nl> <nl> 1 . 2 . 8 <nl> diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java <nl> index c6eb46d . . d1a089f 100644 <nl> - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java <nl> + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java <nl> @ @ - 35 , 6 + 35 , 7 @ @ import org . apache . cassandra . cql3 . ColumnIdentifier ; <nl> import org . apache . cassandra . db . marshal . AbstractType ; <nl> import org . apache . cassandra . db . marshal . CompositeType ; <nl> import org . apache . cassandra . db . marshal . LongType ; <nl> + import org . apache . cassandra . db . marshal . ReversedType ; <nl> import org . apache . cassandra . db . marshal . TypeParser ; <nl> import org . apache . cassandra . dht . IPartitioner ; <nl> import org . apache . cassandra . exceptions . ConfigurationException ; <nl> @ @ - 493 , 7 + 494 , 7 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , <nl> private Pair < Integer , String > whereClause ( List < BoundColumn > column , int position ) <nl> { <nl> if ( position = = column . size ( ) - 1 | | column . get ( position + 1 ) . value = = null ) <nl> - return Pair . create ( position + 2 , String . format ( " AND % s > ? " , quote ( column . get ( position ) . name ) ) ) ; <nl> + return Pair . create ( position + 2 , String . format ( " AND % s % s ? " , quote ( column . get ( position ) . name ) , column . get ( position ) . reversed ? " < " : " > " ) ) ; <nl> <nl> Pair < Integer , String > clause = whereClause ( column , position + 1 ) ; <nl> return Pair . create ( clause . left , String . format ( " AND % s = ? % s " , quote ( column . get ( position ) . name ) , clause . right ) ) ; <nl> @ @ - 688 , 6 + 689 , 20 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , <nl> clusterColumns . add ( new BoundColumn ( key ) ) ; <nl> <nl> parseKeyValidators ( ByteBufferUtil . string ( ByteBuffer . wrap ( cqlRow . columns . get ( 2 ) . getValue ( ) ) ) ) ; <nl> + <nl> + Column rawComparator = cqlRow . columns . get ( 3 ) ; <nl> + String comparator = ByteBufferUtil . string ( ByteBuffer . wrap ( rawComparator . getValue ( ) ) ) ; <nl> + logger . debug ( " comparator : { } " , comparator ) ; <nl> + AbstractType comparatorValidator = parseType ( comparator ) ; <nl> + if ( comparatorValidator instanceof CompositeType ) <nl> + { <nl> + for ( int i = 0 ; i < clusterColumns . size ( ) ; i + + ) <nl> + clusterColumns . get ( i ) . reversed = ( ( ( CompositeType ) comparatorValidator ) . types . get ( i ) instanceof ReversedType ) ; <nl> + } <nl> + else if ( comparatorValidator instanceof ReversedType ) <nl> + { <nl> + clusterColumns . get ( 0 ) . reversed = true ; <nl> + } <nl> } <nl> <nl> / * * <nl> @ @ - 778 , 6 + 793 , 7 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , <nl> final String name ; <nl> ByteBuffer value ; <nl> AbstractType < ? > validator ; <nl> + boolean reversed = false ; <nl> <nl> public BoundColumn ( String name ) <nl> {

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index e72e5d2 . . e0338db 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 4 
 + * Fix cleanup ClassCastException ( CASSANDRA - 6462 ) 
 * Reduce gossip memory use by interning VersionedValue strings ( CASSANDRA - 6410 ) 
 * Allow specifying datacenters to participate in a repair ( CASSANDRA - 6218 ) 
 * Fix divide - by - zero in PCI ( CASSANDRA - 6403 )

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 960a8c2 . . 25c0217 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 10 , 6 + 10 , 8 @ @ 
 ( CASSANDRA - 5752 ) 
 * add " all time blocked " to StatusLogger output ( CASSANDRA - 5825 ) 
 * Future - proof inter - major - version schema migrations ( CASSANDRA - 5845 ) 
 + * ( Hadoop ) add CqlPagingRecordReader support for ReversedType in Thrift table 
 + ( CASSANDRA - 5718 ) 
 
 
 1 . 2 . 8 
 diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java 
 index c6eb46d . . d1a089f 100644 
 - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java 
 + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlPagingRecordReader . java 
 @ @ - 35 , 6 + 35 , 7 @ @ import org . apache . cassandra . cql3 . ColumnIdentifier ; 
 import org . apache . cassandra . db . marshal . AbstractType ; 
 import org . apache . cassandra . db . marshal . CompositeType ; 
 import org . apache . cassandra . db . marshal . LongType ; 
 + import org . apache . cassandra . db . marshal . ReversedType ; 
 import org . apache . cassandra . db . marshal . TypeParser ; 
 import org . apache . cassandra . dht . IPartitioner ; 
 import org . apache . cassandra . exceptions . ConfigurationException ; 
 @ @ - 493 , 7 + 494 , 7 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , 
 private Pair < Integer , String > whereClause ( List < BoundColumn > column , int position ) 
 { 
 if ( position = = column . size ( ) - 1 | | column . get ( position + 1 ) . value = = null ) 
 - return Pair . create ( position + 2 , String . format ( " AND % s > ? " , quote ( column . get ( position ) . name ) ) ) ; 
 + return Pair . create ( position + 2 , String . format ( " AND % s % s ? " , quote ( column . get ( position ) . name ) , column . get ( position ) . reversed ? " < " : " > " ) ) ; 
 
 Pair < Integer , String > clause = whereClause ( column , position + 1 ) ; 
 return Pair . create ( clause . left , String . format ( " AND % s = ? % s " , quote ( column . get ( position ) . name ) , clause . right ) ) ; 
 @ @ - 688 , 6 + 689 , 20 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , 
 clusterColumns . add ( new BoundColumn ( key ) ) ; 
 
 parseKeyValidators ( ByteBufferUtil . string ( ByteBuffer . wrap ( cqlRow . columns . get ( 2 ) . getValue ( ) ) ) ) ; 
 + 
 + Column rawComparator = cqlRow . columns . get ( 3 ) ; 
 + String comparator = ByteBufferUtil . string ( ByteBuffer . wrap ( rawComparator . getValue ( ) ) ) ; 
 + logger . debug ( " comparator : { } " , comparator ) ; 
 + AbstractType comparatorValidator = parseType ( comparator ) ; 
 + if ( comparatorValidator instanceof CompositeType ) 
 + { 
 + for ( int i = 0 ; i < clusterColumns . size ( ) ; i + + ) 
 + clusterColumns . get ( i ) . reversed = ( ( ( CompositeType ) comparatorValidator ) . types . get ( i ) instanceof ReversedType ) ; 
 + } 
 + else if ( comparatorValidator instanceof ReversedType ) 
 + { 
 + clusterColumns . get ( 0 ) . reversed = true ; 
 + } 
 } 
 
 / * * 
 @ @ - 778 , 6 + 793 , 7 @ @ public class CqlPagingRecordReader extends RecordReader < Map < String , ByteBuffer > , 
 final String name ; 
 ByteBuffer value ; 
 AbstractType < ? > validator ; 
 + boolean reversed = false ; 
 
 public BoundColumn ( String name ) 
 {
