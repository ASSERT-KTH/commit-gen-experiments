BLEU SCORE: 0.02931251013275449

TEST MSG: merge from 2 . 0
GENERATED MSG: Fix handling of RejectedExecution in sync Thrift server

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 0cd9d4a . . ca4bcfb 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 23 , 6 + 23 , 7 @ @ <nl> * Add logging levels ( minimal , normal or verbose ) to stress tool ( CASSANDRA - 6849 ) <nl> * Fix race condition in Batch CLE ( CASSANDRA - 6860 ) <nl> Merged from 2 . 0 : <nl> + * Fix handling of RejectedExecution in sync Thrift server ( CASSANDRA - 6788 ) <nl> * Log more information when exceeding tombstone _ warn _ threshold ( CASSANDRA - 6865 ) <nl> * Fix truncate to not abort due to unreachable fat clients ( CASSANDRA - 6864 ) <nl> * Fix schema concurrency exceptions ( CASSANDRA - 6841 ) <nl> diff - - git a / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java b / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java <nl> index 7bcfdf2 . . f7a602c 100644 <nl> - - - a / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java <nl> + + + b / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java <nl> @ @ - 21 , 6 + 21 , 7 @ @ import java . net . InetSocketAddress ; <nl> import java . net . SocketAddress ; <nl> import java . net . SocketTimeoutException ; <nl> import java . util . concurrent . ExecutorService ; <nl> + import java . util . concurrent . RejectedExecutionException ; <nl> import java . util . concurrent . SynchronousQueue ; <nl> import java . util . concurrent . ThreadPoolExecutor ; <nl> import java . util . concurrent . TimeUnit ; <nl> @ @ - 97 , 7 + 98 , 7 @ @ public class CustomTThreadPoolServer extends TServer <nl> / / block until we are under max clients <nl> while ( activeClients . get ( ) > = args . maxWorkerThreads ) <nl> { <nl> - Uninterruptibles . sleepUninterruptibly ( 100 , TimeUnit . MILLISECONDS ) ; <nl> + Uninterruptibles . sleepUninterruptibly ( 10 , TimeUnit . MILLISECONDS ) ; <nl> } <nl> <nl> try <nl> @ @ - 117 , 6 + 118 , 12 @ @ public class CustomTThreadPoolServer extends TServer <nl> logger . warn ( " Transport error occurred during acceptance of message . " , ttx ) ; <nl> } <nl> } <nl> + catch ( RejectedExecutionException e ) <nl> + { <nl> + / / worker thread decremented activeClients but hadn ' t finished exiting <nl> + logger . debug ( " Dropping client connection because our limit of { } has been reached " , args . maxWorkerThreads ) ; <nl> + continue ; <nl> + } <nl> <nl> if ( activeClients . get ( ) > = args . maxWorkerThreads ) <nl> logger . warn ( " Maximum number of clients { } reached " , args . maxWorkerThreads ) ; <nl> @ @ - 213 , 19 + 220 , 13 @ @ public class CustomTThreadPoolServer extends TServer <nl> } <nl> finally <nl> { <nl> - activeClients . decrementAndGet ( ) ; <nl> if ( socket ! = null ) <nl> ThriftSessionManager . instance . connectionComplete ( socket ) ; <nl> - } <nl> - <nl> - if ( inputTransport ! = null ) <nl> - { <nl> - inputTransport . close ( ) ; <nl> - } <nl> - <nl> - if ( outputTransport ! = null ) <nl> - { <nl> - outputTransport . close ( ) ; <nl> + if ( inputTransport ! = null ) <nl> + inputTransport . close ( ) ; <nl> + if ( outputTransport ! = null ) <nl> + outputTransport . close ( ) ; <nl> + activeClients . decrementAndGet ( ) ; <nl> } <nl> } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 0cd9d4a . . ca4bcfb 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 23 , 6 + 23 , 7 @ @ 
 * Add logging levels ( minimal , normal or verbose ) to stress tool ( CASSANDRA - 6849 ) 
 * Fix race condition in Batch CLE ( CASSANDRA - 6860 ) 
 Merged from 2 . 0 : 
 + * Fix handling of RejectedExecution in sync Thrift server ( CASSANDRA - 6788 ) 
 * Log more information when exceeding tombstone _ warn _ threshold ( CASSANDRA - 6865 ) 
 * Fix truncate to not abort due to unreachable fat clients ( CASSANDRA - 6864 ) 
 * Fix schema concurrency exceptions ( CASSANDRA - 6841 ) 
 diff - - git a / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java b / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java 
 index 7bcfdf2 . . f7a602c 100644 
 - - - a / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java 
 + + + b / src / java / org / apache / cassandra / thrift / CustomTThreadPoolServer . java 
 @ @ - 21 , 6 + 21 , 7 @ @ import java . net . InetSocketAddress ; 
 import java . net . SocketAddress ; 
 import java . net . SocketTimeoutException ; 
 import java . util . concurrent . ExecutorService ; 
 + import java . util . concurrent . RejectedExecutionException ; 
 import java . util . concurrent . SynchronousQueue ; 
 import java . util . concurrent . ThreadPoolExecutor ; 
 import java . util . concurrent . TimeUnit ; 
 @ @ - 97 , 7 + 98 , 7 @ @ public class CustomTThreadPoolServer extends TServer 
 / / block until we are under max clients 
 while ( activeClients . get ( ) > = args . maxWorkerThreads ) 
 { 
 - Uninterruptibles . sleepUninterruptibly ( 100 , TimeUnit . MILLISECONDS ) ; 
 + Uninterruptibles . sleepUninterruptibly ( 10 , TimeUnit . MILLISECONDS ) ; 
 } 
 
 try 
 @ @ - 117 , 6 + 118 , 12 @ @ public class CustomTThreadPoolServer extends TServer 
 logger . warn ( " Transport error occurred during acceptance of message . " , ttx ) ; 
 } 
 } 
 + catch ( RejectedExecutionException e ) 
 + { 
 + / / worker thread decremented activeClients but hadn ' t finished exiting 
 + logger . debug ( " Dropping client connection because our limit of { } has been reached " , args . maxWorkerThreads ) ; 
 + continue ; 
 + } 
 
 if ( activeClients . get ( ) > = args . maxWorkerThreads ) 
 logger . warn ( " Maximum number of clients { } reached " , args . maxWorkerThreads ) ; 
 @ @ - 213 , 19 + 220 , 13 @ @ public class CustomTThreadPoolServer extends TServer 
 } 
 finally 
 { 
 - activeClients . decrementAndGet ( ) ; 
 if ( socket ! = null ) 
 ThriftSessionManager . instance . connectionComplete ( socket ) ; 
 - } 
 - 
 - if ( inputTransport ! = null ) 
 - { 
 - inputTransport . close ( ) ; 
 - } 
 - 
 - if ( outputTransport ! = null ) 
 - { 
 - outputTransport . close ( ) ; 
 + if ( inputTransport ! = null ) 
 + inputTransport . close ( ) ; 
 + if ( outputTransport ! = null ) 
 + outputTransport . close ( ) ; 
 + activeClients . decrementAndGet ( ) ; 
 } 
 } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
