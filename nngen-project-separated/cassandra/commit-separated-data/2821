BLEU SCORE: 2.765421850739168E-4

TEST MSG: fix build
GENERATED MSG: expose compaction via JMX . patch by Eric Evans ; reviewed by jbellis for CASSANDRA - 211

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java b / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java <nl> index 3bbf4b8 . . c1e4e8e 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java <nl> @ @ - 420 , 5 + 420 , 10 @ @ public class RangeTombstoneTest extends SchemaLoader <nl> public void truncateBlocking ( long truncatedAt ) { } <nl> <nl> public boolean indexes ( CellName name ) { return name . toByteBuffer ( ) . equals ( ByteBufferUtil . bytes ( 1 ) ) ; } <nl> + <nl> + @ Override <nl> + public long estimateResultRows ( ) { <nl> + return 0 ; <nl> + } <nl> } <nl> } <nl> diff - - git a / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java b / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java <nl> index 940a565 . . 3222d29 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java <nl> @ @ - 143 , 6 + 143 , 11 @ @ public class SecondaryIndexCellSizeTest <nl> { <nl> return true ; <nl> } <nl> + <nl> + @ Override <nl> + public long estimateResultRows ( ) { <nl> + return 0 ; <nl> + } <nl> } <nl> <nl> <nl> @ @ - 226 , 5 + 231 , 10 @ @ public class SecondaryIndexCellSizeTest <nl> { <nl> return true ; <nl> } <nl> + <nl> + @ Override <nl> + public long estimateResultRows ( ) { <nl> + return 0 ; <nl> + } <nl> } <nl> } <nl> diff - - git a / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java b / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java <nl> index 03f5860 . . 60cb19a 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java <nl> @ @ - 55 , 7 + 55 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader <nl> } <nl> <nl> @ Test <nl> - public void testIndexInsertAndUpdate ( ) throws IOException <nl> + public void testIndexInsertAndUpdate ( ) <nl> { <nl> / / create a row then test that the configured index instance was able to read the row <nl> Mutation rm ; <nl> @ @ - 79 , 7 + 79 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader <nl> } <nl> <nl> @ Test <nl> - public void testColumnDelete ( ) throws IOException <nl> + public void testColumnDelete ( ) <nl> { <nl> / / issue a column delete and test that the configured index instance was notified to update <nl> Mutation rm ; <nl> @ @ - 98 , 7 + 98 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader <nl> } <nl> <nl> @ Test <nl> - public void testRowDelete ( ) throws IOException <nl> + public void testRowDelete ( ) <nl> { <nl> / / issue a row level delete and test that the configured index instance was notified to update <nl> Mutation rm ; <nl> @ @ - 205 , 5 + 205 , 10 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader <nl> public void truncateBlocking ( long truncatedAt ) <nl> { <nl> } <nl> + <nl> + @ Override <nl> + public long estimateResultRows ( ) { <nl> + return 0 ; <nl> + } <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 2a07bb7 . . 6433ad6 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 691 , 6 + 691 , 19 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto <nl> } <nl> } <nl> <nl> + / * * <nl> + * Trigger the immediate compaction of all tables . <nl> + * / <nl> + public void forceTableCompaction ( ) <nl> + { <nl> + List < String > tables = DatabaseDescriptor . getTables ( ) ; <nl> + for ( String tName : tables ) <nl> + { <nl> + Table table = Table . open ( tName ) ; <nl> + table . forceCompaction ( ) ; <nl> + } <nl> + } <nl> + <nl> public void forceHandoff ( String directories , String host ) throws IOException <nl> { <nl> List < File > filesList = new ArrayList < File > ( ) ; <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index 82ec4b8 . . 2c1bfe3 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 37 , 6 + 37 , 7 @ @ public interface StorageServiceMBean <nl> public Map < Range , List < EndPoint > > getRangeToEndPointMap ( ) ; <nl> public String getLoadInfo ( ) ; <nl> public int getCurrentGenerationNumber ( ) ; <nl> + public void forceTableCompaction ( ) ; <nl> <nl> / * * <nl> * This method will cause the local node initiate

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java b / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java 
 index 3bbf4b8 . . c1e4e8e 100644 
 - - - a / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java 
 + + + b / test / unit / org / apache / cassandra / db / RangeTombstoneTest . java 
 @ @ - 420 , 5 + 420 , 10 @ @ public class RangeTombstoneTest extends SchemaLoader 
 public void truncateBlocking ( long truncatedAt ) { } 
 
 public boolean indexes ( CellName name ) { return name . toByteBuffer ( ) . equals ( ByteBufferUtil . bytes ( 1 ) ) ; } 
 + 
 + @ Override 
 + public long estimateResultRows ( ) { 
 + return 0 ; 
 + } 
 } 
 } 
 diff - - git a / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java b / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java 
 index 940a565 . . 3222d29 100644 
 - - - a / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java 
 + + + b / test / unit / org / apache / cassandra / db / SecondaryIndexCellSizeTest . java 
 @ @ - 143 , 6 + 143 , 11 @ @ public class SecondaryIndexCellSizeTest 
 { 
 return true ; 
 } 
 + 
 + @ Override 
 + public long estimateResultRows ( ) { 
 + return 0 ; 
 + } 
 } 
 
 
 @ @ - 226 , 5 + 231 , 10 @ @ public class SecondaryIndexCellSizeTest 
 { 
 return true ; 
 } 
 + 
 + @ Override 
 + public long estimateResultRows ( ) { 
 + return 0 ; 
 + } 
 } 
 } 
 diff - - git a / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java b / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java 
 index 03f5860 . . 60cb19a 100644 
 - - - a / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java 
 + + + b / test / unit / org / apache / cassandra / db / index / PerRowSecondaryIndexTest . java 
 @ @ - 55 , 7 + 55 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader 
 } 
 
 @ Test 
 - public void testIndexInsertAndUpdate ( ) throws IOException 
 + public void testIndexInsertAndUpdate ( ) 
 { 
 / / create a row then test that the configured index instance was able to read the row 
 Mutation rm ; 
 @ @ - 79 , 7 + 79 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader 
 } 
 
 @ Test 
 - public void testColumnDelete ( ) throws IOException 
 + public void testColumnDelete ( ) 
 { 
 / / issue a column delete and test that the configured index instance was notified to update 
 Mutation rm ; 
 @ @ - 98 , 7 + 98 , 7 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader 
 } 
 
 @ Test 
 - public void testRowDelete ( ) throws IOException 
 + public void testRowDelete ( ) 
 { 
 / / issue a row level delete and test that the configured index instance was notified to update 
 Mutation rm ; 
 @ @ - 205 , 5 + 205 , 10 @ @ public class PerRowSecondaryIndexTest extends SchemaLoader 
 public void truncateBlocking ( long truncatedAt ) 
 { 
 } 
 + 
 + @ Override 
 + public long estimateResultRows ( ) { 
 + return 0 ; 
 + } 
 } 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 2a07bb7 . . 6433ad6 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 691 , 6 + 691 , 19 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto 
 } 
 } 
 
 + / * * 
 + * Trigger the immediate compaction of all tables . 
 + * / 
 + public void forceTableCompaction ( ) 
 + { 
 + List < String > tables = DatabaseDescriptor . getTables ( ) ; 
 + for ( String tName : tables ) 
 + { 
 + Table table = Table . open ( tName ) ; 
 + table . forceCompaction ( ) ; 
 + } 
 + } 
 + 
 public void forceHandoff ( String directories , String host ) throws IOException 
 { 
 List < File > filesList = new ArrayList < File > ( ) ; 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index 82ec4b8 . . 2c1bfe3 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 37 , 6 + 37 , 7 @ @ public interface StorageServiceMBean 
 public Map < Range , List < EndPoint > > getRangeToEndPointMap ( ) ; 
 public String getLoadInfo ( ) ; 
 public int getCurrentGenerationNumber ( ) ; 
 + public void forceTableCompaction ( ) ; 
 
 / * * 
 * This method will cause the local node initiate
