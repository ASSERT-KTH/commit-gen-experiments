BLEU SCORE: 0.020980574531482755

TEST MSG: Sleep for RING _ DELAY before replacing with same IP
GENERATED MSG: Add binary protocol to stress

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt < nl > index 56059a1 . . 0674dde 100644 < nl > - - - a / CHANGES . txt < nl > + + + b / CHANGES . txt < nl > @ @ - 1 , 4 + 1 , 5 @ @ < nl > 1 . 2 . 16 < nl > + * Fix broken streams when replacing with same IP ( CASSANDRA - 6622 ) < nl > * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) < nl > * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) < nl > * Fix mean cells and mean row size per sstable calculations ( CASSANDRA - 6667 ) < nl > diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java < nl > index 94dd73d . . ec8c7c3 100644 < nl > - - - a / src / java / org / apache / cassandra / service / StorageService . java < nl > + + + b / src / java / org / apache / cassandra / service / StorageService . java < nl > @ @ - 735 , 6 + 735 , 18 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE < nl > } < nl > } < nl > } < nl > + else < nl > + { < nl > + try < nl > + { < nl > + Thread . sleep ( RING _ DELAY ) ; < nl > + } < nl > + catch ( InterruptedException e ) < nl > + { < nl > + throw new AssertionError ( e ) ; < nl > + } < nl > + < nl > + } < nl > setMode ( Mode . JOINING , " Replacing a node with token ( s ) : " + tokens , true ) ; < nl > } < nl >
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> index 7dbd14a . . 8a5595a 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> @ @ - 180 , 7 + 180 , 7 @ @ public class UpdateStatement extends ModificationStatement <nl> { <nl> for ( Term t : values ) <nl> { <nl> - ByteBuffer val = values . get ( 0 ) . bindAndGet ( variables ) ; <nl> + ByteBuffer val = t . bindAndGet ( variables ) ; <nl> if ( val = = null ) <nl> throw new InvalidRequestException ( String . format ( " Invalid null value for partition key part % s " , name ) ) ; <nl> keys . add ( keyBuilder . copy ( ) . add ( val ) . build ( ) ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 56059a1 . . 0674dde 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 . 16 
 + * Fix broken streams when replacing with same IP ( CASSANDRA - 6622 ) 
 * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) 
 * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) 
 * Fix mean cells and mean row size per sstable calculations ( CASSANDRA - 6667 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 94dd73d . . ec8c7c3 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 735 , 6 + 735 , 18 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 } 
 } 
 } 
 + else 
 + { 
 + try 
 + { 
 + Thread . sleep ( RING _ DELAY ) ; 
 + } 
 + catch ( InterruptedException e ) 
 + { 
 + throw new AssertionError ( e ) ; 
 + } 
 + 
 + } 
 setMode ( Mode . JOINING , " Replacing a node with token ( s ) : " + tokens , true ) ; 
 } 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 index 7dbd14a . . 8a5595a 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 @ @ - 180 , 7 + 180 , 7 @ @ public class UpdateStatement extends ModificationStatement 
 { 
 for ( Term t : values ) 
 { 
 - ByteBuffer val = values . get ( 0 ) . bindAndGet ( variables ) ; 
 + ByteBuffer val = t . bindAndGet ( variables ) ; 
 if ( val = = null ) 
 throw new InvalidRequestException ( String . format ( " Invalid null value for partition key part % s " , name ) ) ; 
 keys . add ( keyBuilder . copy ( ) . add ( val ) . build ( ) ) ;
