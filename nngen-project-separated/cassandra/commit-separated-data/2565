BLEU SCORE: 0.015445276590783498

TEST MSG: simplify : no need for iterator to get first item in a list
GENERATED MSG: clean up loadinfo and SLB

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / RowDataResolver . java b / src / java / org / apache / cassandra / service / RowDataResolver . java <nl> index 5422d82 . . a10da2e 100644 <nl> - - - a / src / java / org / apache / cassandra / service / RowDataResolver . java <nl> + + + b / src / java / org / apache / cassandra / service / RowDataResolver . java <nl> @ @ - 92 , 7 + 92 , 7 @ @ public class RowDataResolver extends AbstractRowResolver <nl> } <nl> else <nl> { <nl> - resolved = replies . iterator ( ) . next ( ) . payload . row ( ) . cf ; <nl> + resolved = replies . get ( 0 ) . payload . row ( ) . cf ; <nl> } <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> @ @ - 161 , 7 + 161 , 7 @ @ public class RowDataResolver extends AbstractRowResolver <nl> <nl> public Row getData ( ) <nl> { <nl> - return replies . iterator ( ) . next ( ) . payload . row ( ) ; <nl> + return replies . get ( 0 ) . payload . row ( ) ; <nl> } <nl> <nl> public boolean isDataPresent ( )
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / LoadDisseminator . java b / src / java / org / apache / cassandra / service / LoadDisseminator . java <nl> index 622385f . . 9e9fd1f 100644 <nl> - - - a / src / java / org / apache / cassandra / service / LoadDisseminator . java <nl> + + + b / src / java / org / apache / cassandra / service / LoadDisseminator . java <nl> @ @ - 34 , 8 + 34 , 7 @ @ class LoadDisseminator extends TimerTask <nl> { <nl> try <nl> { <nl> - long diskSpace = FileUtils . getUsedDiskSpace ( ) ; <nl> - String diskUtilization = FileUtils . stringifyFileSize ( diskSpace ) ; <nl> + String diskUtilization = String . valueOf ( StorageService . instance ( ) . getLoad ( ) ) ; <nl> if ( logger _ . isDebugEnabled ( ) ) <nl> logger _ . debug ( " Disseminating load info . . . " ) ; <nl> Gossiper . instance ( ) . addApplicationState ( LoadDisseminator . loadInfo _ , new ApplicationState ( diskUtilization ) ) ; <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageLoadBalancer . java b / src / java / org / apache / cassandra / service / StorageLoadBalancer . java <nl> index 53ecdd1 . . f91a4aa 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageLoadBalancer . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageLoadBalancer . java <nl> @ @ - 375 , 11 + 375 , 7 @ @ final class StorageLoadBalancer implements IEndPointStateChangeSubscriber <nl> <nl> class MoveMessage implements Serializable <nl> { <nl> - private Token targetToken _ ; <nl> - <nl> - private MoveMessage ( ) <nl> - { <nl> - } <nl> + private final Token targetToken _ ; <nl> <nl> MoveMessage ( Token targetToken ) <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index a22edae . . 1e73051 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 498 , 24 + 498 , 16 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto <nl> } <nl> } <nl> <nl> - / * * <nl> - * Get the count of primary keys from the sampler . <nl> - * / <nl> - public String getLoadInfo ( ) <nl> + / * * raw load value * / <nl> + public double getLoad ( ) <nl> { <nl> - long diskSpace = FileUtils . getUsedDiskSpace ( ) ; <nl> - 	 return FileUtils . stringifyFileSize ( diskSpace ) ; <nl> + return FileUtils . getUsedDiskSpace ( ) ; <nl> } <nl> <nl> - / * * <nl> - * Get the primary count info for this endpoint . <nl> - * This is gossiped around and cached in the <nl> - * StorageLoadBalancer . <nl> - * / <nl> - public String getLoadInfo ( EndPoint ep ) <nl> + / * * Human - readable load value * / <nl> + public String getLoadString ( ) <nl> { <nl> - LoadInfo li = storageLoadBalancer _ . getLoad ( ep ) ; <nl> - return ( li = = null ) ? " N / A " : li . toString ( ) ; <nl> + return FileUtils . stringifyFileSize ( FileUtils . getUsedDiskSpace ( ) ) ; <nl> } <nl> <nl> / * <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> index 9759bcc . . 5f7da4f 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java <nl> @ @ - 32 , 7 + 32 , 7 @ @ public interface StorageServiceMBean <nl> public String getUnreachableNodes ( ) ; <nl> public String getToken ( ) ; <nl> public Map < Range , List < EndPoint > > getRangeToEndPointMap ( ) ; <nl> - public String getLoadInfo ( ) ; <nl> + public String getLoadString ( ) ; <nl> public int getCurrentGenerationNumber ( ) ; <nl> public void forceTableCompaction ( ) throws IOException ; <nl> <nl> diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> index 9bf3aa8 . . daf9190 100644 <nl> - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java <nl> @ @ - 227 , 18 + 227 , 7 @ @ public class NodeProbe <nl> { <nl> return ssProxy . getCurrentGenerationNumber ( ) ; <nl> } <nl> - <nl> - / * * <nl> - * Retrieve a textual representation of the on - disk size of data <nl> - * stored on this node . <nl> - * <nl> - * @ return the size description <nl> - * / <nl> - public String getLoadInfo ( ) <nl> - { <nl> - return ssProxy . getLoadInfo ( ) ; <nl> - } <nl> - <nl> + <nl> / * * <nl> * Trigger a cleanup of keys on all tables . <nl> * / <nl> @ @ - 444 , 7 + 433 , 7 @ @ public class NodeProbe <nl> public void printInfo ( PrintStream outs ) <nl> { <nl> outs . println ( getToken ( ) ) ; <nl> - outs . println ( String . format ( " % - 17s : % s " , " Load Info " , getLoadInfo ( ) ) ) ; <nl> + outs . println ( String . format ( " % - 17s : % s " , " Load " , ssProxy . getLoadString ( ) ) ) ; <nl> outs . println ( String . format ( " % - 17s : % s " , " Generation No " , getCurrentGenerationNumber ( ) ) ) ; <nl> <nl> / / Uptime

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / RowDataResolver . java b / src / java / org / apache / cassandra / service / RowDataResolver . java 
 index 5422d82 . . a10da2e 100644 
 - - - a / src / java / org / apache / cassandra / service / RowDataResolver . java 
 + + + b / src / java / org / apache / cassandra / service / RowDataResolver . java 
 @ @ - 92 , 7 + 92 , 7 @ @ public class RowDataResolver extends AbstractRowResolver 
 } 
 else 
 { 
 - resolved = replies . iterator ( ) . next ( ) . payload . row ( ) . cf ; 
 + resolved = replies . get ( 0 ) . payload . row ( ) . cf ; 
 } 
 
 if ( logger . isDebugEnabled ( ) ) 
 @ @ - 161 , 7 + 161 , 7 @ @ public class RowDataResolver extends AbstractRowResolver 
 
 public Row getData ( ) 
 { 
 - return replies . iterator ( ) . next ( ) . payload . row ( ) ; 
 + return replies . get ( 0 ) . payload . row ( ) ; 
 } 
 
 public boolean isDataPresent ( )

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / LoadDisseminator . java b / src / java / org / apache / cassandra / service / LoadDisseminator . java 
 index 622385f . . 9e9fd1f 100644 
 - - - a / src / java / org / apache / cassandra / service / LoadDisseminator . java 
 + + + b / src / java / org / apache / cassandra / service / LoadDisseminator . java 
 @ @ - 34 , 8 + 34 , 7 @ @ class LoadDisseminator extends TimerTask 
 { 
 try 
 { 
 - long diskSpace = FileUtils . getUsedDiskSpace ( ) ; 
 - String diskUtilization = FileUtils . stringifyFileSize ( diskSpace ) ; 
 + String diskUtilization = String . valueOf ( StorageService . instance ( ) . getLoad ( ) ) ; 
 if ( logger _ . isDebugEnabled ( ) ) 
 logger _ . debug ( " Disseminating load info . . . " ) ; 
 Gossiper . instance ( ) . addApplicationState ( LoadDisseminator . loadInfo _ , new ApplicationState ( diskUtilization ) ) ; 
 diff - - git a / src / java / org / apache / cassandra / service / StorageLoadBalancer . java b / src / java / org / apache / cassandra / service / StorageLoadBalancer . java 
 index 53ecdd1 . . f91a4aa 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageLoadBalancer . java 
 + + + b / src / java / org / apache / cassandra / service / StorageLoadBalancer . java 
 @ @ - 375 , 11 + 375 , 7 @ @ final class StorageLoadBalancer implements IEndPointStateChangeSubscriber 
 
 class MoveMessage implements Serializable 
 { 
 - private Token targetToken _ ; 
 - 
 - private MoveMessage ( ) 
 - { 
 - } 
 + private final Token targetToken _ ; 
 
 MoveMessage ( Token targetToken ) 
 { 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index a22edae . . 1e73051 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 498 , 24 + 498 , 16 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto 
 } 
 } 
 
 - / * * 
 - * Get the count of primary keys from the sampler . 
 - * / 
 - public String getLoadInfo ( ) 
 + / * * raw load value * / 
 + public double getLoad ( ) 
 { 
 - long diskSpace = FileUtils . getUsedDiskSpace ( ) ; 
 - 	 return FileUtils . stringifyFileSize ( diskSpace ) ; 
 + return FileUtils . getUsedDiskSpace ( ) ; 
 } 
 
 - / * * 
 - * Get the primary count info for this endpoint . 
 - * This is gossiped around and cached in the 
 - * StorageLoadBalancer . 
 - * / 
 - public String getLoadInfo ( EndPoint ep ) 
 + / * * Human - readable load value * / 
 + public String getLoadString ( ) 
 { 
 - LoadInfo li = storageLoadBalancer _ . getLoad ( ep ) ; 
 - return ( li = = null ) ? " N / A " : li . toString ( ) ; 
 + return FileUtils . stringifyFileSize ( FileUtils . getUsedDiskSpace ( ) ) ; 
 } 
 
 / * 
 diff - - git a / src / java / org / apache / cassandra / service / StorageServiceMBean . java b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 index 9759bcc . . 5f7da4f 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 + + + b / src / java / org / apache / cassandra / service / StorageServiceMBean . java 
 @ @ - 32 , 7 + 32 , 7 @ @ public interface StorageServiceMBean 
 public String getUnreachableNodes ( ) ; 
 public String getToken ( ) ; 
 public Map < Range , List < EndPoint > > getRangeToEndPointMap ( ) ; 
 - public String getLoadInfo ( ) ; 
 + public String getLoadString ( ) ; 
 public int getCurrentGenerationNumber ( ) ; 
 public void forceTableCompaction ( ) throws IOException ; 
 
 diff - - git a / src / java / org / apache / cassandra / tools / NodeProbe . java b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 index 9bf3aa8 . . daf9190 100644 
 - - - a / src / java / org / apache / cassandra / tools / NodeProbe . java 
 + + + b / src / java / org / apache / cassandra / tools / NodeProbe . java 
 @ @ - 227 , 18 + 227 , 7 @ @ public class NodeProbe 
 { 
 return ssProxy . getCurrentGenerationNumber ( ) ; 
 } 
 - 
 - / * * 
 - * Retrieve a textual representation of the on - disk size of data 
 - * stored on this node . 
 - * 
 - * @ return the size description 
 - * / 
 - public String getLoadInfo ( ) 
 - { 
 - return ssProxy . getLoadInfo ( ) ; 
 - } 
 - 
 + 
 / * * 
 * Trigger a cleanup of keys on all tables . 
 * / 
 @ @ - 444 , 7 + 433 , 7 @ @ public class NodeProbe 
 public void printInfo ( PrintStream outs ) 
 { 
 outs . println ( getToken ( ) ) ; 
 - outs . println ( String . format ( " % - 17s : % s " , " Load Info " , getLoadInfo ( ) ) ) ; 
 + outs . println ( String . format ( " % - 17s : % s " , " Load " , ssProxy . getLoadString ( ) ) ) ; 
 outs . println ( String . format ( " % - 17s : % s " , " Generation No " , getCurrentGenerationNumber ( ) ) ) ; 
 
 / / Uptime
