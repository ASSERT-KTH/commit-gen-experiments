BLEU SCORE: 0.015542791893293221

TEST MSG: Stronger assertion on null hostId in SP : : writeHintForMutation
GENERATED MSG: StorageProxy throws NPEs for when there ' s no hostids for a target

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> index 161bec8 . . f8b4f1c 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageProxy . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> @ @ - 984 , 7 + 984 , 11 @ @ public class StorageProxy implements StorageProxyMBean <nl> { <nl> assert ttl > 0 ; <nl> UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( target ) ; <nl> - assert hostId ! = null : " Missing host ID for " + target . getHostAddress ( ) ; <nl> + if ( hostId = = null ) <nl> + { <nl> + logger . warn ( " Missing host Id for { } " , target . getHostAddress ( ) ) ; <nl> + throw new AssertionError ( " Missing host Id for " + target . getHostAddress ( ) ) ; <nl> + } <nl> HintedHandOffManager . instance . hintFor ( mutation , now , ttl , hostId ) . apply ( ) ; <nl> StorageMetrics . totalHints . inc ( ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> index 10189a0 . . 9fad95a 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageProxy . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> @ @ - 362 , 11 + 362 , 8 @ @ public class StorageProxy implements StorageProxyMBean <nl> try <nl> { <nl> UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( target ) ; <nl> - if ( hostId = = null ) / / The node in question will not have a host id if older than MessagingService . VERSION _ 12 in a mixed version cluster <nl> - { <nl> - logger . warn ( " Unable to store hint for host with missing ID , { } ( old node ? ) " , target . toString ( ) ) ; <nl> - return ; <nl> - } <nl> + if ( ( hostId = = null ) & & ( Gossiper . instance . getVersion ( target ) < MessagingService . VERSION _ 12 ) ) <nl> + logger . info ( " Unable to store hint for host with missing ID , { } ( old node ? ) " , target . toString ( ) ) ; <nl> RowMutation hintedMutation = RowMutation . hintFor ( mutation , ByteBuffer . wrap ( UUIDGen . decompose ( hostId ) ) ) ; <nl> hintedMutation . apply ( ) ; <nl>

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java 
 index 161bec8 . . f8b4f1c 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageProxy . java 
 + + + b / src / java / org / apache / cassandra / service / StorageProxy . java 
 @ @ - 984 , 7 + 984 , 11 @ @ public class StorageProxy implements StorageProxyMBean 
 { 
 assert ttl > 0 ; 
 UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( target ) ; 
 - assert hostId ! = null : " Missing host ID for " + target . getHostAddress ( ) ; 
 + if ( hostId = = null ) 
 + { 
 + logger . warn ( " Missing host Id for { } " , target . getHostAddress ( ) ) ; 
 + throw new AssertionError ( " Missing host Id for " + target . getHostAddress ( ) ) ; 
 + } 
 HintedHandOffManager . instance . hintFor ( mutation , now , ttl , hostId ) . apply ( ) ; 
 StorageMetrics . totalHints . inc ( ) ; 
 }

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java 
 index 10189a0 . . 9fad95a 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageProxy . java 
 + + + b / src / java / org / apache / cassandra / service / StorageProxy . java 
 @ @ - 362 , 11 + 362 , 8 @ @ public class StorageProxy implements StorageProxyMBean 
 try 
 { 
 UUID hostId = StorageService . instance . getTokenMetadata ( ) . getHostId ( target ) ; 
 - if ( hostId = = null ) / / The node in question will not have a host id if older than MessagingService . VERSION _ 12 in a mixed version cluster 
 - { 
 - logger . warn ( " Unable to store hint for host with missing ID , { } ( old node ? ) " , target . toString ( ) ) ; 
 - return ; 
 - } 
 + if ( ( hostId = = null ) & & ( Gossiper . instance . getVersion ( target ) < MessagingService . VERSION _ 12 ) ) 
 + logger . info ( " Unable to store hint for host with missing ID , { } ( old node ? ) " , target . toString ( ) ) ; 
 RowMutation hintedMutation = RowMutation . hintFor ( mutation , ByteBuffer . wrap ( UUIDGen . decompose ( hostId ) ) ) ; 
 hintedMutation . apply ( ) ; 

