BLEU SCORE: 0.040583489434387374

TEST MSG: Properly reject operations on list index
GENERATED MSG: Validate statements inside batch

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 94169c1 . . f489702 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 10 <nl> + * Properly reject operations on list index with conditions ( CASSANDRA - 7499 ) <nl> * ( Hadoop ) allow ACFRW to limit nodes to local DC ( CASSANDRA - 7252 ) <nl> * ( cqlsh ) Wait up to 10 sec for a tracing session ( CASSANDRA - 7222 ) <nl> * Fix NPE in FileCacheService . sizeInBytes ( CASSANDRA - 7756 ) <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java b / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java <nl> index 8fc1ecc . . cbe3016 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java <nl> @ @ - 125 , 6 + 125 , 9 @ @ public class BatchStatement implements CQLStatement , MeasurableForPreparedCache <nl> throw new InvalidRequestException ( " Timestamp must be set either on BATCH or individual statements " ) ; <nl> <nl> statement . validate ( state ) ; <nl> + <nl> + if ( hasConditions & & statement . requiresRead ( ) ) <nl> + throw new InvalidRequestException ( " Operations using list indexes are not allowed with IF conditions " ) ; <nl> } <nl> } <nl> <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> index 11aa0b1 . . 99dd9d9 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> @ @ - 151 , 8 + 151 , 14 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF <nl> <nl> public void validate ( ClientState state ) throws InvalidRequestException <nl> { <nl> - if ( hasConditions ( ) & & attrs . isTimestampSet ( ) ) <nl> - throw new InvalidRequestException ( " Cannot provide custom timestamp for conditional update " ) ; <nl> + if ( hasConditions ( ) ) <nl> + { <nl> + if ( attrs . isTimestampSet ( ) ) <nl> + throw new InvalidRequestException ( " Cannot provide custom timestamp for conditional update " ) ; <nl> + <nl> + if ( requiresRead ( ) ) <nl> + throw new InvalidRequestException ( " Operations using list indexes are not allowed with IF conditions " ) ; <nl> + } <nl> <nl> if ( isCounter ( ) ) <nl> { <nl> @ @ - 439 , 6 + 445 , 14 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF <nl> return null ; <nl> } <nl> <nl> + public boolean requiresRead ( ) <nl> + { <nl> + for ( Operation op : columnOperations ) <nl> + if ( op . requiresRead ( ) ) <nl> + return true ; <nl> + return false ; <nl> + } <nl> + <nl> protected Map < ByteBuffer , ColumnGroupMap > readRequiredRows ( Collection < ByteBuffer > partitionKeys , ColumnNameBuilder clusteringPrefix , boolean local , ConsistencyLevel cl ) <nl> throws RequestExecutionException , RequestValidationException <nl> {
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 94169c1 . . f489702 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 10 
 + * Properly reject operations on list index with conditions ( CASSANDRA - 7499 ) 
 * ( Hadoop ) allow ACFRW to limit nodes to local DC ( CASSANDRA - 7252 ) 
 * ( cqlsh ) Wait up to 10 sec for a tracing session ( CASSANDRA - 7222 ) 
 * Fix NPE in FileCacheService . sizeInBytes ( CASSANDRA - 7756 ) 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java b / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java 
 index 8fc1ecc . . cbe3016 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / BatchStatement . java 
 @ @ - 125 , 6 + 125 , 9 @ @ public class BatchStatement implements CQLStatement , MeasurableForPreparedCache 
 throw new InvalidRequestException ( " Timestamp must be set either on BATCH or individual statements " ) ; 
 
 statement . validate ( state ) ; 
 + 
 + if ( hasConditions & & statement . requiresRead ( ) ) 
 + throw new InvalidRequestException ( " Operations using list indexes are not allowed with IF conditions " ) ; 
 } 
 } 
 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 index 11aa0b1 . . 99dd9d9 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 @ @ - 151 , 8 + 151 , 14 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF 
 
 public void validate ( ClientState state ) throws InvalidRequestException 
 { 
 - if ( hasConditions ( ) & & attrs . isTimestampSet ( ) ) 
 - throw new InvalidRequestException ( " Cannot provide custom timestamp for conditional update " ) ; 
 + if ( hasConditions ( ) ) 
 + { 
 + if ( attrs . isTimestampSet ( ) ) 
 + throw new InvalidRequestException ( " Cannot provide custom timestamp for conditional update " ) ; 
 + 
 + if ( requiresRead ( ) ) 
 + throw new InvalidRequestException ( " Operations using list indexes are not allowed with IF conditions " ) ; 
 + } 
 
 if ( isCounter ( ) ) 
 { 
 @ @ - 439 , 6 + 445 , 14 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF 
 return null ; 
 } 
 
 + public boolean requiresRead ( ) 
 + { 
 + for ( Operation op : columnOperations ) 
 + if ( op . requiresRead ( ) ) 
 + return true ; 
 + return false ; 
 + } 
 + 
 protected Map < ByteBuffer , ColumnGroupMap > readRequiredRows ( Collection < ByteBuffer > partitionKeys , ColumnNameBuilder clusteringPrefix , boolean local , ConsistencyLevel cl ) 
 throws RequestExecutionException , RequestValidationException 
 {

NEAREST DIFF:
ELIMINATEDSENTENCE
