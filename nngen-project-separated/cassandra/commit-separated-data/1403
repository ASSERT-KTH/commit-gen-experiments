BLEU SCORE: 1.0

TEST MSG: Stop CommitLogTest hanging
GENERATED MSG: Stop CommitLogTest hanging

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java b / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java <nl> new file mode 100644 <nl> index 0000000 . . 235c9f1 <nl> - - - / dev / null <nl> + + + b / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java <nl> @ @ - 0 , 0 + 1 , 53 @ @ <nl> + / * <nl> + * Licensed to the Apache Software Foundation ( ASF ) under one <nl> + * or more contributor license agreements . See the NOTICE file <nl> + * distributed with this work for additional information <nl> + * regarding copyright ownership . The ASF licenses this file <nl> + * to you under the Apache License , Version 2 . 0 ( the <nl> + * " License " ) ; you may not use this file except in compliance <nl> + * with the License . You may obtain a copy of the License at <nl> + * <nl> + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 <nl> + * <nl> + * Unless required by applicable law or agreed to in writing , <nl> + * software distributed under the License is distributed on an <nl> + * " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY <nl> + * KIND , either express or implied . See the License for the <nl> + * specific language governing permissions and limitations <nl> + * under the License . <nl> + * / <nl> + <nl> + package org . apache . cassandra . db ; <nl> + <nl> + import org . junit . Assert ; <nl> + import org . junit . Test ; <nl> + <nl> + import org . apache . cassandra . config . Config ; <nl> + import org . apache . cassandra . config . DatabaseDescriptor ; <nl> + import org . apache . cassandra . db . commitlog . CommitLog ; <nl> + import org . apache . cassandra . exceptions . ConfigurationException ; <nl> + import org . apache . cassandra . gms . Gossiper ; <nl> + import org . apache . cassandra . service . StorageService ; <nl> + <nl> + public class CommitLogFailurePolicyTest <nl> + { <nl> + @ Test <nl> + public void testCommitFailurePolicy _ stop ( ) throws ConfigurationException <nl> + { <nl> + / / Need storage service active so stop policy can shutdown gossip <nl> + StorageService . instance . initServer ( ) ; <nl> + Assert . assertTrue ( Gossiper . instance . isEnabled ( ) ) ; <nl> + <nl> + Config . CommitFailurePolicy oldPolicy = DatabaseDescriptor . getCommitFailurePolicy ( ) ; <nl> + try <nl> + { <nl> + DatabaseDescriptor . setCommitFailurePolicy ( Config . CommitFailurePolicy . stop ) ; <nl> + CommitLog . handleCommitError ( " Test stop error " , new Throwable ( ) ) ; <nl> + Assert . assertFalse ( Gossiper . instance . isEnabled ( ) ) ; <nl> + } <nl> + finally <nl> + { <nl> + DatabaseDescriptor . setCommitFailurePolicy ( oldPolicy ) ; <nl> + } <nl> + } <nl> + } <nl> diff - - git a / test / unit / org / apache / cassandra / db / CommitLogTest . java b / test / unit / org / apache / cassandra / db / CommitLogTest . java <nl> index 289fbc9 . . 45cd30c 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / CommitLogTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / CommitLogTest . java <nl> @ @ - 23 , 26 + 23 , 23 @ @ import java . io . * ; <nl> import java . nio . ByteBuffer ; <nl> import java . util . UUID ; <nl> import java . util . concurrent . ExecutionException ; <nl> - import java . util . concurrent . TimeUnit ; <nl> import java . util . zip . CRC32 ; <nl> import java . util . zip . Checksum ; <nl> <nl> - import com . google . common . util . concurrent . Uninterruptibles ; <nl> import org . junit . Assert ; <nl> + import org . junit . BeforeClass ; <nl> import org . junit . Test ; <nl> <nl> import org . apache . cassandra . SchemaLoader ; <nl> import org . apache . cassandra . Util ; <nl> - import org . apache . cassandra . config . Config ; <nl> import org . apache . cassandra . config . DatabaseDescriptor ; <nl> import org . apache . cassandra . db . commitlog . CommitLog ; <nl> import org . apache . cassandra . db . commitlog . CommitLogDescriptor ; <nl> import org . apache . cassandra . db . commitlog . ReplayPosition ; <nl> + import org . apache . cassandra . db . compaction . CompactionManager ; <nl> import org . apache . cassandra . db . filter . NamesQueryFilter ; <nl> import org . apache . cassandra . exceptions . ConfigurationException ; <nl> - import org . apache . cassandra . gms . Gossiper ; <nl> import org . apache . cassandra . net . MessagingService ; <nl> - import org . apache . cassandra . service . StorageService ; <nl> import org . apache . cassandra . utils . ByteBufferUtil ; <nl> import org . apache . cassandra . utils . FBUtilities ; <nl> <nl> @ @ - 50 , 6 + 47 , 12 @ @ import static org . apache . cassandra . utils . ByteBufferUtil . bytes ; <nl> <nl> public class CommitLogTest extends SchemaLoader <nl> { <nl> + @ BeforeClass <nl> + public static void init ( ) throws ConfigurationException <nl> + { <nl> + CompactionManager . instance . disableAutoCompaction ( ) ; <nl> + } <nl> + <nl> @ Test <nl> public void testRecoveryWithEmptyLog ( ) throws Exception <nl> { <nl> @ @ - 239 , 26 + 242 , 6 @ @ public class CommitLogTest extends SchemaLoader <nl> } <nl> <nl> @ Test <nl> - public void testCommitFailurePolicy _ stop ( ) throws ConfigurationException <nl> - { <nl> - / / Need storage service active so stop policy can shutdown gossip <nl> - StorageService . instance . initServer ( ) ; <nl> - Assert . assertTrue ( Gossiper . instance . isEnabled ( ) ) ; <nl> - <nl> - Config . CommitFailurePolicy oldPolicy = DatabaseDescriptor . getCommitFailurePolicy ( ) ; <nl> - try <nl> - { <nl> - DatabaseDescriptor . setCommitFailurePolicy ( Config . CommitFailurePolicy . stop ) ; <nl> - CommitLog . handleCommitError ( " Test stop error " , new Throwable ( ) ) ; <nl> - Assert . assertFalse ( Gossiper . instance . isEnabled ( ) ) ; <nl> - } <nl> - finally <nl> - { <nl> - DatabaseDescriptor . setCommitFailurePolicy ( oldPolicy ) ; <nl> - } <nl> - } <nl> - <nl> - @ Test <nl> public void testTruncateWithoutSnapshot ( ) throws ExecutionException , InterruptedException <nl> { <nl> CommitLog . instance . resetUnsafe ( ) ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java b / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java 
 new file mode 100644 
 index 0000000 . . 235c9f1 
 - - - / dev / null 
 + + + b / test / unit / org / apache / cassandra / db / CommitLogFailurePolicyTest . java 
 @ @ - 0 , 0 + 1 , 53 @ @ 
 + / * 
 + * Licensed to the Apache Software Foundation ( ASF ) under one 
 + * or more contributor license agreements . See the NOTICE file 
 + * distributed with this work for additional information 
 + * regarding copyright ownership . The ASF licenses this file 
 + * to you under the Apache License , Version 2 . 0 ( the 
 + * " License " ) ; you may not use this file except in compliance 
 + * with the License . You may obtain a copy of the License at 
 + * 
 + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 
 + * 
 + * Unless required by applicable law or agreed to in writing , 
 + * software distributed under the License is distributed on an 
 + * " AS IS " BASIS , WITHOUT WARRANTIES OR CONDITIONS OF ANY 
 + * KIND , either express or implied . See the License for the 
 + * specific language governing permissions and limitations 
 + * under the License . 
 + * / 
 + 
 + package org . apache . cassandra . db ; 
 + 
 + import org . junit . Assert ; 
 + import org . junit . Test ; 
 + 
 + import org . apache . cassandra . config . Config ; 
 + import org . apache . cassandra . config . DatabaseDescriptor ; 
 + import org . apache . cassandra . db . commitlog . CommitLog ; 
 + import org . apache . cassandra . exceptions . ConfigurationException ; 
 + import org . apache . cassandra . gms . Gossiper ; 
 + import org . apache . cassandra . service . StorageService ; 
 + 
 + public class CommitLogFailurePolicyTest 
 + { 
 + @ Test 
 + public void testCommitFailurePolicy _ stop ( ) throws ConfigurationException 
 + { 
 + / / Need storage service active so stop policy can shutdown gossip 
 + StorageService . instance . initServer ( ) ; 
 + Assert . assertTrue ( Gossiper . instance . isEnabled ( ) ) ; 
 + 
 + Config . CommitFailurePolicy oldPolicy = DatabaseDescriptor . getCommitFailurePolicy ( ) ; 
 + try 
 + { 
 + DatabaseDescriptor . setCommitFailurePolicy ( Config . CommitFailurePolicy . stop ) ; 
 + CommitLog . handleCommitError ( " Test stop error " , new Throwable ( ) ) ; 
 + Assert . assertFalse ( Gossiper . instance . isEnabled ( ) ) ; 
 + } 
 + finally 
 + { 
 + DatabaseDescriptor . setCommitFailurePolicy ( oldPolicy ) ; 
 + } 
 + } 
 + } 
 diff - - git a / test / unit / org / apache / cassandra / db / CommitLogTest . java b / test / unit / org / apache / cassandra / db / CommitLogTest . java 
 index 289fbc9 . . 45cd30c 100644 
 - - - a / test / unit / org / apache / cassandra / db / CommitLogTest . java 
 + + + b / test / unit / org / apache / cassandra / db / CommitLogTest . java 
 @ @ - 23 , 26 + 23 , 23 @ @ import java . io . * ; 
 import java . nio . ByteBuffer ; 
 import java . util . UUID ; 
 import java . util . concurrent . ExecutionException ; 
 - import java . util . concurrent . TimeUnit ; 
 import java . util . zip . CRC32 ; 
 import java . util . zip . Checksum ; 
 
 - import com . google . common . util . concurrent . Uninterruptibles ; 
 import org . junit . Assert ; 
 + import org . junit . BeforeClass ; 
 import org . junit . Test ; 
 
 import org . apache . cassandra . SchemaLoader ; 
 import org . apache . cassandra . Util ; 
 - import org . apache . cassandra . config . Config ; 
 import org . apache . cassandra . config . DatabaseDescriptor ; 
 import org . apache . cassandra . db . commitlog . CommitLog ; 
 import org . apache . cassandra . db . commitlog . CommitLogDescriptor ; 
 import org . apache . cassandra . db . commitlog . ReplayPosition ; 
 + import org . apache . cassandra . db . compaction . CompactionManager ; 
 import org . apache . cassandra . db . filter . NamesQueryFilter ; 
 import org . apache . cassandra . exceptions . ConfigurationException ; 
 - import org . apache . cassandra . gms . Gossiper ; 
 import org . apache . cassandra . net . MessagingService ; 
 - import org . apache . cassandra . service . StorageService ; 
 import org . apache . cassandra . utils . ByteBufferUtil ; 
 import org . apache . cassandra . utils . FBUtilities ; 
 
 @ @ - 50 , 6 + 47 , 12 @ @ import static org . apache . cassandra . utils . ByteBufferUtil . bytes ; 
 
 public class CommitLogTest extends SchemaLoader 
 { 
 + @ BeforeClass 
 + public static void init ( ) throws ConfigurationException 
 + { 
 + CompactionManager . instance . disableAutoCompaction ( ) ; 
 + } 
 + 
 @ Test 
 public void testRecoveryWithEmptyLog ( ) throws Exception 
 { 
 @ @ - 239 , 26 + 242 , 6 @ @ public class CommitLogTest extends SchemaLoader 
 } 
 
 @ Test 
 - public void testCommitFailurePolicy _ stop ( ) throws ConfigurationException 
 - { 
 - / / Need storage service active so stop policy can shutdown gossip 
 - StorageService . instance . initServer ( ) ; 
 - Assert . assertTrue ( Gossiper . instance . isEnabled ( ) ) ; 
 - 
 - Config . CommitFailurePolicy oldPolicy = DatabaseDescriptor . getCommitFailurePolicy ( ) ; 
 - try 
 - { 
 - DatabaseDescriptor . setCommitFailurePolicy ( Config . CommitFailurePolicy . stop ) ; 
 - CommitLog . handleCommitError ( " Test stop error " , new Throwable ( ) ) ; 
 - Assert . assertFalse ( Gossiper . instance . isEnabled ( ) ) ; 
 - } 
 - finally 
 - { 
 - DatabaseDescriptor . setCommitFailurePolicy ( oldPolicy ) ; 
 - } 
 - } 
 - 
 - @ Test 
 public void testTruncateWithoutSnapshot ( ) throws ExecutionException , InterruptedException 
 { 
 CommitLog . instance . resetUnsafe ( ) ;

NEAREST DIFF:
ELIMINATEDSENTENCE
