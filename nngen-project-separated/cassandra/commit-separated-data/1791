BLEU SCORE: 0.05522397783539471

TEST MSG: Match estimated tasks arithmetic to score in LCS
GENERATED MSG: Compute more accurate compaction score per level

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 8843908 . . 65f2da4 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 14 : <nl> + * Improve compaction estimated tasks estimation ( CASSANDRA - 8904 ) <nl> * Fix duplicate up / down messages sent to native clients ( CASSANDRA - 7816 ) <nl> * Expose commit log archive status via JMX ( CASSANDRA - 8734 ) <nl> * Provide better exceptions for invalid replication strategy parameters <nl> diff - - git a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> index aefd573 . . 6554eb2 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> @ @ - 623 , 7 + 623 , 8 @ @ public class LeveledManifest <nl> for ( int i = generations . length - 1 ; i > = 0 ; i - - ) <nl> { <nl> List < SSTableReader > sstables = generations [ i ] ; <nl> - estimated [ i ] = Math . max ( 0L , SSTableReader . getTotalBytes ( sstables ) - maxBytesForLevel ( i ) ) / maxSSTableSizeInBytes ; <nl> + 	 / / If there is 1 byte over TBL - ( MBL * 1 . 001 ) , there is still a task left , so we need to round up . <nl> + 	 estimated [ i ] = ( long ) Math . ceil ( ( double ) Math . max ( 0L , SSTableReader . getTotalBytes ( sstables ) - ( long ) ( maxBytesForLevel ( i ) * 1 . 001 ) ) / ( double ) maxSSTableSizeInBytes ) ; <nl> tasks + = estimated [ i ] ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / ClientState . java b / src / java / org / apache / cassandra / service / ClientState . java <nl> index c66d99f . . 603e51a 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ClientState . java <nl> + + + b / src / java / org / apache / cassandra / service / ClientState . java <nl> @ @ - 20 , 7 + 20 , 6 @ @ package org . apache . cassandra . service ; <nl> <nl> import java . util . * ; <nl> <nl> - import com . google . common . collect . Sets ; <nl> import org . apache . commons . lang . StringUtils ; <nl> import org . slf4j . Logger ; <nl> import org . slf4j . LoggerFactory ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 8843908 . . 65f2da4 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 14 : 
 + * Improve compaction estimated tasks estimation ( CASSANDRA - 8904 ) 
 * Fix duplicate up / down messages sent to native clients ( CASSANDRA - 7816 ) 
 * Expose commit log archive status via JMX ( CASSANDRA - 8734 ) 
 * Provide better exceptions for invalid replication strategy parameters 
 diff - - git a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 index aefd573 . . 6554eb2 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 @ @ - 623 , 7 + 623 , 8 @ @ public class LeveledManifest 
 for ( int i = generations . length - 1 ; i > = 0 ; i - - ) 
 { 
 List < SSTableReader > sstables = generations [ i ] ; 
 - estimated [ i ] = Math . max ( 0L , SSTableReader . getTotalBytes ( sstables ) - maxBytesForLevel ( i ) ) / maxSSTableSizeInBytes ; 
 + 	 / / If there is 1 byte over TBL - ( MBL * 1 . 001 ) , there is still a task left , so we need to round up . 
 + 	 estimated [ i ] = ( long ) Math . ceil ( ( double ) Math . max ( 0L , SSTableReader . getTotalBytes ( sstables ) - ( long ) ( maxBytesForLevel ( i ) * 1 . 001 ) ) / ( double ) maxSSTableSizeInBytes ) ; 
 tasks + = estimated [ i ] ; 
 } 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / ClientState . java b / src / java / org / apache / cassandra / service / ClientState . java 
 index c66d99f . . 603e51a 100644 
 - - - a / src / java / org / apache / cassandra / service / ClientState . java 
 + + + b / src / java / org / apache / cassandra / service / ClientState . java 
 @ @ - 20 , 7 + 20 , 6 @ @ package org . apache . cassandra . service ; 
 
 import java . util . * ; 
 
 - import com . google . common . collect . Sets ; 
 import org . apache . commons . lang . StringUtils ; 
 import org . slf4j . Logger ; 
 import org . slf4j . LoggerFactory ;
