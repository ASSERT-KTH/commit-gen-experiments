BLEU SCORE: 0.01898400888797787

TEST MSG: don ' t declare throwing exceptions that aren ' t
GENERATED MSG: avoid streaming empty files with bulk loader if sstablewriter errors out

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> index bc9f2ca . . 2dcbe3d 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> @ @ - 124 , 7 + 124 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> sync ( ) ; <nl> } <nl> <nl> - protected ColumnFamily getColumnFamily ( ) throws IOException <nl> + protected ColumnFamily getColumnFamily ( ) <nl> { <nl> ColumnFamily previous = buffer . get ( currentKey ) ; <nl> / / If the CF already exist in memory , we ' ll just continue adding to it <nl> @ @ - 142 , 7 + 142 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> return previous ; <nl> } <nl> <nl> - protected ColumnFamily createColumnFamily ( ) throws IOException <nl> + protected ColumnFamily createColumnFamily ( ) <nl> { <nl> return ArrayBackedSortedColumns . factory . create ( metadata ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index f11af3d . . 720289f 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 6 + 1 , 9 @ @ <nl> 1 . 1 - dev <nl> * Allow KS and CF names up to 48 characters ( CASSANDRA - 4157 ) <nl> * Add support for CL . TWO and CL . THREE in CQL ( CASSANDRA - 4156 ) <nl> + Merged from 1 . 0 : <nl> + * avoid streaming empty files with bulk loader if sstablewriter errors out <nl> + ( CASSANDRA - 3946 ) <nl> <nl> <nl> 1 . 1 - rc1 <nl> @ @ - 21 , 6 + 24 , 7 @ @ <nl> * Move CfDef and KsDef validation out of thrift ( CASSANDRA - 4037 ) <nl> * Fix get _ paged _ slice ( CASSANDRA - 4136 ) <nl> * CQL3 : Support slice with exclusive start and stop ( CASSANDRA - 3785 ) <nl> + Merged from 1 . 0 : <nl> * support PropertyFileSnitch in bulk loader ( CASSANDRA - 4145 ) <nl> * add auto _ snapshot option allowing disabling snapshot before drop / truncate <nl> ( CASSANDRA - 3710 ) <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java b / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java <nl> index ed76a4c . . cd48801 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java <nl> @ @ - 81 , 7 + 81 , 7 @ @ public abstract class AbstractSSTableSimpleWriter <nl> int maxGen = 0 ; <nl> for ( Descriptor desc : existing ) <nl> maxGen = Math . max ( maxGen , desc . generation ) ; <nl> - return new Descriptor ( directory , keyspace , columnFamily , maxGen + 1 , false ) . filenameFor ( Component . DATA ) ; <nl> + return new Descriptor ( directory , keyspace , columnFamily , maxGen + 1 , true ) . filenameFor ( Component . DATA ) ; <nl> } <nl> <nl> / * * <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> index 9a69ba3 . . fd9d3e1 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java <nl> @ @ - 169 , 6 + 169 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> <nl> public void run ( ) <nl> { <nl> + SSTableWriter writer = null ; <nl> try <nl> { <nl> while ( true ) <nl> @ @ - 177 , 7 + 178 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> if ( b = = SENTINEL ) <nl> return ; <nl> <nl> - SSTableWriter writer = getWriter ( ) ; <nl> + writer = getWriter ( ) ; <nl> for ( Map . Entry < DecoratedKey , ColumnFamily > entry : b . entrySet ( ) ) <nl> writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; <nl> writer . closeAndOpenReader ( ) ; <nl> @ @ - 185 , 6 + 186 , 8 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter <nl> } <nl> catch ( Exception e ) <nl> { <nl> + if ( writer ! = null ) <nl> + writer . abort ( ) ; <nl> exception = e ; <nl> } <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java <nl> index d9a2b6e . . 1af2893 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java <nl> @ @ - 69 , 9 + 69 , 17 @ @ public class SSTableSimpleWriter extends AbstractSSTableSimpleWriter <nl> <nl> public void close ( ) throws IOException <nl> { <nl> - if ( currentKey ! = null ) <nl> - writeRow ( currentKey , columnFamily ) ; <nl> - writer . closeAndOpenReader ( ) ; <nl> + try <nl> + { <nl> + if ( currentKey ! = null ) <nl> + writeRow ( currentKey , columnFamily ) ; <nl> + writer . closeAndOpenReader ( ) ; <nl> + } <nl> + catch ( IOException e ) <nl> + { <nl> + writer . abort ( ) ; <nl> + throw e ; <nl> + } <nl> } <nl> <nl> protected void writeRow ( DecoratedKey key , ColumnFamily columnFamily ) throws IOException

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 index bc9f2ca . . 2dcbe3d 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 @ @ - 124 , 7 + 124 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 sync ( ) ; 
 } 
 
 - protected ColumnFamily getColumnFamily ( ) throws IOException 
 + protected ColumnFamily getColumnFamily ( ) 
 { 
 ColumnFamily previous = buffer . get ( currentKey ) ; 
 / / If the CF already exist in memory , we ' ll just continue adding to it 
 @ @ - 142 , 7 + 142 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 return previous ; 
 } 
 
 - protected ColumnFamily createColumnFamily ( ) throws IOException 
 + protected ColumnFamily createColumnFamily ( ) 
 { 
 return ArrayBackedSortedColumns . factory . create ( metadata ) ; 
 }

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index f11af3d . . 720289f 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 6 + 1 , 9 @ @ 
 1 . 1 - dev 
 * Allow KS and CF names up to 48 characters ( CASSANDRA - 4157 ) 
 * Add support for CL . TWO and CL . THREE in CQL ( CASSANDRA - 4156 ) 
 + Merged from 1 . 0 : 
 + * avoid streaming empty files with bulk loader if sstablewriter errors out 
 + ( CASSANDRA - 3946 ) 
 
 
 1 . 1 - rc1 
 @ @ - 21 , 6 + 24 , 7 @ @ 
 * Move CfDef and KsDef validation out of thrift ( CASSANDRA - 4037 ) 
 * Fix get _ paged _ slice ( CASSANDRA - 4136 ) 
 * CQL3 : Support slice with exclusive start and stop ( CASSANDRA - 3785 ) 
 + Merged from 1 . 0 : 
 * support PropertyFileSnitch in bulk loader ( CASSANDRA - 4145 ) 
 * add auto _ snapshot option allowing disabling snapshot before drop / truncate 
 ( CASSANDRA - 3710 ) 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java b / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java 
 index ed76a4c . . cd48801 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / AbstractSSTableSimpleWriter . java 
 @ @ - 81 , 7 + 81 , 7 @ @ public abstract class AbstractSSTableSimpleWriter 
 int maxGen = 0 ; 
 for ( Descriptor desc : existing ) 
 maxGen = Math . max ( maxGen , desc . generation ) ; 
 - return new Descriptor ( directory , keyspace , columnFamily , maxGen + 1 , false ) . filenameFor ( Component . DATA ) ; 
 + return new Descriptor ( directory , keyspace , columnFamily , maxGen + 1 , true ) . filenameFor ( Component . DATA ) ; 
 } 
 
 / * * 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 index 9a69ba3 . . fd9d3e1 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleUnsortedWriter . java 
 @ @ - 169 , 6 + 169 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 
 public void run ( ) 
 { 
 + SSTableWriter writer = null ; 
 try 
 { 
 while ( true ) 
 @ @ - 177 , 7 + 178 , 7 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 if ( b = = SENTINEL ) 
 return ; 
 
 - SSTableWriter writer = getWriter ( ) ; 
 + writer = getWriter ( ) ; 
 for ( Map . Entry < DecoratedKey , ColumnFamily > entry : b . entrySet ( ) ) 
 writer . append ( entry . getKey ( ) , entry . getValue ( ) ) ; 
 writer . closeAndOpenReader ( ) ; 
 @ @ - 185 , 6 + 186 , 8 @ @ public class SSTableSimpleUnsortedWriter extends AbstractSSTableSimpleWriter 
 } 
 catch ( Exception e ) 
 { 
 + if ( writer ! = null ) 
 + writer . abort ( ) ; 
 exception = e ; 
 } 
 } 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java 
 index d9a2b6e . . 1af2893 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableSimpleWriter . java 
 @ @ - 69 , 9 + 69 , 17 @ @ public class SSTableSimpleWriter extends AbstractSSTableSimpleWriter 
 
 public void close ( ) throws IOException 
 { 
 - if ( currentKey ! = null ) 
 - writeRow ( currentKey , columnFamily ) ; 
 - writer . closeAndOpenReader ( ) ; 
 + try 
 + { 
 + if ( currentKey ! = null ) 
 + writeRow ( currentKey , columnFamily ) ; 
 + writer . closeAndOpenReader ( ) ; 
 + } 
 + catch ( IOException e ) 
 + { 
 + writer . abort ( ) ; 
 + throw e ; 
 + } 
 } 
 
 protected void writeRow ( DecoratedKey key , ColumnFamily columnFamily ) throws IOException
