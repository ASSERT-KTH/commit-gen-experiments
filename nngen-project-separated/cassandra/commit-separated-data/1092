BLEU SCORE: 0.016932492841722675

TEST MSG: guard against legacy migration failure due to non - existent index name
GENERATED MSG: merge from 1 . 1

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java b / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java <nl> index 9008cc8 . . de48256 100644 <nl> - - - a / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java <nl> + + + b / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java <nl> @ @ - 628 , 21 + 628 , 26 @ @ public final class LegacySchemaMigrator <nl> if ( row . has ( " index _ options " ) ) <nl> indexOptions = fromJsonMap ( row . getString ( " index _ options " ) ) ; <nl> <nl> - String indexName = null ; <nl> - if ( row . has ( " index _ name " ) ) <nl> - indexName = row . getString ( " index _ name " ) ; <nl> - <nl> - ColumnDefinition column = createColumnFromColumnRow ( row , <nl> - keyspace , <nl> - table , <nl> - rawComparator , <nl> - rawSubComparator , <nl> - isSuper , <nl> - isCQLTable , <nl> - isStaticCompactTable , <nl> - needsUpgrade ) ; <nl> - <nl> - indexes . add ( IndexMetadata . fromLegacyMetadata ( cfm , column , indexName , kind , indexOptions ) ) ; <nl> + if ( row . has ( " index _ name " ) ) <nl> + { <nl> + String indexName = row . getString ( " index _ name " ) ; <nl> + <nl> + ColumnDefinition column = createColumnFromColumnRow ( row , <nl> + keyspace , <nl> + table , <nl> + rawComparator , <nl> + rawSubComparator , <nl> + isSuper , <nl> + isCQLTable , <nl> + isStaticCompactTable , <nl> + needsUpgrade ) ; <nl> + <nl> + indexes . add ( IndexMetadata . fromLegacyMetadata ( cfm , column , indexName , kind , indexOptions ) ) ; <nl> + } <nl> + else <nl> + { <nl> + logger . error ( " Failed to find index name for legacy migration of index on { } . { } " , keyspace , table ) ; <nl> + } <nl> } <nl> <nl> return indexes . build ( ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index a83fbab . . e2dc046 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> { <nl> Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; <nl> InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; <nl> - scheduleHintDelivery ( target ) ; <nl> + / / token may have since been removed ( in which case we have just read back a tombstone ) <nl> + if ( target ! = null ) <nl> + scheduleHintDelivery ( target ) ; <nl> } <nl> <nl> if ( logger _ . isDebugEnabled ( ) )

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java b / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java 
 index 9008cc8 . . de48256 100644 
 - - - a / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java 
 + + + b / src / java / org / apache / cassandra / schema / LegacySchemaMigrator . java 
 @ @ - 628 , 21 + 628 , 26 @ @ public final class LegacySchemaMigrator 
 if ( row . has ( " index _ options " ) ) 
 indexOptions = fromJsonMap ( row . getString ( " index _ options " ) ) ; 
 
 - String indexName = null ; 
 - if ( row . has ( " index _ name " ) ) 
 - indexName = row . getString ( " index _ name " ) ; 
 - 
 - ColumnDefinition column = createColumnFromColumnRow ( row , 
 - keyspace , 
 - table , 
 - rawComparator , 
 - rawSubComparator , 
 - isSuper , 
 - isCQLTable , 
 - isStaticCompactTable , 
 - needsUpgrade ) ; 
 - 
 - indexes . add ( IndexMetadata . fromLegacyMetadata ( cfm , column , indexName , kind , indexOptions ) ) ; 
 + if ( row . has ( " index _ name " ) ) 
 + { 
 + String indexName = row . getString ( " index _ name " ) ; 
 + 
 + ColumnDefinition column = createColumnFromColumnRow ( row , 
 + keyspace , 
 + table , 
 + rawComparator , 
 + rawSubComparator , 
 + isSuper , 
 + isCQLTable , 
 + isStaticCompactTable , 
 + needsUpgrade ) ; 
 + 
 + indexes . add ( IndexMetadata . fromLegacyMetadata ( cfm , column , indexName , kind , indexOptions ) ) ; 
 + } 
 + else 
 + { 
 + logger . error ( " Failed to find index name for legacy migration of index on { } . { } " , keyspace , table ) ; 
 + } 
 } 
 
 return indexes . build ( ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index a83fbab . . e2dc046 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 { 
 Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; 
 InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; 
 - scheduleHintDelivery ( target ) ; 
 + / / token may have since been removed ( in which case we have just read back a tombstone ) 
 + if ( target ! = null ) 
 + scheduleHintDelivery ( target ) ; 
 } 
 
 if ( logger _ . isDebugEnabled ( ) )
