BLEU SCORE: 0.015445276590783498

TEST MSG: Fix min / max cell name collection with 2 . 0 range tombstones
GENERATED MSG: Remove dead sliced _ buffer _ size _ in _ kb option

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 7823f87 . . c2ae6dc 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 6 @ @ <nl> 2 . 1 . 0 - final <nl> + * Fix min / max cell name collection on 2 . 0 SSTables with range <nl> + tombstones ( CASSANDRA - 7593 ) <nl> * Tolerate min / max cell names of different lengths ( CASSANDRA - 7651 ) <nl> * Filter cached results correctly ( CASSANDRA - 7636 ) <nl> * Fix tracing on the new SEPExecutor ( CASSANDRA - 7644 ) <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java b / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java <nl> index d390518 . . f74b86f 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java <nl> @ @ - 64 , 7 + 64 , 7 @ @ public class ColumnNameHelper <nl> { <nl> / / For a cell name , no reason to look more than the clustering prefix <nl> / / ( and comparing the collection element would actually crash ) <nl> - int size = candidate instanceof CellName ? ( ( CellName ) candidate ) . clusteringSize ( ) : candidate . size ( ) ; <nl> + int size = Math . min ( candidate . size ( ) , comparator . clusteringPrefixSize ( ) ) ; <nl> <nl> if ( maxSeen . isEmpty ( ) ) <nl> return getComponents ( candidate , size ) ; <nl> @ @ - 92 , 7 + 92 , 7 @ @ public class ColumnNameHelper <nl> { <nl> / / For a cell name , no reason to look more than the clustering prefix <nl> / / ( and comparing the collection element would actually crash ) <nl> - int size = candidate instanceof CellName ? ( ( CellName ) candidate ) . clusteringSize ( ) : candidate . size ( ) ; <nl> + int size = Math . min ( candidate . size ( ) , comparator . clusteringPrefixSize ( ) ) ; <nl> <nl> if ( minSeen . isEmpty ( ) ) <nl> return getComponents ( candidate , size ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 438bc91 . . bf1a34f 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 15 , 7 + 15 , 8 @ @ <nl> tasks and upgradesstables ( CASSANDRA - 3985 ) <nl> * fix NPE on invalid CQL delete command ( CASSANDRA - 3755 ) <nl> * allow custom types in CLI ' s assume command ( CASSANDRA - 4081 ) <nl> - * Fix totalBytes count for parallel compactions ( CASSANDRA - 3758 ) <nl> + * fix totalBytes count for parallel compactions ( CASSANDRA - 3758 ) <nl> + * fix intermittent NPE in get _ slice ( CASSANDRA - 4095 ) <nl> <nl> <nl> 1 . 0 . 8 <nl> diff - - git a / src / java / org / apache / cassandra / db / Row . java b / src / java / org / apache / cassandra / db / Row . java <nl> index 523f501 . . 71a7332 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Row . java <nl> + + + b / src / java / org / apache / cassandra / db / Row . java <nl> @ @ - 45 , 6 + 45 , 11 @ @ public class Row <nl> this . cf = cf ; <nl> } <nl> <nl> + public int getLiveColumnCount ( ) <nl> + { <nl> + return cf = = null ? 0 : cf . getLiveColumnCount ( ) ; <nl> + } <nl> + <nl> @ Override <nl> public String toString ( ) <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / db / SliceFromReadCommand . java b / src / java / org / apache / cassandra / db / SliceFromReadCommand . java <nl> index 4ea89b6 . . be73472 100644 <nl> - - - a / src / java / org / apache / cassandra / db / SliceFromReadCommand . java <nl> + + + b / src / java / org / apache / cassandra / db / SliceFromReadCommand . java <nl> @ @ - 73 , 7 + 73 , 7 @ @ public class SliceFromReadCommand extends ReadCommand <nl> public ReadCommand maybeGenerateRetryCommand ( RepairCallback handler , Row row ) <nl> { <nl> int maxLiveColumns = handler . getMaxLiveColumns ( ) ; <nl> - int liveColumnsInRow = row ! = null ? row . cf . getLiveColumnCount ( ) : 0 ; <nl> + int liveColumnsInRow = row ! = null ? row . getLiveColumnCount ( ) : 0 ; <nl> <nl> assert maxLiveColumns < = count ; <nl> / / We generate a retry if at least one node reply with count live columns but after merge we have less

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 7823f87 . . c2ae6dc 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 6 @ @ 
 2 . 1 . 0 - final 
 + * Fix min / max cell name collection on 2 . 0 SSTables with range 
 + tombstones ( CASSANDRA - 7593 ) 
 * Tolerate min / max cell names of different lengths ( CASSANDRA - 7651 ) 
 * Filter cached results correctly ( CASSANDRA - 7636 ) 
 * Fix tracing on the new SEPExecutor ( CASSANDRA - 7644 ) 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java b / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java 
 index d390518 . . f74b86f 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / ColumnNameHelper . java 
 @ @ - 64 , 7 + 64 , 7 @ @ public class ColumnNameHelper 
 { 
 / / For a cell name , no reason to look more than the clustering prefix 
 / / ( and comparing the collection element would actually crash ) 
 - int size = candidate instanceof CellName ? ( ( CellName ) candidate ) . clusteringSize ( ) : candidate . size ( ) ; 
 + int size = Math . min ( candidate . size ( ) , comparator . clusteringPrefixSize ( ) ) ; 
 
 if ( maxSeen . isEmpty ( ) ) 
 return getComponents ( candidate , size ) ; 
 @ @ - 92 , 7 + 92 , 7 @ @ public class ColumnNameHelper 
 { 
 / / For a cell name , no reason to look more than the clustering prefix 
 / / ( and comparing the collection element would actually crash ) 
 - int size = candidate instanceof CellName ? ( ( CellName ) candidate ) . clusteringSize ( ) : candidate . size ( ) ; 
 + int size = Math . min ( candidate . size ( ) , comparator . clusteringPrefixSize ( ) ) ; 
 
 if ( minSeen . isEmpty ( ) ) 
 return getComponents ( candidate , size ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 438bc91 . . bf1a34f 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 15 , 7 + 15 , 8 @ @ 
 tasks and upgradesstables ( CASSANDRA - 3985 ) 
 * fix NPE on invalid CQL delete command ( CASSANDRA - 3755 ) 
 * allow custom types in CLI ' s assume command ( CASSANDRA - 4081 ) 
 - * Fix totalBytes count for parallel compactions ( CASSANDRA - 3758 ) 
 + * fix totalBytes count for parallel compactions ( CASSANDRA - 3758 ) 
 + * fix intermittent NPE in get _ slice ( CASSANDRA - 4095 ) 
 
 
 1 . 0 . 8 
 diff - - git a / src / java / org / apache / cassandra / db / Row . java b / src / java / org / apache / cassandra / db / Row . java 
 index 523f501 . . 71a7332 100644 
 - - - a / src / java / org / apache / cassandra / db / Row . java 
 + + + b / src / java / org / apache / cassandra / db / Row . java 
 @ @ - 45 , 6 + 45 , 11 @ @ public class Row 
 this . cf = cf ; 
 } 
 
 + public int getLiveColumnCount ( ) 
 + { 
 + return cf = = null ? 0 : cf . getLiveColumnCount ( ) ; 
 + } 
 + 
 @ Override 
 public String toString ( ) 
 { 
 diff - - git a / src / java / org / apache / cassandra / db / SliceFromReadCommand . java b / src / java / org / apache / cassandra / db / SliceFromReadCommand . java 
 index 4ea89b6 . . be73472 100644 
 - - - a / src / java / org / apache / cassandra / db / SliceFromReadCommand . java 
 + + + b / src / java / org / apache / cassandra / db / SliceFromReadCommand . java 
 @ @ - 73 , 7 + 73 , 7 @ @ public class SliceFromReadCommand extends ReadCommand 
 public ReadCommand maybeGenerateRetryCommand ( RepairCallback handler , Row row ) 
 { 
 int maxLiveColumns = handler . getMaxLiveColumns ( ) ; 
 - int liveColumnsInRow = row ! = null ? row . cf . getLiveColumnCount ( ) : 0 ; 
 + int liveColumnsInRow = row ! = null ? row . getLiveColumnCount ( ) : 0 ; 
 
 assert maxLiveColumns < = count ; 
 / / We generate a retry if at least one node reply with count live columns but after merge we have less
