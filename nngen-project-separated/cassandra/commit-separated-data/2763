BLEU SCORE: 0.10682175159905853

TEST MSG: merge from 2 . 0
GENERATED MSG: merge

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 745e50b . . 4f0e5a5 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 32 , 6 + 32 , 7 @ @ <nl> * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) <nl> * Correctly handle null with IF conditions and TTL ( CASSANDRA - 6623 ) <nl> Merged from 1 . 2 : <nl> + * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) <nl> * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) <nl> <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> index a508a15 . . 70c3d6b 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java <nl> @ @ - 67 , 7 + 67 , 7 @ @ public abstract class SecondaryIndexSearcher <nl> continue ; <nl> <nl> SecondaryIndex index = indexManager . getIndexForColumn ( expression . column ) ; <nl> - if ( index = = null | | ! expression . operator . allowsIndexQuery ( ) ) <nl> + if ( index = = null | | index . getIndexCfs ( ) = = null | | ! expression . operator . allowsIndexQuery ( ) ) <nl> continue ; <nl> int columns = index . getIndexCfs ( ) . getMeanColumns ( ) ; <nl> candidates . put ( index , columns ) ; <nl> diff - - git a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> index 7dba9b0 . . b441ff1 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java <nl> @ @ - 80 , 6 + 80 , 7 @ @ public class CompositesSearcher extends SecondaryIndexSearcher <nl> final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; <nl> final CompositesIndex index = ( CompositesIndex ) indexManager . getIndexForColumn ( primary . column ) ; <nl> assert index ! = null ; <nl> + assert index . getIndexCfs ( ) ! = null ; <nl> final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> index 2ed888f . . d491c93 100644 <nl> - - - a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> + + + b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java <nl> @ @ - 67 , 6 + 67 , 7 @ @ public class KeysSearcher extends SecondaryIndexSearcher <nl> final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; <nl> final SecondaryIndex index = indexManager . getIndexForColumn ( primary . column ) ; <nl> assert index ! = null ; <nl> + assert index . getIndexCfs ( ) ! = null ; <nl> final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; <nl> <nl> if ( logger . isDebugEnabled ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index e7eec4e . . d891a59 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 2327 , 8 + 2327 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> { <nl> for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) <nl> { <nl> - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> - valid . add ( si . getIndexCfs ( ) ) ; <nl> + if ( si . getIndexCfs ( ) ! = null ) { <nl> + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> + valid . add ( si . getIndexCfs ( ) ) ; <nl> + } <nl> } <nl> <nl> } <nl> @ @ - 2376 , 8 + 2378 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> { <nl> for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) <nl> { <nl> - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> - valid . add ( si . getIndexCfs ( ) ) ; <nl> + if ( si . getIndexCfs ( ) ! = null ) { <nl> + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; <nl> + valid . add ( si . getIndexCfs ( ) ) ; <nl> + } <nl> } <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / tools / bin / stress b / tools / bin / stress <nl> old mode 100644 <nl> new mode 100755 <nl> diff - - git a / tools / bin / stress . bat b / tools / bin / stress . bat <nl> old mode 100644 <nl> new mode 100755 <nl> diff - - git a / tools / bin / stressd b / tools / bin / stressd <nl> old mode 100644 <nl> new mode 100755

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 745e50b . . 4f0e5a5 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 32 , 6 + 32 , 7 @ @ 
 * Expose bulk loading progress over JMX ( CASSANDRA - 4757 ) 
 * Correctly handle null with IF conditions and TTL ( CASSANDRA - 6623 ) 
 Merged from 1 . 2 : 
 + * Fix upgradesstables NPE for non - CF - based indexes ( CASSANDRA - 6645 ) 
 * Fix partition and range deletes not triggering flush ( CASSANDRA - 6655 ) 
 
 
 diff - - git a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 index a508a15 . . 70c3d6b 100644 
 - - - a / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / SecondaryIndexSearcher . java 
 @ @ - 67 , 7 + 67 , 7 @ @ public abstract class SecondaryIndexSearcher 
 continue ; 
 
 SecondaryIndex index = indexManager . getIndexForColumn ( expression . column ) ; 
 - if ( index = = null | | ! expression . operator . allowsIndexQuery ( ) ) 
 + if ( index = = null | | index . getIndexCfs ( ) = = null | | ! expression . operator . allowsIndexQuery ( ) ) 
 continue ; 
 int columns = index . getIndexCfs ( ) . getMeanColumns ( ) ; 
 candidates . put ( index , columns ) ; 
 diff - - git a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 index 7dba9b0 . . b441ff1 100644 
 - - - a / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / composites / CompositesSearcher . java 
 @ @ - 80 , 6 + 80 , 7 @ @ public class CompositesSearcher extends SecondaryIndexSearcher 
 final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; 
 final CompositesIndex index = ( CompositesIndex ) indexManager . getIndexForColumn ( primary . column ) ; 
 assert index ! = null ; 
 + assert index . getIndexCfs ( ) ! = null ; 
 final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; 
 
 if ( logger . isDebugEnabled ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 index 2ed888f . . d491c93 100644 
 - - - a / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 + + + b / src / java / org / apache / cassandra / db / index / keys / KeysSearcher . java 
 @ @ - 67 , 6 + 67 , 7 @ @ public class KeysSearcher extends SecondaryIndexSearcher 
 final IndexExpression primary = highestSelectivityPredicate ( filter . getClause ( ) ) ; 
 final SecondaryIndex index = indexManager . getIndexForColumn ( primary . column ) ; 
 assert index ! = null ; 
 + assert index . getIndexCfs ( ) ! = null ; 
 final DecoratedKey indexKey = index . getIndexKeyFor ( primary . value ) ; 
 
 if ( logger . isDebugEnabled ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index e7eec4e . . d891a59 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 2327 , 8 + 2327 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 { 
 for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) 
 { 
 - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 - valid . add ( si . getIndexCfs ( ) ) ; 
 + if ( si . getIndexCfs ( ) ! = null ) { 
 + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 + valid . add ( si . getIndexCfs ( ) ) ; 
 + } 
 } 
 
 } 
 @ @ - 2376 , 8 + 2378 , 10 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 { 
 for ( SecondaryIndex si : cfStore . indexManager . getIndexes ( ) ) 
 { 
 - logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 - valid . add ( si . getIndexCfs ( ) ) ; 
 + if ( si . getIndexCfs ( ) ! = null ) { 
 + logger . info ( " adding secondary index { } to operation " , si . getIndexName ( ) ) ; 
 + valid . add ( si . getIndexCfs ( ) ) ; 
 + } 
 } 
 } 
 }

NEAREST DIFF:
diff - - git a / tools / bin / stress b / tools / bin / stress 
 old mode 100644 
 new mode 100755 
 diff - - git a / tools / bin / stress . bat b / tools / bin / stress . bat 
 old mode 100644 
 new mode 100755 
 diff - - git a / tools / bin / stressd b / tools / bin / stressd 
 old mode 100644 
 new mode 100755
