BLEU SCORE: 0.015542791893293221

TEST MSG: Fix replace _ address after CASSANDRA - 7356 broke it
GENERATED MSG: add check to ensure at least one keyspace present . patch by jbellis

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index 3c58b57 . . 1e534f9 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 777 , 8 + 777 , 6 @ @ public class DatabaseDescriptor <nl> logger . info ( " Replace address on first boot requested ; this node is already bootstrapped " ) ; <nl> return false ; <nl> } <nl> - if ( getReplaceAddress ( ) ! = null & & SystemTable . bootstrapComplete ( ) ) <nl> - throw new RuntimeException ( " Cannot replace address with a node that is already bootstrapped " ) ; <nl> return getReplaceAddress ( ) ! = null ; <nl> } <nl> <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 449a371 . . 1f3d1e1 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 608 , 6 + 608 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> throw new RuntimeException ( " Replace method removed ; use cassandra . replace _ address instead " ) ; <nl> if ( DatabaseDescriptor . isReplacing ( ) ) <nl> { <nl> + if ( SystemTable . bootstrapComplete ( ) ) <nl> + throw new RuntimeException ( " Cannot replace address with a node that is already bootstrapped " ) ; <nl> if ( ! DatabaseDescriptor . isAutoBootstrap ( ) ) <nl> throw new RuntimeException ( " Trying to replace _ address with auto _ bootstrap disabled will not work , check your configuration " ) ; <nl> tokens = prepareReplacementInfo ( ) ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> index 399edb5 . . d1da816 100644 <nl> - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java <nl> @ @ - 583 , 6 + 583 , 8 @ @ public class DatabaseDescriptor <nl> tableToCFMetaDataMap _ . get ( tName ) . put ( cfName , cfMetaData ) ; <nl> } <nl> } <nl> + if ( tables _ . isEmpty ( ) ) <nl> + throw new ConfigurationException ( " No keyspaces configured " ) ; <nl> <nl> / / Hardcoded system tables <nl> tables _ . add ( Table . SYSTEM _ TABLE ) ; <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 285ab35 . . a43454f 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 367 , 13 + 367 , 7 @ @ public class StorageService implements IEndPointStateChangeSubscriber , StorageSe <nl> / / some people just want to get a visual representation of things . Allow null and set it to the first <nl> / / non - system table . <nl> if ( keyspace = = null ) <nl> - { <nl> - for ( String ks : DatabaseDescriptor . getNonSystemTables ( ) ) <nl> - { <nl> - keyspace = ks ; <nl> - break ; <nl> - } <nl> - } <nl> + keyspace = DatabaseDescriptor . getNonSystemTables ( ) . get ( 0 ) ; <nl> <nl> / * All the ranges for the tokens * / <nl> List < Range > ranges = getAllRanges ( tokenMetadata _ . sortedTokens ( ) ) ;

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index 3c58b57 . . 1e534f9 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 777 , 8 + 777 , 6 @ @ public class DatabaseDescriptor 
 logger . info ( " Replace address on first boot requested ; this node is already bootstrapped " ) ; 
 return false ; 
 } 
 - if ( getReplaceAddress ( ) ! = null & & SystemTable . bootstrapComplete ( ) ) 
 - throw new RuntimeException ( " Cannot replace address with a node that is already bootstrapped " ) ; 
 return getReplaceAddress ( ) ! = null ; 
 } 
 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 449a371 . . 1f3d1e1 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 608 , 6 + 608 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 throw new RuntimeException ( " Replace method removed ; use cassandra . replace _ address instead " ) ; 
 if ( DatabaseDescriptor . isReplacing ( ) ) 
 { 
 + if ( SystemTable . bootstrapComplete ( ) ) 
 + throw new RuntimeException ( " Cannot replace address with a node that is already bootstrapped " ) ; 
 if ( ! DatabaseDescriptor . isAutoBootstrap ( ) ) 
 throw new RuntimeException ( " Trying to replace _ address with auto _ bootstrap disabled will not work , check your configuration " ) ; 
 tokens = prepareReplacementInfo ( ) ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 index 399edb5 . . d1da816 100644 
 - - - a / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 + + + b / src / java / org / apache / cassandra / config / DatabaseDescriptor . java 
 @ @ - 583 , 6 + 583 , 8 @ @ public class DatabaseDescriptor 
 tableToCFMetaDataMap _ . get ( tName ) . put ( cfName , cfMetaData ) ; 
 } 
 } 
 + if ( tables _ . isEmpty ( ) ) 
 + throw new ConfigurationException ( " No keyspaces configured " ) ; 
 
 / / Hardcoded system tables 
 tables _ . add ( Table . SYSTEM _ TABLE ) ; 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 285ab35 . . a43454f 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 367 , 13 + 367 , 7 @ @ public class StorageService implements IEndPointStateChangeSubscriber , StorageSe 
 / / some people just want to get a visual representation of things . Allow null and set it to the first 
 / / non - system table . 
 if ( keyspace = = null ) 
 - { 
 - for ( String ks : DatabaseDescriptor . getNonSystemTables ( ) ) 
 - { 
 - keyspace = ks ; 
 - break ; 
 - } 
 - } 
 + keyspace = DatabaseDescriptor . getNonSystemTables ( ) . get ( 0 ) ; 
 
 / * All the ranges for the tokens * / 
 List < Range > ranges = getAllRanges ( tokenMetadata _ . sortedTokens ( ) ) ;
