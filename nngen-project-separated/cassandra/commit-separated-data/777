BLEU SCORE: 0.035992758237664596

TEST MSG: Add test for multiple non primary - keys in MV
GENERATED MSG: Allow " IS NOT NULL " to be excluded for non - composite partition keys

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java b / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java <nl> index 6446602 . . 13e528c 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java <nl> @ @ - 316 , 7 + 316 , 7 @ @ public class CreateViewStatement extends SchemaAlteringStatement <nl> <nl> boolean isPk = basePK . contains ( identifier ) ; <nl> if ( ! isPk & & hasNonPKColumn ) <nl> - throw new InvalidRequestException ( String . format ( " Cannot include more than one non - primary key column ' % s ' in materialized view partition key " , identifier ) ) ; <nl> + throw new InvalidRequestException ( String . format ( " Cannot include more than one non - primary key column ' % s ' in materialized view primary key " , identifier ) ) ; <nl> <nl> / / We don ' t need to include the " IS NOT NULL " filter on a non - composite partition key <nl> / / because we will never allow a single partition key to be NULL <nl> diff - - git a / test / unit / org / apache / cassandra / cql3 / ViewTest . java b / test / unit / org / apache / cassandra / cql3 / ViewTest . java <nl> index 4a1dc07 . . 85f01a6 100644 <nl> - - - a / test / unit / org / apache / cassandra / cql3 / ViewTest . java <nl> + + + b / test / unit / org / apache / cassandra / cql3 / ViewTest . java <nl> @ @ - 1077 , 4 + 1077 , 35 @ @ public class ViewTest extends CQLTester <nl> mvRows = executeNet ( protocolVersion , " SELECT a , b FROM mvmap WHERE b = ? " , 0 ) ; <nl> assertRowsNet ( protocolVersion , mvRows , row ( 0 , 0 ) ) ; <nl> } <nl> + <nl> + @ Test <nl> + public void testMultipleNonPrimaryKeysInView ( ) throws Throwable <nl> + { <nl> + createTable ( " CREATE TABLE % s ( " + <nl> + " a int , " + <nl> + " b int , " + <nl> + " c int , " + <nl> + " d int , " + <nl> + " e int , " + <nl> + " PRIMARY KEY ( ( a , b ) , c ) ) " ) ; <nl> + <nl> + try <nl> + { <nl> + createView ( " mv _ de " , " CREATE MATERIALIZED VIEW % s AS SELECT * FROM % % s WHERE a IS NOT NULL AND b IS NOT NULL AND c IS NOT NULL AND d IS NOT NULL AND e IS NOT NULL PRIMARY KEY ( ( d , a ) , b , e , c ) " ) ; <nl> + Assert . fail ( " Should have rejected a query including multiple non - primary key base columns " ) ; <nl> + } <nl> + catch ( Exception e ) <nl> + { <nl> + } <nl> + <nl> + try <nl> + { <nl> + createView ( " mv _ de " , " CREATE MATERIALIZED VIEW % s AS SELECT * FROM % % s WHERE a IS NOT NULL AND b IS NOT NULL AND c IS NOT NULL AND d IS NOT NULL AND e IS NOT NULL PRIMARY KEY ( ( a , b ) , c , d , e ) " ) ; <nl> + Assert . fail ( " Should have rejected a query including multiple non - primary key base columns " ) ; <nl> + } <nl> + catch ( Exception e ) <nl> + { <nl> + } <nl> + <nl> + } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java b / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java 
 index 6446602 . . 13e528c 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / CreateViewStatement . java 
 @ @ - 316 , 7 + 316 , 7 @ @ public class CreateViewStatement extends SchemaAlteringStatement 
 
 boolean isPk = basePK . contains ( identifier ) ; 
 if ( ! isPk & & hasNonPKColumn ) 
 - throw new InvalidRequestException ( String . format ( " Cannot include more than one non - primary key column ' % s ' in materialized view partition key " , identifier ) ) ; 
 + throw new InvalidRequestException ( String . format ( " Cannot include more than one non - primary key column ' % s ' in materialized view primary key " , identifier ) ) ; 
 
 / / We don ' t need to include the " IS NOT NULL " filter on a non - composite partition key 
 / / because we will never allow a single partition key to be NULL 
 diff - - git a / test / unit / org / apache / cassandra / cql3 / ViewTest . java b / test / unit / org / apache / cassandra / cql3 / ViewTest . java 
 index 4a1dc07 . . 85f01a6 100644 
 - - - a / test / unit / org / apache / cassandra / cql3 / ViewTest . java 
 + + + b / test / unit / org / apache / cassandra / cql3 / ViewTest . java 
 @ @ - 1077 , 4 + 1077 , 35 @ @ public class ViewTest extends CQLTester 
 mvRows = executeNet ( protocolVersion , " SELECT a , b FROM mvmap WHERE b = ? " , 0 ) ; 
 assertRowsNet ( protocolVersion , mvRows , row ( 0 , 0 ) ) ; 
 } 
 + 
 + @ Test 
 + public void testMultipleNonPrimaryKeysInView ( ) throws Throwable 
 + { 
 + createTable ( " CREATE TABLE % s ( " + 
 + " a int , " + 
 + " b int , " + 
 + " c int , " + 
 + " d int , " + 
 + " e int , " + 
 + " PRIMARY KEY ( ( a , b ) , c ) ) " ) ; 
 + 
 + try 
 + { 
 + createView ( " mv _ de " , " CREATE MATERIALIZED VIEW % s AS SELECT * FROM % % s WHERE a IS NOT NULL AND b IS NOT NULL AND c IS NOT NULL AND d IS NOT NULL AND e IS NOT NULL PRIMARY KEY ( ( d , a ) , b , e , c ) " ) ; 
 + Assert . fail ( " Should have rejected a query including multiple non - primary key base columns " ) ; 
 + } 
 + catch ( Exception e ) 
 + { 
 + } 
 + 
 + try 
 + { 
 + createView ( " mv _ de " , " CREATE MATERIALIZED VIEW % s AS SELECT * FROM % % s WHERE a IS NOT NULL AND b IS NOT NULL AND c IS NOT NULL AND d IS NOT NULL AND e IS NOT NULL PRIMARY KEY ( ( a , b ) , c , d , e ) " ) ; 
 + Assert . fail ( " Should have rejected a query including multiple non - primary key base columns " ) ; 
 + } 
 + catch ( Exception e ) 
 + { 
 + } 
 + 
 + } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
