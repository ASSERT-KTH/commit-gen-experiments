BLEU SCORE: 0.03283637368030199

TEST MSG: fix CME in SessionInfo updateProgress affecting netstats
GENERATED MSG: merge from 1 . 1

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b25ff47 . . bfcb6a4 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 6 <nl> + * fix CME in SessionInfo updateProgress affecting netstats ( CASSANDRA - 6577 ) <nl> * Allow repairing between specific replicas ( CASSANDRA - 6440 ) <nl> * Allow per - dc enabling of hints ( CASSANDRA - 6157 ) <nl> * Add compatibility for Hadoop 0 . 2 . x ( CASSANDRA - 5201 ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / SessionInfo . java b / src / java / org / apache / cassandra / streaming / SessionInfo . java <nl> index 9532041 . . b722ecf 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / SessionInfo . java <nl> + + + b / src / java / org / apache / cassandra / streaming / SessionInfo . java <nl> @ @ - 20 , 8 + 20 , 8 @ @ package org . apache . cassandra . streaming ; <nl> import java . io . Serializable ; <nl> import java . net . InetAddress ; <nl> import java . util . Collection ; <nl> - import java . util . HashMap ; <nl> import java . util . Map ; <nl> + import java . util . concurrent . ConcurrentHashMap ; <nl> <nl> import com . google . common . base . Predicate ; <nl> import com . google . common . collect . ImmutableSet ; <nl> @ @ - 51 , 8 + 51 , 8 @ @ public final class SessionInfo implements Serializable <nl> this . peer = peer ; <nl> this . receivingSummaries = ImmutableSet . copyOf ( receivingSummaries ) ; <nl> this . sendingSummaries = ImmutableSet . copyOf ( sendingSummaries ) ; <nl> - this . receivingFiles = new HashMap < > ( ) ; <nl> - this . sendingFiles = new HashMap < > ( ) ; <nl> + this . receivingFiles = new ConcurrentHashMap < > ( ) ; <nl> + this . sendingFiles = new ConcurrentHashMap < > ( ) ; <nl> this . state = state ; <nl> } <nl> <nl> @ @ - 66 , 7 + 66 , 7 @ @ public final class SessionInfo implements Serializable <nl> * <nl> * @ param newProgress new progress info <nl> * / <nl> - public synchronized void updateProgress ( ProgressInfo newProgress ) <nl> + public void updateProgress ( ProgressInfo newProgress ) <nl> { <nl> assert peer . equals ( newProgress . peer ) ; <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> index a83fbab . . e2dc046 100644 <nl> - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java <nl> @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean <nl> { <nl> Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; <nl> InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; <nl> - scheduleHintDelivery ( target ) ; <nl> + / / token may have since been removed ( in which case we have just read back a tombstone ) <nl> + if ( target ! = null ) <nl> + scheduleHintDelivery ( target ) ; <nl> } <nl> <nl> if ( logger _ . isDebugEnabled ( ) )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b25ff47 . . bfcb6a4 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 6 
 + * fix CME in SessionInfo updateProgress affecting netstats ( CASSANDRA - 6577 ) 
 * Allow repairing between specific replicas ( CASSANDRA - 6440 ) 
 * Allow per - dc enabling of hints ( CASSANDRA - 6157 ) 
 * Add compatibility for Hadoop 0 . 2 . x ( CASSANDRA - 5201 ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / SessionInfo . java b / src / java / org / apache / cassandra / streaming / SessionInfo . java 
 index 9532041 . . b722ecf 100644 
 - - - a / src / java / org / apache / cassandra / streaming / SessionInfo . java 
 + + + b / src / java / org / apache / cassandra / streaming / SessionInfo . java 
 @ @ - 20 , 8 + 20 , 8 @ @ package org . apache . cassandra . streaming ; 
 import java . io . Serializable ; 
 import java . net . InetAddress ; 
 import java . util . Collection ; 
 - import java . util . HashMap ; 
 import java . util . Map ; 
 + import java . util . concurrent . ConcurrentHashMap ; 
 
 import com . google . common . base . Predicate ; 
 import com . google . common . collect . ImmutableSet ; 
 @ @ - 51 , 8 + 51 , 8 @ @ public final class SessionInfo implements Serializable 
 this . peer = peer ; 
 this . receivingSummaries = ImmutableSet . copyOf ( receivingSummaries ) ; 
 this . sendingSummaries = ImmutableSet . copyOf ( sendingSummaries ) ; 
 - this . receivingFiles = new HashMap < > ( ) ; 
 - this . sendingFiles = new HashMap < > ( ) ; 
 + this . receivingFiles = new ConcurrentHashMap < > ( ) ; 
 + this . sendingFiles = new ConcurrentHashMap < > ( ) ; 
 this . state = state ; 
 } 
 
 @ @ - 66 , 7 + 66 , 7 @ @ public final class SessionInfo implements Serializable 
 * 
 * @ param newProgress new progress info 
 * / 
 - public synchronized void updateProgress ( ProgressInfo newProgress ) 
 + public void updateProgress ( ProgressInfo newProgress ) 
 { 
 assert peer . equals ( newProgress . peer ) ; 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / HintedHandOffManager . java b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 index a83fbab . . e2dc046 100644 
 - - - a / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 + + + b / src / java / org / apache / cassandra / db / HintedHandOffManager . java 
 @ @ - 391 , 7 + 391 , 9 @ @ public class HintedHandOffManager implements HintedHandOffManagerMBean 
 { 
 Token < ? > token = StorageService . getPartitioner ( ) . getTokenFactory ( ) . fromByteArray ( row . key . key ) ; 
 InetAddress target = StorageService . instance . getTokenMetadata ( ) . getEndpoint ( token ) ; 
 - scheduleHintDelivery ( target ) ; 
 + / / token may have since been removed ( in which case we have just read back a tombstone ) 
 + if ( target ! = null ) 
 + scheduleHintDelivery ( target ) ; 
 } 
 
 if ( logger _ . isDebugEnabled ( ) )
