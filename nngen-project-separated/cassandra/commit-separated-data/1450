BLEU SCORE: 0.15777684932819508

TEST MSG: Fix CommitLogUpgradeTest
GENERATED MSG: Upgrade CommitLogUpgradeTest post - 8099

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java <nl> index ce4e605 . . d8784d9 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java <nl> @ @ - 23 , 8 + 23 , 6 @ @ package org . apache . cassandra . db . commitlog ; <nl> <nl> import java . io . * ; <nl> import java . nio . ByteBuffer ; <nl> - import java . nio . charset . StandardCharsets ; <nl> - import java . util . Iterator ; <nl> import java . util . Properties ; <nl> import java . util . UUID ; <nl> <nl> @ @ - 42 , 7 + 40 , 6 @ @ import org . apache . cassandra . db . Mutation ; <nl> import org . apache . cassandra . db . rows . Cell ; <nl> import org . apache . cassandra . db . rows . Row ; <nl> import org . apache . cassandra . db . marshal . AsciiType ; <nl> - import org . apache . cassandra . db . marshal . UTF8Type ; <nl> import org . apache . cassandra . db . marshal . BytesType ; <nl> import org . apache . cassandra . db . partitions . PartitionUpdate ; <nl> import org . apache . cassandra . schema . KeyspaceParams ; <nl> @ @ - 57 , 6 + 54 , 7 @ @ public class CommitLogUpgradeTest <nl> <nl> static final String TABLE = " Standard1 " ; <nl> static final String KEYSPACE = " Keyspace1 " ; <nl> + static final String CELLNAME = " name " ; <nl> <nl> @ Test <nl> public void test20 ( ) throws Exception <nl> @ @ - 75 , 7 + 73 , 7 @ @ public class CommitLogUpgradeTest <nl> { <nl> CFMetaData metadata = CFMetaData . Builder . createDense ( KEYSPACE , TABLE , false , false ) <nl> . addPartitionKey ( " key " , AsciiType . instance ) <nl> - . addClusteringColumn ( " col " , BytesType . instance ) <nl> + . addClusteringColumn ( " col " , AsciiType . instance ) <nl> . addRegularColumn ( " val " , BytesType . instance ) <nl> . build ( ) <nl> . compressionParameters ( SchemaLoader . getCompressionParameters ( ) ) ; <nl> @ @ - 142 , 13 + 140 , 15 @ @ public class CommitLogUpgradeTest <nl> for ( PartitionUpdate update : mutation . getPartitionUpdates ( ) ) <nl> { <nl> for ( Row row : update ) <nl> - { <nl> - for ( Cell cell : row . cells ( ) ) <nl> + if ( row . clustering ( ) . size ( ) > 0 & & <nl> + AsciiType . instance . compose ( row . clustering ( ) . get ( 0 ) ) . startsWith ( CELLNAME ) ) <nl> { <nl> - hash = hash ( hash , cell . value ( ) ) ; <nl> - + + cells ; <nl> + for ( Cell cell : row . cells ( ) ) <nl> + { <nl> + hash = hash ( hash , cell . value ( ) ) ; <nl> + + + cells ; <nl> + } <nl> } <nl> - } <nl> } <nl> return true ; <nl> } <nl> diff - - git a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java <nl> index cbae7e3 . . dbdb7fc 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java <nl> + + + b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java <nl> @ @ - 239 , 7 + 239 , 7 @ @ public class CommitLogUpgradeTestMaker <nl> { <nl> int sz = randomSize ? tlr . nextInt ( cellSize ) : cellSize ; <nl> ByteBuffer bytes = randomBytes ( sz , tlr ) ; <nl> - builder . newRow ( " name " + ii ) . add ( " val " , bytes ) ; <nl> + builder . newRow ( CommitLogUpgradeTest . CELLNAME + ii ) . add ( " val " , bytes ) ; <nl> hash = hash ( hash , bytes ) ; <nl> + + cells ; <nl> dataSize + = sz ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java 
 index ce4e605 . . d8784d9 100644 
 - - - a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java 
 + + + b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTest . java 
 @ @ - 23 , 8 + 23 , 6 @ @ package org . apache . cassandra . db . commitlog ; 
 
 import java . io . * ; 
 import java . nio . ByteBuffer ; 
 - import java . nio . charset . StandardCharsets ; 
 - import java . util . Iterator ; 
 import java . util . Properties ; 
 import java . util . UUID ; 
 
 @ @ - 42 , 7 + 40 , 6 @ @ import org . apache . cassandra . db . Mutation ; 
 import org . apache . cassandra . db . rows . Cell ; 
 import org . apache . cassandra . db . rows . Row ; 
 import org . apache . cassandra . db . marshal . AsciiType ; 
 - import org . apache . cassandra . db . marshal . UTF8Type ; 
 import org . apache . cassandra . db . marshal . BytesType ; 
 import org . apache . cassandra . db . partitions . PartitionUpdate ; 
 import org . apache . cassandra . schema . KeyspaceParams ; 
 @ @ - 57 , 6 + 54 , 7 @ @ public class CommitLogUpgradeTest 
 
 static final String TABLE = " Standard1 " ; 
 static final String KEYSPACE = " Keyspace1 " ; 
 + static final String CELLNAME = " name " ; 
 
 @ Test 
 public void test20 ( ) throws Exception 
 @ @ - 75 , 7 + 73 , 7 @ @ public class CommitLogUpgradeTest 
 { 
 CFMetaData metadata = CFMetaData . Builder . createDense ( KEYSPACE , TABLE , false , false ) 
 . addPartitionKey ( " key " , AsciiType . instance ) 
 - . addClusteringColumn ( " col " , BytesType . instance ) 
 + . addClusteringColumn ( " col " , AsciiType . instance ) 
 . addRegularColumn ( " val " , BytesType . instance ) 
 . build ( ) 
 . compressionParameters ( SchemaLoader . getCompressionParameters ( ) ) ; 
 @ @ - 142 , 13 + 140 , 15 @ @ public class CommitLogUpgradeTest 
 for ( PartitionUpdate update : mutation . getPartitionUpdates ( ) ) 
 { 
 for ( Row row : update ) 
 - { 
 - for ( Cell cell : row . cells ( ) ) 
 + if ( row . clustering ( ) . size ( ) > 0 & & 
 + AsciiType . instance . compose ( row . clustering ( ) . get ( 0 ) ) . startsWith ( CELLNAME ) ) 
 { 
 - hash = hash ( hash , cell . value ( ) ) ; 
 - + + cells ; 
 + for ( Cell cell : row . cells ( ) ) 
 + { 
 + hash = hash ( hash , cell . value ( ) ) ; 
 + + + cells ; 
 + } 
 } 
 - } 
 } 
 return true ; 
 } 
 diff - - git a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java 
 index cbae7e3 . . dbdb7fc 100644 
 - - - a / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java 
 + + + b / test / unit / org / apache / cassandra / db / commitlog / CommitLogUpgradeTestMaker . java 
 @ @ - 239 , 7 + 239 , 7 @ @ public class CommitLogUpgradeTestMaker 
 { 
 int sz = randomSize ? tlr . nextInt ( cellSize ) : cellSize ; 
 ByteBuffer bytes = randomBytes ( sz , tlr ) ; 
 - builder . newRow ( " name " + ii ) . add ( " val " , bytes ) ; 
 + builder . newRow ( CommitLogUpgradeTest . CELLNAME + ii ) . add ( " val " , bytes ) ; 
 hash = hash ( hash , bytes ) ; 
 + + cells ; 
 dataSize + = sz ;

NEAREST DIFF:
ELIMINATEDSENTENCE
