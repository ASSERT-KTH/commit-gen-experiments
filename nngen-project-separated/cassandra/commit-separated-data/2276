BLEU SCORE: 0.0370865905565703

TEST MSG: Avoid NPE when listing saved caches directory
GENERATED MSG: Fix cache persistence when both row and key cache are enabled

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index a6fc837 . . 1fcb556 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 22 , 6 + 22 , 7 @ @ <nl> * Fix error when doing reversed queries with static columns ( CASSANDRA - 7490 ) <nl> * Backport CASSANDRA - 6747 ( CASSANDRA - 7560 ) <nl> * Track max / min timestamps for range tombstones ( CASSANDRA - 7647 ) <nl> + * Fix NPE when listing saved caches dir ( CASSANDRA - 7632 ) <nl> Merged from 1 . 2 : <nl> * Set correct stream ID on responses when non - Exception Throwables <nl> are thrown while handling native protocol messages ( CASSANDRA - 7470 ) <nl> diff - - git a / src / java / org / apache / cassandra / cache / AutoSavingCache . java b / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> index 6554eb3 . . 64234e2 100644 <nl> - - - a / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> + + + b / src / java / org / apache / cassandra / cache / AutoSavingCache . java <nl> @ @ - 261 , 19 + 261 , 24 @ @ public class AutoSavingCache < K extends CacheKey , V > extends InstrumentingCache < K <nl> { <nl> File savedCachesDir = new File ( DatabaseDescriptor . getSavedCachesLocation ( ) ) ; <nl> assert savedCachesDir . exists ( ) & & savedCachesDir . isDirectory ( ) ; <nl> - <nl> - for ( File file : savedCachesDir . listFiles ( ) ) <nl> + File [ ] files = savedCachesDir . listFiles ( ) ; <nl> + if ( files ! = null ) <nl> { <nl> - if ( ! file . isFile ( ) ) <nl> - continue ; / / someone ' s been messing with our directory . naughty ! <nl> - <nl> - if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) <nl> - | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) <nl> + for ( File file : files ) <nl> { <nl> - if ( ! file . delete ( ) ) <nl> - logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ; <nl> + if ( ! file . isFile ( ) ) <nl> + continue ; / / someone ' s been messing with our directory . naughty ! <nl> + <nl> + if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) <nl> + | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) <nl> + { <nl> + if ( ! file . delete ( ) ) <nl> + logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ; <nl> + } <nl> } <nl> } <nl> + else <nl> + logger . warn ( " Could not list files in { } " , savedCachesDir ) ; <nl> } <nl> } <nl>
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index a6fc837 . . 1fcb556 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 22 , 6 + 22 , 7 @ @ 
 * Fix error when doing reversed queries with static columns ( CASSANDRA - 7490 ) 
 * Backport CASSANDRA - 6747 ( CASSANDRA - 7560 ) 
 * Track max / min timestamps for range tombstones ( CASSANDRA - 7647 ) 
 + * Fix NPE when listing saved caches dir ( CASSANDRA - 7632 ) 
 Merged from 1 . 2 : 
 * Set correct stream ID on responses when non - Exception Throwables 
 are thrown while handling native protocol messages ( CASSANDRA - 7470 ) 
 diff - - git a / src / java / org / apache / cassandra / cache / AutoSavingCache . java b / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 index 6554eb3 . . 64234e2 100644 
 - - - a / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 + + + b / src / java / org / apache / cassandra / cache / AutoSavingCache . java 
 @ @ - 261 , 19 + 261 , 24 @ @ public class AutoSavingCache < K extends CacheKey , V > extends InstrumentingCache < K 
 { 
 File savedCachesDir = new File ( DatabaseDescriptor . getSavedCachesLocation ( ) ) ; 
 assert savedCachesDir . exists ( ) & & savedCachesDir . isDirectory ( ) ; 
 - 
 - for ( File file : savedCachesDir . listFiles ( ) ) 
 + File [ ] files = savedCachesDir . listFiles ( ) ; 
 + if ( files ! = null ) 
 { 
 - if ( ! file . isFile ( ) ) 
 - continue ; / / someone ' s been messing with our directory . naughty ! 
 - 
 - if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) 
 - | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) 
 + for ( File file : files ) 
 { 
 - if ( ! file . delete ( ) ) 
 - logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ; 
 + if ( ! file . isFile ( ) ) 
 + continue ; / / someone ' s been messing with our directory . naughty ! 
 + 
 + if ( file . getName ( ) . endsWith ( cacheType . toString ( ) ) 
 + | | file . getName ( ) . endsWith ( String . format ( " % s - % s . db " , cacheType . toString ( ) , CURRENT _ VERSION ) ) ) 
 + { 
 + if ( ! file . delete ( ) ) 
 + logger . warn ( " Failed to delete { } " , file . getAbsolutePath ( ) ) ; 
 + } 
 } 
 } 
 + else 
 + logger . warn ( " Could not list files in { } " , savedCachesDir ) ; 
 } 
 } 


NEAREST DIFF:
ELIMINATEDSENTENCE
