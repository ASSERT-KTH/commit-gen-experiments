BLEU SCORE: 0.06567274736060397

TEST MSG: Add MBean to monitor max queued tasks
GENERATED MSG: Expose thread pool max in metrics

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index efd6716 . . 988f93d 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 4 . 0 <nl> + * Expose tasks queue length via JMX ( CASSANDRA - 12758 ) <nl> * Fix race / ref leak in PendingRepairManager ( CASSANDRA - 13751 ) <nl> * Enable ppc64le runtime as unsupported architecture ( CASSANDRA - 13615 ) <nl> * Improve sstablemetadata output ( CASSANDRA - 11483 ) <nl> diff - - git a / doc / source / operating / metrics . rst b / doc / source / operating / metrics . rst <nl> index a38d7c1 . . cfdd584 100644 <nl> - - - a / doc / source / operating / metrics . rst <nl> + + + b / doc / source / operating / metrics . rst <nl> @ @ - 193 , 6 + 193 , 7 @ @ CompletedTasks Counter Number of tasks completed . <nl> TotalBlockedTasks Counter Number of tasks that were blocked due to queue saturation . <nl> CurrentlyBlockedTask Counter Number of tasks that are currently blocked due to queue saturation but on retry will become unblocked . <nl> MaxPoolSize Gauge < Integer > The maximum number of threads in this pool . <nl> + MaxTasksQueued Gauge < Integer > The maximum number of tasks queued before a task get blocked . <nl> = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = <nl> <nl> The following thread pools can be monitored . <nl> diff - - git a / src / java / org / apache / cassandra / concurrent / SEPExecutor . java b / src / java / org / apache / cassandra / concurrent / SEPExecutor . java <nl> index c87614b . . add850a 100644 <nl> - - - a / src / java / org / apache / cassandra / concurrent / SEPExecutor . java <nl> + + + b / src / java / org / apache / cassandra / concurrent / SEPExecutor . java <nl> @ @ - 35 , 7 + 35 , 7 @ @ public class SEPExecutor extends AbstractLocalAwareExecutorService <nl> <nl> public final int maxWorkers ; <nl> public final String name ; <nl> - private final int maxTasksQueued ; <nl> + public final int maxTasksQueued ; <nl> private final SEPMetrics metrics ; <nl> <nl> / / stores both a set of work permits and task permits : <nl> diff - - git a / src / java / org / apache / cassandra / metrics / SEPMetrics . java b / src / java / org / apache / cassandra / metrics / SEPMetrics . java <nl> index 35f02b4 . . dd1d2d6 100644 <nl> - - - a / src / java / org / apache / cassandra / metrics / SEPMetrics . java <nl> + + + b / src / java / org / apache / cassandra / metrics / SEPMetrics . java <nl> @ @ - 41 , 6 + 41 , 8 @ @ public class SEPMetrics <nl> public final Gauge < Long > pendingTasks ; <nl> / * * Maximum number of threads before it will start queuing tasks * / <nl> public final Gauge < Integer > maxPoolSize ; <nl> + / * * Maximum number of tasks queued before a task get blocked * / <nl> + public final Gauge < Integer > maxTasksQueued ; <nl> <nl> private MetricNameFactory factory ; <nl> <nl> @ @ - 85 , 6 + 87 , 13 @ @ public class SEPMetrics <nl> return executor . maxWorkers ; <nl> } <nl> } ) ; <nl> + maxTasksQueued = Metrics . register ( factory . createMetricName ( " MaxTasksQueued " ) , new Gauge < Integer > ( ) <nl> + { <nl> + public Integer getValue ( ) <nl> + { <nl> + return executor . maxTasksQueued ; <nl> + } <nl> + } ) ; <nl> } <nl> <nl> public void release ( ) <nl> @ @ - 95 , 5 + 104 , 6 @ @ public class SEPMetrics <nl> Metrics . remove ( factory . createMetricName ( " TotalBlockedTasks " ) ) ; <nl> Metrics . remove ( factory . createMetricName ( " CurrentlyBlockedTasks " ) ) ; <nl> Metrics . remove ( factory . createMetricName ( " MaxPoolSize " ) ) ; <nl> + Metrics . remove ( factory . createMetricName ( " MaxTasksQueued " ) ) ; <nl> } <nl> }
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index efd6716 . . 988f93d 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 4 . 0 
 + * Expose tasks queue length via JMX ( CASSANDRA - 12758 ) 
 * Fix race / ref leak in PendingRepairManager ( CASSANDRA - 13751 ) 
 * Enable ppc64le runtime as unsupported architecture ( CASSANDRA - 13615 ) 
 * Improve sstablemetadata output ( CASSANDRA - 11483 ) 
 diff - - git a / doc / source / operating / metrics . rst b / doc / source / operating / metrics . rst 
 index a38d7c1 . . cfdd584 100644 
 - - - a / doc / source / operating / metrics . rst 
 + + + b / doc / source / operating / metrics . rst 
 @ @ - 193 , 6 + 193 , 7 @ @ CompletedTasks Counter Number of tasks completed . 
 TotalBlockedTasks Counter Number of tasks that were blocked due to queue saturation . 
 CurrentlyBlockedTask Counter Number of tasks that are currently blocked due to queue saturation but on retry will become unblocked . 
 MaxPoolSize Gauge < Integer > The maximum number of threads in this pool . 
 + MaxTasksQueued Gauge < Integer > The maximum number of tasks queued before a task get blocked . 
 = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = = 
 
 The following thread pools can be monitored . 
 diff - - git a / src / java / org / apache / cassandra / concurrent / SEPExecutor . java b / src / java / org / apache / cassandra / concurrent / SEPExecutor . java 
 index c87614b . . add850a 100644 
 - - - a / src / java / org / apache / cassandra / concurrent / SEPExecutor . java 
 + + + b / src / java / org / apache / cassandra / concurrent / SEPExecutor . java 
 @ @ - 35 , 7 + 35 , 7 @ @ public class SEPExecutor extends AbstractLocalAwareExecutorService 
 
 public final int maxWorkers ; 
 public final String name ; 
 - private final int maxTasksQueued ; 
 + public final int maxTasksQueued ; 
 private final SEPMetrics metrics ; 
 
 / / stores both a set of work permits and task permits : 
 diff - - git a / src / java / org / apache / cassandra / metrics / SEPMetrics . java b / src / java / org / apache / cassandra / metrics / SEPMetrics . java 
 index 35f02b4 . . dd1d2d6 100644 
 - - - a / src / java / org / apache / cassandra / metrics / SEPMetrics . java 
 + + + b / src / java / org / apache / cassandra / metrics / SEPMetrics . java 
 @ @ - 41 , 6 + 41 , 8 @ @ public class SEPMetrics 
 public final Gauge < Long > pendingTasks ; 
 / * * Maximum number of threads before it will start queuing tasks * / 
 public final Gauge < Integer > maxPoolSize ; 
 + / * * Maximum number of tasks queued before a task get blocked * / 
 + public final Gauge < Integer > maxTasksQueued ; 
 
 private MetricNameFactory factory ; 
 
 @ @ - 85 , 6 + 87 , 13 @ @ public class SEPMetrics 
 return executor . maxWorkers ; 
 } 
 } ) ; 
 + maxTasksQueued = Metrics . register ( factory . createMetricName ( " MaxTasksQueued " ) , new Gauge < Integer > ( ) 
 + { 
 + public Integer getValue ( ) 
 + { 
 + return executor . maxTasksQueued ; 
 + } 
 + } ) ; 
 } 
 
 public void release ( ) 
 @ @ - 95 , 5 + 104 , 6 @ @ public class SEPMetrics 
 Metrics . remove ( factory . createMetricName ( " TotalBlockedTasks " ) ) ; 
 Metrics . remove ( factory . createMetricName ( " CurrentlyBlockedTasks " ) ) ; 
 Metrics . remove ( factory . createMetricName ( " MaxPoolSize " ) ) ; 
 + Metrics . remove ( factory . createMetricName ( " MaxTasksQueued " ) ) ; 
 } 
 }

NEAREST DIFF:
ELIMINATEDSENTENCE
