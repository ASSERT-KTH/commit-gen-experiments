BLEU SCORE: 1.0

TEST MSG: Add local address entry in PropertyFileSnitch
GENERATED MSG: Add local address entry in PropertyFileSnitch

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index a6a1114 . . fae713e 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 2 . 8 <nl> + * Add local address entry in PropertyFileSnitch ( CASSANDRA - 11332 ) <nl> * cqlshlib tests : increase default execute timeout ( CASSANDRA - 12481 ) <nl> * Forward writes to replacement node when replace _ address ! = broadcast _ address ( CASSANDRA - 8523 ) <nl> * Enable repair - pr and - local together ( fix regression of CASSANDRA - 7450 ) ( CASSANDRA - 12522 ) <nl> diff - - git a / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java b / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java <nl> index bfd8e8e . . 8cc6549 100644 <nl> - - - a / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java <nl> + + + b / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java <nl> @ @ - 186 , 10 + 186 , 17 @ @ public class PropertyFileSnitch extends AbstractNetworkTopologySnitch <nl> reloadedMap . put ( host , token ) ; <nl> } <nl> } <nl> - if ( reloadedDefaultDCRack = = null & & ! reloadedMap . containsKey ( FBUtilities . getBroadcastAddress ( ) ) ) <nl> + InetAddress broadcastAddress = FBUtilities . getBroadcastAddress ( ) ; <nl> + String [ ] localInfo = reloadedMap . get ( broadcastAddress ) ; <nl> + if ( reloadedDefaultDCRack = = null & & localInfo = = null ) <nl> throw new ConfigurationException ( String . format ( " Snitch definitions at % s do not define a location for " + <nl> " this node ' s broadcast address % s , nor does it provides a default " , <nl> - SNITCH _ PROPERTIES _ FILENAME , FBUtilities . getBroadcastAddress ( ) ) ) ; <nl> + SNITCH _ PROPERTIES _ FILENAME , broadcastAddress ) ) ; <nl> + / / OutboundTcpConnectionPool . getEndpoint ( ) converts our broadcast address to local , <nl> + / / make sure we can be found at that as well . <nl> + InetAddress localAddress = FBUtilities . getLocalAddress ( ) ; <nl> + if ( ! localAddress . equals ( broadcastAddress ) & & ! reloadedMap . containsKey ( localAddress ) ) <nl> + reloadedMap . put ( localAddress , localInfo ) ; <nl> <nl> if ( isUpdate & & ! livenessCheck ( reloadedMap , reloadedDefaultDCRack ) ) <nl> return ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index a6a1114 . . fae713e 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 2 . 8 
 + * Add local address entry in PropertyFileSnitch ( CASSANDRA - 11332 ) 
 * cqlshlib tests : increase default execute timeout ( CASSANDRA - 12481 ) 
 * Forward writes to replacement node when replace _ address ! = broadcast _ address ( CASSANDRA - 8523 ) 
 * Enable repair - pr and - local together ( fix regression of CASSANDRA - 7450 ) ( CASSANDRA - 12522 ) 
 diff - - git a / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java b / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java 
 index bfd8e8e . . 8cc6549 100644 
 - - - a / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java 
 + + + b / src / java / org / apache / cassandra / locator / PropertyFileSnitch . java 
 @ @ - 186 , 10 + 186 , 17 @ @ public class PropertyFileSnitch extends AbstractNetworkTopologySnitch 
 reloadedMap . put ( host , token ) ; 
 } 
 } 
 - if ( reloadedDefaultDCRack = = null & & ! reloadedMap . containsKey ( FBUtilities . getBroadcastAddress ( ) ) ) 
 + InetAddress broadcastAddress = FBUtilities . getBroadcastAddress ( ) ; 
 + String [ ] localInfo = reloadedMap . get ( broadcastAddress ) ; 
 + if ( reloadedDefaultDCRack = = null & & localInfo = = null ) 
 throw new ConfigurationException ( String . format ( " Snitch definitions at % s do not define a location for " + 
 " this node ' s broadcast address % s , nor does it provides a default " , 
 - SNITCH _ PROPERTIES _ FILENAME , FBUtilities . getBroadcastAddress ( ) ) ) ; 
 + SNITCH _ PROPERTIES _ FILENAME , broadcastAddress ) ) ; 
 + / / OutboundTcpConnectionPool . getEndpoint ( ) converts our broadcast address to local , 
 + / / make sure we can be found at that as well . 
 + InetAddress localAddress = FBUtilities . getLocalAddress ( ) ; 
 + if ( ! localAddress . equals ( broadcastAddress ) & & ! reloadedMap . containsKey ( localAddress ) ) 
 + reloadedMap . put ( localAddress , localInfo ) ; 
 
 if ( isUpdate & & ! livenessCheck ( reloadedMap , reloadedDefaultDCRack ) ) 
 return ;

NEAREST DIFF:
ELIMINATEDSENTENCE
