BLEU SCORE: 0.0015221056021476422

TEST MSG: minor javadoc fix
GENERATED MSG: make BootStrapperTest use of TokenMetadata match actual BootStrapper use better . patch by jbellis for CASSANDRA - 502

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / util / FileUtils . java b / src / java / org / apache / cassandra / io / util / FileUtils . java <nl> index cbed4f8 . . 76f6389 100644 <nl> - - - a / src / java / org / apache / cassandra / io / util / FileUtils . java <nl> + + + b / src / java / org / apache / cassandra / io / util / FileUtils . java <nl> @ @ - 450 , 7 + 450 , 7 @ @ public class FileUtils <nl> <nl> / * * <nl> * Get the size of a directory in bytes <nl> - * @ param The directory for which we need size . <nl> + * @ param directory The directory for which we need size . <nl> * @ return The size of the directory <nl> * / <nl> public static long folderSize ( File directory )
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index a7042de . . 93d1a15 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 285 , 12 + 285 , 6 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto <nl> return tokenMetadata _ ; <nl> } <nl> <nl> - / * TODO : used for testing * / <nl> - public void updateTokenMetadataUnsafe ( Token token , InetAddress endpoint ) <nl> - { <nl> - tokenMetadata _ . update ( token , endpoint ) ; <nl> - } <nl> - <nl> public IEndPointSnitch getEndPointSnitch ( ) <nl> { <nl> return endPointSnitch _ ; <nl> diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> index 130e88c . . 37b24e2 100644 <nl> - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java <nl> @ @ - 64 , 7 + 64 , 7 @ @ public class FBUtilities <nl> } <nl> return localInetAddress _ ; <nl> } <nl> - <nl> + <nl> public static byte [ ] toByteArray ( int i ) <nl> { <nl> byte [ ] bytes = new byte [ 4 ] ; <nl> diff - - git a / test / unit / org / apache / cassandra / dht / BootStrapperTest . java b / test / unit / org / apache / cassandra / dht / BootStrapperTest . java <nl> index 5d1be56 . . 46e91a2 100644 <nl> - - - a / test / unit / org / apache / cassandra / dht / BootStrapperTest . java <nl> + + + b / test / unit / org / apache / cassandra / dht / BootStrapperTest . java <nl> @ @ - 44 , 16 + 44 , 15 @ @ public class BootStrapperTest { <nl> <nl> private void testSourceTargetComputation ( int numOldNodes ) throws UnknownHostException <nl> { <nl> + StorageService ss = StorageService . instance ( ) ; <nl> + <nl> generateFakeEndpoints ( numOldNodes ) ; <nl> <nl> Token myToken = StorageService . getPartitioner ( ) . getDefaultToken ( ) ; <nl> InetAddress myEndpoint = InetAddress . getByName ( " 127 . 0 . 0 . 1 " ) ; <nl> - <nl> - StorageService ss = StorageService . instance ( ) ; <nl> - ss . updateTokenMetadataUnsafe ( myToken , myEndpoint ) ; <nl> <nl> TokenMetadata tmd = ss . getTokenMetadata ( ) ; <nl> - assertEquals ( numOldNodes + 1 , tmd . cloneTokenEndPointMap ( ) . size ( ) ) ; <nl> + assertEquals ( numOldNodes , tmd . cloneTokenEndPointMap ( ) . size ( ) ) ; <nl> BootStrapper b = new BootStrapper ( ss . getReplicationStrategy ( ) , myEndpoint , myToken , tmd ) ; <nl> Map < Range , Set < InetAddress > > res = b . getRangesWithSources ( ) ; <nl>

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / util / FileUtils . java b / src / java / org / apache / cassandra / io / util / FileUtils . java 
 index cbed4f8 . . 76f6389 100644 
 - - - a / src / java / org / apache / cassandra / io / util / FileUtils . java 
 + + + b / src / java / org / apache / cassandra / io / util / FileUtils . java 
 @ @ - 450 , 7 + 450 , 7 @ @ public class FileUtils 
 
 / * * 
 * Get the size of a directory in bytes 
 - * @ param The directory for which we need size . 
 + * @ param directory The directory for which we need size . 
 * @ return The size of the directory 
 * / 
 public static long folderSize ( File directory )

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index a7042de . . 93d1a15 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 285 , 12 + 285 , 6 @ @ public final class StorageService implements IEndPointStateChangeSubscriber , Sto 
 return tokenMetadata _ ; 
 } 
 
 - / * TODO : used for testing * / 
 - public void updateTokenMetadataUnsafe ( Token token , InetAddress endpoint ) 
 - { 
 - tokenMetadata _ . update ( token , endpoint ) ; 
 - } 
 - 
 public IEndPointSnitch getEndPointSnitch ( ) 
 { 
 return endPointSnitch _ ; 
 diff - - git a / src / java / org / apache / cassandra / utils / FBUtilities . java b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 index 130e88c . . 37b24e2 100644 
 - - - a / src / java / org / apache / cassandra / utils / FBUtilities . java 
 + + + b / src / java / org / apache / cassandra / utils / FBUtilities . java 
 @ @ - 64 , 7 + 64 , 7 @ @ public class FBUtilities 
 } 
 return localInetAddress _ ; 
 } 
 - 
 + 
 public static byte [ ] toByteArray ( int i ) 
 { 
 byte [ ] bytes = new byte [ 4 ] ; 
 diff - - git a / test / unit / org / apache / cassandra / dht / BootStrapperTest . java b / test / unit / org / apache / cassandra / dht / BootStrapperTest . java 
 index 5d1be56 . . 46e91a2 100644 
 - - - a / test / unit / org / apache / cassandra / dht / BootStrapperTest . java 
 + + + b / test / unit / org / apache / cassandra / dht / BootStrapperTest . java 
 @ @ - 44 , 16 + 44 , 15 @ @ public class BootStrapperTest { 
 
 private void testSourceTargetComputation ( int numOldNodes ) throws UnknownHostException 
 { 
 + StorageService ss = StorageService . instance ( ) ; 
 + 
 generateFakeEndpoints ( numOldNodes ) ; 
 
 Token myToken = StorageService . getPartitioner ( ) . getDefaultToken ( ) ; 
 InetAddress myEndpoint = InetAddress . getByName ( " 127 . 0 . 0 . 1 " ) ; 
 - 
 - StorageService ss = StorageService . instance ( ) ; 
 - ss . updateTokenMetadataUnsafe ( myToken , myEndpoint ) ; 
 
 TokenMetadata tmd = ss . getTokenMetadata ( ) ; 
 - assertEquals ( numOldNodes + 1 , tmd . cloneTokenEndPointMap ( ) . size ( ) ) ; 
 + assertEquals ( numOldNodes , tmd . cloneTokenEndPointMap ( ) . size ( ) ) ; 
 BootStrapper b = new BootStrapper ( ss . getReplicationStrategy ( ) , myEndpoint , myToken , tmd ) ; 
 Map < Range , Set < InetAddress > > res = b . getRangesWithSources ( ) ; 

