BLEU SCORE: 0.056697911109760024

TEST MSG: Read message id as string from older nodes .
GENERATED MSG: merge from 1 . 2

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index e208e21 . . 2b8dea8 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 7 , 6 + 7 , 7 @ @ <nl> * Restore expiring - > deleted ( cell ) compaction optimization ( CASSANDRA - 6844 ) <nl> * Fix CompactionManager . needsCleanup ( CASSANDRA - 6845 ) <nl> * Correctly compare BooleanType values other than 0 and 1 ( CASSANDRA - 6779 ) <nl> + * Read message id as string from earlier versions ( CASSANDRA - 6840 ) <nl> Merged from 1 . 2 : <nl> * fix nodetool getsstables for blob PK ( CASSANDRA - 6803 ) <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java b / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java <nl> index dcdfc2e . . da7fa6a 100644 <nl> - - - a / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java <nl> + + + b / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java <nl> @ @ - 46 , 7 + 46 , 7 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > <nl> replyTo = message . from ; <nl> byte [ ] forwardBytes = message . parameters . get ( RowMutation . FORWARD _ TO ) ; <nl> if ( forwardBytes ! = null ) <nl> - forwardToLocalNodes ( rm , message . verb , forwardBytes , message . from ) ; <nl> + forwardToLocalNodes ( rm , message . verb , forwardBytes , message . from , message . version ) ; <nl> } <nl> else <nl> { <nl> @ @ - 68 , 7 + 68 , 7 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > <nl> * Older version ( < 1 . 0 ) will not send this message at all , hence we don ' t <nl> * need to check the version of the data . <nl> * / <nl> - private void forwardToLocalNodes ( RowMutation rm , MessagingService . Verb verb , byte [ ] forwardBytes , InetAddress from ) throws IOException <nl> + private void forwardToLocalNodes ( RowMutation rm , MessagingService . Verb verb , byte [ ] forwardBytes , InetAddress from , int version ) throws IOException <nl> { <nl> DataInputStream in = new DataInputStream ( new FastByteArrayInputStream ( forwardBytes ) ) ; <nl> int size = in . readInt ( ) ; <nl> @ @ - 79 , 7 + 79 , 16 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > <nl> for ( int i = 0 ; i < size ; i + + ) <nl> { <nl> InetAddress address = CompactEndpointSerializationHelper . deserialize ( in ) ; <nl> - int id = in . readInt ( ) ; <nl> + int id ; <nl> + if ( version < MessagingService . VERSION _ 20 ) <nl> + { <nl> + String s = in . readUTF ( ) ; <nl> + id = Integer . parseInt ( s ) ; <nl> + } <nl> + else <nl> + { <nl> + id = in . readInt ( ) ; <nl> + } <nl> Tracing . trace ( " Enqueuing forwarded write to { } " , address ) ; <nl> MessagingService . instance ( ) . sendOneWay ( message , id , address ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b935425 . . 7f5a487 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 - rc1 <nl> + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) <nl> * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) <nl> * save truncation position in system table ( CASSANDRA - 4906 ) <nl> * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) <nl> diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py <nl> index d15c083 . . bab3506 100644 <nl> - - - a / pylib / cqlshlib / formatting . py <nl> + + + b / pylib / cqlshlib / formatting . py <nl> @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : <nl> return f <nl> return registrator <nl> <nl> - @ formatter _ for ( ' bytes ' ) <nl> - def format _ value _ bytes ( val , colormap , * * _ ) : <nl> + @ formatter _ for ( ' blob ' ) <nl> + def format _ value _ blob ( val , colormap , * * _ ) : <nl> bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) <nl> return colorme ( bval , colormap , ' hex ' ) <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index e208e21 . . 2b8dea8 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 7 , 6 + 7 , 7 @ @ 
 * Restore expiring - > deleted ( cell ) compaction optimization ( CASSANDRA - 6844 ) 
 * Fix CompactionManager . needsCleanup ( CASSANDRA - 6845 ) 
 * Correctly compare BooleanType values other than 0 and 1 ( CASSANDRA - 6779 ) 
 + * Read message id as string from earlier versions ( CASSANDRA - 6840 ) 
 Merged from 1 . 2 : 
 * fix nodetool getsstables for blob PK ( CASSANDRA - 6803 ) 
 
 diff - - git a / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java b / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java 
 index dcdfc2e . . da7fa6a 100644 
 - - - a / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java 
 + + + b / src / java / org / apache / cassandra / db / RowMutationVerbHandler . java 
 @ @ - 46 , 7 + 46 , 7 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > 
 replyTo = message . from ; 
 byte [ ] forwardBytes = message . parameters . get ( RowMutation . FORWARD _ TO ) ; 
 if ( forwardBytes ! = null ) 
 - forwardToLocalNodes ( rm , message . verb , forwardBytes , message . from ) ; 
 + forwardToLocalNodes ( rm , message . verb , forwardBytes , message . from , message . version ) ; 
 } 
 else 
 { 
 @ @ - 68 , 7 + 68 , 7 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > 
 * Older version ( < 1 . 0 ) will not send this message at all , hence we don ' t 
 * need to check the version of the data . 
 * / 
 - private void forwardToLocalNodes ( RowMutation rm , MessagingService . Verb verb , byte [ ] forwardBytes , InetAddress from ) throws IOException 
 + private void forwardToLocalNodes ( RowMutation rm , MessagingService . Verb verb , byte [ ] forwardBytes , InetAddress from , int version ) throws IOException 
 { 
 DataInputStream in = new DataInputStream ( new FastByteArrayInputStream ( forwardBytes ) ) ; 
 int size = in . readInt ( ) ; 
 @ @ - 79 , 7 + 79 , 16 @ @ public class RowMutationVerbHandler implements IVerbHandler < RowMutation > 
 for ( int i = 0 ; i < size ; i + + ) 
 { 
 InetAddress address = CompactEndpointSerializationHelper . deserialize ( in ) ; 
 - int id = in . readInt ( ) ; 
 + int id ; 
 + if ( version < MessagingService . VERSION _ 20 ) 
 + { 
 + String s = in . readUTF ( ) ; 
 + id = Integer . parseInt ( s ) ; 
 + } 
 + else 
 + { 
 + id = in . readInt ( ) ; 
 + } 
 Tracing . trace ( " Enqueuing forwarded write to { } " , address ) ; 
 MessagingService . instance ( ) . sendOneWay ( message , id , address ) ; 
 }

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b935425 . . 7f5a487 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 - rc1 
 + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) 
 * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) 
 * save truncation position in system table ( CASSANDRA - 4906 ) 
 * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) 
 diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py 
 index d15c083 . . bab3506 100644 
 - - - a / pylib / cqlshlib / formatting . py 
 + + + b / pylib / cqlshlib / formatting . py 
 @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : 
 return f 
 return registrator 
 
 - @ formatter _ for ( ' bytes ' ) 
 - def format _ value _ bytes ( val , colormap , * * _ ) : 
 + @ formatter _ for ( ' blob ' ) 
 + def format _ value _ blob ( val , colormap , * * _ ) : 
 bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) 
 return colorme ( bval , colormap , ' hex ' ) 

