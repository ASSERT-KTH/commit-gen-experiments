BLEU SCORE: 0.16451929399933107

TEST MSG: Bump 2 . 2 version to 2 . 2 . 5 in build . xml
GENERATED MSG: update version to 2 . 1

TEST DIFF (one line): diff - - git a / build . xml b / build . xml <nl> index 72ceb65 . . e5fefed 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 25 , 7 + 25 , 7 @ @ <nl> < property name = " debuglevel " value = " source , lines , vars " / > <nl> <nl> < ! - - default version and SCM information - - > <nl> - < property name = " base . version " value = " 2 . 2 . 4 " / > <nl> + < property name = " base . version " value = " 2 . 2 . 5 " / > <nl> < property name = " scm . connection " value = " scm : git : / / git . apache . org / cassandra . git " / > <nl> < property name = " scm . developerConnection " value = " scm : git : / / git . apache . org / cassandra . git " / > <nl> < property name = " scm . url " value = " http : / / git - wip - us . apache . org / repos / asf ? p = cassandra . git ; a = tree " / >
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 1c09589 . . 51be09d 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 15 , 6 + 15 , 7 @ @ <nl> * Allow empty CQL3 batches ( as no - op ) ( CASSANDRA - 5994 ) <nl> * Support null in CQL3 functions ( CASSANDRA - 5910 ) <nl> * Replace the deprecated MapMaker with CacheLoader ( CASSANDRA - 6007 ) <nl> + * Add SSTableDeletingNotification to DataTracker ( CASSANDRA - 6010 ) <nl> <nl> <nl> 1 . 2 . 9 <nl> diff - - git a / src / java / org / apache / cassandra / db / DataTracker . java b / src / java / org / apache / cassandra / db / DataTracker . java <nl> index 7f6e94c . . b2f52a9 100644 <nl> - - - a / src / java / org / apache / cassandra / db / DataTracker . java <nl> + + + b / src / java / org / apache / cassandra / db / DataTracker . java <nl> @ @ - 34 , 6 + 34 , 7 @ @ import org . apache . cassandra . metrics . StorageMetrics ; <nl> import org . apache . cassandra . notifications . INotification ; <nl> import org . apache . cassandra . notifications . INotificationConsumer ; <nl> import org . apache . cassandra . notifications . SSTableAddedNotification ; <nl> + import org . apache . cassandra . notifications . SSTableDeletingNotification ; <nl> import org . apache . cassandra . notifications . SSTableListChangedNotification ; <nl> import org . apache . cassandra . utils . Interval ; <nl> import org . apache . cassandra . utils . IntervalTree ; <nl> @ @ - 412 , 11 + 413 , 16 @ @ public class DataTracker <nl> <nl> public void notifyAdded ( SSTableReader added ) <nl> { <nl> + INotification notification = new SSTableAddedNotification ( added ) ; <nl> + for ( INotificationConsumer subscriber : subscribers ) <nl> + subscriber . handleNotification ( notification , this ) ; <nl> + } <nl> + <nl> + public void notifyDeleting ( SSTableReader deleting ) <nl> + { <nl> + INotification notification = new SSTableDeletingNotification ( deleting ) ; <nl> for ( INotificationConsumer subscriber : subscribers ) <nl> - { <nl> - INotification notification = new SSTableAddedNotification ( added ) ; <nl> subscriber . handleNotification ( notification , this ) ; <nl> - } <nl> } <nl> <nl> public void subscribe ( INotificationConsumer consumer ) <nl> diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java b / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java <nl> index 2335b7d . . 8bdc733 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java <nl> @ @ - 41 , 13 + 41 , 15 @ @ public class SSTableDeletingTask implements Runnable <nl> / / will be recognized as GCable . <nl> private static final Set < SSTableDeletingTask > failedTasks = new CopyOnWriteArraySet < SSTableDeletingTask > ( ) ; <nl> <nl> - public final Descriptor desc ; <nl> - public final Set < Component > components ; <nl> + private final SSTableReader referent ; <nl> + private final Descriptor desc ; <nl> + private final Set < Component > components ; <nl> private DataTracker tracker ; <nl> private final long size ; <nl> <nl> public SSTableDeletingTask ( SSTableReader referent ) <nl> { <nl> + this . referent = referent ; <nl> this . desc = referent . descriptor ; <nl> this . components = referent . components ; <nl> this . size = referent . bytesOnDisk ( ) ; <nl> @ @ - 65 , 6 + 67 , 8 @ @ public class SSTableDeletingTask implements Runnable <nl> <nl> public void run ( ) <nl> { <nl> + tracker . notifyDeleting ( referent ) ; <nl> + <nl> / / If we can ' t successfully delete the DATA component , set the task to be retried later : see above <nl> File datafile = new File ( desc . filenameFor ( Component . DATA ) ) ; <nl> if ( ! datafile . delete ( ) ) <nl> diff - - git a / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java b / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java <nl> new file mode 100644 <nl> index 0000000 . . 8b0f597 <nl> - - - / dev / null <nl> + + + b / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java <nl> @ @ - 0 , 0 + 1 , 33 @ @ <nl> + / * <nl> + * Licensed to the Apache Software Foundation ( ASF ) under one <nl> + * or more contributor license agreements . See the NOTICE file <nl> + * distributed with this work for additional information <nl> + * regarding copyright ownership . The ASF licenses this file <nl> + * to you under the Apache License , Version 2 . 0 ( the <nl> + * " License " ) ; you may not use this file except in compliance <nl> + * with the License . You may obtain a copy of the License at <nl> + * <nl> + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 <nl> + * <nl> + * Unless required by applicable law or agreed to in writing , software <nl> + * distributed under the License is distributed on an " AS IS " BASIS , <nl> + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . <nl> + * See the License for the specific language governing permissions and <nl> + * limitations under the License . <nl> + * / <nl> + package org . apache . cassandra . notifications ; <nl> + <nl> + import org . apache . cassandra . io . sstable . SSTableReader ; <nl> + <nl> + / * * <nl> + * Fired right before removing an SSTable . <nl> + * / <nl> + public class SSTableDeletingNotification implements INotification <nl> + { <nl> + public final SSTableReader deleting ; <nl> + <nl> + public SSTableDeletingNotification ( SSTableReader deleting ) <nl> + { <nl> + this . deleting = deleting ; <nl> + } <nl> + }

TEST DIFF:
diff - - git a / build . xml b / build . xml 
 index 72ceb65 . . e5fefed 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 25 , 7 + 25 , 7 @ @ 
 < property name = " debuglevel " value = " source , lines , vars " / > 
 
 < ! - - default version and SCM information - - > 
 - < property name = " base . version " value = " 2 . 2 . 4 " / > 
 + < property name = " base . version " value = " 2 . 2 . 5 " / > 
 < property name = " scm . connection " value = " scm : git : / / git . apache . org / cassandra . git " / > 
 < property name = " scm . developerConnection " value = " scm : git : / / git . apache . org / cassandra . git " / > 
 < property name = " scm . url " value = " http : / / git - wip - us . apache . org / repos / asf ? p = cassandra . git ; a = tree " / >

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 1c09589 . . 51be09d 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 15 , 6 + 15 , 7 @ @ 
 * Allow empty CQL3 batches ( as no - op ) ( CASSANDRA - 5994 ) 
 * Support null in CQL3 functions ( CASSANDRA - 5910 ) 
 * Replace the deprecated MapMaker with CacheLoader ( CASSANDRA - 6007 ) 
 + * Add SSTableDeletingNotification to DataTracker ( CASSANDRA - 6010 ) 
 
 
 1 . 2 . 9 
 diff - - git a / src / java / org / apache / cassandra / db / DataTracker . java b / src / java / org / apache / cassandra / db / DataTracker . java 
 index 7f6e94c . . b2f52a9 100644 
 - - - a / src / java / org / apache / cassandra / db / DataTracker . java 
 + + + b / src / java / org / apache / cassandra / db / DataTracker . java 
 @ @ - 34 , 6 + 34 , 7 @ @ import org . apache . cassandra . metrics . StorageMetrics ; 
 import org . apache . cassandra . notifications . INotification ; 
 import org . apache . cassandra . notifications . INotificationConsumer ; 
 import org . apache . cassandra . notifications . SSTableAddedNotification ; 
 + import org . apache . cassandra . notifications . SSTableDeletingNotification ; 
 import org . apache . cassandra . notifications . SSTableListChangedNotification ; 
 import org . apache . cassandra . utils . Interval ; 
 import org . apache . cassandra . utils . IntervalTree ; 
 @ @ - 412 , 11 + 413 , 16 @ @ public class DataTracker 
 
 public void notifyAdded ( SSTableReader added ) 
 { 
 + INotification notification = new SSTableAddedNotification ( added ) ; 
 + for ( INotificationConsumer subscriber : subscribers ) 
 + subscriber . handleNotification ( notification , this ) ; 
 + } 
 + 
 + public void notifyDeleting ( SSTableReader deleting ) 
 + { 
 + INotification notification = new SSTableDeletingNotification ( deleting ) ; 
 for ( INotificationConsumer subscriber : subscribers ) 
 - { 
 - INotification notification = new SSTableAddedNotification ( added ) ; 
 subscriber . handleNotification ( notification , this ) ; 
 - } 
 } 
 
 public void subscribe ( INotificationConsumer consumer ) 
 diff - - git a / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java b / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java 
 index 2335b7d . . 8bdc733 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / SSTableDeletingTask . java 
 @ @ - 41 , 13 + 41 , 15 @ @ public class SSTableDeletingTask implements Runnable 
 / / will be recognized as GCable . 
 private static final Set < SSTableDeletingTask > failedTasks = new CopyOnWriteArraySet < SSTableDeletingTask > ( ) ; 
 
 - public final Descriptor desc ; 
 - public final Set < Component > components ; 
 + private final SSTableReader referent ; 
 + private final Descriptor desc ; 
 + private final Set < Component > components ; 
 private DataTracker tracker ; 
 private final long size ; 
 
 public SSTableDeletingTask ( SSTableReader referent ) 
 { 
 + this . referent = referent ; 
 this . desc = referent . descriptor ; 
 this . components = referent . components ; 
 this . size = referent . bytesOnDisk ( ) ; 
 @ @ - 65 , 6 + 67 , 8 @ @ public class SSTableDeletingTask implements Runnable 
 
 public void run ( ) 
 { 
 + tracker . notifyDeleting ( referent ) ; 
 + 
 / / If we can ' t successfully delete the DATA component , set the task to be retried later : see above 
 File datafile = new File ( desc . filenameFor ( Component . DATA ) ) ; 
 if ( ! datafile . delete ( ) ) 
 diff - - git a / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java b / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java 
 new file mode 100644 
 index 0000000 . . 8b0f597 
 - - - / dev / null 
 + + + b / src / java / org / apache / cassandra / notifications / SSTableDeletingNotification . java 
 @ @ - 0 , 0 + 1 , 33 @ @ 
 + / * 
 + * Licensed to the Apache Software Foundation ( ASF ) under one 
 + * or more contributor license agreements . See the NOTICE file 
 + * distributed with this work for additional information 
 + * regarding copyright ownership . The ASF licenses this file 
 + * to you under the Apache License , Version 2 . 0 ( the 
 + * " License " ) ; you may not use this file except in compliance 
 + * with the License . You may obtain a copy of the License at 
 + * 
 + * http : / / www . apache . org / licenses / LICENSE - 2 . 0 
 + * 
 + * Unless required by applicable law or agreed to in writing , software 
 + * distributed under the License is distributed on an " AS IS " BASIS , 
 + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND , either express or implied . 
 + * See the License for the specific language governing permissions and 
 + * limitations under the License . 
 + * / 
 + package org . apache . cassandra . notifications ; 
 + 
 + import org . apache . cassandra . io . sstable . SSTableReader ; 
 + 
 + / * * 
 + * Fired right before removing an SSTable . 
 + * / 
 + public class SSTableDeletingNotification implements INotification 
 + { 
 + public final SSTableReader deleting ; 
 + 
 + public SSTableDeletingNotification ( SSTableReader deleting ) 
 + { 
 + this . deleting = deleting ; 
 + } 
 + }
