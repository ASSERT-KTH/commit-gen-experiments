BLEU SCORE: 0.06220117374063391

TEST MSG: Fix bootstrapping with MVs
GENERATED MSG: merge from 1 . 2

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 1dd1ed2 . . 6873edd 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 <nl> + * Fix bootstrapping with MVs ( CASSANDRA - 10621 ) <nl> * Make sure EACH _ QUORUM reads are using NTS ( CASSANDRA - 10584 ) <nl> * Fix MV replica filtering for non - NetworkTopologyStrategy ( CASSANDRA - 10634 ) <nl> * ( Hadoop ) fix CIF describeSplits ( ) not handling 0 size estimates ( CASSANDRA - 10600 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> index 4986a26 . . 6bcc2f8 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageProxy . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageProxy . java <nl> @ @ - 667 , 7 + 667 , 7 @ @ public class StorageProxy implements StorageProxyMBean <nl> / / if we haven ' t joined the ring , write everything to batchlog because paired replicas may be stale <nl> final UUID batchUUID = UUIDGen . getTimeUUID ( ) ; <nl> <nl> - if ( ! Gossiper . instance . isEnabled ( ) ) <nl> + if ( StorageService . instance . isStarting ( ) | | StorageService . instance . isJoining ( ) | | StorageService . instance . isMoving ( ) ) <nl> { <nl> BatchlogManager . store ( Batch . createLocal ( batchUUID , FBUtilities . timestampMicros ( ) , <nl> mutations ) , <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 75c2fd9 . . 3701e28 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 3869 , 6 + 3869 , 16 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> return operationMode = = Mode . STARTING ; <nl> } <nl> <nl> + public boolean isMoving ( ) <nl> + { <nl> + return operationMode = = Mode . MOVING ; <nl> + } <nl> + <nl> + public boolean isJoining ( ) <nl> + { <nl> + return operationMode = = Mode . JOINING ; <nl> + } <nl> + <nl> public String getDrainProgress ( ) <nl> { <nl> return String . format ( " Drained % s / % s ColumnFamilies " , remainingCFs , totalCFs ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b935425 . . 7f5a487 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 1 . 2 - rc1 <nl> + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) <nl> * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) <nl> * save truncation position in system table ( CASSANDRA - 4906 ) <nl> * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) <nl> diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py <nl> index d15c083 . . bab3506 100644 <nl> - - - a / pylib / cqlshlib / formatting . py <nl> + + + b / pylib / cqlshlib / formatting . py <nl> @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : <nl> return f <nl> return registrator <nl> <nl> - @ formatter _ for ( ' bytes ' ) <nl> - def format _ value _ bytes ( val , colormap , * * _ ) : <nl> + @ formatter _ for ( ' blob ' ) <nl> + def format _ value _ blob ( val , colormap , * * _ ) : <nl> bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) <nl> return colorme ( bval , colormap , ' hex ' ) <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 1dd1ed2 . . 6873edd 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 
 + * Fix bootstrapping with MVs ( CASSANDRA - 10621 ) 
 * Make sure EACH _ QUORUM reads are using NTS ( CASSANDRA - 10584 ) 
 * Fix MV replica filtering for non - NetworkTopologyStrategy ( CASSANDRA - 10634 ) 
 * ( Hadoop ) fix CIF describeSplits ( ) not handling 0 size estimates ( CASSANDRA - 10600 ) 
 diff - - git a / src / java / org / apache / cassandra / service / StorageProxy . java b / src / java / org / apache / cassandra / service / StorageProxy . java 
 index 4986a26 . . 6bcc2f8 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageProxy . java 
 + + + b / src / java / org / apache / cassandra / service / StorageProxy . java 
 @ @ - 667 , 7 + 667 , 7 @ @ public class StorageProxy implements StorageProxyMBean 
 / / if we haven ' t joined the ring , write everything to batchlog because paired replicas may be stale 
 final UUID batchUUID = UUIDGen . getTimeUUID ( ) ; 
 
 - if ( ! Gossiper . instance . isEnabled ( ) ) 
 + if ( StorageService . instance . isStarting ( ) | | StorageService . instance . isJoining ( ) | | StorageService . instance . isMoving ( ) ) 
 { 
 BatchlogManager . store ( Batch . createLocal ( batchUUID , FBUtilities . timestampMicros ( ) , 
 mutations ) , 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 75c2fd9 . . 3701e28 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 3869 , 6 + 3869 , 16 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 return operationMode = = Mode . STARTING ; 
 } 
 
 + public boolean isMoving ( ) 
 + { 
 + return operationMode = = Mode . MOVING ; 
 + } 
 + 
 + public boolean isJoining ( ) 
 + { 
 + return operationMode = = Mode . JOINING ; 
 + } 
 + 
 public String getDrainProgress ( ) 
 { 
 return String . format ( " Drained % s / % s ColumnFamilies " , remainingCFs , totalCFs ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b935425 . . 7f5a487 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 1 . 2 - rc1 
 + * fix cqlsh rendering of blob fields ( CASSANDRA - 4970 ) 
 * fix cqlsh DESCRIBE command ( CASSANDRA - 4913 ) 
 * save truncation position in system table ( CASSANDRA - 4906 ) 
 * Move CompressionMetadata off - heap ( CASSANDRA - 4937 ) 
 diff - - git a / pylib / cqlshlib / formatting . py b / pylib / cqlshlib / formatting . py 
 index d15c083 . . bab3506 100644 
 - - - a / pylib / cqlshlib / formatting . py 
 + + + b / pylib / cqlshlib / formatting . py 
 @ @ - 88 , 8 + 88 , 8 @ @ def formatter _ for ( typname ) : 
 return f 
 return registrator 
 
 - @ formatter _ for ( ' bytes ' ) 
 - def format _ value _ bytes ( val , colormap , * * _ ) : 
 + @ formatter _ for ( ' blob ' ) 
 + def format _ value _ blob ( val , colormap , * * _ ) : 
 bval = ' ' . join ( ' % 02x ' % ord ( c ) for c in val ) 
 return colorme ( bval , colormap , ' hex ' ) 

