BLEU SCORE: 0.02383853510228548

TEST MSG: Use only one file pointer when creating commitlog segments
GENERATED MSG: Fix truncate to always call flush on table

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index c8419ab . . 4295dd8 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 2 . 9 <nl> + * Use only one file pointer when creating commitlog segments ( CASSANDRA - 12539 ) <nl> * Fix speculative retry bugs ( CASSANDRA - 13009 ) <nl> * Fix handling of nulls and unsets in IN conditions ( CASSANDRA - 12981 ) <nl> * Remove support for non - JavaScript UDFs ( CASSANDRA - 12883 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java b / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java <nl> index e240a91 . . fa9ef37 100644 <nl> - - - a / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java <nl> + + + b / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java <nl> @ @ - 18 , 7 + 18 , 6 @ @ <nl> package org . apache . cassandra . db . commitlog ; <nl> <nl> import java . io . IOException ; <nl> - import java . io . RandomAccessFile ; <nl> import java . nio . ByteBuffer ; <nl> import java . nio . MappedByteBuffer ; <nl> import java . nio . channels . FileChannel ; <nl> @ @ - 55 , 21 + 54 , 9 @ @ public class MemoryMappedSegment extends CommitLogSegment <nl> { <nl> try <nl> { <nl> - / / Extend the file size to the standard segment size . <nl> - / / NOTE : while we ' re using RAF to easily adjust file size , we need to avoid using RAF <nl> - / / for grabbing the FileChannel due to FILE _ SHARE _ DELETE flag bug on windows . <nl> - / / See : https : / / bugs . openjdk . java . net / browse / JDK - 6357433 and CASSANDRA - 8308 <nl> - try ( RandomAccessFile raf = new RandomAccessFile ( logFile , " rw " ) ) <nl> - { <nl> - raf . setLength ( DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; <nl> - } <nl> - catch ( IOException e ) <nl> - { <nl> - throw new FSWriteError ( e , logFile ) ; <nl> - } <nl> + MappedByteBuffer mappedFile = channel . map ( FileChannel . MapMode . READ _ WRITE , 0 , DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; <nl> commitLog . allocator . addSize ( DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; <nl> - <nl> - return channel . map ( FileChannel . MapMode . READ _ WRITE , 0 , DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; <nl> + return mappedFile ; <nl> } <nl> catch ( IOException e ) <nl> {
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index c8419ab . . 4295dd8 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 2 . 9 
 + * Use only one file pointer when creating commitlog segments ( CASSANDRA - 12539 ) 
 * Fix speculative retry bugs ( CASSANDRA - 13009 ) 
 * Fix handling of nulls and unsets in IN conditions ( CASSANDRA - 12981 ) 
 * Remove support for non - JavaScript UDFs ( CASSANDRA - 12883 ) 
 diff - - git a / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java b / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java 
 index e240a91 . . fa9ef37 100644 
 - - - a / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java 
 + + + b / src / java / org / apache / cassandra / db / commitlog / MemoryMappedSegment . java 
 @ @ - 18 , 7 + 18 , 6 @ @ 
 package org . apache . cassandra . db . commitlog ; 
 
 import java . io . IOException ; 
 - import java . io . RandomAccessFile ; 
 import java . nio . ByteBuffer ; 
 import java . nio . MappedByteBuffer ; 
 import java . nio . channels . FileChannel ; 
 @ @ - 55 , 21 + 54 , 9 @ @ public class MemoryMappedSegment extends CommitLogSegment 
 { 
 try 
 { 
 - / / Extend the file size to the standard segment size . 
 - / / NOTE : while we ' re using RAF to easily adjust file size , we need to avoid using RAF 
 - / / for grabbing the FileChannel due to FILE _ SHARE _ DELETE flag bug on windows . 
 - / / See : https : / / bugs . openjdk . java . net / browse / JDK - 6357433 and CASSANDRA - 8308 
 - try ( RandomAccessFile raf = new RandomAccessFile ( logFile , " rw " ) ) 
 - { 
 - raf . setLength ( DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; 
 - } 
 - catch ( IOException e ) 
 - { 
 - throw new FSWriteError ( e , logFile ) ; 
 - } 
 + MappedByteBuffer mappedFile = channel . map ( FileChannel . MapMode . READ _ WRITE , 0 , DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; 
 commitLog . allocator . addSize ( DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; 
 - 
 - return channel . map ( FileChannel . MapMode . READ _ WRITE , 0 , DatabaseDescriptor . getCommitLogSegmentSize ( ) ) ; 
 + return mappedFile ; 
 } 
 catch ( IOException e ) 
 {

NEAREST DIFF:
ELIMINATEDSENTENCE
