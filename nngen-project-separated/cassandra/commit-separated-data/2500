BLEU SCORE: 0.00882875838860343

TEST MSG: Fix super column filter conversion
GENERATED MSG: Accept all thrift update on CQL3 cf but don ' t expose their metadata

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 5332c65 . . ddcb09c 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 5 + 1 , 6 @ @ <nl> 2 . 1 . 0 - rc1 <nl> * Parallel streaming for sstableloader ( CASSANDRA - 3668 ) <nl> + * Fix bugs in supercolumns handling ( CASSANDRA - 7138 ) <nl> Merged from 2 . 0 : <nl> * Make batchlog replica selection rack - aware ( CASSANDRA - 6551 ) <nl> * Suggest CTRL - C or semicolon after three blank lines in cqlsh ( CASSANDRA - 7142 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / SuperColumns . java b / src / java / org / apache / cassandra / db / SuperColumns . java <nl> index bab46eb . . 2006cbd 100644 <nl> - - - a / src / java / org / apache / cassandra / db / SuperColumns . java <nl> + + + b / src / java / org / apache / cassandra / db / SuperColumns . java <nl> @ @ - 184 , 7 + 184 , 10 @ @ public class SuperColumns <nl> int i = 0 ; <nl> for ( CellName name : filter . columns ) <nl> { <nl> - slices [ i + + ] = name . slice ( ) ; <nl> + / / Note that , because the filter in argument is the one from thrift , ' name ' are SimpleDenseCellName . <nl> + / / So calling name . slice ( ) would be incorrect , as simple cell names don ' t handle the EOC properly . <nl> + / / This is why we call toByteBuffer ( ) and rebuild a Composite of the right type before call slice ( ) . <nl> + slices [ i + + ] = type . make ( name . toByteBuffer ( ) ) . slice ( ) ; <nl> } <nl> return new SliceQueryFilter ( slices , false , slices . length , 1 ) ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / thrift / CassandraServer . java b / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> index 069cec7 . . 5a296f3 100644 <nl> - - - a / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> + + + b / src / java / org / apache / cassandra / thrift / CassandraServer . java <nl> @ @ - 381 , 12 + 381 , 18 @ @ public class CassandraServer implements Cassandra . Iface <nl> <nl> private SliceQueryFilter toInternalFilter ( CFMetaData metadata , ColumnParent parent , SliceRange range ) <nl> { <nl> + if ( metadata . isSuper ( ) ) <nl> + { <nl> + CellNameType columnType = new SimpleDenseCellNameType ( metadata . comparator . subtype ( parent . isSetSuper _ column ( ) ? 1 : 0 ) ) ; <nl> + Composite start = columnType . fromByteBuffer ( range . start ) ; <nl> + Composite finish = columnType . fromByteBuffer ( range . finish ) ; <nl> + SliceQueryFilter filter = new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; <nl> + return SuperColumns . fromSCSliceFilter ( metadata . comparator , parent . bufferForSuper _ column ( ) , filter ) ; <nl> + } <nl> + <nl> Composite start = metadata . comparator . fromByteBuffer ( range . start ) ; <nl> Composite finish = metadata . comparator . fromByteBuffer ( range . finish ) ; <nl> - SliceQueryFilter filter = new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; <nl> - if ( metadata . isSuper ( ) ) <nl> - filter = SuperColumns . fromSCSliceFilter ( metadata . comparator , parent . bufferForSuper _ column ( ) , filter ) ; <nl> - return filter ; <nl> + return new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; <nl> } <nl> <nl> private IDiskAtomFilter toInternalFilter ( CFMetaData metadata , ColumnParent parent , SlicePredicate predicate )
NEAREST DIFF (one line): diff - - git a / doc / cql3 / CQL . textile b / doc / cql3 / CQL . textile <nl> index e0f25da . . 175bac0 100644 <nl> - - - a / doc / cql3 / CQL . textile <nl> + + + b / doc / cql3 / CQL . textile <nl> @ @ - 652 , 6 + 652 , 7 @ @ bc ( syntax ) . . <nl> | decimal <nl> | double <nl> | float <nl> + | inet <nl> | int <nl> | text <nl> | timestamp <nl> @ @ - 672 , 6 + 673 , 7 @ @ p . The following table gives additional informations on the native data types : <nl> | @ decimal @ | Variable - precision decimal | <nl> | @ double @ | 64 - bit IEEE - 754 floating point | <nl> | @ float @ | 32 - bit IEEE - 754 floating point | <nl> + | @ inet @ | An IP address . It can be either 4 bytes long ( IPv4 ) or 16 bytes long ( IPv6 ) | <nl> | @ int @ | 32 - bit signed int | <nl> | @ text @ | UTF8 encoded string | <nl> | @ timestamp @ | A timestamp . See " Working with dates " : # usingdates below for more information . | <nl> diff - - git a / doc / native _ protocol . spec b / doc / native _ protocol . spec <nl> index 07d5c69 . . 0dd5c14 100644 <nl> - - - a / doc / native _ protocol . spec <nl> + + + b / doc / native _ protocol . spec <nl> @ @ - 384 , 6 + 384 , 7 @ @ Table of Contents <nl> 0x000D Varchar <nl> 0x000E Varint <nl> 0x000F Timeuuid <nl> + 0x0010 Inet <nl> 0x0020 List : the value is an [ option ] , representing the type <nl> of the elements of the list . <nl> 0x0021 Map : the value is two [ option ] , representing the types of the <nl> diff - - git a / src / java / org / apache / cassandra / transport / DataType . java b / src / java / org / apache / cassandra / transport / DataType . java <nl> index 29d7a93 . . 0cb9d2d 100644 <nl> - - - a / src / java / org / apache / cassandra / transport / DataType . java <nl> + + + b / src / java / org / apache / cassandra / transport / DataType . java <nl> @ @ - 48 , 6 + 48 , 7 @ @ public enum DataType implements OptionCodec . Codecable < DataType > <nl> VARCHAR ( 13 , UTF8Type . instance ) , <nl> VARINT ( 14 , IntegerType . instance ) , <nl> TIMEUUID ( 15 , TimeUUIDType . instance ) , <nl> + INET ( 16 , InetAddressType . instance ) , <nl> LIST ( 32 , null ) , <nl> MAP ( 33 , null ) , <nl> SET ( 34 , null ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 5332c65 . . ddcb09c 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 5 + 1 , 6 @ @ 
 2 . 1 . 0 - rc1 
 * Parallel streaming for sstableloader ( CASSANDRA - 3668 ) 
 + * Fix bugs in supercolumns handling ( CASSANDRA - 7138 ) 
 Merged from 2 . 0 : 
 * Make batchlog replica selection rack - aware ( CASSANDRA - 6551 ) 
 * Suggest CTRL - C or semicolon after three blank lines in cqlsh ( CASSANDRA - 7142 ) 
 diff - - git a / src / java / org / apache / cassandra / db / SuperColumns . java b / src / java / org / apache / cassandra / db / SuperColumns . java 
 index bab46eb . . 2006cbd 100644 
 - - - a / src / java / org / apache / cassandra / db / SuperColumns . java 
 + + + b / src / java / org / apache / cassandra / db / SuperColumns . java 
 @ @ - 184 , 7 + 184 , 10 @ @ public class SuperColumns 
 int i = 0 ; 
 for ( CellName name : filter . columns ) 
 { 
 - slices [ i + + ] = name . slice ( ) ; 
 + / / Note that , because the filter in argument is the one from thrift , ' name ' are SimpleDenseCellName . 
 + / / So calling name . slice ( ) would be incorrect , as simple cell names don ' t handle the EOC properly . 
 + / / This is why we call toByteBuffer ( ) and rebuild a Composite of the right type before call slice ( ) . 
 + slices [ i + + ] = type . make ( name . toByteBuffer ( ) ) . slice ( ) ; 
 } 
 return new SliceQueryFilter ( slices , false , slices . length , 1 ) ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / thrift / CassandraServer . java b / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 index 069cec7 . . 5a296f3 100644 
 - - - a / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 + + + b / src / java / org / apache / cassandra / thrift / CassandraServer . java 
 @ @ - 381 , 12 + 381 , 18 @ @ public class CassandraServer implements Cassandra . Iface 
 
 private SliceQueryFilter toInternalFilter ( CFMetaData metadata , ColumnParent parent , SliceRange range ) 
 { 
 + if ( metadata . isSuper ( ) ) 
 + { 
 + CellNameType columnType = new SimpleDenseCellNameType ( metadata . comparator . subtype ( parent . isSetSuper _ column ( ) ? 1 : 0 ) ) ; 
 + Composite start = columnType . fromByteBuffer ( range . start ) ; 
 + Composite finish = columnType . fromByteBuffer ( range . finish ) ; 
 + SliceQueryFilter filter = new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; 
 + return SuperColumns . fromSCSliceFilter ( metadata . comparator , parent . bufferForSuper _ column ( ) , filter ) ; 
 + } 
 + 
 Composite start = metadata . comparator . fromByteBuffer ( range . start ) ; 
 Composite finish = metadata . comparator . fromByteBuffer ( range . finish ) ; 
 - SliceQueryFilter filter = new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; 
 - if ( metadata . isSuper ( ) ) 
 - filter = SuperColumns . fromSCSliceFilter ( metadata . comparator , parent . bufferForSuper _ column ( ) , filter ) ; 
 - return filter ; 
 + return new SliceQueryFilter ( start , finish , range . reversed , range . count ) ; 
 } 
 
 private IDiskAtomFilter toInternalFilter ( CFMetaData metadata , ColumnParent parent , SlicePredicate predicate )

NEAREST DIFF:
diff - - git a / doc / cql3 / CQL . textile b / doc / cql3 / CQL . textile 
 index e0f25da . . 175bac0 100644 
 - - - a / doc / cql3 / CQL . textile 
 + + + b / doc / cql3 / CQL . textile 
 @ @ - 652 , 6 + 652 , 7 @ @ bc ( syntax ) . . 
 | decimal 
 | double 
 | float 
 + | inet 
 | int 
 | text 
 | timestamp 
 @ @ - 672 , 6 + 673 , 7 @ @ p . The following table gives additional informations on the native data types : 
 | @ decimal @ | Variable - precision decimal | 
 | @ double @ | 64 - bit IEEE - 754 floating point | 
 | @ float @ | 32 - bit IEEE - 754 floating point | 
 + | @ inet @ | An IP address . It can be either 4 bytes long ( IPv4 ) or 16 bytes long ( IPv6 ) | 
 | @ int @ | 32 - bit signed int | 
 | @ text @ | UTF8 encoded string | 
 | @ timestamp @ | A timestamp . See " Working with dates " : # usingdates below for more information . | 
 diff - - git a / doc / native _ protocol . spec b / doc / native _ protocol . spec 
 index 07d5c69 . . 0dd5c14 100644 
 - - - a / doc / native _ protocol . spec 
 + + + b / doc / native _ protocol . spec 
 @ @ - 384 , 6 + 384 , 7 @ @ Table of Contents 
 0x000D Varchar 
 0x000E Varint 
 0x000F Timeuuid 
 + 0x0010 Inet 
 0x0020 List : the value is an [ option ] , representing the type 
 of the elements of the list . 
 0x0021 Map : the value is two [ option ] , representing the types of the 
 diff - - git a / src / java / org / apache / cassandra / transport / DataType . java b / src / java / org / apache / cassandra / transport / DataType . java 
 index 29d7a93 . . 0cb9d2d 100644 
 - - - a / src / java / org / apache / cassandra / transport / DataType . java 
 + + + b / src / java / org / apache / cassandra / transport / DataType . java 
 @ @ - 48 , 6 + 48 , 7 @ @ public enum DataType implements OptionCodec . Codecable < DataType > 
 VARCHAR ( 13 , UTF8Type . instance ) , 
 VARINT ( 14 , IntegerType . instance ) , 
 TIMEUUID ( 15 , TimeUUIDType . instance ) , 
 + INET ( 16 , InetAddressType . instance ) , 
 LIST ( 32 , null ) , 
 MAP ( 33 , null ) , 
 SET ( 34 , null ) ;
