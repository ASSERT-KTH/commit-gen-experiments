BLEU SCORE: 0.01763751180315069

TEST MSG: Avoid NPE on incremental repair failure
GENERATED MSG: Pick sstables to validate as late as possible with inc repairs

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 9b1b79c . . 7175953 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 1 . 13 <nl> + * Avoid NPE when incremental repair fails ( CASSANDRA - 10909 ) <nl> * Unmark sstables compacting once they are done in cleanup / scrub / upgradesstables ( CASSANDRA - 10829 ) <nl> * Revert CASSANDRA - 10012 and add more logging ( CASSANDRA - 10961 ) <nl> * Allow simultaneous bootstrapping with strict consistency when no vnodes are used ( CASSANDRA - 11005 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> index dd80d4c . . 732267e 100644 <nl> - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java <nl> @ @ - 428 , 15 + 428 , 17 @ @ public class ActiveRepairService <nl> { <nl> public final Map < UUID , ColumnFamilyStore > columnFamilyStores = new HashMap < > ( ) ; <nl> public final Collection < Range < Token > > ranges ; <nl> - public final Map < UUID , Set < SSTableReader > > sstableMap ; <nl> + public final Map < UUID , Set < SSTableReader > > sstableMap = new HashMap < > ( ) ; <nl> public final long repairedAt ; <nl> <nl> public ParentRepairSession ( List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , long repairedAt ) <nl> { <nl> for ( ColumnFamilyStore cfs : columnFamilyStores ) <nl> + { <nl> this . columnFamilyStores . put ( cfs . metadata . cfId , cfs ) ; <nl> + sstableMap . put ( cfs . metadata . cfId , new HashSet < SSTableReader > ( ) ) ; <nl> + } <nl> this . ranges = ranges ; <nl> - this . sstableMap = new HashMap < > ( ) ; <nl> this . repairedAt = repairedAt ; <nl> } <nl> <nl> @ @ - 466 , 11 + 468 , 7 @ @ public class ActiveRepairService <nl> <nl> public void addSSTables ( UUID cfId , Collection < SSTableReader > sstables ) <nl> { <nl> - Set < SSTableReader > existingSSTables = this . sstableMap . get ( cfId ) ; <nl> - if ( existingSSTables = = null ) <nl> - existingSSTables = new HashSet < > ( ) ; <nl> - existingSSTables . addAll ( sstables ) ; <nl> - this . sstableMap . put ( cfId , existingSSTables ) ; <nl> + sstableMap . get ( cfId ) . addAll ( sstables ) ; <nl> } <nl> <nl> @ Override
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 9b1b79c . . 7175953 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 1 . 13 
 + * Avoid NPE when incremental repair fails ( CASSANDRA - 10909 ) 
 * Unmark sstables compacting once they are done in cleanup / scrub / upgradesstables ( CASSANDRA - 10829 ) 
 * Revert CASSANDRA - 10012 and add more logging ( CASSANDRA - 10961 ) 
 * Allow simultaneous bootstrapping with strict consistency when no vnodes are used ( CASSANDRA - 11005 ) 
 diff - - git a / src / java / org / apache / cassandra / service / ActiveRepairService . java b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 index dd80d4c . . 732267e 100644 
 - - - a / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 + + + b / src / java / org / apache / cassandra / service / ActiveRepairService . java 
 @ @ - 428 , 15 + 428 , 17 @ @ public class ActiveRepairService 
 { 
 public final Map < UUID , ColumnFamilyStore > columnFamilyStores = new HashMap < > ( ) ; 
 public final Collection < Range < Token > > ranges ; 
 - public final Map < UUID , Set < SSTableReader > > sstableMap ; 
 + public final Map < UUID , Set < SSTableReader > > sstableMap = new HashMap < > ( ) ; 
 public final long repairedAt ; 
 
 public ParentRepairSession ( List < ColumnFamilyStore > columnFamilyStores , Collection < Range < Token > > ranges , long repairedAt ) 
 { 
 for ( ColumnFamilyStore cfs : columnFamilyStores ) 
 + { 
 this . columnFamilyStores . put ( cfs . metadata . cfId , cfs ) ; 
 + sstableMap . put ( cfs . metadata . cfId , new HashSet < SSTableReader > ( ) ) ; 
 + } 
 this . ranges = ranges ; 
 - this . sstableMap = new HashMap < > ( ) ; 
 this . repairedAt = repairedAt ; 
 } 
 
 @ @ - 466 , 11 + 468 , 7 @ @ public class ActiveRepairService 
 
 public void addSSTables ( UUID cfId , Collection < SSTableReader > sstables ) 
 { 
 - Set < SSTableReader > existingSSTables = this . sstableMap . get ( cfId ) ; 
 - if ( existingSSTables = = null ) 
 - existingSSTables = new HashSet < > ( ) ; 
 - existingSSTables . addAll ( sstables ) ; 
 - this . sstableMap . put ( cfId , existingSSTables ) ; 
 + sstableMap . get ( cfId ) . addAll ( sstables ) ; 
 } 
 
 @ Override

NEAREST DIFF:
ELIMINATEDSENTENCE
