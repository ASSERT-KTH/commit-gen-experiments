BLEU SCORE: 0.07590969579691415

TEST MSG: Ignore fully expired sstables when finding min timestamp
GENERATED MSG: Set minTimestamp correctly to be able to drop expired sstables correctly

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionController . java b / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> index 7a4b7d9 . . 59453cc 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> @ @ - 102 , 7 + 102 , 12 @ @ public class CompactionController <nl> long minTimestamp = Long . MAX _ VALUE ; <nl> <nl> for ( SSTableReader sstable : overlapping ) <nl> - minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ; <nl> + { <nl> + / / Overlapping might include fully expired sstables . What we care about here is <nl> + / / the min timestamp of the overlapping sstables that actually contain live data . <nl> + if ( sstable . getSSTableMetadata ( ) . maxLocalDeletionTime > = gcBefore ) <nl> + minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ; <nl> + } <nl> <nl> for ( SSTableReader candidate : compacting ) <nl> {
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java <nl> index c3d2600 . . 8e72065 100644 <nl> - - - a / src / java / org / apache / cassandra / cli / CliClient . java <nl> + + + b / src / java / org / apache / cassandra / cli / CliClient . java <nl> @ @ - 195 , 8 + 195 , 8 @ @ public class CliClient <nl> { <nl> sessionState . out . println ( " Welcome to Cassandra CLI version " + FBUtilities . getReleaseVersionString ( ) + " \ n " ) ; <nl> <nl> - sessionState . out . println ( " Please consider using the more convenient cqlsh instead of CLI " ) ; <nl> - sessionState . out . println ( " CQL3 is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; <nl> + sessionState . out . println ( " The CLI is deprecated and will be removed in Cassandra 3 . 0 . Consider migrating to cqlsh . " ) ; <nl> + sessionState . out . println ( " CQL is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; <nl> <nl> sessionState . out . println ( getHelp ( ) . banner ) ; <nl> }

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionController . java b / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 index 7a4b7d9 . . 59453cc 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 @ @ - 102 , 7 + 102 , 12 @ @ public class CompactionController 
 long minTimestamp = Long . MAX _ VALUE ; 
 
 for ( SSTableReader sstable : overlapping ) 
 - minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ; 
 + { 
 + / / Overlapping might include fully expired sstables . What we care about here is 
 + / / the min timestamp of the overlapping sstables that actually contain live data . 
 + if ( sstable . getSSTableMetadata ( ) . maxLocalDeletionTime > = gcBefore ) 
 + minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ; 
 + } 
 
 for ( SSTableReader candidate : compacting ) 
 {

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / cli / CliClient . java b / src / java / org / apache / cassandra / cli / CliClient . java 
 index c3d2600 . . 8e72065 100644 
 - - - a / src / java / org / apache / cassandra / cli / CliClient . java 
 + + + b / src / java / org / apache / cassandra / cli / CliClient . java 
 @ @ - 195 , 8 + 195 , 8 @ @ public class CliClient 
 { 
 sessionState . out . println ( " Welcome to Cassandra CLI version " + FBUtilities . getReleaseVersionString ( ) + " \ n " ) ; 
 
 - sessionState . out . println ( " Please consider using the more convenient cqlsh instead of CLI " ) ; 
 - sessionState . out . println ( " CQL3 is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; 
 + sessionState . out . println ( " The CLI is deprecated and will be removed in Cassandra 3 . 0 . Consider migrating to cqlsh . " ) ; 
 + sessionState . out . println ( " CQL is fully backwards compatible with Thrift data ; see http : / / www . datastax . com / dev / blog / thrift - to - cql3 \ n " ) ; 
 
 sessionState . out . println ( getHelp ( ) . banner ) ; 
 }
