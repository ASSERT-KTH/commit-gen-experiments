BLEU SCORE: 0.005318341850037307

TEST MSG: ninja fix IndexSummaryManagerTest . testCompactionsRace
GENERATED MSG: move blacklist tests to another class where closing System . err is less likely to bite us in the ass

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java b / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java <nl> index dec7705 . . 877b6e6 100644 <nl> - - - a / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java <nl> + + + b / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java <nl> @ @ - 508 , 8 + 508 , 8 @ @ public class IndexSummaryManagerTest extends SchemaLoader <nl> String cfname = " StandardRace " ; / / index interval of 8 , no key caching <nl> Keyspace keyspace = Keyspace . open ( ksname ) ; <nl> ColumnFamilyStore cfs = keyspace . getColumnFamilyStore ( cfname ) ; <nl> - int numSSTables = 20 ; <nl> - int numRows = 28 ; <nl> + int numSSTables = 50 ; <nl> + int numRows = 1 < < 10 ; <nl> createSSTables ( ksname , cfname , numSSTables , numRows ) ; <nl> <nl> List < SSTableReader > sstables = new ArrayList < > ( cfs . getSSTables ( ) ) ; <nl> @ @ - 530 , 7 + 530 , 8 @ @ public class IndexSummaryManagerTest extends SchemaLoader <nl> try <nl> { <nl> IndexSummaryManager . instance . redistributeSummaries ( ) ; <nl> - } catch ( Throwable e ) <nl> + } <nl> + catch ( Throwable e ) <nl> { <nl> failed . set ( true ) ; <nl> } <nl> @ @ - 544 , 14 + 545 , 14 @ @ public class IndexSummaryManagerTest extends SchemaLoader <nl> <nl> try <nl> { <nl> - Assert . assertFalse ( failed . get ( ) ) ; <nl> + Assert . assertFalse ( failed . getAndSet ( true ) ) ; <nl> <nl> for ( SSTableReader sstable : sstables ) <nl> { <nl> Assert . assertEquals ( true , sstable . isMarkedCompacted ( ) ) ; <nl> } <nl> <nl> - Assert . assertEquals ( 20 , sstables . size ( ) ) ; <nl> + Assert . assertEquals ( numSSTables , sstables . size ( ) ) ; <nl> <nl> try <nl> { <nl> @ @ - 567 , 5 + 568 , 7 @ @ public class IndexSummaryManagerTest extends SchemaLoader <nl> tp . shutdownNow ( ) ; <nl> CompactionManager . instance . finishCompactionsAndShutdown ( 10 , TimeUnit . SECONDS ) ; <nl> } <nl> + <nl> + cfs . truncateBlocking ( ) ; <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java b / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java <nl> index 11d7966 . . fabebe9 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java <nl> @ @ - 42 , 7 + 42 , 6 @ @ import org . apache . cassandra . db . marshal . CompositeType ; <nl> import org . apache . cassandra . io . sstable . Component ; <nl> import org . apache . cassandra . io . sstable . SSTableReader ; <nl> import org . apache . cassandra . io . sstable . SSTableScanner ; <nl> - import org . apache . cassandra . io . util . FileUtils ; <nl> import org . apache . cassandra . utils . ByteBufferUtil ; <nl> import org . apache . cassandra . utils . FBUtilities ; <nl> import org . apache . cassandra . utils . Pair ; <nl> @ @ - 222 , 12 + 221 , 12 @ @ public class CompactionsTest extends SchemaLoader <nl> public void testDontPurgeAccidentaly ( ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> / / Testing with and without forcing deserialization . Without deserialization , EchoedRow will be used . <nl> - testDontPurgeAccidentaly ( " test1 " , " Super5 " , false ) ; <nl> - testDontPurgeAccidentaly ( " test2 " , " Super5 " , true ) ; <nl> + testDontPurgeAccidentaly ( " test1 " , " Super5 " ) ; <nl> + testDontPurgeAccidentaly ( " test2 " , " Super5 " ) ; <nl> <nl> / / Use CF with gc _ grace = 0 , see last bug of CASSANDRA - 2786 <nl> - testDontPurgeAccidentaly ( " test1 " , " SuperDirectGC " , false ) ; <nl> - testDontPurgeAccidentaly ( " test2 " , " SuperDirectGC " , true ) ; <nl> + testDontPurgeAccidentaly ( " test1 " , " SuperDirectGC " ) ; <nl> + testDontPurgeAccidentaly ( " test2 " , " SuperDirectGC " ) ; <nl> } <nl> <nl> @ Test <nl> @ @ - 299 , 7 + 298 , 7 @ @ public class CompactionsTest extends SchemaLoader <nl> assert ! compactionLogs . containsKey ( Pair . create ( TABLE1 , cf ) ) ; <nl> } <nl> <nl> - private void testDontPurgeAccidentaly ( String k , String cfname , boolean forceDeserialize ) throws IOException , ExecutionException , InterruptedException <nl> + private void testDontPurgeAccidentaly ( String k , String cfname ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> / / This test catches the regression of CASSANDRA - 2786 <nl> Table table = Table . open ( TABLE1 ) ;

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java b / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java 
 index dec7705 . . 877b6e6 100644 
 - - - a / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java 
 + + + b / test / unit / org / apache / cassandra / io / sstable / IndexSummaryManagerTest . java 
 @ @ - 508 , 8 + 508 , 8 @ @ public class IndexSummaryManagerTest extends SchemaLoader 
 String cfname = " StandardRace " ; / / index interval of 8 , no key caching 
 Keyspace keyspace = Keyspace . open ( ksname ) ; 
 ColumnFamilyStore cfs = keyspace . getColumnFamilyStore ( cfname ) ; 
 - int numSSTables = 20 ; 
 - int numRows = 28 ; 
 + int numSSTables = 50 ; 
 + int numRows = 1 < < 10 ; 
 createSSTables ( ksname , cfname , numSSTables , numRows ) ; 
 
 List < SSTableReader > sstables = new ArrayList < > ( cfs . getSSTables ( ) ) ; 
 @ @ - 530 , 7 + 530 , 8 @ @ public class IndexSummaryManagerTest extends SchemaLoader 
 try 
 { 
 IndexSummaryManager . instance . redistributeSummaries ( ) ; 
 - } catch ( Throwable e ) 
 + } 
 + catch ( Throwable e ) 
 { 
 failed . set ( true ) ; 
 } 
 @ @ - 544 , 14 + 545 , 14 @ @ public class IndexSummaryManagerTest extends SchemaLoader 
 
 try 
 { 
 - Assert . assertFalse ( failed . get ( ) ) ; 
 + Assert . assertFalse ( failed . getAndSet ( true ) ) ; 
 
 for ( SSTableReader sstable : sstables ) 
 { 
 Assert . assertEquals ( true , sstable . isMarkedCompacted ( ) ) ; 
 } 
 
 - Assert . assertEquals ( 20 , sstables . size ( ) ) ; 
 + Assert . assertEquals ( numSSTables , sstables . size ( ) ) ; 
 
 try 
 { 
 @ @ - 567 , 5 + 568 , 7 @ @ public class IndexSummaryManagerTest extends SchemaLoader 
 tp . shutdownNow ( ) ; 
 CompactionManager . instance . finishCompactionsAndShutdown ( 10 , TimeUnit . SECONDS ) ; 
 } 
 + 
 + cfs . truncateBlocking ( ) ; 
 } 
 }

NEAREST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java b / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java 
 index 11d7966 . . fabebe9 100644 
 - - - a / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java 
 + + + b / test / unit / org / apache / cassandra / db / compaction / CompactionsTest . java 
 @ @ - 42 , 7 + 42 , 6 @ @ import org . apache . cassandra . db . marshal . CompositeType ; 
 import org . apache . cassandra . io . sstable . Component ; 
 import org . apache . cassandra . io . sstable . SSTableReader ; 
 import org . apache . cassandra . io . sstable . SSTableScanner ; 
 - import org . apache . cassandra . io . util . FileUtils ; 
 import org . apache . cassandra . utils . ByteBufferUtil ; 
 import org . apache . cassandra . utils . FBUtilities ; 
 import org . apache . cassandra . utils . Pair ; 
 @ @ - 222 , 12 + 221 , 12 @ @ public class CompactionsTest extends SchemaLoader 
 public void testDontPurgeAccidentaly ( ) throws IOException , ExecutionException , InterruptedException 
 { 
 / / Testing with and without forcing deserialization . Without deserialization , EchoedRow will be used . 
 - testDontPurgeAccidentaly ( " test1 " , " Super5 " , false ) ; 
 - testDontPurgeAccidentaly ( " test2 " , " Super5 " , true ) ; 
 + testDontPurgeAccidentaly ( " test1 " , " Super5 " ) ; 
 + testDontPurgeAccidentaly ( " test2 " , " Super5 " ) ; 
 
 / / Use CF with gc _ grace = 0 , see last bug of CASSANDRA - 2786 
 - testDontPurgeAccidentaly ( " test1 " , " SuperDirectGC " , false ) ; 
 - testDontPurgeAccidentaly ( " test2 " , " SuperDirectGC " , true ) ; 
 + testDontPurgeAccidentaly ( " test1 " , " SuperDirectGC " ) ; 
 + testDontPurgeAccidentaly ( " test2 " , " SuperDirectGC " ) ; 
 } 
 
 @ Test 
 @ @ - 299 , 7 + 298 , 7 @ @ public class CompactionsTest extends SchemaLoader 
 assert ! compactionLogs . containsKey ( Pair . create ( TABLE1 , cf ) ) ; 
 } 
 
 - private void testDontPurgeAccidentaly ( String k , String cfname , boolean forceDeserialize ) throws IOException , ExecutionException , InterruptedException 
 + private void testDontPurgeAccidentaly ( String k , String cfname ) throws IOException , ExecutionException , InterruptedException 
 { 
 / / This test catches the regression of CASSANDRA - 2786 
 Table table = Table . open ( TABLE1 ) ;
