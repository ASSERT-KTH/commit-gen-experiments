BLEU SCORE: 0.03283637368030199

TEST MSG: Schedule fat client schema pull on join
GENERATED MSG: fix hint replay

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 188f951 . . 1bef399 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 2 . 0 . 11 : <nl> + * Schedule fat client schema pull on join ( CASSANDRA - 7993 ) <nl> * Don ' t reset nodes ' versions when closing IncomingTcpConnections <nl> ( CASSANDRA - 7734 ) <nl> * Record the real messaging version in all cases in OutboundTcpConnection <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 43bc198 . . 0cd4be5 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 1970 , 6 + 1970 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> <nl> public void onAlive ( InetAddress endpoint , EndpointState state ) <nl> { <nl> + MigrationManager . instance . scheduleSchemaPull ( endpoint , state ) ; <nl> + <nl> if ( isClientMode ) <nl> return ; <nl> <nl> @ @ - 1984 , 7 + 1986 , 6 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> for ( IEndpointLifecycleSubscriber subscriber : lifecycleSubscribers ) <nl> subscriber . onJoinCluster ( endpoint ) ; <nl> } <nl> - MigrationManager . instance . scheduleSchemaPull ( endpoint , state ) ; <nl> } <nl> <nl> public void onRemove ( InetAddress endpoint )
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index d531341 . . b213eda 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 37 , 6 + 37 , 7 @ @ <nl> ( CASSANDRA - 2911 ) <nl> * fix re - using index CF sstable names after drop / recreate ( CASSANDRA - 2872 ) <nl> * prepend CF to default index names ( CASSANDRA - 2903 ) <nl> + * fix hint replay ( CASSANDRA - 2928 ) <nl> <nl> <nl> 0 . 8 . 1 <nl> diff - - git a / src / java / org / apache / cassandra / gms / EndpointState . java b / src / java / org / apache / cassandra / gms / EndpointState . java <nl> index 3e05c83 . . 4d91ed6 100644 <nl> - - - a / src / java / org / apache / cassandra / gms / EndpointState . java <nl> + + + b / src / java / org / apache / cassandra / gms / EndpointState . java <nl> @ @ - 123 , 12 + 123 , 12 @ @ public class EndpointState <nl> isAlive = false ; <nl> } <nl> <nl> - public void setHasToken ( boolean value ) <nl> + void setHasToken ( boolean value ) <nl> { <nl> hasToken = value ; <nl> } <nl> <nl> - public boolean hasToken ( ) <nl> + boolean hasToken ( ) <nl> { <nl> return hasToken ; <nl> } <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index 1b4c5d9 . . fbeca12 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 1188 , 7 + 1188 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe <nl> <nl> public void onAlive ( InetAddress endpoint , EndpointState state ) <nl> { <nl> - if ( ! isClientMode & & state . hasToken ( ) ) <nl> + if ( ! isClientMode & & getTokenMetadata ( ) . isMember ( endpoint ) ) <nl> deliverHints ( endpoint ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 188f951 . . 1bef399 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 2 . 0 . 11 : 
 + * Schedule fat client schema pull on join ( CASSANDRA - 7993 ) 
 * Don ' t reset nodes ' versions when closing IncomingTcpConnections 
 ( CASSANDRA - 7734 ) 
 * Record the real messaging version in all cases in OutboundTcpConnection 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 43bc198 . . 0cd4be5 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 1970 , 6 + 1970 , 8 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 
 public void onAlive ( InetAddress endpoint , EndpointState state ) 
 { 
 + MigrationManager . instance . scheduleSchemaPull ( endpoint , state ) ; 
 + 
 if ( isClientMode ) 
 return ; 
 
 @ @ - 1984 , 7 + 1986 , 6 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 for ( IEndpointLifecycleSubscriber subscriber : lifecycleSubscribers ) 
 subscriber . onJoinCluster ( endpoint ) ; 
 } 
 - MigrationManager . instance . scheduleSchemaPull ( endpoint , state ) ; 
 } 
 
 public void onRemove ( InetAddress endpoint )

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index d531341 . . b213eda 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 37 , 6 + 37 , 7 @ @ 
 ( CASSANDRA - 2911 ) 
 * fix re - using index CF sstable names after drop / recreate ( CASSANDRA - 2872 ) 
 * prepend CF to default index names ( CASSANDRA - 2903 ) 
 + * fix hint replay ( CASSANDRA - 2928 ) 
 
 
 0 . 8 . 1 
 diff - - git a / src / java / org / apache / cassandra / gms / EndpointState . java b / src / java / org / apache / cassandra / gms / EndpointState . java 
 index 3e05c83 . . 4d91ed6 100644 
 - - - a / src / java / org / apache / cassandra / gms / EndpointState . java 
 + + + b / src / java / org / apache / cassandra / gms / EndpointState . java 
 @ @ - 123 , 12 + 123 , 12 @ @ public class EndpointState 
 isAlive = false ; 
 } 
 
 - public void setHasToken ( boolean value ) 
 + void setHasToken ( boolean value ) 
 { 
 hasToken = value ; 
 } 
 
 - public boolean hasToken ( ) 
 + boolean hasToken ( ) 
 { 
 return hasToken ; 
 } 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index 1b4c5d9 . . fbeca12 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 1188 , 7 + 1188 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe 
 
 public void onAlive ( InetAddress endpoint , EndpointState state ) 
 { 
 - if ( ! isClientMode & & state . hasToken ( ) ) 
 + if ( ! isClientMode & & getTokenMetadata ( ) . isMember ( endpoint ) ) 
 deliverHints ( endpoint ) ; 
 } 

