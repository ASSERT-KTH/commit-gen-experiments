BLEU SCORE: 0.001459383946013153

TEST MSG: Truncate cfs between SinglePartitionSliceCommandTest tests
GENERATED MSG: extend cleanuphelper in more places , and make cleanuphelper stricter about cleaning out old data . fixes test heisenbugs . patch by jbellis

TEST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java b / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java <nl> index 9f80023 . . 46c7810 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java <nl> @ @ - 6 , 6 + 6 , 7 @ @ import java . util . Collections ; <nl> import java . util . Iterator ; <nl> <nl> import org . junit . Assert ; <nl> + import org . junit . Before ; <nl> import org . junit . BeforeClass ; <nl> import org . junit . Test ; <nl> <nl> @ @ - 66 , 6 + 67 , 12 @ @ public class SinglePartitionSliceCommandTest <nl> s = cfm . getColumnDefinition ( new ColumnIdentifier ( " s " , true ) ) ; <nl> } <nl> <nl> + @ Before <nl> + public void truncate ( ) <nl> + { <nl> + Keyspace . open ( KEYSPACE ) . getColumnFamilyStore ( TABLE ) . truncateBlocking ( ) ; <nl> + } <nl> + <nl> @ Test <nl> public void staticColumnsAreFiltered ( ) throws IOException <nl> {
NEAREST DIFF (one line): diff - - git a / test / unit / org / apache / cassandra / CleanupHelper . java b / test / unit / org / apache / cassandra / CleanupHelper . java <nl> index e3cde8d . . df835de 100644 <nl> - - - a / test / unit / org / apache / cassandra / CleanupHelper . java <nl> + + + b / test / unit / org / apache / cassandra / CleanupHelper . java <nl> @ @ - 24 , 6 + 24 , 8 @ @ import java . io . IOException ; <nl> import org . junit . BeforeClass ; <nl> <nl> import org . apache . cassandra . config . DatabaseDescriptor ; <nl> + import org . apache . cassandra . io . util . FileUtils ; <nl> + <nl> import org . apache . log4j . Logger ; <nl> <nl> public class CleanupHelper <nl> @ @ - 31 , 25 + 33 , 19 @ @ public class CleanupHelper <nl> private static Logger logger = Logger . getLogger ( CleanupHelper . class ) ; <nl> <nl> @ BeforeClass <nl> - public static void cleanupAndLeaveDirs ( ) <nl> + public static void cleanupAndLeaveDirs ( ) throws IOException <nl> { <nl> mkdirs ( ) ; <nl> cleanup ( ) ; <nl> mkdirs ( ) ; <nl> } <nl> <nl> - public static void cleanup ( ) <nl> + public static void cleanup ( ) throws IOException <nl> { <nl> - / / we clean the fs twice , once to start with ( so old data files don ' t get stored by anything static if this is the first run ) <nl> - / / and once after flushing stuff ( to try to clean things out if it is not . ) part # 2 seems to be less than perfect . <nl> + / / clean up commitlog <nl> String [ ] directoryNames = { <nl> DatabaseDescriptor . getLogFileLocation ( ) , <nl> } ; <nl> - <nl> - / / try to delete the directories themselves too . don ' t panic if this fails . it probably means that the process <nl> - / / doesn ' t have permissions to do so , or it contains non - cassandra generated files that were intentionally <nl> - / / put there . <nl> - <nl> for ( String dirName : directoryNames ) <nl> { <nl> File dir = new File ( dirName ) ; <nl> @ @ - 59 , 17 + 55 , 12 @ @ public class CleanupHelper <nl> } <nl> for ( File f : dir . listFiles ( ) ) <nl> { <nl> - if ( ! f . delete ( ) ) <nl> - { <nl> - logger . error ( " could not delete " + f ) ; <nl> - } <nl> + FileUtils . deleteWithConfirm ( f ) ; <nl> } <nl> - <nl> - if ( ! dir . delete ( ) ) <nl> - logger . warn ( " could not delete " + dir . getPath ( ) ) ; <nl> + FileUtils . deleteWithConfirm ( dir ) ; <nl> } <nl> <nl> - / / cleanup data directory which are stored as data directory / table / data files <nl> + / / clean up data directory which are stored as data directory / table / data files <nl> for ( String dirName : DatabaseDescriptor . getAllDataFileLocations ( ) ) <nl> { <nl> File dir = new File ( dirName ) ; <nl> @ @ - 80 , 19 + 71 , 16 @ @ public class CleanupHelper <nl> for ( File tableFile : dir . listFiles ( ) ) <nl> { <nl> / / table directory <nl> - if ( tableFile . isDirectory ( ) ) { <nl> - for ( File dataFile : tableFile . listFiles ( ) ) { <nl> - if ( ! dataFile . delete ( ) ) { <nl> - logger . error ( " could not delete " + dataFile ) ; <nl> - } <nl> + if ( tableFile . isDirectory ( ) ) <nl> + { <nl> + for ( File dataFile : tableFile . listFiles ( ) ) <nl> + { <nl> + FileUtils . deleteWithConfirm ( dataFile ) ; <nl> } <nl> } <nl> - if ( ! tableFile . delete ( ) ) <nl> - logger . warn ( " could not delete " + dir . getPath ( ) ) ; <nl> + FileUtils . deleteWithConfirm ( tableFile ) ; <nl> } <nl> - <nl> - if ( ! dir . delete ( ) ) <nl> - logger . warn ( " could not delete " + dir . getPath ( ) ) ; <nl> + FileUtils . deleteWithConfirm ( dir ) ; <nl> } <nl> } <nl> <nl> diff - - git a / test / unit / org / apache / cassandra / db / OneCompactionTest . java b / test / unit / org / apache / cassandra / db / OneCompactionTest . java <nl> index b53e0fb . . 1b31044 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / OneCompactionTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / OneCompactionTest . java <nl> @ @ - 28 , 8 + 28 , 9 @ @ import org . junit . Test ; <nl> <nl> import static junit . framework . Assert . assertEquals ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class OneCompactionTest <nl> + public class OneCompactionTest extends CleanupHelper <nl> { <nl> private void testCompaction ( String columnFamilyName , int insertsPerTable ) throws IOException , ExecutionException , InterruptedException <nl> { <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java <nl> index 35efad1 . . 7cc940d 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java <nl> @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; <nl> import static junit . framework . Assert . assertNull ; <nl> import org . apache . cassandra . db . filter . IdentityQueryFilter ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class RemoveColumnFamilyTest <nl> + public class RemoveColumnFamilyTest extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveColumnFamily ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java <nl> index 423ad5a . . 512d2d3 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java <nl> @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; <nl> import static junit . framework . Assert . assertNull ; <nl> import org . apache . cassandra . db . filter . IdentityQueryFilter ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class RemoveColumnFamilyWithFlush1Test <nl> + public class RemoveColumnFamilyWithFlush1Test extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveColumnFamilyWithFlush1 ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java <nl> index 74220bd . . f1a08d9 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java <nl> @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; <nl> import static junit . framework . Assert . assertNull ; <nl> import org . apache . cassandra . db . filter . IdentityQueryFilter ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class RemoveColumnFamilyWithFlush2Test <nl> + public class RemoveColumnFamilyWithFlush2Test extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveColumnFamilyWithFlush2 ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveColumnTest . java <nl> index dcc9093 . . 31ae44f 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveColumnTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveColumnTest . java <nl> @ @ - 27 , 8 + 27 , 9 @ @ import static junit . framework . Assert . assertNull ; <nl> import org . apache . cassandra . db . filter . IdentityQueryFilter ; <nl> import org . apache . cassandra . db . filter . NamesQueryFilter ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class RemoveColumnTest <nl> + public class RemoveColumnTest extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveColumn ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java <nl> index a2e3e61 . . 2f71757 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java <nl> @ @ - 28 , 8 + 28 , 9 @ @ import org . apache . cassandra . db . filter . IdentityQueryFilter ; <nl> import org . apache . cassandra . db . filter . QueryPath ; <nl> import static org . apache . cassandra . Util . addMutation ; <nl> import static org . apache . cassandra . Util . getBytes ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> <nl> - public class RemoveSubColumnTest <nl> + public class RemoveSubColumnTest extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveSubColumn ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java <nl> index e51167d . . 18b0942 100644 <nl> - - - a / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java <nl> + + + b / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java <nl> @ @ - 33 , 9 + 33 , 10 @ @ import org . apache . cassandra . db . filter . QueryPath ; <nl> import static org . apache . cassandra . Util . addMutation ; <nl> import static org . apache . cassandra . Util . getBytes ; <nl> import org . apache . cassandra . Util ; <nl> + import org . apache . cassandra . CleanupHelper ; <nl> import static junit . framework . Assert . assertNotNull ; <nl> <nl> - public class RemoveSuperColumnTest <nl> + public class RemoveSuperColumnTest extends CleanupHelper <nl> { <nl> @ Test <nl> public void testRemoveSuperColumn ( ) throws IOException , ExecutionException , InterruptedException <nl> diff - - git a / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java b / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java <nl> index dd06767 . . e48968a 100644 <nl> - - - a / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java <nl> + + + b / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java <nl> @ @ - 45 , 19 + 45 , 21 @ @ import static org . junit . Assert . * ; <nl> <nl> public class AntiEntropyServiceTest extends CleanupHelper <nl> { <nl> - public static InetAddress LOCAL = FBUtilities . getLocalAddress ( ) ; <nl> - <nl> / / table and column family to test against <nl> public AntiEntropyService aes ; <nl> <nl> public static String tablename ; <nl> public static String cfname ; <nl> - public static InetAddress REMOTE ; <nl> + public static InetAddress LOCAL , REMOTE ; <nl> + <nl> + private static boolean initialized ; <nl> <nl> - static <nl> + @ Before <nl> + public void prepare ( ) throws Exception <nl> { <nl> - try <nl> + if ( ! initialized ) <nl> { <nl> + LOCAL = FBUtilities . getLocalAddress ( ) ; <nl> / / bump the replication factor so that local overlaps with REMOTE below <nl> DatabaseDescriptorTest . setReplicationFactor ( 2 ) ; <nl> <nl> @ @ - 71 , 16 + 73 , 8 @ @ public class AntiEntropyServiceTest extends CleanupHelper <nl> <nl> tablename = DatabaseDescriptor . getTables ( ) . get ( 0 ) ; <nl> cfname = Table . open ( tablename ) . getColumnFamilies ( ) . iterator ( ) . next ( ) ; <nl> + initialized = true ; <nl> } <nl> - catch ( Exception e ) <nl> - { <nl> - throw new RuntimeException ( e ) ; <nl> - } <nl> - } <nl> - <nl> - @ Before <nl> - public void prepare ( ) throws Exception <nl> - { <nl> aes = AntiEntropyService . instance ( ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java b / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java 
 index 9f80023 . . 46c7810 100644 
 - - - a / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java 
 + + + b / test / unit / org / apache / cassandra / db / SinglePartitionSliceCommandTest . java 
 @ @ - 6 , 6 + 6 , 7 @ @ import java . util . Collections ; 
 import java . util . Iterator ; 
 
 import org . junit . Assert ; 
 + import org . junit . Before ; 
 import org . junit . BeforeClass ; 
 import org . junit . Test ; 
 
 @ @ - 66 , 6 + 67 , 12 @ @ public class SinglePartitionSliceCommandTest 
 s = cfm . getColumnDefinition ( new ColumnIdentifier ( " s " , true ) ) ; 
 } 
 
 + @ Before 
 + public void truncate ( ) 
 + { 
 + Keyspace . open ( KEYSPACE ) . getColumnFamilyStore ( TABLE ) . truncateBlocking ( ) ; 
 + } 
 + 
 @ Test 
 public void staticColumnsAreFiltered ( ) throws IOException 
 {

NEAREST DIFF:
diff - - git a / test / unit / org / apache / cassandra / CleanupHelper . java b / test / unit / org / apache / cassandra / CleanupHelper . java 
 index e3cde8d . . df835de 100644 
 - - - a / test / unit / org / apache / cassandra / CleanupHelper . java 
 + + + b / test / unit / org / apache / cassandra / CleanupHelper . java 
 @ @ - 24 , 6 + 24 , 8 @ @ import java . io . IOException ; 
 import org . junit . BeforeClass ; 
 
 import org . apache . cassandra . config . DatabaseDescriptor ; 
 + import org . apache . cassandra . io . util . FileUtils ; 
 + 
 import org . apache . log4j . Logger ; 
 
 public class CleanupHelper 
 @ @ - 31 , 25 + 33 , 19 @ @ public class CleanupHelper 
 private static Logger logger = Logger . getLogger ( CleanupHelper . class ) ; 
 
 @ BeforeClass 
 - public static void cleanupAndLeaveDirs ( ) 
 + public static void cleanupAndLeaveDirs ( ) throws IOException 
 { 
 mkdirs ( ) ; 
 cleanup ( ) ; 
 mkdirs ( ) ; 
 } 
 
 - public static void cleanup ( ) 
 + public static void cleanup ( ) throws IOException 
 { 
 - / / we clean the fs twice , once to start with ( so old data files don ' t get stored by anything static if this is the first run ) 
 - / / and once after flushing stuff ( to try to clean things out if it is not . ) part # 2 seems to be less than perfect . 
 + / / clean up commitlog 
 String [ ] directoryNames = { 
 DatabaseDescriptor . getLogFileLocation ( ) , 
 } ; 
 - 
 - / / try to delete the directories themselves too . don ' t panic if this fails . it probably means that the process 
 - / / doesn ' t have permissions to do so , or it contains non - cassandra generated files that were intentionally 
 - / / put there . 
 - 
 for ( String dirName : directoryNames ) 
 { 
 File dir = new File ( dirName ) ; 
 @ @ - 59 , 17 + 55 , 12 @ @ public class CleanupHelper 
 } 
 for ( File f : dir . listFiles ( ) ) 
 { 
 - if ( ! f . delete ( ) ) 
 - { 
 - logger . error ( " could not delete " + f ) ; 
 - } 
 + FileUtils . deleteWithConfirm ( f ) ; 
 } 
 - 
 - if ( ! dir . delete ( ) ) 
 - logger . warn ( " could not delete " + dir . getPath ( ) ) ; 
 + FileUtils . deleteWithConfirm ( dir ) ; 
 } 
 
 - / / cleanup data directory which are stored as data directory / table / data files 
 + / / clean up data directory which are stored as data directory / table / data files 
 for ( String dirName : DatabaseDescriptor . getAllDataFileLocations ( ) ) 
 { 
 File dir = new File ( dirName ) ; 
 @ @ - 80 , 19 + 71 , 16 @ @ public class CleanupHelper 
 for ( File tableFile : dir . listFiles ( ) ) 
 { 
 / / table directory 
 - if ( tableFile . isDirectory ( ) ) { 
 - for ( File dataFile : tableFile . listFiles ( ) ) { 
 - if ( ! dataFile . delete ( ) ) { 
 - logger . error ( " could not delete " + dataFile ) ; 
 - } 
 + if ( tableFile . isDirectory ( ) ) 
 + { 
 + for ( File dataFile : tableFile . listFiles ( ) ) 
 + { 
 + FileUtils . deleteWithConfirm ( dataFile ) ; 
 } 
 } 
 - if ( ! tableFile . delete ( ) ) 
 - logger . warn ( " could not delete " + dir . getPath ( ) ) ; 
 + FileUtils . deleteWithConfirm ( tableFile ) ; 
 } 
 - 
 - if ( ! dir . delete ( ) ) 
 - logger . warn ( " could not delete " + dir . getPath ( ) ) ; 
 + FileUtils . deleteWithConfirm ( dir ) ; 
 } 
 } 
 
 diff - - git a / test / unit / org / apache / cassandra / db / OneCompactionTest . java b / test / unit / org / apache / cassandra / db / OneCompactionTest . java 
 index b53e0fb . . 1b31044 100644 
 - - - a / test / unit / org / apache / cassandra / db / OneCompactionTest . java 
 + + + b / test / unit / org / apache / cassandra / db / OneCompactionTest . java 
 @ @ - 28 , 8 + 28 , 9 @ @ import org . junit . Test ; 
 
 import static junit . framework . Assert . assertEquals ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class OneCompactionTest 
 + public class OneCompactionTest extends CleanupHelper 
 { 
 private void testCompaction ( String columnFamilyName , int insertsPerTable ) throws IOException , ExecutionException , InterruptedException 
 { 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java 
 index 35efad1 . . 7cc940d 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyTest . java 
 @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; 
 import static junit . framework . Assert . assertNull ; 
 import org . apache . cassandra . db . filter . IdentityQueryFilter ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class RemoveColumnFamilyTest 
 + public class RemoveColumnFamilyTest extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveColumnFamily ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java 
 index 423ad5a . . 512d2d3 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush1Test . java 
 @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; 
 import static junit . framework . Assert . assertNull ; 
 import org . apache . cassandra . db . filter . IdentityQueryFilter ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class RemoveColumnFamilyWithFlush1Test 
 + public class RemoveColumnFamilyWithFlush1Test extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveColumnFamilyWithFlush1 ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java 
 index 74220bd . . f1a08d9 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveColumnFamilyWithFlush2Test . java 
 @ @ - 26 , 8 + 26 , 9 @ @ import org . junit . Test ; 
 import static junit . framework . Assert . assertNull ; 
 import org . apache . cassandra . db . filter . IdentityQueryFilter ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class RemoveColumnFamilyWithFlush2Test 
 + public class RemoveColumnFamilyWithFlush2Test extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveColumnFamilyWithFlush2 ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveColumnTest . java 
 index dcc9093 . . 31ae44f 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveColumnTest . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveColumnTest . java 
 @ @ - 27 , 8 + 27 , 9 @ @ import static junit . framework . Assert . assertNull ; 
 import org . apache . cassandra . db . filter . IdentityQueryFilter ; 
 import org . apache . cassandra . db . filter . NamesQueryFilter ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class RemoveColumnTest 
 + public class RemoveColumnTest extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveColumn ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java 
 index a2e3e61 . . 2f71757 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveSubColumnTest . java 
 @ @ - 28 , 8 + 28 , 9 @ @ import org . apache . cassandra . db . filter . IdentityQueryFilter ; 
 import org . apache . cassandra . db . filter . QueryPath ; 
 import static org . apache . cassandra . Util . addMutation ; 
 import static org . apache . cassandra . Util . getBytes ; 
 + import org . apache . cassandra . CleanupHelper ; 
 
 - public class RemoveSubColumnTest 
 + public class RemoveSubColumnTest extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveSubColumn ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java b / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java 
 index e51167d . . 18b0942 100644 
 - - - a / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java 
 + + + b / test / unit / org / apache / cassandra / db / RemoveSuperColumnTest . java 
 @ @ - 33 , 9 + 33 , 10 @ @ import org . apache . cassandra . db . filter . QueryPath ; 
 import static org . apache . cassandra . Util . addMutation ; 
 import static org . apache . cassandra . Util . getBytes ; 
 import org . apache . cassandra . Util ; 
 + import org . apache . cassandra . CleanupHelper ; 
 import static junit . framework . Assert . assertNotNull ; 
 
 - public class RemoveSuperColumnTest 
 + public class RemoveSuperColumnTest extends CleanupHelper 
 { 
 @ Test 
 public void testRemoveSuperColumn ( ) throws IOException , ExecutionException , InterruptedException 
 diff - - git a / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java b / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java 
 index dd06767 . . e48968a 100644 
 - - - a / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java 
 + + + b / test / unit / org / apache / cassandra / service / AntiEntropyServiceTest . java 
 @ @ - 45 , 19 + 45 , 21 @ @ import static org . junit . Assert . * ; 
 
 public class AntiEntropyServiceTest extends CleanupHelper 
 { 
 - public static InetAddress LOCAL = FBUtilities . getLocalAddress ( ) ; 
 - 
 / / table and column family to test against 
 public AntiEntropyService aes ; 
 
 public static String tablename ; 
 public static String cfname ; 
 - public static InetAddress REMOTE ; 
 + public static InetAddress LOCAL , REMOTE ; 
 + 
 + private static boolean initialized ; 
 
 - static 
 + @ Before 
 + public void prepare ( ) throws Exception 
 { 
 - try 
 + if ( ! initialized ) 
 { 
 + LOCAL = FBUtilities . getLocalAddress ( ) ; 
 / / bump the replication factor so that local overlaps with REMOTE below 
 DatabaseDescriptorTest . setReplicationFactor ( 2 ) ; 
 
 @ @ - 71 , 16 + 73 , 8 @ @ public class AntiEntropyServiceTest extends CleanupHelper 
 
 tablename = DatabaseDescriptor . getTables ( ) . get ( 0 ) ; 
 cfname = Table . open ( tablename ) . getColumnFamilies ( ) . iterator ( ) . next ( ) ; 
 + initialized = true ; 
 } 
 - catch ( Exception e ) 
 - { 
 - throw new RuntimeException ( e ) ; 
 - } 
 - } 
 - 
 - @ Before 
 - public void prepare ( ) throws Exception 
 - { 
 aes = AntiEntropyService . instance ( ) ; 
 } 

