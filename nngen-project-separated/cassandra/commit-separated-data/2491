BLEU SCORE: 0.03527502360630138

TEST MSG: remove duplicate queries for local tokens
GENERATED MSG: fix for bootstrap when no non - system tables are defined

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 8c1d234 . . d7b7f00 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 20 , 6 + 20 , 7 @ @ <nl> * fix npe when doing - Dcassandra . fd _ initial _ value _ ms ( CASSANDRA - 6751 ) <nl> * Preserves CQL metadata when updating table from thrift ( CASSANDRA - 6831 ) <nl> * fix time conversion to milliseconds in SimpleCondition . await ( CASSANDRA - 7149 ) <nl> + * remove duplicate query for local tokens ( CASSANDRA - 7182 ) <nl> <nl> <nl> 1 . 2 . 16 <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index ed6d031 . . 7cecec9 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 209 , 8 + 209 , 9 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE <nl> SystemTable . updateTokens ( tokens ) ; <nl> tokenMetadata . updateNormalTokens ( tokens , FBUtilities . getBroadcastAddress ( ) ) ; <nl> / / order is important here , the gossiper can fire in between adding these two states . It ' s ok to send TOKENS without STATUS , but * not * vice versa . <nl> - Gossiper . instance . addLocalApplicationState ( ApplicationState . TOKENS , valueFactory . tokens ( getLocalTokens ( ) ) ) ; <nl> - Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( getLocalTokens ( ) ) ) ; <nl> + Collection < Token > localTokens = getLocalTokens ( ) ; <nl> + Gossiper . instance . addLocalApplicationState ( ApplicationState . TOKENS , valueFactory . tokens ( localTokens ) ) ; <nl> + Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( localTokens ) ) ; <nl> setMode ( Mode . NORMAL , false ) ; <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 188dbf2 . . 30e8275 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 39 , 6 + 39 , 7 @ @ dev <nl> * truncate includes secondary indexes ( CASSANDRA - 1747 ) <nl> * retain reference to PendingFile sstables ( CASSANDRA - 1749 ) <nl> * fix sstableimport regression ( CASSANDRA - 1753 ) <nl> + * fix for bootstrap when no non - system tables are defined ( CASSANDRA - 1732 ) <nl> <nl> <nl> 0 . 7 . 0 - beta3 <nl> diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java <nl> index ed76ba9 . . 7bf97e3 100644 <nl> - - - a / src / java / org / apache / cassandra / service / StorageService . java <nl> + + + b / src / java / org / apache / cassandra / service / StorageService . java <nl> @ @ - 417 , 7 + 417 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe <nl> { <nl> isBootstrapMode = false ; <nl> SystemTable . setBootstrapped ( true ) ; <nl> - tokenMetadata _ . updateNormalToken ( token , FBUtilities . getLocalAddress ( ) ) ; <nl> + setToken ( token ) ; <nl> Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( token ) ) ; <nl> setMode ( " Normal " , false ) ; <nl> }

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 8c1d234 . . d7b7f00 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 20 , 6 + 20 , 7 @ @ 
 * fix npe when doing - Dcassandra . fd _ initial _ value _ ms ( CASSANDRA - 6751 ) 
 * Preserves CQL metadata when updating table from thrift ( CASSANDRA - 6831 ) 
 * fix time conversion to milliseconds in SimpleCondition . await ( CASSANDRA - 7149 ) 
 + * remove duplicate query for local tokens ( CASSANDRA - 7182 ) 
 
 
 1 . 2 . 16 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index ed6d031 . . 7cecec9 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 209 , 8 + 209 , 9 @ @ public class StorageService extends NotificationBroadcasterSupport implements IE 
 SystemTable . updateTokens ( tokens ) ; 
 tokenMetadata . updateNormalTokens ( tokens , FBUtilities . getBroadcastAddress ( ) ) ; 
 / / order is important here , the gossiper can fire in between adding these two states . It ' s ok to send TOKENS without STATUS , but * not * vice versa . 
 - Gossiper . instance . addLocalApplicationState ( ApplicationState . TOKENS , valueFactory . tokens ( getLocalTokens ( ) ) ) ; 
 - Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( getLocalTokens ( ) ) ) ; 
 + Collection < Token > localTokens = getLocalTokens ( ) ; 
 + Gossiper . instance . addLocalApplicationState ( ApplicationState . TOKENS , valueFactory . tokens ( localTokens ) ) ; 
 + Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( localTokens ) ) ; 
 setMode ( Mode . NORMAL , false ) ; 
 } 


NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 188dbf2 . . 30e8275 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 39 , 6 + 39 , 7 @ @ dev 
 * truncate includes secondary indexes ( CASSANDRA - 1747 ) 
 * retain reference to PendingFile sstables ( CASSANDRA - 1749 ) 
 * fix sstableimport regression ( CASSANDRA - 1753 ) 
 + * fix for bootstrap when no non - system tables are defined ( CASSANDRA - 1732 ) 
 
 
 0 . 7 . 0 - beta3 
 diff - - git a / src / java / org / apache / cassandra / service / StorageService . java b / src / java / org / apache / cassandra / service / StorageService . java 
 index ed76ba9 . . 7bf97e3 100644 
 - - - a / src / java / org / apache / cassandra / service / StorageService . java 
 + + + b / src / java / org / apache / cassandra / service / StorageService . java 
 @ @ - 417 , 7 + 417 , 7 @ @ public class StorageService implements IEndpointStateChangeSubscriber , StorageSe 
 { 
 isBootstrapMode = false ; 
 SystemTable . setBootstrapped ( true ) ; 
 - tokenMetadata _ . updateNormalToken ( token , FBUtilities . getLocalAddress ( ) ) ; 
 + setToken ( token ) ; 
 Gossiper . instance . addLocalApplicationState ( ApplicationState . STATUS , valueFactory . normal ( token ) ) ; 
 setMode ( " Normal " , false ) ; 
 }
