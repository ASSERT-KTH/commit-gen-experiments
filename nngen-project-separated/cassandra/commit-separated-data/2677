BLEU SCORE: 0.007870921666513668

TEST MSG: Fix timestamp scaling issue for 6623
GENERATED MSG: bump version to 0 . 4 - dev . patch by johano ; reviewed by jbellis for CASSANDRA - 209

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java b / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java <nl> index 194ff0c . . 668f98f 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java <nl> @ @ - 43 , 7 + 43 , 8 @ @ public class CQL3CasConditions implements CASConditions <nl> public CQL3CasConditions ( CFMetaData cfm , long now ) <nl> { <nl> this . cfm = cfm ; <nl> - this . now = now ; <nl> + / / We will use now for Column . isLive ( ) which expects milliseconds but the argument is in microseconds . <nl> + this . now = now / 1000 ; <nl> this . conditions = new TreeMap < > ( cfm . comparator ) ; <nl> } <nl> <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> index ecefcb9 . . 154c01c 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java <nl> @ @ - 534 , 9 + 534 , 7 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF <nl> <nl> ByteBuffer key = keys . get ( 0 ) ; <nl> <nl> - / / It ' s cleaner to use the query timestamp below , but it ' s in seconds while the conditions expects microseconds , so just <nl> - / / put it back in millis ( we don ' t really lose precision because the ultimate consumer , Column . isLive , re - divide it ) . <nl> - CQL3CasConditions conditions = new CQL3CasConditions ( cfm , queryState . getTimestamp ( ) * 1000 ) ; <nl> + CQL3CasConditions conditions = new CQL3CasConditions ( cfm , queryState . getTimestamp ( ) ) ; <nl> ColumnNameBuilder prefix = createClusteringPrefixBuilder ( variables ) ; <nl> ColumnFamily updates = UnsortedColumns . factory . create ( cfm ) ; <nl> addUpdatesAndConditions ( key , prefix , updates , conditions , variables , getTimestamp ( queryState . getTimestamp ( ) , variables ) ) ;
NEAREST DIFF (one line): diff - - git a / build . xml b / build . xml <nl> index 4d65838 . . 310c874 100644 <nl> - - - a / build . xml <nl> + + + b / build . xml <nl> @ @ - 37 , 7 + 37 , 7 @ @ <nl> < property name = " test . name " value = " * Test " / > <nl> < property name = " test . unit . src " value = " $ { test . dir } / unit " / > <nl> < property name = " dist . dir " value = " $ { build . dir } / dist " / > <nl> - < property name = " version " value = " 0 . 3 . 0 - dev " / > <nl> + < property name = " version " value = " 0 . 4 . 0 - dev " / > <nl> < property name = " final . name " value = " $ { ant . project . name } - $ { version } " / > <nl> <nl> < ! - - http : / / cobertura . sourceforge . net / - - >

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java b / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java 
 index 194ff0c . . 668f98f 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / CQL3CasConditions . java 
 @ @ - 43 , 7 + 43 , 8 @ @ public class CQL3CasConditions implements CASConditions 
 public CQL3CasConditions ( CFMetaData cfm , long now ) 
 { 
 this . cfm = cfm ; 
 - this . now = now ; 
 + / / We will use now for Column . isLive ( ) which expects milliseconds but the argument is in microseconds . 
 + this . now = now / 1000 ; 
 this . conditions = new TreeMap < > ( cfm . comparator ) ; 
 } 
 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 index ecefcb9 . . 154c01c 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / ModificationStatement . java 
 @ @ - 534 , 9 + 534 , 7 @ @ public abstract class ModificationStatement implements CQLStatement , MeasurableF 
 
 ByteBuffer key = keys . get ( 0 ) ; 
 
 - / / It ' s cleaner to use the query timestamp below , but it ' s in seconds while the conditions expects microseconds , so just 
 - / / put it back in millis ( we don ' t really lose precision because the ultimate consumer , Column . isLive , re - divide it ) . 
 - CQL3CasConditions conditions = new CQL3CasConditions ( cfm , queryState . getTimestamp ( ) * 1000 ) ; 
 + CQL3CasConditions conditions = new CQL3CasConditions ( cfm , queryState . getTimestamp ( ) ) ; 
 ColumnNameBuilder prefix = createClusteringPrefixBuilder ( variables ) ; 
 ColumnFamily updates = UnsortedColumns . factory . create ( cfm ) ; 
 addUpdatesAndConditions ( key , prefix , updates , conditions , variables , getTimestamp ( queryState . getTimestamp ( ) , variables ) ) ;

NEAREST DIFF:
diff - - git a / build . xml b / build . xml 
 index 4d65838 . . 310c874 100644 
 - - - a / build . xml 
 + + + b / build . xml 
 @ @ - 37 , 7 + 37 , 7 @ @ 
 < property name = " test . name " value = " * Test " / > 
 < property name = " test . unit . src " value = " $ { test . dir } / unit " / > 
 < property name = " dist . dir " value = " $ { build . dir } / dist " / > 
 - < property name = " version " value = " 0 . 3 . 0 - dev " / > 
 + < property name = " version " value = " 0 . 4 . 0 - dev " / > 
 < property name = " final . name " value = " $ { ant . project . name } - $ { version } " / > 
 
 < ! - - http : / / cobertura . sourceforge . net / - - >
