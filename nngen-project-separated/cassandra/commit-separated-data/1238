BLEU SCORE: 0.09287528999566796

TEST MSG: Fix paging issues with partitions containing only static columns data
GENERATED MSG: Fix paging with reversed slices

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index b17929c . . dbb3480 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 6 @ @ <nl> 2 . 1 . 12 <nl> + * Fix paging issues with partitions containing only static columns data <nl> + ( CASSANDRA - 10381 ) <nl> * Fix conditions on static columns ( CASSANDRA - 10264 ) <nl> * AssertionError : attempted to delete non - existing file CommitLog ( CASSANDRA - 10377 ) <nl> * Merge range tombstones during compaction ( CASSANDRA - 7953 ) <nl> diff - - git a / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java b / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java <nl> index a3991ed . . 6056b9a 100644 <nl> - - - a / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java <nl> + + + b / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java <nl> @ @ - 345 , 7 + 345 , 11 @ @ abstract class AbstractQueryPager implements QueryPager <nl> copy . addColumn ( iter . next ( ) ) ; <nl> } <nl> } <nl> - return Math . min ( counter . live ( ) , toDiscard ) ; <nl> + int live = counter . live ( ) ; <nl> + / / We want to take into account the row even if it was containing only static columns <nl> + if ( live = = 0 & & ! staticCells . isEmpty ( ) ) <nl> + live = 1 ; <nl> + return Math . min ( live , toDiscard ) ; <nl> } <nl> <nl> private int discardTail ( ColumnFamily cf , int toDiscard , ColumnFamily copy , Iterator < Cell > iter , DeletionInfo . InOrderTester tester ) <nl> diff - - git a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> index e02bb46 . . fd14c82 100644 <nl> - - - a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> + + + b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java <nl> @ @ - 98 , 10 + 98 , 14 @ @ public class RangeSliceQueryPager extends AbstractQueryPager <nl> <nl> / / Same as SliceQueryPager , we ignore a deleted column <nl> Cell firstCell = isReversed ( ) ? lastCell ( first . cf ) : firstNonStaticCell ( first . cf ) ; <nl> + / / If the row was containing only static columns it has already been returned and we can skip it . <nl> + if ( firstCell = = null ) <nl> + return true ; <nl> + <nl> CFMetaData metadata = Schema . instance . getCFMetaData ( command . keyspace , command . columnFamily ) ; <nl> return ! first . cf . deletionInfo ( ) . isDeleted ( firstCell ) <nl> - & & firstCell . isLive ( timestamp ( ) ) <nl> - & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturnedName ) ; <nl> + & & firstCell . isLive ( timestamp ( ) ) <nl> + & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturnedName ) ; <nl> } <nl> <nl> protected boolean recordLast ( Row last ) <nl> diff - - git a / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java <nl> index c8572d4 . . 1a2fc6c 100644 <nl> - - - a / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java <nl> + + + b / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java <nl> @ @ - 102 , 12 + 102 , 17 @ @ public class SliceQueryPager extends AbstractQueryPager implements SinglePartiti <nl> return false ; <nl> <nl> Cell firstCell = isReversed ( ) ? lastCell ( first . cf ) : firstNonStaticCell ( first . cf ) ; <nl> + / / If the row was containing only static columns it has already been returned and we can skip it . <nl> + if ( firstCell = = null ) <nl> + return true ; <nl> + <nl> CFMetaData metadata = Schema . instance . getCFMetaData ( command . getKeyspace ( ) , command . getColumnFamilyName ( ) ) ; <nl> / / Note : we only return true if the column is the lastReturned * and * it is live . If it is deleted , it is ignored by the <nl> / / rest of the paging code ( it hasn ' t been counted as live in particular ) and we want to act as if it wasn ' t there . <nl> + <nl> return ! first . cf . deletionInfo ( ) . isDeleted ( firstCell ) <nl> - & & firstCell . isLive ( timestamp ( ) ) <nl> - & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturned ) ; <nl> + & & firstCell . isLive ( timestamp ( ) ) <nl> + & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturned ) ; <nl> } <nl> <nl> protected boolean recordLast ( Row last )
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 159e8de . . 6a07720 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 21 , 6 + 21 , 7 @ @ <nl> * Fix CQL3 table validation in Thrift ( CASSANDRA - 6140 ) <nl> * Fix bug missing results with IN clauses ( CASSANDRA - 6327 ) <nl> * Fix paging with reversed slices ( CASSANDRA - 6343 ) <nl> + * Set minTimestamp correctly to be able to drop expired sstables ( CASSANDRA - 6337 ) <nl> Merged from 1 . 2 : <nl> * add non - jamm path for cached statements ( CASSANDRA - 6293 ) <nl> * ( Hadoop ) Require CFRR batchSize to be at least 2 ( CASSANDRA - 6114 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionController . java b / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> index 65515d6 . . 3ab2202 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / CompactionController . java <nl> @ @ - 106 , 7 + 106 , 7 @ @ public class CompactionController <nl> <nl> List < SSTableReader > candidates = new ArrayList < SSTableReader > ( ) ; <nl> <nl> - long minTimestamp = Integer . MAX _ VALUE ; <nl> + long minTimestamp = Long . MAX _ VALUE ; <nl> <nl> for ( SSTableReader sstable : overlapping ) <nl> minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ;

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index b17929c . . dbb3480 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 6 @ @ 
 2 . 1 . 12 
 + * Fix paging issues with partitions containing only static columns data 
 + ( CASSANDRA - 10381 ) 
 * Fix conditions on static columns ( CASSANDRA - 10264 ) 
 * AssertionError : attempted to delete non - existing file CommitLog ( CASSANDRA - 10377 ) 
 * Merge range tombstones during compaction ( CASSANDRA - 7953 ) 
 diff - - git a / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java b / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java 
 index a3991ed . . 6056b9a 100644 
 - - - a / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java 
 + + + b / src / java / org / apache / cassandra / service / pager / AbstractQueryPager . java 
 @ @ - 345 , 7 + 345 , 11 @ @ abstract class AbstractQueryPager implements QueryPager 
 copy . addColumn ( iter . next ( ) ) ; 
 } 
 } 
 - return Math . min ( counter . live ( ) , toDiscard ) ; 
 + int live = counter . live ( ) ; 
 + / / We want to take into account the row even if it was containing only static columns 
 + if ( live = = 0 & & ! staticCells . isEmpty ( ) ) 
 + live = 1 ; 
 + return Math . min ( live , toDiscard ) ; 
 } 
 
 private int discardTail ( ColumnFamily cf , int toDiscard , ColumnFamily copy , Iterator < Cell > iter , DeletionInfo . InOrderTester tester ) 
 diff - - git a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 index e02bb46 . . fd14c82 100644 
 - - - a / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 + + + b / src / java / org / apache / cassandra / service / pager / RangeSliceQueryPager . java 
 @ @ - 98 , 10 + 98 , 14 @ @ public class RangeSliceQueryPager extends AbstractQueryPager 
 
 / / Same as SliceQueryPager , we ignore a deleted column 
 Cell firstCell = isReversed ( ) ? lastCell ( first . cf ) : firstNonStaticCell ( first . cf ) ; 
 + / / If the row was containing only static columns it has already been returned and we can skip it . 
 + if ( firstCell = = null ) 
 + return true ; 
 + 
 CFMetaData metadata = Schema . instance . getCFMetaData ( command . keyspace , command . columnFamily ) ; 
 return ! first . cf . deletionInfo ( ) . isDeleted ( firstCell ) 
 - & & firstCell . isLive ( timestamp ( ) ) 
 - & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturnedName ) ; 
 + & & firstCell . isLive ( timestamp ( ) ) 
 + & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturnedName ) ; 
 } 
 
 protected boolean recordLast ( Row last ) 
 diff - - git a / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java b / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java 
 index c8572d4 . . 1a2fc6c 100644 
 - - - a / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java 
 + + + b / src / java / org / apache / cassandra / service / pager / SliceQueryPager . java 
 @ @ - 102 , 12 + 102 , 17 @ @ public class SliceQueryPager extends AbstractQueryPager implements SinglePartiti 
 return false ; 
 
 Cell firstCell = isReversed ( ) ? lastCell ( first . cf ) : firstNonStaticCell ( first . cf ) ; 
 + / / If the row was containing only static columns it has already been returned and we can skip it . 
 + if ( firstCell = = null ) 
 + return true ; 
 + 
 CFMetaData metadata = Schema . instance . getCFMetaData ( command . getKeyspace ( ) , command . getColumnFamilyName ( ) ) ; 
 / / Note : we only return true if the column is the lastReturned * and * it is live . If it is deleted , it is ignored by the 
 / / rest of the paging code ( it hasn ' t been counted as live in particular ) and we want to act as if it wasn ' t there . 
 + 
 return ! first . cf . deletionInfo ( ) . isDeleted ( firstCell ) 
 - & & firstCell . isLive ( timestamp ( ) ) 
 - & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturned ) ; 
 + & & firstCell . isLive ( timestamp ( ) ) 
 + & & firstCell . name ( ) . isSameCQL3RowAs ( metadata . comparator , lastReturned ) ; 
 } 
 
 protected boolean recordLast ( Row last )

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 159e8de . . 6a07720 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 21 , 6 + 21 , 7 @ @ 
 * Fix CQL3 table validation in Thrift ( CASSANDRA - 6140 ) 
 * Fix bug missing results with IN clauses ( CASSANDRA - 6327 ) 
 * Fix paging with reversed slices ( CASSANDRA - 6343 ) 
 + * Set minTimestamp correctly to be able to drop expired sstables ( CASSANDRA - 6337 ) 
 Merged from 1 . 2 : 
 * add non - jamm path for cached statements ( CASSANDRA - 6293 ) 
 * ( Hadoop ) Require CFRR batchSize to be at least 2 ( CASSANDRA - 6114 ) 
 diff - - git a / src / java / org / apache / cassandra / db / compaction / CompactionController . java b / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 index 65515d6 . . 3ab2202 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / CompactionController . java 
 @ @ - 106 , 7 + 106 , 7 @ @ public class CompactionController 
 
 List < SSTableReader > candidates = new ArrayList < SSTableReader > ( ) ; 
 
 - long minTimestamp = Integer . MAX _ VALUE ; 
 + long minTimestamp = Long . MAX _ VALUE ; 
 
 for ( SSTableReader sstable : overlapping ) 
 minTimestamp = Math . min ( minTimestamp , sstable . getMinTimestamp ( ) ) ;
