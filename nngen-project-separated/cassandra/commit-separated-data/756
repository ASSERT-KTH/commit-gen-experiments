BLEU SCORE: 0.01222796968620182

TEST MSG: Prepend " dropped " / " truncated " to pre - drop / truncate snapshot names
GENERATED MSG: Fix setting ' durable _ writes ' in ALTER KEYSPACE

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 0d1557b . . ec4be3e 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 6 @ @ <nl> 3 . 10 <nl> + * Prepend snapshot name with " truncated " or " dropped " when a snapshot <nl> + is taken before truncating or dropping a table ( CASSANDRA - 12178 ) <nl> * Optimize RestrictionSet ( CASSANDRA - 12153 ) <nl> * cqlsh does not automatically downgrade CQL version ( CASSANDRA - 12150 ) <nl> * Omit ( de ) serialization of state variable in UDAs ( CASSANDRA - 9613 ) <nl> diff - - git a / NEWS . txt b / NEWS . txt <nl> index fd6f005 . . 56fb8cf 100644 <nl> - - - a / NEWS . txt <nl> + + + b / NEWS . txt <nl> @ @ - 29 , 6 + 29 , 9 @ @ New features <nl> testing and , as a consequence , it is not guaranteed to work in all cases . <nl> See CASSANDRA - 12150 for more details . <nl> <nl> + - Snapshots that are automatically taken before a table is dropped or truncated <nl> + will have a " dropped " or " truncated " prefix on their snapshot tag name . <nl> + <nl> Upgrading <nl> - - - - - - - - - <nl> - Nothing specific to 3 . 10 but please see previous versions upgrading section , <nl> diff - - git a / src / java / org / apache / cassandra / config / Schema . java b / src / java / org / apache / cassandra / config / Schema . java <nl> index 47d8198 . . dd42779 100644 <nl> - - - a / src / java / org / apache / cassandra / config / Schema . java <nl> + + + b / src / java / org / apache / cassandra / config / Schema . java <nl> @ @ - 611 , 7 + 611 , 7 @ @ public class Schema <nl> public void dropKeyspace ( String ksName ) <nl> { <nl> KeyspaceMetadata ksm = Schema . instance . getKSMetaData ( ksName ) ; <nl> - String snapshotName = Keyspace . getTimestampedSnapshotName ( ksName ) ; <nl> + String snapshotName = Keyspace . getTimestampedSnapshotNameWithPrefix ( ksName , ColumnFamilyStore . SNAPSHOT _ DROP _ PREFIX ) ; <nl> <nl> CompactionManager . instance . interruptCompactionFor ( ksm . tablesAndViews ( ) , true ) ; <nl> <nl> @ @ - 690 , 7 + 690 , 7 @ @ public class Schema <nl> CompactionManager . instance . interruptCompactionFor ( Collections . singleton ( cfm ) , true ) ; <nl> <nl> if ( DatabaseDescriptor . isAutoSnapshot ( ) ) <nl> - cfs . snapshot ( Keyspace . getTimestampedSnapshotName ( cfs . name ) ) ; <nl> + cfs . snapshot ( Keyspace . getTimestampedSnapshotNameWithPrefix ( cfs . name , ColumnFamilyStore . SNAPSHOT _ DROP _ PREFIX ) ) ; <nl> Keyspace . open ( ksName ) . dropCf ( cfm . cfId ) ; <nl> MigrationManager . instance . notifyDropColumnFamily ( cfm ) ; <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index 0a3ad52 . . 938ea32 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 186 , 6 + 186 , 9 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> private static final String SAMPLING _ RESULTS _ NAME = " SAMPLING _ RESULTS " ; <nl> private static final CompositeType SAMPLING _ RESULT ; <nl> <nl> + public static final String SNAPSHOT _ TRUNCATE _ PREFIX = " truncated " ; <nl> + public static final String SNAPSHOT _ DROP _ PREFIX = " dropped " ; <nl> + <nl> static <nl> { <nl> try <nl> @ @ - 2158 , 7 + 2161 , 7 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> data . notifyTruncated ( truncatedAt ) ; <nl> <nl> if ( DatabaseDescriptor . isAutoSnapshot ( ) ) <nl> - snapshot ( Keyspace . getTimestampedSnapshotName ( name ) ) ; <nl> + snapshot ( Keyspace . getTimestampedSnapshotNameWithPrefix ( name , SNAPSHOT _ TRUNCATE _ PREFIX ) ) ; <nl> <nl> discardSSTables ( truncatedAt ) ; <nl> <nl> diff - - git a / src / java / org / apache / cassandra / db / Keyspace . java b / src / java / org / apache / cassandra / db / Keyspace . java <nl> index 6e44308 . . 37ed1e1 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Keyspace . java <nl> + + + b / src / java / org / apache / cassandra / db / Keyspace . java <nl> @ @ - 263 , 6 + 263 , 11 @ @ public class Keyspace <nl> return snapshotName ; <nl> } <nl> <nl> + public static String getTimestampedSnapshotNameWithPrefix ( String clientSuppliedName , String prefix ) <nl> + { <nl> + return prefix + " - " + getTimestampedSnapshotName ( clientSuppliedName ) ; <nl> + } <nl> + <nl> / * * <nl> * Check whether snapshots already exists for a given name . <nl> *
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 0d1557b . . ec4be3e 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 6 @ @ 
 3 . 10 
 + * Prepend snapshot name with " truncated " or " dropped " when a snapshot 
 + is taken before truncating or dropping a table ( CASSANDRA - 12178 ) 
 * Optimize RestrictionSet ( CASSANDRA - 12153 ) 
 * cqlsh does not automatically downgrade CQL version ( CASSANDRA - 12150 ) 
 * Omit ( de ) serialization of state variable in UDAs ( CASSANDRA - 9613 ) 
 diff - - git a / NEWS . txt b / NEWS . txt 
 index fd6f005 . . 56fb8cf 100644 
 - - - a / NEWS . txt 
 + + + b / NEWS . txt 
 @ @ - 29 , 6 + 29 , 9 @ @ New features 
 testing and , as a consequence , it is not guaranteed to work in all cases . 
 See CASSANDRA - 12150 for more details . 
 
 + - Snapshots that are automatically taken before a table is dropped or truncated 
 + will have a " dropped " or " truncated " prefix on their snapshot tag name . 
 + 
 Upgrading 
 - - - - - - - - - 
 - Nothing specific to 3 . 10 but please see previous versions upgrading section , 
 diff - - git a / src / java / org / apache / cassandra / config / Schema . java b / src / java / org / apache / cassandra / config / Schema . java 
 index 47d8198 . . dd42779 100644 
 - - - a / src / java / org / apache / cassandra / config / Schema . java 
 + + + b / src / java / org / apache / cassandra / config / Schema . java 
 @ @ - 611 , 7 + 611 , 7 @ @ public class Schema 
 public void dropKeyspace ( String ksName ) 
 { 
 KeyspaceMetadata ksm = Schema . instance . getKSMetaData ( ksName ) ; 
 - String snapshotName = Keyspace . getTimestampedSnapshotName ( ksName ) ; 
 + String snapshotName = Keyspace . getTimestampedSnapshotNameWithPrefix ( ksName , ColumnFamilyStore . SNAPSHOT _ DROP _ PREFIX ) ; 
 
 CompactionManager . instance . interruptCompactionFor ( ksm . tablesAndViews ( ) , true ) ; 
 
 @ @ - 690 , 7 + 690 , 7 @ @ public class Schema 
 CompactionManager . instance . interruptCompactionFor ( Collections . singleton ( cfm ) , true ) ; 
 
 if ( DatabaseDescriptor . isAutoSnapshot ( ) ) 
 - cfs . snapshot ( Keyspace . getTimestampedSnapshotName ( cfs . name ) ) ; 
 + cfs . snapshot ( Keyspace . getTimestampedSnapshotNameWithPrefix ( cfs . name , ColumnFamilyStore . SNAPSHOT _ DROP _ PREFIX ) ) ; 
 Keyspace . open ( ksName ) . dropCf ( cfm . cfId ) ; 
 MigrationManager . instance . notifyDropColumnFamily ( cfm ) ; 
 
 diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index 0a3ad52 . . 938ea32 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 186 , 6 + 186 , 9 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 private static final String SAMPLING _ RESULTS _ NAME = " SAMPLING _ RESULTS " ; 
 private static final CompositeType SAMPLING _ RESULT ; 
 
 + public static final String SNAPSHOT _ TRUNCATE _ PREFIX = " truncated " ; 
 + public static final String SNAPSHOT _ DROP _ PREFIX = " dropped " ; 
 + 
 static 
 { 
 try 
 @ @ - 2158 , 7 + 2161 , 7 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 data . notifyTruncated ( truncatedAt ) ; 
 
 if ( DatabaseDescriptor . isAutoSnapshot ( ) ) 
 - snapshot ( Keyspace . getTimestampedSnapshotName ( name ) ) ; 
 + snapshot ( Keyspace . getTimestampedSnapshotNameWithPrefix ( name , SNAPSHOT _ TRUNCATE _ PREFIX ) ) ; 
 
 discardSSTables ( truncatedAt ) ; 
 
 diff - - git a / src / java / org / apache / cassandra / db / Keyspace . java b / src / java / org / apache / cassandra / db / Keyspace . java 
 index 6e44308 . . 37ed1e1 100644 
 - - - a / src / java / org / apache / cassandra / db / Keyspace . java 
 + + + b / src / java / org / apache / cassandra / db / Keyspace . java 
 @ @ - 263 , 6 + 263 , 11 @ @ public class Keyspace 
 return snapshotName ; 
 } 
 
 + public static String getTimestampedSnapshotNameWithPrefix ( String clientSuppliedName , String prefix ) 
 + { 
 + return prefix + " - " + getTimestampedSnapshotName ( clientSuppliedName ) ; 
 + } 
 + 
 / * * 
 * Check whether snapshots already exists for a given name . 
 *

NEAREST DIFF:
ELIMINATEDSENTENCE
