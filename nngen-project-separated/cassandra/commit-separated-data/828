BLEU SCORE: 0.028398387225677897

TEST MSG: validate the version string , before trying to build a Version object from it
GENERATED MSG: LegacySSTableTest should ignore invalid directories . patch by stuhood , reviewed by gdusbabek

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / Descriptor . java b / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> index ff4abfc . . 7840985 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> @ @ - 278 , 11 + 278 , 12 @ @ public class Descriptor <nl> <nl> / / version <nl> nexttok = tokenStack . pop ( ) ; <nl> - Version version = fmt . info . getVersion ( nexttok ) ; <nl> <nl> - if ( ! version . validate ( nexttok ) ) <nl> + if ( ! Version . validate ( nexttok ) ) <nl> throw new UnsupportedOperationException ( " SSTable " + name + " is too old to open . Upgrade to 2 . 0 first , and run upgradesstables " ) ; <nl> <nl> + Version version = fmt . info . getVersion ( nexttok ) ; <nl> + <nl> / / ks / cf names <nl> String ksname , cfname ; <nl> if ( version . hasNewFileName ( ) )
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / io / sstable / Descriptor . java b / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> index 504a606 . . 2c7b770 100644 <nl> - - - a / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> + + + b / src / java / org / apache / cassandra / io / sstable / Descriptor . java <nl> @ @ - 128 , 7 + 128 , 7 @ @ public class Descriptor <nl> * @ return True if the given version string is not empty , and <nl> * contains all lowercase letters , as defined by java . lang . Character . <nl> * / <nl> - private static boolean versionValidate ( String ver ) <nl> + static boolean versionValidate ( String ver ) <nl> { <nl> if ( ver . length ( ) < 1 ) return false ; <nl> for ( char ch : ver . toCharArray ( ) ) <nl> diff - - git a / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java b / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java <nl> index 99f4a83 . . cc381af 100644 <nl> - - - a / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java <nl> + + + b / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java <nl> @ @ - 92 , 7 + 92 , 8 @ @ public class LegacySSTableTest extends CleanupHelper <nl> public void testVersions ( ) throws IOException <nl> { <nl> for ( File version : LEGACY _ SSTABLE _ ROOT . listFiles ( ) ) <nl> - testVersion ( version . getName ( ) ) ; <nl> + if ( Descriptor . versionValidate ( version . getName ( ) ) ) <nl> + testVersion ( version . getName ( ) ) ; <nl> } <nl> <nl> public void testVersion ( String version )

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / Descriptor . java b / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 index ff4abfc . . 7840985 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 @ @ - 278 , 11 + 278 , 12 @ @ public class Descriptor 
 
 / / version 
 nexttok = tokenStack . pop ( ) ; 
 - Version version = fmt . info . getVersion ( nexttok ) ; 
 
 - if ( ! version . validate ( nexttok ) ) 
 + if ( ! Version . validate ( nexttok ) ) 
 throw new UnsupportedOperationException ( " SSTable " + name + " is too old to open . Upgrade to 2 . 0 first , and run upgradesstables " ) ; 
 
 + Version version = fmt . info . getVersion ( nexttok ) ; 
 + 
 / / ks / cf names 
 String ksname , cfname ; 
 if ( version . hasNewFileName ( ) )

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / io / sstable / Descriptor . java b / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 index 504a606 . . 2c7b770 100644 
 - - - a / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 + + + b / src / java / org / apache / cassandra / io / sstable / Descriptor . java 
 @ @ - 128 , 7 + 128 , 7 @ @ public class Descriptor 
 * @ return True if the given version string is not empty , and 
 * contains all lowercase letters , as defined by java . lang . Character . 
 * / 
 - private static boolean versionValidate ( String ver ) 
 + static boolean versionValidate ( String ver ) 
 { 
 if ( ver . length ( ) < 1 ) return false ; 
 for ( char ch : ver . toCharArray ( ) ) 
 diff - - git a / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java b / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java 
 index 99f4a83 . . cc381af 100644 
 - - - a / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java 
 + + + b / test / unit / org / apache / cassandra / io / sstable / LegacySSTableTest . java 
 @ @ - 92 , 7 + 92 , 8 @ @ public class LegacySSTableTest extends CleanupHelper 
 public void testVersions ( ) throws IOException 
 { 
 for ( File version : LEGACY _ SSTABLE _ ROOT . listFiles ( ) ) 
 - testVersion ( version . getName ( ) ) ; 
 + if ( Descriptor . versionValidate ( version . getName ( ) ) ) 
 + testVersion ( version . getName ( ) ) ; 
 } 
 
 public void testVersion ( String version )
