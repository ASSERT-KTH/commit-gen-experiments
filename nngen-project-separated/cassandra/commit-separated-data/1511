BLEU SCORE: 1.0

TEST MSG: Ensure StreamSession uses canonical sstable instances
GENERATED MSG: Ensure StreamSession uses canonical sstable instances

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / streaming / StreamSession . java b / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> index d27c4e2 . . c9ebdad 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamSession . java <nl> @ @ - 321 , 18 + 321 , 21 @ @ public class StreamSession implements IEndpointStateChangeSubscriber <nl> { <nl> public List < SSTableReader > apply ( View view ) <nl> { <nl> - List < SSTableReader > filteredSSTables = ColumnFamilyStore . CANONICAL _ SSTABLES . apply ( view ) ; <nl> + Map < SSTableReader , SSTableReader > permittedInstances = new HashMap < > ( ) ; <nl> + for ( SSTableReader reader : ColumnFamilyStore . CANONICAL _ SSTABLES . apply ( view ) ) <nl> + permittedInstances . put ( reader , reader ) ; <nl> + <nl> Set < SSTableReader > sstables = Sets . newHashSet ( ) ; <nl> - if ( filteredSSTables ! = null ) <nl> + for ( AbstractBounds < PartitionPosition > rowBounds : rowBoundsList ) <nl> { <nl> - for ( AbstractBounds < PartitionPosition > rowBounds : rowBoundsList ) <nl> + / / sstableInBounds may contain early opened sstables <nl> + for ( SSTableReader sstable : view . sstablesInBounds ( rowBounds ) ) <nl> { <nl> - / / sstableInBounds may contain early opened sstables <nl> - for ( SSTableReader sstable : view . sstablesInBounds ( rowBounds ) ) <nl> - { <nl> - if ( filteredSSTables . contains ( sstable ) & & ( ! isIncremental | | ! sstable . isRepaired ( ) ) ) <nl> - sstables . add ( sstable ) ; <nl> - } <nl> + if ( isIncremental & & sstable . isRepaired ( ) ) <nl> + continue ; <nl> + sstable = permittedInstances . get ( sstable ) ; <nl> + if ( sstable ! = null ) <nl> + sstables . add ( sstable ) ; <nl> } <nl> } <nl>
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / streaming / StreamSession . java b / src / java / org / apache / cassandra / streaming / StreamSession . java 
 index d27c4e2 . . c9ebdad 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamSession . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamSession . java 
 @ @ - 321 , 18 + 321 , 21 @ @ public class StreamSession implements IEndpointStateChangeSubscriber 
 { 
 public List < SSTableReader > apply ( View view ) 
 { 
 - List < SSTableReader > filteredSSTables = ColumnFamilyStore . CANONICAL _ SSTABLES . apply ( view ) ; 
 + Map < SSTableReader , SSTableReader > permittedInstances = new HashMap < > ( ) ; 
 + for ( SSTableReader reader : ColumnFamilyStore . CANONICAL _ SSTABLES . apply ( view ) ) 
 + permittedInstances . put ( reader , reader ) ; 
 + 
 Set < SSTableReader > sstables = Sets . newHashSet ( ) ; 
 - if ( filteredSSTables ! = null ) 
 + for ( AbstractBounds < PartitionPosition > rowBounds : rowBoundsList ) 
 { 
 - for ( AbstractBounds < PartitionPosition > rowBounds : rowBoundsList ) 
 + / / sstableInBounds may contain early opened sstables 
 + for ( SSTableReader sstable : view . sstablesInBounds ( rowBounds ) ) 
 { 
 - / / sstableInBounds may contain early opened sstables 
 - for ( SSTableReader sstable : view . sstablesInBounds ( rowBounds ) ) 
 - { 
 - if ( filteredSSTables . contains ( sstable ) & & ( ! isIncremental | | ! sstable . isRepaired ( ) ) ) 
 - sstables . add ( sstable ) ; 
 - } 
 + if ( isIncremental & & sstable . isRepaired ( ) ) 
 + continue ; 
 + sstable = permittedInstances . get ( sstable ) ; 
 + if ( sstable ! = null ) 
 + sstables . add ( sstable ) ; 
 } 
 } 


NEAREST DIFF:
ELIMINATEDSENTENCE
