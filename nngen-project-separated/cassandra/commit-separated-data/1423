BLEU SCORE: 0.012079826799606154

TEST MSG: Fix NPE when internode compression is off
GENERATED MSG: move eofexception ST down to trace . patch by jbellis for CASSANDRA - 657

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> index 375da64 . . cfdb854 100644 <nl> - - - a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> + + + b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> @ @ - 21 , 6 + 21 , 8 @ @ import java . io . * ; <nl> import java . net . InetAddress ; <nl> import java . net . Socket ; <nl> import java . net . SocketException ; <nl> + import java . nio . channels . Channels ; <nl> + import java . nio . channels . ReadableByteChannel ; <nl> import java . util . zip . Checksum ; <nl> import java . util . Set ; <nl> <nl> @ @ - 162 , 7 + 164 , 8 @ @ public class IncomingTcpConnection extends Thread implements Closeable <nl> } <nl> else <nl> { <nl> - in = new NIODataInputStream ( socket . getChannel ( ) , BUFFER _ SIZE ) ; <nl> + ReadableByteChannel channel = socket . getChannel ( ) ; <nl> + in = new NIODataInputStream ( channel ! = null ? channel : Channels . newChannel ( socket . getInputStream ( ) ) , BUFFER _ SIZE ) ; <nl> } <nl> <nl> while ( true )
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> index 7e5a1fb . . dcc0f0e 100644 <nl> - - - a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> + + + b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java <nl> @ @ - 1 , 9 + 1 , 6 @ @ <nl> package org . apache . cassandra . net ; <nl> <nl> - import java . io . ByteArrayInputStream ; <nl> - import java . io . DataInputStream ; <nl> - import java . io . IOError ; <nl> - import java . io . IOException ; <nl> + import java . io . * ; <nl> import java . net . Socket ; <nl> import java . nio . ByteBuffer ; <nl> <nl> @ @ - 57 , 6 + 54 , 12 @ @ public class IncomingTcpConnection extends Thread <nl> MessagingService . getDeserializationExecutor ( ) . submit ( new MessageDeserializationTask ( new ByteArrayInputStream ( contentBytes ) ) ) ; <nl> } <nl> } <nl> + catch ( EOFException e ) <nl> + { <nl> + if ( logger . isTraceEnabled ( ) ) <nl> + logger . trace ( " error reading from socket ; closing " , e ) ; <nl> + break ; <nl> + } <nl> catch ( IOException e ) <nl> { <nl> if ( logger . isDebugEnabled ( ) )

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 index 375da64 . . cfdb854 100644 
 - - - a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 + + + b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 @ @ - 21 , 6 + 21 , 8 @ @ import java . io . * ; 
 import java . net . InetAddress ; 
 import java . net . Socket ; 
 import java . net . SocketException ; 
 + import java . nio . channels . Channels ; 
 + import java . nio . channels . ReadableByteChannel ; 
 import java . util . zip . Checksum ; 
 import java . util . Set ; 
 
 @ @ - 162 , 7 + 164 , 8 @ @ public class IncomingTcpConnection extends Thread implements Closeable 
 } 
 else 
 { 
 - in = new NIODataInputStream ( socket . getChannel ( ) , BUFFER _ SIZE ) ; 
 + ReadableByteChannel channel = socket . getChannel ( ) ; 
 + in = new NIODataInputStream ( channel ! = null ? channel : Channels . newChannel ( socket . getInputStream ( ) ) , BUFFER _ SIZE ) ; 
 } 
 
 while ( true )

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 index 7e5a1fb . . dcc0f0e 100644 
 - - - a / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 + + + b / src / java / org / apache / cassandra / net / IncomingTcpConnection . java 
 @ @ - 1 , 9 + 1 , 6 @ @ 
 package org . apache . cassandra . net ; 
 
 - import java . io . ByteArrayInputStream ; 
 - import java . io . DataInputStream ; 
 - import java . io . IOError ; 
 - import java . io . IOException ; 
 + import java . io . * ; 
 import java . net . Socket ; 
 import java . nio . ByteBuffer ; 
 
 @ @ - 57 , 6 + 54 , 12 @ @ public class IncomingTcpConnection extends Thread 
 MessagingService . getDeserializationExecutor ( ) . submit ( new MessageDeserializationTask ( new ByteArrayInputStream ( contentBytes ) ) ) ; 
 } 
 } 
 + catch ( EOFException e ) 
 + { 
 + if ( logger . isTraceEnabled ( ) ) 
 + logger . trace ( " error reading from socket ; closing " , e ) ; 
 + break ; 
 + } 
 catch ( IOException e ) 
 { 
 if ( logger . isDebugEnabled ( ) )
