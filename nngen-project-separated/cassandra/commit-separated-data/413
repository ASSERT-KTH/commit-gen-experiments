BLEU SCORE: 0.016932492841722675

TEST MSG: LCS estimated compaction tasks does not take number of files into account
GENERATED MSG: add check for sstable overlap within a level on startup

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index f74914c . . 7797903 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 4 . 0 <nl> + * Take number of files in L0 in account when estimating remaining compaction tasks ( CASSANDRA - 13354 ) <nl> * Skip building views during base table streams on range movements ( CASSANDRA - 13065 ) <nl> * Improve error messages for + / - operations on maps and tuples ( CASSANDRA - 13197 ) <nl> * Remove deprecated repair JMX APIs ( CASSANDRA - 11530 ) <nl> diff - - git a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> index 0c53812 . . 9b735de 100644 <nl> - - - a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> + + + b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java <nl> @ @ - 793 , 6 + 793 , 13 @ @ public class LeveledManifest <nl> tasks + = estimated [ i ] ; <nl> } <nl> <nl> + if ( ! DatabaseDescriptor . getDisableSTCSInL0 ( ) & & getLevel ( 0 ) . size ( ) > MAX _ COMPACTING _ L0 ) <nl> + { <nl> + int l0compactions = getLevel ( 0 ) . size ( ) / MAX _ COMPACTING _ L0 ; <nl> + tasks + = l0compactions ; <nl> + estimated [ 0 ] + = l0compactions ; <nl> + } <nl> + <nl> logger . trace ( " Estimating { } compactions to do for { } . { } " , <nl> Arrays . toString ( estimated ) , cfs . keyspace . getName ( ) , cfs . name ) ; <nl> return Ints . checkedCast ( tasks ) ;
NEAREST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index ae43b77 . . b7da284 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 16 , 6 + 16 , 7 @ @ <nl> <nl> <nl> 1 . 2 . 3 <nl> + * add check for sstable overlap within a level on startup ( CASSANDRA - 5327 ) <nl> * replace ipv6 colons in jmx object names ( CASSANDRA - 5298 ) <nl> * Avoid allocating SSTableBoundedScanner during repair when the range does <nl> not intersect the sstable ( CASSANDRA - 5249 )

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index f74914c . . 7797903 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 4 . 0 
 + * Take number of files in L0 in account when estimating remaining compaction tasks ( CASSANDRA - 13354 ) 
 * Skip building views during base table streams on range movements ( CASSANDRA - 13065 ) 
 * Improve error messages for + / - operations on maps and tuples ( CASSANDRA - 13197 ) 
 * Remove deprecated repair JMX APIs ( CASSANDRA - 11530 ) 
 diff - - git a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 index 0c53812 . . 9b735de 100644 
 - - - a / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 + + + b / src / java / org / apache / cassandra / db / compaction / LeveledManifest . java 
 @ @ - 793 , 6 + 793 , 13 @ @ public class LeveledManifest 
 tasks + = estimated [ i ] ; 
 } 
 
 + if ( ! DatabaseDescriptor . getDisableSTCSInL0 ( ) & & getLevel ( 0 ) . size ( ) > MAX _ COMPACTING _ L0 ) 
 + { 
 + int l0compactions = getLevel ( 0 ) . size ( ) / MAX _ COMPACTING _ L0 ; 
 + tasks + = l0compactions ; 
 + estimated [ 0 ] + = l0compactions ; 
 + } 
 + 
 logger . trace ( " Estimating { } compactions to do for { } . { } " , 
 Arrays . toString ( estimated ) , cfs . keyspace . getName ( ) , cfs . name ) ; 
 return Ints . checkedCast ( tasks ) ;

NEAREST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index ae43b77 . . b7da284 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 16 , 6 + 16 , 7 @ @ 
 
 
 1 . 2 . 3 
 + * add check for sstable overlap within a level on startup ( CASSANDRA - 5327 ) 
 * replace ipv6 colons in jmx object names ( CASSANDRA - 5298 ) 
 * Avoid allocating SSTableBoundedScanner during repair when the range does 
 not intersect the sstable ( CASSANDRA - 5249 )
