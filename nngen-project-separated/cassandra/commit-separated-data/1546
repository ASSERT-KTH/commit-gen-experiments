BLEU SCORE: 0.13741272855400088

TEST MSG: NativeRingCache can be a static inner
GENERATED MSG: CompositeType . build is a static method

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java <nl> index 73a852f . . 6b4caa5 100644 <nl> - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java <nl> + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java <nl> @ @ - 467 , 7 + 467 , 7 @ @ class CqlRecordWriter extends RecordWriter < Map < String , ByteBuffer > , List < ByteBuf <nl> return " \ " " + identifier . replaceAll ( " \ " " , " \ " \ " " ) + " \ " " ; <nl> } <nl> <nl> - class NativeRingCache <nl> + static class NativeRingCache <nl> { <nl> private Map < TokenRange , Set < Host > > rangeMap ; <nl> private Metadata metadata ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> index 81afd23 . . f3b235d 100644 <nl> - - - a / src / java / org / apache / cassandra / config / CFMetaData . java <nl> + + + b / src / java / org / apache / cassandra / config / CFMetaData . java <nl> @ @ - 1292 , 7 + 1292 , 7 @ @ public final class CFMetaData <nl> public RowMutation dropFromSchema ( long timestamp ) <nl> { <nl> RowMutation rm = new RowMutation ( Table . SYSTEM _ KS , SystemTable . getSchemaKSKey ( ksName ) ) ; <nl> - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNFAMILIES _ CF ) ; <nl> + ColumnFamily cf = rm . addOrGet ( SchemaColumnFamiliesCf ) ; <nl> int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; <nl> <nl> cf . addColumn ( DeletedColumn . create ( ldt , timestamp , cfName , " " ) ) ; <nl> @ @ - 1338 , 7 + 1338 , 7 @ @ public final class CFMetaData <nl> { <nl> / / For property that can be null ( and can be changed ) , we insert tombstones , to make sure <nl> / / we don ' t keep a property the user has removed <nl> - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNFAMILIES _ CF ) ; <nl> + ColumnFamily cf = rm . addOrGet ( SchemaColumnFamiliesCf ) ; <nl> int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; <nl> <nl> Integer oldId = Schema . instance . convertNewCfId ( cfId ) ; <nl> diff - - git a / src / java / org / apache / cassandra / config / ColumnDefinition . java b / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> index 97f57e1 . . db5f7ed 100644 <nl> - - - a / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> + + + b / src / java / org / apache / cassandra / config / ColumnDefinition . java <nl> @ @ - 147 , 7 + 147 , 7 @ @ public class ColumnDefinition <nl> * / <nl> public void deleteFromSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) <nl> { <nl> - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNS _ CF ) ; <nl> + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; <nl> int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; <nl> <nl> cf . addColumn ( DeletedColumn . create ( ldt , timestamp , cfName , comparator . getString ( name ) , " " ) ) ; <nl> @ @ - 160 , 7 + 160 , 7 @ @ public class ColumnDefinition <nl> <nl> public void toSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) <nl> { <nl> - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNS _ CF ) ; <nl> + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; <nl> int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; <nl> <nl> cf . addColumn ( Column . create ( " " , timestamp , cfName , comparator . getString ( name ) , " " ) ) ; <nl> diff - - git a / src / java / org / apache / cassandra / config / KSMetaData . java b / src / java / org / apache / cassandra / config / KSMetaData . java <nl> index a5bc4a0 . . b92f9a5 100644 <nl> - - - a / src / java / org / apache / cassandra / config / KSMetaData . java <nl> + + + b / src / java / org / apache / cassandra / config / KSMetaData . java <nl> @ @ - 238 , 7 + 238 , 7 @ @ public final class KSMetaData <nl> public RowMutation toSchema ( long timestamp ) <nl> { <nl> RowMutation rm = new RowMutation ( Table . SYSTEM _ KS , SystemTable . getSchemaKSKey ( name ) ) ; <nl> - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ KEYSPACES _ CF ) ; <nl> + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaKeyspacesCf ) ; <nl> <nl> cf . addColumn ( Column . create ( durableWrites , timestamp , " durable _ writes " ) ) ; <nl> cf . addColumn ( Column . create ( strategyClass . getName ( ) , timestamp , " strategy _ class " ) ) ; <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java b / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java <nl> index eafe7c0 . . 68ae6b8 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java <nl> @ @ - 102 , 7 + 102 , 7 @ @ public class DeleteStatement extends ModificationStatement <nl> { <nl> QueryProcessor . validateKey ( key ) ; <nl> RowMutation rm = new RowMutation ( cfDef . cfm . ksName , key ) ; <nl> - ColumnFamily cf = rm . addOrGet ( columnFamily ( ) ) ; <nl> + ColumnFamily cf = rm . addOrGet ( cfDef . cfm ) ; <nl> <nl> if ( toRemove . isEmpty ( ) & & builder . componentCount ( ) = = 0 ) <nl> { <nl> diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> index 5f37e15 . . f31196a 100644 <nl> - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java <nl> @ @ - 213 , 7 + 213 , 7 @ @ public class UpdateStatement extends ModificationStatement <nl> <nl> QueryProcessor . validateKey ( key ) ; <nl> RowMutation rm = new RowMutation ( cfDef . cfm . ksName , key ) ; <nl> - ColumnFamily cf = rm . addOrGet ( cfDef . cfm . cfName ) ; <nl> + ColumnFamily cf = rm . addOrGet ( cfDef . cfm ) ; <nl> <nl> / / Inserting the CQL row marker ( see # 4361 ) <nl> / / We always need to insert a marker , because of the following situation : <nl> diff - - git a / src / java / org / apache / cassandra / db / RowMutation . java b / src / java / org / apache / cassandra / db / RowMutation . java <nl> index b85cfcd . . 69f4a5f 100644 <nl> - - - a / src / java / org / apache / cassandra / db / RowMutation . java <nl> + + + b / src / java / org / apache / cassandra / db / RowMutation . java <nl> @ @ - 149 , 7 + 149 , 11 @ @ public class RowMutation implements IMutation <nl> * / <nl> public ColumnFamily addOrGet ( String cfName ) <nl> { <nl> - CFMetaData cfm = Schema . instance . getCFMetaData ( table , cfName ) ; <nl> + return addOrGet ( Schema . instance . getCFMetaData ( table , cfName ) ) ; <nl> + } <nl> + <nl> + public ColumnFamily addOrGet ( CFMetaData cfm ) <nl> + { <nl> ColumnFamily cf = modifications . get ( cfm . cfId ) ; <nl> if ( cf = = null ) <nl> { <nl> @ @ - 266 , 7 + 270 , 8 @ @ public class RowMutation implements IMutation <nl> * / <nl> public void apply ( ) <nl> { <nl> - KSMetaData ksm = Schema . instance . getTableDefinition ( getTable ( ) ) ; <nl> + KSMetaData ksm = Schema . instance . getTableDefinition ( table ) ; <nl> + assert ksm ! = null : " Attempting to mutate non - existant keyspace " + table ; <nl> Table . open ( table ) . apply ( this , ksm . durableWrites ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java b / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java 
 index 73a852f . . 6b4caa5 100644 
 - - - a / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java 
 + + + b / src / java / org / apache / cassandra / hadoop / cql3 / CqlRecordWriter . java 
 @ @ - 467 , 7 + 467 , 7 @ @ class CqlRecordWriter extends RecordWriter < Map < String , ByteBuffer > , List < ByteBuf 
 return " \ " " + identifier . replaceAll ( " \ " " , " \ " \ " " ) + " \ " " ; 
 } 
 
 - class NativeRingCache 
 + static class NativeRingCache 
 { 
 private Map < TokenRange , Set < Host > > rangeMap ; 
 private Metadata metadata ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / config / CFMetaData . java b / src / java / org / apache / cassandra / config / CFMetaData . java 
 index 81afd23 . . f3b235d 100644 
 - - - a / src / java / org / apache / cassandra / config / CFMetaData . java 
 + + + b / src / java / org / apache / cassandra / config / CFMetaData . java 
 @ @ - 1292 , 7 + 1292 , 7 @ @ public final class CFMetaData 
 public RowMutation dropFromSchema ( long timestamp ) 
 { 
 RowMutation rm = new RowMutation ( Table . SYSTEM _ KS , SystemTable . getSchemaKSKey ( ksName ) ) ; 
 - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNFAMILIES _ CF ) ; 
 + ColumnFamily cf = rm . addOrGet ( SchemaColumnFamiliesCf ) ; 
 int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; 
 
 cf . addColumn ( DeletedColumn . create ( ldt , timestamp , cfName , " " ) ) ; 
 @ @ - 1338 , 7 + 1338 , 7 @ @ public final class CFMetaData 
 { 
 / / For property that can be null ( and can be changed ) , we insert tombstones , to make sure 
 / / we don ' t keep a property the user has removed 
 - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNFAMILIES _ CF ) ; 
 + ColumnFamily cf = rm . addOrGet ( SchemaColumnFamiliesCf ) ; 
 int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; 
 
 Integer oldId = Schema . instance . convertNewCfId ( cfId ) ; 
 diff - - git a / src / java / org / apache / cassandra / config / ColumnDefinition . java b / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 index 97f57e1 . . db5f7ed 100644 
 - - - a / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 + + + b / src / java / org / apache / cassandra / config / ColumnDefinition . java 
 @ @ - 147 , 7 + 147 , 7 @ @ public class ColumnDefinition 
 * / 
 public void deleteFromSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) 
 { 
 - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNS _ CF ) ; 
 + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; 
 int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; 
 
 cf . addColumn ( DeletedColumn . create ( ldt , timestamp , cfName , comparator . getString ( name ) , " " ) ) ; 
 @ @ - 160 , 7 + 160 , 7 @ @ public class ColumnDefinition 
 
 public void toSchema ( RowMutation rm , String cfName , AbstractType < ? > comparator , long timestamp ) 
 { 
 - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ COLUMNS _ CF ) ; 
 + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaColumnsCf ) ; 
 int ldt = ( int ) ( System . currentTimeMillis ( ) / 1000 ) ; 
 
 cf . addColumn ( Column . create ( " " , timestamp , cfName , comparator . getString ( name ) , " " ) ) ; 
 diff - - git a / src / java / org / apache / cassandra / config / KSMetaData . java b / src / java / org / apache / cassandra / config / KSMetaData . java 
 index a5bc4a0 . . b92f9a5 100644 
 - - - a / src / java / org / apache / cassandra / config / KSMetaData . java 
 + + + b / src / java / org / apache / cassandra / config / KSMetaData . java 
 @ @ - 238 , 7 + 238 , 7 @ @ public final class KSMetaData 
 public RowMutation toSchema ( long timestamp ) 
 { 
 RowMutation rm = new RowMutation ( Table . SYSTEM _ KS , SystemTable . getSchemaKSKey ( name ) ) ; 
 - ColumnFamily cf = rm . addOrGet ( SystemTable . SCHEMA _ KEYSPACES _ CF ) ; 
 + ColumnFamily cf = rm . addOrGet ( CFMetaData . SchemaKeyspacesCf ) ; 
 
 cf . addColumn ( Column . create ( durableWrites , timestamp , " durable _ writes " ) ) ; 
 cf . addColumn ( Column . create ( strategyClass . getName ( ) , timestamp , " strategy _ class " ) ) ; 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java b / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java 
 index eafe7c0 . . 68ae6b8 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / DeleteStatement . java 
 @ @ - 102 , 7 + 102 , 7 @ @ public class DeleteStatement extends ModificationStatement 
 { 
 QueryProcessor . validateKey ( key ) ; 
 RowMutation rm = new RowMutation ( cfDef . cfm . ksName , key ) ; 
 - ColumnFamily cf = rm . addOrGet ( columnFamily ( ) ) ; 
 + ColumnFamily cf = rm . addOrGet ( cfDef . cfm ) ; 
 
 if ( toRemove . isEmpty ( ) & & builder . componentCount ( ) = = 0 ) 
 { 
 diff - - git a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 index 5f37e15 . . f31196a 100644 
 - - - a / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 + + + b / src / java / org / apache / cassandra / cql3 / statements / UpdateStatement . java 
 @ @ - 213 , 7 + 213 , 7 @ @ public class UpdateStatement extends ModificationStatement 
 
 QueryProcessor . validateKey ( key ) ; 
 RowMutation rm = new RowMutation ( cfDef . cfm . ksName , key ) ; 
 - ColumnFamily cf = rm . addOrGet ( cfDef . cfm . cfName ) ; 
 + ColumnFamily cf = rm . addOrGet ( cfDef . cfm ) ; 
 
 / / Inserting the CQL row marker ( see # 4361 ) 
 / / We always need to insert a marker , because of the following situation : 
 diff - - git a / src / java / org / apache / cassandra / db / RowMutation . java b / src / java / org / apache / cassandra / db / RowMutation . java 
 index b85cfcd . . 69f4a5f 100644 
 - - - a / src / java / org / apache / cassandra / db / RowMutation . java 
 + + + b / src / java / org / apache / cassandra / db / RowMutation . java 
 @ @ - 149 , 7 + 149 , 11 @ @ public class RowMutation implements IMutation 
 * / 
 public ColumnFamily addOrGet ( String cfName ) 
 { 
 - CFMetaData cfm = Schema . instance . getCFMetaData ( table , cfName ) ; 
 + return addOrGet ( Schema . instance . getCFMetaData ( table , cfName ) ) ; 
 + } 
 + 
 + public ColumnFamily addOrGet ( CFMetaData cfm ) 
 + { 
 ColumnFamily cf = modifications . get ( cfm . cfId ) ; 
 if ( cf = = null ) 
 { 
 @ @ - 266 , 7 + 270 , 8 @ @ public class RowMutation implements IMutation 
 * / 
 public void apply ( ) 
 { 
 - KSMetaData ksm = Schema . instance . getTableDefinition ( getTable ( ) ) ; 
 + KSMetaData ksm = Schema . instance . getTableDefinition ( table ) ; 
 + assert ksm ! = null : " Attempting to mutate non - existant keyspace " + table ; 
 Table . open ( table ) . apply ( this , ksm . durableWrites ) ; 
 } 

