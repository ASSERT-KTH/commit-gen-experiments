BLEU SCORE: 2.801398218768634E-9

TEST MSG: add asserts
GENERATED MSG: avoid creating empty sstables on recovery flush . ( a ) empty sstables are still work for the compactor later , and ( b ) sstable . close errors out when it ' s empty . patch by jbellis .

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / DataTracker . java b / src / java / org / apache / cassandra / db / DataTracker . java <nl> index c1ae00f . . a1de8e5 100644 <nl> - - - a / src / java / org / apache / cassandra / db / DataTracker . java <nl> + + + b / src / java / org / apache / cassandra / db / DataTracker . java <nl> @ @ - 515 , 6 + 515 , 12 @ @ public class DataTracker <nl> <nl> View ( Memtable memtable , Set < Memtable > pendingFlush , Set < SSTableReader > sstables , Set < SSTableReader > compacting , SSTableIntervalTree intervalTree ) <nl> { <nl> + assert memtable ! = null ; <nl> + assert pendingFlush ! = null ; <nl> + assert sstables ! = null ; <nl> + assert compacting ! = null ; <nl> + assert intervalTree ! = null ; <nl> + <nl> this . memtable = memtable ; <nl> this . memtablesPendingFlush = pendingFlush ; <nl> this . sstables = sstables ;
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / Memtable . java b / src / java / org / apache / cassandra / db / Memtable . java <nl> index 6481cc0 . . f66e812 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Memtable . java <nl> + + + b / src / java / org / apache / cassandra / db / Memtable . java <nl> @ @ - 226 , 7 + 226 , 8 @ @ public class Memtable implements Comparable < Memtable > <nl> } <nl> <nl> void flushOnRecovery ( ) throws IOException { <nl> - flush ( CommitLog . CommitLogContext . NULL ) ; <nl> + if ( ! isClean ( ) ) <nl> + flush ( CommitLog . CommitLogContext . NULL ) ; <nl> } <nl> <nl> private void resolve ( String key , ColumnFamily columnFamily )

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / DataTracker . java b / src / java / org / apache / cassandra / db / DataTracker . java 
 index c1ae00f . . a1de8e5 100644 
 - - - a / src / java / org / apache / cassandra / db / DataTracker . java 
 + + + b / src / java / org / apache / cassandra / db / DataTracker . java 
 @ @ - 515 , 6 + 515 , 12 @ @ public class DataTracker 
 
 View ( Memtable memtable , Set < Memtable > pendingFlush , Set < SSTableReader > sstables , Set < SSTableReader > compacting , SSTableIntervalTree intervalTree ) 
 { 
 + assert memtable ! = null ; 
 + assert pendingFlush ! = null ; 
 + assert sstables ! = null ; 
 + assert compacting ! = null ; 
 + assert intervalTree ! = null ; 
 + 
 this . memtable = memtable ; 
 this . memtablesPendingFlush = pendingFlush ; 
 this . sstables = sstables ;

NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / Memtable . java b / src / java / org / apache / cassandra / db / Memtable . java 
 index 6481cc0 . . f66e812 100644 
 - - - a / src / java / org / apache / cassandra / db / Memtable . java 
 + + + b / src / java / org / apache / cassandra / db / Memtable . java 
 @ @ - 226 , 7 + 226 , 8 @ @ public class Memtable implements Comparable < Memtable > 
 } 
 
 void flushOnRecovery ( ) throws IOException { 
 - flush ( CommitLog . CommitLogContext . NULL ) ; 
 + if ( ! isClean ( ) ) 
 + flush ( CommitLog . CommitLogContext . NULL ) ; 
 } 
 
 private void resolve ( String key , ColumnFamily columnFamily )
