BLEU SCORE: 0.04372912656590315

TEST MSG: merge from 2 . 0
GENERATED MSG: Fix leaking validator FH in StreamWriter

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index eb82a1c . . 6a44d80 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 17 , 6 + 17 , 7 @ @ <nl> * Change caching option syntax ( CASSANDRA - 6745 ) <nl> * Fix stress to do proper counter reads ( CASSANDRA - 6835 ) <nl> Merged from 2 . 0 : <nl> + * Fix leaking validator FH in StreamWriter ( CASSANDRA - 6832 ) <nl> * fix nodetool getsstables for blob PK ( CASSANDRA - 6803 ) <nl> * Fix saving triggers to schema ( CASSANDRA - 6789 ) <nl> * Fix trigger mutations when base mutation list is immutable ( CASSANDRA - 6790 ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamWriter . java b / src / java / org / apache / cassandra / streaming / StreamWriter . java <nl> index a84d2f4 . . cb69d0b 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamWriter . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamWriter . java <nl> @ @ - 72 , 10 + 72 , 9 @ @ public class StreamWriter <nl> { <nl> long totalSize = totalSize ( ) ; <nl> RandomAccessReader file = sstable . openDataReader ( ) ; <nl> - ChecksumValidator validator = null ; <nl> - if ( new File ( sstable . descriptor . filenameFor ( Component . CRC ) ) . exists ( ) ) <nl> - validator = DataIntegrityMetadata . checksumValidator ( sstable . descriptor ) ; <nl> - <nl> + ChecksumValidator validator = new File ( sstable . descriptor . filenameFor ( Component . CRC ) ) . exists ( ) <nl> + ? DataIntegrityMetadata . checksumValidator ( sstable . descriptor ) <nl> + : null ; <nl> transferBuffer = validator = = null ? new byte [ DEFAULT _ CHUNK _ SIZE ] : new byte [ validator . chunkSize ] ; <nl> <nl> / / setting up data compression stream <nl> @ @ - 115 , 6 + 114 , 7 @ @ public class StreamWriter <nl> { <nl> / / no matter what happens close file <nl> FileUtils . closeQuietly ( file ) ; <nl> + FileUtils . closeQuietly ( validator ) ; <nl> } <nl> <nl> / / release reference only when completed successfully
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index eb82a1c . . 6a44d80 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 17 , 6 + 17 , 7 @ @ 
 * Change caching option syntax ( CASSANDRA - 6745 ) 
 * Fix stress to do proper counter reads ( CASSANDRA - 6835 ) 
 Merged from 2 . 0 : 
 + * Fix leaking validator FH in StreamWriter ( CASSANDRA - 6832 ) 
 * fix nodetool getsstables for blob PK ( CASSANDRA - 6803 ) 
 * Fix saving triggers to schema ( CASSANDRA - 6789 ) 
 * Fix trigger mutations when base mutation list is immutable ( CASSANDRA - 6790 ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamWriter . java b / src / java / org / apache / cassandra / streaming / StreamWriter . java 
 index a84d2f4 . . cb69d0b 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamWriter . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamWriter . java 
 @ @ - 72 , 10 + 72 , 9 @ @ public class StreamWriter 
 { 
 long totalSize = totalSize ( ) ; 
 RandomAccessReader file = sstable . openDataReader ( ) ; 
 - ChecksumValidator validator = null ; 
 - if ( new File ( sstable . descriptor . filenameFor ( Component . CRC ) ) . exists ( ) ) 
 - validator = DataIntegrityMetadata . checksumValidator ( sstable . descriptor ) ; 
 - 
 + ChecksumValidator validator = new File ( sstable . descriptor . filenameFor ( Component . CRC ) ) . exists ( ) 
 + ? DataIntegrityMetadata . checksumValidator ( sstable . descriptor ) 
 + : null ; 
 transferBuffer = validator = = null ? new byte [ DEFAULT _ CHUNK _ SIZE ] : new byte [ validator . chunkSize ] ; 
 
 / / setting up data compression stream 
 @ @ - 115 , 6 + 114 , 7 @ @ public class StreamWriter 
 { 
 / / no matter what happens close file 
 FileUtils . closeQuietly ( file ) ; 
 + FileUtils . closeQuietly ( validator ) ; 
 } 
 
 / / release reference only when completed successfully

NEAREST DIFF:
ELIMINATEDSENTENCE
