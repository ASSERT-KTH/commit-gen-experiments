BLEU SCORE: 0.01025270094846709

TEST MSG: Avoid NPE when doing CFS . scrubDataDirectories
GENERATED MSG: r / m unnecessary isDropped check from maybeSwitchMemtable ( the one in Memtable . writeSortedContents it the important one )

TEST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> index 36bc470 . . bfd3b08 100644 <nl> - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java <nl> @ @ - 434 , 7 + 434 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean <nl> for ( File dir : directories . getCFDirectories ( ) ) <nl> { <nl> File [ ] lockfiles = dir . listFiles ( filter ) ; <nl> - if ( lockfiles . length = = 0 ) <nl> + / / lock files can be null if I / O error happens <nl> + if ( lockfiles = = null | | lockfiles . length = = 0 ) <nl> continue ; <nl> logger . info ( " Removing SSTables from failed streaming session . Found { } files to cleanup . " , lockfiles . length ) ; <nl>
NEAREST DIFF (one line): diff - - git a / src / java / org / apache / cassandra / db / Memtable . java b / src / java / org / apache / cassandra / db / Memtable . java <nl> index 1c78efd . . 9dc2d7b 100644 <nl> - - - a / src / java / org / apache / cassandra / db / Memtable . java <nl> + + + b / src / java / org / apache / cassandra / db / Memtable . java <nl> @ @ - 180 , 10 + 180 , 13 @ @ public class Memtable implements Comparable < Memtable > , IFlushable <nl> { <nl> waitForWriters ( ) ; <nl> cfs . flushLock . lock ( ) ; <nl> - SSTableReader sstable = writeSortedContents ( ) ; <nl> try <nl> { <nl> - cfs . replaceFlushed ( Memtable . this , sstable ) ; <nl> + if ( ! cfs . isDropped ( ) ) <nl> + { <nl> + SSTableReader sstable = writeSortedContents ( ) ; <nl> + cfs . replaceFlushed ( Memtable . this , sstable ) ; <nl> + } <nl> } <nl> finally <nl> {

TEST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 index 36bc470 . . bfd3b08 100644 
 - - - a / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 + + + b / src / java / org / apache / cassandra / db / ColumnFamilyStore . java 
 @ @ - 434 , 7 + 434 , 8 @ @ public class ColumnFamilyStore implements ColumnFamilyStoreMBean 
 for ( File dir : directories . getCFDirectories ( ) ) 
 { 
 File [ ] lockfiles = dir . listFiles ( filter ) ; 
 - if ( lockfiles . length = = 0 ) 
 + / / lock files can be null if I / O error happens 
 + if ( lockfiles = = null | | lockfiles . length = = 0 ) 
 continue ; 
 logger . info ( " Removing SSTables from failed streaming session . Found { } files to cleanup . " , lockfiles . length ) ; 


NEAREST DIFF:
diff - - git a / src / java / org / apache / cassandra / db / Memtable . java b / src / java / org / apache / cassandra / db / Memtable . java 
 index 1c78efd . . 9dc2d7b 100644 
 - - - a / src / java / org / apache / cassandra / db / Memtable . java 
 + + + b / src / java / org / apache / cassandra / db / Memtable . java 
 @ @ - 180 , 10 + 180 , 13 @ @ public class Memtable implements Comparable < Memtable > , IFlushable 
 { 
 waitForWriters ( ) ; 
 cfs . flushLock . lock ( ) ; 
 - SSTableReader sstable = writeSortedContents ( ) ; 
 try 
 { 
 - cfs . replaceFlushed ( Memtable . this , sstable ) ; 
 + if ( ! cfs . isDropped ( ) ) 
 + { 
 + SSTableReader sstable = writeSortedContents ( ) ; 
 + cfs . replaceFlushed ( Memtable . this , sstable ) ; 
 + } 
 } 
 finally 
 {
