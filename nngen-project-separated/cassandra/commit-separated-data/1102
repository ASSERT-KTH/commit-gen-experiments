BLEU SCORE: 0.034353182138500235

TEST MSG: Correctly count received sstables during streaming
GENERATED MSG: Make StreamReceiveTask thread safe and gc friendly

TEST DIFF (one line): diff - - git a / CHANGES . txt b / CHANGES . txt <nl> index 837a592 . . dd517f5 100644 <nl> - - - a / CHANGES . txt <nl> + + + b / CHANGES . txt <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> 3 . 0 . 3 <nl> + * Fix counting of received sstables in streaming ( CASSANDRA - 10949 ) <nl> * Implement hints compression ( CASSANDRA - 9428 ) <nl> * Fix potential assertion error when reading static columns ( CASSANDRA - 10903 ) <nl> * Avoid NoSuchElementException when executing empty batch ( CASSANDRA - 10711 ) <nl> diff - - git a / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java b / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java <nl> index 92a14d1 . . 6280f3a 100644 <nl> - - - a / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java <nl> + + + b / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java <nl> @ @ - 74 , 6 + 74 , 8 @ @ public class StreamReceiveTask extends StreamTask <nl> / / holds references to SSTables received <nl> protected Collection < SSTableReader > sstables ; <nl> <nl> + private int remoteSSTablesReceived = 0 ; <nl> + <nl> public StreamReceiveTask ( StreamSession session , UUID cfId , int totalFiles , long totalSize ) <nl> { <nl> super ( session , cfId ) ; <nl> @ @ - 94 , 14 + 96 , 14 @ @ public class StreamReceiveTask extends StreamTask <nl> { <nl> if ( done ) <nl> return ; <nl> - <nl> + remoteSSTablesReceived + + ; <nl> assert cfId . equals ( sstable . getCfId ( ) ) ; <nl> <nl> Collection < SSTableReader > finished = sstable . finish ( true ) ; <nl> txn . update ( finished , false ) ; <nl> sstables . addAll ( finished ) ; <nl> <nl> - if ( sstables . size ( ) = = totalFiles ) <nl> + if ( remoteSSTablesReceived = = totalFiles ) <nl> { <nl> done = true ; <nl> executor . submit ( new OnCompletionRunnable ( this ) ) ;
NEAREST DIFF (one line): ELIMINATEDSENTENCE

TEST DIFF:
diff - - git a / CHANGES . txt b / CHANGES . txt 
 index 837a592 . . dd517f5 100644 
 - - - a / CHANGES . txt 
 + + + b / CHANGES . txt 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 3 . 0 . 3 
 + * Fix counting of received sstables in streaming ( CASSANDRA - 10949 ) 
 * Implement hints compression ( CASSANDRA - 9428 ) 
 * Fix potential assertion error when reading static columns ( CASSANDRA - 10903 ) 
 * Avoid NoSuchElementException when executing empty batch ( CASSANDRA - 10711 ) 
 diff - - git a / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java b / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java 
 index 92a14d1 . . 6280f3a 100644 
 - - - a / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java 
 + + + b / src / java / org / apache / cassandra / streaming / StreamReceiveTask . java 
 @ @ - 74 , 6 + 74 , 8 @ @ public class StreamReceiveTask extends StreamTask 
 / / holds references to SSTables received 
 protected Collection < SSTableReader > sstables ; 
 
 + private int remoteSSTablesReceived = 0 ; 
 + 
 public StreamReceiveTask ( StreamSession session , UUID cfId , int totalFiles , long totalSize ) 
 { 
 super ( session , cfId ) ; 
 @ @ - 94 , 14 + 96 , 14 @ @ public class StreamReceiveTask extends StreamTask 
 { 
 if ( done ) 
 return ; 
 - 
 + remoteSSTablesReceived + + ; 
 assert cfId . equals ( sstable . getCfId ( ) ) ; 
 
 Collection < SSTableReader > finished = sstable . finish ( true ) ; 
 txn . update ( finished , false ) ; 
 sstables . addAll ( finished ) ; 
 
 - if ( sstables . size ( ) = = totalFiles ) 
 + if ( remoteSSTablesReceived = = totalFiles ) 
 { 
 done = true ; 
 executor . submit ( new OnCompletionRunnable ( this ) ) ;

NEAREST DIFF:
ELIMINATEDSENTENCE
