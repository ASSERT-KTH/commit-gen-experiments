BLEU SCORE: 0.040583489434387374

TEST MSG: initialData must only be triggered once
GENERATED MSG: Fixed Realm cache not working .

TEST DIFF (one line): diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java <nl> index 8d8200b . . 77dd7ab 100644 <nl> - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java <nl> + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java <nl> @ @ - 368 , 10 + 368 , 16 @ @ public class SyncConfigurationTests { <nl> <nl> assertNotNull ( config . getInitialDataTransaction ( ) ) ; <nl> <nl> - Realm realm = Realm . getInstance ( config ) ; <nl> - RealmResults < StringOnly > results = realm . where ( StringOnly . class ) . findAll ( ) ; <nl> + / / open the first time - initialData must be triggered <nl> + Realm realm1 = Realm . getInstance ( config ) ; <nl> + RealmResults < StringOnly > results = realm1 . where ( StringOnly . class ) . findAll ( ) ; <nl> assertEquals ( 1 , results . size ( ) ) ; <nl> assertEquals ( " TEST 42 " , results . first ( ) . getChars ( ) ) ; <nl> - realm . close ( ) ; <nl> + realm1 . close ( ) ; <nl> + <nl> + / / open the second time - initialData must not be triggered <nl> + Realm realm2 = Realm . getInstance ( config ) ; <nl> + assertEquals ( 1 , realm2 . where ( StringOnly . class ) . count ( ) ) ; <nl> + realm2 . close ( ) ; <nl> } <nl> } <nl> diff - - git a / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp b / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp <nl> index 39b3eef . . 9c00c09 100644 <nl> - - - a / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp <nl> + + + b / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp <nl> @ @ - 157 , 8 + 157 , 6 @ @ Java _ io _ realm _ internal _ SharedRealm _ nativeGetVersion ( JNIEnv * env , jclass , jlong s <nl> try { <nl> return static _ cast < jlong > ( ObjectStore : : get _ schema _ version ( shared _ realm - > read _ group ( ) ) ) ; <nl> } CATCH _ STD ( ) <nl> - <nl> - return static _ cast < jlong > ( ObjectStore : : NotVersioned ) ; <nl> } <nl> <nl> JNIEXPORT void JNICALL <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> index 1830681 . . 3c92dc8 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / Realm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> @ @ - 360 , 6 + 360 , 12 @ @ public final class Realm extends BaseRealm { <nl> if ( transaction ! = null ) { <nl> if ( syncAvailable ) { <nl> realm . executeTransaction ( transaction ) ; <nl> + realm . executeTransaction ( new Transaction ( ) { <nl> + @ Override <nl> + public void execute ( Realm realm ) { <nl> + realm . setVersion ( realm . configuration . getSchemaVersion ( ) ) ; <nl> + } <nl> + } ) ; <nl> } else { <nl> transaction . execute ( realm ) ; <nl> } <nl> diff - - git a / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java b / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java <nl> index 765cfae . . e548ecd 100644 <nl> - - - a / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java <nl> + + + b / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java <nl> @ @ - 619 , 7 + 619 , 7 @ @ public final class SyncConfiguration extends RealmConfiguration { <nl> getCanonicalPath ( new File ( realmFileDirectory , realmFileName ) ) , <nl> null , / / assetFile not supported by Sync . See https : / / github . com / realm / realm - sync / issues / 241 <nl> key , <nl> - - 1 , / / Schema version not supported <nl> + 0 , <nl> null , / / Custom migrations not supported <nl> false , / / MigrationNeededException is never thrown <nl> durability ,
NEAREST DIFF (one line): diff - - git a / realm / src / androidTest / java / io / realm / RealmTest . java b / realm / src / androidTest / java / io / realm / RealmTest . java <nl> index 4de768e . . efdcf8f 100644 <nl> - - - a / realm / src / androidTest / java / io / realm / RealmTest . java <nl> + + + b / realm / src / androidTest / java / io / realm / RealmTest . java <nl> @ @ - 74 , 9 + 74 , 10 @ @ public class RealmTest extends AndroidTestCase { <nl> private final static int BACKGROUND _ COMMIT _ TEST _ DATA _ SET _ SIZE = 5 ; <nl> <nl> <nl> - / / Test io . realm . Realm API <nl> + public void testRealmCache ( ) { <nl> + assertEquals ( testRealm , Realm . getInstance ( getContext ( ) ) ) ; <nl> + } <nl> <nl> - / / Realm Constructors <nl> public void testShouldCreateRealm ( ) { <nl> Realm realm = Realm . getInstance ( getContext ( ) ) ; <nl> assertNotNull ( " Realm . getInstance unexpectedly returns null " , realm ) ; <nl> diff - - git a / realm / src / main / java / io / realm / Realm . java b / realm / src / main / java / io / realm / Realm . java <nl> index e2e4d8d . . c9817ae 100644 <nl> - - - a / realm / src / main / java / io / realm / Realm . java <nl> + + + b / realm / src / main / java / io / realm / Realm . java <nl> @ @ - 365 , 7 + 365 , 7 @ @ public class Realm { <nl> <nl> private static Realm createAndValidate ( String absolutePath , byte [ ] key , boolean validateSchema , boolean autoRefresh ) { <nl> Map < Integer , Realm > realms = realmsCache . get ( ) ; <nl> - Realm realm = realms . get ( absolutePath ) ; <nl> + Realm realm = realms . get ( absolutePath . hashCode ( ) ) ; <nl> <nl> if ( realm ! = null ) { <nl> return realm ;

TEST DIFF:
diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java 
 index 8d8200b . . 77dd7ab 100644 
 - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java 
 + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / SyncConfigurationTests . java 
 @ @ - 368 , 10 + 368 , 16 @ @ public class SyncConfigurationTests { 
 
 assertNotNull ( config . getInitialDataTransaction ( ) ) ; 
 
 - Realm realm = Realm . getInstance ( config ) ; 
 - RealmResults < StringOnly > results = realm . where ( StringOnly . class ) . findAll ( ) ; 
 + / / open the first time - initialData must be triggered 
 + Realm realm1 = Realm . getInstance ( config ) ; 
 + RealmResults < StringOnly > results = realm1 . where ( StringOnly . class ) . findAll ( ) ; 
 assertEquals ( 1 , results . size ( ) ) ; 
 assertEquals ( " TEST 42 " , results . first ( ) . getChars ( ) ) ; 
 - realm . close ( ) ; 
 + realm1 . close ( ) ; 
 + 
 + / / open the second time - initialData must not be triggered 
 + Realm realm2 = Realm . getInstance ( config ) ; 
 + assertEquals ( 1 , realm2 . where ( StringOnly . class ) . count ( ) ) ; 
 + realm2 . close ( ) ; 
 } 
 } 
 diff - - git a / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp b / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp 
 index 39b3eef . . 9c00c09 100644 
 - - - a / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp 
 + + + b / realm / realm - library / src / main / cpp / io _ realm _ internal _ SharedRealm . cpp 
 @ @ - 157 , 8 + 157 , 6 @ @ Java _ io _ realm _ internal _ SharedRealm _ nativeGetVersion ( JNIEnv * env , jclass , jlong s 
 try { 
 return static _ cast < jlong > ( ObjectStore : : get _ schema _ version ( shared _ realm - > read _ group ( ) ) ) ; 
 } CATCH _ STD ( ) 
 - 
 - return static _ cast < jlong > ( ObjectStore : : NotVersioned ) ; 
 } 
 
 JNIEXPORT void JNICALL 
 diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java 
 index 1830681 . . 3c92dc8 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / Realm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / Realm . java 
 @ @ - 360 , 6 + 360 , 12 @ @ public final class Realm extends BaseRealm { 
 if ( transaction ! = null ) { 
 if ( syncAvailable ) { 
 realm . executeTransaction ( transaction ) ; 
 + realm . executeTransaction ( new Transaction ( ) { 
 + @ Override 
 + public void execute ( Realm realm ) { 
 + realm . setVersion ( realm . configuration . getSchemaVersion ( ) ) ; 
 + } 
 + } ) ; 
 } else { 
 transaction . execute ( realm ) ; 
 } 
 diff - - git a / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java b / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java 
 index 765cfae . . e548ecd 100644 
 - - - a / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java 
 + + + b / realm / realm - library / src / objectServer / java / io / realm / SyncConfiguration . java 
 @ @ - 619 , 7 + 619 , 7 @ @ public final class SyncConfiguration extends RealmConfiguration { 
 getCanonicalPath ( new File ( realmFileDirectory , realmFileName ) ) , 
 null , / / assetFile not supported by Sync . See https : / / github . com / realm / realm - sync / issues / 241 
 key , 
 - - 1 , / / Schema version not supported 
 + 0 , 
 null , / / Custom migrations not supported 
 false , / / MigrationNeededException is never thrown 
 durability ,

NEAREST DIFF:
diff - - git a / realm / src / androidTest / java / io / realm / RealmTest . java b / realm / src / androidTest / java / io / realm / RealmTest . java 
 index 4de768e . . efdcf8f 100644 
 - - - a / realm / src / androidTest / java / io / realm / RealmTest . java 
 + + + b / realm / src / androidTest / java / io / realm / RealmTest . java 
 @ @ - 74 , 9 + 74 , 10 @ @ public class RealmTest extends AndroidTestCase { 
 private final static int BACKGROUND _ COMMIT _ TEST _ DATA _ SET _ SIZE = 5 ; 
 
 
 - / / Test io . realm . Realm API 
 + public void testRealmCache ( ) { 
 + assertEquals ( testRealm , Realm . getInstance ( getContext ( ) ) ) ; 
 + } 
 
 - / / Realm Constructors 
 public void testShouldCreateRealm ( ) { 
 Realm realm = Realm . getInstance ( getContext ( ) ) ; 
 assertNotNull ( " Realm . getInstance unexpectedly returns null " , realm ) ; 
 diff - - git a / realm / src / main / java / io / realm / Realm . java b / realm / src / main / java / io / realm / Realm . java 
 index e2e4d8d . . c9817ae 100644 
 - - - a / realm / src / main / java / io / realm / Realm . java 
 + + + b / realm / src / main / java / io / realm / Realm . java 
 @ @ - 365 , 7 + 365 , 7 @ @ public class Realm { 
 
 private static Realm createAndValidate ( String absolutePath , byte [ ] key , boolean validateSchema , boolean autoRefresh ) { 
 Map < Integer , Realm > realms = realmsCache . get ( ) ; 
 - Realm realm = realms . get ( absolutePath ) ; 
 + Realm realm = realms . get ( absolutePath . hashCode ( ) ) ; 
 
 if ( realm ! = null ) { 
 return realm ;
