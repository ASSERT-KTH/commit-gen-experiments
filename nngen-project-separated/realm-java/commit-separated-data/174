BLEU SCORE: 0.013878957858167952

TEST MSG: IncompatibleSyncedFileException only for sync
GENERATED MSG: Fix errors from login being wrapped in an UNKNOWN code .

TEST DIFF (one line): diff - - git a / realm / realm - library / src / main / cpp / util . cpp b / realm / realm - library / src / main / cpp / util . cpp <nl> index 357ef84 . . 72fd8b3 100644 <nl> - - - a / realm / realm - library / src / main / cpp / util . cpp <nl> + + + b / realm / realm - library / src / main / cpp / util . cpp <nl> @ @ - 199 , 8 + 199 , 6 @ @ void ThrowException ( JNIEnv * env , ExceptionKind exception , const std : : string & cla <nl> void ThrowRealmFileException ( JNIEnv * env , const std : : string & message , realm : : RealmFileException : : Kind kind , const std : : string & path ) <nl> { <nl> static JavaClass jrealm _ file _ exception _ cls ( env , " io / realm / exceptions / RealmFileException " ) ; <nl> - static JavaClass jincompatible _ synced _ file _ cls ( env , " io / realm / exceptions / IncompatibleSyncedFileException " ) ; <nl> - static JavaMethod jicompatible _ synced _ ctor ( env , jincompatible _ synced _ file _ cls , " < init > " , " ( Ljava / lang / String ; Ljava / lang / String ; ) V " ) ; <nl> static JavaMethod constructor ( env , jrealm _ file _ exception _ cls , " < init > " , " ( BLjava / lang / String ; ) V " ) ; <nl> <nl> / / Initial value to suppress gcc warning . <nl> @ @ - 228 , 11 + 226 , 19 @ @ void ThrowRealmFileException ( JNIEnv * env , const std : : string & message , realm : : Rea <nl> kind _ code = io _ realm _ internal _ SharedRealm _ FILE _ EXCEPTION _ KIND _ FORMAT _ UPGRADE _ REQUIRED ; <nl> break ; <nl> case realm : : RealmFileException : : Kind : : IncompatibleSyncedRealm : <nl> + # if REALM _ ENABLE _ SYNC <nl> + static JavaClass jincompatible _ synced _ file _ cls ( env , <nl> + " io / realm / exceptions / IncompatibleSyncedFileException " ) ; <nl> + static JavaMethod jicompatible _ synced _ ctor ( env , jincompatible _ synced _ file _ cls , " < init > " , <nl> + " ( Ljava / lang / String ; Ljava / lang / String ; ) V " ) ; <nl> jobject jexception = env - > NewObject ( jincompatible _ synced _ file _ cls , jicompatible _ synced _ ctor , <nl> to _ jstring ( env , message ) , to _ jstring ( env , path ) ) ; <nl> env - > Throw ( reinterpret _ cast < jthrowable > ( jexception ) ) ; <nl> env - > DeleteLocalRef ( jexception ) ; <nl> return ; <nl> + # else <nl> + REALM _ ASSERT _ RELEASE _ EX ( false , " ' IncompatibleSyncedRealm ' should not be thrown for non - sync realm . " ) ; <nl> + # endif <nl> } <nl> jstring jmessage = to _ jstring ( env , message ) ; <nl> jstring jpath = to _ jstring ( env , path ) ; <nl> diff - - git a / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java b / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java <nl> index 71ce342 . . b260e71 100644 <nl> - - - a / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java <nl> + + + b / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java <nl> @ @ - 14 , 6 + 14 , 7 @ @ import org . junit . runner . RunWith ; <nl> <nl> import java . util . Arrays ; <nl> import java . util . UUID ; <nl> + import java . util . concurrent . CountDownLatch ; <nl> <nl> import io . realm . Realm ; <nl> import io . realm . RealmChangeListener ; <nl> @ @ - 36 , 6 + 37 , 7 @ @ import io . realm . util . SyncTestUtils ; <nl> import static org . junit . Assert . assertEquals ; <nl> import static org . junit . Assert . assertFalse ; <nl> import static org . junit . Assert . assertNotEquals ; <nl> + import static org . junit . Assert . assertTrue ; <nl> import static org . junit . Assert . fail ; <nl> <nl> @ RunWith ( AndroidJUnit4 . class )
NEAREST DIFF (one line): diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java <nl> index bc274b8 . . 458bb29 100644 <nl> - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java <nl> + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java <nl> @ @ - 7 , 16 + 7 , 22 @ @ import org . json . JSONException ; <nl> import org . json . JSONObject ; <nl> import org . junit . Test ; <nl> import org . junit . runner . RunWith ; <nl> + import org . mockito . Mockito ; <nl> <nl> import java . net . URI ; <nl> import java . net . URISyntaxException ; <nl> + import java . net . URL ; <nl> <nl> import io . realm . internal . network . AuthenticateRequest ; <nl> + import io . realm . internal . network . AuthenticationServer ; <nl> import io . realm . internal . objectserver . Token ; <nl> import io . realm . util . SyncTestUtils ; <nl> <nl> import static org . junit . Assert . assertEquals ; <nl> import static org . junit . Assert . assertFalse ; <nl> + import static org . junit . Assert . fail ; <nl> + import static org . mockito . Matchers . any ; <nl> + import static org . mockito . Mockito . when ; <nl> <nl> @ RunWith ( AndroidJUnit4 . class ) <nl> public class AuthenticateRequestTests { <nl> @ @ - 54 , 4 + 60 , 19 @ @ public class AuthenticateRequestTests { <nl> assertEquals ( t . value ( ) , obj . get ( " data " ) ) ; <nl> assertEquals ( " realm " , obj . get ( " provider " ) ) ; <nl> } <nl> + <nl> + <nl> + @ Test <nl> + public void errorsNotWrapped ( ) { <nl> + AuthenticationServer authServer = Mockito . mock ( AuthenticationServer . class ) ; <nl> + when ( authServer . loginUser ( any ( Credentials . class ) , any ( URL . class ) ) ) . thenReturn ( SyncTestUtils . createErrorResponse ( ErrorCode . ACCESS _ DENIED ) ) ; <nl> + SyncManager . setAuthServerImpl ( authServer ) ; <nl> + <nl> + try { <nl> + User . login ( Credentials . facebook ( " foo " ) , " http : / / foo . bar / auth " ) ; <nl> + fail ( ) ; <nl> + } catch ( ObjectServerError e ) { <nl> + assertEquals ( ErrorCode . ACCESS _ DENIED , e . getErrorCode ( ) ) ; <nl> + } <nl> + } <nl> } <nl> diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java <nl> index 2fdd291 . . dda3944 100644 <nl> - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java <nl> + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java <nl> @ @ - 22 , 6 + 22 , 8 @ @ import org . json . JSONObject ; <nl> <nl> import java . util . UUID ; <nl> <nl> + import io . realm . ErrorCode ; <nl> + import io . realm . ObjectServerError ; <nl> import io . realm . User ; <nl> import io . realm . internal . network . AuthenticateResponse ; <nl> import io . realm . internal . objectserver . SyncUser ; <nl> @ @ - 79 , 4 + 81 , 8 @ @ public class SyncTestUtils { <nl> throw new RuntimeException ( e ) ; <nl> } <nl> } <nl> + <nl> + public static AuthenticateResponse createErrorResponse ( ErrorCode code ) { <nl> + return AuthenticateResponse . from ( new ObjectServerError ( code , " dummy " ) ) ; <nl> + } <nl> } <nl> diff - - git a / realm / realm - library / src / objectServer / java / io / realm / User . java b / realm / realm - library / src / objectServer / java / io / realm / User . java <nl> index 439ea59 . . 2f84203 100644 <nl> - - - a / realm / realm - library / src / objectServer / java / io / realm / User . java <nl> + + + b / realm / realm - library / src / objectServer / java / io / realm / User . java <nl> @ @ - 126 , 6 + 126 , 7 @ @ public class User { <nl> } <nl> <nl> final AuthenticationServer server = SyncManager . getAuthServer ( ) ; <nl> + ObjectServerError error ; <nl> try { <nl> AuthenticateResponse result = server . loginUser ( credentials , authUrl ) ; <nl> if ( result . isValid ( ) ) { <nl> @ @ - 137 , 13 + 138 , 12 @ @ public class User { <nl> return user ; <nl> } else { <nl> RealmLog . info ( " Failed authenticating user . \ n % s " , result . getError ( ) ) ; <nl> - throw result . getError ( ) ; <nl> + error = result . getError ( ) ; <nl> } <nl> - } catch ( IOException e ) { <nl> - throw new ObjectServerError ( ErrorCode . IO _ EXCEPTION , e ) ; <nl> } catch ( Throwable e ) { <nl> throw new ObjectServerError ( ErrorCode . UNKNOWN , e ) ; <nl> } <nl> + throw error ; <nl> } <nl> <nl> / * * <nl> diff - - git a / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java b / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java <nl> index 919c1ed . . 2b5ae1e 100644 <nl> - - - a / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java <nl> + + + b / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java <nl> @ @ - 52 , 7 + 52 , 7 @ @ public class OkHttpAuthenticationServer implements AuthenticationServer { <nl> String requestBody = AuthenticateRequest . userLogin ( credentials ) . toJson ( ) ; <nl> return authenticate ( authenticationUrl , requestBody ) ; <nl> } catch ( Exception e ) { <nl> - return AuthenticateResponse . from ( new ObjectServerError ( ErrorCode . OTHER _ ERROR , Util . getStackTrace ( e ) ) ) ; <nl> + return AuthenticateResponse . from ( new ObjectServerError ( ErrorCode . UNKNOWN , e ) ) ; <nl> } <nl> } <nl>

TEST DIFF:
diff - - git a / realm / realm - library / src / main / cpp / util . cpp b / realm / realm - library / src / main / cpp / util . cpp 
 index 357ef84 . . 72fd8b3 100644 
 - - - a / realm / realm - library / src / main / cpp / util . cpp 
 + + + b / realm / realm - library / src / main / cpp / util . cpp 
 @ @ - 199 , 8 + 199 , 6 @ @ void ThrowException ( JNIEnv * env , ExceptionKind exception , const std : : string & cla 
 void ThrowRealmFileException ( JNIEnv * env , const std : : string & message , realm : : RealmFileException : : Kind kind , const std : : string & path ) 
 { 
 static JavaClass jrealm _ file _ exception _ cls ( env , " io / realm / exceptions / RealmFileException " ) ; 
 - static JavaClass jincompatible _ synced _ file _ cls ( env , " io / realm / exceptions / IncompatibleSyncedFileException " ) ; 
 - static JavaMethod jicompatible _ synced _ ctor ( env , jincompatible _ synced _ file _ cls , " < init > " , " ( Ljava / lang / String ; Ljava / lang / String ; ) V " ) ; 
 static JavaMethod constructor ( env , jrealm _ file _ exception _ cls , " < init > " , " ( BLjava / lang / String ; ) V " ) ; 
 
 / / Initial value to suppress gcc warning . 
 @ @ - 228 , 11 + 226 , 19 @ @ void ThrowRealmFileException ( JNIEnv * env , const std : : string & message , realm : : Rea 
 kind _ code = io _ realm _ internal _ SharedRealm _ FILE _ EXCEPTION _ KIND _ FORMAT _ UPGRADE _ REQUIRED ; 
 break ; 
 case realm : : RealmFileException : : Kind : : IncompatibleSyncedRealm : 
 + # if REALM _ ENABLE _ SYNC 
 + static JavaClass jincompatible _ synced _ file _ cls ( env , 
 + " io / realm / exceptions / IncompatibleSyncedFileException " ) ; 
 + static JavaMethod jicompatible _ synced _ ctor ( env , jincompatible _ synced _ file _ cls , " < init > " , 
 + " ( Ljava / lang / String ; Ljava / lang / String ; ) V " ) ; 
 jobject jexception = env - > NewObject ( jincompatible _ synced _ file _ cls , jicompatible _ synced _ ctor , 
 to _ jstring ( env , message ) , to _ jstring ( env , path ) ) ; 
 env - > Throw ( reinterpret _ cast < jthrowable > ( jexception ) ) ; 
 env - > DeleteLocalRef ( jexception ) ; 
 return ; 
 + # else 
 + REALM _ ASSERT _ RELEASE _ EX ( false , " ' IncompatibleSyncedRealm ' should not be thrown for non - sync realm . " ) ; 
 + # endif 
 } 
 jstring jmessage = to _ jstring ( env , message ) ; 
 jstring jpath = to _ jstring ( env , path ) ; 
 diff - - git a / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java b / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java 
 index 71ce342 . . b260e71 100644 
 - - - a / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java 
 + + + b / realm / realm - library / src / syncIntegrationTest / java / io / realm / objectserver / SyncSessionTests . java 
 @ @ - 14 , 6 + 14 , 7 @ @ import org . junit . runner . RunWith ; 
 
 import java . util . Arrays ; 
 import java . util . UUID ; 
 + import java . util . concurrent . CountDownLatch ; 
 
 import io . realm . Realm ; 
 import io . realm . RealmChangeListener ; 
 @ @ - 36 , 6 + 37 , 7 @ @ import io . realm . util . SyncTestUtils ; 
 import static org . junit . Assert . assertEquals ; 
 import static org . junit . Assert . assertFalse ; 
 import static org . junit . Assert . assertNotEquals ; 
 + import static org . junit . Assert . assertTrue ; 
 import static org . junit . Assert . fail ; 
 
 @ RunWith ( AndroidJUnit4 . class )

NEAREST DIFF:
diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java 
 index bc274b8 . . 458bb29 100644 
 - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java 
 + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / AuthenticateRequestTests . java 
 @ @ - 7 , 16 + 7 , 22 @ @ import org . json . JSONException ; 
 import org . json . JSONObject ; 
 import org . junit . Test ; 
 import org . junit . runner . RunWith ; 
 + import org . mockito . Mockito ; 
 
 import java . net . URI ; 
 import java . net . URISyntaxException ; 
 + import java . net . URL ; 
 
 import io . realm . internal . network . AuthenticateRequest ; 
 + import io . realm . internal . network . AuthenticationServer ; 
 import io . realm . internal . objectserver . Token ; 
 import io . realm . util . SyncTestUtils ; 
 
 import static org . junit . Assert . assertEquals ; 
 import static org . junit . Assert . assertFalse ; 
 + import static org . junit . Assert . fail ; 
 + import static org . mockito . Matchers . any ; 
 + import static org . mockito . Mockito . when ; 
 
 @ RunWith ( AndroidJUnit4 . class ) 
 public class AuthenticateRequestTests { 
 @ @ - 54 , 4 + 60 , 19 @ @ public class AuthenticateRequestTests { 
 assertEquals ( t . value ( ) , obj . get ( " data " ) ) ; 
 assertEquals ( " realm " , obj . get ( " provider " ) ) ; 
 } 
 + 
 + 
 + @ Test 
 + public void errorsNotWrapped ( ) { 
 + AuthenticationServer authServer = Mockito . mock ( AuthenticationServer . class ) ; 
 + when ( authServer . loginUser ( any ( Credentials . class ) , any ( URL . class ) ) ) . thenReturn ( SyncTestUtils . createErrorResponse ( ErrorCode . ACCESS _ DENIED ) ) ; 
 + SyncManager . setAuthServerImpl ( authServer ) ; 
 + 
 + try { 
 + User . login ( Credentials . facebook ( " foo " ) , " http : / / foo . bar / auth " ) ; 
 + fail ( ) ; 
 + } catch ( ObjectServerError e ) { 
 + assertEquals ( ErrorCode . ACCESS _ DENIED , e . getErrorCode ( ) ) ; 
 + } 
 + } 
 } 
 diff - - git a / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java b / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java 
 index 2fdd291 . . dda3944 100644 
 - - - a / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java 
 + + + b / realm / realm - library / src / androidTestobjectServer / java / io / realm / util / SyncTestUtils . java 
 @ @ - 22 , 6 + 22 , 8 @ @ import org . json . JSONObject ; 
 
 import java . util . UUID ; 
 
 + import io . realm . ErrorCode ; 
 + import io . realm . ObjectServerError ; 
 import io . realm . User ; 
 import io . realm . internal . network . AuthenticateResponse ; 
 import io . realm . internal . objectserver . SyncUser ; 
 @ @ - 79 , 4 + 81 , 8 @ @ public class SyncTestUtils { 
 throw new RuntimeException ( e ) ; 
 } 
 } 
 + 
 + public static AuthenticateResponse createErrorResponse ( ErrorCode code ) { 
 + return AuthenticateResponse . from ( new ObjectServerError ( code , " dummy " ) ) ; 
 + } 
 } 
 diff - - git a / realm / realm - library / src / objectServer / java / io / realm / User . java b / realm / realm - library / src / objectServer / java / io / realm / User . java 
 index 439ea59 . . 2f84203 100644 
 - - - a / realm / realm - library / src / objectServer / java / io / realm / User . java 
 + + + b / realm / realm - library / src / objectServer / java / io / realm / User . java 
 @ @ - 126 , 6 + 126 , 7 @ @ public class User { 
 } 
 
 final AuthenticationServer server = SyncManager . getAuthServer ( ) ; 
 + ObjectServerError error ; 
 try { 
 AuthenticateResponse result = server . loginUser ( credentials , authUrl ) ; 
 if ( result . isValid ( ) ) { 
 @ @ - 137 , 13 + 138 , 12 @ @ public class User { 
 return user ; 
 } else { 
 RealmLog . info ( " Failed authenticating user . \ n % s " , result . getError ( ) ) ; 
 - throw result . getError ( ) ; 
 + error = result . getError ( ) ; 
 } 
 - } catch ( IOException e ) { 
 - throw new ObjectServerError ( ErrorCode . IO _ EXCEPTION , e ) ; 
 } catch ( Throwable e ) { 
 throw new ObjectServerError ( ErrorCode . UNKNOWN , e ) ; 
 } 
 + throw error ; 
 } 
 
 / * * 
 diff - - git a / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java b / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java 
 index 919c1ed . . 2b5ae1e 100644 
 - - - a / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java 
 + + + b / realm / realm - library / src / objectServer / java / io / realm / internal / network / OkHttpAuthenticationServer . java 
 @ @ - 52 , 7 + 52 , 7 @ @ public class OkHttpAuthenticationServer implements AuthenticationServer { 
 String requestBody = AuthenticateRequest . userLogin ( credentials ) . toJson ( ) ; 
 return authenticate ( authenticationUrl , requestBody ) ; 
 } catch ( Exception e ) { 
 - return AuthenticateResponse . from ( new ObjectServerError ( ErrorCode . OTHER _ ERROR , Util . getStackTrace ( e ) ) ) ; 
 + return AuthenticateResponse . from ( new ObjectServerError ( ErrorCode . UNKNOWN , e ) ) ; 
 } 
 } 

