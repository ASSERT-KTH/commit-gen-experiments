BLEU SCORE: 0.09535414040914189

TEST MSG: fix compilation error in model classes in unit test
GENERATED MSG: Add a unit test for reference counting

TEST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java b / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java <nl> index f389d9a . . 4dc8b74 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java <nl> @ @ - 281 , 9 + 281 , 18 @ @ public class AnnotationIndexTypes extends RealmObject { <nl> this . notIndexDate = notIndexDate ; <nl> } <nl> <nl> - public void setFieldObject ( AnnotationIndexTypes object ) { <nl> - this . fieldObject = object ; <nl> + public void setFieldObject ( AnnotationIndexTypes fieldObject ) { <nl> + realmSetter $ fieldObject ( fieldObject ) ; <nl> } <nl> <nl> - public AnnotationIndexTypes getFieldObject ( ) { return this . fieldObject ; } <nl> + public AnnotationIndexTypes getFieldObject ( ) { <nl> + return realmGetter $ fieldObject ( ) ; <nl> + } <nl> + <nl> + public void realmSetter $ fieldObject ( AnnotationIndexTypes fieldObject ) { <nl> + this . fieldObject = fieldObject ; <nl> + } <nl> + <nl> + public AnnotationIndexTypes realmGetter $ fieldObject ( ) { return this . fieldObject ; } <nl> + <nl> }
NEAREST DIFF (one line): diff - - git a / realm / src / androidTest / java / io / realm / RealmTest . java b / realm / src / androidTest / java / io / realm / RealmTest . java <nl> index d971dde . . 8f07bbb 100644 <nl> - - - a / realm / src / androidTest / java / io / realm / RealmTest . java <nl> + + + b / realm / src / androidTest / java / io / realm / RealmTest . java <nl> @ @ - 646 , 4 + 646 , 30 @ @ public class RealmTest extends AndroidTestCase { <nl> createAndTestFilename ( " India " , " न ई द ि ल ् ल ी " ) ; <nl> createAndTestFilename ( " Japanese " , " 東 京 都 " ) ; <nl> } <nl> + <nl> + public void testReferenceCounting ( ) { <nl> + / / At this point reference count should be one because of the setUp method <nl> + try { <nl> + testRealm . where ( AllTypes . class ) . count ( ) ; <nl> + } catch ( IllegalStateException e ) { <nl> + fail ( ) ; <nl> + } <nl> + <nl> + / / Raise the reference <nl> + Realm realm = Realm . getInstance ( getContext ( ) ) ; <nl> + realm . close ( ) ; <nl> + try { <nl> + / / This should not fail because the reference is now 2 <nl> + realm . where ( AllTypes . class ) . count ( ) ; <nl> + } catch ( IllegalStateException e ) { <nl> + fail ( ) ; <nl> + } <nl> + <nl> + testRealm . close ( ) ; <nl> + try { <nl> + testRealm . where ( AllTypes . class ) . count ( ) ; <nl> + fail ( ) ; <nl> + } catch ( IllegalStateException ignored ) { } <nl> + <nl> + } <nl> } <nl> diff - - git a / realm / src / main / java / io / realm / Realm . java b / realm / src / main / java / io / realm / Realm . java <nl> index 79a1aae . . 8caa230 100644 <nl> - - - a / realm / src / main / java / io / realm / Realm . java <nl> + + + b / realm / src / main / java / io / realm / Realm . java <nl> @ @ - 87 , 7 + 87 , 7 @ @ public class Realm implements Closeable { <nl> private static final ThreadLocal < Integer > referenceCount = new ThreadLocal < Integer > ( ) { <nl> @ Override <nl> protected Integer initialValue ( ) { <nl> - return 1 ; <nl> + return 0 ; <nl> } <nl> } ; <nl> private static final int REALM _ CHANGED = 14930352 ; / / Just a nice big Fibonacci number . For no reason : ) <nl> @ @ - 673 , 6 + 673 , 7 @ @ public class Realm implements Closeable { <nl> * @ see io . realm . RealmQuery <nl> * / <nl> public < E extends RealmObject > RealmQuery < E > where ( Class < E > clazz ) { <nl> + checkIfValid ( ) ; <nl> return new RealmQuery < E > ( this , clazz ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java b / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java 
 index f389d9a . . 4dc8b74 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / entities / AnnotationIndexTypes . java 
 @ @ - 281 , 9 + 281 , 18 @ @ public class AnnotationIndexTypes extends RealmObject { 
 this . notIndexDate = notIndexDate ; 
 } 
 
 - public void setFieldObject ( AnnotationIndexTypes object ) { 
 - this . fieldObject = object ; 
 + public void setFieldObject ( AnnotationIndexTypes fieldObject ) { 
 + realmSetter $ fieldObject ( fieldObject ) ; 
 } 
 
 - public AnnotationIndexTypes getFieldObject ( ) { return this . fieldObject ; } 
 + public AnnotationIndexTypes getFieldObject ( ) { 
 + return realmGetter $ fieldObject ( ) ; 
 + } 
 + 
 + public void realmSetter $ fieldObject ( AnnotationIndexTypes fieldObject ) { 
 + this . fieldObject = fieldObject ; 
 + } 
 + 
 + public AnnotationIndexTypes realmGetter $ fieldObject ( ) { return this . fieldObject ; } 
 + 
 }

NEAREST DIFF:
diff - - git a / realm / src / androidTest / java / io / realm / RealmTest . java b / realm / src / androidTest / java / io / realm / RealmTest . java 
 index d971dde . . 8f07bbb 100644 
 - - - a / realm / src / androidTest / java / io / realm / RealmTest . java 
 + + + b / realm / src / androidTest / java / io / realm / RealmTest . java 
 @ @ - 646 , 4 + 646 , 30 @ @ public class RealmTest extends AndroidTestCase { 
 createAndTestFilename ( " India " , " न ई द ि ल ् ल ी " ) ; 
 createAndTestFilename ( " Japanese " , " 東 京 都 " ) ; 
 } 
 + 
 + public void testReferenceCounting ( ) { 
 + / / At this point reference count should be one because of the setUp method 
 + try { 
 + testRealm . where ( AllTypes . class ) . count ( ) ; 
 + } catch ( IllegalStateException e ) { 
 + fail ( ) ; 
 + } 
 + 
 + / / Raise the reference 
 + Realm realm = Realm . getInstance ( getContext ( ) ) ; 
 + realm . close ( ) ; 
 + try { 
 + / / This should not fail because the reference is now 2 
 + realm . where ( AllTypes . class ) . count ( ) ; 
 + } catch ( IllegalStateException e ) { 
 + fail ( ) ; 
 + } 
 + 
 + testRealm . close ( ) ; 
 + try { 
 + testRealm . where ( AllTypes . class ) . count ( ) ; 
 + fail ( ) ; 
 + } catch ( IllegalStateException ignored ) { } 
 + 
 + } 
 } 
 diff - - git a / realm / src / main / java / io / realm / Realm . java b / realm / src / main / java / io / realm / Realm . java 
 index 79a1aae . . 8caa230 100644 
 - - - a / realm / src / main / java / io / realm / Realm . java 
 + + + b / realm / src / main / java / io / realm / Realm . java 
 @ @ - 87 , 7 + 87 , 7 @ @ public class Realm implements Closeable { 
 private static final ThreadLocal < Integer > referenceCount = new ThreadLocal < Integer > ( ) { 
 @ Override 
 protected Integer initialValue ( ) { 
 - return 1 ; 
 + return 0 ; 
 } 
 } ; 
 private static final int REALM _ CHANGED = 14930352 ; / / Just a nice big Fibonacci number . For no reason : ) 
 @ @ - 673 , 6 + 673 , 7 @ @ public class Realm implements Closeable { 
 * @ see io . realm . RealmQuery 
 * / 
 public < E extends RealmObject > RealmQuery < E > where ( Class < E > clazz ) { 
 + checkIfValid ( ) ; 
 return new RealmQuery < E > ( this , clazz ) ; 
 } 

