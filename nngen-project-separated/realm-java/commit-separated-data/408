BLEU SCORE: 0.03416211359799979

TEST MSG: Fix tests and remove unnecessary imports and fields .
GENERATED MSG: Revert " Removing the restriction of compacting encrypted Realm files . "

TEST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java <nl> index fd1af8a . . 8e7e01d 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java <nl> @ @ - 296 , 7 + 296 , 7 @ @ public class RealmLinkTests { <nl> assertEquals ( 0 , none1 . size ( ) ) ; <nl> <nl> RealmResults < Owner > owners2 = testRealm . where ( Owner . class ) . notEqualTo ( " cat . name " , " Max " ) . findAll ( ) ; <nl> - assertEquals ( 1 , owners1 . size ( ) ) ; <nl> + assertEquals ( 1 , owners2 . size ( ) ) ; <nl> <nl> RealmResults < Owner > none2 = testRealm . where ( Owner . class ) . notEqualTo ( " cat . name " , " Blackie " ) . findAll ( ) ; <nl> assertEquals ( 0 , none2 . size ( ) ) ; <nl> @ @ - 465 , 7 + 465 , 7 @ @ public class RealmLinkTests { <nl> assertEquals ( 0 , none1 . size ( ) ) ; <nl> <nl> RealmResults < Owner > owners2 = testRealm . where ( Owner . class ) . notEqualTo ( " dogs . name " , " King " ) . findAll ( ) ; <nl> - assertEquals ( 1 , owners1 . size ( ) ) ; <nl> + assertEquals ( 1 , owners2 . size ( ) ) ; <nl> <nl> RealmResults < Owner > none2 = testRealm . where ( Owner . class ) . notEqualTo ( " dogs . name " , " Pluto " ) . findAll ( ) ; <nl> assertEquals ( 0 , none1 . size ( ) ) ; <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java <nl> index 5c8491f . . d449711 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java <nl> @ @ - 833 , 7 + 833 , 6 @ @ public class RealmTests { <nl> <nl> String test _ char = " " ; <nl> String test _ char _ old = " " ; <nl> - String get _ data = " " ; <nl> <nl> for ( int i = 0 ; i < 1000 ; i + + ) { <nl> random _ value = random . nextInt ( 25 ) ; <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> index 5ce7dd5 . . 59d59b1 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> @ @ - 35 , 7 + 35 , 6 @ @ import java . io . InputStream ; <nl> import java . lang . ref . WeakReference ; <nl> import java . util . Date ; <nl> import java . util . concurrent . CountDownLatch ; <nl> - import java . util . concurrent . TimeUnit ; <nl> import java . util . concurrent . atomic . AtomicInteger ; <nl> <nl> import io . realm . entities . AllTypes ; <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java b / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java <nl> index ea51528 . . 97f3326 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java <nl> @ @ - 29 , 7 + 29 , 6 @ @ import java . util . List ; <nl> import io . realm . entities . AllJavaTypes ; <nl> import io . realm . rule . TestRealmConfigurationFactory ; <nl> <nl> - import static org . junit . Assert . assertFalse ; <nl> import static org . junit . Assert . assertTrue ; <nl> import static org . junit . Assert . fail ; <nl> <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java b / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java <nl> index 861d3e6 . . 8245069 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java <nl> @ @ - 23 , 7 + 23 , 6 @ @ import java . util . concurrent . TimeUnit ; <nl> <nl> import io . realm . Case ; <nl> import io . realm . RealmFieldType ; <nl> - import io . realm . Sort ; <nl> import io . realm . TestHelper ; <nl> <nl> public class JNIQueryTest extends TestCase { <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java b / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java <nl> index 36507e6 . . a7c5702 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java <nl> @ @ - 16 , 8 + 16 , 6 @ @ <nl> <nl> package io . realm . internal ; <nl> <nl> - import android . test . MoreAsserts ; <nl> - <nl> import org . junit . Test ; <nl> import org . junit . runner . RunWith ; <nl> import org . junit . runners . Parameterized ; <nl> @ @ - 31 , 7 + 29 , 6 @ @ import java . util . List ; <nl> import io . realm . RealmFieldType ; <nl> import io . realm . TestHelper ; <nl> <nl> - import static org . junit . Assert . assertEquals ; <nl> import static org . junit . Assert . assertTrue ; <nl> import static org . junit . Assert . fail ; <nl> <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java b / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java <nl> index 8bec3bf . . d02a0ea 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java <nl> @ @ - 17 , 7 + 17 , 6 @ @ <nl> package io . realm . rule ; <nl> <nl> import android . content . Context ; <nl> - import android . content . res . AssetManager ; <nl> import android . support . test . InstrumentationRegistry ; <nl> <nl> import org . junit . rules . TemporaryFolder ; <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java b / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java <nl> index 7a84181 . . 54c724a 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java <nl> @ @ - 24 , 7 + 24 , 6 @ @ import android . os . IBinder ; <nl> import android . os . Message ; <nl> import android . os . Messenger ; <nl> import android . os . RemoteException ; <nl> - import android . util . Log ; <nl> <nl> import java . util . HashMap ; <nl> import java . util . Map ; <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java b / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java <nl> index 496aa18 . . f658b12 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java <nl> @ @ - 21 , 9 + 21 , 7 @ @ import android . content . Context ; <nl> import com . getkeepsafe . relinker . ReLinker ; <nl> <nl> import java . io . File ; <nl> - import java . lang . reflect . Constructor ; <nl> import java . lang . reflect . Field ; <nl> - import java . lang . reflect . InvocationTargetException ; <nl> import java . util . Locale ; <nl> <nl> import io . realm . BuildConfig ;
NEAREST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java b / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java <nl> index 010492d . . 89ed7fd 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java <nl> @ @ - 42 , 6 + 42 , 7 @ @ import java . util . concurrent . ExecutorService ; <nl> import java . util . concurrent . Executors ; <nl> import java . util . concurrent . Future ; <nl> import java . util . concurrent . TimeUnit ; <nl> + import java . util . concurrent . TimeoutException ; <nl> import java . util . concurrent . atomic . AtomicBoolean ; <nl> <nl> import io . realm . entities . AllTypes ; <nl> @ @ - 1070 , 10 + 1071 , 12 @ @ public class RealmTest extends AndroidTestCase { <nl> Realm . deleteRealm ( realmConfig ) ; <nl> Realm realm = Realm . getInstance ( realmConfig ) ; <nl> realm . close ( ) ; <nl> - assertTrue ( Realm . compactRealm ( realmConfig ) ) ; <nl> - realm = Realm . getInstance ( realmConfig ) ; <nl> - assertFalse ( realm . isClosed ( ) ) ; <nl> - realm . close ( ) ; <nl> + / / TODO : remove try / catch block when compacting encrypted Realms is supported <nl> + try { <nl> + assertTrue ( Realm . compactRealm ( realmConfig ) ) ; <nl> + fail ( ) ; <nl> + } catch ( IllegalArgumentException expected ) { <nl> + } <nl> } <nl> <nl> public void testCompactEncryptedPopulatedRealmFile ( ) { <nl> @ @ - 1086 , 13 + 1089 , 12 @ @ public class RealmTest extends AndroidTestCase { <nl> <nl> populateTestRealm ( realm , 100 ) ; <nl> realm . close ( ) ; <nl> - <nl> - assertTrue ( Realm . compactRealm ( realmConfig ) ) ; <nl> - <nl> - realm = Realm . getInstance ( realmConfig ) ; <nl> - assertFalse ( realm . isClosed ( ) ) ; <nl> - assertEquals ( 100 , realm . allObjects ( AllTypes . class ) . size ( ) ) ; <nl> - realm . close ( ) ; <nl> + / / TODO : remove try / catch block when compacting encrypted Realms is supported <nl> + try { <nl> + assertTrue ( Realm . compactRealm ( realmConfig ) ) ; <nl> + fail ( ) ; <nl> + } catch ( IllegalArgumentException expected ) { <nl> + } <nl> } <nl> <nl> public void testCompactEmptyRealmFile ( ) throws IOException { <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / BaseRealm . java b / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> index 6931f4e . . 42b7397 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> @ @ - 29 , 9 + 29 , 11 @ @ import java . util . HashMap ; <nl> import java . util . Iterator ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> + import java . util . Set ; <nl> import java . util . concurrent . ConcurrentHashMap ; <nl> import java . util . concurrent . CopyOnWriteArrayList ; <nl> import java . util . concurrent . atomic . AtomicBoolean ; <nl> + import java . util . concurrent . CopyOnWriteArraySet ; <nl> <nl> import io . realm . exceptions . RealmMigrationNeededException ; <nl> import io . realm . internal . SharedGroupManager ; <nl> @ @ - 591 , 6 + 593 , 10 @ @ abstract class BaseRealm implements Closeable { <nl> * Compacts the Realm file defined by the given configuration . <nl> * / <nl> public static boolean compactRealm ( final RealmConfiguration configuration ) { <nl> + if ( configuration . getEncryptionKey ( ) ! = null ) { <nl> + throw new IllegalArgumentException ( " Cannot currently compact an encrypted Realm . " ) ; <nl> + } <nl> + <nl> final AtomicBoolean result = new AtomicBoolean ( false ) ; <nl> <nl> RealmCache . invokeWithGlobalRefCount ( configuration , new RealmCache . Callback ( ) {

TEST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java 
 index fd1af8a . . 8e7e01d 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmLinkTests . java 
 @ @ - 296 , 7 + 296 , 7 @ @ public class RealmLinkTests { 
 assertEquals ( 0 , none1 . size ( ) ) ; 
 
 RealmResults < Owner > owners2 = testRealm . where ( Owner . class ) . notEqualTo ( " cat . name " , " Max " ) . findAll ( ) ; 
 - assertEquals ( 1 , owners1 . size ( ) ) ; 
 + assertEquals ( 1 , owners2 . size ( ) ) ; 
 
 RealmResults < Owner > none2 = testRealm . where ( Owner . class ) . notEqualTo ( " cat . name " , " Blackie " ) . findAll ( ) ; 
 assertEquals ( 0 , none2 . size ( ) ) ; 
 @ @ - 465 , 7 + 465 , 7 @ @ public class RealmLinkTests { 
 assertEquals ( 0 , none1 . size ( ) ) ; 
 
 RealmResults < Owner > owners2 = testRealm . where ( Owner . class ) . notEqualTo ( " dogs . name " , " King " ) . findAll ( ) ; 
 - assertEquals ( 1 , owners1 . size ( ) ) ; 
 + assertEquals ( 1 , owners2 . size ( ) ) ; 
 
 RealmResults < Owner > none2 = testRealm . where ( Owner . class ) . notEqualTo ( " dogs . name " , " Pluto " ) . findAll ( ) ; 
 assertEquals ( 0 , none1 . size ( ) ) ; 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java 
 index 5c8491f . . d449711 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmTests . java 
 @ @ - 833 , 7 + 833 , 6 @ @ public class RealmTests { 
 
 String test _ char = " " ; 
 String test _ char _ old = " " ; 
 - String get _ data = " " ; 
 
 for ( int i = 0 ; i < 1000 ; i + + ) { 
 random _ value = random . nextInt ( 25 ) ; 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 index 5ce7dd5 . . 59d59b1 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 @ @ - 35 , 7 + 35 , 6 @ @ import java . io . InputStream ; 
 import java . lang . ref . WeakReference ; 
 import java . util . Date ; 
 import java . util . concurrent . CountDownLatch ; 
 - import java . util . concurrent . TimeUnit ; 
 import java . util . concurrent . atomic . AtomicInteger ; 
 
 import io . realm . entities . AllTypes ; 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java b / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java 
 index ea51528 . . 97f3326 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / UnManagedOrderedRealmCollectionTests . java 
 @ @ - 29 , 7 + 29 , 6 @ @ import java . util . List ; 
 import io . realm . entities . AllJavaTypes ; 
 import io . realm . rule . TestRealmConfigurationFactory ; 
 
 - import static org . junit . Assert . assertFalse ; 
 import static org . junit . Assert . assertTrue ; 
 import static org . junit . Assert . fail ; 
 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java b / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java 
 index 861d3e6 . . 8245069 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / JNIQueryTest . java 
 @ @ - 23 , 7 + 23 , 6 @ @ import java . util . concurrent . TimeUnit ; 
 
 import io . realm . Case ; 
 import io . realm . RealmFieldType ; 
 - import io . realm . Sort ; 
 import io . realm . TestHelper ; 
 
 public class JNIQueryTest extends TestCase { 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java b / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java 
 index 36507e6 . . a7c5702 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / JNITableInsertTest . java 
 @ @ - 16 , 8 + 16 , 6 @ @ 
 
 package io . realm . internal ; 
 
 - import android . test . MoreAsserts ; 
 - 
 import org . junit . Test ; 
 import org . junit . runner . RunWith ; 
 import org . junit . runners . Parameterized ; 
 @ @ - 31 , 7 + 29 , 6 @ @ import java . util . List ; 
 import io . realm . RealmFieldType ; 
 import io . realm . TestHelper ; 
 
 - import static org . junit . Assert . assertEquals ; 
 import static org . junit . Assert . assertTrue ; 
 import static org . junit . Assert . fail ; 
 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java b / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java 
 index 8bec3bf . . d02a0ea 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / rule / TestRealmConfigurationFactory . java 
 @ @ - 17 , 7 + 17 , 6 @ @ 
 package io . realm . rule ; 
 
 import android . content . Context ; 
 - import android . content . res . AssetManager ; 
 import android . support . test . InstrumentationRegistry ; 
 
 import org . junit . rules . TemporaryFolder ; 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java b / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java 
 index 7a84181 . . 54c724a 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / services / RemoteProcessService . java 
 @ @ - 24 , 7 + 24 , 6 @ @ import android . os . IBinder ; 
 import android . os . Message ; 
 import android . os . Messenger ; 
 import android . os . RemoteException ; 
 - import android . util . Log ; 
 
 import java . util . HashMap ; 
 import java . util . Map ; 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java b / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java 
 index 496aa18 . . f658b12 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmCore . java 
 @ @ - 21 , 9 + 21 , 7 @ @ import android . content . Context ; 
 import com . getkeepsafe . relinker . ReLinker ; 
 
 import java . io . File ; 
 - import java . lang . reflect . Constructor ; 
 import java . lang . reflect . Field ; 
 - import java . lang . reflect . InvocationTargetException ; 
 import java . util . Locale ; 
 
 import io . realm . BuildConfig ;

NEAREST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java b / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java 
 index 010492d . . 89ed7fd 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmTest . java 
 @ @ - 42 , 6 + 42 , 7 @ @ import java . util . concurrent . ExecutorService ; 
 import java . util . concurrent . Executors ; 
 import java . util . concurrent . Future ; 
 import java . util . concurrent . TimeUnit ; 
 + import java . util . concurrent . TimeoutException ; 
 import java . util . concurrent . atomic . AtomicBoolean ; 
 
 import io . realm . entities . AllTypes ; 
 @ @ - 1070 , 10 + 1071 , 12 @ @ public class RealmTest extends AndroidTestCase { 
 Realm . deleteRealm ( realmConfig ) ; 
 Realm realm = Realm . getInstance ( realmConfig ) ; 
 realm . close ( ) ; 
 - assertTrue ( Realm . compactRealm ( realmConfig ) ) ; 
 - realm = Realm . getInstance ( realmConfig ) ; 
 - assertFalse ( realm . isClosed ( ) ) ; 
 - realm . close ( ) ; 
 + / / TODO : remove try / catch block when compacting encrypted Realms is supported 
 + try { 
 + assertTrue ( Realm . compactRealm ( realmConfig ) ) ; 
 + fail ( ) ; 
 + } catch ( IllegalArgumentException expected ) { 
 + } 
 } 
 
 public void testCompactEncryptedPopulatedRealmFile ( ) { 
 @ @ - 1086 , 13 + 1089 , 12 @ @ public class RealmTest extends AndroidTestCase { 
 
 populateTestRealm ( realm , 100 ) ; 
 realm . close ( ) ; 
 - 
 - assertTrue ( Realm . compactRealm ( realmConfig ) ) ; 
 - 
 - realm = Realm . getInstance ( realmConfig ) ; 
 - assertFalse ( realm . isClosed ( ) ) ; 
 - assertEquals ( 100 , realm . allObjects ( AllTypes . class ) . size ( ) ) ; 
 - realm . close ( ) ; 
 + / / TODO : remove try / catch block when compacting encrypted Realms is supported 
 + try { 
 + assertTrue ( Realm . compactRealm ( realmConfig ) ) ; 
 + fail ( ) ; 
 + } catch ( IllegalArgumentException expected ) { 
 + } 
 } 
 
 public void testCompactEmptyRealmFile ( ) throws IOException { 
 diff - - git a / realm / realm - library / src / main / java / io / realm / BaseRealm . java b / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 index 6931f4e . . 42b7397 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 @ @ - 29 , 9 + 29 , 11 @ @ import java . util . HashMap ; 
 import java . util . Iterator ; 
 import java . util . List ; 
 import java . util . Map ; 
 + import java . util . Set ; 
 import java . util . concurrent . ConcurrentHashMap ; 
 import java . util . concurrent . CopyOnWriteArrayList ; 
 import java . util . concurrent . atomic . AtomicBoolean ; 
 + import java . util . concurrent . CopyOnWriteArraySet ; 
 
 import io . realm . exceptions . RealmMigrationNeededException ; 
 import io . realm . internal . SharedGroupManager ; 
 @ @ - 591 , 6 + 593 , 10 @ @ abstract class BaseRealm implements Closeable { 
 * Compacts the Realm file defined by the given configuration . 
 * / 
 public static boolean compactRealm ( final RealmConfiguration configuration ) { 
 + if ( configuration . getEncryptionKey ( ) ! = null ) { 
 + throw new IllegalArgumentException ( " Cannot currently compact an encrypted Realm . " ) ; 
 + } 
 + 
 final AtomicBoolean result = new AtomicBoolean ( false ) ; 
 
 RealmCache . invokeWithGlobalRefCount ( configuration , new RealmCache . Callback ( ) {
