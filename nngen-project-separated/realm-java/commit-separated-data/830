BLEU SCORE: 0.05341087579952926

TEST MSG: check if RealmTransformer is registered
GENERATED MSG: Add support for kotlin projects

TEST DIFF (one line): diff - - git a / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy b / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy <nl> index 0704301 . . 66fb29a 100644 <nl> - - - a / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy <nl> + + + b / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy <nl> @ @ - 16 , 6 + 16 , 7 @ @ <nl> <nl> package io . realm . gradle <nl> <nl> + import com . android . build . api . transform . Transform <nl> import org . gradle . api . GradleException <nl> import org . gradle . api . Project <nl> import org . gradle . api . artifacts . Dependency <nl> @ @ - 64 , 6 + 65 , 8 @ @ class PluginTest { <nl> <nl> assertTrue ( containsDependency ( project . dependencies , ' io . realm ' , ' realm - android - library ' , currentVersion ) ) <nl> assertTrue ( containsDependency ( project . dependencies , ' io . realm ' , ' realm - annotations ' , currentVersion ) ) <nl> + <nl> + assertTrue ( containsTransform ( project . android . transforms , RealmTransformer . class ) ) ; <nl> } <nl> <nl> @ Test <nl> @ @ - 115 , 4 + 118 , 13 @ @ class PluginTest { <nl> } <nl> return false <nl> } <nl> + <nl> + private static boolean containsTransform ( List < Transform > transformList , Class < ? extends Transform > targetClass ) { <nl> + for ( Transform t : transformList ) { <nl> + if ( t . getClass ( ) = = targetClass ) { <nl> + return true ; <nl> + } <nl> + } <nl> + return false ; <nl> + } <nl> }
NEAREST DIFF (one line): diff - - git a / examples / kotlinExample / build . gradle b / examples / kotlinExample / build . gradle <nl> index 440a01c . . faba957 100644 <nl> - - - a / examples / kotlinExample / build . gradle <nl> + + + b / examples / kotlinExample / build . gradle <nl> @ @ - 12 , 6 + 12 , 7 @ @ apply plugin : ' android - sdk - manager ' <nl> apply plugin : ' com . android . application ' <nl> apply plugin : ' kotlin - android ' <nl> apply plugin : ' android - command ' <nl> + apply plugin : ' realm ' <nl> <nl> android { <nl> compileSdkVersion rootProject . sdkVersion <nl> @ @ - 49 , 7 + 50 , 4 @ @ dependencies { <nl> compile " org . jetbrains . kotlin : kotlin - stdlib : $ { kotlin _ version } " <nl> compile " org . jetbrains . kotlin : kotlin - reflect : $ { kotlin _ version } " <nl> compile ' org . jetbrains . anko : anko - sdk15 : 0 . 7 . 2 ' <nl> - compile " io . realm : realm - android - library : $ { version } @ aar " <nl> - compile " io . realm : realm - annotations : $ { version } " <nl> - kapt " io . realm : realm - annotations - processor : $ { version } " <nl> } <nl> diff - - git a / examples / settings . gradle b / examples / settings . gradle <nl> index e52a32d . . d8d7a74 100644 <nl> - - - a / examples / settings . gradle <nl> + + + b / examples / settings . gradle <nl> @ @ - 3 , 7 + 3 , 7 @ @ include ' encryptionExample ' <nl> include ' gridViewExample ' <nl> include ' introExample ' <nl> include ' jsonExample ' <nl> - / / include ' kotlinExample ' <nl> + include ' kotlinExample ' <nl> include ' migrationExample ' <nl> include ' moduleExample : app ' <nl> include ' moduleExample : library ' <nl> diff - - git a / gradle - plugin / build . gradle b / gradle - plugin / build . gradle <nl> index fa45fd7 . . 6beb56c 100644 <nl> - - - a / gradle - plugin / build . gradle <nl> + + + b / gradle - plugin / build . gradle <nl> @ @ - 25 , 6 + 25 , 7 @ @ dependencies { <nl> compile ' com . android . tools . build : transform - api : 1 . 5 . 0 ' <nl> compile ' com . android . tools . build : gradle : 1 . 5 . 0 ' <nl> compile ' org . javassist : javassist : 3 . 20 . 0 - GA ' <nl> + compile ' org . jetbrains . kotlin : kotlin - gradle - plugin : 1 . 0 . 0 - beta - 3595 ' <nl> compile " io . realm : realm - annotations : $ { version } " <nl> compile " io . realm : realm - android : $ { version } @ jar " <nl> } <nl> diff - - git a / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy b / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy <nl> index db1b38d . . c816372 100644 <nl> - - - a / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy <nl> + + + b / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy <nl> @ @ - 6 , 6 + 6 , 7 @ @ import com . neenbedankt . gradle . androidapt . AndroidAptPlugin <nl> import org . gradle . api . GradleException <nl> import org . gradle . api . Plugin <nl> import org . gradle . api . Project <nl> + import org . jetbrains . kotlin . gradle . plugin . KotlinAndroidPlugin <nl> <nl> class Realm implements Plugin < Project > { <nl> <nl> @ @ - 18 , 12 + 19 , 22 @ @ class Realm implements Plugin < Project > { <nl> throw new GradleException ( " ' android ' or ' android - library ' plugin required . " ) <nl> } <nl> <nl> - project . plugins . apply ( AndroidAptPlugin ) <nl> + def isKotlinProject = project . plugins . withType ( KotlinAndroidPlugin ) <nl> + <nl> + if ( ! isKotlinProject ) { <nl> + project . plugins . apply ( AndroidAptPlugin ) <nl> + } <nl> + <nl> project . android . registerTransform ( new RealmTransformer ( ) ) <nl> project . repositories . add ( project . getRepositories ( ) . jcenter ( ) ) ; <nl> project . dependencies . add ( " compile " , " io . realm : realm - android - library : $ { Version . VERSION } " ) ; <nl> project . dependencies . add ( " compile " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; <nl> - project . dependencies . add ( " apt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; <nl> - project . dependencies . add ( " apt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; <nl> + if ( ! isKotlinProject ) { <nl> + project . dependencies . add ( " apt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; <nl> + project . dependencies . add ( " apt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; <nl> + } else { <nl> + project . dependencies . add ( " kapt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; <nl> + project . dependencies . add ( " kapt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; <nl> + } <nl> } <nl> }

TEST DIFF:
diff - - git a / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy b / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy 
 index 0704301 . . 66fb29a 100644 
 - - - a / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy 
 + + + b / gradle - plugin / src / test / groovy / io / realm / gradle / PluginTest . groovy 
 @ @ - 16 , 6 + 16 , 7 @ @ 
 
 package io . realm . gradle 
 
 + import com . android . build . api . transform . Transform 
 import org . gradle . api . GradleException 
 import org . gradle . api . Project 
 import org . gradle . api . artifacts . Dependency 
 @ @ - 64 , 6 + 65 , 8 @ @ class PluginTest { 
 
 assertTrue ( containsDependency ( project . dependencies , ' io . realm ' , ' realm - android - library ' , currentVersion ) ) 
 assertTrue ( containsDependency ( project . dependencies , ' io . realm ' , ' realm - annotations ' , currentVersion ) ) 
 + 
 + assertTrue ( containsTransform ( project . android . transforms , RealmTransformer . class ) ) ; 
 } 
 
 @ Test 
 @ @ - 115 , 4 + 118 , 13 @ @ class PluginTest { 
 } 
 return false 
 } 
 + 
 + private static boolean containsTransform ( List < Transform > transformList , Class < ? extends Transform > targetClass ) { 
 + for ( Transform t : transformList ) { 
 + if ( t . getClass ( ) = = targetClass ) { 
 + return true ; 
 + } 
 + } 
 + return false ; 
 + } 
 }

NEAREST DIFF:
diff - - git a / examples / kotlinExample / build . gradle b / examples / kotlinExample / build . gradle 
 index 440a01c . . faba957 100644 
 - - - a / examples / kotlinExample / build . gradle 
 + + + b / examples / kotlinExample / build . gradle 
 @ @ - 12 , 6 + 12 , 7 @ @ apply plugin : ' android - sdk - manager ' 
 apply plugin : ' com . android . application ' 
 apply plugin : ' kotlin - android ' 
 apply plugin : ' android - command ' 
 + apply plugin : ' realm ' 
 
 android { 
 compileSdkVersion rootProject . sdkVersion 
 @ @ - 49 , 7 + 50 , 4 @ @ dependencies { 
 compile " org . jetbrains . kotlin : kotlin - stdlib : $ { kotlin _ version } " 
 compile " org . jetbrains . kotlin : kotlin - reflect : $ { kotlin _ version } " 
 compile ' org . jetbrains . anko : anko - sdk15 : 0 . 7 . 2 ' 
 - compile " io . realm : realm - android - library : $ { version } @ aar " 
 - compile " io . realm : realm - annotations : $ { version } " 
 - kapt " io . realm : realm - annotations - processor : $ { version } " 
 } 
 diff - - git a / examples / settings . gradle b / examples / settings . gradle 
 index e52a32d . . d8d7a74 100644 
 - - - a / examples / settings . gradle 
 + + + b / examples / settings . gradle 
 @ @ - 3 , 7 + 3 , 7 @ @ include ' encryptionExample ' 
 include ' gridViewExample ' 
 include ' introExample ' 
 include ' jsonExample ' 
 - / / include ' kotlinExample ' 
 + include ' kotlinExample ' 
 include ' migrationExample ' 
 include ' moduleExample : app ' 
 include ' moduleExample : library ' 
 diff - - git a / gradle - plugin / build . gradle b / gradle - plugin / build . gradle 
 index fa45fd7 . . 6beb56c 100644 
 - - - a / gradle - plugin / build . gradle 
 + + + b / gradle - plugin / build . gradle 
 @ @ - 25 , 6 + 25 , 7 @ @ dependencies { 
 compile ' com . android . tools . build : transform - api : 1 . 5 . 0 ' 
 compile ' com . android . tools . build : gradle : 1 . 5 . 0 ' 
 compile ' org . javassist : javassist : 3 . 20 . 0 - GA ' 
 + compile ' org . jetbrains . kotlin : kotlin - gradle - plugin : 1 . 0 . 0 - beta - 3595 ' 
 compile " io . realm : realm - annotations : $ { version } " 
 compile " io . realm : realm - android : $ { version } @ jar " 
 } 
 diff - - git a / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy b / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy 
 index db1b38d . . c816372 100644 
 - - - a / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy 
 + + + b / gradle - plugin / src / main / groovy / io / realm / gradle / Realm . groovy 
 @ @ - 6 , 6 + 6 , 7 @ @ import com . neenbedankt . gradle . androidapt . AndroidAptPlugin 
 import org . gradle . api . GradleException 
 import org . gradle . api . Plugin 
 import org . gradle . api . Project 
 + import org . jetbrains . kotlin . gradle . plugin . KotlinAndroidPlugin 
 
 class Realm implements Plugin < Project > { 
 
 @ @ - 18 , 12 + 19 , 22 @ @ class Realm implements Plugin < Project > { 
 throw new GradleException ( " ' android ' or ' android - library ' plugin required . " ) 
 } 
 
 - project . plugins . apply ( AndroidAptPlugin ) 
 + def isKotlinProject = project . plugins . withType ( KotlinAndroidPlugin ) 
 + 
 + if ( ! isKotlinProject ) { 
 + project . plugins . apply ( AndroidAptPlugin ) 
 + } 
 + 
 project . android . registerTransform ( new RealmTransformer ( ) ) 
 project . repositories . add ( project . getRepositories ( ) . jcenter ( ) ) ; 
 project . dependencies . add ( " compile " , " io . realm : realm - android - library : $ { Version . VERSION } " ) ; 
 project . dependencies . add ( " compile " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; 
 - project . dependencies . add ( " apt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; 
 - project . dependencies . add ( " apt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; 
 + if ( ! isKotlinProject ) { 
 + project . dependencies . add ( " apt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; 
 + project . dependencies . add ( " apt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; 
 + } else { 
 + project . dependencies . add ( " kapt " , " io . realm : realm - annotations - processor : $ { Version . VERSION } " ) ; 
 + project . dependencies . add ( " kapt " , " io . realm : realm - annotations : $ { Version . VERSION } " ) ; 
 + } 
 } 
 }
