BLEU SCORE: 0.07545383788761362

TEST MSG: Add Collection . isValid
GENERATED MSG: Experiment of Results . get ( )

TEST DIFF (one line): diff - - git a / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp b / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp <nl> index 54b9b89 . . 05cb295 100644 <nl> - - - a / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp <nl> + + + b / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp <nl> @ @ - 459 , 3 + 459 , 13 @ @ Java _ io _ realm _ internal _ Collection _ nativeDelete ( JNIEnv * env , jclass , jlong native <nl> } CATCH _ STD ( ) <nl> } <nl> <nl> + JNIEXPORT jboolean JNICALL <nl> + Java _ io _ realm _ internal _ Collection _ nativeIsValid ( JNIEnv * env , jclass , jlong native _ ptr ) <nl> + { <nl> + TR _ ENTER _ PTR ( native _ ptr ) <nl> + try { <nl> + auto wrapper = reinterpret _ cast < ResultsWrapper * > ( native _ ptr ) ; <nl> + return wrapper - > get _ results ( ) . is _ valid ( ) ; <nl> + } CATCH _ STD ( ) <nl> + return JNI _ FALSE ; <nl> + } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / RealmResults . java b / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> index 38a4453 . . 822172e 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> @ @ - 100 , 7 + 100 , 7 @ @ public class RealmResults < E extends RealmModel > extends AbstractList < E > implemen <nl> * { @ inheritDoc } <nl> * / <nl> public boolean isValid ( ) { <nl> - return ! realm . isClosed ( ) ; <nl> + return collection . isValid ( ) ; <nl> } <nl> <nl> / * * <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> index ea2dea8 . . 8cbc460 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> @ @ - 215 , 6 + 215 , 10 @ @ public class Collection implements NativeObject { <nl> nativeStopListening ( nativePtr ) ; <nl> } <nl> <nl> + public boolean isValid ( ) { <nl> + return nativeIsValid ( nativePtr ) ; <nl> + } <nl> + <nl> / / Called by JNI <nl> @ KeepMember <nl> @ SuppressWarnings ( " unused " ) <nl> @ @ - 268 , 4 + 272 , 5 @ @ public class Collection implements NativeObject { <nl> private static native void nativeEnableSnapshot ( long nativePtr ) ; <nl> private static native void nativeDisableSnapshot ( long nativePtr ) ; <nl> private static native boolean nativeIsDetached ( long nativePtr ) ; <nl> + private static native boolean nativeIsValid ( long nativePtr ) ; <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java b / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java <nl> index 3dbd0d1 . . e936e6b 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java <nl> @ @ - 49 , 13 + 49 , 18 @ @ public class PendingRow implements Row { <nl> return ; <nl> } <nl> <nl> - / / PendingRow will always get the first Row of the query since we only support findFirst . <nl> - UncheckedRow uncheckedRow = pendingCollection . firstUncheckedRow ( ) ; <nl> - / / If no rows returned by the query , just wait for the query updates until it returns a valid row . <nl> - if ( uncheckedRow ! = null ) { <nl> - Row row = returnCheckedRow ? CheckedRow . getFromRow ( uncheckedRow ) : uncheckedRow ; <nl> - / / Ask the front end to reset the row and stop async query . <nl> - frontEnd . get ( ) . onQueryFinished ( row ) ; <nl> + if ( pendingCollection . isValid ( ) ) { <nl> + / / PendingRow will always get the first Row of the query since we only support findFirst . <nl> + UncheckedRow uncheckedRow = pendingCollection . firstUncheckedRow ( ) ; <nl> + / / If no rows returned by the query , just wait for the query updates until it returns a valid row . <nl> + if ( uncheckedRow ! = null ) { <nl> + Row row = returnCheckedRow ? CheckedRow . getFromRow ( uncheckedRow ) : uncheckedRow ; <nl> + / / Ask the front end to reset the row and stop async query . <nl> + frontEnd . get ( ) . onQueryFinished ( row ) ; <nl> + clearPendingCollection ( ) ; <nl> + } <nl> + } else { <nl> + / / The Realm is closed . Do nothing then . <nl> clearPendingCollection ( ) ; <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / realm / realm - library / src / main / java / io / realm / BaseRealm . java b / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> index c61b2ce . . 6e5dc1c 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / BaseRealm . java <nl> @ @ - 505 , 6 + 505 , 18 @ @ abstract class BaseRealm implements Closeable { <nl> return schema ; <nl> } <nl> <nl> + / / FIXME : Testing code <nl> + < E extends RealmModel > E get ( Class < E > clazz , long rowPtr ) { <nl> + Table table = schema . getTable ( clazz ) ; <nl> + UncheckedRow row = UncheckedRow . getByRowPointer ( table , rowPtr ) ; <nl> + <nl> + E result = configuration . getSchemaMediator ( ) . newInstance ( clazz , this , row , schema . getColumnInfo ( clazz ) , <nl> + false , Collections . < String > emptyList ( ) ) ; <nl> + RealmObjectProxy proxy = ( RealmObjectProxy ) result ; <nl> + proxy . realmGet $ proxyState ( ) . setTableVersion $ realm ( ) ; <nl> + return result ; <nl> + } <nl> + <nl> < E extends RealmModel > E get ( Class < E > clazz , long rowIndex , boolean acceptDefaultValue , List < String > excludeFields ) { <nl> Table table = schema . getTable ( clazz ) ; <nl> UncheckedRow row = table . getUncheckedRow ( rowIndex ) ; <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / RealmResults . java b / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> index 2870276 . . c0e0f70 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / RealmResults . java <nl> @ @ - 268 , 14 + 268 , 16 @ @ public final class RealmResults < E extends RealmModel > extends AbstractList < E > im <nl> public E get ( int location ) { <nl> E obj ; <nl> realm . checkIfValid ( ) ; <nl> + / * <nl> TableOrView table = getTableOrView ( ) ; <nl> if ( table instanceof TableView ) { <nl> obj = realm . get ( classSpec , className , ( ( TableView ) table ) . getSourceRowIndex ( location ) ) ; <nl> } else { <nl> obj = realm . get ( classSpec , className , location ) ; <nl> } <nl> - <nl> - return obj ; <nl> + * / <nl> + long rowPtr = nativeGetRow ( nativePtr , location ) ; <nl> + return realm . get ( classSpec , rowPtr ) ; <nl> } <nl> <nl> / * * <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Table . java b / realm / realm - library / src / main / java / io / realm / internal / Table . java <nl> index 88ba67d . . dd84818 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / Table . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / Table . java <nl> @ @ - 44 , 7 + 44 , 7 @ @ public class Table implements TableOrView , TableSchema { <nl> private static final long NO _ PRIMARY _ KEY = - 2 ; <nl> <nl> long nativePtr ; <nl> - private final Context context ; <nl> + final Context context ; <nl> private final SharedRealm sharedRealm ; <nl> private long cachedPrimaryKeyColumnIndex = NO _ MATCH ; <nl> <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java b / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java <nl> index 6e4bb8e . . 523b3fb 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java <nl> @ @ - 71 , 6 + 71 , 13 @ @ public class UncheckedRow extends NativeObject implements Row { <nl> return row ; <nl> } <nl> <nl> + / / FIXME : Testing code <nl> + public static UncheckedRow getByRowPointer ( Table table , long nativeRowPointer ) { <nl> + UncheckedRow row = new UncheckedRow ( table . context , table , nativeRowPointer ) ; <nl> + table . context . addReference ( NativeObjectReference . TYPE _ ROW , row ) ; <nl> + return row ; <nl> + } <nl> + <nl> / * * <nl> * Gets the row object associated to an index in a LinkView . <nl> *

TEST DIFF:
diff - - git a / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp b / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp 
 index 54b9b89 . . 05cb295 100644 
 - - - a / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp 
 + + + b / realm / realm - library / src / main / cpp / io _ realm _ internal _ Collection . cpp 
 @ @ - 459 , 3 + 459 , 13 @ @ Java _ io _ realm _ internal _ Collection _ nativeDelete ( JNIEnv * env , jclass , jlong native 
 } CATCH _ STD ( ) 
 } 
 
 + JNIEXPORT jboolean JNICALL 
 + Java _ io _ realm _ internal _ Collection _ nativeIsValid ( JNIEnv * env , jclass , jlong native _ ptr ) 
 + { 
 + TR _ ENTER _ PTR ( native _ ptr ) 
 + try { 
 + auto wrapper = reinterpret _ cast < ResultsWrapper * > ( native _ ptr ) ; 
 + return wrapper - > get _ results ( ) . is _ valid ( ) ; 
 + } CATCH _ STD ( ) 
 + return JNI _ FALSE ; 
 + } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / RealmResults . java b / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 index 38a4453 . . 822172e 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 + + + b / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 @ @ - 100 , 7 + 100 , 7 @ @ public class RealmResults < E extends RealmModel > extends AbstractList < E > implemen 
 * { @ inheritDoc } 
 * / 
 public boolean isValid ( ) { 
 - return ! realm . isClosed ( ) ; 
 + return collection . isValid ( ) ; 
 } 
 
 / * * 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 index ea2dea8 . . 8cbc460 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 @ @ - 215 , 6 + 215 , 10 @ @ public class Collection implements NativeObject { 
 nativeStopListening ( nativePtr ) ; 
 } 
 
 + public boolean isValid ( ) { 
 + return nativeIsValid ( nativePtr ) ; 
 + } 
 + 
 / / Called by JNI 
 @ KeepMember 
 @ SuppressWarnings ( " unused " ) 
 @ @ - 268 , 4 + 272 , 5 @ @ public class Collection implements NativeObject { 
 private static native void nativeEnableSnapshot ( long nativePtr ) ; 
 private static native void nativeDisableSnapshot ( long nativePtr ) ; 
 private static native boolean nativeIsDetached ( long nativePtr ) ; 
 + private static native boolean nativeIsValid ( long nativePtr ) ; 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java b / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java 
 index 3dbd0d1 . . e936e6b 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / PendingRow . java 
 @ @ - 49 , 13 + 49 , 18 @ @ public class PendingRow implements Row { 
 return ; 
 } 
 
 - / / PendingRow will always get the first Row of the query since we only support findFirst . 
 - UncheckedRow uncheckedRow = pendingCollection . firstUncheckedRow ( ) ; 
 - / / If no rows returned by the query , just wait for the query updates until it returns a valid row . 
 - if ( uncheckedRow ! = null ) { 
 - Row row = returnCheckedRow ? CheckedRow . getFromRow ( uncheckedRow ) : uncheckedRow ; 
 - / / Ask the front end to reset the row and stop async query . 
 - frontEnd . get ( ) . onQueryFinished ( row ) ; 
 + if ( pendingCollection . isValid ( ) ) { 
 + / / PendingRow will always get the first Row of the query since we only support findFirst . 
 + UncheckedRow uncheckedRow = pendingCollection . firstUncheckedRow ( ) ; 
 + / / If no rows returned by the query , just wait for the query updates until it returns a valid row . 
 + if ( uncheckedRow ! = null ) { 
 + Row row = returnCheckedRow ? CheckedRow . getFromRow ( uncheckedRow ) : uncheckedRow ; 
 + / / Ask the front end to reset the row and stop async query . 
 + frontEnd . get ( ) . onQueryFinished ( row ) ; 
 + clearPendingCollection ( ) ; 
 + } 
 + } else { 
 + / / The Realm is closed . Do nothing then . 
 clearPendingCollection ( ) ; 
 } 
 }

NEAREST DIFF:
diff - - git a / realm / realm - library / src / main / java / io / realm / BaseRealm . java b / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 index c61b2ce . . 6e5dc1c 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / BaseRealm . java 
 @ @ - 505 , 6 + 505 , 18 @ @ abstract class BaseRealm implements Closeable { 
 return schema ; 
 } 
 
 + / / FIXME : Testing code 
 + < E extends RealmModel > E get ( Class < E > clazz , long rowPtr ) { 
 + Table table = schema . getTable ( clazz ) ; 
 + UncheckedRow row = UncheckedRow . getByRowPointer ( table , rowPtr ) ; 
 + 
 + E result = configuration . getSchemaMediator ( ) . newInstance ( clazz , this , row , schema . getColumnInfo ( clazz ) , 
 + false , Collections . < String > emptyList ( ) ) ; 
 + RealmObjectProxy proxy = ( RealmObjectProxy ) result ; 
 + proxy . realmGet $ proxyState ( ) . setTableVersion $ realm ( ) ; 
 + return result ; 
 + } 
 + 
 < E extends RealmModel > E get ( Class < E > clazz , long rowIndex , boolean acceptDefaultValue , List < String > excludeFields ) { 
 Table table = schema . getTable ( clazz ) ; 
 UncheckedRow row = table . getUncheckedRow ( rowIndex ) ; 
 diff - - git a / realm / realm - library / src / main / java / io / realm / RealmResults . java b / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 index 2870276 . . c0e0f70 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 + + + b / realm / realm - library / src / main / java / io / realm / RealmResults . java 
 @ @ - 268 , 14 + 268 , 16 @ @ public final class RealmResults < E extends RealmModel > extends AbstractList < E > im 
 public E get ( int location ) { 
 E obj ; 
 realm . checkIfValid ( ) ; 
 + / * 
 TableOrView table = getTableOrView ( ) ; 
 if ( table instanceof TableView ) { 
 obj = realm . get ( classSpec , className , ( ( TableView ) table ) . getSourceRowIndex ( location ) ) ; 
 } else { 
 obj = realm . get ( classSpec , className , location ) ; 
 } 
 - 
 - return obj ; 
 + * / 
 + long rowPtr = nativeGetRow ( nativePtr , location ) ; 
 + return realm . get ( classSpec , rowPtr ) ; 
 } 
 
 / * * 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Table . java b / realm / realm - library / src / main / java / io / realm / internal / Table . java 
 index 88ba67d . . dd84818 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / Table . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / Table . java 
 @ @ - 44 , 7 + 44 , 7 @ @ public class Table implements TableOrView , TableSchema { 
 private static final long NO _ PRIMARY _ KEY = - 2 ; 
 
 long nativePtr ; 
 - private final Context context ; 
 + final Context context ; 
 private final SharedRealm sharedRealm ; 
 private long cachedPrimaryKeyColumnIndex = NO _ MATCH ; 
 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java b / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java 
 index 6e4bb8e . . 523b3fb 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / UncheckedRow . java 
 @ @ - 71 , 6 + 71 , 13 @ @ public class UncheckedRow extends NativeObject implements Row { 
 return row ; 
 } 
 
 + / / FIXME : Testing code 
 + public static UncheckedRow getByRowPointer ( Table table , long nativeRowPointer ) { 
 + UncheckedRow row = new UncheckedRow ( table . context , table , nativeRowPointer ) ; 
 + table . context . addReference ( NativeObjectReference . TYPE _ ROW , row ) ; 
 + return row ; 
 + } 
 + 
 / * * 
 * Gets the row object associated to an index in a LinkView . 
 *
