BLEU SCORE: 0.041961149062965476

TEST MSG: Fix monkey , release no longer need a real device
GENERATED MSG: Implement the release process in Gradle

TEST DIFF (one line): diff - - git a / examples / build . gradle b / examples / build . gradle <nl> index 17d9a57 . . 944e287 100644 <nl> - - - a / examples / build . gradle <nl> + + + b / examples / build . gradle <nl> @ @ - 6 , 6 + 6 , 15 @ @ configurations . all { <nl> resolutionStrategy . cacheChangingModulesFor 0 , ' seconds ' <nl> } <nl> <nl> + static String getAppId ( path ) { <nl> + String build = new File ( path ) . text <nl> + def matcher = build = ~ ' applicationId . * ' <nl> + def appId = matcher . size ( ) > 0 ? matcher [ 0 ] . trim ( ) - ' applicationId ' - ~ / \ s / : ' ' ; <nl> + String myappId = appId . replaceAll ( ' " ' , ' ' ) <nl> + myappId = myappId . replaceAll ( ' \ ' ' , ' ' ) <nl> + return myappId <nl> + } <nl> + <nl> allprojects { <nl> def currentVersion = file ( " $ { rootDir } / . . / version . txt " ) . text . trim ( ) <nl> <nl> @ @ - 24 , 7 + 33 , 6 @ @ allprojects { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 3 . 0 . 0 - rc2 ' <nl> - classpath ' com . novoda : gradle - android - command - plugin : 1 . 7 . 1 ' <nl> classpath ' com . jfrog . bintray . gradle : gradle - bintray - plugin : 1 . 7 . 3 ' <nl> classpath " io . realm : realm - gradle - plugin : $ { currentVersion } " <nl> } <nl> @ @ - 38 , 6 + 46 , 31 @ @ allprojects { <nl> jcenter ( ) <nl> google ( ) <nl> } <nl> + <nl> + if ( ! project . name . startsWith ( " realm - examples " ) <nl> + & & ! project . name . startsWith ( " library " ) <nl> + & & ! project . name . startsWith ( " moduleExample " ) ) { / / exclude root and library project <nl> + [ " Debug " , " Release " ] . each { <nl> + task " monkey $ { it } " ( dependsOn : " install $ { it } " ) { <nl> + doLast { <nl> + def numberOfEvents = 2000 <nl> + def appId = getAppId ( " $ { project . projectDir } / build . gradle " ) <nl> + def process = " adb shell monkey - p $ { appId } $ { numberOfEvents } " . execute ( [ ] , project . rootDir ) <nl> + <nl> + def sout = new StringBuilder ( ) , serr = new StringBuilder ( ) <nl> + process . consumeProcessOutput ( sout , serr ) <nl> + process . waitFor ( ) <nl> + <nl> + if ( process . exitValue ( ) ! = 0 <nl> + | | serr ? . toString ( ) ? . trim ( ) ? . size ( ) > 0 <nl> + | | ! sout ? . toString ( ) ? . trim ( ) ? . contains ( " Events injected : $ { numberOfEvents } " ) ) { <nl> + / / fail Gradle build <nl> + throw new GradleException ( " monkey failed for AppID : $ { appId } \ nStd out : $ { sout } \ nStd err : $ { serr } " ) <nl> + } <nl> + } <nl> + } <nl> + } <nl> + } <nl> } <nl> <nl> task wrapper ( type : Wrapper ) { <nl> diff - - git a / examples / encryptionExample / build . gradle b / examples / encryptionExample / build . gradle <nl> index 4655dfe . . 1d7baeb 100644 <nl> - - - a / examples / encryptionExample / build . gradle <nl> + + + b / examples / encryptionExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 25 , 8 + 24 , 4 @ @ android { <nl> } <nl> productFlavors { <nl> } <nl> - <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> diff - - git a / examples / gridViewExample / build . gradle b / examples / gridViewExample / build . gradle <nl> index 178240c . . 10615bf 100644 <nl> - - - a / examples / gridViewExample / build . gradle <nl> + + + b / examples / gridViewExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 27 , 10 + 26 , 6 @ @ android { <nl> productFlavors { <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> - <nl> splits { <nl> / / Split apks on build target ABI , view all options for the splits here : <nl> / / http : / / tools . android . com / tech - docs / new - build - system / user - guide / apk - splits <nl> diff - - git a / examples / introExample / build . gradle b / examples / introExample / build . gradle <nl> index 5d4bb70 . . fdf0d2d 100644 <nl> - - - a / examples / introExample / build . gradle <nl> + + + b / examples / introExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 27 , 7 + 26 , 4 @ @ android { <nl> productFlavors { <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> diff - - git a / examples / jsonExample / build . gradle b / examples / jsonExample / build . gradle <nl> index b4327f8 . . e3bd188 100644 <nl> - - - a / examples / jsonExample / build . gradle <nl> + + + b / examples / jsonExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 25 , 10 + 24 , 6 @ @ android { <nl> } <nl> productFlavors { <nl> } <nl> - <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / examples / kotlinExample / build . gradle b / examples / kotlinExample / build . gradle <nl> index ad5ff37 . . 91d3f31 100644 <nl> - - - a / examples / kotlinExample / build . gradle <nl> + + + b / examples / kotlinExample / build . gradle <nl> @ @ - 12 , 7 + 12 , 6 @ @ buildscript { <nl> apply plugin : ' com . android . application ' <nl> apply plugin : ' kotlin - android ' <nl> apply plugin : ' kotlin - kapt ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 40 , 10 + 39 , 6 @ @ android { <nl> } <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> - <nl> sourceSets { <nl> main . java . srcDirs + = ' src / main / kotlin ' <nl> } <nl> diff - - git a / examples / migrationExample / build . gradle b / examples / migrationExample / build . gradle <nl> index 53e5aaa . . b7991c0 100644 <nl> - - - a / examples / migrationExample / build . gradle <nl> + + + b / examples / migrationExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 22 , 7 + 21 , 4 @ @ android { <nl> minifyEnabled true <nl> } <nl> } <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> diff - - git a / examples / moduleExample / app / build . gradle b / examples / moduleExample / app / build . gradle <nl> index 3288225 . . 424f257 100644 <nl> - - - a / examples / moduleExample / app / build . gradle <nl> + + + b / examples / moduleExample / app / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 30 , 10 + 29 , 6 @ @ android { <nl> signingConfig signingConfigs . release <nl> } <nl> } <nl> - <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / examples / newsreaderExample / build . gradle b / examples / newsreaderExample / build . gradle <nl> index c62c2d7 . . e5cfcf0 100644 <nl> - - - a / examples / newsreaderExample / build . gradle <nl> + + + b / examples / newsreaderExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 22 , 10 + 21 , 6 @ @ android { <nl> } <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> - <nl> lintOptions { <nl> disable ' InvalidPackage ' <nl> } <nl> diff - - git a / examples / objectServerExample / build . gradle b / examples / objectServerExample / build . gradle <nl> index db3f530 . . 722e362 100644 <nl> - - - a / examples / objectServerExample / build . gradle <nl> + + + b / examples / objectServerExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> / / Credit : http : / / jeremie - martinez . com / 2015 / 05 / 05 / inject - host - gradle / <nl> @ @ - 51 , 10 + 50 , 6 @ @ android { <nl> signingConfig signingConfigs . debug <nl> } <nl> } <nl> - <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> <nl> realm { <nl> diff - - git a / examples / rxJavaExample / build . gradle b / examples / rxJavaExample / build . gradle <nl> index 2a0393b . . d6269c5 100644 <nl> - - - a / examples / rxJavaExample / build . gradle <nl> + + + b / examples / rxJavaExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 25 , 10 + 24 , 6 @ @ android { <nl> } <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> - <nl> packagingOptions { <nl> exclude ' META - INF / LICENSE ' <nl> } <nl> diff - - git a / examples / secureTokenAndroidKeyStore / build . gradle b / examples / secureTokenAndroidKeyStore / build . gradle <nl> index a25f094 . . 9e90be2 100644 <nl> - - - a / examples / secureTokenAndroidKeyStore / build . gradle <nl> + + + b / examples / secureTokenAndroidKeyStore / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 27 , 9 + 26 , 6 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / examples / settings . gradle b / examples / settings . gradle <nl> index 0f9f524 . . 5dbeeef 100644 <nl> - - - a / examples / settings . gradle <nl> + + + b / examples / settings . gradle <nl> @ @ - 7 , 7 + 7 , 6 @ @ include ' kotlinExample ' <nl> include ' migrationExample ' <nl> include ' moduleExample : app ' <nl> include ' moduleExample : library ' <nl> - include ' realmModuleExample ' <nl> include ' threadExample ' <nl> include ' unitTestExample ' <nl> include ' newsreaderExample ' <nl> @ @ - 15 , 4 + 14 , 3 @ @ include ' rxJavaExample ' <nl> include ' objectServerExample ' <nl> <nl> rootProject . name = ' realm - examples ' <nl> - <nl> diff - - git a / examples / threadExample / build . gradle b / examples / threadExample / build . gradle <nl> index 25980aa . . 91f88ac 100644 <nl> - - - a / examples / threadExample / build . gradle <nl> + + + b / examples / threadExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 22 , 9 + 21 , 6 @ @ android { <nl> minifyEnabled true <nl> } <nl> } <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / examples / unitTestExample / build . gradle b / examples / unitTestExample / build . gradle <nl> index cdb4e55 . . ef7e152 100644 <nl> - - - a / examples / unitTestExample / build . gradle <nl> + + + b / examples / unitTestExample / build . gradle <nl> @ @ - 1 , 5 + 1 , 4 @ @ <nl> apply plugin : ' com . android . application ' <nl> - apply plugin : ' android - command ' <nl> apply plugin : ' realm - android ' <nl> <nl> android { <nl> @ @ - 27 , 10 + 26 , 6 @ @ android { <nl> } <nl> } <nl> <nl> - command { <nl> - monkey . events 2000 <nl> - } <nl> - <nl> compileOptions { <nl> sourceCompatibility JavaVersion . VERSION _ 1 _ 8 <nl> targetCompatibility JavaVersion . VERSION _ 1 _ 8 <nl> diff - - git a / tools / release . sh b / tools / release . sh <nl> index a8494e5 . . 5d38989 100755 <nl> - - - a / tools / release . sh <nl> + + + b / tools / release . sh <nl> @ @ - 165 , 7 + 165 , 7 @ @ build ( ) { <nl> check _ adb _ device <nl> <nl> # Verify examples <nl> - ( cd examples & & . / gradlew uninstallAll & & . / gradlew monkeyDebug ) <nl> + ( cd examples & & . / gradlew clean uninstallAll & & . / gradlew monkeyDebug ) <nl> } <nl> <nl> upload _ to _ bintray ( ) { <nl> @ @ - 200 , 7 + 200 , 7 @ @ publish _ distribution ( ) { <nl> # Test <nl> check _ adb _ device <nl> pushd examples / <nl> - . / gradlew uninstallAll <nl> + . / gradlew clean uninstallAll <nl> . / gradlew monkeyRelease <nl> popd <nl> popd <nl> diff - - git a / version . txt b / version . txt <nl> index 2f81801 . . 5ebf768 100644 <nl> - - - a / version . txt <nl> + + + b / version . txt <nl> @ @ - 1 + 1 @ @ <nl> - 4 . 1 . 1 - SNAPSHOT <nl> \ No newline at end of file <nl> + 4 . 1 . 1 - SNAPSHOT
NEAREST DIFF (one line): diff - - git a / build . gradle b / build . gradle <nl> index 05c1bdf . . f19347a 100644 <nl> - - - a / build . gradle <nl> + + + b / build . gradle <nl> @ @ - 9 , 6 + 9 , 7 @ @ buildscript { <nl> classpath ' com . jfrog . bintray . gradle : gradle - bintray - plugin : 0 . 5 ' / / Version 0 . 6 seems to require gradle 2 . 0 + <nl> classpath ' com . jakewharton . sdkmanager : gradle - plugin : 0 . 12 . 0 ' <nl> classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> + classpath ' com . github . skhatri : gradle - s3 - plugin : 1 . 0 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmAdapterExample / build . gradle b / distribution / RealmAdapterExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmAdapterExample / build . gradle <nl> + + + b / distribution / RealmAdapterExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmEncryptionExample / build . gradle b / distribution / RealmEncryptionExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmEncryptionExample / build . gradle <nl> + + + b / distribution / RealmEncryptionExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmGridViewExample / build . gradle b / distribution / RealmGridViewExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmGridViewExample / build . gradle <nl> + + + b / distribution / RealmGridViewExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmIntroExample / build . gradle b / distribution / RealmIntroExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmIntroExample / build . gradle <nl> + + + b / distribution / RealmIntroExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmJsonExample / build . gradle b / distribution / RealmJsonExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmJsonExample / build . gradle <nl> + + + b / distribution / RealmJsonExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmMigrationExample / build . gradle b / distribution / RealmMigrationExample / build . gradle <nl> index 2027f3b . . 61fd77e 100644 <nl> - - - a / distribution / RealmMigrationExample / build . gradle <nl> + + + b / distribution / RealmMigrationExample / build . gradle <nl> @ @ - 6 , 6 + 6 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / distribution / RealmThreadExample / build . gradle b / distribution / RealmThreadExample / build . gradle <nl> index b9ed604 . . ae2ac55 100644 <nl> - - - a / distribution / RealmThreadExample / build . gradle <nl> + + + b / distribution / RealmThreadExample / build . gradle <nl> @ @ - 22 , 6 + 22 , 7 @ @ buildscript { <nl> } <nl> dependencies { <nl> classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' <nl> + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' <nl> } <nl> } <nl> <nl> diff - - git a / realm / build . gradle b / realm / build . gradle <nl> index daec63d . . 37d00f9 100644 <nl> - - - a / realm / build . gradle <nl> + + + b / realm / build . gradle <nl> @ @ - 23 , 8 + 23 , 8 @ @ android { <nl> / / } <nl> / / } <nl> <nl> - <nl> } <nl> + <nl> dependencies { <nl> compile ' com . intellij : annotations : + @ jar ' <nl> compile files ( " . . / realm - annotations / build / libs / realm - annotations - $ { version } . jar " ) <nl> @ @ - 39 , 7 + 39 , 7 @ @ android . libraryVariants . all { variant - > <nl> return ; / / Skip debug builds . <nl> } <nl> <nl> - task ( " javadoc $ { variant . name . capitalize ( ) } " , type : Javadoc ) { <nl> + def javadocTask = task ( " javadoc $ { variant . name . capitalize ( ) } " , type : Javadoc ) { <nl> description " Generates Javadoc for $ variant . name . " <nl> group ' Docs ' <nl> source = variant . javaCompile . source <nl> @ @ - 55 , 11 + 55 , 11 @ @ android . libraryVariants . all { variant - > <nl> description " Bundles Javadoc into zip for $ variant . name . " <nl> group ' Docs ' <nl> classifier = " javadoc " <nl> - from tasks [ " javadoc $ { variant . name . capitalize ( ) } " ] <nl> + from javadocTask <nl> } <nl> } <nl> <nl> - task androidJar ( type : Jar , dependsOn : [ ' assemble ' , ' bundleJavadocRelease ' ] ) { <nl> + task androidJar ( type : Jar , dependsOn : [ ' assemble ' ] ) { <nl> group ' Build ' <nl> description ' Generates a jar file continaining Realm and its annotation processor ' <nl> from zipTree ( ' build / intermediates / bundles / release / classes . jar ' ) <nl> @ @ - 156 , 10 + 156 , 8 @ @ task compileAnnotations ( type : GradleBuild ) { <nl> tasks = [ ' assemble ' ] <nl> } <nl> <nl> - tasks . preBuild { <nl> - dependsOn compileJni <nl> - dependsOn compileAnnotations <nl> - dependsOn buildApt <nl> + project . afterEvaluate { <nl> + preBuild . dependsOn ( [ ' compileJni ' , ' compileAnnotations ' , ' buildApt ' ] ) <nl> } <nl> <nl> def examples = [ <nl> @ @ - 187 , 7 + 185 , 7 @ @ task generateDistributionExamplesBuildFiles < < { <nl> } <nl> } <nl> <nl> - task populateDistributionFolder ( dependsOn : ' androidJar ' ) < < { <nl> + task populateDistributionFolder ( dependsOn : [ ' androidJar ' , ' bundleJavadocRelease ' ] ) < < { <nl> copy { <nl> from ' . . / changelog . txt ' <nl> from " build / libs / realm - $ { version } . jar " <nl> @ @ - 242 , 3 + 240 , 56 @ @ task createDistributionPackage ( type : Zip ) { <nl> destinationDir = new File ( " $ { rootDir } " ) <nl> archiveName = " realm - java - $ { version } . zip " <nl> } <nl> + <nl> + examples . each ( ) { src , dest - > <nl> + task " distributionMonkey $ { dest } " ( type : GradleBuild ) { <nl> + dependsOn createDistributionFolder <nl> + dependsOn bintrayUpload <nl> + dir = file ( " $ { rootDir } / distribution / $ { dest } " ) <nl> + tasks = [ ' monkeyRelease ' ] <nl> + } <nl> + } <nl> + <nl> + import com . github . skhatri . s3aws . plugin . S3UploadTask <nl> + <nl> + / / This is an ugly hack because we have two links to the latest version . <nl> + / / The right solution here would be to contribute a change to the S3 Gradle plugin <nl> + / / to allow link to be a list of strings . <nl> + [ ' java ' , ' android ' ] . each ( ) { link - > <nl> + task " upload $ { link . capitalize ( ) } DistributionPackage " ( type : S3UploadTask ) { <nl> + examples . each { src , dest - > <nl> + dependsOn " distributionMonkey $ { dest } " <nl> + } <nl> + bucket = ' static . realm . io ' <nl> + file = " $ { rootDir } / realm - java - $ { version } . zip " <nl> + key = ' downloads / java / realm - java - $ { version } . zip ' <nl> + link = " downloads / $ { link } / latest " <nl> + } <nl> + } <nl> + <nl> + task uploadUpdateVersion ( type : S3UploadTask ) { <nl> + [ ' java ' , ' android ' ] . each ( ) { link - > <nl> + dependsOn " upload $ { link . capitalize ( ) } DistributionPackage " <nl> + } <nl> + bucket = ' static . realm . io ' <nl> + file = " $ { rootDir } / version . txt " <nl> + key = ' downloads / update / java ' <nl> + } <nl> + <nl> + task tagRepo ( type : Exec ) { <nl> + dependsOn uploadUpdateVersion <nl> + workingDir rootDir <nl> + commandLine ' git ' , ' tag ' , ' - a ' , " v $ { version } " , ' - m ' , " v $ { version } " <nl> + } <nl> + <nl> + task pushTag ( type : Exec ) { <nl> + dependsOn tagRepo <nl> + workingDir rootDir <nl> + commandLine ' git ' , ' push ' , ' - - tags ' <nl> + } <nl> + <nl> + task release { <nl> + group ' Release ' <nl> + description ' Release realm - java ' <nl> + dependsOn pushTag <nl> + } <nl> \ No newline at end of file <nl> diff - - git a / tools / templates / RealmAdapterExample / build . gradle b / tools / templates / RealmAdapterExample / build . gradle <nl> index dd153d1 . . db868bf 100644 <nl> - - - a / tools / templates / RealmAdapterExample / build . gradle <nl> + + + b / tools / templates / RealmAdapterExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 10 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmEncryptionExample / build . gradle b / tools / templates / RealmEncryptionExample / build . gradle <nl> index e9efbce . . 98cc353 100644 <nl> - - - a / tools / templates / RealmEncryptionExample / build . gradle <nl> + + + b / tools / templates / RealmEncryptionExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmGridViewExample / build . gradle b / tools / templates / RealmGridViewExample / build . gradle <nl> index be0a2b2 . . 7dbaa96 100644 <nl> - - - a / tools / templates / RealmGridViewExample / build . gradle <nl> + + + b / tools / templates / RealmGridViewExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmIntroExample / build . gradle b / tools / templates / RealmIntroExample / build . gradle <nl> index c0b929f . . 80b5cf8 100644 <nl> - - - a / tools / templates / RealmIntroExample / build . gradle <nl> + + + b / tools / templates / RealmIntroExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmJsonExample / build . gradle b / tools / templates / RealmJsonExample / build . gradle <nl> index f4d5be7 . . c7818f7 100644 <nl> - - - a / tools / templates / RealmJsonExample / build . gradle <nl> + + + b / tools / templates / RealmJsonExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmMigrationExample / build . gradle b / tools / templates / RealmMigrationExample / build . gradle <nl> index b84d005 . . 4c89033 100644 <nl> - - - a / tools / templates / RealmMigrationExample / build . gradle <nl> + + + b / tools / templates / RealmMigrationExample / build . gradle <nl> @ @ - 1 , 4 + 1 , 5 @ @ <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 20 <nl> @ @ - 17 , 6 + 18 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies { <nl> diff - - git a / tools / templates / RealmThreadExample / build . gradle b / tools / templates / RealmThreadExample / build . gradle <nl> index 6c75572 . . e2c0a19 100644 <nl> - - - a / tools / templates / RealmThreadExample / build . gradle <nl> + + + b / tools / templates / RealmThreadExample / build . gradle <nl> @ @ - 15 , 6 + 15 , 7 @ @ <nl> * / <nl> <nl> apply plugin : ' com . android . application ' <nl> + apply plugin : ' android - command ' <nl> <nl> android { <nl> compileSdkVersion 21 <nl> @ @ - 33 , 6 + 34 , 9 @ @ android { <nl> proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' <nl> } <nl> } <nl> + command { <nl> + events 2000 <nl> + } <nl> } <nl> <nl> dependencies {

TEST DIFF:
diff - - git a / examples / build . gradle b / examples / build . gradle 
 index 17d9a57 . . 944e287 100644 
 - - - a / examples / build . gradle 
 + + + b / examples / build . gradle 
 @ @ - 6 , 6 + 6 , 15 @ @ configurations . all { 
 resolutionStrategy . cacheChangingModulesFor 0 , ' seconds ' 
 } 
 
 + static String getAppId ( path ) { 
 + String build = new File ( path ) . text 
 + def matcher = build = ~ ' applicationId . * ' 
 + def appId = matcher . size ( ) > 0 ? matcher [ 0 ] . trim ( ) - ' applicationId ' - ~ / \ s / : ' ' ; 
 + String myappId = appId . replaceAll ( ' " ' , ' ' ) 
 + myappId = myappId . replaceAll ( ' \ ' ' , ' ' ) 
 + return myappId 
 + } 
 + 
 allprojects { 
 def currentVersion = file ( " $ { rootDir } / . . / version . txt " ) . text . trim ( ) 
 
 @ @ - 24 , 7 + 33 , 6 @ @ allprojects { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 3 . 0 . 0 - rc2 ' 
 - classpath ' com . novoda : gradle - android - command - plugin : 1 . 7 . 1 ' 
 classpath ' com . jfrog . bintray . gradle : gradle - bintray - plugin : 1 . 7 . 3 ' 
 classpath " io . realm : realm - gradle - plugin : $ { currentVersion } " 
 } 
 @ @ - 38 , 6 + 46 , 31 @ @ allprojects { 
 jcenter ( ) 
 google ( ) 
 } 
 + 
 + if ( ! project . name . startsWith ( " realm - examples " ) 
 + & & ! project . name . startsWith ( " library " ) 
 + & & ! project . name . startsWith ( " moduleExample " ) ) { / / exclude root and library project 
 + [ " Debug " , " Release " ] . each { 
 + task " monkey $ { it } " ( dependsOn : " install $ { it } " ) { 
 + doLast { 
 + def numberOfEvents = 2000 
 + def appId = getAppId ( " $ { project . projectDir } / build . gradle " ) 
 + def process = " adb shell monkey - p $ { appId } $ { numberOfEvents } " . execute ( [ ] , project . rootDir ) 
 + 
 + def sout = new StringBuilder ( ) , serr = new StringBuilder ( ) 
 + process . consumeProcessOutput ( sout , serr ) 
 + process . waitFor ( ) 
 + 
 + if ( process . exitValue ( ) ! = 0 
 + | | serr ? . toString ( ) ? . trim ( ) ? . size ( ) > 0 
 + | | ! sout ? . toString ( ) ? . trim ( ) ? . contains ( " Events injected : $ { numberOfEvents } " ) ) { 
 + / / fail Gradle build 
 + throw new GradleException ( " monkey failed for AppID : $ { appId } \ nStd out : $ { sout } \ nStd err : $ { serr } " ) 
 + } 
 + } 
 + } 
 + } 
 + } 
 } 
 
 task wrapper ( type : Wrapper ) { 
 diff - - git a / examples / encryptionExample / build . gradle b / examples / encryptionExample / build . gradle 
 index 4655dfe . . 1d7baeb 100644 
 - - - a / examples / encryptionExample / build . gradle 
 + + + b / examples / encryptionExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 25 , 8 + 24 , 4 @ @ android { 
 } 
 productFlavors { 
 } 
 - 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 diff - - git a / examples / gridViewExample / build . gradle b / examples / gridViewExample / build . gradle 
 index 178240c . . 10615bf 100644 
 - - - a / examples / gridViewExample / build . gradle 
 + + + b / examples / gridViewExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 27 , 10 + 26 , 6 @ @ android { 
 productFlavors { 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 - 
 splits { 
 / / Split apks on build target ABI , view all options for the splits here : 
 / / http : / / tools . android . com / tech - docs / new - build - system / user - guide / apk - splits 
 diff - - git a / examples / introExample / build . gradle b / examples / introExample / build . gradle 
 index 5d4bb70 . . fdf0d2d 100644 
 - - - a / examples / introExample / build . gradle 
 + + + b / examples / introExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 27 , 7 + 26 , 4 @ @ android { 
 productFlavors { 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 diff - - git a / examples / jsonExample / build . gradle b / examples / jsonExample / build . gradle 
 index b4327f8 . . e3bd188 100644 
 - - - a / examples / jsonExample / build . gradle 
 + + + b / examples / jsonExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 25 , 10 + 24 , 6 @ @ android { 
 } 
 productFlavors { 
 } 
 - 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 
 dependencies { 
 diff - - git a / examples / kotlinExample / build . gradle b / examples / kotlinExample / build . gradle 
 index ad5ff37 . . 91d3f31 100644 
 - - - a / examples / kotlinExample / build . gradle 
 + + + b / examples / kotlinExample / build . gradle 
 @ @ - 12 , 7 + 12 , 6 @ @ buildscript { 
 apply plugin : ' com . android . application ' 
 apply plugin : ' kotlin - android ' 
 apply plugin : ' kotlin - kapt ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 40 , 10 + 39 , 6 @ @ android { 
 } 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 - 
 sourceSets { 
 main . java . srcDirs + = ' src / main / kotlin ' 
 } 
 diff - - git a / examples / migrationExample / build . gradle b / examples / migrationExample / build . gradle 
 index 53e5aaa . . b7991c0 100644 
 - - - a / examples / migrationExample / build . gradle 
 + + + b / examples / migrationExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 22 , 7 + 21 , 4 @ @ android { 
 minifyEnabled true 
 } 
 } 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 diff - - git a / examples / moduleExample / app / build . gradle b / examples / moduleExample / app / build . gradle 
 index 3288225 . . 424f257 100644 
 - - - a / examples / moduleExample / app / build . gradle 
 + + + b / examples / moduleExample / app / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 30 , 10 + 29 , 6 @ @ android { 
 signingConfig signingConfigs . release 
 } 
 } 
 - 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 
 dependencies { 
 diff - - git a / examples / newsreaderExample / build . gradle b / examples / newsreaderExample / build . gradle 
 index c62c2d7 . . e5cfcf0 100644 
 - - - a / examples / newsreaderExample / build . gradle 
 + + + b / examples / newsreaderExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 22 , 10 + 21 , 6 @ @ android { 
 } 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 - 
 lintOptions { 
 disable ' InvalidPackage ' 
 } 
 diff - - git a / examples / objectServerExample / build . gradle b / examples / objectServerExample / build . gradle 
 index db3f530 . . 722e362 100644 
 - - - a / examples / objectServerExample / build . gradle 
 + + + b / examples / objectServerExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 / / Credit : http : / / jeremie - martinez . com / 2015 / 05 / 05 / inject - host - gradle / 
 @ @ - 51 , 10 + 50 , 6 @ @ android { 
 signingConfig signingConfigs . debug 
 } 
 } 
 - 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 
 realm { 
 diff - - git a / examples / rxJavaExample / build . gradle b / examples / rxJavaExample / build . gradle 
 index 2a0393b . . d6269c5 100644 
 - - - a / examples / rxJavaExample / build . gradle 
 + + + b / examples / rxJavaExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 25 , 10 + 24 , 6 @ @ android { 
 } 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 - 
 packagingOptions { 
 exclude ' META - INF / LICENSE ' 
 } 
 diff - - git a / examples / secureTokenAndroidKeyStore / build . gradle b / examples / secureTokenAndroidKeyStore / build . gradle 
 index a25f094 . . 9e90be2 100644 
 - - - a / examples / secureTokenAndroidKeyStore / build . gradle 
 + + + b / examples / secureTokenAndroidKeyStore / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 27 , 9 + 26 , 6 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 
 dependencies { 
 diff - - git a / examples / settings . gradle b / examples / settings . gradle 
 index 0f9f524 . . 5dbeeef 100644 
 - - - a / examples / settings . gradle 
 + + + b / examples / settings . gradle 
 @ @ - 7 , 7 + 7 , 6 @ @ include ' kotlinExample ' 
 include ' migrationExample ' 
 include ' moduleExample : app ' 
 include ' moduleExample : library ' 
 - include ' realmModuleExample ' 
 include ' threadExample ' 
 include ' unitTestExample ' 
 include ' newsreaderExample ' 
 @ @ - 15 , 4 + 14 , 3 @ @ include ' rxJavaExample ' 
 include ' objectServerExample ' 
 
 rootProject . name = ' realm - examples ' 
 - 
 diff - - git a / examples / threadExample / build . gradle b / examples / threadExample / build . gradle 
 index 25980aa . . 91f88ac 100644 
 - - - a / examples / threadExample / build . gradle 
 + + + b / examples / threadExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 22 , 9 + 21 , 6 @ @ android { 
 minifyEnabled true 
 } 
 } 
 - command { 
 - monkey . events 2000 
 - } 
 } 
 
 dependencies { 
 diff - - git a / examples / unitTestExample / build . gradle b / examples / unitTestExample / build . gradle 
 index cdb4e55 . . ef7e152 100644 
 - - - a / examples / unitTestExample / build . gradle 
 + + + b / examples / unitTestExample / build . gradle 
 @ @ - 1 , 5 + 1 , 4 @ @ 
 apply plugin : ' com . android . application ' 
 - apply plugin : ' android - command ' 
 apply plugin : ' realm - android ' 
 
 android { 
 @ @ - 27 , 10 + 26 , 6 @ @ android { 
 } 
 } 
 
 - command { 
 - monkey . events 2000 
 - } 
 - 
 compileOptions { 
 sourceCompatibility JavaVersion . VERSION _ 1 _ 8 
 targetCompatibility JavaVersion . VERSION _ 1 _ 8 
 diff - - git a / tools / release . sh b / tools / release . sh 
 index a8494e5 . . 5d38989 100755 
 - - - a / tools / release . sh 
 + + + b / tools / release . sh 
 @ @ - 165 , 7 + 165 , 7 @ @ build ( ) { 
 check _ adb _ device 
 
 # Verify examples 
 - ( cd examples & & . / gradlew uninstallAll & & . / gradlew monkeyDebug ) 
 + ( cd examples & & . / gradlew clean uninstallAll & & . / gradlew monkeyDebug ) 
 } 
 
 upload _ to _ bintray ( ) { 
 @ @ - 200 , 7 + 200 , 7 @ @ publish _ distribution ( ) { 
 # Test 
 check _ adb _ device 
 pushd examples / 
 - . / gradlew uninstallAll 
 + . / gradlew clean uninstallAll 
 . / gradlew monkeyRelease 
 popd 
 popd 
 diff - - git a / version . txt b / version . txt 
 index 2f81801 . . 5ebf768 100644 
 - - - a / version . txt 
 + + + b / version . txt 
 @ @ - 1 + 1 @ @ 
 - 4 . 1 . 1 - SNAPSHOT 
 \ No newline at end of file 
 + 4 . 1 . 1 - SNAPSHOT

NEAREST DIFF:
diff - - git a / build . gradle b / build . gradle 
 index 05c1bdf . . f19347a 100644 
 - - - a / build . gradle 
 + + + b / build . gradle 
 @ @ - 9 , 6 + 9 , 7 @ @ buildscript { 
 classpath ' com . jfrog . bintray . gradle : gradle - bintray - plugin : 0 . 5 ' / / Version 0 . 6 seems to require gradle 2 . 0 + 
 classpath ' com . jakewharton . sdkmanager : gradle - plugin : 0 . 12 . 0 ' 
 classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 + classpath ' com . github . skhatri : gradle - s3 - plugin : 1 . 0 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmAdapterExample / build . gradle b / distribution / RealmAdapterExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmAdapterExample / build . gradle 
 + + + b / distribution / RealmAdapterExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmEncryptionExample / build . gradle b / distribution / RealmEncryptionExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmEncryptionExample / build . gradle 
 + + + b / distribution / RealmEncryptionExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmGridViewExample / build . gradle b / distribution / RealmGridViewExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmGridViewExample / build . gradle 
 + + + b / distribution / RealmGridViewExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmIntroExample / build . gradle b / distribution / RealmIntroExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmIntroExample / build . gradle 
 + + + b / distribution / RealmIntroExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmJsonExample / build . gradle b / distribution / RealmJsonExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmJsonExample / build . gradle 
 + + + b / distribution / RealmJsonExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmMigrationExample / build . gradle b / distribution / RealmMigrationExample / build . gradle 
 index 2027f3b . . 61fd77e 100644 
 - - - a / distribution / RealmMigrationExample / build . gradle 
 + + + b / distribution / RealmMigrationExample / build . gradle 
 @ @ - 6 , 6 + 6 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / distribution / RealmThreadExample / build . gradle b / distribution / RealmThreadExample / build . gradle 
 index b9ed604 . . ae2ac55 100644 
 - - - a / distribution / RealmThreadExample / build . gradle 
 + + + b / distribution / RealmThreadExample / build . gradle 
 @ @ - 22 , 6 + 22 , 7 @ @ buildscript { 
 } 
 dependencies { 
 classpath ' com . android . tools . build : gradle : 1 . 0 . 0 ' 
 + classpath ' com . novoda : gradle - android - command - plugin : 1 . 3 . 0 ' 
 } 
 } 
 
 diff - - git a / realm / build . gradle b / realm / build . gradle 
 index daec63d . . 37d00f9 100644 
 - - - a / realm / build . gradle 
 + + + b / realm / build . gradle 
 @ @ - 23 , 8 + 23 , 8 @ @ android { 
 / / } 
 / / } 
 
 - 
 } 
 + 
 dependencies { 
 compile ' com . intellij : annotations : + @ jar ' 
 compile files ( " . . / realm - annotations / build / libs / realm - annotations - $ { version } . jar " ) 
 @ @ - 39 , 7 + 39 , 7 @ @ android . libraryVariants . all { variant - > 
 return ; / / Skip debug builds . 
 } 
 
 - task ( " javadoc $ { variant . name . capitalize ( ) } " , type : Javadoc ) { 
 + def javadocTask = task ( " javadoc $ { variant . name . capitalize ( ) } " , type : Javadoc ) { 
 description " Generates Javadoc for $ variant . name . " 
 group ' Docs ' 
 source = variant . javaCompile . source 
 @ @ - 55 , 11 + 55 , 11 @ @ android . libraryVariants . all { variant - > 
 description " Bundles Javadoc into zip for $ variant . name . " 
 group ' Docs ' 
 classifier = " javadoc " 
 - from tasks [ " javadoc $ { variant . name . capitalize ( ) } " ] 
 + from javadocTask 
 } 
 } 
 
 - task androidJar ( type : Jar , dependsOn : [ ' assemble ' , ' bundleJavadocRelease ' ] ) { 
 + task androidJar ( type : Jar , dependsOn : [ ' assemble ' ] ) { 
 group ' Build ' 
 description ' Generates a jar file continaining Realm and its annotation processor ' 
 from zipTree ( ' build / intermediates / bundles / release / classes . jar ' ) 
 @ @ - 156 , 10 + 156 , 8 @ @ task compileAnnotations ( type : GradleBuild ) { 
 tasks = [ ' assemble ' ] 
 } 
 
 - tasks . preBuild { 
 - dependsOn compileJni 
 - dependsOn compileAnnotations 
 - dependsOn buildApt 
 + project . afterEvaluate { 
 + preBuild . dependsOn ( [ ' compileJni ' , ' compileAnnotations ' , ' buildApt ' ] ) 
 } 
 
 def examples = [ 
 @ @ - 187 , 7 + 185 , 7 @ @ task generateDistributionExamplesBuildFiles < < { 
 } 
 } 
 
 - task populateDistributionFolder ( dependsOn : ' androidJar ' ) < < { 
 + task populateDistributionFolder ( dependsOn : [ ' androidJar ' , ' bundleJavadocRelease ' ] ) < < { 
 copy { 
 from ' . . / changelog . txt ' 
 from " build / libs / realm - $ { version } . jar " 
 @ @ - 242 , 3 + 240 , 56 @ @ task createDistributionPackage ( type : Zip ) { 
 destinationDir = new File ( " $ { rootDir } " ) 
 archiveName = " realm - java - $ { version } . zip " 
 } 
 + 
 + examples . each ( ) { src , dest - > 
 + task " distributionMonkey $ { dest } " ( type : GradleBuild ) { 
 + dependsOn createDistributionFolder 
 + dependsOn bintrayUpload 
 + dir = file ( " $ { rootDir } / distribution / $ { dest } " ) 
 + tasks = [ ' monkeyRelease ' ] 
 + } 
 + } 
 + 
 + import com . github . skhatri . s3aws . plugin . S3UploadTask 
 + 
 + / / This is an ugly hack because we have two links to the latest version . 
 + / / The right solution here would be to contribute a change to the S3 Gradle plugin 
 + / / to allow link to be a list of strings . 
 + [ ' java ' , ' android ' ] . each ( ) { link - > 
 + task " upload $ { link . capitalize ( ) } DistributionPackage " ( type : S3UploadTask ) { 
 + examples . each { src , dest - > 
 + dependsOn " distributionMonkey $ { dest } " 
 + } 
 + bucket = ' static . realm . io ' 
 + file = " $ { rootDir } / realm - java - $ { version } . zip " 
 + key = ' downloads / java / realm - java - $ { version } . zip ' 
 + link = " downloads / $ { link } / latest " 
 + } 
 + } 
 + 
 + task uploadUpdateVersion ( type : S3UploadTask ) { 
 + [ ' java ' , ' android ' ] . each ( ) { link - > 
 + dependsOn " upload $ { link . capitalize ( ) } DistributionPackage " 
 + } 
 + bucket = ' static . realm . io ' 
 + file = " $ { rootDir } / version . txt " 
 + key = ' downloads / update / java ' 
 + } 
 + 
 + task tagRepo ( type : Exec ) { 
 + dependsOn uploadUpdateVersion 
 + workingDir rootDir 
 + commandLine ' git ' , ' tag ' , ' - a ' , " v $ { version } " , ' - m ' , " v $ { version } " 
 + } 
 + 
 + task pushTag ( type : Exec ) { 
 + dependsOn tagRepo 
 + workingDir rootDir 
 + commandLine ' git ' , ' push ' , ' - - tags ' 
 + } 
 + 
 + task release { 
 + group ' Release ' 
 + description ' Release realm - java ' 
 + dependsOn pushTag 
 + } 
 \ No newline at end of file 
 diff - - git a / tools / templates / RealmAdapterExample / build . gradle b / tools / templates / RealmAdapterExample / build . gradle 
 index dd153d1 . . db868bf 100644 
 - - - a / tools / templates / RealmAdapterExample / build . gradle 
 + + + b / tools / templates / RealmAdapterExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 10 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmEncryptionExample / build . gradle b / tools / templates / RealmEncryptionExample / build . gradle 
 index e9efbce . . 98cc353 100644 
 - - - a / tools / templates / RealmEncryptionExample / build . gradle 
 + + + b / tools / templates / RealmEncryptionExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmGridViewExample / build . gradle b / tools / templates / RealmGridViewExample / build . gradle 
 index be0a2b2 . . 7dbaa96 100644 
 - - - a / tools / templates / RealmGridViewExample / build . gradle 
 + + + b / tools / templates / RealmGridViewExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmIntroExample / build . gradle b / tools / templates / RealmIntroExample / build . gradle 
 index c0b929f . . 80b5cf8 100644 
 - - - a / tools / templates / RealmIntroExample / build . gradle 
 + + + b / tools / templates / RealmIntroExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmJsonExample / build . gradle b / tools / templates / RealmJsonExample / build . gradle 
 index f4d5be7 . . c7818f7 100644 
 - - - a / tools / templates / RealmJsonExample / build . gradle 
 + + + b / tools / templates / RealmJsonExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmMigrationExample / build . gradle b / tools / templates / RealmMigrationExample / build . gradle 
 index b84d005 . . 4c89033 100644 
 - - - a / tools / templates / RealmMigrationExample / build . gradle 
 + + + b / tools / templates / RealmMigrationExample / build . gradle 
 @ @ - 1 , 4 + 1 , 5 @ @ 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 20 
 @ @ - 17 , 6 + 18 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies { 
 diff - - git a / tools / templates / RealmThreadExample / build . gradle b / tools / templates / RealmThreadExample / build . gradle 
 index 6c75572 . . e2c0a19 100644 
 - - - a / tools / templates / RealmThreadExample / build . gradle 
 + + + b / tools / templates / RealmThreadExample / build . gradle 
 @ @ - 15 , 6 + 15 , 7 @ @ 
 * / 
 
 apply plugin : ' com . android . application ' 
 + apply plugin : ' android - command ' 
 
 android { 
 compileSdkVersion 21 
 @ @ - 33 , 6 + 34 , 9 @ @ android { 
 proguardFiles getDefaultProguardFile ( ' proguard - android . txt ' ) , ' proguard - rules . pro ' 
 } 
 } 
 + command { 
 + events 2000 
 + } 
 } 
 
 dependencies {
