BLEU SCORE: 0.11598118436136108

TEST MSG: Fix OsRealmSchema leak
GENERATED MSG: Disabling sync / compact combo

TEST DIFF (one line): diff - - git a / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java b / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java <nl> index f173f4d . . 13097cf 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java <nl> @ @ - 90 , 7 + 90 , 6 @ @ class OsRealmSchema extends RealmSchema { <nl> return this . nativePtr ; <nl> } <nl> <nl> - / / THIS IS NEVER CALLED ! <nl> / / See BaseRealm uses a StandardRealmSchema , not a OsRealmSchema . <nl> @ Override <nl> public void close ( ) { <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> index 4d87013 . . 6e74779 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / Realm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> @ @ - 385 , 6 + 385 , 7 @ @ public class Realm extends BaseRealm { <nl> / / to prevent multi - process interaction while the Realm is initialized . <nl> private static void initializeSyncedRealm ( Realm realm ) { <nl> boolean commitChanges = false ; <nl> + OsRealmSchema schema = null ; <nl> try { <nl> realm . beginTransaction ( ) ; <nl> long currentVersion = realm . getVersion ( ) ; <nl> @ @ - 401 , 7 + 402 , 7 @ @ public class Realm extends BaseRealm { <nl> } <nl> <nl> / / Assumption : When SyncConfiguration then additive schema update mode . <nl> - final OsRealmSchema schema = new OsRealmSchema ( schemaCreator ) ; <nl> + schema = new OsRealmSchema ( schemaCreator ) ; <nl> long newVersion = configuration . getSchemaVersion ( ) ; <nl> / / ! ! ! FIXME : This appalling kludge is necessitated by current package structure / visiblity constraints . <nl> / / It absolutely breaks encapsulation and needs to be fixed ! <nl> @ @ - 439 , 6 + 440 , 9 @ @ public class Realm extends BaseRealm { <nl> commitChanges = false ; <nl> throw e ; <nl> } finally { <nl> + if ( schema ! = null ) { <nl> + schema . close ( ) ; <nl> + } <nl> if ( commitChanges ) { <nl> realm . commitTransaction ( ) ; <nl> } else {
NEAREST DIFF (one line): diff - - git a / CHANGELOG . md b / CHANGELOG . md <nl> index 58be2af . . afd128c 100644 <nl> - - - a / CHANGELOG . md <nl> + + + b / CHANGELOG . md <nl> @ @ - 1 , 5 + 1 , 9 @ @ <nl> # # 2 . 2 . 2 <nl> <nl> + # # # Object Server API Changes ( In Beta ) <nl> + <nl> + * Disabled ` Realm . compactRealm ( ) ` when sync is enabled as it might corrupt the Realm ( https : / / github . com / realm / realm - core / issues / 2345 ) . <nl> + <nl> # # # Enhancements <nl> <nl> * All major public classes are now non - final . This is mostly a compromise to <nl> diff - - git a / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java b / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java <nl> index 17b734f . . 938fe33 100644 <nl> - - - a / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java <nl> + + + b / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java <nl> @ @ - 401 , 4 + 401 , 14 @ @ public class SyncConfigurationTests { <nl> String configStr = config . toString ( ) ; <nl> assertTrue ( configStr ! = null & & ! configStr . isEmpty ( ) ) ; <nl> } <nl> + <nl> + / / FIXME : This test can be removed when https : / / github . com / realm / realm - core / issues / 2345 is resolved <nl> + @ Test ( expected = UnsupportedOperationException . class ) <nl> + public void compact _ NotAllowed ( ) { <nl> + SyncUser user = createTestUser ( ) ; <nl> + String url = " realm : / / objectserver . realm . io / default " ; <nl> + SyncConfiguration config = new SyncConfiguration . Builder ( user , url ) . build ( ) ; <nl> + <nl> + Realm . compactRealm ( config ) ; <nl> + } <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> index f74055d . . 81c4bde 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / Realm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / Realm . java <nl> @ @ - 1555 , 10 + 1555 , 13 @ @ public class Realm extends BaseRealm { <nl> * <nl> * @ param configuration a { @ link RealmConfiguration } pointing to a Realm file . <nl> * @ return { @ code true } if successful , { @ code false } if any file operation failed . <nl> - * @ throws IllegalArgumentException if the realm file is encrypted . Compacting an encrypted Realm file is not <nl> - * supported yet . <nl> + * @ throws UnsupportedOperationException if Realm is synchronized . <nl> * / <nl> public static boolean compactRealm ( RealmConfiguration configuration ) { <nl> + / / FIXME : remove this restriction when https : / / github . com / realm / realm - core / issues / 2345 is resolved <nl> + if ( configuration . isSyncConfiguration ( ) ) { <nl> + throw new UnsupportedOperationException ( " Compacting is not supported yet on synced Realms . See https : / / github . com / realm / realm - core / issues / 2345 " ) ; <nl> + } <nl> return BaseRealm . compactRealm ( configuration ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java b / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java 
 index f173f4d . . 13097cf 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java 
 + + + b / realm / realm - library / src / main / java / io / realm / OsRealmSchema . java 
 @ @ - 90 , 7 + 90 , 6 @ @ class OsRealmSchema extends RealmSchema { 
 return this . nativePtr ; 
 } 
 
 - / / THIS IS NEVER CALLED ! 
 / / See BaseRealm uses a StandardRealmSchema , not a OsRealmSchema . 
 @ Override 
 public void close ( ) { 
 diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java 
 index 4d87013 . . 6e74779 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / Realm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / Realm . java 
 @ @ - 385 , 6 + 385 , 7 @ @ public class Realm extends BaseRealm { 
 / / to prevent multi - process interaction while the Realm is initialized . 
 private static void initializeSyncedRealm ( Realm realm ) { 
 boolean commitChanges = false ; 
 + OsRealmSchema schema = null ; 
 try { 
 realm . beginTransaction ( ) ; 
 long currentVersion = realm . getVersion ( ) ; 
 @ @ - 401 , 7 + 402 , 7 @ @ public class Realm extends BaseRealm { 
 } 
 
 / / Assumption : When SyncConfiguration then additive schema update mode . 
 - final OsRealmSchema schema = new OsRealmSchema ( schemaCreator ) ; 
 + schema = new OsRealmSchema ( schemaCreator ) ; 
 long newVersion = configuration . getSchemaVersion ( ) ; 
 / / ! ! ! FIXME : This appalling kludge is necessitated by current package structure / visiblity constraints . 
 / / It absolutely breaks encapsulation and needs to be fixed ! 
 @ @ - 439 , 6 + 440 , 9 @ @ public class Realm extends BaseRealm { 
 commitChanges = false ; 
 throw e ; 
 } finally { 
 + if ( schema ! = null ) { 
 + schema . close ( ) ; 
 + } 
 if ( commitChanges ) { 
 realm . commitTransaction ( ) ; 
 } else {

NEAREST DIFF:
diff - - git a / CHANGELOG . md b / CHANGELOG . md 
 index 58be2af . . afd128c 100644 
 - - - a / CHANGELOG . md 
 + + + b / CHANGELOG . md 
 @ @ - 1 , 5 + 1 , 9 @ @ 
 # # 2 . 2 . 2 
 
 + # # # Object Server API Changes ( In Beta ) 
 + 
 + * Disabled ` Realm . compactRealm ( ) ` when sync is enabled as it might corrupt the Realm ( https : / / github . com / realm / realm - core / issues / 2345 ) . 
 + 
 # # # Enhancements 
 
 * All major public classes are now non - final . This is mostly a compromise to 
 diff - - git a / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java b / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java 
 index 17b734f . . 938fe33 100644 
 - - - a / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java 
 + + + b / realm / realm - library / src / androidTestObjectServer / java / io / realm / SyncConfigurationTests . java 
 @ @ - 401 , 4 + 401 , 14 @ @ public class SyncConfigurationTests { 
 String configStr = config . toString ( ) ; 
 assertTrue ( configStr ! = null & & ! configStr . isEmpty ( ) ) ; 
 } 
 + 
 + / / FIXME : This test can be removed when https : / / github . com / realm / realm - core / issues / 2345 is resolved 
 + @ Test ( expected = UnsupportedOperationException . class ) 
 + public void compact _ NotAllowed ( ) { 
 + SyncUser user = createTestUser ( ) ; 
 + String url = " realm : / / objectserver . realm . io / default " ; 
 + SyncConfiguration config = new SyncConfiguration . Builder ( user , url ) . build ( ) ; 
 + 
 + Realm . compactRealm ( config ) ; 
 + } 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / Realm . java b / realm / realm - library / src / main / java / io / realm / Realm . java 
 index f74055d . . 81c4bde 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / Realm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / Realm . java 
 @ @ - 1555 , 10 + 1555 , 13 @ @ public class Realm extends BaseRealm { 
 * 
 * @ param configuration a { @ link RealmConfiguration } pointing to a Realm file . 
 * @ return { @ code true } if successful , { @ code false } if any file operation failed . 
 - * @ throws IllegalArgumentException if the realm file is encrypted . Compacting an encrypted Realm file is not 
 - * supported yet . 
 + * @ throws UnsupportedOperationException if Realm is synchronized . 
 * / 
 public static boolean compactRealm ( RealmConfiguration configuration ) { 
 + / / FIXME : remove this restriction when https : / / github . com / realm / realm - core / issues / 2345 is resolved 
 + if ( configuration . isSyncConfiguration ( ) ) { 
 + throw new UnsupportedOperationException ( " Compacting is not supported yet on synced Realms . See https : / / github . com / realm / realm - core / issues / 2345 " ) ; 
 + } 
 return BaseRealm . compactRealm ( configuration ) ; 
 } 

