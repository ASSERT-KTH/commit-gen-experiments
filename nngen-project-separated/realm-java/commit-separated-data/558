BLEU SCORE: 0.020980574531482755

TEST MSG: Accelerate build with ccache and lcache ( # 3523 )
GENERATED MSG: Also publish the fat jar

TEST DIFF (one line): diff - - git a / realm / realm - library / build . gradle b / realm / realm - library / build . gradle <nl> index 09e4c9f . . fa92cb8 100644 <nl> - - - a / realm / realm - library / build . gradle <nl> + + + b / realm / realm - library / build . gradle <nl> @ @ - 30 , 6 + 30 , 8 @ @ if ( ! ext . coreArchiveDir ) { <nl> ext . coreArchiveFile = rootProject . file ( " $ { ext . coreArchiveDir } / realm - sync - android - $ { project . coreVersion } . tar . gz " ) <nl> ext . coreDistributionDir = file ( " $ { projectDir } / distribution / realm - core / " ) <nl> ext . coreDir = file ( " $ { project . coreDistributionDir . getAbsolutePath ( ) } / core - $ { project . coreVersion } " ) <nl> + ext . ccachePath = project . findProperty ( ' ccachePath ' ) ? : System . getenv ( ' NDK _ CCACHE ' ) <nl> + ext . lcachePath = project . findProperty ( ' lcachePath ' ) ? : System . getenv ( ' NDK _ LCACHE ' ) <nl> <nl> android { <nl> compileSdkVersion 24 <nl> @ @ - 50 , 6 + 52 , 8 @ @ android { <nl> / / JNI build currently ( lack of lto linking support ) . <nl> / / This file should be removed and use the one from Android SDK cmake package when it supports lto . <nl> " - DCMAKE _ TOOLCHAIN _ FILE = $ { project . file ( ' src / main / cpp / android . toolchain . cmake ' ) . path } " <nl> + if ( project . ccachePath ) arguments " - DNDK _ CCACHE = $ project . ccachePath " <nl> + if ( project . lcachePath ) arguments " - DNDK _ LCACHE = $ project . lcachePath " <nl> if ( ! project . hasProperty ( ' android . injected . build . abi ' ) & & project . hasProperty ( ' buildTargetABIs ' ) ) { <nl> abiFilters ( * project . getProperty ( ' buildTargetABIs ' ) . trim ( ) . split ( ' \ \ s * , \ \ s * ' ) ) <nl> } else { <nl> diff - - git a / realm / realm - library / src / main / cpp / CMakeLists . txt b / realm / realm - library / src / main / cpp / CMakeLists . txt <nl> index 39c456f . . 957d90f 100644 <nl> - - - a / realm / realm - library / src / main / cpp / CMakeLists . txt <nl> + + + b / realm / realm - library / src / main / cpp / CMakeLists . txt <nl> @ @ - 17 , 6 + 17 , 11 @ @ set ( CMAKE _ VERBOSE _ MAKEFILE ON ) <nl> # Generate compile _ commands . json <nl> set ( CMAKE _ EXPORT _ COMPILE _ COMMANDS ON ) <nl> <nl> + # Setup lcache <nl> + if ( NDK _ LCACHE ) <nl> + set ( CMAKE _ CXX _ CREATE _ SHARED _ LIBRARY " $ { NDK _ LCACHE } $ { CMAKE _ CXX _ CREATE _ SHARED _ LIBRARY } " ) <nl> + endif ( ) <nl> + <nl> # Set flag build _ SYNC <nl> if ( REALM _ FLAVOR STREQUAL base ) <nl> set ( build _ SYNC OFF ) <nl> @ @ - 180 , 4 + 185 , 3 @ @ if ( CMAKE _ BUILD _ TYPE STREQUAL " Release " ) <nl> COMMAND $ { CMAKE _ COMMAND } - E copy $ < TARGET _ FILE : realm - jni > $ { unstripped _ SO _ DIR } <nl> COMMAND $ { CMAKE _ STRIP } $ < TARGET _ FILE : realm - jni > ) <nl> endif ( ) <nl> -
NEAREST DIFF (one line): diff - - git a / build . gradle b / build . gradle <nl> index aecf37f . . 3b3b21a 100644 <nl> - - - a / build . gradle <nl> + + + b / build . gradle <nl> @ @ - 265 , 8 + 265 , 22 @ @ def commonPom = { <nl> <nl> publishing { <nl> publications { <nl> - library ( MavenPublication ) { <nl> - artifactId = ' realm - android ' <nl> + jarLibrary ( MavenPublication ) { <nl> + artifactId = ' realm - android - library ' <nl> + artifact file ( " $ { buildDir } / outputs / gradle / realm - android - $ { currentVersion } . jar " ) <nl> + artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - sources . jar " ) <nl> + artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - javadoc . jar " ) <nl> + pom . withXml { <nl> + Node root = asNode ( ) <nl> + root . appendNode ( ' name ' , ' realm - android ' ) <nl> + root . appendNode ( ' description ' , ' Realm is a mobile database : a replacement for SQLite & ORMs . ' ) <nl> + root . appendNode ( ' url ' , ' http : / / realm . io ' ) <nl> + root . appendNode ( ' packaging ' , ' jar ' ) <nl> + root . children ( ) . last ( ) + commonPom <nl> + } <nl> + } <nl> + aarLibrary ( MavenPublication ) { <nl> + artifactId = ' realm - android - library ' <nl> artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - library - release . aar " ) <nl> artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - sources . jar " ) <nl> artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - javadoc . jar " ) <nl> @ @ - 327 , 7 + 341 , 7 @ @ artifactory { <nl> password = project . hasProperty ( ' bintrayKey ' ) ? bintrayKey : ' noKey ' <nl> } <nl> defaults { <nl> - publications ( ' library ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ) <nl> + publications ( ' jarLibrary ' , ' aarLibrary ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ) <nl> } <nl> } <nl> } <nl> @ @ - 339 , 7 + 353 , 7 @ @ bintray { <nl> dryRun = true <nl> publish = false <nl> <nl> - publications = [ ' library ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ] <nl> + publications = [ ' jarLibrary ' , ' aarLibrary ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ] <nl> pkg { <nl> repo = ' maven ' <nl> name = ' realm - android ' <nl> @ @ - 348 , 7 + 362 , 7 @ @ bintray { <nl> issueTrackerUrl = ' https : / / github . com / realm / realm - java / issues ' <nl> vcsUrl = ' https : / / github . com / realm / realm - java . git ' <nl> licenses = [ ' Apache - 2 . 0 ' ] <nl> - labels = [ ' aar ' , ' android ' , ' realm ' ] <nl> + labels = [ ' android ' , ' realm ' ] <nl> publicDownloadNumbers = false <nl> } <nl> }

TEST DIFF:
diff - - git a / realm / realm - library / build . gradle b / realm / realm - library / build . gradle 
 index 09e4c9f . . fa92cb8 100644 
 - - - a / realm / realm - library / build . gradle 
 + + + b / realm / realm - library / build . gradle 
 @ @ - 30 , 6 + 30 , 8 @ @ if ( ! ext . coreArchiveDir ) { 
 ext . coreArchiveFile = rootProject . file ( " $ { ext . coreArchiveDir } / realm - sync - android - $ { project . coreVersion } . tar . gz " ) 
 ext . coreDistributionDir = file ( " $ { projectDir } / distribution / realm - core / " ) 
 ext . coreDir = file ( " $ { project . coreDistributionDir . getAbsolutePath ( ) } / core - $ { project . coreVersion } " ) 
 + ext . ccachePath = project . findProperty ( ' ccachePath ' ) ? : System . getenv ( ' NDK _ CCACHE ' ) 
 + ext . lcachePath = project . findProperty ( ' lcachePath ' ) ? : System . getenv ( ' NDK _ LCACHE ' ) 
 
 android { 
 compileSdkVersion 24 
 @ @ - 50 , 6 + 52 , 8 @ @ android { 
 / / JNI build currently ( lack of lto linking support ) . 
 / / This file should be removed and use the one from Android SDK cmake package when it supports lto . 
 " - DCMAKE _ TOOLCHAIN _ FILE = $ { project . file ( ' src / main / cpp / android . toolchain . cmake ' ) . path } " 
 + if ( project . ccachePath ) arguments " - DNDK _ CCACHE = $ project . ccachePath " 
 + if ( project . lcachePath ) arguments " - DNDK _ LCACHE = $ project . lcachePath " 
 if ( ! project . hasProperty ( ' android . injected . build . abi ' ) & & project . hasProperty ( ' buildTargetABIs ' ) ) { 
 abiFilters ( * project . getProperty ( ' buildTargetABIs ' ) . trim ( ) . split ( ' \ \ s * , \ \ s * ' ) ) 
 } else { 
 diff - - git a / realm / realm - library / src / main / cpp / CMakeLists . txt b / realm / realm - library / src / main / cpp / CMakeLists . txt 
 index 39c456f . . 957d90f 100644 
 - - - a / realm / realm - library / src / main / cpp / CMakeLists . txt 
 + + + b / realm / realm - library / src / main / cpp / CMakeLists . txt 
 @ @ - 17 , 6 + 17 , 11 @ @ set ( CMAKE _ VERBOSE _ MAKEFILE ON ) 
 # Generate compile _ commands . json 
 set ( CMAKE _ EXPORT _ COMPILE _ COMMANDS ON ) 
 
 + # Setup lcache 
 + if ( NDK _ LCACHE ) 
 + set ( CMAKE _ CXX _ CREATE _ SHARED _ LIBRARY " $ { NDK _ LCACHE } $ { CMAKE _ CXX _ CREATE _ SHARED _ LIBRARY } " ) 
 + endif ( ) 
 + 
 # Set flag build _ SYNC 
 if ( REALM _ FLAVOR STREQUAL base ) 
 set ( build _ SYNC OFF ) 
 @ @ - 180 , 4 + 185 , 3 @ @ if ( CMAKE _ BUILD _ TYPE STREQUAL " Release " ) 
 COMMAND $ { CMAKE _ COMMAND } - E copy $ < TARGET _ FILE : realm - jni > $ { unstripped _ SO _ DIR } 
 COMMAND $ { CMAKE _ STRIP } $ < TARGET _ FILE : realm - jni > ) 
 endif ( ) 
 -

NEAREST DIFF:
diff - - git a / build . gradle b / build . gradle 
 index aecf37f . . 3b3b21a 100644 
 - - - a / build . gradle 
 + + + b / build . gradle 
 @ @ - 265 , 8 + 265 , 22 @ @ def commonPom = { 
 
 publishing { 
 publications { 
 - library ( MavenPublication ) { 
 - artifactId = ' realm - android ' 
 + jarLibrary ( MavenPublication ) { 
 + artifactId = ' realm - android - library ' 
 + artifact file ( " $ { buildDir } / outputs / gradle / realm - android - $ { currentVersion } . jar " ) 
 + artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - sources . jar " ) 
 + artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - javadoc . jar " ) 
 + pom . withXml { 
 + Node root = asNode ( ) 
 + root . appendNode ( ' name ' , ' realm - android ' ) 
 + root . appendNode ( ' description ' , ' Realm is a mobile database : a replacement for SQLite & ORMs . ' ) 
 + root . appendNode ( ' url ' , ' http : / / realm . io ' ) 
 + root . appendNode ( ' packaging ' , ' jar ' ) 
 + root . children ( ) . last ( ) + commonPom 
 + } 
 + } 
 + aarLibrary ( MavenPublication ) { 
 + artifactId = ' realm - android - library ' 
 artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - library - release . aar " ) 
 artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - sources . jar " ) 
 artifact file ( " $ { rootDir } / realm / realm - library / build / outputs / aar / realm - android - $ { currentVersion } - javadoc . jar " ) 
 @ @ - 327 , 7 + 341 , 7 @ @ artifactory { 
 password = project . hasProperty ( ' bintrayKey ' ) ? bintrayKey : ' noKey ' 
 } 
 defaults { 
 - publications ( ' library ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ) 
 + publications ( ' jarLibrary ' , ' aarLibrary ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ) 
 } 
 } 
 } 
 @ @ - 339 , 7 + 353 , 7 @ @ bintray { 
 dryRun = true 
 publish = false 
 
 - publications = [ ' library ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ] 
 + publications = [ ' jarLibrary ' , ' aarLibrary ' , ' annotations ' , ' annotationsProcessor ' , ' gradlePlugin ' ] 
 pkg { 
 repo = ' maven ' 
 name = ' realm - android ' 
 @ @ - 348 , 7 + 362 , 7 @ @ bintray { 
 issueTrackerUrl = ' https : / / github . com / realm / realm - java / issues ' 
 vcsUrl = ' https : / / github . com / realm / realm - java . git ' 
 licenses = [ ' Apache - 2 . 0 ' ] 
 - labels = [ ' aar ' , ' android ' , ' realm ' ] 
 + labels = [ ' android ' , ' realm ' ] 
 publicDownloadNumbers = false 
 } 
 }
