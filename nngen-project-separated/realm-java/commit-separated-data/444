BLEU SCORE: 0.028465126651392333

TEST MSG: Init some member vars in SharedRealm constructor
GENERATED MSG: reattach when BindingContext : : before _ notify

TEST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> index f7123d3 . . 88c29e4 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> @ @ - 68 , 7 + 68 , 7 @ @ public class RealmNotifierTests { <nl> @ Test <nl> @ RunTestInLooperThread <nl> public void post ( ) { <nl> - RealmNotifier notifier = new AndroidRealmNotifier ( capabilitiesCanDeliver ) ; <nl> + RealmNotifier notifier = new AndroidRealmNotifier ( null , capabilitiesCanDeliver ) ; <nl> notifier . post ( new Runnable ( ) { <nl> @ Override <nl> public void run ( ) { <nl> @ @ - 80 , 7 + 80 , 7 @ @ public class RealmNotifierTests { <nl> @ Test <nl> @ RunTestInLooperThread <nl> public void postAtFrontOfQueue ( ) { <nl> - final RealmNotifier notifier = new AndroidRealmNotifier ( capabilitiesCanDeliver ) ; <nl> + final RealmNotifier notifier = new AndroidRealmNotifier ( null , capabilitiesCanDeliver ) ; <nl> notifier . post ( new Runnable ( ) { <nl> @ Override <nl> public void run ( ) { <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> index f076565 . . b725025 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> @ @ - 53 , 6 + 53 , 10 @ @ public abstract class RealmNotifier implements Closeable { <nl> } <nl> } ; <nl> <nl> + protected RealmNotifier ( SharedRealm sharedRealm ) { <nl> + this . sharedRealm = sharedRealm ; <nl> + } <nl> + <nl> / / TODO : The only reason we have this is that async transactions is not supported by OS yet . And OS is using ALopper <nl> / / which will be using a different message queue from which java is using to deliver remote Realm changes message . <nl> / / We need a way to deliver the async transaction onSuccess callback to the caller thread after the caller Realm <nl> @ @ - 95 , 10 + 99 , 6 @ @ public abstract class RealmNotifier implements Closeable { <nl> sharedRealm . reattachCollections ( ) ; <nl> } <nl> <nl> - void setSharedRealm ( SharedRealm sharedRealm ) { <nl> - this . sharedRealm = sharedRealm ; <nl> - } <nl> - <nl> / * * <nl> * Called when close SharedRealm to clean up any event left in to queue . <nl> * / <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java b / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java <nl> index 7442548 . . 31b2e41 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java <nl> @ @ - 177 , 21 + 177 , 19 @ @ public final class SharedRealm implements Closeable { <nl> private long lastSchemaVersion ; <nl> private final SchemaVersionListener schemaChangeListener ; <nl> <nl> - private SharedRealm ( long nativePtr , <nl> + private SharedRealm ( long nativeConfigPtr , <nl> RealmConfiguration configuration , <nl> - Capabilities capabilities , <nl> - RealmNotifier notifier , <nl> SchemaVersionListener schemaVersionListener ) { <nl> context = new Context ( ) ; <nl> <nl> - this . nativePtr = nativePtr ; <nl> + Capabilities capabilities = new AndroidCapabilities ( ) ; <nl> + RealmNotifier realmNotifier = new AndroidRealmNotifier ( this , capabilities ) ; <nl> + <nl> + this . nativePtr = nativeGetSharedRealm ( nativeConfigPtr , realmNotifier ) ; <nl> this . configuration = configuration ; <nl> <nl> this . capabilities = capabilities ; <nl> - this . realmNotifier = notifier ; <nl> - if ( this . realmNotifier ! = null ) { <nl> - this . realmNotifier . setSharedRealm ( this ) ; <nl> - } <nl> + this . realmNotifier = realmNotifier ; <nl> this . schemaChangeListener = schemaVersionListener ; <nl> this . lastSchemaVersion = schemaVersionListener = = null ? - 1L : getSchemaVersion ( ) ; <nl> objectServerFacade = null ; <nl> @ @ - 225 , 15 + 223 , 8 @ @ public final class SharedRealm implements Closeable { <nl> rosServerUrl , <nl> rosUserToken ) ; <nl> <nl> - Capabilities capabilities = new AndroidCapabilities ( ) ; <nl> - RealmNotifier realmNotifier = new AndroidRealmNotifier ( capabilities ) ; <nl> try { <nl> - return new SharedRealm ( <nl> - nativeGetSharedRealm ( nativeConfigPtr , realmNotifier ) , <nl> - config , <nl> - capabilities , <nl> - realmNotifier , <nl> - schemaVersionListener ) ; <nl> + return new SharedRealm ( nativeConfigPtr , config , schemaVersionListener ) ; <nl> } finally { <nl> nativeCloseConfig ( nativeConfigPtr ) ; <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java <nl> index c6ed80f . . 0f6ea5f 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java <nl> @ @ - 5 , 11 + 5 , 13 @ @ import android . os . Looper ; <nl> <nl> import io . realm . internal . Capabilities ; <nl> import io . realm . internal . RealmNotifier ; <nl> + import io . realm . internal . SharedRealm ; <nl> <nl> public class AndroidRealmNotifier extends RealmNotifier { <nl> private Handler handler ; <nl> <nl> - public AndroidRealmNotifier ( Capabilities capabilities ) { <nl> + public AndroidRealmNotifier ( SharedRealm sharedRealm , Capabilities capabilities ) { <nl> + super ( sharedRealm ) ; <nl> if ( capabilities . canDeliverNotification ( ) ) { <nl> handler = new Handler ( Looper . myLooper ( ) ) ; <nl> } else {
NEAREST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> index 14d10c0 . . 48b9bae 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> @ @ - 31 , 7 + 31 , 6 @ @ import io . realm . rule . RunInLooperThread ; <nl> import io . realm . rule . RunTestInLooperThread ; <nl> import io . realm . rule . TestRealmConfigurationFactory ; <nl> <nl> - import static junit . framework . Assert . assertTrue ; <nl> import static junit . framework . Assert . fail ; <nl> <nl> @ RunWith ( AndroidJUnit4 . class ) <nl> @ @ - 107 , 6 + 106 , 7 @ @ public class RealmNotifierTests { <nl> / / Need a flag in java . <nl> / / assertTrue ( sharedRealm . isInTransaction ( ) ) ; <nl> looperThread . testComplete ( ) ; <nl> + sharedRealm . close ( ) ; <nl> } <nl> } ) ; <nl> sharedRealm . beginTransaction ( ) ; <nl> @ @ - 121 , 6 + 121 , 7 @ @ public class RealmNotifierTests { <nl> @ Override <nl> public void onChange ( SharedRealm sharedRealm ) { <nl> looperThread . testComplete ( ) ; <nl> + sharedRealm . close ( ) ; <nl> } <nl> } ) ; <nl> new Thread ( new Runnable ( ) { <nl> diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> index 7e7d387 . . b68db66 100644 <nl> - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> @ @ - 56 , 7 + 56 , 7 @ @ std : : vector < BindingContext : : ObserverState > JavaBindingContext : : get _ observed _ rows <nl> return state _ list ; <nl> } <nl> <nl> - void JavaBindingContext : : changes _ available ( ) <nl> + void JavaBindingContext : : before _ notify ( ) <nl> { <nl> if ( m _ java _ notifier ) { <nl> m _ java _ notifier . call _ with _ local _ ref ( [ & ] ( JNIEnv * env , jobject notifier _ obj ) { <nl> diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> index aaed72b . . 18535fc 100644 <nl> - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> @ @ - 46 , 7 + 46 , 7 @ @ private : <nl> public : <nl> virtual ~ JavaBindingContext ( ) { } ; <nl> virtual std : : vector < ObserverState > get _ observed _ rows ( ) ; <nl> - virtual void changes _ available ( ) ; <nl> + virtual void before _ notify ( ) ; <nl> virtual void did _ change ( std : : vector < ObserverState > const & observers , <nl> std : : vector < void * > const & invalidated , <nl> bool version _ changed = true ) ; <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> index 8cbc460 . . fee2390 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> @ @ - 223 , 13 + 223 , 6 @ @ public class Collection implements NativeObject { <nl> @ KeepMember <nl> @ SuppressWarnings ( " unused " ) <nl> private void notifyChangeListeners ( boolean emptyChanges ) { <nl> - / / For the stable iteration . <nl> - / / It is needed when the local commit triggered async query updates . And this is called in the next event loop <nl> - / / by OS Realm : : notify ( ) . <nl> - if ( ! emptyChanges ) { <nl> - this . disableSnapshot ( ) ; <nl> - } <nl> - <nl> if ( emptyChanges & & isDetached ( ) ) return ; <nl> observerPairs . foreach ( onChangeCallback ) ; <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> index 5a7703e . . 93c9d57 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> @ @ - 91 , 6 + 91 , 7 @ @ public abstract class RealmNotifier implements Closeable { <nl> @ SuppressWarnings ( " unused " ) / / called from java _ binding _ context . cpp <nl> / / Package protected to avoid finding class by name in JNI . <nl> void changesAvailable ( ) { <nl> + / / For the stable iteration . <nl> sharedRealm . disableCollectionSnapshot ( ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 index f7123d3 . . 88c29e4 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 @ @ - 68 , 7 + 68 , 7 @ @ public class RealmNotifierTests { 
 @ Test 
 @ RunTestInLooperThread 
 public void post ( ) { 
 - RealmNotifier notifier = new AndroidRealmNotifier ( capabilitiesCanDeliver ) ; 
 + RealmNotifier notifier = new AndroidRealmNotifier ( null , capabilitiesCanDeliver ) ; 
 notifier . post ( new Runnable ( ) { 
 @ Override 
 public void run ( ) { 
 @ @ - 80 , 7 + 80 , 7 @ @ public class RealmNotifierTests { 
 @ Test 
 @ RunTestInLooperThread 
 public void postAtFrontOfQueue ( ) { 
 - final RealmNotifier notifier = new AndroidRealmNotifier ( capabilitiesCanDeliver ) ; 
 + final RealmNotifier notifier = new AndroidRealmNotifier ( null , capabilitiesCanDeliver ) ; 
 notifier . post ( new Runnable ( ) { 
 @ Override 
 public void run ( ) { 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 index f076565 . . b725025 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 @ @ - 53 , 6 + 53 , 10 @ @ public abstract class RealmNotifier implements Closeable { 
 } 
 } ; 
 
 + protected RealmNotifier ( SharedRealm sharedRealm ) { 
 + this . sharedRealm = sharedRealm ; 
 + } 
 + 
 / / TODO : The only reason we have this is that async transactions is not supported by OS yet . And OS is using ALopper 
 / / which will be using a different message queue from which java is using to deliver remote Realm changes message . 
 / / We need a way to deliver the async transaction onSuccess callback to the caller thread after the caller Realm 
 @ @ - 95 , 10 + 99 , 6 @ @ public abstract class RealmNotifier implements Closeable { 
 sharedRealm . reattachCollections ( ) ; 
 } 
 
 - void setSharedRealm ( SharedRealm sharedRealm ) { 
 - this . sharedRealm = sharedRealm ; 
 - } 
 - 
 / * * 
 * Called when close SharedRealm to clean up any event left in to queue . 
 * / 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java b / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java 
 index 7442548 . . 31b2e41 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / SharedRealm . java 
 @ @ - 177 , 21 + 177 , 19 @ @ public final class SharedRealm implements Closeable { 
 private long lastSchemaVersion ; 
 private final SchemaVersionListener schemaChangeListener ; 
 
 - private SharedRealm ( long nativePtr , 
 + private SharedRealm ( long nativeConfigPtr , 
 RealmConfiguration configuration , 
 - Capabilities capabilities , 
 - RealmNotifier notifier , 
 SchemaVersionListener schemaVersionListener ) { 
 context = new Context ( ) ; 
 
 - this . nativePtr = nativePtr ; 
 + Capabilities capabilities = new AndroidCapabilities ( ) ; 
 + RealmNotifier realmNotifier = new AndroidRealmNotifier ( this , capabilities ) ; 
 + 
 + this . nativePtr = nativeGetSharedRealm ( nativeConfigPtr , realmNotifier ) ; 
 this . configuration = configuration ; 
 
 this . capabilities = capabilities ; 
 - this . realmNotifier = notifier ; 
 - if ( this . realmNotifier ! = null ) { 
 - this . realmNotifier . setSharedRealm ( this ) ; 
 - } 
 + this . realmNotifier = realmNotifier ; 
 this . schemaChangeListener = schemaVersionListener ; 
 this . lastSchemaVersion = schemaVersionListener = = null ? - 1L : getSchemaVersion ( ) ; 
 objectServerFacade = null ; 
 @ @ - 225 , 15 + 223 , 8 @ @ public final class SharedRealm implements Closeable { 
 rosServerUrl , 
 rosUserToken ) ; 
 
 - Capabilities capabilities = new AndroidCapabilities ( ) ; 
 - RealmNotifier realmNotifier = new AndroidRealmNotifier ( capabilities ) ; 
 try { 
 - return new SharedRealm ( 
 - nativeGetSharedRealm ( nativeConfigPtr , realmNotifier ) , 
 - config , 
 - capabilities , 
 - realmNotifier , 
 - schemaVersionListener ) ; 
 + return new SharedRealm ( nativeConfigPtr , config , schemaVersionListener ) ; 
 } finally { 
 nativeCloseConfig ( nativeConfigPtr ) ; 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java 
 index c6ed80f . . 0f6ea5f 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidRealmNotifier . java 
 @ @ - 5 , 11 + 5 , 13 @ @ import android . os . Looper ; 
 
 import io . realm . internal . Capabilities ; 
 import io . realm . internal . RealmNotifier ; 
 + import io . realm . internal . SharedRealm ; 
 
 public class AndroidRealmNotifier extends RealmNotifier { 
 private Handler handler ; 
 
 - public AndroidRealmNotifier ( Capabilities capabilities ) { 
 + public AndroidRealmNotifier ( SharedRealm sharedRealm , Capabilities capabilities ) { 
 + super ( sharedRealm ) ; 
 if ( capabilities . canDeliverNotification ( ) ) { 
 handler = new Handler ( Looper . myLooper ( ) ) ; 
 } else {

NEAREST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 index 14d10c0 . . 48b9bae 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 @ @ - 31 , 7 + 31 , 6 @ @ import io . realm . rule . RunInLooperThread ; 
 import io . realm . rule . RunTestInLooperThread ; 
 import io . realm . rule . TestRealmConfigurationFactory ; 
 
 - import static junit . framework . Assert . assertTrue ; 
 import static junit . framework . Assert . fail ; 
 
 @ RunWith ( AndroidJUnit4 . class ) 
 @ @ - 107 , 6 + 106 , 7 @ @ public class RealmNotifierTests { 
 / / Need a flag in java . 
 / / assertTrue ( sharedRealm . isInTransaction ( ) ) ; 
 looperThread . testComplete ( ) ; 
 + sharedRealm . close ( ) ; 
 } 
 } ) ; 
 sharedRealm . beginTransaction ( ) ; 
 @ @ - 121 , 6 + 121 , 7 @ @ public class RealmNotifierTests { 
 @ Override 
 public void onChange ( SharedRealm sharedRealm ) { 
 looperThread . testComplete ( ) ; 
 + sharedRealm . close ( ) ; 
 } 
 } ) ; 
 new Thread ( new Runnable ( ) { 
 diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 index 7e7d387 . . b68db66 100644 
 - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 @ @ - 56 , 7 + 56 , 7 @ @ std : : vector < BindingContext : : ObserverState > JavaBindingContext : : get _ observed _ rows 
 return state _ list ; 
 } 
 
 - void JavaBindingContext : : changes _ available ( ) 
 + void JavaBindingContext : : before _ notify ( ) 
 { 
 if ( m _ java _ notifier ) { 
 m _ java _ notifier . call _ with _ local _ ref ( [ & ] ( JNIEnv * env , jobject notifier _ obj ) { 
 diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 index aaed72b . . 18535fc 100644 
 - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 @ @ - 46 , 7 + 46 , 7 @ @ private : 
 public : 
 virtual ~ JavaBindingContext ( ) { } ; 
 virtual std : : vector < ObserverState > get _ observed _ rows ( ) ; 
 - virtual void changes _ available ( ) ; 
 + virtual void before _ notify ( ) ; 
 virtual void did _ change ( std : : vector < ObserverState > const & observers , 
 std : : vector < void * > const & invalidated , 
 bool version _ changed = true ) ; 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 index 8cbc460 . . fee2390 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 @ @ - 223 , 13 + 223 , 6 @ @ public class Collection implements NativeObject { 
 @ KeepMember 
 @ SuppressWarnings ( " unused " ) 
 private void notifyChangeListeners ( boolean emptyChanges ) { 
 - / / For the stable iteration . 
 - / / It is needed when the local commit triggered async query updates . And this is called in the next event loop 
 - / / by OS Realm : : notify ( ) . 
 - if ( ! emptyChanges ) { 
 - this . disableSnapshot ( ) ; 
 - } 
 - 
 if ( emptyChanges & & isDetached ( ) ) return ; 
 observerPairs . foreach ( onChangeCallback ) ; 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 index 5a7703e . . 93c9d57 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 @ @ - 91 , 6 + 91 , 7 @ @ public abstract class RealmNotifier implements Closeable { 
 @ SuppressWarnings ( " unused " ) / / called from java _ binding _ context . cpp 
 / / Package protected to avoid finding class by name in JNI . 
 void changesAvailable ( ) { 
 + / / For the stable iteration . 
 sharedRealm . disableCollectionSnapshot ( ) ; 
 } 

