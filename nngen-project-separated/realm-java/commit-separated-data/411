BLEU SCORE: 0.024893534183931972

TEST MSG: PR fix
GENERATED MSG: reattach when BindingContext : : before _ notify

TEST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java <nl> index 15c8163 . . 9908533 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java <nl> @ @ - 2712 , 7 + 2712 , 7 @ @ public class RealmQueryTests { <nl> Realm realm = looperThread . realm ; <nl> populateTestRealm ( realm , TEST _ DATA _ SIZE ) ; <nl> RealmResults < AllTypes > results = realm . where ( AllTypes . class ) <nl> - . findAllSorted ( AllTypes . FIELD _ REALMOBJECT + " . " + Dog . FIELD _ AGE ) ; <nl> + . findAllSortedAsync ( AllTypes . FIELD _ REALMOBJECT + " . " + Dog . FIELD _ AGE ) ; <nl> looperThread . keepStrongReference . add ( results ) ; <nl> results . addChangeListener ( new RealmChangeListener < RealmResults < AllTypes > > ( ) { <nl> @ Override <nl> @ @ - 2755 , 7 + 2755 , 7 @ @ public class RealmQueryTests { <nl> <nl> populateTestRealm ( realm , TEST _ DATA _ SIZE ) ; <nl> RealmResults < AllTypes > results = realm . where ( AllTypes . class ) <nl> - . findAllSorted ( fieldNames , sorts ) ; <nl> + . findAllSortedAsync ( fieldNames , sorts ) ; <nl> looperThread . keepStrongReference . add ( results ) ; <nl> results . addChangeListener ( new RealmChangeListener < RealmResults < AllTypes > > ( ) { <nl> @ Override <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> index 3fba8aa . . b7043c0 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java <nl> @ @ - 491 , 7 + 491 , 7 @ @ public class TypeBasedNotificationsTests { <nl> dog . addChangeListener ( new RealmChangeListener < Dog > ( ) { <nl> @ Override <nl> public void onChange ( Dog object ) { <nl> - / / Step 4 : Respond to relevant change <nl> + / / Step 3 : Respond to relevant change <nl> typebasedCommitInvocations . incrementAndGet ( ) ; <nl> assertEquals ( " Akamaru " , dog . getName ( ) ) ; <nl> assertEquals ( 17 , dog . getAge ( ) ) ; <nl> diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> index 39e5507 . . bb1f9ec 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> @ @ - 189 , 14 + 189 , 6 @ @ public class RealmNotifierTests { <nl> / / This should only remove the listeners related with dummyObserver <nl> sharedRealm . realmNotifier . removeChangeListeners ( dummyObserver ) ; <nl> <nl> - new Thread ( new Runnable ( ) { <nl> - @ Override <nl> - public void run ( ) { <nl> - SharedRealm sharedRealm = getSharedRealm ( looperThread . realmConfiguration ) ; <nl> - sharedRealm . beginTransaction ( ) ; <nl> - sharedRealm . commitTransaction ( ) ; <nl> - sharedRealm . close ( ) ; <nl> - } <nl> - } ) . start ( ) ; <nl> + makeRemoteChanges ( looperThread . realmConfiguration ) ; <nl> } <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java b / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java <nl> index 94a0d2a . . 3d6b6cf 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java <nl> @ @ - 107 , 14 + 107 , 11 @ @ public class SortDescriptor { <nl> } <nl> <nl> private static void checkFieldTypeForSort ( FieldDescriptor descriptor , String fieldDescriptions ) { <nl> - for ( RealmFieldType aValidFieldTypesForSort : validFieldTypesForSort ) { <nl> - if ( aValidFieldTypesForSort = = descriptor . getFieldType ( ) ) { <nl> - return ; <nl> - } <nl> + if ( ! validFieldTypesForSort . contains ( descriptor . getFieldType ( ) ) ) { <nl> + throw new IllegalArgumentException ( String . format ( <nl> + " Sort is not supported on ' % s ' field ' % s ' in ' % s ' . " , descriptor . toString ( ) , descriptor . getFieldName ( ) , <nl> + fieldDescriptions ) ) ; <nl> } <nl> - throw new IllegalArgumentException ( String . format ( <nl> - " Sort is not supported on ' % s ' field ' % s ' in ' % s ' . " , descriptor . toString ( ) , descriptor . getFieldName ( ) , <nl> - fieldDescriptions ) ) ; <nl> } <nl> <nl> private static void checkFieldTypeForDistinct ( FieldDescriptor descriptor , String fieldDescriptions ) { <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java <nl> index 1add1cc . . 619ae62 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java <nl> @ @ - 45 , 7 + 45 , 7 @ @ public class AndroidCapabilities implements Capabilities { <nl> } <nl> if ( isIntentServiceThread ) { <nl> throw new IllegalStateException ( exceptionMessage = = null ? " " : ( exceptionMessage + " " ) + <nl> - " Realm cannot be automatically updated on a IntentService thread . " ) ; <nl> + " Realm cannot be automatically updated on an IntentService thread . " ) ; <nl> } <nl> } <nl>
NEAREST DIFF (one line): diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> index 14d10c0 . . 48b9bae 100644 <nl> - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java <nl> @ @ - 31 , 7 + 31 , 6 @ @ import io . realm . rule . RunInLooperThread ; <nl> import io . realm . rule . RunTestInLooperThread ; <nl> import io . realm . rule . TestRealmConfigurationFactory ; <nl> <nl> - import static junit . framework . Assert . assertTrue ; <nl> import static junit . framework . Assert . fail ; <nl> <nl> @ RunWith ( AndroidJUnit4 . class ) <nl> @ @ - 107 , 6 + 106 , 7 @ @ public class RealmNotifierTests { <nl> / / Need a flag in java . <nl> / / assertTrue ( sharedRealm . isInTransaction ( ) ) ; <nl> looperThread . testComplete ( ) ; <nl> + sharedRealm . close ( ) ; <nl> } <nl> } ) ; <nl> sharedRealm . beginTransaction ( ) ; <nl> @ @ - 121 , 6 + 121 , 7 @ @ public class RealmNotifierTests { <nl> @ Override <nl> public void onChange ( SharedRealm sharedRealm ) { <nl> looperThread . testComplete ( ) ; <nl> + sharedRealm . close ( ) ; <nl> } <nl> } ) ; <nl> new Thread ( new Runnable ( ) { <nl> diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> index 7e7d387 . . b68db66 100644 <nl> - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp <nl> @ @ - 56 , 7 + 56 , 7 @ @ std : : vector < BindingContext : : ObserverState > JavaBindingContext : : get _ observed _ rows <nl> return state _ list ; <nl> } <nl> <nl> - void JavaBindingContext : : changes _ available ( ) <nl> + void JavaBindingContext : : before _ notify ( ) <nl> { <nl> if ( m _ java _ notifier ) { <nl> m _ java _ notifier . call _ with _ local _ ref ( [ & ] ( JNIEnv * env , jobject notifier _ obj ) { <nl> diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> index aaed72b . . 18535fc 100644 <nl> - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp <nl> @ @ - 46 , 7 + 46 , 7 @ @ private : <nl> public : <nl> virtual ~ JavaBindingContext ( ) { } ; <nl> virtual std : : vector < ObserverState > get _ observed _ rows ( ) ; <nl> - virtual void changes _ available ( ) ; <nl> + virtual void before _ notify ( ) ; <nl> virtual void did _ change ( std : : vector < ObserverState > const & observers , <nl> std : : vector < void * > const & invalidated , <nl> bool version _ changed = true ) ; <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> index 8cbc460 . . fee2390 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java <nl> @ @ - 223 , 13 + 223 , 6 @ @ public class Collection implements NativeObject { <nl> @ KeepMember <nl> @ SuppressWarnings ( " unused " ) <nl> private void notifyChangeListeners ( boolean emptyChanges ) { <nl> - / / For the stable iteration . <nl> - / / It is needed when the local commit triggered async query updates . And this is called in the next event loop <nl> - / / by OS Realm : : notify ( ) . <nl> - if ( ! emptyChanges ) { <nl> - this . disableSnapshot ( ) ; <nl> - } <nl> - <nl> if ( emptyChanges & & isDetached ( ) ) return ; <nl> observerPairs . foreach ( onChangeCallback ) ; <nl> } <nl> diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> index 5a7703e . . 93c9d57 100644 <nl> - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java <nl> @ @ - 91 , 6 + 91 , 7 @ @ public abstract class RealmNotifier implements Closeable { <nl> @ SuppressWarnings ( " unused " ) / / called from java _ binding _ context . cpp <nl> / / Package protected to avoid finding class by name in JNI . <nl> void changesAvailable ( ) { <nl> + / / For the stable iteration . <nl> sharedRealm . disableCollectionSnapshot ( ) ; <nl> } <nl>

TEST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java b / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java 
 index 15c8163 . . 9908533 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / RealmQueryTests . java 
 @ @ - 2712 , 7 + 2712 , 7 @ @ public class RealmQueryTests { 
 Realm realm = looperThread . realm ; 
 populateTestRealm ( realm , TEST _ DATA _ SIZE ) ; 
 RealmResults < AllTypes > results = realm . where ( AllTypes . class ) 
 - . findAllSorted ( AllTypes . FIELD _ REALMOBJECT + " . " + Dog . FIELD _ AGE ) ; 
 + . findAllSortedAsync ( AllTypes . FIELD _ REALMOBJECT + " . " + Dog . FIELD _ AGE ) ; 
 looperThread . keepStrongReference . add ( results ) ; 
 results . addChangeListener ( new RealmChangeListener < RealmResults < AllTypes > > ( ) { 
 @ Override 
 @ @ - 2755 , 7 + 2755 , 7 @ @ public class RealmQueryTests { 
 
 populateTestRealm ( realm , TEST _ DATA _ SIZE ) ; 
 RealmResults < AllTypes > results = realm . where ( AllTypes . class ) 
 - . findAllSorted ( fieldNames , sorts ) ; 
 + . findAllSortedAsync ( fieldNames , sorts ) ; 
 looperThread . keepStrongReference . add ( results ) ; 
 results . addChangeListener ( new RealmChangeListener < RealmResults < AllTypes > > ( ) { 
 @ Override 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 index 3fba8aa . . b7043c0 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / TypeBasedNotificationsTests . java 
 @ @ - 491 , 7 + 491 , 7 @ @ public class TypeBasedNotificationsTests { 
 dog . addChangeListener ( new RealmChangeListener < Dog > ( ) { 
 @ Override 
 public void onChange ( Dog object ) { 
 - / / Step 4 : Respond to relevant change 
 + / / Step 3 : Respond to relevant change 
 typebasedCommitInvocations . incrementAndGet ( ) ; 
 assertEquals ( " Akamaru " , dog . getName ( ) ) ; 
 assertEquals ( 17 , dog . getAge ( ) ) ; 
 diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 index 39e5507 . . bb1f9ec 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 @ @ - 189 , 14 + 189 , 6 @ @ public class RealmNotifierTests { 
 / / This should only remove the listeners related with dummyObserver 
 sharedRealm . realmNotifier . removeChangeListeners ( dummyObserver ) ; 
 
 - new Thread ( new Runnable ( ) { 
 - @ Override 
 - public void run ( ) { 
 - SharedRealm sharedRealm = getSharedRealm ( looperThread . realmConfiguration ) ; 
 - sharedRealm . beginTransaction ( ) ; 
 - sharedRealm . commitTransaction ( ) ; 
 - sharedRealm . close ( ) ; 
 - } 
 - } ) . start ( ) ; 
 + makeRemoteChanges ( looperThread . realmConfiguration ) ; 
 } 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java b / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java 
 index 94a0d2a . . 3d6b6cf 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / SortDescriptor . java 
 @ @ - 107 , 14 + 107 , 11 @ @ public class SortDescriptor { 
 } 
 
 private static void checkFieldTypeForSort ( FieldDescriptor descriptor , String fieldDescriptions ) { 
 - for ( RealmFieldType aValidFieldTypesForSort : validFieldTypesForSort ) { 
 - if ( aValidFieldTypesForSort = = descriptor . getFieldType ( ) ) { 
 - return ; 
 - } 
 + if ( ! validFieldTypesForSort . contains ( descriptor . getFieldType ( ) ) ) { 
 + throw new IllegalArgumentException ( String . format ( 
 + " Sort is not supported on ' % s ' field ' % s ' in ' % s ' . " , descriptor . toString ( ) , descriptor . getFieldName ( ) , 
 + fieldDescriptions ) ) ; 
 } 
 - throw new IllegalArgumentException ( String . format ( 
 - " Sort is not supported on ' % s ' field ' % s ' in ' % s ' . " , descriptor . toString ( ) , descriptor . getFieldName ( ) , 
 - fieldDescriptions ) ) ; 
 } 
 
 private static void checkFieldTypeForDistinct ( FieldDescriptor descriptor , String fieldDescriptions ) { 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java 
 index 1add1cc . . 619ae62 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / android / AndroidCapabilities . java 
 @ @ - 45 , 7 + 45 , 7 @ @ public class AndroidCapabilities implements Capabilities { 
 } 
 if ( isIntentServiceThread ) { 
 throw new IllegalStateException ( exceptionMessage = = null ? " " : ( exceptionMessage + " " ) + 
 - " Realm cannot be automatically updated on a IntentService thread . " ) ; 
 + " Realm cannot be automatically updated on an IntentService thread . " ) ; 
 } 
 } 


NEAREST DIFF:
diff - - git a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 index 14d10c0 . . 48b9bae 100644 
 - - - a / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 + + + b / realm / realm - library / src / androidTest / java / io / realm / internal / RealmNotifierTests . java 
 @ @ - 31 , 7 + 31 , 6 @ @ import io . realm . rule . RunInLooperThread ; 
 import io . realm . rule . RunTestInLooperThread ; 
 import io . realm . rule . TestRealmConfigurationFactory ; 
 
 - import static junit . framework . Assert . assertTrue ; 
 import static junit . framework . Assert . fail ; 
 
 @ RunWith ( AndroidJUnit4 . class ) 
 @ @ - 107 , 6 + 106 , 7 @ @ public class RealmNotifierTests { 
 / / Need a flag in java . 
 / / assertTrue ( sharedRealm . isInTransaction ( ) ) ; 
 looperThread . testComplete ( ) ; 
 + sharedRealm . close ( ) ; 
 } 
 } ) ; 
 sharedRealm . beginTransaction ( ) ; 
 @ @ - 121 , 6 + 121 , 7 @ @ public class RealmNotifierTests { 
 @ Override 
 public void onChange ( SharedRealm sharedRealm ) { 
 looperThread . testComplete ( ) ; 
 + sharedRealm . close ( ) ; 
 } 
 } ) ; 
 new Thread ( new Runnable ( ) { 
 diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 index 7e7d387 . . b68db66 100644 
 - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . cpp 
 @ @ - 56 , 7 + 56 , 7 @ @ std : : vector < BindingContext : : ObserverState > JavaBindingContext : : get _ observed _ rows 
 return state _ list ; 
 } 
 
 - void JavaBindingContext : : changes _ available ( ) 
 + void JavaBindingContext : : before _ notify ( ) 
 { 
 if ( m _ java _ notifier ) { 
 m _ java _ notifier . call _ with _ local _ ref ( [ & ] ( JNIEnv * env , jobject notifier _ obj ) { 
 diff - - git a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 index aaed72b . . 18535fc 100644 
 - - - a / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 + + + b / realm / realm - library / src / main / cpp / java _ binding _ context . hpp 
 @ @ - 46 , 7 + 46 , 7 @ @ private : 
 public : 
 virtual ~ JavaBindingContext ( ) { } ; 
 virtual std : : vector < ObserverState > get _ observed _ rows ( ) ; 
 - virtual void changes _ available ( ) ; 
 + virtual void before _ notify ( ) ; 
 virtual void did _ change ( std : : vector < ObserverState > const & observers , 
 std : : vector < void * > const & invalidated , 
 bool version _ changed = true ) ; 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / Collection . java b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 index 8cbc460 . . fee2390 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / Collection . java 
 @ @ - 223 , 13 + 223 , 6 @ @ public class Collection implements NativeObject { 
 @ KeepMember 
 @ SuppressWarnings ( " unused " ) 
 private void notifyChangeListeners ( boolean emptyChanges ) { 
 - / / For the stable iteration . 
 - / / It is needed when the local commit triggered async query updates . And this is called in the next event loop 
 - / / by OS Realm : : notify ( ) . 
 - if ( ! emptyChanges ) { 
 - this . disableSnapshot ( ) ; 
 - } 
 - 
 if ( emptyChanges & & isDetached ( ) ) return ; 
 observerPairs . foreach ( onChangeCallback ) ; 
 } 
 diff - - git a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 index 5a7703e . . 93c9d57 100644 
 - - - a / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 + + + b / realm / realm - library / src / main / java / io / realm / internal / RealmNotifier . java 
 @ @ - 91 , 6 + 91 , 7 @ @ public abstract class RealmNotifier implements Closeable { 
 @ SuppressWarnings ( " unused " ) / / called from java _ binding _ context . cpp 
 / / Package protected to avoid finding class by name in JNI . 
 void changesAvailable ( ) { 
 + / / For the stable iteration . 
 sharedRealm . disableCollectionSnapshot ( ) ; 
 } 

