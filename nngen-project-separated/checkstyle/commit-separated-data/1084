BLEU SCORE: 0.21763141204756337

TEST MSG: Issue # 3486 : clear childCount field cache in DetailAST
GENERATED MSG: Issue # 3466 : Clear branchTokenTypes field cache in DetailAST before changing its structure

TEST DIFF (one line): diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java <nl> index 5a87c9e . . 96f6960 100755 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java <nl> @ @ - 80 , 8 + 80 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> <nl> @ Override <nl> public void setFirstChild ( AST ast ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> - childCount = NOT _ INITIALIZED ; <nl> + clearBranchTokenTypes ( ) ; <nl> + clearChildCountCache ( this ) ; <nl> super . setFirstChild ( ast ) ; <nl> if ( ast ! = null ) { <nl> ( ( DetailAST ) ast ) . setParent ( this ) ; <nl> @ @ - 90 , 7 + 90 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> <nl> @ Override <nl> public void setNextSibling ( AST ast ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> + clearBranchTokenTypes ( ) ; <nl> + clearChildCountCache ( parent ) ; <nl> super . setNextSibling ( ast ) ; <nl> if ( ast ! = null & & parent ! = null ) { <nl> ( ( DetailAST ) ast ) . setParent ( parent ) ; <nl> @ @ - 106 , 7 + 107 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> * DetailAST object . <nl> * / <nl> public void addPreviousSibling ( DetailAST ast ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> + clearBranchTokenTypes ( ) ; <nl> + clearChildCountCache ( parent ) ; <nl> if ( ast ! = null ) { <nl> ast . setParent ( parent ) ; <nl> final DetailAST previousSiblingNode = previousSibling ; <nl> @ @ - 130 , 7 + 132 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> * DetailAST object . <nl> * / <nl> public void addNextSibling ( DetailAST ast ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> + clearBranchTokenTypes ( ) ; <nl> + clearChildCountCache ( parent ) ; <nl> if ( ast ! = null ) { <nl> ast . setParent ( parent ) ; <nl> final DetailAST nextSibling = getNextSibling ( ) ; <nl> @ @ - 147 , 7 + 150 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> <nl> @ Override <nl> public void addChild ( AST ast ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> + clearBranchTokenTypes ( ) ; <nl> + clearChildCountCache ( this ) ; <nl> super . addChild ( ast ) ; <nl> if ( ast ! = null ) { <nl> ( ( DetailAST ) ast ) . setParent ( this ) ; <nl> @ @ - 194 , 7 + 198 , 7 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> * @ param parent the parent token <nl> * / <nl> private void setParent ( DetailAST parent ) { <nl> - clearBranchTokenTypesCache ( ) ; <nl> + clearBranchTokenTypes ( ) ; <nl> this . parent = parent ; <nl> final DetailAST nextSibling = getNextSibling ( ) ; <nl> if ( nextSibling ! = null ) { <nl> @ @ - 402 , 9 + 406 , 20 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { <nl> } <nl> <nl> / * * <nl> - * Clears branchTokenTypes cache for all parents of the current DetailAST instance . <nl> + * Clears the child count for the ast instance . <nl> + * @ param ast The ast to clear . <nl> * / <nl> - private void clearBranchTokenTypesCache ( ) { <nl> + private static void clearChildCountCache ( DetailAST ast ) { <nl> + if ( ast ! = null ) { <nl> + ast . childCount = NOT _ INITIALIZED ; <nl> + } <nl> + } <nl> + <nl> + / * * <nl> + * Clears branchTokenTypes cache for all parents of the current DetailAST instance , and the <nl> + * child count for the current DetailAST instance . <nl> + * / <nl> + private void clearBranchTokenTypes ( ) { <nl> DetailAST prevParent = getParent ( ) ; <nl> while ( prevParent ! = null ) { <nl> prevParent . branchTokenTypes = null ; <nl> diff - - git a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> index 51fd1c2 . . 62257d4 100644 <nl> - - - a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> + + + b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> @ @ - 818 , 10 + 818 , 25 @ @ public class CheckerTest extends BaseCheckTestSupport { <nl> final int childCount = ast . getChildCount ( ) ; <nl> if ( childCount ! = METHOD _ DEF _ CHILD _ COUNT ) { <nl> final String msg = String . format ( Locale . getDefault ( ) , <nl> - " AST node has wrong number of children . Expected is % d but was % d " , <nl> + " AST node in no comment tree has wrong number of children . " <nl> + + " Expected is % d but was % d " , <nl> METHOD _ DEF _ CHILD _ COUNT , childCount ) ; <nl> log ( ast , msg ) ; <nl> } <nl> + / / count children where comment lives <nl> + int actualChildCount = 0 ; <nl> + for ( DetailAST child = ast . getFirstChild ( ) . getFirstChild ( ) ; child ! = null ; child = <nl> + child . getNextSibling ( ) ) { <nl> + actualChildCount + + ; <nl> + } <nl> + final int cacheChildCount = ast . getFirstChild ( ) . getChildCount ( ) ; <nl> + if ( cacheChildCount ! = actualChildCount ) { <nl> + final String msg = String . format ( Locale . getDefault ( ) , <nl> + " AST node with no comment has wrong number of children . " <nl> + + " Expected is % d but was % d " , <nl> + cacheChildCount , actualChildCount ) ; <nl> + log ( ast , msg ) ; <nl> + } <nl> } <nl> } <nl> <nl> @ @ - 858 , 10 + 873 , 25 @ @ public class CheckerTest extends BaseCheckTestSupport { <nl> final int childCount = ast . getChildCount ( ) ; <nl> if ( childCount ! = METHOD _ DEF _ CHILD _ COUNT ) { <nl> final String msg = String . format ( Locale . getDefault ( ) , <nl> - " AST node has wrong number of children . Expected is % d but was % d " , <nl> + " AST node in comment tree has wrong number of children . " <nl> + + " Expected is % d but was % d " , <nl> METHOD _ DEF _ CHILD _ COUNT , childCount ) ; <nl> log ( ast , msg ) ; <nl> } <nl> + / / count children where comment lives <nl> + int actualChildCount = 0 ; <nl> + for ( DetailAST child = ast . getFirstChild ( ) . getFirstChild ( ) ; child ! = null ; child = <nl> + child . getNextSibling ( ) ) { <nl> + actualChildCount + + ; <nl> + } <nl> + final int cacheChildCount = ast . getFirstChild ( ) . getChildCount ( ) ; <nl> + if ( cacheChildCount ! = actualChildCount ) { <nl> + final String msg = String . format ( Locale . getDefault ( ) , <nl> + " AST node with comment has wrong number of children . " <nl> + + " Expected is % d but was % d " , <nl> + cacheChildCount , actualChildCount ) ; <nl> + log ( ast , msg ) ; <nl> + } <nl> } <nl> } <nl> } <nl> diff - - git a / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java b / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java <nl> index ee81f26 . . 720decf 100644 <nl> - - - a / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java <nl> + + + b / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java <nl> @ @ - 2 , 10 + 2 , 11 @ @ package com . puppycrawl . tools . checkstyle . api ; <nl> <nl> public class InputClearDetailAstLazyLoadCache { <nl> <nl> - / * * <nl> + public <nl> + / * <nl> * Javadoc comment <nl> * / <nl> - public void foo ( ) { <nl> + static void foo ( ) { <nl> return ; <nl> } <nl> }
NEAREST DIFF (one line): diff - - git a / src / xdocs / writingchecks . xml b / src / xdocs / writingchecks . xml <nl> index c61d54a . . 9f1b3a3 100644 <nl> - - - a / src / xdocs / writingchecks . xml <nl> + + + b / src / xdocs / writingchecks . xml <nl> @ @ - 523 , 10 + 523 , 9 @ @ java - classpath mycompanychecks . jar ; checkstyle - $ { projectVersion } - all . jar \ <nl> < / ul > <nl> < p > <nl> This means that you cannot implement some of the code inspection <nl> - features that are available in advanced IDEs like < a <nl> - href = " http : / / www . jetbrains . com / idea / " > IntelliJ IDEA < / a > , <nl> + features that are available in advanced IDEs like Eclipse , <nl> + < a href = " http : / / www . jetbrains . com / idea / " > IntelliJ IDEA < / a > , <nl> < a href = " http : / / findbugs . sourceforge . net / " > FindBugs < / a > , <nl> - < a href = " http : / / pmd . sourceforge . net / " > PMD < / a > , <nl> < a href = " http : / / www . sonarqube . org / " > Sonarqube < / a > . <nl> < / p > <nl>

TEST DIFF:
diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java 
 index 5a87c9e . . 96f6960 100755 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / DetailAST . java 
 @ @ - 80 , 8 + 80 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 
 @ Override 
 public void setFirstChild ( AST ast ) { 
 - clearBranchTokenTypesCache ( ) ; 
 - childCount = NOT _ INITIALIZED ; 
 + clearBranchTokenTypes ( ) ; 
 + clearChildCountCache ( this ) ; 
 super . setFirstChild ( ast ) ; 
 if ( ast ! = null ) { 
 ( ( DetailAST ) ast ) . setParent ( this ) ; 
 @ @ - 90 , 7 + 90 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 
 @ Override 
 public void setNextSibling ( AST ast ) { 
 - clearBranchTokenTypesCache ( ) ; 
 + clearBranchTokenTypes ( ) ; 
 + clearChildCountCache ( parent ) ; 
 super . setNextSibling ( ast ) ; 
 if ( ast ! = null & & parent ! = null ) { 
 ( ( DetailAST ) ast ) . setParent ( parent ) ; 
 @ @ - 106 , 7 + 107 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 * DetailAST object . 
 * / 
 public void addPreviousSibling ( DetailAST ast ) { 
 - clearBranchTokenTypesCache ( ) ; 
 + clearBranchTokenTypes ( ) ; 
 + clearChildCountCache ( parent ) ; 
 if ( ast ! = null ) { 
 ast . setParent ( parent ) ; 
 final DetailAST previousSiblingNode = previousSibling ; 
 @ @ - 130 , 7 + 132 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 * DetailAST object . 
 * / 
 public void addNextSibling ( DetailAST ast ) { 
 - clearBranchTokenTypesCache ( ) ; 
 + clearBranchTokenTypes ( ) ; 
 + clearChildCountCache ( parent ) ; 
 if ( ast ! = null ) { 
 ast . setParent ( parent ) ; 
 final DetailAST nextSibling = getNextSibling ( ) ; 
 @ @ - 147 , 7 + 150 , 8 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 
 @ Override 
 public void addChild ( AST ast ) { 
 - clearBranchTokenTypesCache ( ) ; 
 + clearBranchTokenTypes ( ) ; 
 + clearChildCountCache ( this ) ; 
 super . addChild ( ast ) ; 
 if ( ast ! = null ) { 
 ( ( DetailAST ) ast ) . setParent ( this ) ; 
 @ @ - 194 , 7 + 198 , 7 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 * @ param parent the parent token 
 * / 
 private void setParent ( DetailAST parent ) { 
 - clearBranchTokenTypesCache ( ) ; 
 + clearBranchTokenTypes ( ) ; 
 this . parent = parent ; 
 final DetailAST nextSibling = getNextSibling ( ) ; 
 if ( nextSibling ! = null ) { 
 @ @ - 402 , 9 + 406 , 20 @ @ public final class DetailAST extends CommonASTWithHiddenTokens { 
 } 
 
 / * * 
 - * Clears branchTokenTypes cache for all parents of the current DetailAST instance . 
 + * Clears the child count for the ast instance . 
 + * @ param ast The ast to clear . 
 * / 
 - private void clearBranchTokenTypesCache ( ) { 
 + private static void clearChildCountCache ( DetailAST ast ) { 
 + if ( ast ! = null ) { 
 + ast . childCount = NOT _ INITIALIZED ; 
 + } 
 + } 
 + 
 + / * * 
 + * Clears branchTokenTypes cache for all parents of the current DetailAST instance , and the 
 + * child count for the current DetailAST instance . 
 + * / 
 + private void clearBranchTokenTypes ( ) { 
 DetailAST prevParent = getParent ( ) ; 
 while ( prevParent ! = null ) { 
 prevParent . branchTokenTypes = null ; 
 diff - - git a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 index 51fd1c2 . . 62257d4 100644 
 - - - a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 + + + b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 @ @ - 818 , 10 + 818 , 25 @ @ public class CheckerTest extends BaseCheckTestSupport { 
 final int childCount = ast . getChildCount ( ) ; 
 if ( childCount ! = METHOD _ DEF _ CHILD _ COUNT ) { 
 final String msg = String . format ( Locale . getDefault ( ) , 
 - " AST node has wrong number of children . Expected is % d but was % d " , 
 + " AST node in no comment tree has wrong number of children . " 
 + + " Expected is % d but was % d " , 
 METHOD _ DEF _ CHILD _ COUNT , childCount ) ; 
 log ( ast , msg ) ; 
 } 
 + / / count children where comment lives 
 + int actualChildCount = 0 ; 
 + for ( DetailAST child = ast . getFirstChild ( ) . getFirstChild ( ) ; child ! = null ; child = 
 + child . getNextSibling ( ) ) { 
 + actualChildCount + + ; 
 + } 
 + final int cacheChildCount = ast . getFirstChild ( ) . getChildCount ( ) ; 
 + if ( cacheChildCount ! = actualChildCount ) { 
 + final String msg = String . format ( Locale . getDefault ( ) , 
 + " AST node with no comment has wrong number of children . " 
 + + " Expected is % d but was % d " , 
 + cacheChildCount , actualChildCount ) ; 
 + log ( ast , msg ) ; 
 + } 
 } 
 } 
 
 @ @ - 858 , 10 + 873 , 25 @ @ public class CheckerTest extends BaseCheckTestSupport { 
 final int childCount = ast . getChildCount ( ) ; 
 if ( childCount ! = METHOD _ DEF _ CHILD _ COUNT ) { 
 final String msg = String . format ( Locale . getDefault ( ) , 
 - " AST node has wrong number of children . Expected is % d but was % d " , 
 + " AST node in comment tree has wrong number of children . " 
 + + " Expected is % d but was % d " , 
 METHOD _ DEF _ CHILD _ COUNT , childCount ) ; 
 log ( ast , msg ) ; 
 } 
 + / / count children where comment lives 
 + int actualChildCount = 0 ; 
 + for ( DetailAST child = ast . getFirstChild ( ) . getFirstChild ( ) ; child ! = null ; child = 
 + child . getNextSibling ( ) ) { 
 + actualChildCount + + ; 
 + } 
 + final int cacheChildCount = ast . getFirstChild ( ) . getChildCount ( ) ; 
 + if ( cacheChildCount ! = actualChildCount ) { 
 + final String msg = String . format ( Locale . getDefault ( ) , 
 + " AST node with comment has wrong number of children . " 
 + + " Expected is % d but was % d " , 
 + cacheChildCount , actualChildCount ) ; 
 + log ( ast , msg ) ; 
 + } 
 } 
 } 
 } 
 diff - - git a / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java b / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java 
 index ee81f26 . . 720decf 100644 
 - - - a / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java 
 + + + b / src / test / resources / com / puppycrawl / tools / checkstyle / api / InputClearDetailAstLazyLoadCache . java 
 @ @ - 2 , 10 + 2 , 11 @ @ package com . puppycrawl . tools . checkstyle . api ; 
 
 public class InputClearDetailAstLazyLoadCache { 
 
 - / * * 
 + public 
 + / * 
 * Javadoc comment 
 * / 
 - public void foo ( ) { 
 + static void foo ( ) { 
 return ; 
 } 
 }

NEAREST DIFF:
diff - - git a / src / xdocs / writingchecks . xml b / src / xdocs / writingchecks . xml 
 index c61d54a . . 9f1b3a3 100644 
 - - - a / src / xdocs / writingchecks . xml 
 + + + b / src / xdocs / writingchecks . xml 
 @ @ - 523 , 10 + 523 , 9 @ @ java - classpath mycompanychecks . jar ; checkstyle - $ { projectVersion } - all . jar \ 
 < / ul > 
 < p > 
 This means that you cannot implement some of the code inspection 
 - features that are available in advanced IDEs like < a 
 - href = " http : / / www . jetbrains . com / idea / " > IntelliJ IDEA < / a > , 
 + features that are available in advanced IDEs like Eclipse , 
 + < a href = " http : / / www . jetbrains . com / idea / " > IntelliJ IDEA < / a > , 
 < a href = " http : / / findbugs . sourceforge . net / " > FindBugs < / a > , 
 - < a href = " http : / / pmd . sourceforge . net / " > PMD < / a > , 
 < a href = " http : / / www . sonarqube . org / " > Sonarqube < / a > . 
 < / p > 

