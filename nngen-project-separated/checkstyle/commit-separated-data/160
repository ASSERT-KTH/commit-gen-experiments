BLEU SCORE: 0.6591844162499148

TEST MSG: config : bump jgit to 5 . 1 . 3 . 201810200350 - r
GENERATED MSG: config : bump jgit to 5 . 1 . 2 . 201810061102 - r

TEST DIFF (one line): diff - - git a / pom . xml b / pom . xml <nl> index 08ea0c3 . . 5cfca1d 100644 <nl> - - - a / pom . xml <nl> + + + b / pom . xml <nl> @ @ - 303 , 7 + 303 , 7 @ @ <nl> < dependency > <nl> < groupId > org . eclipse . jgit < / groupId > <nl> < artifactId > org . eclipse . jgit < / artifactId > <nl> - < version > 5 . 1 . 2 . 201810061102 - r < / version > <nl> + < version > 5 . 1 . 3 . 201810200350 - r < / version > <nl> < scope > test < / scope > <nl> < / dependency > <nl> < dependency >
NEAREST DIFF (one line): diff - - git a / config / checkstyle _ checks . xml b / config / checkstyle _ checks . xml <nl> index aad29ad . . aef3d8d 100644 <nl> - - - a / config / checkstyle _ checks . xml <nl> + + + b / config / checkstyle _ checks . xml <nl> @ @ - 121 , 7 + 121 , 7 @ @ <nl> < / module > <nl> < module name = " RegexpOnFilename " > <nl> < property name = " folderPattern " value = " [ \ \ / ] src [ \ \ / ] it [ \ \ / ] java [ \ \ / ] " / > <nl> - < property name = " fileNamePattern " value = " ^ ( ( \ w + Test ) | ( Abstract \ w + ) ) \ . java $ " / > <nl> + < property name = " fileNamePattern " value = " ^ ( ( \ w + Test ) | ( \ w + TestSupport ) | ( Abstract \ w + ) ) \ . java $ " / > <nl> < property name = " match " value = " false " / > <nl> < message key = " regexp . filepath . mismatch " <nl> value = " All files in the ' ' src / it / java ' ' folder <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java b / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java <nl> deleted file mode 100644 <nl> index 7b46628 . . 0000000 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java <nl> + + + / dev / null <nl> @ @ - 1 , 194 + 0 , 0 @ @ <nl> - / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / <nl> - / / checkstyle : Checks Java source code for adherence to a set of rules . <nl> - / / Copyright ( C ) 2001 - 2018 the original author or authors . <nl> - / / <nl> - / / This library is free software ; you can redistribute it and / or <nl> - / / modify it under the terms of the GNU Lesser General Public <nl> - / / License as published by the Free Software Foundation ; either <nl> - / / version 2 . 1 of the License , or ( at your option ) any later version . <nl> - / / <nl> - / / This library is distributed in the hope that it will be useful , <nl> - / / but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> - / / MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> - / / Lesser General Public License for more details . <nl> - / / <nl> - / / You should have received a copy of the GNU Lesser General Public <nl> - / / License along with this library ; if not , write to the Free Software <nl> - / / Foundation , Inc . , 59 Temple Place , Suite 330 , Boston , MA 02111 - 1307 USA <nl> - / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / <nl> - <nl> - package org . checkstyle . suppressionxpathfilter ; <nl> - <nl> - import static org . junit . Assert . assertEquals ; <nl> - <nl> - import java . io . File ; <nl> - import java . io . IOException ; <nl> - import java . io . Writer ; <nl> - import java . nio . charset . StandardCharsets ; <nl> - import java . nio . file . Files ; <nl> - import java . util . List ; <nl> - import java . util . Locale ; <nl> - import java . util . regex . Matcher ; <nl> - import java . util . regex . Pattern ; <nl> - import java . util . stream . Collectors ; <nl> - <nl> - import org . junit . Rule ; <nl> - import org . junit . rules . TemporaryFolder ; <nl> - <nl> - import com . google . checkstyle . test . base . AbstractModuleTestSupport ; <nl> - import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> - import com . puppycrawl . tools . checkstyle . JavaParser ; <nl> - import com . puppycrawl . tools . checkstyle . TreeWalker ; <nl> - import com . puppycrawl . tools . checkstyle . api . DetailAST ; <nl> - import com . puppycrawl . tools . checkstyle . api . FileText ; <nl> - import com . puppycrawl . tools . checkstyle . filters . SuppressionXpathFilter ; <nl> - import com . puppycrawl . tools . checkstyle . utils . CommonUtil ; <nl> - import com . puppycrawl . tools . checkstyle . xpath . XpathQueryGenerator ; <nl> - <nl> - public abstract class AbstractXpathTestSupport extends AbstractModuleTestSupport { <nl> - <nl> - private static final int DEFAULT _ TAB _ WIDTH = 4 ; <nl> - <nl> - private static final String DELIMITER = " | \ n " ; <nl> - <nl> - private static final Pattern LINE _ COLUMN _ NUMBER _ REGEX = <nl> - Pattern . compile ( " ( [ 0 - 9 ] + ) : ( [ 0 - 9 ] + ) : " ) ; <nl> - <nl> - @ Rule <nl> - public final TemporaryFolder temporaryFolder = new TemporaryFolder ( ) ; <nl> - <nl> - @ Override <nl> - protected String getPackageLocation ( ) { <nl> - return " org / checkstyle / suppressionxpathfilter " ; <nl> - } <nl> - <nl> - private static List < String > generateXpathQueries ( File fileToProcess , <nl> - ViolationPosition position ) <nl> - throws Exception { <nl> - final FileText fileText = new FileText ( fileToProcess , <nl> - StandardCharsets . UTF _ 8 . name ( ) ) ; <nl> - final DetailAST rootAst = JavaParser . parseFile ( fileToProcess , <nl> - JavaParser . Options . WITH _ COMMENTS ) ; <nl> - final XpathQueryGenerator queryGenerator = new XpathQueryGenerator ( rootAst , <nl> - position . violationLineNumber , position . violationColumnNumber , <nl> - fileText , DEFAULT _ TAB _ WIDTH ) ; <nl> - <nl> - return queryGenerator . generate ( ) ; <nl> - } <nl> - <nl> - private static void verifyXpathQueries ( List < String > generatedXpathQueries , <nl> - List < String > expectedXpathQueries ) { <nl> - assertEquals ( " Generated queries do not match expected ones " , expectedXpathQueries , <nl> - generatedXpathQueries ) ; <nl> - } <nl> - <nl> - / * * <nl> - * Returns canonical path for the file with the given check name and file name . <nl> - * @ param checkName check name . <nl> - * @ param filename file name . <nl> - * @ return canonical path for the file name . <nl> - * @ throws IOException if I / O exception occurs while forming the path . <nl> - * / <nl> - protected String getPath ( String checkName , String filename ) throws IOException { <nl> - final String subpackage = checkName . toLowerCase ( Locale . ENGLISH ) <nl> - . replace ( " check " , " " ) ; <nl> - return new File ( " src / it / resources / " + getPackageLocation ( ) <nl> - + " / " + subpackage + " / " + filename ) <nl> - . getCanonicalPath ( ) ; <nl> - } <nl> - <nl> - private String createSuppressionsXpathConfigFile ( String checkName , <nl> - List < String > xpathQueries ) <nl> - throws Exception { <nl> - <nl> - final File suppressionsXpathConfigFile = temporaryFolder . newFile ( ) ; <nl> - try ( Writer bw = Files . newBufferedWriter ( suppressionsXpathConfigFile . toPath ( ) , <nl> - StandardCharsets . UTF _ 8 ) ) { <nl> - bw . write ( " < ? xml version = \ " 1 . 0 \ " ? > \ n " ) ; <nl> - bw . write ( " < ! DOCTYPE suppressions PUBLIC \ n " ) ; <nl> - bw . write ( " \ " - / / Checkstyle / / DTD SuppressionXpathFilter " ) ; <nl> - bw . write ( " Experimental Configuration 1 . 2 / / EN \ " \ n " ) ; <nl> - bw . write ( " \ " https : / / checkstyle . org / dtds / " ) ; <nl> - bw . write ( " suppressions _ 1 _ 2 _ xpath _ experimental . dtd \ " > \ n " ) ; <nl> - bw . write ( " < suppressions > \ n " ) ; <nl> - bw . write ( " < suppress - xpath \ n " ) ; <nl> - bw . write ( " checks = \ " " ) ; <nl> - bw . write ( checkName ) ; <nl> - bw . write ( " \ " \ n " ) ; <nl> - bw . write ( " query = \ " " ) ; <nl> - bw . write ( xpathQueries . stream ( ) . collect ( Collectors . joining ( DELIMITER ) ) ) ; <nl> - bw . write ( " \ " / > \ n " ) ; <nl> - bw . write ( " < / suppressions > " ) ; <nl> - } <nl> - <nl> - return suppressionsXpathConfigFile . getPath ( ) ; <nl> - } <nl> - <nl> - private DefaultConfiguration createSuppressionXpathFilter ( String checkName , <nl> - List < String > xpathQueries ) throws Exception { <nl> - final DefaultConfiguration suppressionXpathFilterConfig = <nl> - createModuleConfig ( SuppressionXpathFilter . class ) ; <nl> - suppressionXpathFilterConfig . addAttribute ( " file " , <nl> - createSuppressionsXpathConfigFile ( checkName , xpathQueries ) ) ; <nl> - <nl> - return suppressionXpathFilterConfig ; <nl> - } <nl> - <nl> - private static ViolationPosition extractLineAndColumnNumber ( String . . . expectedViolations ) { <nl> - ViolationPosition violation = null ; <nl> - final Matcher matcher = <nl> - LINE _ COLUMN _ NUMBER _ REGEX . matcher ( expectedViolations [ 0 ] ) ; <nl> - if ( matcher . find ( ) ) { <nl> - final int violationLineNumber = Integer . parseInt ( matcher . group ( 1 ) ) ; <nl> - final int violationColumnNumber = Integer . parseInt ( matcher . group ( 2 ) ) ; <nl> - violation = new ViolationPosition ( violationLineNumber , violationColumnNumber ) ; <nl> - } <nl> - return violation ; <nl> - } <nl> - <nl> - / * * <nl> - * Runs three verifications : <nl> - * First one executes checker with defined module configuration and compares output with <nl> - * expected violations . <nl> - * Second one generates xpath queries based on violation message and compares them with expected <nl> - * xpath queries . <nl> - * Third one constructs new configuration with { @ code SuppressionXpathFilter } using generated <nl> - * xpath queries , executes checker and checks if no violation occurred . <nl> - * @ param moduleConfig module configuration . <nl> - * @ param fileToProcess input class file . <nl> - * @ param expectedViolations expected violation messages . <nl> - * @ param expectedXpathQueries expected generated xpath queries . <nl> - * @ throws Exception if an error occurs <nl> - * / <nl> - protected void runVerifications ( DefaultConfiguration moduleConfig , <nl> - File fileToProcess , <nl> - String [ ] expectedViolations , <nl> - List < String > expectedXpathQueries ) throws Exception { <nl> - final ViolationPosition position = <nl> - extractLineAndColumnNumber ( expectedViolations ) ; <nl> - final List < String > generatedXpathQueries = <nl> - generateXpathQueries ( fileToProcess , position ) ; <nl> - <nl> - final DefaultConfiguration treeWalkerConfigWithXpath = <nl> - createModuleConfig ( TreeWalker . class ) ; <nl> - treeWalkerConfigWithXpath . addChild ( moduleConfig ) ; <nl> - treeWalkerConfigWithXpath . addChild ( createSuppressionXpathFilter ( moduleConfig . getName ( ) , <nl> - generatedXpathQueries ) ) ; <nl> - <nl> - final Integer [ ] warnList = getLinesWithWarn ( fileToProcess . getPath ( ) ) ; <nl> - verify ( moduleConfig , fileToProcess . getPath ( ) , expectedViolations , warnList ) ; <nl> - verifyXpathQueries ( generatedXpathQueries , expectedXpathQueries ) ; <nl> - verify ( treeWalkerConfigWithXpath , fileToProcess . getPath ( ) , CommonUtil . EMPTY _ STRING _ ARRAY ) ; <nl> - } <nl> - <nl> - private static final class ViolationPosition { <nl> - private final int violationLineNumber ; <nl> - private final int violationColumnNumber ; <nl> - <nl> - ViolationPosition ( int violationLineNumber , <nl> - int violationColumnNumber ) { <nl> - this . violationLineNumber = violationLineNumber ; <nl> - this . violationColumnNumber = violationColumnNumber ; <nl> - } <nl> - } <nl> - } <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java <nl> index 4422123 . . 57d7abb 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . metrics . CyclomaticComplexityCheck ; <nl> <nl> - public class XpathRegressionCyclomaticComplexityTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionCyclomaticComplexityTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java <nl> index 4db0455 . . 81fe368 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . DeclarationOrderCheck ; <nl> <nl> - public class XpathRegressionDeclarationOrderTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionDeclarationOrderTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java <nl> index 009914f . . 68c0512 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java <nl> @ @ - 29 , 7 + 29 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . DefaultComesLastCheck ; <nl> <nl> - public class XpathRegressionDefaultComesLastTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionDefaultComesLastTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java <nl> index 6d56fa8 . . e1391f1 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . ExplicitInitializationCheck ; <nl> <nl> - public class XpathRegressionExplicitInitializationTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionExplicitInitializationTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java <nl> index b556cfe . . 6a2f799 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . FallThroughCheck ; <nl> <nl> - public class XpathRegressionFallThroughTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionFallThroughTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java <nl> index dc88696 . . 9a26db1 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . HiddenFieldCheck ; <nl> <nl> - public class XpathRegressionHiddenFieldTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionHiddenFieldTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java <nl> index e75f84d . . 4873a2e 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . IllegalThrowsCheck ; <nl> <nl> - public class XpathRegressionIllegalThrowsTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionIllegalThrowsTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java <nl> index 9796851 . . 4fb34a3 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . imports . ImportControlCheck ; <nl> <nl> - public class XpathRegressionImportControlTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionImportControlTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java <nl> index e922a9e . . 549c53b 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . javadoc . JavadocVariableCheck ; <nl> <nl> - public class XpathRegressionJavadocVariableTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionJavadocVariableTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java <nl> index cee0f04 . . d3f4166 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java <nl> @ @ - 30 , 7 + 30 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . blocks . LeftCurlyCheck ; <nl> import com . puppycrawl . tools . checkstyle . checks . blocks . LeftCurlyOption ; <nl> <nl> - public class XpathRegressionLeftCurlyTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionLeftCurlyTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java <nl> index 2cbfaa9 . . b2664d3 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . whitespace . MethodParamPadCheck ; <nl> <nl> - public class XpathRegressionMethodParamPadTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionMethodParamPadTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java <nl> index 43ed91b . . a9eae82 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . MultipleVariableDeclarationsCheck ; <nl> <nl> - public class XpathRegressionMultipleVariableDeclarationsTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionMultipleVariableDeclarationsTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java <nl> index 1eacb66 . . 97b66cf 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java <nl> @ @ - 30 , 7 + 30 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . metrics . NPathComplexityCheck ; <nl> <nl> / / - @ cs [ AbbreviationAsWordInName ] Test should be named as its main class . <nl> - public class XpathRegressionNPathComplexityTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionNPathComplexityTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java <nl> index dc2796d . . aa64da5 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . NestedForDepthCheck ; <nl> <nl> - public class XpathRegressionNestedForDepthTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionNestedForDepthTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testCorrect ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java <nl> index f93f4be . . cdce4a7 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . NestedIfDepthCheck ; <nl> <nl> - public class XpathRegressionNestedIfDepthTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionNestedIfDepthTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testCorrect ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java <nl> index 65963dd . . 5a79a6a 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . NestedTryDepthCheck ; <nl> <nl> - public class XpathRegressionNestedTryDepthTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionNestedTryDepthTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testCorrect ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java <nl> index d239767 . . 501dbc1 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . OneStatementPerLineCheck ; <nl> <nl> - public class XpathRegressionOneStatementPerLineTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionOneStatementPerLineTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java <nl> index 794ed2d . . dfe2a21 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . sizes . OuterTypeNumberCheck ; <nl> <nl> - public class XpathRegressionOuterTypeNumberTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionOuterTypeNumberTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java <nl> index fb434a0 . . e03a2e2 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java <nl> @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; <nl> import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . coding . RequireThisCheck ; <nl> <nl> - public class XpathRegressionRequireThisTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionRequireThisTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java <nl> index d38af95 . . 79f4387 100644 <nl> - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java <nl> @ @ - 29 , 7 + 29 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> import com . puppycrawl . tools . checkstyle . checks . blocks . RightCurlyCheck ; <nl> import com . puppycrawl . tools . checkstyle . checks . blocks . RightCurlyOption ; <nl> <nl> - public class XpathRegressionRightCurlyTest extends AbstractXpathTestSupport { <nl> + public class XpathRegressionRightCurlyTest extends XpathTestSupport { <nl> <nl> @ Test <nl> public void testOne ( ) throws Exception { <nl> diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java <nl> new file mode 100644 <nl> index 0000000 . . 5caf7cc <nl> - - - / dev / null <nl> + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java <nl> @ @ - 0 , 0 + 1 , 194 @ @ <nl> + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / <nl> + / / checkstyle : Checks Java source code for adherence to a set of rules . <nl> + / / Copyright ( C ) 2001 - 2018 the original author or authors . <nl> + / / <nl> + / / This library is free software ; you can redistribute it and / or <nl> + / / modify it under the terms of the GNU Lesser General Public <nl> + / / License as published by the Free Software Foundation ; either <nl> + / / version 2 . 1 of the License , or ( at your option ) any later version . <nl> + / / <nl> + / / This library is distributed in the hope that it will be useful , <nl> + / / but WITHOUT ANY WARRANTY ; without even the implied warranty of <nl> + / / MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU <nl> + / / Lesser General Public License for more details . <nl> + / / <nl> + / / You should have received a copy of the GNU Lesser General Public <nl> + / / License along with this library ; if not , write to the Free Software <nl> + / / Foundation , Inc . , 59 Temple Place , Suite 330 , Boston , MA 02111 - 1307 USA <nl> + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / <nl> + <nl> + package org . checkstyle . suppressionxpathfilter ; <nl> + <nl> + import static org . junit . Assert . assertEquals ; <nl> + <nl> + import java . io . File ; <nl> + import java . io . IOException ; <nl> + import java . io . Writer ; <nl> + import java . nio . charset . StandardCharsets ; <nl> + import java . nio . file . Files ; <nl> + import java . util . List ; <nl> + import java . util . Locale ; <nl> + import java . util . regex . Matcher ; <nl> + import java . util . regex . Pattern ; <nl> + import java . util . stream . Collectors ; <nl> + <nl> + import org . junit . Rule ; <nl> + import org . junit . rules . TemporaryFolder ; <nl> + <nl> + import com . google . checkstyle . test . base . AbstractModuleTestSupport ; <nl> + import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; <nl> + import com . puppycrawl . tools . checkstyle . JavaParser ; <nl> + import com . puppycrawl . tools . checkstyle . TreeWalker ; <nl> + import com . puppycrawl . tools . checkstyle . api . DetailAST ; <nl> + import com . puppycrawl . tools . checkstyle . api . FileText ; <nl> + import com . puppycrawl . tools . checkstyle . filters . SuppressionXpathFilter ; <nl> + import com . puppycrawl . tools . checkstyle . utils . CommonUtil ; <nl> + import com . puppycrawl . tools . checkstyle . xpath . XpathQueryGenerator ; <nl> + <nl> + public class XpathTestSupport extends AbstractModuleTestSupport { <nl> + <nl> + private static final int DEFAULT _ TAB _ WIDTH = 4 ; <nl> + <nl> + private static final String DELIMITER = " | \ n " ; <nl> + <nl> + private static final Pattern LINE _ COLUMN _ NUMBER _ REGEX = <nl> + Pattern . compile ( " ( [ 0 - 9 ] + ) : ( [ 0 - 9 ] + ) : " ) ; <nl> + <nl> + @ Rule <nl> + public final TemporaryFolder temporaryFolder = new TemporaryFolder ( ) ; <nl> + <nl> + @ Override <nl> + protected String getPackageLocation ( ) { <nl> + return " org / checkstyle / suppressionxpathfilter " ; <nl> + } <nl> + <nl> + private static List < String > generateXpathQueries ( File fileToProcess , <nl> + ViolationPosition position ) <nl> + throws Exception { <nl> + final FileText fileText = new FileText ( fileToProcess , <nl> + StandardCharsets . UTF _ 8 . name ( ) ) ; <nl> + final DetailAST rootAst = JavaParser . parseFile ( fileToProcess , <nl> + JavaParser . Options . WITH _ COMMENTS ) ; <nl> + final XpathQueryGenerator queryGenerator = new XpathQueryGenerator ( rootAst , <nl> + position . violationLineNumber , position . violationColumnNumber , <nl> + fileText , DEFAULT _ TAB _ WIDTH ) ; <nl> + <nl> + return queryGenerator . generate ( ) ; <nl> + } <nl> + <nl> + private static void verifyXpathQueries ( List < String > generatedXpathQueries , <nl> + List < String > expectedXpathQueries ) { <nl> + assertEquals ( " Generated queries do not match expected ones " , expectedXpathQueries , <nl> + generatedXpathQueries ) ; <nl> + } <nl> + <nl> + / * * <nl> + * Returns canonical path for the file with the given check name and file name . <nl> + * @ param checkName check name . <nl> + * @ param filename file name . <nl> + * @ return canonical path for the file name . <nl> + * @ throws IOException if I / O exception occurs while forming the path . <nl> + * / <nl> + protected String getPath ( String checkName , String filename ) throws IOException { <nl> + final String subpackage = checkName . toLowerCase ( Locale . ENGLISH ) <nl> + . replace ( " check " , " " ) ; <nl> + return new File ( " src / it / resources / " + getPackageLocation ( ) <nl> + + " / " + subpackage + " / " + filename ) <nl> + . getCanonicalPath ( ) ; <nl> + } <nl> + <nl> + private String createSuppressionsXpathConfigFile ( String checkName , <nl> + List < String > xpathQueries ) <nl> + throws Exception { <nl> + <nl> + final File suppressionsXpathConfigFile = temporaryFolder . newFile ( ) ; <nl> + try ( Writer bw = Files . newBufferedWriter ( suppressionsXpathConfigFile . toPath ( ) , <nl> + StandardCharsets . UTF _ 8 ) ) { <nl> + bw . write ( " < ? xml version = \ " 1 . 0 \ " ? > \ n " ) ; <nl> + bw . write ( " < ! DOCTYPE suppressions PUBLIC \ n " ) ; <nl> + bw . write ( " \ " - / / Checkstyle / / DTD SuppressionXpathFilter " ) ; <nl> + bw . write ( " Experimental Configuration 1 . 2 / / EN \ " \ n " ) ; <nl> + bw . write ( " \ " https : / / checkstyle . org / dtds / " ) ; <nl> + bw . write ( " suppressions _ 1 _ 2 _ xpath _ experimental . dtd \ " > \ n " ) ; <nl> + bw . write ( " < suppressions > \ n " ) ; <nl> + bw . write ( " < suppress - xpath \ n " ) ; <nl> + bw . write ( " checks = \ " " ) ; <nl> + bw . write ( checkName ) ; <nl> + bw . write ( " \ " \ n " ) ; <nl> + bw . write ( " query = \ " " ) ; <nl> + bw . write ( xpathQueries . stream ( ) . collect ( Collectors . joining ( DELIMITER ) ) ) ; <nl> + bw . write ( " \ " / > \ n " ) ; <nl> + bw . write ( " < / suppressions > " ) ; <nl> + } <nl> + <nl> + return suppressionsXpathConfigFile . getPath ( ) ; <nl> + } <nl> + <nl> + private DefaultConfiguration createSuppressionXpathFilter ( String checkName , <nl> + List < String > xpathQueries ) throws Exception { <nl> + final DefaultConfiguration suppressionXpathFilterConfig = <nl> + createModuleConfig ( SuppressionXpathFilter . class ) ; <nl> + suppressionXpathFilterConfig . addAttribute ( " file " , <nl> + createSuppressionsXpathConfigFile ( checkName , xpathQueries ) ) ; <nl> + <nl> + return suppressionXpathFilterConfig ; <nl> + } <nl> + <nl> + private static ViolationPosition extractLineAndColumnNumber ( String . . . expectedViolations ) { <nl> + ViolationPosition violation = null ; <nl> + final Matcher matcher = <nl> + LINE _ COLUMN _ NUMBER _ REGEX . matcher ( expectedViolations [ 0 ] ) ; <nl> + if ( matcher . find ( ) ) { <nl> + final int violationLineNumber = Integer . parseInt ( matcher . group ( 1 ) ) ; <nl> + final int violationColumnNumber = Integer . parseInt ( matcher . group ( 2 ) ) ; <nl> + violation = new ViolationPosition ( violationLineNumber , violationColumnNumber ) ; <nl> + } <nl> + return violation ; <nl> + } <nl> + <nl> + / * * <nl> + * Runs three verifications : <nl> + * First one executes checker with defined module configuration and compares output with <nl> + * expected violations . <nl> + * Second one generates xpath queries based on violation message and compares them with expected <nl> + * xpath queries . <nl> + * Third one constructs new configuration with { @ code SuppressionXpathFilter } using generated <nl> + * xpath queries , executes checker and checks if no violation occurred . <nl> + * @ param moduleConfig module configuration . <nl> + * @ param fileToProcess input class file . <nl> + * @ param expectedViolations expected violation messages . <nl> + * @ param expectedXpathQueries expected generated xpath queries . <nl> + * @ throws Exception if an error occurs <nl> + * / <nl> + protected void runVerifications ( DefaultConfiguration moduleConfig , <nl> + File fileToProcess , <nl> + String [ ] expectedViolations , <nl> + List < String > expectedXpathQueries ) throws Exception { <nl> + final ViolationPosition position = <nl> + extractLineAndColumnNumber ( expectedViolations ) ; <nl> + final List < String > generatedXpathQueries = <nl> + generateXpathQueries ( fileToProcess , position ) ; <nl> + <nl> + final DefaultConfiguration treeWalkerConfigWithXpath = <nl> + createModuleConfig ( TreeWalker . class ) ; <nl> + treeWalkerConfigWithXpath . addChild ( moduleConfig ) ; <nl> + treeWalkerConfigWithXpath . addChild ( createSuppressionXpathFilter ( moduleConfig . getName ( ) , <nl> + generatedXpathQueries ) ) ; <nl> + <nl> + final Integer [ ] warnList = getLinesWithWarn ( fileToProcess . getPath ( ) ) ; <nl> + verify ( moduleConfig , fileToProcess . getPath ( ) , expectedViolations , warnList ) ; <nl> + verifyXpathQueries ( generatedXpathQueries , expectedXpathQueries ) ; <nl> + verify ( treeWalkerConfigWithXpath , fileToProcess . getPath ( ) , CommonUtil . EMPTY _ STRING _ ARRAY ) ; <nl> + } <nl> + <nl> + private static final class ViolationPosition { <nl> + private final int violationLineNumber ; <nl> + private final int violationColumnNumber ; <nl> + <nl> + ViolationPosition ( int violationLineNumber , <nl> + int violationColumnNumber ) { <nl> + this . violationLineNumber = violationLineNumber ; <nl> + this . violationColumnNumber = violationColumnNumber ; <nl> + } <nl> + } <nl> + }

TEST DIFF:
diff - - git a / pom . xml b / pom . xml 
 index 08ea0c3 . . 5cfca1d 100644 
 - - - a / pom . xml 
 + + + b / pom . xml 
 @ @ - 303 , 7 + 303 , 7 @ @ 
 < dependency > 
 < groupId > org . eclipse . jgit < / groupId > 
 < artifactId > org . eclipse . jgit < / artifactId > 
 - < version > 5 . 1 . 2 . 201810061102 - r < / version > 
 + < version > 5 . 1 . 3 . 201810200350 - r < / version > 
 < scope > test < / scope > 
 < / dependency > 
 < dependency >

NEAREST DIFF:
diff - - git a / config / checkstyle _ checks . xml b / config / checkstyle _ checks . xml 
 index aad29ad . . aef3d8d 100644 
 - - - a / config / checkstyle _ checks . xml 
 + + + b / config / checkstyle _ checks . xml 
 @ @ - 121 , 7 + 121 , 7 @ @ 
 < / module > 
 < module name = " RegexpOnFilename " > 
 < property name = " folderPattern " value = " [ \ \ / ] src [ \ \ / ] it [ \ \ / ] java [ \ \ / ] " / > 
 - < property name = " fileNamePattern " value = " ^ ( ( \ w + Test ) | ( Abstract \ w + ) ) \ . java $ " / > 
 + < property name = " fileNamePattern " value = " ^ ( ( \ w + Test ) | ( \ w + TestSupport ) | ( Abstract \ w + ) ) \ . java $ " / > 
 < property name = " match " value = " false " / > 
 < message key = " regexp . filepath . mismatch " 
 value = " All files in the ' ' src / it / java ' ' folder 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java b / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java 
 deleted file mode 100644 
 index 7b46628 . . 0000000 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / AbstractXpathTestSupport . java 
 + + + / dev / null 
 @ @ - 1 , 194 + 0 , 0 @ @ 
 - / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 - / / checkstyle : Checks Java source code for adherence to a set of rules . 
 - / / Copyright ( C ) 2001 - 2018 the original author or authors . 
 - / / 
 - / / This library is free software ; you can redistribute it and / or 
 - / / modify it under the terms of the GNU Lesser General Public 
 - / / License as published by the Free Software Foundation ; either 
 - / / version 2 . 1 of the License , or ( at your option ) any later version . 
 - / / 
 - / / This library is distributed in the hope that it will be useful , 
 - / / but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 - / / MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 - / / Lesser General Public License for more details . 
 - / / 
 - / / You should have received a copy of the GNU Lesser General Public 
 - / / License along with this library ; if not , write to the Free Software 
 - / / Foundation , Inc . , 59 Temple Place , Suite 330 , Boston , MA 02111 - 1307 USA 
 - / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 - 
 - package org . checkstyle . suppressionxpathfilter ; 
 - 
 - import static org . junit . Assert . assertEquals ; 
 - 
 - import java . io . File ; 
 - import java . io . IOException ; 
 - import java . io . Writer ; 
 - import java . nio . charset . StandardCharsets ; 
 - import java . nio . file . Files ; 
 - import java . util . List ; 
 - import java . util . Locale ; 
 - import java . util . regex . Matcher ; 
 - import java . util . regex . Pattern ; 
 - import java . util . stream . Collectors ; 
 - 
 - import org . junit . Rule ; 
 - import org . junit . rules . TemporaryFolder ; 
 - 
 - import com . google . checkstyle . test . base . AbstractModuleTestSupport ; 
 - import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 - import com . puppycrawl . tools . checkstyle . JavaParser ; 
 - import com . puppycrawl . tools . checkstyle . TreeWalker ; 
 - import com . puppycrawl . tools . checkstyle . api . DetailAST ; 
 - import com . puppycrawl . tools . checkstyle . api . FileText ; 
 - import com . puppycrawl . tools . checkstyle . filters . SuppressionXpathFilter ; 
 - import com . puppycrawl . tools . checkstyle . utils . CommonUtil ; 
 - import com . puppycrawl . tools . checkstyle . xpath . XpathQueryGenerator ; 
 - 
 - public abstract class AbstractXpathTestSupport extends AbstractModuleTestSupport { 
 - 
 - private static final int DEFAULT _ TAB _ WIDTH = 4 ; 
 - 
 - private static final String DELIMITER = " | \ n " ; 
 - 
 - private static final Pattern LINE _ COLUMN _ NUMBER _ REGEX = 
 - Pattern . compile ( " ( [ 0 - 9 ] + ) : ( [ 0 - 9 ] + ) : " ) ; 
 - 
 - @ Rule 
 - public final TemporaryFolder temporaryFolder = new TemporaryFolder ( ) ; 
 - 
 - @ Override 
 - protected String getPackageLocation ( ) { 
 - return " org / checkstyle / suppressionxpathfilter " ; 
 - } 
 - 
 - private static List < String > generateXpathQueries ( File fileToProcess , 
 - ViolationPosition position ) 
 - throws Exception { 
 - final FileText fileText = new FileText ( fileToProcess , 
 - StandardCharsets . UTF _ 8 . name ( ) ) ; 
 - final DetailAST rootAst = JavaParser . parseFile ( fileToProcess , 
 - JavaParser . Options . WITH _ COMMENTS ) ; 
 - final XpathQueryGenerator queryGenerator = new XpathQueryGenerator ( rootAst , 
 - position . violationLineNumber , position . violationColumnNumber , 
 - fileText , DEFAULT _ TAB _ WIDTH ) ; 
 - 
 - return queryGenerator . generate ( ) ; 
 - } 
 - 
 - private static void verifyXpathQueries ( List < String > generatedXpathQueries , 
 - List < String > expectedXpathQueries ) { 
 - assertEquals ( " Generated queries do not match expected ones " , expectedXpathQueries , 
 - generatedXpathQueries ) ; 
 - } 
 - 
 - / * * 
 - * Returns canonical path for the file with the given check name and file name . 
 - * @ param checkName check name . 
 - * @ param filename file name . 
 - * @ return canonical path for the file name . 
 - * @ throws IOException if I / O exception occurs while forming the path . 
 - * / 
 - protected String getPath ( String checkName , String filename ) throws IOException { 
 - final String subpackage = checkName . toLowerCase ( Locale . ENGLISH ) 
 - . replace ( " check " , " " ) ; 
 - return new File ( " src / it / resources / " + getPackageLocation ( ) 
 - + " / " + subpackage + " / " + filename ) 
 - . getCanonicalPath ( ) ; 
 - } 
 - 
 - private String createSuppressionsXpathConfigFile ( String checkName , 
 - List < String > xpathQueries ) 
 - throws Exception { 
 - 
 - final File suppressionsXpathConfigFile = temporaryFolder . newFile ( ) ; 
 - try ( Writer bw = Files . newBufferedWriter ( suppressionsXpathConfigFile . toPath ( ) , 
 - StandardCharsets . UTF _ 8 ) ) { 
 - bw . write ( " < ? xml version = \ " 1 . 0 \ " ? > \ n " ) ; 
 - bw . write ( " < ! DOCTYPE suppressions PUBLIC \ n " ) ; 
 - bw . write ( " \ " - / / Checkstyle / / DTD SuppressionXpathFilter " ) ; 
 - bw . write ( " Experimental Configuration 1 . 2 / / EN \ " \ n " ) ; 
 - bw . write ( " \ " https : / / checkstyle . org / dtds / " ) ; 
 - bw . write ( " suppressions _ 1 _ 2 _ xpath _ experimental . dtd \ " > \ n " ) ; 
 - bw . write ( " < suppressions > \ n " ) ; 
 - bw . write ( " < suppress - xpath \ n " ) ; 
 - bw . write ( " checks = \ " " ) ; 
 - bw . write ( checkName ) ; 
 - bw . write ( " \ " \ n " ) ; 
 - bw . write ( " query = \ " " ) ; 
 - bw . write ( xpathQueries . stream ( ) . collect ( Collectors . joining ( DELIMITER ) ) ) ; 
 - bw . write ( " \ " / > \ n " ) ; 
 - bw . write ( " < / suppressions > " ) ; 
 - } 
 - 
 - return suppressionsXpathConfigFile . getPath ( ) ; 
 - } 
 - 
 - private DefaultConfiguration createSuppressionXpathFilter ( String checkName , 
 - List < String > xpathQueries ) throws Exception { 
 - final DefaultConfiguration suppressionXpathFilterConfig = 
 - createModuleConfig ( SuppressionXpathFilter . class ) ; 
 - suppressionXpathFilterConfig . addAttribute ( " file " , 
 - createSuppressionsXpathConfigFile ( checkName , xpathQueries ) ) ; 
 - 
 - return suppressionXpathFilterConfig ; 
 - } 
 - 
 - private static ViolationPosition extractLineAndColumnNumber ( String . . . expectedViolations ) { 
 - ViolationPosition violation = null ; 
 - final Matcher matcher = 
 - LINE _ COLUMN _ NUMBER _ REGEX . matcher ( expectedViolations [ 0 ] ) ; 
 - if ( matcher . find ( ) ) { 
 - final int violationLineNumber = Integer . parseInt ( matcher . group ( 1 ) ) ; 
 - final int violationColumnNumber = Integer . parseInt ( matcher . group ( 2 ) ) ; 
 - violation = new ViolationPosition ( violationLineNumber , violationColumnNumber ) ; 
 - } 
 - return violation ; 
 - } 
 - 
 - / * * 
 - * Runs three verifications : 
 - * First one executes checker with defined module configuration and compares output with 
 - * expected violations . 
 - * Second one generates xpath queries based on violation message and compares them with expected 
 - * xpath queries . 
 - * Third one constructs new configuration with { @ code SuppressionXpathFilter } using generated 
 - * xpath queries , executes checker and checks if no violation occurred . 
 - * @ param moduleConfig module configuration . 
 - * @ param fileToProcess input class file . 
 - * @ param expectedViolations expected violation messages . 
 - * @ param expectedXpathQueries expected generated xpath queries . 
 - * @ throws Exception if an error occurs 
 - * / 
 - protected void runVerifications ( DefaultConfiguration moduleConfig , 
 - File fileToProcess , 
 - String [ ] expectedViolations , 
 - List < String > expectedXpathQueries ) throws Exception { 
 - final ViolationPosition position = 
 - extractLineAndColumnNumber ( expectedViolations ) ; 
 - final List < String > generatedXpathQueries = 
 - generateXpathQueries ( fileToProcess , position ) ; 
 - 
 - final DefaultConfiguration treeWalkerConfigWithXpath = 
 - createModuleConfig ( TreeWalker . class ) ; 
 - treeWalkerConfigWithXpath . addChild ( moduleConfig ) ; 
 - treeWalkerConfigWithXpath . addChild ( createSuppressionXpathFilter ( moduleConfig . getName ( ) , 
 - generatedXpathQueries ) ) ; 
 - 
 - final Integer [ ] warnList = getLinesWithWarn ( fileToProcess . getPath ( ) ) ; 
 - verify ( moduleConfig , fileToProcess . getPath ( ) , expectedViolations , warnList ) ; 
 - verifyXpathQueries ( generatedXpathQueries , expectedXpathQueries ) ; 
 - verify ( treeWalkerConfigWithXpath , fileToProcess . getPath ( ) , CommonUtil . EMPTY _ STRING _ ARRAY ) ; 
 - } 
 - 
 - private static final class ViolationPosition { 
 - private final int violationLineNumber ; 
 - private final int violationColumnNumber ; 
 - 
 - ViolationPosition ( int violationLineNumber , 
 - int violationColumnNumber ) { 
 - this . violationLineNumber = violationLineNumber ; 
 - this . violationColumnNumber = violationColumnNumber ; 
 - } 
 - } 
 - } 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java 
 index 4422123 . . 57d7abb 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionCyclomaticComplexityTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . metrics . CyclomaticComplexityCheck ; 
 
 - public class XpathRegressionCyclomaticComplexityTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionCyclomaticComplexityTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java 
 index 4db0455 . . 81fe368 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDeclarationOrderTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . DeclarationOrderCheck ; 
 
 - public class XpathRegressionDeclarationOrderTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionDeclarationOrderTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java 
 index 009914f . . 68c0512 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionDefaultComesLastTest . java 
 @ @ - 29 , 7 + 29 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . DefaultComesLastCheck ; 
 
 - public class XpathRegressionDefaultComesLastTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionDefaultComesLastTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java 
 index 6d56fa8 . . e1391f1 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionExplicitInitializationTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . ExplicitInitializationCheck ; 
 
 - public class XpathRegressionExplicitInitializationTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionExplicitInitializationTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java 
 index b556cfe . . 6a2f799 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionFallThroughTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . FallThroughCheck ; 
 
 - public class XpathRegressionFallThroughTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionFallThroughTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java 
 index dc88696 . . 9a26db1 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionHiddenFieldTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . HiddenFieldCheck ; 
 
 - public class XpathRegressionHiddenFieldTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionHiddenFieldTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java 
 index e75f84d . . 4873a2e 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionIllegalThrowsTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . IllegalThrowsCheck ; 
 
 - public class XpathRegressionIllegalThrowsTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionIllegalThrowsTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java 
 index 9796851 . . 4fb34a3 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionImportControlTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . imports . ImportControlCheck ; 
 
 - public class XpathRegressionImportControlTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionImportControlTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java 
 index e922a9e . . 549c53b 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionJavadocVariableTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . javadoc . JavadocVariableCheck ; 
 
 - public class XpathRegressionJavadocVariableTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionJavadocVariableTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java 
 index cee0f04 . . d3f4166 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionLeftCurlyTest . java 
 @ @ - 30 , 7 + 30 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . blocks . LeftCurlyCheck ; 
 import com . puppycrawl . tools . checkstyle . checks . blocks . LeftCurlyOption ; 
 
 - public class XpathRegressionLeftCurlyTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionLeftCurlyTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java 
 index 2cbfaa9 . . b2664d3 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMethodParamPadTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . whitespace . MethodParamPadCheck ; 
 
 - public class XpathRegressionMethodParamPadTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionMethodParamPadTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java 
 index 43ed91b . . a9eae82 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionMultipleVariableDeclarationsTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . MultipleVariableDeclarationsCheck ; 
 
 - public class XpathRegressionMultipleVariableDeclarationsTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionMultipleVariableDeclarationsTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java 
 index 1eacb66 . . 97b66cf 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNPathComplexityTest . java 
 @ @ - 30 , 7 + 30 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . metrics . NPathComplexityCheck ; 
 
 / / - @ cs [ AbbreviationAsWordInName ] Test should be named as its main class . 
 - public class XpathRegressionNPathComplexityTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionNPathComplexityTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java 
 index dc2796d . . aa64da5 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedForDepthTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . NestedForDepthCheck ; 
 
 - public class XpathRegressionNestedForDepthTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionNestedForDepthTest extends XpathTestSupport { 
 
 @ Test 
 public void testCorrect ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java 
 index f93f4be . . cdce4a7 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedIfDepthTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . NestedIfDepthCheck ; 
 
 - public class XpathRegressionNestedIfDepthTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionNestedIfDepthTest extends XpathTestSupport { 
 
 @ Test 
 public void testCorrect ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java 
 index 65963dd . . 5a79a6a 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionNestedTryDepthTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . NestedTryDepthCheck ; 
 
 - public class XpathRegressionNestedTryDepthTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionNestedTryDepthTest extends XpathTestSupport { 
 
 @ Test 
 public void testCorrect ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java 
 index d239767 . . 501dbc1 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOneStatementPerLineTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . OneStatementPerLineCheck ; 
 
 - public class XpathRegressionOneStatementPerLineTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionOneStatementPerLineTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java 
 index 794ed2d . . dfe2a21 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionOuterTypeNumberTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . sizes . OuterTypeNumberCheck ; 
 
 - public class XpathRegressionOuterTypeNumberTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionOuterTypeNumberTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java 
 index fb434a0 . . e03a2e2 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRequireThisTest . java 
 @ @ - 28 , 7 + 28 , 7 @ @ import org . junit . Test ; 
 import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . coding . RequireThisCheck ; 
 
 - public class XpathRegressionRequireThisTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionRequireThisTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java 
 index d38af95 . . 79f4387 100644 
 - - - a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathRegressionRightCurlyTest . java 
 @ @ - 29 , 7 + 29 , 7 @ @ import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 import com . puppycrawl . tools . checkstyle . checks . blocks . RightCurlyCheck ; 
 import com . puppycrawl . tools . checkstyle . checks . blocks . RightCurlyOption ; 
 
 - public class XpathRegressionRightCurlyTest extends AbstractXpathTestSupport { 
 + public class XpathRegressionRightCurlyTest extends XpathTestSupport { 
 
 @ Test 
 public void testOne ( ) throws Exception { 
 diff - - git a / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java 
 new file mode 100644 
 index 0000000 . . 5caf7cc 
 - - - / dev / null 
 + + + b / src / it / java / org / checkstyle / suppressionxpathfilter / XpathTestSupport . java 
 @ @ - 0 , 0 + 1 , 194 @ @ 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + / / checkstyle : Checks Java source code for adherence to a set of rules . 
 + / / Copyright ( C ) 2001 - 2018 the original author or authors . 
 + / / 
 + / / This library is free software ; you can redistribute it and / or 
 + / / modify it under the terms of the GNU Lesser General Public 
 + / / License as published by the Free Software Foundation ; either 
 + / / version 2 . 1 of the License , or ( at your option ) any later version . 
 + / / 
 + / / This library is distributed in the hope that it will be useful , 
 + / / but WITHOUT ANY WARRANTY ; without even the implied warranty of 
 + / / MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE . See the GNU 
 + / / Lesser General Public License for more details . 
 + / / 
 + / / You should have received a copy of the GNU Lesser General Public 
 + / / License along with this library ; if not , write to the Free Software 
 + / / Foundation , Inc . , 59 Temple Place , Suite 330 , Boston , MA 02111 - 1307 USA 
 + / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / / 
 + 
 + package org . checkstyle . suppressionxpathfilter ; 
 + 
 + import static org . junit . Assert . assertEquals ; 
 + 
 + import java . io . File ; 
 + import java . io . IOException ; 
 + import java . io . Writer ; 
 + import java . nio . charset . StandardCharsets ; 
 + import java . nio . file . Files ; 
 + import java . util . List ; 
 + import java . util . Locale ; 
 + import java . util . regex . Matcher ; 
 + import java . util . regex . Pattern ; 
 + import java . util . stream . Collectors ; 
 + 
 + import org . junit . Rule ; 
 + import org . junit . rules . TemporaryFolder ; 
 + 
 + import com . google . checkstyle . test . base . AbstractModuleTestSupport ; 
 + import com . puppycrawl . tools . checkstyle . DefaultConfiguration ; 
 + import com . puppycrawl . tools . checkstyle . JavaParser ; 
 + import com . puppycrawl . tools . checkstyle . TreeWalker ; 
 + import com . puppycrawl . tools . checkstyle . api . DetailAST ; 
 + import com . puppycrawl . tools . checkstyle . api . FileText ; 
 + import com . puppycrawl . tools . checkstyle . filters . SuppressionXpathFilter ; 
 + import com . puppycrawl . tools . checkstyle . utils . CommonUtil ; 
 + import com . puppycrawl . tools . checkstyle . xpath . XpathQueryGenerator ; 
 + 
 + public class XpathTestSupport extends AbstractModuleTestSupport { 
 + 
 + private static final int DEFAULT _ TAB _ WIDTH = 4 ; 
 + 
 + private static final String DELIMITER = " | \ n " ; 
 + 
 + private static final Pattern LINE _ COLUMN _ NUMBER _ REGEX = 
 + Pattern . compile ( " ( [ 0 - 9 ] + ) : ( [ 0 - 9 ] + ) : " ) ; 
 + 
 + @ Rule 
 + public final TemporaryFolder temporaryFolder = new TemporaryFolder ( ) ; 
 + 
 + @ Override 
 + protected String getPackageLocation ( ) { 
 + return " org / checkstyle / suppressionxpathfilter " ; 
 + } 
 + 
 + private static List < String > generateXpathQueries ( File fileToProcess , 
 + ViolationPosition position ) 
 + throws Exception { 
 + final FileText fileText = new FileText ( fileToProcess , 
 + StandardCharsets . UTF _ 8 . name ( ) ) ; 
 + final DetailAST rootAst = JavaParser . parseFile ( fileToProcess , 
 + JavaParser . Options . WITH _ COMMENTS ) ; 
 + final XpathQueryGenerator queryGenerator = new XpathQueryGenerator ( rootAst , 
 + position . violationLineNumber , position . violationColumnNumber , 
 + fileText , DEFAULT _ TAB _ WIDTH ) ; 
 + 
 + return queryGenerator . generate ( ) ; 
 + } 
 + 
 + private static void verifyXpathQueries ( List < String > generatedXpathQueries , 
 + List < String > expectedXpathQueries ) { 
 + assertEquals ( " Generated queries do not match expected ones " , expectedXpathQueries , 
 + generatedXpathQueries ) ; 
 + } 
 + 
 + / * * 
 + * Returns canonical path for the file with the given check name and file name . 
 + * @ param checkName check name . 
 + * @ param filename file name . 
 + * @ return canonical path for the file name . 
 + * @ throws IOException if I / O exception occurs while forming the path . 
 + * / 
 + protected String getPath ( String checkName , String filename ) throws IOException { 
 + final String subpackage = checkName . toLowerCase ( Locale . ENGLISH ) 
 + . replace ( " check " , " " ) ; 
 + return new File ( " src / it / resources / " + getPackageLocation ( ) 
 + + " / " + subpackage + " / " + filename ) 
 + . getCanonicalPath ( ) ; 
 + } 
 + 
 + private String createSuppressionsXpathConfigFile ( String checkName , 
 + List < String > xpathQueries ) 
 + throws Exception { 
 + 
 + final File suppressionsXpathConfigFile = temporaryFolder . newFile ( ) ; 
 + try ( Writer bw = Files . newBufferedWriter ( suppressionsXpathConfigFile . toPath ( ) , 
 + StandardCharsets . UTF _ 8 ) ) { 
 + bw . write ( " < ? xml version = \ " 1 . 0 \ " ? > \ n " ) ; 
 + bw . write ( " < ! DOCTYPE suppressions PUBLIC \ n " ) ; 
 + bw . write ( " \ " - / / Checkstyle / / DTD SuppressionXpathFilter " ) ; 
 + bw . write ( " Experimental Configuration 1 . 2 / / EN \ " \ n " ) ; 
 + bw . write ( " \ " https : / / checkstyle . org / dtds / " ) ; 
 + bw . write ( " suppressions _ 1 _ 2 _ xpath _ experimental . dtd \ " > \ n " ) ; 
 + bw . write ( " < suppressions > \ n " ) ; 
 + bw . write ( " < suppress - xpath \ n " ) ; 
 + bw . write ( " checks = \ " " ) ; 
 + bw . write ( checkName ) ; 
 + bw . write ( " \ " \ n " ) ; 
 + bw . write ( " query = \ " " ) ; 
 + bw . write ( xpathQueries . stream ( ) . collect ( Collectors . joining ( DELIMITER ) ) ) ; 
 + bw . write ( " \ " / > \ n " ) ; 
 + bw . write ( " < / suppressions > " ) ; 
 + } 
 + 
 + return suppressionsXpathConfigFile . getPath ( ) ; 
 + } 
 + 
 + private DefaultConfiguration createSuppressionXpathFilter ( String checkName , 
 + List < String > xpathQueries ) throws Exception { 
 + final DefaultConfiguration suppressionXpathFilterConfig = 
 + createModuleConfig ( SuppressionXpathFilter . class ) ; 
 + suppressionXpathFilterConfig . addAttribute ( " file " , 
 + createSuppressionsXpathConfigFile ( checkName , xpathQueries ) ) ; 
 + 
 + return suppressionXpathFilterConfig ; 
 + } 
 + 
 + private static ViolationPosition extractLineAndColumnNumber ( String . . . expectedViolations ) { 
 + ViolationPosition violation = null ; 
 + final Matcher matcher = 
 + LINE _ COLUMN _ NUMBER _ REGEX . matcher ( expectedViolations [ 0 ] ) ; 
 + if ( matcher . find ( ) ) { 
 + final int violationLineNumber = Integer . parseInt ( matcher . group ( 1 ) ) ; 
 + final int violationColumnNumber = Integer . parseInt ( matcher . group ( 2 ) ) ; 
 + violation = new ViolationPosition ( violationLineNumber , violationColumnNumber ) ; 
 + } 
 + return violation ; 
 + } 
 + 
 + / * * 
 + * Runs three verifications : 
 + * First one executes checker with defined module configuration and compares output with 
 + * expected violations . 
 + * Second one generates xpath queries based on violation message and compares them with expected 
 + * xpath queries . 
 + * Third one constructs new configuration with { @ code SuppressionXpathFilter } using generated 
 + * xpath queries , executes checker and checks if no violation occurred . 
 + * @ param moduleConfig module configuration . 
 + * @ param fileToProcess input class file . 
 + * @ param expectedViolations expected violation messages . 
 + * @ param expectedXpathQueries expected generated xpath queries . 
 + * @ throws Exception if an error occurs 
 + * / 
 + protected void runVerifications ( DefaultConfiguration moduleConfig , 
 + File fileToProcess , 
 + String [ ] expectedViolations , 
 + List < String > expectedXpathQueries ) throws Exception { 
 + final ViolationPosition position = 
 + extractLineAndColumnNumber ( expectedViolations ) ; 
 + final List < String > generatedXpathQueries = 
 + generateXpathQueries ( fileToProcess , position ) ; 
 + 
 + final DefaultConfiguration treeWalkerConfigWithXpath = 
 + createModuleConfig ( TreeWalker . class ) ; 
 + treeWalkerConfigWithXpath . addChild ( moduleConfig ) ; 
 + treeWalkerConfigWithXpath . addChild ( createSuppressionXpathFilter ( moduleConfig . getName ( ) , 
 + generatedXpathQueries ) ) ; 
 + 
 + final Integer [ ] warnList = getLinesWithWarn ( fileToProcess . getPath ( ) ) ; 
 + verify ( moduleConfig , fileToProcess . getPath ( ) , expectedViolations , warnList ) ; 
 + verifyXpathQueries ( generatedXpathQueries , expectedXpathQueries ) ; 
 + verify ( treeWalkerConfigWithXpath , fileToProcess . getPath ( ) , CommonUtil . EMPTY _ STRING _ ARRAY ) ; 
 + } 
 + 
 + private static final class ViolationPosition { 
 + private final int violationLineNumber ; 
 + private final int violationColumnNumber ; 
 + 
 + ViolationPosition ( int violationLineNumber , 
 + int violationColumnNumber ) { 
 + this . violationLineNumber = violationLineNumber ; 
 + this . violationColumnNumber = violationColumnNumber ; 
 + } 
 + } 
 + }
