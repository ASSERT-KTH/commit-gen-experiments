BLEU SCORE: 0.0567967744513558

TEST MSG: Issue # 3488 : save files into cache with no un - suppressed violations
GENERATED MSG: Issue # 26 SuppressionCommentFilter does not suppress StrictDuplicateCode Warnings

TEST DIFF (one line): diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java b / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java <nl> index 396d91e . . 7b50f2a 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java <nl> @ @ - 271 , 13 + 271 , 13 @ @ public class Checker extends AutomaticBean implements MessageDispatcher , RootMod <nl> | | ! acceptFileStarted ( fileName ) ) { <nl> continue ; <nl> } <nl> + if ( cache ! = null ) { <nl> + cache . put ( fileName , timestamp ) ; <nl> + } <nl> fireFileStarted ( fileName ) ; <nl> final SortedSet < LocalizedMessage > fileMessages = processFile ( file ) ; <nl> fireErrors ( fileName , fileMessages ) ; <nl> fireFileFinished ( fileName ) ; <nl> - if ( cache ! = null & & fileMessages . isEmpty ( ) ) { <nl> - cache . put ( fileName , timestamp ) ; <nl> - } <nl> } <nl> / / - @ cs [ IllegalCatch ] There is no other way to deliver filename that was under <nl> / / processing . See https : / / github . com / checkstyle / checkstyle / issues / 2285 <nl> @ @ - 352 , 14 + 352 , 19 @ @ public class Checker extends AutomaticBean implements MessageDispatcher , RootMod <nl> @ Override <nl> public void fireErrors ( String fileName , SortedSet < LocalizedMessage > errors ) { <nl> final String stripped = CommonUtils . relativizeAndNormalizePath ( basedir , fileName ) ; <nl> + boolean hasNonFilteredViolations = false ; <nl> for ( final LocalizedMessage element : errors ) { <nl> final AuditEvent event = new AuditEvent ( this , stripped , element ) ; <nl> if ( filters . accept ( event ) ) { <nl> + hasNonFilteredViolations = true ; <nl> for ( final AuditListener listener : listeners ) { <nl> listener . addError ( event ) ; <nl> } <nl> } <nl> } <nl> + if ( hasNonFilteredViolations & & cache ! = null ) { <nl> + cache . remove ( fileName ) ; <nl> + } <nl> } <nl> <nl> / * * <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java b / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java <nl> index 4d998f3 . . 9fcd550 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java <nl> @ @ - 201 , 6 + 201 , 14 @ @ final class PropertyCacheFile { <nl> } <nl> <nl> / * * <nl> + * Removed a specific file from the cache . <nl> + * @ param checkedFileName The name of the file to remove . <nl> + * / <nl> + public void remove ( String checkedFileName ) { <nl> + details . remove ( checkedFileName ) ; <nl> + } <nl> + <nl> + / * * <nl> * Calculates the hashcode for the serializable object based on its content . <nl> * @ param object serializable object . <nl> * @ return the hashcode for serializable object . <nl> diff - - git a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> index 607a3b3 . . b2a29cc 100644 <nl> - - - a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> + + + b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java <nl> @ @ - 22 , 12 + 22 , 14 @ @ package com . puppycrawl . tools . checkstyle ; <nl> import static org . hamcrest . CoreMatchers . instanceOf ; <nl> import static org . junit . Assert . assertEquals ; <nl> import static org . junit . Assert . assertFalse ; <nl> + import static org . junit . Assert . assertNotNull ; <nl> import static org . junit . Assert . assertThat ; <nl> import static org . junit . Assert . assertTrue ; <nl> import static org . junit . Assert . fail ; <nl> import static org . mockito . Mockito . when ; <nl> <nl> import java . io . File ; <nl> + import java . io . FileInputStream ; <nl> import java . io . IOError ; <nl> import java . io . IOException ; <nl> import java . io . UnsupportedEncodingException ; <nl> @ @ - 36 , 6 + 38 , 7 @ @ import java . util . ArrayList ; <nl> import java . util . HashSet ; <nl> import java . util . List ; <nl> import java . util . Locale ; <nl> + import java . util . Properties ; <nl> import java . util . Set ; <nl> import java . util . SortedSet ; <nl> import java . util . TreeSet ; <nl> @ @ - 740 , 6 + 743 , 38 @ @ public class CheckerTest extends BaseCheckTestSupport { <nl> verify ( checker , filePath , filePath , expected ) ; <nl> } <nl> <nl> + @ Test <nl> + public void testCacheOnViolationSuppression ( ) throws Exception { <nl> + final File cacheFile = temporaryFolder . newFile ( ) ; <nl> + final DefaultConfiguration violationCheck = <nl> + createCheckConfig ( DummyFileSetViolationCheck . class ) ; <nl> + final DefaultConfiguration defaultConfig = new DefaultConfiguration ( " defaultConfiguration " ) ; <nl> + defaultConfig . addAttribute ( " cacheFile " , cacheFile . getPath ( ) ) ; <nl> + defaultConfig . addChild ( violationCheck ) ; <nl> + <nl> + final DefaultConfiguration filterConfig = createCheckConfig ( SuppressionFilter . class ) ; <nl> + filterConfig . addAttribute ( " file " , getPath ( " suppress _ all . xml " ) ) ; <nl> + defaultConfig . addChild ( filterConfig ) ; <nl> + <nl> + final Checker checker = new Checker ( ) ; <nl> + checker . setModuleClassLoader ( Thread . currentThread ( ) . getContextClassLoader ( ) ) ; <nl> + checker . addListener ( new BriefUtLogger ( stream ) ) ; <nl> + checker . configure ( defaultConfig ) ; <nl> + <nl> + final String fileViolationPath = temporaryFolder . newFile ( " ViolationFile . java " ) . getPath ( ) ; <nl> + final String [ ] expected = CommonUtils . EMPTY _ STRING _ ARRAY ; <nl> + <nl> + verify ( checker , fileViolationPath , expected ) ; <nl> + <nl> + try ( FileInputStream input = new FileInputStream ( cacheFile ) ) { <nl> + final Properties details = new Properties ( ) ; <nl> + details . load ( input ) ; <nl> + <nl> + assertNotNull ( " suppressed violation file saved in cache " , <nl> + details . getProperty ( fileViolationPath ) ) ; <nl> + } <nl> + } <nl> + <nl> private Checker createMockCheckerWithCacheForModule ( <nl> Class < ? extends ExternalResourceHolder > mockClass ) throws IOException , CheckstyleException { <nl> <nl> @ @ - 778 , 6 + 813 , 22 @ @ public class CheckerTest extends BaseCheckTestSupport { <nl> } <nl> } <nl> <nl> + private static class DummyFileSetViolationCheck extends AbstractFileSetCheck <nl> + implements ExternalResourceHolder { <nl> + <nl> + @ Override <nl> + protected void processFiltered ( File file , List < String > lines ) throws CheckstyleException { <nl> + log ( 0 , " test " ) ; <nl> + } <nl> + <nl> + @ Override <nl> + public Set < String > getExternalResourceLocations ( ) { <nl> + final Set < String > externalResourceLocation = new HashSet < > ( 1 ) ; <nl> + externalResourceLocation . add ( " non _ existing _ external _ resource . xml " ) ; <nl> + return externalResourceLocation ; <nl> + } <nl> + } <nl> + <nl> private static class MockMissingExternalResourcesFileSetCheck extends AbstractFileSetCheck <nl> implements ExternalResourceHolder { <nl> <nl> diff - - git a / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml b / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml <nl> new file mode 100644 <nl> index 0000000 . . 8e75cc9 <nl> - - - / dev / null <nl> + + + b / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml <nl> @ @ - 0 , 0 + 1 , 9 @ @ <nl> + < ? xml version = " 1 . 0 " ? > <nl> + <nl> + < ! DOCTYPE suppressions PUBLIC <nl> + " - / / Puppy Crawl / / DTD Suppressions 1 . 1 / / EN " <nl> + " http : / / www . puppycrawl . com / dtds / suppressions _ 1 _ 1 . dtd " > <nl> + <nl> + < suppressions > <nl> + < suppress checks = " . " files = " . " / > <nl> + < / suppressions >
NEAREST DIFF (one line): diff - - git a / config / checkstyle _ checks . xml b / config / checkstyle _ checks . xml <nl> index 347afc8 . . 2caf5c2 100644 <nl> - - - a / config / checkstyle _ checks . xml <nl> + + + b / config / checkstyle _ checks . xml <nl> @ @ - 57 , 7 + 57 , 9 @ @ <nl> <nl> < module name = " AvoidStarImport " / > <nl> < module name = " ConstantName " / > <nl> - < module name = " EmptyBlock " / > <nl> + < module name = " EmptyBlock " > <nl> + < property name = " option " value = " text " / > <nl> + < / module > <nl> < module name = " EmptyForIteratorPad " / > <nl> < module name = " EqualsHashCode " / > <nl> < module name = " OneStatementPerLine " / > <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java b / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java <nl> index 5d00478 . . 612f55f 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java <nl> @ @ - 193 , 7 + 193 , 6 @ @ public final class ConfigurationLoader <nl> } <nl> catch ( final CheckstyleException e ) { <nl> / / severity not set - > ignore <nl> - ; <nl> } <nl> <nl> / / omit this module if these should be omitted and the module <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java b / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java <nl> index 5378933 . . 2078a64 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java <nl> @ @ - 80 , 7 + 80 , 7 @ @ class PackageObjectFactory implements ModuleFactory <nl> return createObject ( name ) ; <nl> } <nl> catch ( final CheckstyleException ex ) { <nl> - ; / / keep looking <nl> + / / keep looking <nl> } <nl> <nl> / / now try packages <nl> @ @ - 91 , 7 + 91 , 7 @ @ class PackageObjectFactory implements ModuleFactory <nl> return createObject ( className ) ; <nl> } <nl> catch ( final CheckstyleException ex ) { <nl> - ; / / keep looking <nl> + / / keep looking <nl> } <nl> } <nl> <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java <nl> index 8fce990 . . 4676590 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java <nl> @ @ - 639 , 6 + 639 , 6 @ @ public enum JavadocTagInfo <nl> BLOCK , <nl> <nl> / * * inline type . * * / <nl> - INLINE ; <nl> + INLINE <nl> } <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java <nl> index f3e0000 . . 1afc0c2 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java <nl> @ @ - 284 , 7 + 284 , 7 @ @ public final class Utils <nl> shutting . close ( ) ; <nl> } <nl> catch ( IOException e ) { <nl> - ; / / ignore <nl> + / / ignore <nl> } <nl> } <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java <nl> index 5ca2b11 . . 84ee956 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java <nl> @ @ - 46 , 5 + 46 , 5 @ @ public enum BlockOption <nl> * } <nl> * < / pre > <nl> * / <nl> - STMT ; <nl> + STMT <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java <nl> index ccace32 . . f7feb42 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java <nl> @ @ - 307 , 7 + 307 , 7 @ @ public class LeftCurlyCheck <nl> if ( braceLine . length ( ) > brace . getColumnNo ( ) + 1 <nl> & & braceLine . charAt ( brace . getColumnNo ( ) + 1 ) = = ' } ' ) <nl> { <nl> - ; / / ignore <nl> + / / ignore <nl> } <nl> else if ( getAbstractOption ( ) = = LeftCurlyOption . NL ) { <nl> if ( ! Utils . whitespaceBefore ( brace . getColumnNo ( ) , braceLine ) ) { <nl> @ @ - 328 , 7 + 328 , 7 @ @ public class LeftCurlyCheck <nl> } <nl> else if ( getAbstractOption ( ) = = LeftCurlyOption . NLOW ) { <nl> if ( startToken . getLineNo ( ) = = brace . getLineNo ( ) ) { <nl> - ; / / all ok as on the same line <nl> + / / all ok as on the same line <nl> } <nl> else if ( startToken . getLineNo ( ) + 1 = = brace . getLineNo ( ) ) { <nl> if ( ! Utils . whitespaceBefore ( brace . getColumnNo ( ) , braceLine ) ) { <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java <nl> index 5437dcb . . b7e2b1f 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java <nl> @ @ - 69 , 5 + 69 , 5 @ @ public enum LeftCurlyOption <nl> * . . . <nl> * < / pre > <nl> * / <nl> - NL ; <nl> + NL <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java <nl> index 7c548d3 . . 8feaa0c 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java <nl> @ @ - 48 , 5 + 48 , 5 @ @ public enum RightCurlyOption <nl> * } finally { <nl> * < / pre > <nl> * * / <nl> - SAME ; <nl> + SAME <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java <nl> index 9f9377d . . f1f6ec5 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java <nl> @ @ - 267 , 7 + 267 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check <nl> if ( ignoreFinal & & modifiers . branchContains ( TokenTypes . FINAL ) <nl> | | parentType = = TokenTypes . OBJBLOCK ) <nl> { <nl> - ; / / no code <nl> + / / no code <nl> } <nl> else { <nl> final DetailAST variable = ast . findFirstToken ( TokenTypes . IDENT ) ; <nl> @ @ - 593 , 7 + 593 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check <nl> else if ( currentNodeType = = TokenTypes . VARIABLE _ DEF <nl> | | currentNodeType = = TokenTypes . EXPR ) <nl> { <nl> - ; / / no code <nl> + / / no code <nl> } <nl> else { <nl> firstNodeInsideBlock = currentNode ; <nl> @ @ - 856 , 7 + 856 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check <nl> break ; <nl> <nl> default : <nl> - ; / / no code <nl> + / / no code <nl> } <nl> } <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java <nl> index a4f5205 . . 0d823f8 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java <nl> @ @ - 102 , 5 + 102 , 5 @ @ public enum ImportOrderOption <nl> import static javax . swing . WindowConstants . * ; <nl> * < / pre > <nl> * / <nl> - BOTTOM ; <nl> + BOTTOM <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java <nl> index 4d898d4 . . 061b0cf 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java <nl> @ @ - 195 , 7 + 195 , 7 @ @ public final class JavadocUtils <nl> / * * inline type . * / <nl> INLINE , <nl> / * * all validTags . * / <nl> - ALL ; <nl> + ALL <nl> } <nl> <nl> / * * <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java <nl> index 7606553 . . d82c8ab 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java <nl> @ @ - 119 , 7 + 119 , 7 @ @ public final class MethodCountCheck extends Check <nl> { <nl> return total ; <nl> } <nl> - } ; <nl> + } <nl> <nl> / * * default maximum number of methods * / <nl> private static final int DEFAULT _ MAX _ METHODS = 100 ; <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java <nl> index cf72d39 . . 93e315c 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java <nl> @ @ - 37 , 5 + 37 , 5 @ @ public enum PadOption <nl> * Represents mandatory spacing following a left parenthesis <nl> * and preceeing a right one . <nl> * / <nl> - SPACE ; <nl> + SPACE <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java <nl> index 8bfcf69 . . 31874fa 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java <nl> @ @ - 28 , 5 + 28 , 5 @ @ public enum WrapOption <nl> / * * Require that the token is on a new line . * / <nl> NL , <nl> / * * Require that the token is at the end of the line . * / <nl> - EOL ; <nl> + EOL <nl> } <nl> diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java b / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java <nl> index 2f4cd2f . . 724108a 100644 <nl> - - - a / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java <nl> + + + b / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java <nl> @ @ - 453 , 7 + 453 , 7 @ @ public class SuppressionCommentFilter <nl> if ( tag . isMatch ( event ) ) { <nl> result = tag ; <nl> } <nl> - } ; <nl> + } <nl> return result ; <nl> } <nl>

TEST DIFF:
diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java b / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java 
 index 396d91e . . 7b50f2a 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / Checker . java 
 @ @ - 271 , 13 + 271 , 13 @ @ public class Checker extends AutomaticBean implements MessageDispatcher , RootMod 
 | | ! acceptFileStarted ( fileName ) ) { 
 continue ; 
 } 
 + if ( cache ! = null ) { 
 + cache . put ( fileName , timestamp ) ; 
 + } 
 fireFileStarted ( fileName ) ; 
 final SortedSet < LocalizedMessage > fileMessages = processFile ( file ) ; 
 fireErrors ( fileName , fileMessages ) ; 
 fireFileFinished ( fileName ) ; 
 - if ( cache ! = null & & fileMessages . isEmpty ( ) ) { 
 - cache . put ( fileName , timestamp ) ; 
 - } 
 } 
 / / - @ cs [ IllegalCatch ] There is no other way to deliver filename that was under 
 / / processing . See https : / / github . com / checkstyle / checkstyle / issues / 2285 
 @ @ - 352 , 14 + 352 , 19 @ @ public class Checker extends AutomaticBean implements MessageDispatcher , RootMod 
 @ Override 
 public void fireErrors ( String fileName , SortedSet < LocalizedMessage > errors ) { 
 final String stripped = CommonUtils . relativizeAndNormalizePath ( basedir , fileName ) ; 
 + boolean hasNonFilteredViolations = false ; 
 for ( final LocalizedMessage element : errors ) { 
 final AuditEvent event = new AuditEvent ( this , stripped , element ) ; 
 if ( filters . accept ( event ) ) { 
 + hasNonFilteredViolations = true ; 
 for ( final AuditListener listener : listeners ) { 
 listener . addError ( event ) ; 
 } 
 } 
 } 
 + if ( hasNonFilteredViolations & & cache ! = null ) { 
 + cache . remove ( fileName ) ; 
 + } 
 } 
 
 / * * 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java b / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java 
 index 4d998f3 . . 9fcd550 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / PropertyCacheFile . java 
 @ @ - 201 , 6 + 201 , 14 @ @ final class PropertyCacheFile { 
 } 
 
 / * * 
 + * Removed a specific file from the cache . 
 + * @ param checkedFileName The name of the file to remove . 
 + * / 
 + public void remove ( String checkedFileName ) { 
 + details . remove ( checkedFileName ) ; 
 + } 
 + 
 + / * * 
 * Calculates the hashcode for the serializable object based on its content . 
 * @ param object serializable object . 
 * @ return the hashcode for serializable object . 
 diff - - git a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 index 607a3b3 . . b2a29cc 100644 
 - - - a / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 + + + b / src / test / java / com / puppycrawl / tools / checkstyle / CheckerTest . java 
 @ @ - 22 , 12 + 22 , 14 @ @ package com . puppycrawl . tools . checkstyle ; 
 import static org . hamcrest . CoreMatchers . instanceOf ; 
 import static org . junit . Assert . assertEquals ; 
 import static org . junit . Assert . assertFalse ; 
 + import static org . junit . Assert . assertNotNull ; 
 import static org . junit . Assert . assertThat ; 
 import static org . junit . Assert . assertTrue ; 
 import static org . junit . Assert . fail ; 
 import static org . mockito . Mockito . when ; 
 
 import java . io . File ; 
 + import java . io . FileInputStream ; 
 import java . io . IOError ; 
 import java . io . IOException ; 
 import java . io . UnsupportedEncodingException ; 
 @ @ - 36 , 6 + 38 , 7 @ @ import java . util . ArrayList ; 
 import java . util . HashSet ; 
 import java . util . List ; 
 import java . util . Locale ; 
 + import java . util . Properties ; 
 import java . util . Set ; 
 import java . util . SortedSet ; 
 import java . util . TreeSet ; 
 @ @ - 740 , 6 + 743 , 38 @ @ public class CheckerTest extends BaseCheckTestSupport { 
 verify ( checker , filePath , filePath , expected ) ; 
 } 
 
 + @ Test 
 + public void testCacheOnViolationSuppression ( ) throws Exception { 
 + final File cacheFile = temporaryFolder . newFile ( ) ; 
 + final DefaultConfiguration violationCheck = 
 + createCheckConfig ( DummyFileSetViolationCheck . class ) ; 
 + final DefaultConfiguration defaultConfig = new DefaultConfiguration ( " defaultConfiguration " ) ; 
 + defaultConfig . addAttribute ( " cacheFile " , cacheFile . getPath ( ) ) ; 
 + defaultConfig . addChild ( violationCheck ) ; 
 + 
 + final DefaultConfiguration filterConfig = createCheckConfig ( SuppressionFilter . class ) ; 
 + filterConfig . addAttribute ( " file " , getPath ( " suppress _ all . xml " ) ) ; 
 + defaultConfig . addChild ( filterConfig ) ; 
 + 
 + final Checker checker = new Checker ( ) ; 
 + checker . setModuleClassLoader ( Thread . currentThread ( ) . getContextClassLoader ( ) ) ; 
 + checker . addListener ( new BriefUtLogger ( stream ) ) ; 
 + checker . configure ( defaultConfig ) ; 
 + 
 + final String fileViolationPath = temporaryFolder . newFile ( " ViolationFile . java " ) . getPath ( ) ; 
 + final String [ ] expected = CommonUtils . EMPTY _ STRING _ ARRAY ; 
 + 
 + verify ( checker , fileViolationPath , expected ) ; 
 + 
 + try ( FileInputStream input = new FileInputStream ( cacheFile ) ) { 
 + final Properties details = new Properties ( ) ; 
 + details . load ( input ) ; 
 + 
 + assertNotNull ( " suppressed violation file saved in cache " , 
 + details . getProperty ( fileViolationPath ) ) ; 
 + } 
 + } 
 + 
 private Checker createMockCheckerWithCacheForModule ( 
 Class < ? extends ExternalResourceHolder > mockClass ) throws IOException , CheckstyleException { 
 
 @ @ - 778 , 6 + 813 , 22 @ @ public class CheckerTest extends BaseCheckTestSupport { 
 } 
 } 
 
 + private static class DummyFileSetViolationCheck extends AbstractFileSetCheck 
 + implements ExternalResourceHolder { 
 + 
 + @ Override 
 + protected void processFiltered ( File file , List < String > lines ) throws CheckstyleException { 
 + log ( 0 , " test " ) ; 
 + } 
 + 
 + @ Override 
 + public Set < String > getExternalResourceLocations ( ) { 
 + final Set < String > externalResourceLocation = new HashSet < > ( 1 ) ; 
 + externalResourceLocation . add ( " non _ existing _ external _ resource . xml " ) ; 
 + return externalResourceLocation ; 
 + } 
 + } 
 + 
 private static class MockMissingExternalResourcesFileSetCheck extends AbstractFileSetCheck 
 implements ExternalResourceHolder { 
 
 diff - - git a / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml b / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml 
 new file mode 100644 
 index 0000000 . . 8e75cc9 
 - - - / dev / null 
 + + + b / src / test / resources / com / puppycrawl / tools / checkstyle / suppress _ all . xml 
 @ @ - 0 , 0 + 1 , 9 @ @ 
 + < ? xml version = " 1 . 0 " ? > 
 + 
 + < ! DOCTYPE suppressions PUBLIC 
 + " - / / Puppy Crawl / / DTD Suppressions 1 . 1 / / EN " 
 + " http : / / www . puppycrawl . com / dtds / suppressions _ 1 _ 1 . dtd " > 
 + 
 + < suppressions > 
 + < suppress checks = " . " files = " . " / > 
 + < / suppressions >

NEAREST DIFF:
diff - - git a / config / checkstyle _ checks . xml b / config / checkstyle _ checks . xml 
 index 347afc8 . . 2caf5c2 100644 
 - - - a / config / checkstyle _ checks . xml 
 + + + b / config / checkstyle _ checks . xml 
 @ @ - 57 , 7 + 57 , 9 @ @ 
 
 < module name = " AvoidStarImport " / > 
 < module name = " ConstantName " / > 
 - < module name = " EmptyBlock " / > 
 + < module name = " EmptyBlock " > 
 + < property name = " option " value = " text " / > 
 + < / module > 
 < module name = " EmptyForIteratorPad " / > 
 < module name = " EqualsHashCode " / > 
 < module name = " OneStatementPerLine " / > 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java b / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java 
 index 5d00478 . . 612f55f 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / ConfigurationLoader . java 
 @ @ - 193 , 7 + 193 , 6 @ @ public final class ConfigurationLoader 
 } 
 catch ( final CheckstyleException e ) { 
 / / severity not set - > ignore 
 - ; 
 } 
 
 / / omit this module if these should be omitted and the module 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java b / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java 
 index 5378933 . . 2078a64 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / PackageObjectFactory . java 
 @ @ - 80 , 7 + 80 , 7 @ @ class PackageObjectFactory implements ModuleFactory 
 return createObject ( name ) ; 
 } 
 catch ( final CheckstyleException ex ) { 
 - ; / / keep looking 
 + / / keep looking 
 } 
 
 / / now try packages 
 @ @ - 91 , 7 + 91 , 7 @ @ class PackageObjectFactory implements ModuleFactory 
 return createObject ( className ) ; 
 } 
 catch ( final CheckstyleException ex ) { 
 - ; / / keep looking 
 + / / keep looking 
 } 
 } 
 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java 
 index 8fce990 . . 4676590 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / JavadocTagInfo . java 
 @ @ - 639 , 6 + 639 , 6 @ @ public enum JavadocTagInfo 
 BLOCK , 
 
 / * * inline type . * * / 
 - INLINE ; 
 + INLINE 
 } 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java b / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java 
 index f3e0000 . . 1afc0c2 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / api / Utils . java 
 @ @ - 284 , 7 + 284 , 7 @ @ public final class Utils 
 shutting . close ( ) ; 
 } 
 catch ( IOException e ) { 
 - ; / / ignore 
 + / / ignore 
 } 
 } 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java 
 index 5ca2b11 . . 84ee956 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / BlockOption . java 
 @ @ - 46 , 5 + 46 , 5 @ @ public enum BlockOption 
 * } 
 * < / pre > 
 * / 
 - STMT ; 
 + STMT 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java 
 index ccace32 . . f7feb42 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyCheck . java 
 @ @ - 307 , 7 + 307 , 7 @ @ public class LeftCurlyCheck 
 if ( braceLine . length ( ) > brace . getColumnNo ( ) + 1 
 & & braceLine . charAt ( brace . getColumnNo ( ) + 1 ) = = ' } ' ) 
 { 
 - ; / / ignore 
 + / / ignore 
 } 
 else if ( getAbstractOption ( ) = = LeftCurlyOption . NL ) { 
 if ( ! Utils . whitespaceBefore ( brace . getColumnNo ( ) , braceLine ) ) { 
 @ @ - 328 , 7 + 328 , 7 @ @ public class LeftCurlyCheck 
 } 
 else if ( getAbstractOption ( ) = = LeftCurlyOption . NLOW ) { 
 if ( startToken . getLineNo ( ) = = brace . getLineNo ( ) ) { 
 - ; / / all ok as on the same line 
 + / / all ok as on the same line 
 } 
 else if ( startToken . getLineNo ( ) + 1 = = brace . getLineNo ( ) ) { 
 if ( ! Utils . whitespaceBefore ( brace . getColumnNo ( ) , braceLine ) ) { 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java 
 index 5437dcb . . b7e2b1f 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / LeftCurlyOption . java 
 @ @ - 69 , 5 + 69 , 5 @ @ public enum LeftCurlyOption 
 * . . . 
 * < / pre > 
 * / 
 - NL ; 
 + NL 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java 
 index 7c548d3 . . 8feaa0c 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / blocks / RightCurlyOption . java 
 @ @ - 48 , 5 + 48 , 5 @ @ public enum RightCurlyOption 
 * } finally { 
 * < / pre > 
 * * / 
 - SAME ; 
 + SAME 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java 
 index 9f9377d . . f1f6ec5 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / coding / VariableDeclarationUsageDistanceCheck . java 
 @ @ - 267 , 7 + 267 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check 
 if ( ignoreFinal & & modifiers . branchContains ( TokenTypes . FINAL ) 
 | | parentType = = TokenTypes . OBJBLOCK ) 
 { 
 - ; / / no code 
 + / / no code 
 } 
 else { 
 final DetailAST variable = ast . findFirstToken ( TokenTypes . IDENT ) ; 
 @ @ - 593 , 7 + 593 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check 
 else if ( currentNodeType = = TokenTypes . VARIABLE _ DEF 
 | | currentNodeType = = TokenTypes . EXPR ) 
 { 
 - ; / / no code 
 + / / no code 
 } 
 else { 
 firstNodeInsideBlock = currentNode ; 
 @ @ - 856 , 7 + 856 , 7 @ @ public class VariableDeclarationUsageDistanceCheck extends Check 
 break ; 
 
 default : 
 - ; / / no code 
 + / / no code 
 } 
 } 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java 
 index a4f5205 . . 0d823f8 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / imports / ImportOrderOption . java 
 @ @ - 102 , 5 + 102 , 5 @ @ public enum ImportOrderOption 
 import static javax . swing . WindowConstants . * ; 
 * < / pre > 
 * / 
 - BOTTOM ; 
 + BOTTOM 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java 
 index 4d898d4 . . 061b0cf 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / javadoc / JavadocUtils . java 
 @ @ - 195 , 7 + 195 , 7 @ @ public final class JavadocUtils 
 / * * inline type . * / 
 INLINE , 
 / * * all validTags . * / 
 - ALL ; 
 + ALL 
 } 
 
 / * * 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java 
 index 7606553 . . d82c8ab 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / sizes / MethodCountCheck . java 
 @ @ - 119 , 7 + 119 , 7 @ @ public final class MethodCountCheck extends Check 
 { 
 return total ; 
 } 
 - } ; 
 + } 
 
 / * * default maximum number of methods * / 
 private static final int DEFAULT _ MAX _ METHODS = 100 ; 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java 
 index cf72d39 . . 93e315c 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / PadOption . java 
 @ @ - 37 , 5 + 37 , 5 @ @ public enum PadOption 
 * Represents mandatory spacing following a left parenthesis 
 * and preceeing a right one . 
 * / 
 - SPACE ; 
 + SPACE 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java 
 index 8bfcf69 . . 31874fa 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / checks / whitespace / WrapOption . java 
 @ @ - 28 , 5 + 28 , 5 @ @ public enum WrapOption 
 / * * Require that the token is on a new line . * / 
 NL , 
 / * * Require that the token is at the end of the line . * / 
 - EOL ; 
 + EOL 
 } 
 diff - - git a / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java b / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java 
 index 2f4cd2f . . 724108a 100644 
 - - - a / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java 
 + + + b / src / main / java / com / puppycrawl / tools / checkstyle / filters / SuppressionCommentFilter . java 
 @ @ - 453 , 7 + 453 , 7 @ @ public class SuppressionCommentFilter 
 if ( tag . isMatch ( event ) ) { 
 result = tag ; 
 } 
 - } ; 
 + } 
 return result ; 
 } 

