BLEU SCORE: 0.16233395773754944

TEST MSG: moved watch service to watcher factory
GENERATED MSG: introduced abstract watcher factory

TEST DIFF (one line): diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java <nl> index 66a3028 . . 1730216 100644 <nl> - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java <nl> + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java <nl> @ @ - 11 , 7 + 11 , 8 @ @ public class Java7Watcher implements Watcher { <nl> private final Function < File , Void > listener ; <nl> private final File file ; <nl> <nl> - public Java7Watcher ( final Function < File , Void > listener , final File file ) { <nl> + public Java7Watcher ( WatcherService service , final Function < File , Void > listener , final File file ) { <nl> + this . service = service ; <nl> this . listener = listener ; <nl> this . file = file ; <nl> } <nl> @ @ - 19 , 10 + 20 , 6 @ @ public class Java7Watcher implements Watcher { <nl> @ Override <nl> public synchronized void start ( ) { <nl> try { <nl> - if ( ! service . isRunning ( ) ) { <nl> - service . start ( ) ; <nl> - } <nl> - <nl> service . register ( file , listener ) ; <nl> } catch ( IOException e ) { <nl> throw new MocoException ( e ) ; <nl> diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java <nl> index 1b8a978 . . dd803de 100644 <nl> - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java <nl> + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java <nl> @ @ - 1 , 12 + 1 , 24 @ @ <nl> package com . github . dreamhead . moco . runner . watcher ; <nl> <nl> + import com . github . dreamhead . moco . MocoException ; <nl> import com . google . common . base . Function ; <nl> <nl> import java . io . File ; <nl> + import java . io . IOException ; <nl> <nl> import static com . google . common . collect . FluentIterable . from ; <nl> <nl> public class Java7WatcherFactory implements FileWatcherFactory { <nl> + private WatcherService service = new WatcherService ( ) ; <nl> + <nl> + public Java7WatcherFactory ( ) { <nl> + try { <nl> + this . service . start ( ) ; <nl> + } catch ( IOException e ) { <nl> + throw new MocoException ( e ) ; <nl> + } <nl> + } <nl> + <nl> @ Override <nl> public Watcher createWatcher ( final Function < File , Void > listener , final File . . . files ) { <nl> if ( files . length = = 0 ) { <nl> @ @ - 16 , 7 + 28 , 7 @ @ public class Java7WatcherFactory implements FileWatcherFactory { <nl> return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { <nl> @ Override <nl> public Watcher apply ( final File file ) { <nl> - return new Java7Watcher ( listener , file ) ; <nl> + return new Java7Watcher ( service , listener , file ) ; <nl> } <nl> } ) ) ; <nl> }
NEAREST DIFF (one line): diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java <nl> new file mode 100644 <nl> index 0000000 . . 413be88 <nl> - - - / dev / null <nl> + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java <nl> @ @ - 0 , 0 + 1 , 33 @ @ <nl> + package com . github . dreamhead . moco . runner . watcher ; <nl> + <nl> + import com . github . dreamhead . moco . runner . FileRunner ; <nl> + import com . google . common . base . Function ; <nl> + <nl> + import java . io . File ; <nl> + <nl> + import static com . google . common . collect . FluentIterable . from ; <nl> + <nl> + public abstract class AbstractWatcherFactory implements FileWatcherFactory { <nl> + protected abstract Watcher doCreate ( final FileRunner fileRunner , final File file ) ; <nl> + <nl> + public Watcher createWatcher ( final FileRunner fileRunner , final File . . . files ) { <nl> + if ( files . length = = 0 ) { <nl> + throw new IllegalArgumentException ( " No file is specified " ) ; <nl> + } <nl> + <nl> + if ( files . length = = 1 ) { <nl> + return doCreate ( fileRunner , files [ 0 ] ) ; <nl> + } <nl> + <nl> + return doCreate ( fileRunner , files ) ; <nl> + } <nl> + <nl> + private Watcher doCreate ( final FileRunner fileRunner , File [ ] files ) { <nl> + return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { <nl> + @ Override <nl> + public Watcher apply ( final File file ) { <nl> + return doCreate ( fileRunner , file ) ; <nl> + } <nl> + } ) ) ; <nl> + } <nl> + } <nl> diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java <nl> index f533e49 . . 15f5aaf 100644 <nl> - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java <nl> + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java <nl> @ @ - 1 , 7 + 1 , 6 @ @ <nl> package com . github . dreamhead . moco . runner . watcher ; <nl> <nl> import com . github . dreamhead . moco . runner . FileRunner ; <nl> - import com . google . common . base . Function ; <nl> import org . apache . commons . io . monitor . FileAlterationListener ; <nl> import org . apache . commons . io . monitor . FileAlterationListenerAdaptor ; <nl> import org . apache . commons . io . monitor . FileAlterationMonitor ; <nl> @ @ - 13 , 37 + 12 , 12 @ @ import java . io . File ; <nl> import java . io . FileFilter ; <nl> <nl> import static com . github . dreamhead . moco . runner . watcher . ThreadSafeRunnerWatcher . INTERVAL ; <nl> - import static com . google . common . collect . FluentIterable . from ; <nl> <nl> - public class CommonsIoWatcherFactory implements FileWatcherFactory { <nl> + public class CommonsIoWatcherFactory extends AbstractWatcherFactory { <nl> private static Logger logger = LoggerFactory . getLogger ( CommonsIoWatcherFactory . class ) ; <nl> <nl> - @ Override <nl> - public Watcher createWatcher ( final FileRunner fileRunner , final File . . . files ) { <nl> - if ( files . length = = 0 ) { <nl> - throw new IllegalArgumentException ( " No file is specified " ) ; <nl> - } <nl> - <nl> - FileAlterationListener listener = createListener ( fileRunner ) ; <nl> - if ( files . length = = 1 ) { <nl> - File file = files [ 0 ] ; <nl> - return createWatcher ( file , listener ) ; <nl> - } <nl> - <nl> - return createFilesWatcher ( files , listener ) ; <nl> - } <nl> - <nl> - private Watcher createWatcher ( final File file , final FileAlterationListener listener ) { <nl> - return new ThreadSafeRunnerWatcher ( new CommonsIoWatcher ( monitorFile ( file , listener ) ) ) ; <nl> - } <nl> - <nl> - private Watcher createFilesWatcher ( final File [ ] files , final FileAlterationListener listener ) { <nl> - return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { <nl> - @ Override <nl> - public Watcher apply ( final File file ) { <nl> - return createWatcher ( file , listener ) ; <nl> - } <nl> - } ) ) ; <nl> + protected Watcher doCreate ( final FileRunner fileRunner , final File file ) { <nl> + return new ThreadSafeRunnerWatcher ( new CommonsIoWatcher ( monitorFile ( file , createListener ( fileRunner ) ) ) ) ; <nl> } <nl> <nl> private FileAlterationListener createListener ( final FileRunner fileRunner ) { <nl> diff - - git a / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java b / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java <nl> index 13e5cc4 . . cc8a2d8 100644 <nl> - - - a / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java <nl> + + + b / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java <nl> @ @ - 1 , 6 + 1 , 5 @ @ <nl> package com . github . dreamhead . moco . runner ; <nl> <nl> - import com . github . dreamhead . moco . util . Idles ; <nl> import org . apache . commons . io . FilenameUtils ; <nl> import org . junit . Rule ; <nl> import org . junit . Test ; <nl> @ @ - 10 , 7 + 9 , 6 @ @ import java . io . ByteArrayOutputStream ; <nl> import java . io . File ; <nl> import java . io . IOException ; <nl> import java . io . PrintStream ; <nl> - import java . util . concurrent . TimeUnit ; <nl> <nl> import static com . github . dreamhead . moco . bootstrap . arg . HttpArgs . httpArgs ; <nl> import static com . github . dreamhead . moco . helper . RemoteTestUtils . port ;

TEST DIFF:
diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java 
 index 66a3028 . . 1730216 100644 
 - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java 
 + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7Watcher . java 
 @ @ - 11 , 7 + 11 , 8 @ @ public class Java7Watcher implements Watcher { 
 private final Function < File , Void > listener ; 
 private final File file ; 
 
 - public Java7Watcher ( final Function < File , Void > listener , final File file ) { 
 + public Java7Watcher ( WatcherService service , final Function < File , Void > listener , final File file ) { 
 + this . service = service ; 
 this . listener = listener ; 
 this . file = file ; 
 } 
 @ @ - 19 , 10 + 20 , 6 @ @ public class Java7Watcher implements Watcher { 
 @ Override 
 public synchronized void start ( ) { 
 try { 
 - if ( ! service . isRunning ( ) ) { 
 - service . start ( ) ; 
 - } 
 - 
 service . register ( file , listener ) ; 
 } catch ( IOException e ) { 
 throw new MocoException ( e ) ; 
 diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java 
 index 1b8a978 . . dd803de 100644 
 - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java 
 + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / Java7WatcherFactory . java 
 @ @ - 1 , 12 + 1 , 24 @ @ 
 package com . github . dreamhead . moco . runner . watcher ; 
 
 + import com . github . dreamhead . moco . MocoException ; 
 import com . google . common . base . Function ; 
 
 import java . io . File ; 
 + import java . io . IOException ; 
 
 import static com . google . common . collect . FluentIterable . from ; 
 
 public class Java7WatcherFactory implements FileWatcherFactory { 
 + private WatcherService service = new WatcherService ( ) ; 
 + 
 + public Java7WatcherFactory ( ) { 
 + try { 
 + this . service . start ( ) ; 
 + } catch ( IOException e ) { 
 + throw new MocoException ( e ) ; 
 + } 
 + } 
 + 
 @ Override 
 public Watcher createWatcher ( final Function < File , Void > listener , final File . . . files ) { 
 if ( files . length = = 0 ) { 
 @ @ - 16 , 7 + 28 , 7 @ @ public class Java7WatcherFactory implements FileWatcherFactory { 
 return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { 
 @ Override 
 public Watcher apply ( final File file ) { 
 - return new Java7Watcher ( listener , file ) ; 
 + return new Java7Watcher ( service , listener , file ) ; 
 } 
 } ) ) ; 
 }

NEAREST DIFF:
diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java 
 new file mode 100644 
 index 0000000 . . 413be88 
 - - - / dev / null 
 + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / AbstractWatcherFactory . java 
 @ @ - 0 , 0 + 1 , 33 @ @ 
 + package com . github . dreamhead . moco . runner . watcher ; 
 + 
 + import com . github . dreamhead . moco . runner . FileRunner ; 
 + import com . google . common . base . Function ; 
 + 
 + import java . io . File ; 
 + 
 + import static com . google . common . collect . FluentIterable . from ; 
 + 
 + public abstract class AbstractWatcherFactory implements FileWatcherFactory { 
 + protected abstract Watcher doCreate ( final FileRunner fileRunner , final File file ) ; 
 + 
 + public Watcher createWatcher ( final FileRunner fileRunner , final File . . . files ) { 
 + if ( files . length = = 0 ) { 
 + throw new IllegalArgumentException ( " No file is specified " ) ; 
 + } 
 + 
 + if ( files . length = = 1 ) { 
 + return doCreate ( fileRunner , files [ 0 ] ) ; 
 + } 
 + 
 + return doCreate ( fileRunner , files ) ; 
 + } 
 + 
 + private Watcher doCreate ( final FileRunner fileRunner , File [ ] files ) { 
 + return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { 
 + @ Override 
 + public Watcher apply ( final File file ) { 
 + return doCreate ( fileRunner , file ) ; 
 + } 
 + } ) ) ; 
 + } 
 + } 
 diff - - git a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java 
 index f533e49 . . 15f5aaf 100644 
 - - - a / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java 
 + + + b / moco - runner / src / main / java / com / github / dreamhead / moco / runner / watcher / CommonsIoWatcherFactory . java 
 @ @ - 1 , 7 + 1 , 6 @ @ 
 package com . github . dreamhead . moco . runner . watcher ; 
 
 import com . github . dreamhead . moco . runner . FileRunner ; 
 - import com . google . common . base . Function ; 
 import org . apache . commons . io . monitor . FileAlterationListener ; 
 import org . apache . commons . io . monitor . FileAlterationListenerAdaptor ; 
 import org . apache . commons . io . monitor . FileAlterationMonitor ; 
 @ @ - 13 , 37 + 12 , 12 @ @ import java . io . File ; 
 import java . io . FileFilter ; 
 
 import static com . github . dreamhead . moco . runner . watcher . ThreadSafeRunnerWatcher . INTERVAL ; 
 - import static com . google . common . collect . FluentIterable . from ; 
 
 - public class CommonsIoWatcherFactory implements FileWatcherFactory { 
 + public class CommonsIoWatcherFactory extends AbstractWatcherFactory { 
 private static Logger logger = LoggerFactory . getLogger ( CommonsIoWatcherFactory . class ) ; 
 
 - @ Override 
 - public Watcher createWatcher ( final FileRunner fileRunner , final File . . . files ) { 
 - if ( files . length = = 0 ) { 
 - throw new IllegalArgumentException ( " No file is specified " ) ; 
 - } 
 - 
 - FileAlterationListener listener = createListener ( fileRunner ) ; 
 - if ( files . length = = 1 ) { 
 - File file = files [ 0 ] ; 
 - return createWatcher ( file , listener ) ; 
 - } 
 - 
 - return createFilesWatcher ( files , listener ) ; 
 - } 
 - 
 - private Watcher createWatcher ( final File file , final FileAlterationListener listener ) { 
 - return new ThreadSafeRunnerWatcher ( new CommonsIoWatcher ( monitorFile ( file , listener ) ) ) ; 
 - } 
 - 
 - private Watcher createFilesWatcher ( final File [ ] files , final FileAlterationListener listener ) { 
 - return new CompositeWatcher ( from ( files ) . transform ( new Function < File , Watcher > ( ) { 
 - @ Override 
 - public Watcher apply ( final File file ) { 
 - return createWatcher ( file , listener ) ; 
 - } 
 - } ) ) ; 
 + protected Watcher doCreate ( final FileRunner fileRunner , final File file ) { 
 + return new ThreadSafeRunnerWatcher ( new CommonsIoWatcher ( monitorFile ( file , createListener ( fileRunner ) ) ) ) ; 
 } 
 
 private FileAlterationListener createListener ( final FileRunner fileRunner ) { 
 diff - - git a / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java b / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java 
 index 13e5cc4 . . cc8a2d8 100644 
 - - - a / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java 
 + + + b / moco - runner / src / test / java / com / github / dreamhead / moco / runner / DynamicSettingRunnerTest . java 
 @ @ - 1 , 6 + 1 , 5 @ @ 
 package com . github . dreamhead . moco . runner ; 
 
 - import com . github . dreamhead . moco . util . Idles ; 
 import org . apache . commons . io . FilenameUtils ; 
 import org . junit . Rule ; 
 import org . junit . Test ; 
 @ @ - 10 , 7 + 9 , 6 @ @ import java . io . ByteArrayOutputStream ; 
 import java . io . File ; 
 import java . io . IOException ; 
 import java . io . PrintStream ; 
 - import java . util . concurrent . TimeUnit ; 
 
 import static com . github . dreamhead . moco . bootstrap . arg . HttpArgs . httpArgs ; 
 import static com . github . dreamhead . moco . helper . RemoteTestUtils . port ;
