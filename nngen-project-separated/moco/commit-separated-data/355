BLEU SCORE: 0.06567274736060397

TEST MSG: used standard cookie spec for http client
GENERATED MSG: Returned no content for head request

TEST DIFF (one line): diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java b / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java <nl> index 3f54ae4 . . 10d3b64 100644 <nl> - - - a / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java <nl> + + + b / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java <nl> @ @ - 138 , 14 + 138 , 14 @ @ public class MocoWebTest extends AbstractMocoHttpTest { <nl> @ Test <nl> public void should _ set _ and _ recognize _ cookie _ with _ domain ( ) throws Exception { <nl> server . request ( eq ( cookie ( " loggedIn " ) , " true " ) ) . response ( status ( 200 ) ) ; <nl> - server . response ( cookie ( " loggedIn " , " true " , domain ( " github . com " ) ) , status ( 302 ) ) ; <nl> + server . response ( cookie ( " loggedIn " , " true " , domain ( " localhost " ) ) , status ( 302 ) ) ; <nl> running ( server , new Runnable ( ) { <nl> @ Override <nl> public void run ( ) throws IOException { <nl> org . apache . http . HttpResponse response = helper . getResponse ( root ( ) ) ; <nl> String value = response . getFirstHeader ( HttpHeaders . SET _ COOKIE ) . getValue ( ) ; <nl> Cookie decodeCookie = ClientCookieDecoder . STRICT . decode ( value ) ; <nl> - assertThat ( decodeCookie . domain ( ) , is ( " github . com " ) ) ; <nl> + assertThat ( decodeCookie . domain ( ) , is ( " localhost " ) ) ; <nl> } <nl> } ) ; <nl> } <nl> diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java b / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java <nl> index b54af9e . . d110713 100644 <nl> - - - a / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java <nl> + + + b / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java <nl> @ @ - 4 , 6 + 4 , 8 @ @ import com . google . common . collect . ImmutableMultimap ; <nl> import com . google . common . io . Resources ; <nl> import org . apache . http . HttpResponse ; <nl> import org . apache . http . HttpVersion ; <nl> + import org . apache . http . client . config . CookieSpecs ; <nl> + import org . apache . http . client . config . RequestConfig ; <nl> import org . apache . http . client . fluent . Executor ; <nl> import org . apache . http . client . fluent . Request ; <nl> import org . apache . http . config . Registry ; <nl> @ @ - 13 , 6 + 15 , 7 @ @ import org . apache . http . conn . socket . ConnectionSocketFactory ; <nl> import org . apache . http . conn . socket . PlainConnectionSocketFactory ; <nl> import org . apache . http . conn . ssl . SSLConnectionSocketFactory ; <nl> import org . apache . http . entity . ContentType ; <nl> + import org . apache . http . impl . client . CloseableHttpClient ; <nl> import org . apache . http . impl . client . HttpClients ; <nl> import org . apache . http . impl . conn . PoolingHttpClientConnectionManager ; <nl> import org . apache . http . util . EntityUtils ; <nl> @ @ - 36 , 7 + 39 , 12 @ @ public class MocoTestHelper { <nl> . register ( " https " , new SSLConnectionSocketFactory ( createClientContext ( ) ) ) <nl> . build ( ) ; <nl> HttpClientConnectionManager cm = new PoolingHttpClientConnectionManager ( registry ) ; <nl> - executor = Executor . newInstance ( HttpClients . custom ( ) . setConnectionManager ( cm ) . build ( ) ) ; <nl> + CloseableHttpClient client = HttpClients . custom ( ) <nl> + . setConnectionManager ( cm ) <nl> + . setDefaultRequestConfig ( RequestConfig . custom ( ) . setCookieSpec ( CookieSpecs . STANDARD ) . build ( ) ) <nl> + . build ( ) ; <nl> + <nl> + executor = Executor . newInstance ( client ) ; <nl> } <nl> <nl> public String get ( final String url ) throws IOException {
NEAREST DIFF (one line): diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java b / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java <nl> index 311e162 . . 216148b 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java <nl> @ @ - 22 , 6 + 22 , 9 @ @ public abstract class AbstractContentResponseHandler extends AbstractResponseHan <nl> Response response = context . getResponse ( ) ; <nl> <nl> if ( HttpRequest . class . isInstance ( request ) & & MutableHttpResponse . class . isInstance ( response ) ) { <nl> + if ( ! canResponseHaveContent ( HttpRequest . class . cast ( request ) ) ) { <nl> + return ; <nl> + } <nl> HttpRequest httpRequest = HttpRequest . class . cast ( request ) ; <nl> MutableHttpResponse httpResponse = MutableHttpResponse . class . cast ( response ) ; <nl> doWriteToResponse ( httpRequest , httpResponse ) ; <nl> @ @ - 32 , 6 + 35 , 10 @ @ public abstract class AbstractContentResponseHandler extends AbstractResponseHan <nl> mutableResponse . setContent ( requireResponseContent ( request ) ) ; <nl> } <nl> <nl> + private boolean canResponseHaveContent ( final HttpRequest request ) { <nl> + return ! " HEAD " . equalsIgnoreCase ( request . getMethod ( ) ) ; <nl> + } <nl> + <nl> protected void doWriteToResponse ( final HttpRequest httpRequest , final MutableHttpResponse httpResponse ) { <nl> MessageContent content = requireResponseContent ( httpRequest ) ; <nl> httpResponse . setContent ( content ) ; <nl> diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java b / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java <nl> index cdcf9a2 . . c7981f5 100644 <nl> - - - a / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java <nl> + + + b / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java <nl> @ @ - 1 , 11 + 1 , 17 @ @ <nl> package com . github . dreamhead . moco ; <nl> <nl> + import com . google . common . io . ByteStreams ; <nl> import com . google . common . net . HttpHeaders ; <nl> - import org . apache . http . Header ; <nl> - import org . apache . http . HttpVersion ; <nl> - import org . apache . http . ProtocolVersion ; <nl> + import org . apache . http . * ; <nl> + import org . apache . http . HttpRequest ; <nl> + import org . apache . http . HttpResponse ; <nl> import org . apache . http . client . HttpResponseException ; <nl> import org . apache . http . client . fluent . Request ; <nl> + import org . apache . http . client . methods . CloseableHttpResponse ; <nl> + import org . apache . http . client . methods . HttpHead ; <nl> + import org . apache . http . impl . client . CloseableHttpClient ; <nl> + import org . apache . http . impl . client . HttpClients ; <nl> + import org . apache . http . protocol . HttpRequestExecutor ; <nl> import org . junit . Test ; <nl> <nl> import java . io . File ; <nl> @ @ - 692 , 4 + 698 , 26 @ @ public class MocoTest extends AbstractMocoHttpTest { <nl> } <nl> } ) ; <nl> } <nl> + <nl> + @ Test <nl> + public void should _ not _ return _ response _ for _ head _ request ( ) throws Exception { <nl> + server . response ( header ( " foo " , " bar " ) , with ( template ( " $ { req . uri } " ) ) ) ; <nl> + <nl> + running ( server , new Runnable ( ) { <nl> + @ Override <nl> + public void run ( ) throws Exception { <nl> + CloseableHttpClient httpClient = HttpClients . custom ( ) . setRequestExecutor ( new HttpRequestExecutor ( ) { <nl> + @ Override <nl> + protected boolean canResponseHaveBody ( HttpRequest request , HttpResponse response ) { <nl> + return " HEAD " . equalsIgnoreCase ( request . getRequestLine ( ) . getMethod ( ) ) <nl> + | | super . canResponseHaveBody ( request , response ) ; <nl> + } <nl> + } ) . build ( ) ; <nl> + HttpHead httpHead = new HttpHead ( remoteUrl ( " / request " ) ) ; <nl> + CloseableHttpResponse response = httpClient . execute ( httpHead ) ; <nl> + byte [ ] bytes = ByteStreams . toByteArray ( response . getEntity ( ) . getContent ( ) ) ; <nl> + assertThat ( bytes . length , is ( 0 ) ) ; <nl> + } <nl> + } ) ; <nl> + } <nl> }

TEST DIFF:
diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java b / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java 
 index 3f54ae4 . . 10d3b64 100644 
 - - - a / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java 
 + + + b / moco - core / src / test / java / com / github / dreamhead / moco / MocoWebTest . java 
 @ @ - 138 , 14 + 138 , 14 @ @ public class MocoWebTest extends AbstractMocoHttpTest { 
 @ Test 
 public void should _ set _ and _ recognize _ cookie _ with _ domain ( ) throws Exception { 
 server . request ( eq ( cookie ( " loggedIn " ) , " true " ) ) . response ( status ( 200 ) ) ; 
 - server . response ( cookie ( " loggedIn " , " true " , domain ( " github . com " ) ) , status ( 302 ) ) ; 
 + server . response ( cookie ( " loggedIn " , " true " , domain ( " localhost " ) ) , status ( 302 ) ) ; 
 running ( server , new Runnable ( ) { 
 @ Override 
 public void run ( ) throws IOException { 
 org . apache . http . HttpResponse response = helper . getResponse ( root ( ) ) ; 
 String value = response . getFirstHeader ( HttpHeaders . SET _ COOKIE ) . getValue ( ) ; 
 Cookie decodeCookie = ClientCookieDecoder . STRICT . decode ( value ) ; 
 - assertThat ( decodeCookie . domain ( ) , is ( " github . com " ) ) ; 
 + assertThat ( decodeCookie . domain ( ) , is ( " localhost " ) ) ; 
 } 
 } ) ; 
 } 
 diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java b / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java 
 index b54af9e . . d110713 100644 
 - - - a / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java 
 + + + b / moco - core / src / test / java / com / github / dreamhead / moco / helper / MocoTestHelper . java 
 @ @ - 4 , 6 + 4 , 8 @ @ import com . google . common . collect . ImmutableMultimap ; 
 import com . google . common . io . Resources ; 
 import org . apache . http . HttpResponse ; 
 import org . apache . http . HttpVersion ; 
 + import org . apache . http . client . config . CookieSpecs ; 
 + import org . apache . http . client . config . RequestConfig ; 
 import org . apache . http . client . fluent . Executor ; 
 import org . apache . http . client . fluent . Request ; 
 import org . apache . http . config . Registry ; 
 @ @ - 13 , 6 + 15 , 7 @ @ import org . apache . http . conn . socket . ConnectionSocketFactory ; 
 import org . apache . http . conn . socket . PlainConnectionSocketFactory ; 
 import org . apache . http . conn . ssl . SSLConnectionSocketFactory ; 
 import org . apache . http . entity . ContentType ; 
 + import org . apache . http . impl . client . CloseableHttpClient ; 
 import org . apache . http . impl . client . HttpClients ; 
 import org . apache . http . impl . conn . PoolingHttpClientConnectionManager ; 
 import org . apache . http . util . EntityUtils ; 
 @ @ - 36 , 7 + 39 , 12 @ @ public class MocoTestHelper { 
 . register ( " https " , new SSLConnectionSocketFactory ( createClientContext ( ) ) ) 
 . build ( ) ; 
 HttpClientConnectionManager cm = new PoolingHttpClientConnectionManager ( registry ) ; 
 - executor = Executor . newInstance ( HttpClients . custom ( ) . setConnectionManager ( cm ) . build ( ) ) ; 
 + CloseableHttpClient client = HttpClients . custom ( ) 
 + . setConnectionManager ( cm ) 
 + . setDefaultRequestConfig ( RequestConfig . custom ( ) . setCookieSpec ( CookieSpecs . STANDARD ) . build ( ) ) 
 + . build ( ) ; 
 + 
 + executor = Executor . newInstance ( client ) ; 
 } 
 
 public String get ( final String url ) throws IOException {

NEAREST DIFF:
diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java b / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java 
 index 311e162 . . 216148b 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / handler / AbstractContentResponseHandler . java 
 @ @ - 22 , 6 + 22 , 9 @ @ public abstract class AbstractContentResponseHandler extends AbstractResponseHan 
 Response response = context . getResponse ( ) ; 
 
 if ( HttpRequest . class . isInstance ( request ) & & MutableHttpResponse . class . isInstance ( response ) ) { 
 + if ( ! canResponseHaveContent ( HttpRequest . class . cast ( request ) ) ) { 
 + return ; 
 + } 
 HttpRequest httpRequest = HttpRequest . class . cast ( request ) ; 
 MutableHttpResponse httpResponse = MutableHttpResponse . class . cast ( response ) ; 
 doWriteToResponse ( httpRequest , httpResponse ) ; 
 @ @ - 32 , 6 + 35 , 10 @ @ public abstract class AbstractContentResponseHandler extends AbstractResponseHan 
 mutableResponse . setContent ( requireResponseContent ( request ) ) ; 
 } 
 
 + private boolean canResponseHaveContent ( final HttpRequest request ) { 
 + return ! " HEAD " . equalsIgnoreCase ( request . getMethod ( ) ) ; 
 + } 
 + 
 protected void doWriteToResponse ( final HttpRequest httpRequest , final MutableHttpResponse httpResponse ) { 
 MessageContent content = requireResponseContent ( httpRequest ) ; 
 httpResponse . setContent ( content ) ; 
 diff - - git a / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java b / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java 
 index cdcf9a2 . . c7981f5 100644 
 - - - a / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java 
 + + + b / moco - core / src / test / java / com / github / dreamhead / moco / MocoTest . java 
 @ @ - 1 , 11 + 1 , 17 @ @ 
 package com . github . dreamhead . moco ; 
 
 + import com . google . common . io . ByteStreams ; 
 import com . google . common . net . HttpHeaders ; 
 - import org . apache . http . Header ; 
 - import org . apache . http . HttpVersion ; 
 - import org . apache . http . ProtocolVersion ; 
 + import org . apache . http . * ; 
 + import org . apache . http . HttpRequest ; 
 + import org . apache . http . HttpResponse ; 
 import org . apache . http . client . HttpResponseException ; 
 import org . apache . http . client . fluent . Request ; 
 + import org . apache . http . client . methods . CloseableHttpResponse ; 
 + import org . apache . http . client . methods . HttpHead ; 
 + import org . apache . http . impl . client . CloseableHttpClient ; 
 + import org . apache . http . impl . client . HttpClients ; 
 + import org . apache . http . protocol . HttpRequestExecutor ; 
 import org . junit . Test ; 
 
 import java . io . File ; 
 @ @ - 692 , 4 + 698 , 26 @ @ public class MocoTest extends AbstractMocoHttpTest { 
 } 
 } ) ; 
 } 
 + 
 + @ Test 
 + public void should _ not _ return _ response _ for _ head _ request ( ) throws Exception { 
 + server . response ( header ( " foo " , " bar " ) , with ( template ( " $ { req . uri } " ) ) ) ; 
 + 
 + running ( server , new Runnable ( ) { 
 + @ Override 
 + public void run ( ) throws Exception { 
 + CloseableHttpClient httpClient = HttpClients . custom ( ) . setRequestExecutor ( new HttpRequestExecutor ( ) { 
 + @ Override 
 + protected boolean canResponseHaveBody ( HttpRequest request , HttpResponse response ) { 
 + return " HEAD " . equalsIgnoreCase ( request . getRequestLine ( ) . getMethod ( ) ) 
 + | | super . canResponseHaveBody ( request , response ) ; 
 + } 
 + } ) . build ( ) ; 
 + HttpHead httpHead = new HttpHead ( remoteUrl ( " / request " ) ) ; 
 + CloseableHttpResponse response = httpClient . execute ( httpHead ) ; 
 + byte [ ] bytes = ByteStreams . toByteArray ( response . getEntity ( ) . getContent ( ) ) ; 
 + assertThat ( bytes . length , is ( 0 ) ) ; 
 + } 
 + } ) ; 
 + } 
 }
