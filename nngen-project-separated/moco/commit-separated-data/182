BLEU SCORE: 0.04767707020457096

TEST MSG: started to work on http headers with same key
GENERATED MSG: made dump http request and response immutable

TEST DIFF (one line): diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java <nl> index ffebb07 . . 7b7a55b 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java <nl> @ @ - 9 , 8 + 9 , 9 @ @ public abstract class DefaultHttpMessage implements HttpMessage { <nl> private final MessageContent content ; <nl> private final ImmutableMap < String , String > headers ; <nl> <nl> - protected DefaultHttpMessage ( final HttpProtocolVersion version , final MessageContent content , <nl> - final ImmutableMap < String , String > headers ) { <nl> + protected DefaultHttpMessage ( final HttpProtocolVersion version , <nl> + final MessageContent content , <nl> + final ImmutableMap < String , String > headers ) { <nl> this . version = version ; <nl> this . content = content ; <nl> this . headers = headers ; <nl> diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java <nl> index ebff5eb . . ad2423c 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java <nl> @ @ - 22 , 6 + 22 , 8 @ @ import io . netty . handler . codec . http . HttpVersion ; <nl> import io . netty . handler . codec . http . QueryStringDecoder ; <nl> import io . netty . handler . codec . http . QueryStringEncoder ; <nl> <nl> + import java . util . ArrayList ; <nl> + import java . util . HashMap ; <nl> import java . util . List ; <nl> import java . util . Map ; <nl> <nl> @ @ - 140 , 7 + 142 , 8 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http <nl> <nl> return builder ( ) <nl> . withVersion ( HttpProtocolVersion . versionOf ( request . protocolVersion ( ) . text ( ) ) ) <nl> - . withHeaders ( collectHeaders ( request . headers ( ) ) ) <nl> + . forHeaders ( toHeaders ( request . headers ( ) ) ) <nl> + / / . withHeaders ( collectHeaders ( request . headers ( ) ) ) <nl> . withMethod ( HttpMethod . valueOf ( request . method ( ) . toString ( ) . toUpperCase ( ) ) ) <nl> . withUri ( decoder . path ( ) ) <nl> . withQueries ( queries ) <nl> @ @ - 190 , 6 + 193 , 32 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http <nl> return headerBuilder . build ( ) ; <nl> } <nl> <nl> + private static ImmutableMap < String , String [ ] > toHeaders ( final Iterable < Map . Entry < String , String > > httpHeaders ) { <nl> + Map < String , List < String > > headers = new HashMap < > ( ) ; <nl> + for ( Map . Entry < String , String > entry : httpHeaders ) { <nl> + String key = entry . getKey ( ) ; <nl> + List < String > values = getValues ( headers , key ) ; <nl> + values . add ( entry . getValue ( ) ) ; <nl> + headers . put ( key , values ) ; <nl> + } <nl> + <nl> + Map < String , String [ ] > results = new HashMap < > ( ) ; <nl> + for ( Map . Entry < String , List < String > > entry : headers . entrySet ( ) ) { <nl> + List < String > value = entry . getValue ( ) ; <nl> + results . put ( entry . getKey ( ) , value . toArray ( new String [ value . size ( ) ] ) ) ; <nl> + } <nl> + <nl> + return copyOf ( results ) ; <nl> + } <nl> + <nl> + private static List < String > getValues ( final Map < String , List < String > > headers , final String key ) { <nl> + if ( headers . containsKey ( key ) ) { <nl> + return headers . get ( key ) ; <nl> + } <nl> + <nl> + return new ArrayList < > ( ) ; <nl> + } <nl> + <nl> public static final class Builder { <nl> private HttpProtocolVersion version ; <nl> private MessageContent content ; <nl> @ @ - 221 , 6 + 250 , 18 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http <nl> return this ; <nl> } <nl> <nl> + public Builder forHeaders ( final Map < String , String [ ] > headers ) { <nl> + if ( headers ! = null ) { <nl> + ImmutableMap . Builder < String , String > builder = ImmutableMap . builder ( ) ; <nl> + for ( Map . Entry < String , String [ ] > entry : headers . entrySet ( ) ) { <nl> + builder . put ( entry . getKey ( ) , entry . getValue ( ) [ 0 ] ) ; <nl> + } <nl> + this . headers = builder . build ( ) ; <nl> + } <nl> + <nl> + return this ; <nl> + } <nl> + <nl> public Builder withMethod ( final HttpMethod method ) { <nl> this . method = method ; <nl> return this ;
NEAREST DIFF (one line): diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java <nl> index 65e1b31 . . 51a46e2 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java <nl> @ @ - 10 , 17 + 10 , 15 @ @ import static com . google . common . collect . Maps . newHashMap ; <nl> <nl> @ JsonDeserialize ( builder = DumpHttpRequest . Builder . class ) <nl> public class DumpHttpRequest extends DumpMessage implements HttpRequest { <nl> - private Map < String , String > queries = newHashMap ( ) ; <nl> - private String method ; <nl> - private String uri ; <nl> + private final Map < String , String > queries ; <nl> + private final String method ; <nl> + private final String uri ; <nl> <nl> private DumpHttpRequest ( String version , String content , String method , String uri , <nl> Map < String , String > headers , Map < String , String > queries ) { <nl> - this . version = version ; <nl> - this . content = content ; <nl> + super ( version , content , headers ) ; <nl> this . method = method ; <nl> this . uri = uri ; <nl> - this . headers = headers ; <nl> this . queries = queries ; <nl> } <nl> <nl> diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java <nl> index 736702a . . 99850b6 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java <nl> @ @ - 1 , 35 + 1 , 76 @ @ <nl> package com . github . dreamhead . moco . model ; <nl> <nl> + import com . fasterxml . jackson . databind . annotation . JsonDeserialize ; <nl> import com . github . dreamhead . moco . HttpResponse ; <nl> - import com . google . common . base . Strings ; <nl> - import io . netty . handler . codec . http . FullHttpMessage ; <nl> + import com . google . common . collect . ImmutableMap ; <nl> import io . netty . handler . codec . http . FullHttpResponse ; <nl> <nl> import java . nio . charset . Charset ; <nl> import java . util . Map ; <nl> <nl> + import static com . google . common . collect . Maps . newHashMap ; <nl> + <nl> + @ JsonDeserialize ( builder = DumpHttpResponse . Builder . class ) <nl> public class DumpHttpResponse extends DumpMessage implements HttpResponse { <nl> - private int statusCode ; <nl> + private final int statusCode ; <nl> + <nl> + public DumpHttpResponse ( String version , int statusCode , Map < String , String > headers , String content ) { <nl> + super ( version , content , headers ) ; <nl> + this . statusCode = statusCode ; <nl> + } <nl> <nl> public int getStatusCode ( ) { <nl> return statusCode ; <nl> } <nl> <nl> public static DumpHttpResponse newResponse ( FullHttpResponse response ) { <nl> - DumpHttpResponse httpResponse = new DumpHttpResponse ( ) ; <nl> - httpResponse . statusCode = response . getStatus ( ) . code ( ) ; <nl> - httpResponse . version = response . getProtocolVersion ( ) . text ( ) ; <nl> + ImmutableMap . Builder < String , String > headerBuilder = ImmutableMap . builder ( ) ; <nl> for ( Map . Entry < String , String > entry : response . headers ( ) ) { <nl> - httpResponse . headers . put ( entry . getKey ( ) , entry . getValue ( ) ) ; <nl> + headerBuilder . put ( entry ) ; <nl> } <nl> - setContent ( response , httpResponse ) ; <nl> - return httpResponse ; <nl> + <nl> + return builder ( ) <nl> + . withVersion ( response . getProtocolVersion ( ) . text ( ) ) <nl> + . withStatusCode ( response . getStatus ( ) . code ( ) ) <nl> + . withHeaders ( headerBuilder . build ( ) ) <nl> + . withContent ( response . content ( ) . toString ( Charset . defaultCharset ( ) ) ) <nl> + . build ( ) ; <nl> } <nl> <nl> - private static void setContent ( FullHttpMessage message , DumpMessage dumpedDumpMessage ) { <nl> - String text = message . content ( ) . toString ( Charset . defaultCharset ( ) ) ; <nl> - if ( ! Strings . isNullOrEmpty ( text ) ) { <nl> - dumpedDumpMessage . content = text ; <nl> + public static Builder builder ( ) { <nl> + return new Builder ( ) ; <nl> + } <nl> + <nl> + public static final class Builder { <nl> + private String version ; <nl> + private String content ; <nl> + private Map < String , String > headers = newHashMap ( ) ; <nl> + private int statusCode ; <nl> + <nl> + public Builder withVersion ( String version ) { <nl> + this . version = version ; <nl> + return this ; <nl> + } <nl> + <nl> + public Builder withContent ( String content ) { <nl> + this . content = content ; <nl> + return this ; <nl> } <nl> + <nl> + public Builder withHeaders ( Map < String , String > headers ) { <nl> + this . headers = headers ; <nl> + return this ; <nl> + } <nl> + <nl> + public Builder withStatusCode ( int code ) { <nl> + this . statusCode = code ; <nl> + return this ; <nl> + } <nl> + <nl> + public DumpHttpResponse build ( ) { <nl> + return new DumpHttpResponse ( version , statusCode , headers , content ) ; <nl> + } <nl> + <nl> + <nl> } <nl> } <nl> diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java <nl> index 150c1c5 . . 0c599b3 100644 <nl> - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java <nl> + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java <nl> @ @ - 4 , 12 + 4 , 16 @ @ import com . google . common . base . Objects ; <nl> <nl> import java . util . Map ; <nl> <nl> - import static com . google . common . collect . Maps . newHashMap ; <nl> - <nl> public abstract class DumpMessage { <nl> - protected String version ; <nl> - protected String content ; <nl> - protected Map < String , String > headers = newHashMap ( ) ; <nl> + protected final String version ; <nl> + protected final String content ; <nl> + protected final Map < String , String > headers ; <nl> + <nl> + protected DumpMessage ( String version , String content , Map < String , String > headers ) { <nl> + this . version = version ; <nl> + this . headers = headers ; <nl> + this . content = content ; <nl> + } <nl> <nl> public String getVersion ( ) { <nl> return version ;

TEST DIFF:
diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java 
 index ffebb07 . . 7b7a55b 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpMessage . java 
 @ @ - 9 , 8 + 9 , 9 @ @ public abstract class DefaultHttpMessage implements HttpMessage { 
 private final MessageContent content ; 
 private final ImmutableMap < String , String > headers ; 
 
 - protected DefaultHttpMessage ( final HttpProtocolVersion version , final MessageContent content , 
 - final ImmutableMap < String , String > headers ) { 
 + protected DefaultHttpMessage ( final HttpProtocolVersion version , 
 + final MessageContent content , 
 + final ImmutableMap < String , String > headers ) { 
 this . version = version ; 
 this . content = content ; 
 this . headers = headers ; 
 diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java 
 index ebff5eb . . ad2423c 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DefaultHttpRequest . java 
 @ @ - 22 , 6 + 22 , 8 @ @ import io . netty . handler . codec . http . HttpVersion ; 
 import io . netty . handler . codec . http . QueryStringDecoder ; 
 import io . netty . handler . codec . http . QueryStringEncoder ; 
 
 + import java . util . ArrayList ; 
 + import java . util . HashMap ; 
 import java . util . List ; 
 import java . util . Map ; 
 
 @ @ - 140 , 7 + 142 , 8 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http 
 
 return builder ( ) 
 . withVersion ( HttpProtocolVersion . versionOf ( request . protocolVersion ( ) . text ( ) ) ) 
 - . withHeaders ( collectHeaders ( request . headers ( ) ) ) 
 + . forHeaders ( toHeaders ( request . headers ( ) ) ) 
 + / / . withHeaders ( collectHeaders ( request . headers ( ) ) ) 
 . withMethod ( HttpMethod . valueOf ( request . method ( ) . toString ( ) . toUpperCase ( ) ) ) 
 . withUri ( decoder . path ( ) ) 
 . withQueries ( queries ) 
 @ @ - 190 , 6 + 193 , 32 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http 
 return headerBuilder . build ( ) ; 
 } 
 
 + private static ImmutableMap < String , String [ ] > toHeaders ( final Iterable < Map . Entry < String , String > > httpHeaders ) { 
 + Map < String , List < String > > headers = new HashMap < > ( ) ; 
 + for ( Map . Entry < String , String > entry : httpHeaders ) { 
 + String key = entry . getKey ( ) ; 
 + List < String > values = getValues ( headers , key ) ; 
 + values . add ( entry . getValue ( ) ) ; 
 + headers . put ( key , values ) ; 
 + } 
 + 
 + Map < String , String [ ] > results = new HashMap < > ( ) ; 
 + for ( Map . Entry < String , List < String > > entry : headers . entrySet ( ) ) { 
 + List < String > value = entry . getValue ( ) ; 
 + results . put ( entry . getKey ( ) , value . toArray ( new String [ value . size ( ) ] ) ) ; 
 + } 
 + 
 + return copyOf ( results ) ; 
 + } 
 + 
 + private static List < String > getValues ( final Map < String , List < String > > headers , final String key ) { 
 + if ( headers . containsKey ( key ) ) { 
 + return headers . get ( key ) ; 
 + } 
 + 
 + return new ArrayList < > ( ) ; 
 + } 
 + 
 public static final class Builder { 
 private HttpProtocolVersion version ; 
 private MessageContent content ; 
 @ @ - 221 , 6 + 250 , 18 @ @ public final class DefaultHttpRequest extends DefaultHttpMessage implements Http 
 return this ; 
 } 
 
 + public Builder forHeaders ( final Map < String , String [ ] > headers ) { 
 + if ( headers ! = null ) { 
 + ImmutableMap . Builder < String , String > builder = ImmutableMap . builder ( ) ; 
 + for ( Map . Entry < String , String [ ] > entry : headers . entrySet ( ) ) { 
 + builder . put ( entry . getKey ( ) , entry . getValue ( ) [ 0 ] ) ; 
 + } 
 + this . headers = builder . build ( ) ; 
 + } 
 + 
 + return this ; 
 + } 
 + 
 public Builder withMethod ( final HttpMethod method ) { 
 this . method = method ; 
 return this ;

NEAREST DIFF:
diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java 
 index 65e1b31 . . 51a46e2 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpRequest . java 
 @ @ - 10 , 17 + 10 , 15 @ @ import static com . google . common . collect . Maps . newHashMap ; 
 
 @ JsonDeserialize ( builder = DumpHttpRequest . Builder . class ) 
 public class DumpHttpRequest extends DumpMessage implements HttpRequest { 
 - private Map < String , String > queries = newHashMap ( ) ; 
 - private String method ; 
 - private String uri ; 
 + private final Map < String , String > queries ; 
 + private final String method ; 
 + private final String uri ; 
 
 private DumpHttpRequest ( String version , String content , String method , String uri , 
 Map < String , String > headers , Map < String , String > queries ) { 
 - this . version = version ; 
 - this . content = content ; 
 + super ( version , content , headers ) ; 
 this . method = method ; 
 this . uri = uri ; 
 - this . headers = headers ; 
 this . queries = queries ; 
 } 
 
 diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java 
 index 736702a . . 99850b6 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpHttpResponse . java 
 @ @ - 1 , 35 + 1 , 76 @ @ 
 package com . github . dreamhead . moco . model ; 
 
 + import com . fasterxml . jackson . databind . annotation . JsonDeserialize ; 
 import com . github . dreamhead . moco . HttpResponse ; 
 - import com . google . common . base . Strings ; 
 - import io . netty . handler . codec . http . FullHttpMessage ; 
 + import com . google . common . collect . ImmutableMap ; 
 import io . netty . handler . codec . http . FullHttpResponse ; 
 
 import java . nio . charset . Charset ; 
 import java . util . Map ; 
 
 + import static com . google . common . collect . Maps . newHashMap ; 
 + 
 + @ JsonDeserialize ( builder = DumpHttpResponse . Builder . class ) 
 public class DumpHttpResponse extends DumpMessage implements HttpResponse { 
 - private int statusCode ; 
 + private final int statusCode ; 
 + 
 + public DumpHttpResponse ( String version , int statusCode , Map < String , String > headers , String content ) { 
 + super ( version , content , headers ) ; 
 + this . statusCode = statusCode ; 
 + } 
 
 public int getStatusCode ( ) { 
 return statusCode ; 
 } 
 
 public static DumpHttpResponse newResponse ( FullHttpResponse response ) { 
 - DumpHttpResponse httpResponse = new DumpHttpResponse ( ) ; 
 - httpResponse . statusCode = response . getStatus ( ) . code ( ) ; 
 - httpResponse . version = response . getProtocolVersion ( ) . text ( ) ; 
 + ImmutableMap . Builder < String , String > headerBuilder = ImmutableMap . builder ( ) ; 
 for ( Map . Entry < String , String > entry : response . headers ( ) ) { 
 - httpResponse . headers . put ( entry . getKey ( ) , entry . getValue ( ) ) ; 
 + headerBuilder . put ( entry ) ; 
 } 
 - setContent ( response , httpResponse ) ; 
 - return httpResponse ; 
 + 
 + return builder ( ) 
 + . withVersion ( response . getProtocolVersion ( ) . text ( ) ) 
 + . withStatusCode ( response . getStatus ( ) . code ( ) ) 
 + . withHeaders ( headerBuilder . build ( ) ) 
 + . withContent ( response . content ( ) . toString ( Charset . defaultCharset ( ) ) ) 
 + . build ( ) ; 
 } 
 
 - private static void setContent ( FullHttpMessage message , DumpMessage dumpedDumpMessage ) { 
 - String text = message . content ( ) . toString ( Charset . defaultCharset ( ) ) ; 
 - if ( ! Strings . isNullOrEmpty ( text ) ) { 
 - dumpedDumpMessage . content = text ; 
 + public static Builder builder ( ) { 
 + return new Builder ( ) ; 
 + } 
 + 
 + public static final class Builder { 
 + private String version ; 
 + private String content ; 
 + private Map < String , String > headers = newHashMap ( ) ; 
 + private int statusCode ; 
 + 
 + public Builder withVersion ( String version ) { 
 + this . version = version ; 
 + return this ; 
 + } 
 + 
 + public Builder withContent ( String content ) { 
 + this . content = content ; 
 + return this ; 
 } 
 + 
 + public Builder withHeaders ( Map < String , String > headers ) { 
 + this . headers = headers ; 
 + return this ; 
 + } 
 + 
 + public Builder withStatusCode ( int code ) { 
 + this . statusCode = code ; 
 + return this ; 
 + } 
 + 
 + public DumpHttpResponse build ( ) { 
 + return new DumpHttpResponse ( version , statusCode , headers , content ) ; 
 + } 
 + 
 + 
 } 
 } 
 diff - - git a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java 
 index 150c1c5 . . 0c599b3 100644 
 - - - a / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java 
 + + + b / moco - core / src / main / java / com / github / dreamhead / moco / model / DumpMessage . java 
 @ @ - 4 , 12 + 4 , 16 @ @ import com . google . common . base . Objects ; 
 
 import java . util . Map ; 
 
 - import static com . google . common . collect . Maps . newHashMap ; 
 - 
 public abstract class DumpMessage { 
 - protected String version ; 
 - protected String content ; 
 - protected Map < String , String > headers = newHashMap ( ) ; 
 + protected final String version ; 
 + protected final String content ; 
 + protected final Map < String , String > headers ; 
 + 
 + protected DumpMessage ( String version , String content , Map < String , String > headers ) { 
 + this . version = version ; 
 + this . headers = headers ; 
 + this . content = content ; 
 + } 
 
 public String getVersion ( ) { 
 return version ;
